---
title: 役割の交代後のログインとジョブの管理 (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- role switching [SQL Server]
ms.assetid: fc2fc949-746f-40c7-b5d4-3fd51ccfbd7b
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 9c099bf9ea271b5ea93fdebfe8f35c98864bca09
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87640543"
---
# <a name="management-of-logins-and-jobs-after-role-switching-sql-server"></a><span data-ttu-id="82a24-102">役割の交代後のログインとジョブの管理 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="82a24-102">Management of Logins and Jobs After Role Switching (SQL Server)</span></span>
  <span data-ttu-id="82a24-103">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] データベースの高可用性ソリューションまたは災害復旧ソリューションを展開する場合、**master** 内のデータベースまたは **msdb** データベースに格納されている関連情報を再現することが重要です。</span><span class="sxs-lookup"><span data-stu-id="82a24-103">When deploying a high-availability or disaster-recovery solution for a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] database, it is important to reproduce relevant information that is stored for the database in the **master** or **msdb** databases.</span></span> <span data-ttu-id="82a24-104">通常、関連情報には、プライマリ/プリンシパル データベースのジョブおよびデータベースへの接続に必要なユーザーまたはプロセスのログインが含まれます。</span><span class="sxs-lookup"><span data-stu-id="82a24-104">Typically, the relevant information includes the jobs of the primary/principal database and the logins of users or processes that need to connect to the database.</span></span> <span data-ttu-id="82a24-105">セカンダリ/ミラー データベースをホストする [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] の任意のインスタンスでこの情報を複製する必要があります。</span><span class="sxs-lookup"><span data-stu-id="82a24-105">You should duplicate this information on any instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] that hosts a secondary/mirror database.</span></span> <span data-ttu-id="82a24-106">可能であれば、役割の交代後に、プログラムで新しいプライマリ/プリンシパル データベースに情報を再現することが最善の方法です。</span><span class="sxs-lookup"><span data-stu-id="82a24-106">If possible after roles are switched, it is best to programmatically reproduce the information on the new primary/principal database.</span></span>  
  
## <a name="logins"></a><span data-ttu-id="82a24-107">Login</span><span class="sxs-lookup"><span data-stu-id="82a24-107">Logins</span></span>  
 <span data-ttu-id="82a24-108">データベースのコピーをホストするすべてのサーバー インスタンスで、プリンシパル データベースにアクセスする権限を持つログインを再現する必要があります。</span><span class="sxs-lookup"><span data-stu-id="82a24-108">On every server instances that hosts a copy of the database, you should reproduce the logins that have permission to access the principal database.</span></span> <span data-ttu-id="82a24-109">プライマリ/プリンシパルの役割が交代すると、新しいプリンシパル/プライマリ サーバー インスタンスにログインが存在するユーザーのみが新しいプリンシパル/プライマリ データベースにアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="82a24-109">When the primary/principal role switches, only users whose logins exist on the new primary/principal server instance can access the new primary/principal database.</span></span> <span data-ttu-id="82a24-110">ログインが新しいプライマリ/プリンシパル サーバー インスタンスで定義されていないユーザーは孤立して、データベースにアクセスできません。</span><span class="sxs-lookup"><span data-stu-id="82a24-110">Users whose logins are not defined on the new primary/principal server instance are orphaned and cannot access the database.</span></span>  
  
 <span data-ttu-id="82a24-111">ユーザーが孤立している場合は、新しいプライマリ/プリンシパル サーバー インスタンスでログインを作成し、 [sp_change_users_login](/sql/relational-databases/system-stored-procedures/sp-change-users-login-transact-sql)を実行します。</span><span class="sxs-lookup"><span data-stu-id="82a24-111">If a user is orphaned, create the login on the new primary/principal server instance and run [sp_change_users_login](/sql/relational-databases/system-stored-procedures/sp-change-users-login-transact-sql).</span></span> <span data-ttu-id="82a24-112">詳細については、「 [孤立ユーザーのトラブルシューティング &#40;SQL Server&#41;](troubleshoot-orphaned-users-sql-server.md)を実行します。</span><span class="sxs-lookup"><span data-stu-id="82a24-112">For more information, see [Troubleshoot Orphaned Users &#40;SQL Server&#41;](troubleshoot-orphaned-users-sql-server.md).</span></span>  
  
###  <a name="logins-of-applications-that-use-sql-server-authentication-or-a-local-windows-login"></a><a name="SSauthentication"></a> <span data-ttu-id="82a24-113">SQL Server 認証またはローカル Windows ログインを使用するアプリケーションのログイン</span><span class="sxs-lookup"><span data-stu-id="82a24-113">Logins Of Applications That Use SQL Server Authentication or a Local Windows Login</span></span>  
 <span data-ttu-id="82a24-114">アプリケーションで SQL Server 認証またはローカル Windows ログインを使用している場合、SID が一致しないと、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]のリモート インスタンスでアプリケーションのログインを解決できないことがあります。</span><span class="sxs-lookup"><span data-stu-id="82a24-114">If an application uses SQL Server Authentication or a local Windows login, mismatched SIDs can prevent the application's login from resolving on a remote instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="82a24-115">SID が一致しないと、ログインはリモート サーバー インスタンスの孤立ユーザーになります。</span><span class="sxs-lookup"><span data-stu-id="82a24-115">The mismatched SIDs cause the login to become an orphaned user on the remote server instance.</span></span> <span data-ttu-id="82a24-116">この問題は、アプリケーションがフェールオーバー後にミラー化されたデータベースまたはログ配布データベース、またはバックアップから初期化されたレプリケーション サブスクライバー データベースに接続すると発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="82a24-116">This issue can occur when an application connects to a mirrored or log shipping database after a failover or to a replication subscriber database that was initialized from a backup.</span></span>  
  
 <span data-ttu-id="82a24-117">この問題を防ぐために、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]のリモート インスタンスによってホストされているデータベースを使用するようにアプリケーションをセットアップする場合、予防策を講じることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="82a24-117">To prevent this issue, we recommend that you take preventative measures when you set up such an application to use a database that is hosted by a remote instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="82a24-118">予報策として、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] のローカル インスタンスから [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]のリモート インスタンスにログインとパスワードを転送する必要があります。</span><span class="sxs-lookup"><span data-stu-id="82a24-118">Prevention involves transferring the logins and the passwords from the local instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] to the remote instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="82a24-119">この問題を回避する方法の詳細については、サポート技術情報の記事 918992「[SQL Server のインスタンス間でログインおよびパスワードを転送する方法](https://support.microsoft.com/kb/918992/)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="82a24-119">For more information about how to prevent this issue, see KB article 918992 -[How to transfer logins and passwords between instances of SQL Server](https://support.microsoft.com/kb/918992/)).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="82a24-120">この問題は、さまざまなコンピューターの Windows ローカル アカウントに影響します。</span><span class="sxs-lookup"><span data-stu-id="82a24-120">This problem affects Windows local accounts on different computers.</span></span> <span data-ttu-id="82a24-121">ただし、各コンピューターの SID は同じであるため、この問題はドメイン アカウントでは発生しません。</span><span class="sxs-lookup"><span data-stu-id="82a24-121">However, this problem does not occur for domain accounts because the SID is the same on each of the computers.</span></span>  
  
 <span data-ttu-id="82a24-122">詳細については、「 [Orphaned Users with Database Mirroring and Log Shipping](https://blogs.msdn.com/b/sqlserverfaq/archive/2009/04/13/orphaned-users-with-database-mirroring-and-log-shipping.aspx) 」(データベース ミラーリングとログ配布での孤立ユーザー) (データベース エンジンのブログ) を参照してください。</span><span class="sxs-lookup"><span data-stu-id="82a24-122">For more information, see [Orphaned Users with Database Mirroring and Log Shipping](https://blogs.msdn.com/b/sqlserverfaq/archive/2009/04/13/orphaned-users-with-database-mirroring-and-log-shipping.aspx) (a Database Engine blog).</span></span>  
  
## <a name="jobs"></a><span data-ttu-id="82a24-123">ジョブ</span><span class="sxs-lookup"><span data-stu-id="82a24-123">Jobs</span></span>  
 <span data-ttu-id="82a24-124">バックアップ ジョブなどのジョブでは、特別な考慮が必要になります。</span><span class="sxs-lookup"><span data-stu-id="82a24-124">Jobs, such as backup jobs, require special consideration.</span></span> <span data-ttu-id="82a24-125">通常は、役割の交代後、データベース所有者またはシステム管理者が、新しいプライマリ/プリンシパル データベース用にジョブを再作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="82a24-125">Typically, after a role switch, the database owner or system administrator must re-create the jobs for the new primary/principal database.</span></span>  
  
 <span data-ttu-id="82a24-126">元のプライマリ/プリンシパル サーバー インスタンスが使用できる場合は、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]のそのインスタンスで元のジョブを削除する必要があります。</span><span class="sxs-lookup"><span data-stu-id="82a24-126">When the former primary/principal server instance is available, you should delete the original jobs on that instanceof [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="82a24-127">現在のミラー データベースのジョブは RESTORING 状態であるため失敗し、使用できなくなります。</span><span class="sxs-lookup"><span data-stu-id="82a24-127">Note that jobs on the current mirror database fail because it is in the RESTORING state, making it unavailable.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="82a24-128">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] の複数のインスタンスを、別のドライブ文字などを使用して別に構成できます。</span><span class="sxs-lookup"><span data-stu-id="82a24-128">Different instances of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] might be configured differently, with different drive letters or such.</span></span> <span data-ttu-id="82a24-129">パートナーごとのジョブは、このような違いを考慮する必要があります。</span><span class="sxs-lookup"><span data-stu-id="82a24-129">The jobs for each partner must allow for any such differences.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="82a24-130">参照</span><span class="sxs-lookup"><span data-stu-id="82a24-130">See Also</span></span>  
 <span data-ttu-id="82a24-131">[データベースを別のサーバー インスタンスで使用できるようにするときのメタデータの管理 &#40;SQL Server&#41;](../../relational-databases/databases/manage-metadata-when-making-a-database-available-on-another-server.md) </span><span class="sxs-lookup"><span data-stu-id="82a24-131">[Manage Metadata When Making a Database Available on Another Server Instance &#40;SQL Server&#41;](../../relational-databases/databases/manage-metadata-when-making-a-database-available-on-another-server.md) </span></span>  
 [<span data-ttu-id="82a24-132">孤立ユーザーのトラブルシューティング &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="82a24-132">Troubleshoot Orphaned Users &#40;SQL Server&#41;</span></span>](troubleshoot-orphaned-users-sql-server.md)  
  
  
