---
title: Always On フェールオーバー クラスター インスタンス (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- clustering [SQL Server]
- high availability [SQL Server], failover clustering
- virtual servers [SQL Server], about virtual servers
- clusters [SQL Server]
- servers [SQL Server], failover clustering
- resource groups [SQL Server]
- availability [SQL Server]
- failover clustering [SQL Server]
- AlwaysOn [SQL Server], see failover clustering [SQL Server]
ms.assetid: 86a15b33-4d03-4549-8ea2-b45e4f1baad7
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 6adc173560fd83d00616eb00c63651ef667c2a00
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87640538"
---
# <a name="always-on-failover-cluster-instances-sql-server"></a><span data-ttu-id="d8e77-102">Always On フェールオーバー クラスター インスタンス (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="d8e77-102">Always On Failover Cluster Instances (SQL Server)</span></span>
  <span data-ttu-id="d8e77-103">Always On オファリングの一部として [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 、Always On フェールオーバークラスターインスタンスは、Windows Server フェールオーバークラスタリング (WSFC) の機能を利用して、サーバーインスタンスレベル (*フェールオーバークラスターインスタンス*(fci)) での冗長性によるローカル高可用性を実現します。</span><span class="sxs-lookup"><span data-stu-id="d8e77-103">As part of the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Always On offering, Always On Failover Cluster Instances leverages Windows Server Failover Clustering (WSFC) functionality to provide local high availability through redundancy at the server-instance level-a *failover cluster instance* (FCI).</span></span> <span data-ttu-id="d8e77-104">FCI は、Windows Server フェールオーバー クラスタリング (WSFC) ノード全体、場合によっては複数のサブネットにインストールされる [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] の単一インスタンスです。</span><span class="sxs-lookup"><span data-stu-id="d8e77-104">An FCI is a single instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] that is installed across Windows Server Failover Clustering (WSFC) nodes and, possibly, across multiple subnets.</span></span> <span data-ttu-id="d8e77-105">FCI は、ネットワーク上では 1 台のコンピューターで実行されている [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] のインスタンスのように見えますが、現在のノードが使用できなくなった場合には、1 つの WSFC ノードから別の WSFC ノードにフェールオーバーする機能を備えています。</span><span class="sxs-lookup"><span data-stu-id="d8e77-105">On the network, an FCI appears to be an instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] running on a single computer, but the FCI provides failover from one WSFC node to another if the current node becomes unavailable.</span></span>  
  
 <span data-ttu-id="d8e77-106">FCI は、[AlwaysOn 可用性グループ](../../../database-engine/availability-groups/windows/always-on-availability-groups-sql-server.md)を活用して、データベース レベルでのリモートのディザスター リカバリーを実現します。</span><span class="sxs-lookup"><span data-stu-id="d8e77-106">An FCI can leverage [Always On Availability Groups](../../../database-engine/availability-groups/windows/always-on-availability-groups-sql-server.md)to provide remote disaster recovery at the database level.</span></span> <span data-ttu-id="d8e77-107">詳細については、「[フェールオーバー クラスタリングと AlwaysOn 可用性グループ (SQL Server)](../../../database-engine/availability-groups/windows/failover-clustering-and-always-on-availability-groups-sql-server.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="d8e77-107">For more information, see [Failover Clustering and Always On Availability Groups (;SQL Server);](../../../database-engine/availability-groups/windows/failover-clustering-and-always-on-availability-groups-sql-server.md).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="d8e77-108">[!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)] 以降では、Always On フェールオーバー クラスター インスタンスは、[!INCLUDE[winserver2008r2](../../../includes/winserver2008r2-md.md)] と [!INCLUDE[win8srv](../../../includes/win8srv-md.md)] の両方でクラスター化ボリューム (CSV) をサポートしています。</span><span class="sxs-lookup"><span data-stu-id="d8e77-108">Beginning in [!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)], Always On Failover Cluster Instances supports Clustered Shared Volumes (CSV) in both [!INCLUDE[winserver2008r2](../../../includes/winserver2008r2-md.md)] and [!INCLUDE[win8srv](../../../includes/win8srv-md.md)].</span></span> <span data-ttu-id="d8e77-109">CSV の詳細については、「 [フェールオーバー クラスターのクラスターの共有ボリュームについて](https://technet.microsoft.com/library/dd759255.aspx)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="d8e77-109">For more information on CSV, see [Understanding Cluster Shared Volumes in a Failover Cluster](https://technet.microsoft.com/library/dd759255.aspx).</span></span>  
  
 <span data-ttu-id="d8e77-110">**このトピックの内容**</span><span class="sxs-lookup"><span data-stu-id="d8e77-110">**In this Topic:**</span></span>  
  
-   [<span data-ttu-id="d8e77-111">メリット</span><span class="sxs-lookup"><span data-stu-id="d8e77-111">Benefits</span></span>](#Benefits)  
  
-   [<span data-ttu-id="d8e77-112">Recommendations (推奨事項)</span><span class="sxs-lookup"><span data-stu-id="d8e77-112">Recommendations</span></span>](#Recommendations)  
  
-   [<span data-ttu-id="d8e77-113">フェールオーバー クラスター インスタンスの概要</span><span class="sxs-lookup"><span data-stu-id="d8e77-113">Failover Cluster Instance Overview</span></span>](#Overview)  
  
-   [<span data-ttu-id="d8e77-114">フェールオーバー クラスター インスタンスの構成要素</span><span class="sxs-lookup"><span data-stu-id="d8e77-114">Elements of a Failover Cluster Instance</span></span>](#FCIelements)  
  
-   [<span data-ttu-id="d8e77-115">SQL Server フェールオーバーの概念とタスク</span><span class="sxs-lookup"><span data-stu-id="d8e77-115">SQL Server Failover Concepts and Tasks</span></span>](#ConceptsAndTasks)  
  
-   [<span data-ttu-id="d8e77-116">関連トピック</span><span class="sxs-lookup"><span data-stu-id="d8e77-116">Related Topics</span></span>](#RelatedTopics)  
  
##  <a name="benefits-of-a-failover-cluster-instance"></a><a name="Benefits"></a> <span data-ttu-id="d8e77-117">フェールオーバー クラスター インスタンスの利点</span><span class="sxs-lookup"><span data-stu-id="d8e77-117">Benefits of a Failover Cluster Instance</span></span>  
 <span data-ttu-id="d8e77-118">サーバーのハードウェアまたはソフトウェアに障害が発生すると、そのサーバーに接続しているアプリケーションまたはクライアントで、ダウンタイムが発生します。</span><span class="sxs-lookup"><span data-stu-id="d8e77-118">When there is hardware or software failure of a server, the applications or clients connecting to the server will experience downtime.</span></span> <span data-ttu-id="d8e77-119">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] インスタンスが (スタンドアロン インスタンスではなく) FCI として構成されている場合、その [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] インスタンスの高可用性は、FCI の冗長ノードの存在によって保護されます。</span><span class="sxs-lookup"><span data-stu-id="d8e77-119">When a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance is configured to be an FCI (instead of a standalone instance), the high availability of that [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance is protected by the presence of redundant nodes in the FCI.</span></span> <span data-ttu-id="d8e77-120">一度に FCI 内のノードの 1 つだけが WSFC リソース グループを所有します。</span><span class="sxs-lookup"><span data-stu-id="d8e77-120">Only one of the nodes in the FCI owns the WSFC resource group at a time.</span></span> <span data-ttu-id="d8e77-121">障害 (ハードウェア、オペレーティング システム、アプリケーション、サービスなどの障害) が発生した場合や計画していたアップグレードが行われる場合は、リソース グループの所有権が別の WSFC ノードに移動します。</span><span class="sxs-lookup"><span data-stu-id="d8e77-121">In case of a failure (hardware failures, operating system failures, application or service failures), or a planned upgrade, the resource group ownership is moved to another WSFC node.</span></span> <span data-ttu-id="d8e77-122">この処理は、 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] に接続しているクライアントまたはアプリケーションに認識されることなく実行され、これによって障害発生中のアプリケーションおよびクライアントのダウンタイムを最小限に抑えることができます。</span><span class="sxs-lookup"><span data-stu-id="d8e77-122">This process is transparent to the client or application connecting to [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] and this minimize the downtime the application or clients experience during a failure.</span></span> <span data-ttu-id="d8e77-123">次の一覧は、 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] フェールオーバー クラスター インスタンスの主な利点を示しています。</span><span class="sxs-lookup"><span data-stu-id="d8e77-123">The following lists some key benefits that [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] failover cluster instances provide:</span></span>  
  
-   <span data-ttu-id="d8e77-124">冗長性によるインスタンス レベルの保護</span><span class="sxs-lookup"><span data-stu-id="d8e77-124">Protection at the instance level through redundancy</span></span>  
  
-   <span data-ttu-id="d8e77-125">障害 (ハードウェア、オペレーティング システム、アプリケーション、サービスなどの障害) 発生時の自動フェールオーバー</span><span class="sxs-lookup"><span data-stu-id="d8e77-125">Automatic failover in the event of a failure (hardware failures, operating system failures, application or service failures)</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="d8e77-126">Always On 可用性グループでは、FCI から可用性グループ内の他のノードへの自動フェールオーバーはサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="d8e77-126">In an Always On availability group, automatic failover from an FCI to other nodes within the availability group is not supported.</span></span> <span data-ttu-id="d8e77-127">このため、自動フェールオーバーが高可用性ソリューションの重要なコンポーネントである場合は、FCI とスタンドアロン ノードを 1 つの可用性グループ内で組み合わせて使用することはできません。</span><span class="sxs-lookup"><span data-stu-id="d8e77-127">This means that FCIs and standalone nodes should not be coupled together within an availability group if automatic failover is an important component your high availability solution.</span></span> <span data-ttu-id="d8e77-128">ただし、*ディザスター リカバリー* ソリューションではこの組み合わせを使用できます。</span><span class="sxs-lookup"><span data-stu-id="d8e77-128">However, this coupling can be made for your *disaster recovery* solution.</span></span>  
  
-   <span data-ttu-id="d8e77-129">WSFC クラスター ディスク (iSCSI、ファイバー チャネルなど) やサーバー メッセージ ブロック (SMB) ファイル共有などのさまざまなストレージ ソリューションのサポート。</span><span class="sxs-lookup"><span data-stu-id="d8e77-129">Support for a broad array of storage solutions, including WSFC cluster disks (iSCSI, Fiber Channel, and so on) and server message block (SMB) file shares.</span></span>  
  
-   <span data-ttu-id="d8e77-130">マルチサブネット FCI を使用または FCI によってホストされるデータベースを Always On 可用性グループ内で実行している災害復旧ソリューション。</span><span class="sxs-lookup"><span data-stu-id="d8e77-130">Disaster recovery solution using a multi-subnet FCI or running an FCI-hosted database inside an Always On availability group.</span></span> <span data-ttu-id="d8e77-131">[!INCLUDE[msCoName](../../../includes/msconame-md.md)][!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)]の新しいマルチサブネット サポートでは、マルチサブネット FCI に仮想 LAN が不要になり、マルチサブネット FCI の管理性とセキュリティが向上します。</span><span class="sxs-lookup"><span data-stu-id="d8e77-131">With the new multi-subnet support in [!INCLUDE[msCoName](../../../includes/msconame-md.md)][!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)], a multi-subnet FCI no longer requires a virtual LAN, increasing the manageability and security of a multi-subnet FCI.</span></span>  
  
-   <span data-ttu-id="d8e77-132">フェールオーバー時にアプリケーションとクライアントの再構成が不要</span><span class="sxs-lookup"><span data-stu-id="d8e77-132">Zero reconfiguration of applications and clients during failovers</span></span>  
  
-   <span data-ttu-id="d8e77-133">自動フェールオーバーの詳細なトリガー イベント用の柔軟なフェールオーバー ポリシー</span><span class="sxs-lookup"><span data-stu-id="d8e77-133">Flexible failover policy for granular trigger events for automatic failovers</span></span>  
  
-   <span data-ttu-id="d8e77-134">専用接続および永続接続を使用した定期的および詳細な正常性状態の検出による信頼性の高いフェールオーバー</span><span class="sxs-lookup"><span data-stu-id="d8e77-134">Reliable failovers through periodic and detailed health detection using dedicated and persisted connections</span></span>  
  
-   <span data-ttu-id="d8e77-135">間接バックグラウンド チェックポイントによりフェールオーバー時に構成と予測が可能</span><span class="sxs-lookup"><span data-stu-id="d8e77-135">Configurability and predictability in failover time through indirect background checkpoints</span></span>  
  
-   <span data-ttu-id="d8e77-136">フェールオーバー時のリソース使用状況を調整</span><span class="sxs-lookup"><span data-stu-id="d8e77-136">Throttled resource usage during failovers</span></span>  
  
##  <a name="recommendations"></a><a name="Recommendations"></a> <span data-ttu-id="d8e77-137">推奨事項</span><span class="sxs-lookup"><span data-stu-id="d8e77-137">Recommendations</span></span>  
 <span data-ttu-id="d8e77-138">実稼働環境では、静的 IP アドレスをフェールオーバー クラスター インスタンスの仮想 IP アドレスと組み合わせて使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="d8e77-138">In a production environment, we recommend that you use static IP addresses in conjunction the virtual IP address of a Failover Cluster Instance.</span></span>  <span data-ttu-id="d8e77-139">実稼働環境で DHCP を使用することはお勧めしません。</span><span class="sxs-lookup"><span data-stu-id="d8e77-139">We recommend against using DHCP in a production environment.</span></span> <span data-ttu-id="d8e77-140">ダウンタイムが発生した場合に DHCP の IP リース期限が切れると、DNS 名に関連付けられている新しい DHCP IP アドレスの再登録に余分な時間がかかります。</span><span class="sxs-lookup"><span data-stu-id="d8e77-140">In the event of down time, if the DHCP IP lease expires, extra time is required to re-register the new DHCP IP address associated with the DNS name.</span></span>  
  
##  <a name="failover-cluster-instance-overview"></a><a name="Overview"></a><span data-ttu-id="d8e77-141">フェールオーバークラスターインスタンスの概要</span><span class="sxs-lookup"><span data-stu-id="d8e77-141">Failover Cluster Instance Overview</span></span>  
 <span data-ttu-id="d8e77-142">FCI は、1 つ以上の WSFC ノードのある WSFC リソース グループで実行します。</span><span class="sxs-lookup"><span data-stu-id="d8e77-142">An FCI runs in a WSFC resource group with one or more WSFC nodes.</span></span> <span data-ttu-id="d8e77-143">FCI が起動すると、ノードの 1 つがリソース グループの所有権を引き受け、その [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] インスタンスをオンラインにします。</span><span class="sxs-lookup"><span data-stu-id="d8e77-143">When the FCI starts up, one of the nodes assume ownership of the resource group and brings its [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance online.</span></span> <span data-ttu-id="d8e77-144">このノードが所有するリソースは次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="d8e77-144">The resources owned by this node include:</span></span>  
  
-   <span data-ttu-id="d8e77-145">ネットワーク名</span><span class="sxs-lookup"><span data-stu-id="d8e77-145">Network name</span></span>  
  
-   <span data-ttu-id="d8e77-146">IP アドレス</span><span class="sxs-lookup"><span data-stu-id="d8e77-146">IP address</span></span>  
  
-   <span data-ttu-id="d8e77-147">共有ディスク</span><span class="sxs-lookup"><span data-stu-id="d8e77-147">Shared disks</span></span>  
  
-   [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="d8e77-148">データベース エンジン サービス</span><span class="sxs-lookup"><span data-stu-id="d8e77-148">Database Engine service</span></span>  
  
-   [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="d8e77-149">エージェント サービス</span><span class="sxs-lookup"><span data-stu-id="d8e77-149">Agent service</span></span>  
  
-   [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="d8e77-150">Analysis Service サービス (インストールされている場合)</span><span class="sxs-lookup"><span data-stu-id="d8e77-150">Analysis Services service, if installed</span></span>  
  
-   <span data-ttu-id="d8e77-151">1 つのファイル共有リソース (FILESTREAM 機能がインストールされている場合)</span><span class="sxs-lookup"><span data-stu-id="d8e77-151">One file share resource, if the FILESTREAM feature is installed</span></span>  
  
 <span data-ttu-id="d8e77-152">任意の時点で、リソース グループ所有者だけがリソース グループ内のそれぞれの [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] サービスを実行しています (FCI の他のノードでは実行されません)。</span><span class="sxs-lookup"><span data-stu-id="d8e77-152">At any time, only the resource group owner (and no other node in the FCI) is running its respective [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] services in the resource group.</span></span> <span data-ttu-id="d8e77-153">フェールオーバーが発生すると、それが自動フェールオーバーと計画的フェールオーバーのいずれであるかにかかわらず、次の一連のイベントが発生します。</span><span class="sxs-lookup"><span data-stu-id="d8e77-153">When a failover occurs, whether it be an automatic failover or a planned failover, the following sequence of events happen:</span></span>  
  
1.  <span data-ttu-id="d8e77-154">ハードウェアまたはシステムの障害が発生しない限り、バッファー キャッシュ内のすべてのダーティ ページがディスクに書き込まれます。</span><span class="sxs-lookup"><span data-stu-id="d8e77-154">Unless a hardware or system failure occurs, all dirty pages in the buffer cache are written to disk.</span></span>  
  
2.  <span data-ttu-id="d8e77-155">リソース グループ内のそれぞれの [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] サービスが、すべてアクティブ ノードで停止されます。</span><span class="sxs-lookup"><span data-stu-id="d8e77-155">All respective [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] services in the resource group are stopped on the active node.</span></span>  
  
3.  <span data-ttu-id="d8e77-156">リソース グループの所有権が FCI の別のノードに転送されます。</span><span class="sxs-lookup"><span data-stu-id="d8e77-156">The resource group ownership is transferred to another node in the FCI.</span></span>  
  
4.  <span data-ttu-id="d8e77-157">新しいリソース グループ所有者が [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] サービスを開始します。</span><span class="sxs-lookup"><span data-stu-id="d8e77-157">The new resource group owner starts its [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] services.</span></span>  
  
5.  <span data-ttu-id="d8e77-158">クライアント アプリケーション接続要求が、同じ仮想ネットワーク名 (VNN) を使用して新しいアクティブ ノードに自動的に送られます。</span><span class="sxs-lookup"><span data-stu-id="d8e77-158">Client application connection requests are automatically directed to the new active node using the same virtual network name (VNN).</span></span>  
  
 <span data-ttu-id="d8e77-159">FCI は、基になる WSFC クラスターが正常なクォーラム状態にある限りオンラインになります (クォーラム WSFC ノードの大半は、自動フェールオーバー ターゲットとして使用できます)。</span><span class="sxs-lookup"><span data-stu-id="d8e77-159">The FCI is online as long as its underlying WSFC cluster is in good quorum health (the majority of the quorum WSFC nodes are available as automatic failover targets).</span></span> <span data-ttu-id="d8e77-160">WSFC クラスターがクォーラムを失うと、その原因がハードウェア、ソフトウェア、ネットワーク障害であるか、不適切なクォーラム構成であるかにかかわらず、WSFC クラスター全体が FCI と共にオフラインになります。</span><span class="sxs-lookup"><span data-stu-id="d8e77-160">When the WSFC cluster loses its quorum, whether due to hardware, software, network failure, or improper quorum configuration, the entire WSFC cluster, along with the FCI, is brought offline.</span></span> <span data-ttu-id="d8e77-161">この予定外のフェールオーバー シナリオでは、WSFC クラスターと FCI をオンラインに戻すために、手動介入によって残りの使用可能ノードでクォーラムを再確立する必要があります。</span><span class="sxs-lookup"><span data-stu-id="d8e77-161">Manual intervention is then required in this unplanned failover scenario to reestablish quorum in the remaining available nodes in order to bring the WSFC cluster and FCI back online.</span></span> <span data-ttu-id="d8e77-162">詳細については、「 [WSFC クォーラムモードと投票の構成」 (「」を参照してください。SQL Server);](wsfc-quorum-modes-and-voting-configuration-sql-server.md)。</span><span class="sxs-lookup"><span data-stu-id="d8e77-162">For more information, see [WSFC Quorum Modes and Voting Configuration (;SQL Server);](wsfc-quorum-modes-and-voting-configuration-sql-server.md).</span></span>  
  
### <a name="predictable-failover-time"></a><span data-ttu-id="d8e77-163">予測可能なフェールオーバー時間</span><span class="sxs-lookup"><span data-stu-id="d8e77-163">Predictable Failover Time</span></span>  
 <span data-ttu-id="d8e77-164">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] インスタンスがチェックポイント操作を最後に行った時期によっては、バッファー キャッシュ内のダーティ ページが大量になることがあります。</span><span class="sxs-lookup"><span data-stu-id="d8e77-164">Depending on when your [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance last performed a checkpoint operation, there can be a substantial amount of dirty pages in the buffer cache.</span></span> <span data-ttu-id="d8e77-165">このため、フェールオーバーは、残りのダーティ ページをディスクに書き込むまで継続し、フェールオーバー時間が長く予測不能になる場合があります。</span><span class="sxs-lookup"><span data-stu-id="d8e77-165">Consequently, failovers last as long as it takes to write the remaining dirty pages to disk, which can lead to long and unpredictable failover time.</span></span> <span data-ttu-id="d8e77-166">[!INCLUDE[msCoName](../../../includes/msconame-md.md)][!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)]からは、FCI は間接チェックポイントを使用して、バッファー キャッシュに保持されるダーティ ページの量を調整します。</span><span class="sxs-lookup"><span data-stu-id="d8e77-166">Beginning with [!INCLUDE[msCoName](../../../includes/msconame-md.md)][!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)], the FCI can use indirect checkpoints to throttle the amount of dirty pages kept in the buffer cache.</span></span> <span data-ttu-id="d8e77-167">これにより、通常の作業負荷ではリソースの消費が増えますが、フェールオーバー時間の予測や構成が可能になります。</span><span class="sxs-lookup"><span data-stu-id="d8e77-167">While this does consume additional resources under regular workload, it makes the failover time more predictable as well as more configurable.</span></span> <span data-ttu-id="d8e77-168">これは、組織内のサービス レベル契約で、高可用性ソリューションの目標復旧時間 (RTO) を指定する場合に非常に役立ちます。</span><span class="sxs-lookup"><span data-stu-id="d8e77-168">This is very useful when the service-level agreement in your organization specifies the recovery time objective (RTO) for your high availability solution.</span></span> <span data-ttu-id="d8e77-169">間接的なチェックポイントの詳細については、「 [Indirect Checkpoints](../../../relational-databases/logs/database-checkpoints-sql-server.md#IndirectChkpt)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="d8e77-169">For more information on indirect checkpoints, see [Indirect Checkpoints](../../../relational-databases/logs/database-checkpoints-sql-server.md#IndirectChkpt).</span></span>  
  
### <a name="reliable-health-monitoring-and-flexible-failover-policy"></a><span data-ttu-id="d8e77-170">信頼性の高い正常性監視と柔軟なフェールオーバー ポリシー</span><span class="sxs-lookup"><span data-stu-id="d8e77-170">Reliable Health Monitoring and Flexible Failover Policy</span></span>  
 <span data-ttu-id="d8e77-171">FCI が正常に開始した後で、WSFC サービスは基になる WSFC クラスターの正常性と [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] インスタンスの正常性の両方を監視します。</span><span class="sxs-lookup"><span data-stu-id="d8e77-171">After the FCI starts successfully, the WSFC service monitors both the health of the underlying WSFC cluster, as well as the health of the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance.</span></span> <span data-ttu-id="d8e77-172">[!INCLUDE[msCoName](../../../includes/msconame-md.md)][!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)]からは、WSFC サービスは専用接続を使用して、アクティブな [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] インスタンスにシステム ストアド プロシージャを通じて詳細コンポーネント診断をポーリングします。</span><span class="sxs-lookup"><span data-stu-id="d8e77-172">Beginning with [!INCLUDE[msCoName](../../../includes/msconame-md.md)][!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)], the WSFC service uses a dedicated connection to poll the active [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance for detailed component diagnostics through a system stored procedure.</span></span> <span data-ttu-id="d8e77-173">これには 3 つの影響があります。</span><span class="sxs-lookup"><span data-stu-id="d8e77-173">The implication of this is three-fold:</span></span>  
  
-   <span data-ttu-id="d8e77-174">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] インスタンスへの専用接続により、FCI が非常に高負荷の場合でも、コンポーネント診断を常に確実にポーリングできます。</span><span class="sxs-lookup"><span data-stu-id="d8e77-174">The dedicated connection to the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance makes it possible to reliably poll for component diagnostics all the time, even when the FCI is under heavy load.</span></span> <span data-ttu-id="d8e77-175">これにより、高負荷状態のシステムと、実際に障害条件が発生しているシステムを区別できるため、誤ったフェールオーバーなどの問題を回避できます。</span><span class="sxs-lookup"><span data-stu-id="d8e77-175">This makes it possible to distinguish between a system that is under heavy load and a system that actually has failure conditions, thus preventing issues such as false failovers.</span></span>  
  
-   <span data-ttu-id="d8e77-176">詳細コンポーネント診断により、より柔軟なフェールオーバー ポリシーを構成できるため、フェールオーバーをトリガーする障害条件とトリガーしない障害条件を選択できます。</span><span class="sxs-lookup"><span data-stu-id="d8e77-176">The detailed component diagnostics makes it possible to configure a more flexible failover policy, whereby you can choose what failure conditions trigger failovers and which failure conditions do not.</span></span>  
  
-   <span data-ttu-id="d8e77-177">詳細コンポーネント診断により、自動フェールオーバーをさかのぼってトラブルシューティングすることもできます。</span><span class="sxs-lookup"><span data-stu-id="d8e77-177">The detailed component diagnostics also enables better troubleshooting of automatic failovers retroactively.</span></span> <span data-ttu-id="d8e77-178">診断情報がログ ファイルに格納され、 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] エラー ログと併置されます。</span><span class="sxs-lookup"><span data-stu-id="d8e77-178">The diagnostic information is stored to log files, which are collocated with the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] error logs.</span></span> <span data-ttu-id="d8e77-179">これらをログ ファイル ビューアーに読み込んで、そのフェールオーバーの原因を判断するためにフェールオーバーの発生までのコンポーネント状態を調査できます。</span><span class="sxs-lookup"><span data-stu-id="d8e77-179">You can load them into the Log File Viewer to inspect the component states leading up to the failover occurrence in order to determine what cause that failover.</span></span>  
  
 <span data-ttu-id="d8e77-180">詳細については、「[フェールオーバークラスターインスタンスのフェールオーバーポリシー](failover-policy-for-failover-cluster-instances.md) 」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="d8e77-180">For more information, see [Failover Policy for Failover Cluster Instances](failover-policy-for-failover-cluster-instances.md)</span></span>  
  
##  <a name="elements-of-a-failover-cluster-instance"></a><a name="FCIelements"></a><span data-ttu-id="d8e77-181">フェールオーバークラスターインスタンスの要素</span><span class="sxs-lookup"><span data-stu-id="d8e77-181">Elements of a Failover Cluster Instance</span></span>  
 <span data-ttu-id="d8e77-182">FCI は、類似するハードウェア構成と同一のソフトウェア構成 (オペレーティング システムのバージョンとパッチ レベル、および [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] のバージョン、パッチ レベル、コンポーネント、インスタンス名など) を含む物理サーバー (ノード) のセットから構成されます。</span><span class="sxs-lookup"><span data-stu-id="d8e77-182">An FCI consists of a set of physical servers (nodes) that contain similar hardware configuration as well as identical software configuration that includes operating system version and patch level, and [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] version, patch level, components, and instance name.</span></span> <span data-ttu-id="d8e77-183">同一のソフトウェア構成は、ノード間でフェールオーバーする際に FCI が完全に機能できるようにするために必要です。</span><span class="sxs-lookup"><span data-stu-id="d8e77-183">Identical software configuration is necessary to ensure that the FCI can be fully functional as it fails over between the nodes.</span></span>  
  
 <span data-ttu-id="d8e77-184">WSFC リソース グループ</span><span class="sxs-lookup"><span data-stu-id="d8e77-184">WSFC Resource Group</span></span>  
 <span data-ttu-id="d8e77-185">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] FCI は、WSFC リソース グループで実行されます。</span><span class="sxs-lookup"><span data-stu-id="d8e77-185">A [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] FCI runs in a WSFC resource group.</span></span> <span data-ttu-id="d8e77-186">リソース グループ内の各ノードは、構成設定の同期されたコピーおよびチェックポイントが設定されたレジストリ キーを保持して、フェールオーバー後に FCI が完全に機能し、一度にクラスター内の 1 つのノード (アクティブ ノード) だけがリソース グループを所有するようにします。</span><span class="sxs-lookup"><span data-stu-id="d8e77-186">Each node in the resource group maintains a synchronized copy of the configuration settings and check-pointed registry keys to ensure full functionality of the FCI after a failover, and only one of the nodes in the cluster owns the resource group at a time (the active node).</span></span> <span data-ttu-id="d8e77-187">WSFC サービスは、サーバー クラスター、クォーラム構成、フェールオーバー ポリシー、およびフェールオーバー操作に加え、FCI の VNN および仮想 IP アドレスを管理します。</span><span class="sxs-lookup"><span data-stu-id="d8e77-187">The WSFC service manages the server cluster, quorum configuration, failover policy, and failover operations, as well as the VNN and virtual IP addresses for the FCI.</span></span> <span data-ttu-id="d8e77-188">障害 (ハードウェア、オペレーティング システム、アプリケーション、サービスなどの障害) が発生した場合や計画していたアップグレードが行われる場合は、リソース グループの所有権が FCI 内の別のノードに移動します。WSFC リソース グループでサポートされるノード数は、 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] エディションによって決まります。</span><span class="sxs-lookup"><span data-stu-id="d8e77-188">In case of a failure (hardware failures, operating system failures, application or service failures) or a planned upgrade, the resource group ownership is moved to another node in the FCI.The number of nodes that are supported in a WSFC resource group depends on your [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] edition.</span></span> <span data-ttu-id="d8e77-189">また、CPU、メモリ、ディスク数などのハードウェア容量に応じて、同じ WSFC クラスターが複数の FCI (複数のリソース グループ) を実行できます。</span><span class="sxs-lookup"><span data-stu-id="d8e77-189">Also, the same WSFC cluster can run multiple FCIs (multiple resource groups), depending on your hardware capacity, such as CPUs, memory, and number of disks.</span></span>  
  
 <span data-ttu-id="d8e77-190">SQL Server バイナリ</span><span class="sxs-lookup"><span data-stu-id="d8e77-190">SQL Server Binaries</span></span>  
 <span data-ttu-id="d8e77-191">製品バイナリは FCI の各ノードにローカルにインストールされます。これは、 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] スタンドアロン インストールと同様のプロセスです。</span><span class="sxs-lookup"><span data-stu-id="d8e77-191">The product binaries are installed locally on each node of the FCI, a process similar to [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] stand-alone installations.</span></span> <span data-ttu-id="d8e77-192">ただし、スタートアップ時にサービスが自動的に開始されることはなく、WSFC によって管理されます。</span><span class="sxs-lookup"><span data-stu-id="d8e77-192">However, during startup, the services are not started automatically, but managed by WSFC.</span></span>  
  
 <span data-ttu-id="d8e77-193">ストレージ</span><span class="sxs-lookup"><span data-stu-id="d8e77-193">Storage</span></span>  
 <span data-ttu-id="d8e77-194">Always On 可用性グループとは対照的に、FCI は FCI のすべてのノード間でデータベースとログの格納に共有ストレージを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="d8e77-194">Contrary to the Always On availability group, an FCI must use shared storage between all nodes of the FCI for database and log storage.</span></span> <span data-ttu-id="d8e77-195">共有ストレージは、WSFC クラスター ディスク、SAN 上のディスク、または SMB 上のファイル共有の形式にすることができます。</span><span class="sxs-lookup"><span data-stu-id="d8e77-195">The shared storage can be in the form of WSFC cluster disks, disks on a SAN, or file shares on an SMB.</span></span> <span data-ttu-id="d8e77-196">このようにして、フェールオーバーの発生時に、FCI のすべてのノードがインスタンス データについて同じビューを持ちます。</span><span class="sxs-lookup"><span data-stu-id="d8e77-196">This way, all nodes in the FCI have the same view of instance data whenever a failover occurs.</span></span> <span data-ttu-id="d8e77-197">ただし、これは共有ストレージに単一障害点が生じる可能性があり、FCI が基になるストレージ ソリューションに依存してデータ保護を行うことを意味します。</span><span class="sxs-lookup"><span data-stu-id="d8e77-197">This does mean, however, that the shared storage has the potential of being the single point of failure, and FCI depends on the underlying storage solution to ensure data protection.</span></span>  
  
 <span data-ttu-id="d8e77-198">ネットワーク名</span><span class="sxs-lookup"><span data-stu-id="d8e77-198">Network Name</span></span>  
 <span data-ttu-id="d8e77-199">FCI の VNN は、FCI に統一された接続ポイントを提供します。</span><span class="sxs-lookup"><span data-stu-id="d8e77-199">The VNN for the FCI provides a unified connection point for the FCI.</span></span> <span data-ttu-id="d8e77-200">これにより、アプリケーションは、現在アクティブなノードを知らなくても VNN に接続できます。</span><span class="sxs-lookup"><span data-stu-id="d8e77-200">This allows applications to connect to the VNN without the need to know the currently active node.</span></span> <span data-ttu-id="d8e77-201">フェールオーバーが発生した場合、VNN は開始後に新しいアクティブ ノードに登録されます。</span><span class="sxs-lookup"><span data-stu-id="d8e77-201">When a failover occurs, the VNN is registered to the new active node after it starts.</span></span> <span data-ttu-id="d8e77-202">この処理は、 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] に接続しているクライアントまたはアプリケーションに認識されることなく実行され、これによって障害発生中のアプリケーションおよびクライアントのダウンタイムを最小限に抑えることができます。</span><span class="sxs-lookup"><span data-stu-id="d8e77-202">This process is transparent to the client or application connecting to [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] and this minimize the downtime the application or clients experience during a failure.</span></span>  
  
 <span data-ttu-id="d8e77-203">仮想 IP</span><span class="sxs-lookup"><span data-stu-id="d8e77-203">Virtual IPs</span></span>  
 <span data-ttu-id="d8e77-204">マルチサブネット FCI の場合、FCI の各サブネットに仮想 IP アドレスが割り当てられます。</span><span class="sxs-lookup"><span data-stu-id="d8e77-204">In the case of a multi-subnet FCI, a virtual IP address is assigned to each subnet in the FCI.</span></span> <span data-ttu-id="d8e77-205">フェールオーバー時に、DNS サーバー上の VNN は、それぞれのサブネットの仮想 IP アドレスを指すように更新されます。</span><span class="sxs-lookup"><span data-stu-id="d8e77-205">During a failover, the VNN on the DNS server is updated to point to the virtual IP address for the respective subnet.</span></span> <span data-ttu-id="d8e77-206">アプリケーションとクライアントは、マルチサブネット フェールオーバー後に同じ VNN を使用して FCI に接続できます。</span><span class="sxs-lookup"><span data-stu-id="d8e77-206">Applications and clients can then connect to the FCI using the same VNN after a multi-subnet failover.</span></span>  
  
##  <a name="sql-server-failover-concepts-and-tasks"></a><a name="ConceptsAndTasks"></a> <span data-ttu-id="d8e77-207">SQL Server フェールオーバーの概念とタスク</span><span class="sxs-lookup"><span data-stu-id="d8e77-207">SQL Server Failover Concepts and Tasks</span></span>  
  
|<span data-ttu-id="d8e77-208">概念とタスク</span><span class="sxs-lookup"><span data-stu-id="d8e77-208">Concepts and Tasks</span></span>|<span data-ttu-id="d8e77-209">トピック</span><span class="sxs-lookup"><span data-stu-id="d8e77-209">Topic</span></span>|  
|------------------------|-----------|  
|<span data-ttu-id="d8e77-210">障害検出メカニズムと柔軟なフェールオーバー ポリシーについて説明します。</span><span class="sxs-lookup"><span data-stu-id="d8e77-210">Describes the failure detection mechanism and the flexible failover policy.</span></span>|[<span data-ttu-id="d8e77-211">Failover Policy for Failover Cluster Instances</span><span class="sxs-lookup"><span data-stu-id="d8e77-211">Failover Policy for Failover Cluster Instances</span></span>](failover-policy-for-failover-cluster-instances.md)|  
|<span data-ttu-id="d8e77-212">FCI の管理とメンテナンスの概念について説明します。</span><span class="sxs-lookup"><span data-stu-id="d8e77-212">Describes concepts in FCI administration and maintenance.</span></span>|[<span data-ttu-id="d8e77-213">フェールオーバー クラスター インスタンスの管理とメンテナンス</span><span class="sxs-lookup"><span data-stu-id="d8e77-213">Failover Cluster Instance Administration and Maintenance</span></span>](failover-cluster-instance-administration-and-maintenance.md)|  
|<span data-ttu-id="d8e77-214">マルチサブネットの構成と概念について説明します。</span><span class="sxs-lookup"><span data-stu-id="d8e77-214">Describes multi-subnet configuration and concepts</span></span>|[<span data-ttu-id="d8e77-215">SQL Server マルチサブネットクラスタリング (;SQL Server);</span><span class="sxs-lookup"><span data-stu-id="d8e77-215">SQL Server Multi-Subnet Clustering (;SQL Server);</span></span>](sql-server-multi-subnet-clustering-sql-server.md)|  
  
##  <a name="related-topics"></a><a name="RelatedTopics"></a><span data-ttu-id="d8e77-216">関連項目</span><span class="sxs-lookup"><span data-stu-id="d8e77-216">Related Topics</span></span>  
  
|<span data-ttu-id="d8e77-217">**トピックの説明**</span><span class="sxs-lookup"><span data-stu-id="d8e77-217">**Topic descriptions**</span></span>|<span data-ttu-id="d8e77-218">**トピック**</span><span class="sxs-lookup"><span data-stu-id="d8e77-218">**Topic**</span></span>|  
|----------------------------|---------------|  
|<span data-ttu-id="d8e77-219">新しい [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] FCI のインストール方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="d8e77-219">Describes how to install a new [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] FCI.</span></span>|[<span data-ttu-id="d8e77-220">新しい SQL Server フェールオーバークラスターを作成します (;セットアップ);</span><span class="sxs-lookup"><span data-stu-id="d8e77-220">Create a New SQL Server Failover Cluster (;Setup);</span></span>](../install/create-a-new-sql-server-failover-cluster-setup.md)|  
|<span data-ttu-id="d8e77-221">[!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] フェールオーバー クラスターにアップグレードする方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="d8e77-221">Describes how to upgrade to a [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] failover cluster.</span></span>|[<span data-ttu-id="d8e77-222">SQL Server フェールオーバー クラスターのアップグレード</span><span class="sxs-lookup"><span data-stu-id="d8e77-222">Upgrade a SQL Server Failover Cluster</span></span>](upgrade-a-sql-server-failover-cluster-instance.md)|  
|<span data-ttu-id="d8e77-223">Windows フェールオーバー クラスタリングの概念について説明し、Windows フェールオーバー クラスタリングに関連するタスクへのリンクを示します。</span><span class="sxs-lookup"><span data-stu-id="d8e77-223">Describes Windows Failover Clustering Concepts and provides links to tasks related to Windows Failover Clustering</span></span>|[!INCLUDE[nextref_longhorn](../../../includes/nextref-longhorn-md.md)]<span data-ttu-id="d8e77-224">: [フェールオーバー クラスターの概要](https://go.microsoft.com/fwlink/?LinkId=177878)</span><span class="sxs-lookup"><span data-stu-id="d8e77-224">: [Overview of Failover Clusters](https://go.microsoft.com/fwlink/?LinkId=177878)</span></span><br /><br /> [!INCLUDE[nextref_longhorn](../../../includes/nextref-longhorn-md.md)] <span data-ttu-id="d8e77-225">R2: [フェールオーバー クラスターの概要](https://go.microsoft.com/fwlink/?LinkId=177879)</span><span class="sxs-lookup"><span data-stu-id="d8e77-225">R2: [Overview of Failover Clusters](https://go.microsoft.com/fwlink/?LinkId=177879)</span></span>|  
|<span data-ttu-id="d8e77-226">FCI 内のノードと可用性グループ内のレプリカの概念の違いと、FCI を使用して可用性グループのレプリカをホストする場合の考慮事項について説明します。</span><span class="sxs-lookup"><span data-stu-id="d8e77-226">Describes the distinctions in concepts between nodes in an FCI and replicas within an availability group and considerations for using an FCI to host a replica for an availability group.</span></span>|[<span data-ttu-id="d8e77-227">フェールオーバー クラスタリングと Always On 可用性グループ (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="d8e77-227">Failover Clustering and Always On Availability Groups (SQL Server)</span></span>](../../../database-engine/availability-groups/windows/failover-clustering-and-always-on-availability-groups-sql-server.md)|  
  
  
