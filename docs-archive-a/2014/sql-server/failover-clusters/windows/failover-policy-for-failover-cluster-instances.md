---
title: フェールオーバー クラスター インスタンスのフェールオーバー ポリシー | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- flexible failover policy
ms.assetid: 39ceaac5-42fa-4b5d-bfb6-54403d7f0dc9
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 8d441e5627280cb46168d9ff187d7f43da8b26a6
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87640527"
---
# <a name="failover-policy-for-failover-cluster-instances"></a><span data-ttu-id="278a6-102">Failover Policy for Failover Cluster Instances</span><span class="sxs-lookup"><span data-stu-id="278a6-102">Failover Policy for Failover Cluster Instances</span></span>
  <span data-ttu-id="278a6-103">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] フェールオーバー クラスター インスタンス (FCI) において、特定の時点で Windows Server フェールオーバー クラスター (WSFC) クラスター リソース グループを所有できるノードは 1 つだけです。</span><span class="sxs-lookup"><span data-stu-id="278a6-103">In a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] failover cluster instance (FCI), only one node can own the Windows Server Failover Cluster (WSFC) cluster resource group at a given time.</span></span> <span data-ttu-id="278a6-104">FCI のこのノードを通じて、クライアント要求が処理されます。</span><span class="sxs-lookup"><span data-stu-id="278a6-104">The client requests are served through this node in the FCI.</span></span> <span data-ttu-id="278a6-105">万一障害が発生した場合や再起動が失敗した場合、グループの所有権が、FCI 内の別の WSFC ノードに移ります。</span><span class="sxs-lookup"><span data-stu-id="278a6-105">In the case of a failure and an unsuccessful restart, the group ownership is moved to another WSFC node in the FCI.</span></span> <span data-ttu-id="278a6-106">この処理はフェールオーバーと呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="278a6-106">This process is called failover.</span></span> [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] <span data-ttu-id="278a6-107">では、障害検出の信頼性が向上し、柔軟なフェールオーバー ポリシーが提供されます。</span><span class="sxs-lookup"><span data-stu-id="278a6-107">increases the reliability of failure detection and provides a flexible failover policy.</span></span>  
  
 <span data-ttu-id="278a6-108">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] FCI は、基になる WSFC サービスにフェールオーバー検出を依存します。</span><span class="sxs-lookup"><span data-stu-id="278a6-108">A [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] FCI depends on the underlying WSFC service for failover detection.</span></span> <span data-ttu-id="278a6-109">したがって、FCI のフェールオーバー動作は、ネイティブ WSFC 機能と、 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] セットアップによって追加される機能の 2 つのメカニズムによって決定されます。</span><span class="sxs-lookup"><span data-stu-id="278a6-109">Therefore, two mechanisms determine the failover behavior for FCI: the former is native WSFC functionality, and the latter is functionality added by [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] setup.</span></span>  
  
-   <span data-ttu-id="278a6-110">WSFC クラスターはクォーラム構成を保持するため、自動フェールオーバーにおいて一意のフェールオーバー ターゲットが保証されます。</span><span class="sxs-lookup"><span data-stu-id="278a6-110">The WSFC cluster maintains the quorum configuration, which ensures a unique failover target in an automatic failover.</span></span> <span data-ttu-id="278a6-111">WSFC サービスは、クラスターが常に最適なクォーラム状態であるかどうかを判定したうえで、リソース グループをオンラインまたはオフラインにします。</span><span class="sxs-lookup"><span data-stu-id="278a6-111">The WSFC service determines whether the cluster is in optimal quorum health at all times and brings the resource group online and offline accordingly.</span></span>  
  
-   <span data-ttu-id="278a6-112">アクティブな [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] インスタンスは、専用接続を介して、コンポーネント診断のセットを WSFC リソース グループに定期的に報告します。</span><span class="sxs-lookup"><span data-stu-id="278a6-112">The active [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance periodically reports a set of component diagnostics to the WSFC resource group over a dedicated connection.</span></span> <span data-ttu-id="278a6-113">WSFC リソース グループは、再起動およびフェールオーバーをトリガーする障害条件を定義するフェールオーバー ポリシーを保持します。</span><span class="sxs-lookup"><span data-stu-id="278a6-113">The WSFC resource group maintains the failover policy, which defines the failure conditions that trigger restarts and failovers.</span></span>  
  
 <span data-ttu-id="278a6-114">このトピックでは、上記の 2 番目のメカニズムについて説明します。</span><span class="sxs-lookup"><span data-stu-id="278a6-114">This topic discusses the second mechanism above.</span></span> <span data-ttu-id="278a6-115">クォーラム構成および正常性状態の検出のための WSFC 動作の詳細については、「[WSFC クォーラム モードと投票の構成 &#40;SQL Server&#41;](wsfc-quorum-modes-and-voting-configuration-sql-server.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="278a6-115">For more information on the WSFC behavior for quorum configuration and health detection, see [WSFC Quorum Modes and Voting Configuration &#40;SQL Server&#41;](wsfc-quorum-modes-and-voting-configuration-sql-server.md).</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="278a6-116">FCI との間の自動フェールオーバーは AlwaysOn 可用性グループでは許可されません。</span><span class="sxs-lookup"><span data-stu-id="278a6-116">Automatic failovers to and from an FCI are not allowed in an AlwaysOn availability group.</span></span> <span data-ttu-id="278a6-117">ただし、FCI との間の手動フェールオーバーは AlwaysOn 可用性グループで許可されます。</span><span class="sxs-lookup"><span data-stu-id="278a6-117">However, manual failovers to and from and FCI are allowed in an AlwaysOn availability group.</span></span>  
  
##  <a name="failover-policy-overview"></a><a name="Concepts"></a> <span data-ttu-id="278a6-118">フェールオーバー ポリシーの概要</span><span class="sxs-lookup"><span data-stu-id="278a6-118">Failover Policy Overview</span></span>  
 <span data-ttu-id="278a6-119">フェールオーバー プロセスは、次の手順に分けることができます。</span><span class="sxs-lookup"><span data-stu-id="278a6-119">The failover process can be broken down into the following steps:</span></span>  
  
1.  [<span data-ttu-id="278a6-120">正常性状態の監視</span><span class="sxs-lookup"><span data-stu-id="278a6-120">Monitor the Health Status</span></span>](failover-policy-for-failover-cluster-instances.md#monitor)  
  
2.  [<span data-ttu-id="278a6-121">エラーの特定</span><span class="sxs-lookup"><span data-stu-id="278a6-121">Determining Failures</span></span>](failover-policy-for-failover-cluster-instances.md#determine)  
  
3.  [<span data-ttu-id="278a6-122">エラーへの対応</span><span class="sxs-lookup"><span data-stu-id="278a6-122">Responding to Failures</span></span>](failover-policy-for-failover-cluster-instances.md#respond)  
  
###  <a name="monitor-the-health-status"></a><a name="monitor"></a><span data-ttu-id="278a6-123">正常性状態の監視</span><span class="sxs-lookup"><span data-stu-id="278a6-123">Monitor the Health Status</span></span>  
 <span data-ttu-id="278a6-124">FCI に対して監視される正常性状態には、次の 3 種類があります。</span><span class="sxs-lookup"><span data-stu-id="278a6-124">There are three types of health statuses that are monitored for the FCI:</span></span>  
  
-   [<span data-ttu-id="278a6-125">SQL Server サービスの状態</span><span class="sxs-lookup"><span data-stu-id="278a6-125">State of the SQL Server service</span></span>](failover-policy-for-failover-cluster-instances.md#service)  
  
-   [<span data-ttu-id="278a6-126">SQL Server インスタンスの応答時間</span><span class="sxs-lookup"><span data-stu-id="278a6-126">Responsiveness of the SQL Server instance</span></span>](failover-policy-for-failover-cluster-instances.md#instance)  
  
-   [<span data-ttu-id="278a6-127">SQL Server コンポーネント診断</span><span class="sxs-lookup"><span data-stu-id="278a6-127">SQL Server component diagnostics</span></span>](failover-policy-for-failover-cluster-instances.md#component)  
  
####  <a name="state-of-the-sql-server-service"></a><a name="service"></a><span data-ttu-id="278a6-128">SQL Server サービスの状態</span><span class="sxs-lookup"><span data-stu-id="278a6-128">State of the SQL Server service</span></span>  
 <span data-ttu-id="278a6-129">WSFC サービスは、アクティブな FCI ノード上の SQL Server サービスの開始状態を監視して、SQL Server サービスの停止を検出します。</span><span class="sxs-lookup"><span data-stu-id="278a6-129">The WSFC service monitors the start state of the SQL Server service on the active FCI node to detect when the SQL Server service is stopped.</span></span>  
  
####  <a name="responsiveness-of-the-sql-server-instance"></a><a name="instance"></a><span data-ttu-id="278a6-130">SQL Server インスタンスの応答時間</span><span class="sxs-lookup"><span data-stu-id="278a6-130">Responsiveness of the SQL Server instance</span></span>  
 <span data-ttu-id="278a6-131">SQL Server の起動時、WSFC サービスは、SQL Server データベース エンジン リソース DLL を使用して、正常性状態の監視にのみ使用される新しい接続を別個のスレッド上に作成します。</span><span class="sxs-lookup"><span data-stu-id="278a6-131">During SQL Server startup, the WSFC service uses the SQL Server Database Engine resource DLL to create a new connection to on a separate thread that is used exclusively for monitoring the health status.</span></span> <span data-ttu-id="278a6-132">これにより、負荷があるときの正常性状態を SQL インスタンスがレポートするために必要なリソースが確保されます。</span><span class="sxs-lookup"><span data-stu-id="278a6-132">This ensures that there the SQL instance has the required resources to report its health status while under load.</span></span> <span data-ttu-id="278a6-133">この専用の接続を使用して、SQL Server は [sp_server_diagnostics &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-server-diagnostics-transact-sql) システム ストアド プロシージャを繰り返しモードで実行し、SQL Server コンポーネントの正常性状態をリソース DLL に定期的に報告します。</span><span class="sxs-lookup"><span data-stu-id="278a6-133">Using this dedicated connection, SQL Server runs the [sp_server_diagnostics &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-server-diagnostics-transact-sql) system stored procedure in repeat mode to periodically report the health status of the SQL Server components to the resource DLL.</span></span>  
  
 <span data-ttu-id="278a6-134">リソース DLL は、正常性チェックのタイムアウトを使用して SQL インスタンスの応答時間を判定します。</span><span class="sxs-lookup"><span data-stu-id="278a6-134">The resource DLL determines the responsiveness of the SQL instance using a health check timeout.</span></span> <span data-ttu-id="278a6-135">HealthCheckTimeout プロパティは、リソース DLL が sp_server_diagnostics ストアド プロシージャを待機する時間を定義します。この待機時間を経過すると、SQL インスタンスは応答不能と見なされ、その旨が WSFC サービスに報告されます。</span><span class="sxs-lookup"><span data-stu-id="278a6-135">The HealthCheckTimeout property defines how long the resource DLL should wait for the sp_server_diagnostics stored procedure before it reports the SQL instance as unresponsive to the WSFC service.</span></span> <span data-ttu-id="278a6-136">このプロパティは、フェールオーバー クラスター マネージャー スナップインに加え、T-SQL を使用して構成できます。</span><span class="sxs-lookup"><span data-stu-id="278a6-136">This property is configurable using T-SQL as well as in the Failover Cluster Manager snap-in.</span></span> <span data-ttu-id="278a6-137">詳細については、「 [HealthCheckTimeout プロパティ設定の構成](configure-healthchecktimeout-property-settings.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="278a6-137">For more information, see [Configure HealthCheckTimeout Property Settings](configure-healthchecktimeout-property-settings.md).</span></span> <span data-ttu-id="278a6-138">次に、このプロパティがタイムアウトに与える影響、およびリピート間隔設定について説明します。</span><span class="sxs-lookup"><span data-stu-id="278a6-138">The following items describe how this property affects timeout and repeat interval settings:</span></span>  
  
-   <span data-ttu-id="278a6-139">リソース DLL によって sp_server_diagnostics ストアド プロシージャが呼び出され、リピート間隔が HealthCheckTimeout 設定の 1/3 に設定されます。</span><span class="sxs-lookup"><span data-stu-id="278a6-139">The resource DLL calls the sp_server_diagnostics stored procedure and sets the repeat interval to one-third of the HealthCheckTimeout setting.</span></span>  
  
-   <span data-ttu-id="278a6-140">sp_server_diagnostics ストアド プロシージャの処理が遅いか、情報が返されない場合、リソース DDL は HealthCheckTimeout によって指定された時間待機した後、SQL インスタンスが応答していないことを WSFC サービスに通知します。</span><span class="sxs-lookup"><span data-stu-id="278a6-140">If the sp_server_diagnostics stored procedure is slow or is not returning information, the resource DLL will wait for the interval specified by HealthCheckTimeout before it reports to the WSFC service that the SQL instance is unresponsive.</span></span>  
  
-   <span data-ttu-id="278a6-141">専用の接続が失われた場合、リソース DLL は、HealthCheckTimeout によって指定された時間にわたって SQL インスタンスへの接続を再試行した後、SQL インスタンスが応答していないことを WSFC サービスに通知します。</span><span class="sxs-lookup"><span data-stu-id="278a6-141">If the dedicated connection is lost, the resource DLL will retry the connection to the SQL instance for the interval specified by HealthCheckTimeout before it reports to the WSFC service that the SQL instance is unresponsive.</span></span>  
  
####  <a name="sql-server-component-diagnostics"></a><a name="component"></a> <span data-ttu-id="278a6-142">SQL Server コンポーネント診断</span><span class="sxs-lookup"><span data-stu-id="278a6-142">SQL Server component diagnostics</span></span>  
 <span data-ttu-id="278a6-143">システム ストアド プロシージャ sp_server_diagnostics は、SQL インスタンスで定期的にコンポーネント診断を収集します。</span><span class="sxs-lookup"><span data-stu-id="278a6-143">The system stored procedure sp_server_diagnostics periodically collects component diagnostics on the SQL instance.</span></span> <span data-ttu-id="278a6-144">収集された診断情報は、次の各コンポーネント用の行として表され、呼び出し側スレッドに渡されます。</span><span class="sxs-lookup"><span data-stu-id="278a6-144">The diagnostic information that is collected is surfaced as a row for each of the following components and passed to the calling thread.</span></span>  
  
1.  <span data-ttu-id="278a6-145">システム</span><span class="sxs-lookup"><span data-stu-id="278a6-145">system</span></span>  
  
2.  <span data-ttu-id="278a6-146">resource</span><span class="sxs-lookup"><span data-stu-id="278a6-146">resource</span></span>  
  
3.  <span data-ttu-id="278a6-147">query process</span><span class="sxs-lookup"><span data-stu-id="278a6-147">query process</span></span>  
  
4.  <span data-ttu-id="278a6-148">io_subsystem</span><span class="sxs-lookup"><span data-stu-id="278a6-148">io_subsystem</span></span>  
  
5.  <span data-ttu-id="278a6-149">events</span><span class="sxs-lookup"><span data-stu-id="278a6-149">events</span></span>  
  
 <span data-ttu-id="278a6-150">system、resource、および query process コンポーネントはエラー検出に使用されます。</span><span class="sxs-lookup"><span data-stu-id="278a6-150">The system, resource, and query process components are used for failure detection.</span></span> <span data-ttu-id="278a6-151">io_subsytem および events コンポーネントは、診断目的でのみ使用されます。</span><span class="sxs-lookup"><span data-stu-id="278a6-151">The io_subsytem and events components are used for diagnostic purposes only.</span></span>  
  
 <span data-ttu-id="278a6-152">それぞれの情報の行セットは、SQL Server クラスター診断ログに書き込まれます。</span><span class="sxs-lookup"><span data-stu-id="278a6-152">Each rowset of information is also written to the SQL Server cluster diagnostics log.</span></span> <span data-ttu-id="278a6-153">詳細については、「 [フェールオーバー クラスター インスタンスの診断ログを表示して読む方法](view-and-read-failover-cluster-instance-diagnostics-log.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="278a6-153">For more information, see [View and Read Failover Cluster Instance Diagnostics Log](view-and-read-failover-cluster-instance-diagnostics-log.md).</span></span>  
  
> [!TIP]  
>  <span data-ttu-id="278a6-154">sp_server_diagnostic ストアド プロシージャは SQL Server AlwaysOn テクノロジによって使用されるほか、問題の検出とトラブルシューティングを行うために任意の SQL Server インスタンスで使用できます。</span><span class="sxs-lookup"><span data-stu-id="278a6-154">While the sp_server_diagnostic stored procedure is used by SQL Server AlwaysOn technology, it is available for use in any SQL Server instance to help detect and troubleshoot problems.</span></span>  
  
####  <a name="determining-failures"></a><a name="determine"></a> <span data-ttu-id="278a6-155">エラーの特定</span><span class="sxs-lookup"><span data-stu-id="278a6-155">Determining Failures</span></span>  
 <span data-ttu-id="278a6-156">SQL Server データベース エンジン リソース DLL は、FailureConditionLevel プロパティを使用して、検出された正常性状態がエラー条件に該当するかどうかを判定します。</span><span class="sxs-lookup"><span data-stu-id="278a6-156">The SQL Server Database Engine resource DLL determines whether the detected health status is a condition for failure using the FailureConditionLevel property.</span></span> <span data-ttu-id="278a6-157">FailureConditionLevel プロパティは、どの検出された正常性状態に基づいて再起動またはフェールオーバーを発生させるかを定義します。</span><span class="sxs-lookup"><span data-stu-id="278a6-157">The FailureConditionLevel property defines which detected health statuses cause restarts or failovers.</span></span> <span data-ttu-id="278a6-158">"自動フェールオーバーまたは再起動なし" から自動再起動またはフェールオーバーを発生させる可能性のあるあらゆるエラー条件に至るまで、複数レベルのオプションを使用できます。</span><span class="sxs-lookup"><span data-stu-id="278a6-158">Multiple levels of options are available, ranging from no automatic restart or failover to all possible failure conditions resulting in an automatic restart or failover.</span></span> <span data-ttu-id="278a6-159">このプロパティの構成方法については、「 [FailureConditionLevel プロパティ設定の構成](configure-failureconditionlevel-property-settings.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="278a6-159">For more information about how to configure this property, see [Configure FailureConditionLevel Property Settings](configure-failureconditionlevel-property-settings.md).</span></span>  
  
 <span data-ttu-id="278a6-160">エラー状態にはレベルが設定されています。</span><span class="sxs-lookup"><span data-stu-id="278a6-160">The failure conditions are set on an increasing scale.</span></span> <span data-ttu-id="278a6-161">レベル 1 ～ 5 の各レベルには、前のレベルのすべての状態に加えて独自の状態が含まれています。</span><span class="sxs-lookup"><span data-stu-id="278a6-161">For levels 1-5, each level includes all the conditions from the previous levels in addition to its own conditions.</span></span> <span data-ttu-id="278a6-162">これは、それぞれのレベルで、フェールオーバーまたは再起動の可能性が増加することを意味します。</span><span class="sxs-lookup"><span data-stu-id="278a6-162">This means that with each level, there is an increased probability of a failover or restart.</span></span> <span data-ttu-id="278a6-163">次の表では、エラー状態のレベルについて説明しています。</span><span class="sxs-lookup"><span data-stu-id="278a6-163">The failure condition levels are described in the following table.</span></span>  
  
 <span data-ttu-id="278a6-164">「[sp_server_diagnostics &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-server-diagnostics-transact-sql)」を確認してください。このシステム ストアド プロシージャは、エラー条件レベルで重要な役割を果たします。</span><span class="sxs-lookup"><span data-stu-id="278a6-164">Review [sp_server_diagnostics &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-server-diagnostics-transact-sql) as this system stored procedure plays in important role in the failure condition levels.</span></span>  
  
|<span data-ttu-id="278a6-165">Level</span><span class="sxs-lookup"><span data-stu-id="278a6-165">Level</span></span>|<span data-ttu-id="278a6-166">条件</span><span class="sxs-lookup"><span data-stu-id="278a6-166">Condition</span></span>|<span data-ttu-id="278a6-167">説明</span><span class="sxs-lookup"><span data-stu-id="278a6-167">Description</span></span>|  
|-----------|---------------|-----------------|  
|<span data-ttu-id="278a6-168">0</span><span class="sxs-lookup"><span data-stu-id="278a6-168">0</span></span>|<span data-ttu-id="278a6-169">自動フェールオーバーまたは再起動なし</span><span class="sxs-lookup"><span data-stu-id="278a6-169">No automatic failover or restart</span></span>|<span data-ttu-id="278a6-170">どのようなエラー状態でも、フェールオーバーまたは再起動が自動的に行われないことを示します。</span><span class="sxs-lookup"><span data-stu-id="278a6-170">Indicates that no failover or restart will be triggered automatically on any failure conditions.</span></span> <span data-ttu-id="278a6-171">このレベルは、システム メンテナンスの目的でのみ使用されます。</span><span class="sxs-lookup"><span data-stu-id="278a6-171">This level is for system maintenance purposes only.</span></span>|  
|<span data-ttu-id="278a6-172">1</span><span class="sxs-lookup"><span data-stu-id="278a6-172">1</span></span>|<span data-ttu-id="278a6-173">サーバーの停止によるフェールオーバーまたは再起動</span><span class="sxs-lookup"><span data-stu-id="278a6-173">Failover or restart on server down</span></span>|<span data-ttu-id="278a6-174">次の状態が発生した場合に、サーバーの再起動またはフェールオーバーが行われることを示します。</span><span class="sxs-lookup"><span data-stu-id="278a6-174">Indicates that a server restart or failover will be triggered if the following condition is raised:</span></span><br /><br /> <span data-ttu-id="278a6-175">SQL Server サービスが停止した。</span><span class="sxs-lookup"><span data-stu-id="278a6-175">SQL Server service is down.</span></span>|  
|<span data-ttu-id="278a6-176">2</span><span class="sxs-lookup"><span data-stu-id="278a6-176">2</span></span>|<span data-ttu-id="278a6-177">サーバーの応答停止によるフェールオーバーまたは再起動</span><span class="sxs-lookup"><span data-stu-id="278a6-177">Failover or restart on server unresponsive</span></span>|<span data-ttu-id="278a6-178">次のいずれかの状態が発生した場合に、サーバーの再起動またはフェールオーバーが行われることを示します。</span><span class="sxs-lookup"><span data-stu-id="278a6-178">Indicates that a server restart or failover will be triggered if any of the following conditions are raised:</span></span><br /><br /> <span data-ttu-id="278a6-179">SQL Server サービスが停止した。</span><span class="sxs-lookup"><span data-stu-id="278a6-179">SQL Server service is down.</span></span><br /><br /> <span data-ttu-id="278a6-180">SQL Server インスタンスが応答しない (リソース DLL が HealthCheckTimeout の設定時間内に sp_server_diagnostics からデータを受け取れない)。</span><span class="sxs-lookup"><span data-stu-id="278a6-180">SQL Server instance is not responsive (Resource DLL cannot receive data from sp_server_diagnostics within the HealthCheckTimeout settings).</span></span>|  
|<span data-ttu-id="278a6-181">3\*</span><span class="sxs-lookup"><span data-stu-id="278a6-181">3\*</span></span>|<span data-ttu-id="278a6-182">重大なサーバー エラーによるフェールオーバーまたは再起動</span><span class="sxs-lookup"><span data-stu-id="278a6-182">Failover or restart on critical server errors</span></span>|<span data-ttu-id="278a6-183">次のいずれかの状態が発生した場合に、サーバーの再起動またはフェールオーバーが行われることを示します。</span><span class="sxs-lookup"><span data-stu-id="278a6-183">Indicates that a server restart or failover will be triggered if any of the following conditions are raised:</span></span><br /><br /> <span data-ttu-id="278a6-184">SQL Server サービスが停止した。</span><span class="sxs-lookup"><span data-stu-id="278a6-184">SQL Server service is down.</span></span><br /><br /> <span data-ttu-id="278a6-185">SQL Server インスタンスが応答しない (リソース DLL が HealthCheckTimeout の設定時間内に sp_server_diagnostics からデータを受け取れない)。</span><span class="sxs-lookup"><span data-stu-id="278a6-185">SQL Server instance is not responsive (Resource DLL cannot receive data from sp_server_diagnostics within the HealthCheckTimeout settings).</span></span><br /><br /> <span data-ttu-id="278a6-186">システム ストアド プロシージャ sp_server_diagnostics から 'system エラー' が返される。</span><span class="sxs-lookup"><span data-stu-id="278a6-186">System stored procedure sp_server_diagnostics returns 'system error'.</span></span>|  
|<span data-ttu-id="278a6-187">4</span><span class="sxs-lookup"><span data-stu-id="278a6-187">4</span></span>|<span data-ttu-id="278a6-188">中程度のサーバー エラーによるフェールオーバーまたは再起動</span><span class="sxs-lookup"><span data-stu-id="278a6-188">Failover or restart on moderate server errors</span></span>|<span data-ttu-id="278a6-189">次のいずれかの状態が発生した場合に、サーバーの再起動またはフェールオーバーが行われることを示します。</span><span class="sxs-lookup"><span data-stu-id="278a6-189">Indicates that a server restart or failover will be triggered if any of the following conditions are raised:</span></span><br /><br /> <span data-ttu-id="278a6-190">SQL Server サービスが停止した。</span><span class="sxs-lookup"><span data-stu-id="278a6-190">SQL Server service is down.</span></span><br /><br /> <span data-ttu-id="278a6-191">SQL Server インスタンスが応答しない (リソース DLL が HealthCheckTimeout の設定時間内に sp_server_diagnostics からデータを受け取れない)。</span><span class="sxs-lookup"><span data-stu-id="278a6-191">SQL Server instance is not responsive (Resource DLL cannot receive data from sp_server_diagnostics within the HealthCheckTimeout settings).</span></span><br /><br /> <span data-ttu-id="278a6-192">システム ストアド プロシージャ sp_server_diagnostics から 'system エラー' が返される。</span><span class="sxs-lookup"><span data-stu-id="278a6-192">System stored procedure sp_server_diagnostics returns 'system error'.</span></span><br /><br /> <span data-ttu-id="278a6-193">システム ストアド プロシージャ sp_server_diagnostics から 'resource エラー' が返される。</span><span class="sxs-lookup"><span data-stu-id="278a6-193">System  stored procedure sp_server_diagnostics returns 'resource error'.</span></span>|  
|<span data-ttu-id="278a6-194">5</span><span class="sxs-lookup"><span data-stu-id="278a6-194">5</span></span>|<span data-ttu-id="278a6-195">限定されたエラー状態によるフェールオーバーまたは再起動</span><span class="sxs-lookup"><span data-stu-id="278a6-195">Failover or restart on any qualified failure conditions</span></span>|<span data-ttu-id="278a6-196">次のいずれかの状態が発生した場合に、サーバーの再起動またはフェールオーバーが行われることを示します。</span><span class="sxs-lookup"><span data-stu-id="278a6-196">Indicates that a server restart or failover will be triggered if any of the following conditions are raised:</span></span><br /><br /> <span data-ttu-id="278a6-197">SQL Server サービスが停止した。</span><span class="sxs-lookup"><span data-stu-id="278a6-197">SQL Server service is down.</span></span><br /><br /> <span data-ttu-id="278a6-198">SQL Server インスタンスが応答しない (リソース DLL が HealthCheckTimeout の設定時間内に sp_server_diagnostics からデータを受け取れない)。</span><span class="sxs-lookup"><span data-stu-id="278a6-198">SQL Server instance is not responsive (Resource DLL cannot receive data from sp_server_diagnostics within the HealthCheckTimeout settings).</span></span><br /><br /> <span data-ttu-id="278a6-199">システム ストアド プロシージャ sp_server_diagnostics から 'system エラー' が返される。</span><span class="sxs-lookup"><span data-stu-id="278a6-199">System stored procedure sp_server_diagnostics returns 'system error'.</span></span><br /><br /> <span data-ttu-id="278a6-200">システム ストアド プロシージャ sp_server_diagnostics から 'resource エラー' が返される。</span><span class="sxs-lookup"><span data-stu-id="278a6-200">System  stored procedure sp_server_diagnostics returns 'resource error'.</span></span><br /><br /> <span data-ttu-id="278a6-201">システム ストアド プロシージャ sp_server_diagnostics から 'query_processing エラー' が返される。</span><span class="sxs-lookup"><span data-stu-id="278a6-201">System stored procedure sp_server_diagnostics returns 'query_processing error'.</span></span>|  
  
 <span data-ttu-id="278a6-202">\* 既定値</span><span class="sxs-lookup"><span data-stu-id="278a6-202">\*Default Value</span></span>  
  
####  <a name="responding-to-failures"></a><a name="respond"></a><span data-ttu-id="278a6-203">エラーへの対応</span><span class="sxs-lookup"><span data-stu-id="278a6-203">Responding to Failures</span></span>  
 <span data-ttu-id="278a6-204">1 つまたは複数のエラー条件が検出された後で WSFC サービスがどのようにエラーに対応するかは、WSFC クォーラムの状態と、FCI リソース グループの再起動およびフェールオーバー設定に依存します。</span><span class="sxs-lookup"><span data-stu-id="278a6-204">After one or more failure conditions are detected, how the WSFC service responds to the failures depends on the WSFC quorum state and the restart and failover settings of the FCI resource group.</span></span> <span data-ttu-id="278a6-205">FCI がその WSFC クォーラムを失った場合、FCI 全体がオフラインになり、FCI は高可用性を失います。</span><span class="sxs-lookup"><span data-stu-id="278a6-205">If the FCI has lost its WSFC quorum, then the entire FCI is brought offline and the FCI has lost its high availability.</span></span> <span data-ttu-id="278a6-206">FCI が WSFC クォーラムを保持し続けた場合、WSFC サービスは、最初に障害が発生したノードの再起動を試み、再起動の試行が失敗した場合はフェールオーバーを実行することによって対応します。</span><span class="sxs-lookup"><span data-stu-id="278a6-206">If the FCI still retains its WSFC quorum, then the WSFC service may respond by first attempting to restart the failed node and then failover if the restart attempts are unsuccessful.</span></span> <span data-ttu-id="278a6-207">再起動とフェールオーバーの設定は、フェールオーバー クラスター マネージャー スナップインで構成します。</span><span class="sxs-lookup"><span data-stu-id="278a6-207">The restart and failover settings are configured in the Failover Cluster Manager snap-in.</span></span> <span data-ttu-id="278a6-208">これらの設定の詳細については、「 [ \<Resource> プロパティ: [ポリシー] タブ](https://technet.microsoft.com/library/cc725685.aspx)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="278a6-208">For more information these settings, see [\<Resource> Properties: Policies Tab](https://technet.microsoft.com/library/cc725685.aspx).</span></span>  
  
 <span data-ttu-id="278a6-209">クォーラムの正常性の維持については、「[WSFC クォーラム モードと投票の構成 &#40;SQL Server&#41;](wsfc-quorum-modes-and-voting-configuration-sql-server.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="278a6-209">For more information on maintaining quorum health, see [WSFC Quorum Modes and Voting Configuration &#40;SQL Server&#41;](wsfc-quorum-modes-and-voting-configuration-sql-server.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="278a6-210">参照</span><span class="sxs-lookup"><span data-stu-id="278a6-210">See Also</span></span>  
 [<span data-ttu-id="278a6-211">ALTER SERVER CONFIGURATION &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="278a6-211">ALTER SERVER CONFIGURATION &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/alter-server-configuration-transact-sql)  
  
  
