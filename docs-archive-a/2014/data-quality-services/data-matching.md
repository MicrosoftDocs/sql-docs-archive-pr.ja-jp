---
title: データ照合 | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: data-quality-services
ms.topic: conceptual
ms.assetid: fe66d098-bec3-4258-b42a-479ae460feb3
author: lrtoyou1223
ms.author: lle
ms.openlocfilehash: 42fcb346e46229d28c62b256d328d6af4fc6cfec
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87633336"
---
# <a name="data-matching"></a><span data-ttu-id="2aa36-102">データ照合</span><span class="sxs-lookup"><span data-stu-id="2aa36-102">Data Matching</span></span>
  <span data-ttu-id="2aa36-103">[!INCLUDE[ssDQSnoversion](../includes/ssdqsnoversion-md.md)] (DQS) のデータ照合プロセスでは、データの重複を減らし、データ ソースのデータの精度を高めることができます。</span><span class="sxs-lookup"><span data-stu-id="2aa36-103">The [!INCLUDE[ssDQSnoversion](../includes/ssdqsnoversion-md.md)] (DQS) data matching process enables you to reduce data duplication and improve data accuracy in a data source.</span></span> <span data-ttu-id="2aa36-104">照合では、1 つのデータ ソースのすべてのレコードにおける重複の度合いを分析し、比較したレコードのセットごとに重み付けした一致率を返します。</span><span class="sxs-lookup"><span data-stu-id="2aa36-104">Matching analyzes the degree of duplication in all records of a single data source, returning weighted probabilities of a match between each set of records compared.</span></span> <span data-ttu-id="2aa36-105">これにより、一致と見なすレコードを決定し、ソース データに対して適切な処理を実行することができます。</span><span class="sxs-lookup"><span data-stu-id="2aa36-105">You can then decide which records are matches and take the appropriate action on the source data.</span></span>

 <span data-ttu-id="2aa36-106">DQS の照合プロセスには次の利点があります。</span><span class="sxs-lookup"><span data-stu-id="2aa36-106">The DQS matching process has the following benefits:</span></span>

-   <span data-ttu-id="2aa36-107">同等と見なされるデータ値の間の違いをなくすことで、適切な値を特定し、データの違いによって生じる可能性があるエラーを減らすことができます。</span><span class="sxs-lookup"><span data-stu-id="2aa36-107">Matching enables you to eliminate differences between data values that should be equal, determining the correct value and reducing the errors that data differences can cause.</span></span> <span data-ttu-id="2aa36-108">たとえば、名前や住所によってデータ ソースのデータ (特に顧客データなど) を識別することがよくありますが、時間がたつとデータがダーティになったり悪化したりすることがあります。</span><span class="sxs-lookup"><span data-stu-id="2aa36-108">For example, names and addresses are often the identifying data for a data source, particularly customer data, but the data can become dirty and deteriorate over time.</span></span> <span data-ttu-id="2aa36-109">照合によってそれらのエラーを特定して修正すると、データがはるかに使用しやすくなり、保守も簡単になります。</span><span class="sxs-lookup"><span data-stu-id="2aa36-109">Performing matching to identify and correct these errors can make data use and maintenance much easier.</span></span>

-   <span data-ttu-id="2aa36-110">異なる形式やスタイルで入力されている同等の値の表示を統一することができます。</span><span class="sxs-lookup"><span data-stu-id="2aa36-110">Matching enables you to ensure that values that are equivalent, but were entered in a different format or style, are rendered uniform.</span></span>

-   <span data-ttu-id="2aa36-111">完全一致とあいまい一致が識別され、定義に従って重複データを除去することができます。</span><span class="sxs-lookup"><span data-stu-id="2aa36-111">Matching identifies exact and approximate matches, enabling you to remove duplicate data as you define it.</span></span> <span data-ttu-id="2aa36-112">この処理の定義では、あいまい一致を一致と見なすポイント、</span><span class="sxs-lookup"><span data-stu-id="2aa36-112">You define the point at which an approximate match is in fact a match.</span></span> <span data-ttu-id="2aa36-113">および照合対象として評価するフィールドと評価しないフィールドを指定します。</span><span class="sxs-lookup"><span data-stu-id="2aa36-113">You define which fields are assessed for matching, and which are not.</span></span>

-   <span data-ttu-id="2aa36-114">コンピューター支援型のプロセスを使用して照合ポリシーを作成し、照合結果に基づいて対話形式で変更したり、再利用可能なナレッジ ベースに追加したりできます。</span><span class="sxs-lookup"><span data-stu-id="2aa36-114">DQS enables you to create a matching policy using a computer-assisted process, modify it interactively based upon matching results, and add it to a knowledge base that is reusable.</span></span>

-   <span data-ttu-id="2aa36-115">ソースからステージング テーブルにコピーしたデータのインデックスを再作成するかどうかを、照合ポリシーやソース データの状態に応じて選択できます。</span><span class="sxs-lookup"><span data-stu-id="2aa36-115">You can re-index data copied from the source to the staging table, or not re-index, depending on the state of the matching policy and the source data.</span></span> <span data-ttu-id="2aa36-116">インデックスの再作成を省略すると、パフォーマンスが向上することがあります。</span><span class="sxs-lookup"><span data-stu-id="2aa36-116">Not re-indexing can improve performance.</span></span>

 <span data-ttu-id="2aa36-117">照合プロセスは、他のデータ クレンジング プロセスと組み合わせて実行できます。これにより、データ全体の品質を向上させることができます。</span><span class="sxs-lookup"><span data-stu-id="2aa36-117">You can perform the matching process in conjunction with other data cleansing processes to improve overall data quality.</span></span> <span data-ttu-id="2aa36-118">また、データの重複除去は、マスター データ サービスに組み込まれた DQS の機能を使用して実行することもできます。</span><span class="sxs-lookup"><span data-stu-id="2aa36-118">You can also perform data de-duplication using DQS functionality built into Master Data Services.</span></span> <span data-ttu-id="2aa36-119">詳細については、「 [Master Data Services Overview](../master-data-services/master-data-services-overview-mds.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="2aa36-119">For more information, see [Master Data Services Overview](../master-data-services/master-data-services-overview-mds.md).</span></span>

 <span data-ttu-id="2aa36-120">次の図は、DQS でのデータ照合の実行方法を示したものです。</span><span class="sxs-lookup"><span data-stu-id="2aa36-120">The following illustration displays how data matching is done in DQS:</span></span>

 <span data-ttu-id="2aa36-121">![DQS の照合プロセス](../../2014/data-quality-services/media/dqs-matchingprocess.gif "DQS の照合プロセス")</span><span class="sxs-lookup"><span data-stu-id="2aa36-121">![Matching Process in DQS](../../2014/data-quality-services/media/dqs-matchingprocess.gif "Matching Process in DQS")</span></span>

##  <a name="how-to-perform-data-matching"></a><a name="How"></a> <span data-ttu-id="2aa36-122">データ照合を実行する方法</span><span class="sxs-lookup"><span data-stu-id="2aa36-122">How to Perform Data Matching</span></span>
 <span data-ttu-id="2aa36-123">照合を実行するには、DQS の他のデータ品質プロセスと同様に、次の手順でナレッジ ベースを構築し、データ品質プロジェクトで照合アクティビティを実行します。</span><span class="sxs-lookup"><span data-stu-id="2aa36-123">As with other data quality processes in DQS, you perform matching by building a knowledge base and executing a matching activity in a data quality project in the following steps:</span></span>

1.  <span data-ttu-id="2aa36-124">ナレッジ ベースの照合ポリシーを作成します。</span><span class="sxs-lookup"><span data-stu-id="2aa36-124">Create a matching policy in the knowledge base</span></span>

2.  <span data-ttu-id="2aa36-125">データ品質プロジェクトの一部である照合アクティビティで重複除去プロセスを実行します。</span><span class="sxs-lookup"><span data-stu-id="2aa36-125">Perform a de-duplication process in a matching activity that is part of a data quality project.</span></span>

###  <a name="building-a-matching-policy"></a><a name="Policy"></a><span data-ttu-id="2aa36-126">照合ポリシーの作成</span><span class="sxs-lookup"><span data-stu-id="2aa36-126">Building a Matching Policy</span></span>
 <span data-ttu-id="2aa36-127">ナレッジ ベースを使用して照合を実行するための準備として、ナレッジ ベースの照合ポリシーを作成して、一致率を割り当てる方法を定義します。</span><span class="sxs-lookup"><span data-stu-id="2aa36-127">You prepare the knowledge base for performing matching by creating a matching policy in the knowledge base to define how DQS assigns matching probability.</span></span> <span data-ttu-id="2aa36-128">照合ポリシーには、レコードが別のレコードにどの程度一致するかを評価するときに使用するドメインを識別し、一致率を割り当てるときの各ドメイン値の重みを指定する、1 つ以上の照合ルールを含めます。</span><span class="sxs-lookup"><span data-stu-id="2aa36-128">A matching policy consists of one or more matching rules that identify which domains will be used when DQS assesses how well one record matches to another, and specify the weight that each domain value carries in the matching assessment.</span></span> <span data-ttu-id="2aa36-129">このルールでは、完全に一致するドメイン値だけを一致と見なすか、類似性のレベルが指定した値を超えるドメイン値も一致と見なすかを指定します。</span><span class="sxs-lookup"><span data-stu-id="2aa36-129">You specify in the rule whether domain values have to be an exact match or can just be similar, and to what degree of similarity.</span></span> <span data-ttu-id="2aa36-130">また、ドメインが一致する必要があるかどうかも指定します。</span><span class="sxs-lookup"><span data-stu-id="2aa36-130">You also specify whether a domain match is a prerequisite.</span></span>

 <span data-ttu-id="2aa36-131">ナレッジ ベース管理ウィザードの照合ポリシー アクティビティでは、対象となるすべてのレコードについて、各照合ルールを適用して一度に 2 つずつレコードを比較することでサンプル データを分析します。</span><span class="sxs-lookup"><span data-stu-id="2aa36-131">The matching policy activity in the Knowledge Base Management wizard analyzes sample data by applying each matching rule to compare two records at a time throughout the range of records.</span></span> <span data-ttu-id="2aa36-132">指定した最小値よりも照合スコアが大きいレコードは、照合結果でクラスターにグループ化されます。</span><span class="sxs-lookup"><span data-stu-id="2aa36-132">Records whose matching scores are greater than a specified minimum are grouped in clusters in the matching results.</span></span> <span data-ttu-id="2aa36-133">これらの照合結果は、照合ルールの調整に使用するためのものであり、ナレッジ ベースには追加されません。</span><span class="sxs-lookup"><span data-stu-id="2aa36-133">These matching results are not added to the knowledge base; you use them to tune the matching rules.</span></span> <span data-ttu-id="2aa36-134">照合ポリシーの作成は反復的なプロセスで、照合結果やプロファイル統計情報に基づいて照合ルールを変更することができます。</span><span class="sxs-lookup"><span data-stu-id="2aa36-134">Creating a matching policy can be an iterative process in which you modify matching rules based on the matching results or profiling statistics.</span></span>

 <span data-ttu-id="2aa36-135">特定のドメインに対して、データ ソースからドメインにデータを読み込むときにデータ文字列を正規化するように指定することができます。</span><span class="sxs-lookup"><span data-stu-id="2aa36-135">You can specify for a domain that data strings will be normalized when you load data from the data source into the domain.</span></span> <span data-ttu-id="2aa36-136">このプロセスで、特殊文字を null またはスペースで置き換えることで、2 つの文字列間の違いがなくなることがよくあります。</span><span class="sxs-lookup"><span data-stu-id="2aa36-136">This process consists of replacing special characters with a null or a space, which often removes the difference between two strings.</span></span> <span data-ttu-id="2aa36-137">これにより、照合の精度が高まり、正規化を行わないと一致と見なされない照合結果が最小一致しきい値を上回るようになることがあります。</span><span class="sxs-lookup"><span data-stu-id="2aa36-137">This can increase matching accuracy, and can often enable a matching result to surpass the minimum matching threshold, when without normalization it would not pass.</span></span>

> [!NOTE]
>  <span data-ttu-id="2aa36-138">2 つのレコードの対応するフィールドの値が null の場合、それらは一致と見なされます。</span><span class="sxs-lookup"><span data-stu-id="2aa36-138">Null values in the corresponding fields of two records will be considered a match.</span></span>

 <span data-ttu-id="2aa36-139">照合ポリシーは、サンプル データにマップされたドメインで実行されます。</span><span class="sxs-lookup"><span data-stu-id="2aa36-139">The matching policy is run on domains mapped to the sample data.</span></span> <span data-ttu-id="2aa36-140">照合ポリシーの実行時にデータ ソースからステージング テーブルにデータをコピーしてインデックスを再作成するかどうかを指定することができます。</span><span class="sxs-lookup"><span data-stu-id="2aa36-140">You can specify whether data is copied from the data source into the staging table and re-indexed when you run the matching policy, or not.</span></span> <span data-ttu-id="2aa36-141">これは、ナレッジ ベースの構築時にも、照合プロジェクトの実行中にも指定できます。</span><span class="sxs-lookup"><span data-stu-id="2aa36-141">You can do so both when building the knowledge base and when running the matching project.</span></span> <span data-ttu-id="2aa36-142">インデックスの再作成を省略すると、パフォーマンスが向上することがあります。</span><span class="sxs-lookup"><span data-stu-id="2aa36-142">Not re-indexing could result in improved performance.</span></span> <span data-ttu-id="2aa36-143">インデックスの再作成を省略できるのは、照合ポリシーが変更されていない場合です。照合ポリシーに変更がなく、データ ソースの更新、ポリシーのマップし直し、新しいデータ ソースの選択、新しいドメインのマップを行っていなければ、インデックスを再作成する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="2aa36-143">Re-indexing is not necessary if the following is true: the matching policy has not changed, and you have not updated the data source, remapped the policy, selected a new data source, or mapped one or more new domains.</span></span>

 <span data-ttu-id="2aa36-144">作成した各照合ルールはナレッジ ベースに保存されます。</span><span class="sxs-lookup"><span data-stu-id="2aa36-144">Each matching rule is saved in the knowledge base when it is created.</span></span> <span data-ttu-id="2aa36-145">ただし、ナレッジ ベースは、発行されていないとデータ品質プロジェクトで使用できません。</span><span class="sxs-lookup"><span data-stu-id="2aa36-145">However, a knowledge base is available for use in a data quality project only when it is published.</span></span> <span data-ttu-id="2aa36-146">また、別のユーザーが作成したナレッジ ベースの照合ポリシーは、ナレッジ ベースが発行されるまでは変更できません。</span><span class="sxs-lookup"><span data-stu-id="2aa36-146">In addition, until the knowledge base is published, the matching rules in it cannot be changed by a user other than the person who created it.</span></span>

###  <a name="running-a-matching-project"></a><a name="Project"></a><span data-ttu-id="2aa36-147">照合プロジェクトの実行</span><span class="sxs-lookup"><span data-stu-id="2aa36-147">Running a Matching Project</span></span>
 <span data-ttu-id="2aa36-148">DQS では、ソース データの各行を他のすべての行と比較し、ナレッジ ベースで定義されている照合ポリシーを使用して行が一致する確率を特定することで、データの重複除去が実行されます。</span><span class="sxs-lookup"><span data-stu-id="2aa36-148">DQS performs data de-duplication by comparing each row in the source data to every other row, using the matching policy defined in the knowledge base, and producing a probability that the rows are a match.</span></span> <span data-ttu-id="2aa36-149">この処理は、データ品質プロジェクトで照合と一緒に行われます。</span><span class="sxs-lookup"><span data-stu-id="2aa36-149">This is done in a data quality project with a type of Matching.</span></span> <span data-ttu-id="2aa36-150">照合はデータ品質プロジェクトの主要な手順の 1 つです。</span><span class="sxs-lookup"><span data-stu-id="2aa36-150">Matching is one of the major steps in a data quality project.</span></span> <span data-ttu-id="2aa36-151">この手順は、データ クレンジングの実行後に、照合するデータにエラーがない状態で実行すると最適な結果が得られます。</span><span class="sxs-lookup"><span data-stu-id="2aa36-151">It is best performed after data cleansing, so that the data to be matched is free from error.</span></span> <span data-ttu-id="2aa36-152">照合プロセスを実行する前に、クレンジング プロジェクトの結果をデータ テーブルまたは .csv ファイルにエクスポートしておくことで、照合プロジェクトを作成し、その照合プロジェクトでクレンジング結果をドメインにマップすることができます。</span><span class="sxs-lookup"><span data-stu-id="2aa36-152">Before running a matching process, you can export the results of the cleansing project into a data table or .csv file, and then create a matching project in which you map the cleansing results to domains in the matching project.</span></span>

 <span data-ttu-id="2aa36-153">データ照合プロジェクトは、コンピューター支援型のプロセスと対話形式のプロセスで構成されます。</span><span class="sxs-lookup"><span data-stu-id="2aa36-153">A data matching project consists of a computer-assisted process and an interactive process.</span></span> <span data-ttu-id="2aa36-154">照合プロジェクトでは、評価するデータ ソースに対して照合ポリシーの照合ルールを適用し、</span><span class="sxs-lookup"><span data-stu-id="2aa36-154">The matching project applies the matching rules in the matching policy to the data source to be assessed.</span></span> <span data-ttu-id="2aa36-155">任意の 2 つの行が一致する確率を照合スコアで評価します。</span><span class="sxs-lookup"><span data-stu-id="2aa36-155">This process assesses the likelihood that any two rows are matches in a matching score.</span></span> <span data-ttu-id="2aa36-156">照合ポリシーでデータ スチュワードが設定した値よりも一致率が高いレコードだけが一致と見なされます。</span><span class="sxs-lookup"><span data-stu-id="2aa36-156">Only those records with a probability of a match greater than a value set by the data steward in the matching policy will be considered a match.</span></span>

 <span data-ttu-id="2aa36-157">DQS で照合分析を実行すると、一致と見なされたレコードのクラスターが作成され、</span><span class="sxs-lookup"><span data-stu-id="2aa36-157">When DQS performs the matching analysis, it creates clusters of records that DQS considers matches.</span></span> <span data-ttu-id="2aa36-158">各クラスター内の 1 つのレコードがピボット レコード (先頭のレコード) としてランダムに選択されます。</span><span class="sxs-lookup"><span data-stu-id="2aa36-158">DQS randomly identifies one of the records in each cluster as the pivot, or leading, record.</span></span> <span data-ttu-id="2aa36-159">データ スチュワードは、照合結果を確認し、クラスターに対する適切な一致ではないレコードを拒否します。</span><span class="sxs-lookup"><span data-stu-id="2aa36-159">The data steward verifies the matching results, and rejects any record that is not an appropriate match for a cluster.</span></span> <span data-ttu-id="2aa36-160">その後、データ スチュワードは、サバイバーシップ ルールを選択します。選択したサバイバーシップ ルールに基づいて、照合プロセスで保持するレコードが特定され、一致レコードがそのレコードに置き換えられます。</span><span class="sxs-lookup"><span data-stu-id="2aa36-160">The data steward then selects a survivorship rule that DQS will use to determine the record that will survive the matching process and replace the matching records.</span></span> <span data-ttu-id="2aa36-161">サバイバーシップ ルールは、"ピボット レコード" (既定値)、"最も完全で最長のレコード"、"最も完全なレコード"、または "最長のレコード" から選択できます。</span><span class="sxs-lookup"><span data-stu-id="2aa36-161">The survivorship rule can be "Pivot record" (the default), "most complete and longest record", "most complete record", or "longest record".</span></span> <span data-ttu-id="2aa36-162">各クラスターで保持するレコード (先頭のレコード) を決めるときは、サバイバーシップ ルールの条件に基づいて最も近いレコードが選択されます。</span><span class="sxs-lookup"><span data-stu-id="2aa36-162">DQS determines the survivor (leading) record in each cluster based upon which record most closely matches the criteria or criterion in the survivorship rule.</span></span> <span data-ttu-id="2aa36-163">特定のクラスターにサバイバーシップ ルールに適合するレコードが複数ある場合は、それらのレコードから 1 つのレコードがランダムに選択されます。</span><span class="sxs-lookup"><span data-stu-id="2aa36-163">If multiple records in a given cluster comply with the survivorship rule, DQS selects one of those records randomly.</span></span> <span data-ttu-id="2aa36-164">[show non-overlapping clusters]\(重複するクラスターを表示します\) を選択すると、共通のレコードを持つクラスターを 1 つのクラスターとして表示することができます。</span><span class="sxs-lookup"><span data-stu-id="2aa36-164">DQS gives you the choice of displaying clusters that have records in common as a single cluster by selecting "show non-overlapping clusters".</span></span> <span data-ttu-id="2aa36-165">この設定に従って結果を表示するには、照合プロセスを実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="2aa36-165">You must execute the matching process in order to display the results according to this setting.</span></span>

 <span data-ttu-id="2aa36-166">照合プロセスの結果は、SQL Server のテーブルまたは .csv ファイルにエクスポートすることができます。</span><span class="sxs-lookup"><span data-stu-id="2aa36-166">You can export the results of the matching process either to a SQL Server table or a .csv file.</span></span> <span data-ttu-id="2aa36-167">照合結果をエクスポートする方法は 2 種類あり、一致レコードと不一致レコードをエクスポートするか、クラスターで保持するレコードだけを含むサバイバーシップ レコードと不一致レコードをエクスポートできます。</span><span class="sxs-lookup"><span data-stu-id="2aa36-167">You can export matching results in two forms: first, the matched records and the unmatched records, or second, survivorship records that include only the survivor record for a cluster and the unmatched results.</span></span> <span data-ttu-id="2aa36-168">サバイバーシップ レコードでは、保持するレコードとして複数のクラスターで同じレコードが特定された場合、そのレコードが 1 回だけエクスポートされます。</span><span class="sxs-lookup"><span data-stu-id="2aa36-168">In the survivorship records, if the same record is identified as the survivor for multiple clusters, that record will only be exported once.</span></span>

## <a name="in-this-section"></a><span data-ttu-id="2aa36-169">このセクションの内容</span><span class="sxs-lookup"><span data-stu-id="2aa36-169">In This Section</span></span>
 <span data-ttu-id="2aa36-170">DQS では、照合に関連する次のタスクを実行できます。</span><span class="sxs-lookup"><span data-stu-id="2aa36-170">You can perform the following tasks related to matching in DQS:</span></span>

|||
|-|-|
|<span data-ttu-id="2aa36-171">照合ポリシーの照合ルールの作成とテスト</span><span class="sxs-lookup"><span data-stu-id="2aa36-171">Create and test matching rules in a matching policy</span></span>|[<span data-ttu-id="2aa36-172">照合ポリシーの作成</span><span class="sxs-lookup"><span data-stu-id="2aa36-172">Create a Matching Policy</span></span>](../../2014/data-quality-services/create-a-matching-policy.md)|
|<span data-ttu-id="2aa36-173">データ品質プロジェクトでの照合の実行</span><span class="sxs-lookup"><span data-stu-id="2aa36-173">Run matching in a data quality project</span></span>|[<span data-ttu-id="2aa36-174">照合プロジェクトの実行</span><span class="sxs-lookup"><span data-stu-id="2aa36-174">Run a Matching Project</span></span>](../../2014/data-quality-services/run-a-matching-project.md)|


