---
title: あいまい参照変換 | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: integration-services
ms.topic: conceptual
f1_keywords:
- sql12.dts.designer.fuzzylookuptrans.f1
helpviewer_keywords:
- cleaning data
- comparing data
- token delimiters [Integration Services]
- temporary indexes [Integration Services]
- temporary tables [Integration Services]
- Fuzzy Lookup transformation
- reference tables [Integration Services]
- match similar data [Integration Services]
- replacing missing values
- correcting data [Integration Services]
- cache [Integration Services]
- standardizing data [Integration Services]
- lookups [Integration Services]
- confidence scores [Integration Services]
- fuzzy matches
- missing values replaced [Integration Services]
- similarity thresholds [Integration Services]
ms.assetid: 019db426-3de2-4ca9-8667-79fd9a47a068
author: chugugrace
ms.author: chugu
ms.openlocfilehash: 742a87e7425fd65b8af7bcda87c237151d382f77
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87642200"
---
# <a name="fuzzy-lookup-transformation"></a><span data-ttu-id="e0971-102">あいまい参照変換</span><span class="sxs-lookup"><span data-stu-id="e0971-102">Fuzzy Lookup Transformation</span></span>
  <span data-ttu-id="e0971-103">あいまい参照変換では、データの標準化、データの修正、不足している値の提供など、データのクリーン タスクを実行します。</span><span class="sxs-lookup"><span data-stu-id="e0971-103">The Fuzzy Lookup transformation performs data cleaning tasks such as standardizing data, correcting data, and providing missing values.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="e0971-104">パフォーマンスやメモリの制限など、あいまい参照変換に関する詳細については、ホワイト ペーパー「 [SQL Server Integration Services 2005 のあいまい参照とあいまいグループ化](https://go.microsoft.com/fwlink/?LinkId=96604)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="e0971-104">For more detailed information about the Fuzzy Lookup transformation, including performance and memory limitations, see the white paper, [Fuzzy Lookup and Fuzzy Grouping in SQL Server Integration Services 2005](https://go.microsoft.com/fwlink/?LinkId=96604).</span></span>  
  
 <span data-ttu-id="e0971-105">あいまい参照変換は、あいまい一致を使用するという点が参照変換とは異なります。</span><span class="sxs-lookup"><span data-stu-id="e0971-105">The Fuzzy Lookup transformation differs from the Lookup transformation in its use of fuzzy matching.</span></span> <span data-ttu-id="e0971-106">参照変換では、等結合を使用して、参照テーブル内の一致レコードを検索します。</span><span class="sxs-lookup"><span data-stu-id="e0971-106">The Lookup transformation uses an equi-join to locate matching records in the reference table.</span></span> <span data-ttu-id="e0971-107">返されるのは、一致レコードを少なくとも 1 つ含むレコードと、一致レコードがないレコードです。</span><span class="sxs-lookup"><span data-stu-id="e0971-107">It returns records with at least one matching record, and returns records with no matching records.</span></span> <span data-ttu-id="e0971-108">これに対して、あいまい参照変換では、あいまい一致を使用して、参照テーブル内の 1 つ以上の類似一致を返します。</span><span class="sxs-lookup"><span data-stu-id="e0971-108">In contrast, the Fuzzy Lookup transformation uses fuzzy matching to return one or more close matches in the reference table.</span></span>  
  
 <span data-ttu-id="e0971-109">あいまい参照変換は、一般的に、パッケージ データ フローで参照変換に続けて実行されます。</span><span class="sxs-lookup"><span data-stu-id="e0971-109">A Fuzzy Lookup transformation frequently follows a Lookup transformation in a package data flow.</span></span> <span data-ttu-id="e0971-110">まず、参照変換によって完全一致の検索が行われます。</span><span class="sxs-lookup"><span data-stu-id="e0971-110">First, the Lookup transformation tries to find an exact match.</span></span> <span data-ttu-id="e0971-111">完全一致が見つからない場合、あいまい参照変換によって、参照テーブル内の類似一致が提供されます。</span><span class="sxs-lookup"><span data-stu-id="e0971-111">If it fails, the Fuzzy Lookup transformation provides close matches from the reference table.</span></span>  
  
 <span data-ttu-id="e0971-112">変換では、入力データの整理と拡張に使用する値を含む参照データ ソースにアクセスできる必要があります。</span><span class="sxs-lookup"><span data-stu-id="e0971-112">The transformation needs access to a reference data source that contains the values that are used to clean and extend the input data.</span></span> <span data-ttu-id="e0971-113">参照データ ソースは [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] データベースのテーブルである必要があります。</span><span class="sxs-lookup"><span data-stu-id="e0971-113">The reference data source must be a table in a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] database.</span></span> <span data-ttu-id="e0971-114">入力列の値と参照テーブルの値の一致は、完全一致である場合とあいまい一致である場合があります。</span><span class="sxs-lookup"><span data-stu-id="e0971-114">The match between the value in an input column and the value in the reference table can be an exact match or a fuzzy match.</span></span> <span data-ttu-id="e0971-115">ただし、あいまい一致の場合、少なくとも 1 つの列一致が設定されている必要があります。</span><span class="sxs-lookup"><span data-stu-id="e0971-115">However, the transformation requires at least one column match to be configured for fuzzy matching.</span></span> <span data-ttu-id="e0971-116">完全一致のみを使用する場合は、参照変換を使用してください。</span><span class="sxs-lookup"><span data-stu-id="e0971-116">If you want to use only exact matching, use the Lookup transformation instead.</span></span>  
  
 <span data-ttu-id="e0971-117">この変換は 1 つの入力と 1 つの出力をとります。</span><span class="sxs-lookup"><span data-stu-id="e0971-117">This transformation has one input and one output.</span></span>  
  
 <span data-ttu-id="e0971-118">あいまい一致では、データ型が `DT_WSTR` または `DT_STR` の入力列だけが使用されます。</span><span class="sxs-lookup"><span data-stu-id="e0971-118">Only input columns with the `DT_WSTR` and `DT_STR` data types can be used in fuzzy matching.</span></span> <span data-ttu-id="e0971-119">完全一致では、`DT_TEXT`、`DT_NTEXT`、`DT_IMAGE` を除くすべての DTS データ型を使用できます。</span><span class="sxs-lookup"><span data-stu-id="e0971-119">Exact matching can use any DTS data type except `DT_TEXT`, `DT_NTEXT`, and `DT_IMAGE`.</span></span> <span data-ttu-id="e0971-120">詳細については、「 [Integration Services Data Types](../integration-services-data-types.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="e0971-120">For more information, see [Integration Services Data Types](../integration-services-data-types.md).</span></span> <span data-ttu-id="e0971-121">入力と参照テーブルの結合に使用される列のデータ型には、互換性が必要です。</span><span class="sxs-lookup"><span data-stu-id="e0971-121">Columns that participate in the join between the input and the reference table must have compatible data types.</span></span> <span data-ttu-id="e0971-122">たとえば、DTS データ型の列とデータ型の列の結合は有効ですが、データ型の列をデータ型の `DT_WSTR` [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] `nvarchar` 列に結合することは無効です `DT_WSTR` `int` 。</span><span class="sxs-lookup"><span data-stu-id="e0971-122">For example, it is valid to join a column with the DTS `DT_WSTR` data type to a column with the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] `nvarchar` data type, but invalid to join a column with the `DT_WSTR` data type to a column with the `int` data type.</span></span>  
  
 <span data-ttu-id="e0971-123">この変換は、使用する最大メモリ量、行比較アルゴリズム、および変換で使用するインデックス テーブルと参照テーブルのキャッシュを指定することにより、カスタマイズできます。</span><span class="sxs-lookup"><span data-stu-id="e0971-123">You can customize this transformation by specifying the maximum amount of memory, the row comparison algorithm, and the caching of indexes and reference tables that the transformation uses.</span></span>  
  
 <span data-ttu-id="e0971-124">あいまい参照変換で使用されるメモリの量は、MaxMemoryUsage カスタム プロパティを設定することによって構成できます。</span><span class="sxs-lookup"><span data-stu-id="e0971-124">The amount of memory that the Fuzzy Lookup transformation uses can be configured by setting the MaxMemoryUsage custom property.</span></span> <span data-ttu-id="e0971-125">メガバイト (MB) 単位の数値を指定するか、0 を指定できます。0 を指定すると、変換に必要なメモリの量と使用できる物理メモリの量に基づいて、変換に使用されるメモリの量が動的に決まります。</span><span class="sxs-lookup"><span data-stu-id="e0971-125">You can specify the number of megabytes (MB), or use the value 0, which lets the transformation use a dynamic amount of memory based on its needs and the physical memory available.</span></span> <span data-ttu-id="e0971-126">MaxMemoryUsage カスタム プロパティは、パッケージの読み込み時にプロパティ式で更新できます。</span><span class="sxs-lookup"><span data-stu-id="e0971-126">The MaxMemoryUsage custom property can be updated by a property expression when the package is loaded.</span></span> <span data-ttu-id="e0971-127">詳細については、「[Integration Services &#40;SSIS&#41; の式](../../expressions/integration-services-ssis-expressions.md)」、「[パッケージでプロパティ式を使用する](../../expressions/use-property-expressions-in-packages.md)」、および「[変換のカスタム プロパティ](transformation-custom-properties.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="e0971-127">For more information, see [Integration Services &#40;SSIS&#41; Expressions](../../expressions/integration-services-ssis-expressions.md), [Use Property Expressions in Packages](../../expressions/use-property-expressions-in-packages.md), and [Transformation Custom Properties](transformation-custom-properties.md).</span></span>  
  
## <a name="controlling-fuzzy-matching-behavior"></a><span data-ttu-id="e0971-128">あいまい一致の動作の制御</span><span class="sxs-lookup"><span data-stu-id="e0971-128">Controlling Fuzzy Matching Behavior</span></span>  
 <span data-ttu-id="e0971-129">あいまい参照変換では、入力行に対して返される一致の最大数、トークン区切り記号、類似性のしきい値という 3 つの機能によって、実行する参照をカスタマイズします。</span><span class="sxs-lookup"><span data-stu-id="e0971-129">The Fuzzy Lookup transformation includes three features for customizing the lookup it performs: maximum number of matches to return per input row, token delimiters, and similarity thresholds.</span></span>  
  
 <span data-ttu-id="e0971-130">変換では、指定した数を上限とする 0 個以上の一致が返されます。</span><span class="sxs-lookup"><span data-stu-id="e0971-130">The transformation returns zero or more matches up to the number of matches specified.</span></span> <span data-ttu-id="e0971-131">一致の最大数を指定しても、必ずその数の一致が返されるとは限りません。変換が返す一致の最大数が設定されるだけです。</span><span class="sxs-lookup"><span data-stu-id="e0971-131">Specifying a maximum number of matches does not guarantee that the transformation returns the maximum number of matches; it only guarantees that the transformation returns at most that number of matches.</span></span> <span data-ttu-id="e0971-132">一致の最大数を 1 より大きな値に設定すると、変換では参照ごとに複数行が出力され、行が重複する場合もあります。</span><span class="sxs-lookup"><span data-stu-id="e0971-132">If you set the maximum number of matches to a value greater than 1, the output of the transformation may include more than one row per lookup and some of the rows may be duplicates.</span></span>  
  
 <span data-ttu-id="e0971-133">変換には、データをトークン化する際に使用する区切り記号の既定のセットが用意されていますが、データのニーズに合わせてトークン区切り記号を追加できます。</span><span class="sxs-lookup"><span data-stu-id="e0971-133">The transformation provides a default set of delimiters used to tokenize the data, but you can add token delimiters to suit the needs of your data.</span></span> <span data-ttu-id="e0971-134">Delimiters プロパティには、既定の区切り記号が含まれています。</span><span class="sxs-lookup"><span data-stu-id="e0971-134">The Delimiters property contains the default delimiters.</span></span> <span data-ttu-id="e0971-135">トークンは相互比較するデータの単位を定義するので、トークンの設定は重要です。</span><span class="sxs-lookup"><span data-stu-id="e0971-135">Tokenization is important because it defines the units within the data that are compared to each other.</span></span>  
  
 <span data-ttu-id="e0971-136">類似性のしきい値は、コンポーネント レベルおよび結合レベルで設定できます。</span><span class="sxs-lookup"><span data-stu-id="e0971-136">The similarity thresholds can be set at the component and join levels.</span></span> <span data-ttu-id="e0971-137">結合レベルの類似性のしきい値は、入力と参照テーブルの列のあいまい一致を実行する場合にのみ使用できます。</span><span class="sxs-lookup"><span data-stu-id="e0971-137">The join-level similarity threshold is only available when the transformation performs a fuzzy match between columns in the input and the reference table.</span></span> <span data-ttu-id="e0971-138">類似性の範囲は 0 ～ 1 です。</span><span class="sxs-lookup"><span data-stu-id="e0971-138">The similarity range is 0 to 1.</span></span> <span data-ttu-id="e0971-139">しきい値が 1 に近いほど、行や列が一致していると判断される場合の類似性が高くなります。</span><span class="sxs-lookup"><span data-stu-id="e0971-139">The closer to 1 the threshold is, the more similar the rows and columns must be to qualify as duplicates.</span></span> <span data-ttu-id="e0971-140">類似性のしきい値は、コンポーネント レベルおよび結合レベルで MinSimilarity プロパティを設定して指定します。</span><span class="sxs-lookup"><span data-stu-id="e0971-140">You specify the similarity threshold by setting the MinSimilarity property at the component and join levels.</span></span> <span data-ttu-id="e0971-141">コンポーネント レベルで指定された類似性を満たすには、すべての行がすべての一致に関して、指定された類似性のしきい値以上の類似性を持つ必要があります。</span><span class="sxs-lookup"><span data-stu-id="e0971-141">To satisfy the similarity that is specified at the component level, all rows must have a similarity across all matches that is greater than or equal to the similarity threshold that is specified at the component level.</span></span> <span data-ttu-id="e0971-142">したがって、行レベルまたは結合レベルでの一致が均一に類似していない限り、コンポーネント レベルで非常に類似した一致を指定することはできません。</span><span class="sxs-lookup"><span data-stu-id="e0971-142">That is, you cannot specify a very close match at the component level unless the matches at the row or join level are equally close.</span></span>  
  
 <span data-ttu-id="e0971-143">一致には、類似スコアおよび信頼スコアが含まれます。</span><span class="sxs-lookup"><span data-stu-id="e0971-143">Each match includes a similarity score and a confidence score.</span></span> <span data-ttu-id="e0971-144">類似スコアは、入力レコードとあいまい参照変換が参照テーブルから返したレコードとのテキストの類似性を数値で表したものです。</span><span class="sxs-lookup"><span data-stu-id="e0971-144">The similarity score is a mathematical measure of the textural similarity between the input record and the record that Fuzzy Lookup transformation returns from the reference table.</span></span> <span data-ttu-id="e0971-145">信頼スコアは、特定の値が、参照テーブル内で見つかった一致の中で最適の一致である確率を表す数値です。</span><span class="sxs-lookup"><span data-stu-id="e0971-145">The confidence score is a measure of how likely it is that a particular value is the best match among the matches found in the reference table.</span></span> <span data-ttu-id="e0971-146">特定のレコードに割り当てられる信頼スコアは、返された他の一致レコードに依存します。</span><span class="sxs-lookup"><span data-stu-id="e0971-146">The confidence score assigned to a record depends on the other matching records that are returned.</span></span> <span data-ttu-id="e0971-147">たとえば、 *St.* と *Saint* の一致の類似スコアは他の一致に関係なく低くなりますが、</span><span class="sxs-lookup"><span data-stu-id="e0971-147">For example, matching *St.* and *Saint* returns a low similarity score regardless of other matches.</span></span> <span data-ttu-id="e0971-148">*Saint* が返された唯一の一致の場合には、信頼スコアは高くなります。</span><span class="sxs-lookup"><span data-stu-id="e0971-148">If *Saint* is the only match returned, the confidence score is high.</span></span> <span data-ttu-id="e0971-149">参照テーブル内に *Saint* と *St.* の両方が存在した場合、 *St.* の信頼スコアが高く、 *Saint* の信頼スコアが低くなります。</span><span class="sxs-lookup"><span data-stu-id="e0971-149">If both *Saint* and *St.* appear in the reference table, the confidence in *St.* is high and the confidence in *Saint* is low.</span></span> <span data-ttu-id="e0971-150">ただし、類似スコアが高くても、信頼スコアが高いとは限りません。</span><span class="sxs-lookup"><span data-stu-id="e0971-150">However, high similarity may not mean high confidence.</span></span> <span data-ttu-id="e0971-151">たとえば、 *Chapter 4* という値を検索した場合、 *Chapter 1* *Chapter 2* *Chapter 3* が結果として返されて、それぞれの類似スコアは高くなります。しかし、どの結果が最適の一致であるかがはっきりしないため、信頼スコアは低くなります。</span><span class="sxs-lookup"><span data-stu-id="e0971-151">For example, if you are looking up the value *Chapter 4*, the returned results *Chapter 1*, *Chapter 2*, and *Chapter 3* have a high similarity score but a low confidence score because it is unclear which of the results is the best match.</span></span>  
  
 <span data-ttu-id="e0971-152">類似スコアは 0 ～ 1 の 10 進値で示されます。類似スコア 1 は、入力列の値と参照テーブルの値が完全に一致していることを表します。</span><span class="sxs-lookup"><span data-stu-id="e0971-152">The similarity score is represented by a decimal value between 0 and 1, where a similarity score of 1 means an exact match between the value in the input column and the value in the reference table.</span></span> <span data-ttu-id="e0971-153">信頼スコアも 0 ～ 1 の 10 進値で、一致の信頼性を表します。</span><span class="sxs-lookup"><span data-stu-id="e0971-153">The confidence score, also a decimal value between 0 and 1, indicates the confidence in the match.</span></span> <span data-ttu-id="e0971-154">使用できる一致が見つからない行には類似スコアおよび信頼スコアに 0 が割り当てられ、参照テーブルからコピーされる出力列は NULL 値になります。</span><span class="sxs-lookup"><span data-stu-id="e0971-154">If no usable match is found, similarity and confidence scores of 0 are assigned to the row, and the output columns copied from the reference table will contain null values.</span></span>  
  
 <span data-ttu-id="e0971-155">あいまい参照では、参照テーブルから適切な一致を見つけられない場合があります。</span><span class="sxs-lookup"><span data-stu-id="e0971-155">Sometimes, Fuzzy Lookup may not locate appropriate matches in the reference table.</span></span> <span data-ttu-id="e0971-156">これは、参照に使用する入力値が単一の短い語の場合などに起こりやすくなります。</span><span class="sxs-lookup"><span data-stu-id="e0971-156">This can occur if the input value that is used in a lookup is a single, short word.</span></span> <span data-ttu-id="e0971-157">たとえば、参照テーブルに *hello* という値がある場合、その列または同じ行の他の列に他のトークンがないと、 *helo* とは一致しません。</span><span class="sxs-lookup"><span data-stu-id="e0971-157">For example, *helo* is not matched with the value *hello* in a reference table when no other tokens are present in that column or any other column in the row.</span></span>  
  
 <span data-ttu-id="e0971-158">変換の出力列には、パススルー列として指定された入力列、参照テーブルで指定された列が含まれ、次の列が追加されます。</span><span class="sxs-lookup"><span data-stu-id="e0971-158">The transformation output columns include the input columns that are marked as pass-through columns, the selected columns in the lookup table, and the following additional columns:</span></span>  
  
-   <span data-ttu-id="e0971-159">**_Similarity**列は、入力列と参照列の値の類似性を表します。</span><span class="sxs-lookup"><span data-stu-id="e0971-159">**_Similarity**, a column that describes the similarity between values in the input and reference columns.</span></span>  
  
-   <span data-ttu-id="e0971-160">**_Confidence**列は、一致の精度を表します。</span><span class="sxs-lookup"><span data-stu-id="e0971-160">**_Confidence**, a column that describes the quality of the match.</span></span>  
  
 <span data-ttu-id="e0971-161">変換では、 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] データベースへの接続を使用して、あいまい一致アルゴリズムで使用する一時テーブルを作成します。</span><span class="sxs-lookup"><span data-stu-id="e0971-161">The transformation uses the connection to the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] database to create the temporary tables that the fuzzy matching algorithm uses.</span></span>  
  
## <a name="running-the-fuzzy-lookup-transformation"></a><span data-ttu-id="e0971-162">あいまい参照変換の実行</span><span class="sxs-lookup"><span data-stu-id="e0971-162">Running the Fuzzy Lookup Transformation</span></span>  
 <span data-ttu-id="e0971-163">パッケージで最初に変換が実行される場合、参照テーブルがコピーされ、新しいテーブルに整数データ型のキーが追加され、キー列のインデックスが作成されます。</span><span class="sxs-lookup"><span data-stu-id="e0971-163">When the package first runs the transformation, the transformation copies the reference table, adds a key with an integer data type to the new table, and builds an index on the key column.</span></span> <span data-ttu-id="e0971-164">次に、一致インデックスと呼ばれる、参照テーブルのコピーに関するインデックスが作成されます。</span><span class="sxs-lookup"><span data-stu-id="e0971-164">Next, the transformation builds an index, called a match index, on the copy of the reference table.</span></span> <span data-ttu-id="e0971-165">一致インデックスには変換の入力列の値をトークン化した結果が格納され、変換では参照操作でこのトークンを使用します。</span><span class="sxs-lookup"><span data-stu-id="e0971-165">The match index stores the results of tokenizing the values in the transformation input columns, and the transformation then uses the tokens in the lookup operation.</span></span> <span data-ttu-id="e0971-166">一致インデックスは、 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] データベースのテーブルです。</span><span class="sxs-lookup"><span data-stu-id="e0971-166">The match index is a table in a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] database.</span></span>  
  
 <span data-ttu-id="e0971-167">パッケージが再度、実行された場合、変換では既存の一致インデックスを使用するか、新しいインデックスが作成されます。</span><span class="sxs-lookup"><span data-stu-id="e0971-167">When the package runs again, the transformation can either use an existing match index or create a new index.</span></span> <span data-ttu-id="e0971-168">参照テーブルが静的であれば、パッケージでは手間のかかるインデックスの再作成プロセスを行わず、データ クリーン セッションを繰り返すことができます。</span><span class="sxs-lookup"><span data-stu-id="e0971-168">If the reference table is static, the package can avoid the potentially expensive process of rebuilding the index for repeat sessions of data cleaning.</span></span> <span data-ttu-id="e0971-169">既存のインデックスを使用するように選択した場合、パッケージが初めて実行されたときにインデックスが作成されます。</span><span class="sxs-lookup"><span data-stu-id="e0971-169">If you choose to use an existing index, the index is created the first time that the package runs.</span></span> <span data-ttu-id="e0971-170">複数のあいまい参照変換で同じ参照テーブルを使用する場合、すべて同じインデックスを使用できます。</span><span class="sxs-lookup"><span data-stu-id="e0971-170">If multiple Fuzzy Lookup transformations use the same reference table, they can all use the same index.</span></span> <span data-ttu-id="e0971-171">インデックスを再使用するには、参照操作が同一で、参照に同じ列を使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e0971-171">To reuse the index, the lookup operations must be identical; the lookup must use the same columns.</span></span> <span data-ttu-id="e0971-172">インデックスには名前を付けることができ、インデックスを保存する [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] データベースへの接続を選択できます。</span><span class="sxs-lookup"><span data-stu-id="e0971-172">You can name the index and select the connection to the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] database that saves the index.</span></span>  
  
 <span data-ttu-id="e0971-173">変換で一致インデックスが保存されると、この一致インデックスは自動的に維持されます。</span><span class="sxs-lookup"><span data-stu-id="e0971-173">If the transformation saves the match index, the match index can be maintained automatically.</span></span> <span data-ttu-id="e0971-174">つまり、参照テーブルのレコードが更新されるたびに、一致インデックスも更新されます。</span><span class="sxs-lookup"><span data-stu-id="e0971-174">This means that every time a record in the reference table is updated, the match index is also updated.</span></span> <span data-ttu-id="e0971-175">一致インデックスを維持することで処理時間を節約できます。これは、パッケージを実行する際に、インデックスを再作成する必要がないからです。</span><span class="sxs-lookup"><span data-stu-id="e0971-175">Maintaining the match index can save processing time, because the index does not have to be rebuilt when the package runs.</span></span> <span data-ttu-id="e0971-176">変換が一致インデックスを管理する方法を指定できます。</span><span class="sxs-lookup"><span data-stu-id="e0971-176">You can specify how the transformation manages the match index.</span></span>  
  
 <span data-ttu-id="e0971-177">次の表に、一致インデックスのオプションを示します。</span><span class="sxs-lookup"><span data-stu-id="e0971-177">The following table describes the match index options.</span></span>  
  
|<span data-ttu-id="e0971-178">オプション</span><span class="sxs-lookup"><span data-stu-id="e0971-178">Option</span></span>|<span data-ttu-id="e0971-179">説明</span><span class="sxs-lookup"><span data-stu-id="e0971-179">Description</span></span>|  
|------------|-----------------|  
|<span data-ttu-id="e0971-180">**GenerateAndMaintainNewIndex**</span><span class="sxs-lookup"><span data-stu-id="e0971-180">**GenerateAndMaintainNewIndex**</span></span>|<span data-ttu-id="e0971-181">新しいインデックスを作成して保存し、維持します。</span><span class="sxs-lookup"><span data-stu-id="e0971-181">Create a new index, save it, and maintain it.</span></span> <span data-ttu-id="e0971-182">変換は、参照テーブルとインデックス テーブルの同期を保つためのトリガーを参照テーブルに組み込みます。</span><span class="sxs-lookup"><span data-stu-id="e0971-182">The transformation installs triggers on the reference table to keep the reference table and index table synchronized.</span></span>|  
|<span data-ttu-id="e0971-183">**GenerateAndPersistNewIndex**</span><span class="sxs-lookup"><span data-stu-id="e0971-183">**GenerateAndPersistNewIndex**</span></span>|<span data-ttu-id="e0971-184">新しいインデックスを作成し保存しますが、維持はしません。</span><span class="sxs-lookup"><span data-stu-id="e0971-184">Create a new index and save it, but do not maintain it.</span></span>|  
|<span data-ttu-id="e0971-185">**GenerateNewIndex**</span><span class="sxs-lookup"><span data-stu-id="e0971-185">**GenerateNewIndex**</span></span>|<span data-ttu-id="e0971-186">新しいインデックスを作成しますが、保存しません。</span><span class="sxs-lookup"><span data-stu-id="e0971-186">Create a new index, but do not save it.</span></span>|  
|<span data-ttu-id="e0971-187">**ReuseExistingIndex**</span><span class="sxs-lookup"><span data-stu-id="e0971-187">**ReuseExistingIndex**</span></span>|<span data-ttu-id="e0971-188">既存のインデックスを再使用します。</span><span class="sxs-lookup"><span data-stu-id="e0971-188">Reuse an existing index.</span></span>|  
  
### <a name="maintenance-of-the-match-index-table"></a><span data-ttu-id="e0971-189">一致インデックス テーブルのメンテナンス</span><span class="sxs-lookup"><span data-stu-id="e0971-189">Maintenance of the Match Index Table</span></span>  
 <span data-ttu-id="e0971-190">**GenerateAndMaintainNewIndex** オプションを指定すると、一致インデックス テーブルと参照テーブルの同期を保つためのトリガーが参照テーブルに組み込まれます。</span><span class="sxs-lookup"><span data-stu-id="e0971-190">The **GenerateAndMaintainNewIndex** option installs triggers on the reference table to keep the match index table and the reference table synchronized.</span></span> <span data-ttu-id="e0971-191">組み込んだトリガーを削除する必要がある場合は、入力パラメーター値として MatchIndexName プロパティに指定した名前を設定して、 **sp_FuzzyLookupTableMaintenanceUnInstall** ストアド プロシージャを実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e0971-191">If you have to remove the installed trigger, you must run the **sp_FuzzyLookupTableMaintenanceUnInstall** stored procedure, and provide the name specified in the MatchIndexName property as the input parameter value.</span></span>  
  
 <span data-ttu-id="e0971-192">**sp_FuzzyLookupTableMaintenanceUnInstall** ストアド プロシージャを実行する前に、維持されている一致インデックス テーブルを削除しないでください。</span><span class="sxs-lookup"><span data-stu-id="e0971-192">You should not delete the maintained match index table before running the **sp_FuzzyLookupTableMaintenanceUnInstall** stored procedure.</span></span> <span data-ttu-id="e0971-193">一致インデックス テーブルが削除されると、参照テーブルのトリガーが正しく実行されなくなります。</span><span class="sxs-lookup"><span data-stu-id="e0971-193">If the match index table is deleted, the triggers on the reference table will not execute correctly.</span></span> <span data-ttu-id="e0971-194">参照テーブルのトリガーを手動で削除するまで、参照テーブルに対する、以降の更新はすべて失敗します。</span><span class="sxs-lookup"><span data-stu-id="e0971-194">All subsequent updates to the reference table will fail until you manually drop the triggers on the reference table.</span></span>  
  
 <span data-ttu-id="e0971-195">SQL の TRUNCATE TABLE コマンドでは、DELETE トリガーは起動されません。</span><span class="sxs-lookup"><span data-stu-id="e0971-195">The SQL TRUNCATE TABLE command does not invoke DELETE triggers.</span></span> <span data-ttu-id="e0971-196">TRUNCATE TABLE コマンドが参照テーブルに対して使用されると、参照テーブルと一致インデックスが同期されなくなり、あいまい参照変換が失敗します。</span><span class="sxs-lookup"><span data-stu-id="e0971-196">If the TRUNCATE TABLE command is used on the reference table, the reference table and the match index will no longer be synchronized and the Fuzzy Lookup transformation fails.</span></span> <span data-ttu-id="e0971-197">一致インデックス テーブルを維持するトリガーが参照テーブルに組み込まれている場合は、TRUNCATE TABLE コマンドではなく、SQL の DELETE コマンドを使用してください。</span><span class="sxs-lookup"><span data-stu-id="e0971-197">While the triggers that maintain the match index table are installed on the reference table, you should use the SQL DELETE command instead of the TRUNCATE TABLE command.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="e0971-198">**[あいまい参照変換エディター]** ダイアログ ボックスの **[参照テーブル]** タブで **[保存されたインデックスを維持する]** を選択すると、変換ではマネージド ストアド プロシージャを使用してインデックスを維持します。</span><span class="sxs-lookup"><span data-stu-id="e0971-198">When you select **Maintain stored index** on the **Reference Table** tab of the **Fuzzy Lookup Transformation Editor**, the transformation uses managed stored procedures to maintain the index.</span></span> <span data-ttu-id="e0971-199">これらのマネージド ストアド プロシージャは、 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]の共通言語ランタイム (CLR) 統合機能を使用します。</span><span class="sxs-lookup"><span data-stu-id="e0971-199">These managed stored procedures use the common language runtime (CLR) integration feature in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="e0971-200">既定では、 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] の CLR 統合は無効です。</span><span class="sxs-lookup"><span data-stu-id="e0971-200">By default, CLR integration in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] is not enabled.</span></span> <span data-ttu-id="e0971-201">**[保存されたインデックスを維持する]** 機能を使用するには、CLR 統合を有効にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="e0971-201">To use the **Maintain stored index** functionality, you must enable CLR integration.</span></span> <span data-ttu-id="e0971-202">詳細については、「 [CLR 統合の有効化](../../../relational-databases/clr-integration/clr-integration-enabling.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="e0971-202">For more information, see [Enabling CLR Integration](../../../relational-databases/clr-integration/clr-integration-enabling.md).</span></span>  
>   
>  <span data-ttu-id="e0971-203">**[保存されたインデックスを維持する]** オプションは CLR 統合を必要とするため、この機能を使用できるのは、CLR 統合が有効になっている [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] のインスタンスの参照テーブルを選択した場合だけです。</span><span class="sxs-lookup"><span data-stu-id="e0971-203">Because the **Maintain stored index** option requires CLR integration, this feature works only when you select a reference table on an instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] where CLR integration is enabled.</span></span>  
  
## <a name="row-comparison"></a><span data-ttu-id="e0971-204">行の比較</span><span class="sxs-lookup"><span data-stu-id="e0971-204">Row Comparison</span></span>  
 <span data-ttu-id="e0971-205">あいまい参照変換を構成する際には、参照テーブル内の一致するレコードの検索に使用する比較アルゴリズムを指定できます。</span><span class="sxs-lookup"><span data-stu-id="e0971-205">When you configure the Fuzzy Lookup transformation, you can specify the comparison algorithm that the transformation uses to locate matching records in the reference table.</span></span> <span data-ttu-id="e0971-206">[完全] プロパティをに設定すると、変換によって、 `True` 入力内のすべての行が参照テーブルのすべての行と比較されます。</span><span class="sxs-lookup"><span data-stu-id="e0971-206">If you set the Exhaustive property to `True`, the transformation compares every row in the input to every row in the reference table.</span></span> <span data-ttu-id="e0971-207">この比較アルゴリズムを使用すると、より正確な結果が生成されますが、参照テーブルの行の数が少ない場合を除けば、処理により多くの時間がかかるようになります。</span><span class="sxs-lookup"><span data-stu-id="e0971-207">This comparison algorithm may produce more accurate results, but it is likely to make the transformation perform more slowly unless the number of rows is the reference table is small.</span></span> <span data-ttu-id="e0971-208">完全なプロパティがに設定されている場合 `True` 、参照テーブル全体がメモリに読み込まれます。</span><span class="sxs-lookup"><span data-stu-id="e0971-208">If the Exhaustive property is set to `True`, the entire reference table is loaded into memory.</span></span> <span data-ttu-id="e0971-209">パフォーマンスの問題を回避するには、パッケージの開発中にのみ、完全なプロパティをに設定することをお勧めし `True` ます。</span><span class="sxs-lookup"><span data-stu-id="e0971-209">To avoid performance issues, it is advisable to set the Exhaustive property to `True` during package development only.</span></span>  
  
 <span data-ttu-id="e0971-210">完全なプロパティがに設定されている場合 `False` 、あいまい参照変換は、少なくとも1つのインデックス付きトークンまたは部分文字列 (部分文字列が*q&a*と呼ばれます) を持つ一致のみを入力レコードと共に返します。</span><span class="sxs-lookup"><span data-stu-id="e0971-210">If the Exhaustive property is set to `False`, the Fuzzy Lookup transformation returns only matches that have at least one indexed token or substring (the substring is called a *q-gram*) in common with the input record.</span></span> <span data-ttu-id="e0971-211">参照の効率を最大にするために、あいまい参照変換が一致の検索に使用する逆インデックス構造で、テーブルの各行に含まれたトークンのサブセットにのみインデックス付けが行われます。</span><span class="sxs-lookup"><span data-stu-id="e0971-211">To maximize the efficiency of lookups, only a subset of the tokens in each row in the table is indexed in the inverted index structure that the Fuzzy Lookup transformation uses to locate matches.</span></span> <span data-ttu-id="e0971-212">入力データセットが小さい場合は、完全にをに設定して、 `True` インデックステーブルに共通のトークンが存在しない一致が見つからないようにすることができます。</span><span class="sxs-lookup"><span data-stu-id="e0971-212">When the input dataset is small, you can set Exhaustive to `True` to avoid missing matches for which no common tokens exist in the index table.</span></span>  
  
## <a name="caching-of-indexes-and-reference-tables"></a><span data-ttu-id="e0971-213">インデックス テーブルと参照テーブルのキャッシュ</span><span class="sxs-lookup"><span data-stu-id="e0971-213">Caching of Indexes and Reference Tables</span></span>  
 <span data-ttu-id="e0971-214">あいまい参照変換の設定時に、インデックス テーブルと参照テーブルの一部を、変換を開始する前にメモリにキャッシュするかどうかを指定できます。</span><span class="sxs-lookup"><span data-stu-id="e0971-214">When you configure the Fuzzy Lookup transformation, you can specify whether the transformation partially caches the index and reference table in memory before the transformation does its work.</span></span> <span data-ttu-id="e0971-215">"表示" プロパティをに設定すると `True` 、インデックスと参照テーブルがメモリに読み込まれます。</span><span class="sxs-lookup"><span data-stu-id="e0971-215">If you set the WarmCaches property to `True`, the index and reference table are loaded into memory.</span></span> <span data-ttu-id="e0971-216">入力に多数の行が含まれている場合、"出力" プロパティをに設定すると、 `True` 変換のパフォーマンスが向上します。</span><span class="sxs-lookup"><span data-stu-id="e0971-216">When the input has many rows, setting the WarmCaches property to `True` can improve the performance of the transformation.</span></span> <span data-ttu-id="e0971-217">入力行の数が少ない場合は、"make Mcache" プロパティをに設定すると、 `False` 大きなインデックスを再利用できるようになります。</span><span class="sxs-lookup"><span data-stu-id="e0971-217">When the number of input rows is small, setting the WarmCaches property to `False` can make the reuse of a large index faster.</span></span>  
  
## <a name="temporary-tables-and-indexes"></a><span data-ttu-id="e0971-218">一時テーブルおよびインデックス</span><span class="sxs-lookup"><span data-stu-id="e0971-218">Temporary Tables and Indexes</span></span>  
 <span data-ttu-id="e0971-219">あいまい参照変換の実行時には、変換の接続先の [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] データベース内に、テーブルやインデックスなどの一時オブジェクトが作成されます。</span><span class="sxs-lookup"><span data-stu-id="e0971-219">At run time, the Fuzzy Lookup transformation creates temporary objects, such as tables and indexes, in the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] database that the transformation connects to.</span></span> <span data-ttu-id="e0971-220">これらの一時テーブルとインデックスのサイズは、参照テーブルの行数とトークン数や、あいまい参照変換が作成するトークン数に比例します。したがって、膨大なディスク容量を消費する可能性もあります。</span><span class="sxs-lookup"><span data-stu-id="e0971-220">The size of these temporary tables and indexes is proportionate to the number of rows and tokens in the reference table and the number of tokens that the Fuzzy Lookup transformation creates; therefore, they could potentially consume a significant amount of disk space.</span></span> <span data-ttu-id="e0971-221">また、変換はこれらの一時テーブルに対してクエリを実行します。</span><span class="sxs-lookup"><span data-stu-id="e0971-221">The transformation also queries these temporary tables.</span></span> <span data-ttu-id="e0971-222">このため、特に稼働サーバーのディスク容量が少ない場合は、あいまい参照変換を [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] データベースの非稼働インスタンスに接続することを検討してください。</span><span class="sxs-lookup"><span data-stu-id="e0971-222">You should therefore consider connecting the Fuzzy Lookup transformation to a non-production instance of a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] database, especially if the production server has limited disk space available.</span></span>  
  
 <span data-ttu-id="e0971-223">この変換で使用するテーブルおよびインデックスがローカル コンピューター上にあると、変換のパフォーマンスが向上する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="e0971-223">The performance of this transformation may improve if the tables and indexes it uses are located on the local computer.</span></span> <span data-ttu-id="e0971-224">あいまい参照変換が使用する参照テーブルが稼働サーバー上にある場合は、テーブルを非稼働サーバーにコピーして、あいまい参照変換がこのコピーにアクセスするように設定することを検討してください。</span><span class="sxs-lookup"><span data-stu-id="e0971-224">If the reference table that the Fuzzy Lookup transformation uses is on the production server, you should consider copying the table to a non-production server and configuring the Fuzzy Lookup transformation to access the copy.</span></span> <span data-ttu-id="e0971-225">こうすることで、参照クエリによって稼働サーバーのリソースが消費されるのを回避できます。</span><span class="sxs-lookup"><span data-stu-id="e0971-225">By doing this, you can prevent the lookup queries from consuming resources on the production server.</span></span> <span data-ttu-id="e0971-226">また、MatchIndexOptionsis が **GenerateAndMaintainNewIndex** に設定されていて、あいまい参照変換で一致インデックスが維持されている場合は、データ クリーン操作中に参照テーブルがロックされ、他のユーザーやアプリケーションはテーブルにアクセスできません。</span><span class="sxs-lookup"><span data-stu-id="e0971-226">In addition, if the Fuzzy Lookup transformation maintains the match index-that is, if MatchIndexOptionsis set to **GenerateAndMaintainNewIndex**-the transformation may lock the reference table for the duration of the data cleaning operation and prevent other users and applications from accessing the table.</span></span>  
  
## <a name="configuring-the-fuzzy-lookup-transformation"></a><span data-ttu-id="e0971-227">あいまい参照変換の設定</span><span class="sxs-lookup"><span data-stu-id="e0971-227">Configuring the Fuzzy Lookup Transformation</span></span>  
 <span data-ttu-id="e0971-228">プロパティを設定するには [!INCLUDE[ssIS](../../../includes/ssis-md.md)] デザイナーから行うか、またはプログラムによって設定します。</span><span class="sxs-lookup"><span data-stu-id="e0971-228">You can set properties through [!INCLUDE[ssIS](../../../includes/ssis-md.md)] Designer or programmatically.</span></span>  
  
 <span data-ttu-id="e0971-229">**[あいまい参照変換エディター]** ダイアログ ボックスで設定できるプロパティの詳細については、次のトピックのいずれかを参照してください。</span><span class="sxs-lookup"><span data-stu-id="e0971-229">For more information about the properties that you can set in the **Fuzzy Lookup Transformation Editor** dialog box, click one of the following topics:</span></span>  
  
-   <span data-ttu-id="e0971-230">[あいまい参照変換エディター ([参照テーブル] タブ)](../../fuzzy-lookup-transformation-editor-reference-table-tab.md)</span><span class="sxs-lookup"><span data-stu-id="e0971-230">[Fuzzy Lookup Transformation Editor &#40;Reference Table Tab&#41;](../../fuzzy-lookup-transformation-editor-reference-table-tab.md)</span></span>  
  
-   <span data-ttu-id="e0971-231">[あいまい参照変換エディター ([列] タブ)](../../fuzzy-lookup-transformation-editor-columns-tab.md)</span><span class="sxs-lookup"><span data-stu-id="e0971-231">[Fuzzy Lookup Transformation Editor &#40;Columns Tab&#41;](../../fuzzy-lookup-transformation-editor-columns-tab.md)</span></span>  
  
-   <span data-ttu-id="e0971-232">[[あいまい参照変換エディター] &#40;[詳細設定] タブ&#41;](../../fuzzy-lookup-transformation-editor-advanced-tab.md)</span><span class="sxs-lookup"><span data-stu-id="e0971-232">[Fuzzy Lookup Transformation Editor &#40;Advanced Tab&#41;](../../fuzzy-lookup-transformation-editor-advanced-tab.md)</span></span>  
  
 <span data-ttu-id="e0971-233">**[詳細エディター]** ダイアログ ボックスまたはプログラムで設定できるプロパティの詳細については、次のトピックのいずれかを参照してください。</span><span class="sxs-lookup"><span data-stu-id="e0971-233">For more information about the properties that you can set in the **Advanced Editor** dialog box or programmatically, click one of the following topics:</span></span>  
  
-   [<span data-ttu-id="e0971-234">Common Properties</span><span class="sxs-lookup"><span data-stu-id="e0971-234">Common Properties</span></span>](../../common-properties.md)  
  
-   [<span data-ttu-id="e0971-235">変換のカスタム プロパティ</span><span class="sxs-lookup"><span data-stu-id="e0971-235">Transformation Custom Properties</span></span>](transformation-custom-properties.md)  
  
## <a name="related-tasks"></a><span data-ttu-id="e0971-236">Related Tasks</span><span class="sxs-lookup"><span data-stu-id="e0971-236">Related Tasks</span></span>  
 <span data-ttu-id="e0971-237">データ フロー コンポーネントのプロパティの設定方法の詳細については、「 [データ フロー コンポーネントのプロパティを設定する](../set-the-properties-of-a-data-flow-component.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="e0971-237">For details about how to set properties of a data flow component, see [Set the Properties of a Data Flow Component](../set-the-properties-of-a-data-flow-component.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="e0971-238">参照</span><span class="sxs-lookup"><span data-stu-id="e0971-238">See Also</span></span>  
 <span data-ttu-id="e0971-239">[参照変換](lookup-transformation.md) </span><span class="sxs-lookup"><span data-stu-id="e0971-239">[Lookup Transformation](lookup-transformation.md) </span></span>  
 <span data-ttu-id="e0971-240">[あいまいグループ化変換](fuzzy-grouping-transformation.md) </span><span class="sxs-lookup"><span data-stu-id="e0971-240">[Fuzzy Grouping Transformation](fuzzy-grouping-transformation.md) </span></span>  
 [<span data-ttu-id="e0971-241">Integration Services の変換</span><span class="sxs-lookup"><span data-stu-id="e0971-241">Integration Services Transformations</span></span>](integration-services-transformations.md)  
  
  
