---
title: CDC 制御タスク | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: integration-services
ms.topic: conceptual
f1_keywords:
- sql12.ssis.designer.cdccontroltask.f1
ms.assetid: 6404dc7f-550c-47cc-b901-c072742f430a
author: chugugrace
ms.author: chugu
ms.openlocfilehash: 36f98a02842353fd5196432738f4ebd8b2efb46c
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87640200"
---
# <a name="cdc-control-task"></a><span data-ttu-id="1445e-102">CDC 制御タスク</span><span class="sxs-lookup"><span data-stu-id="1445e-102">CDC Control Task</span></span>
  <span data-ttu-id="1445e-103">CDC 制御タスクは、変更データ キャプチャ (CDC) パッケージのライフ サイクルの制御に使用します。</span><span class="sxs-lookup"><span data-stu-id="1445e-103">The CDC Control task is used to control the life cycle of change data capture (CDC) packages.</span></span> <span data-ttu-id="1445e-104">CDC 制御タスクは、初期読み込みパッケージと CDC パッケージとの同期処理を行い、CDC パッケージの実行で処理されるログ シーケンス番号 (LSN) 範囲を管理します。</span><span class="sxs-lookup"><span data-stu-id="1445e-104">It handles CDC package synchronization with the initial load package, the management of Log Sequence Number (LSN) ranges that are processed in a run of a CDC package.</span></span> <span data-ttu-id="1445e-105">また、エラー シナリオおよび復旧の処理も行います。</span><span class="sxs-lookup"><span data-stu-id="1445e-105">In addition, the CDC Control task deals with error scenarios and recovery.</span></span>  
  
 <span data-ttu-id="1445e-106">CDC 制御タスクは CDC パッケージの状態を SSIS パッケージ変数に保持します。また、データベース テーブルに保存して、アクティブ化されるパッケージ間および共通の CDC プロセスを実行する複数のパッケージ間 (たとえば、あるタスクが初期読み込みを実行し、別のタスクがトリクル フィード更新を実行する場合) で状態が維持されるようにすることもできます。</span><span class="sxs-lookup"><span data-stu-id="1445e-106">The CDC Control task maintains the state of the CDC package in an SSIS package variable and it can also persist it in a database table so that the state is maintained across package activations and between multiple packages that together perform a common CDC process (for example, one task may be responsible for the initial loading and the other for the trickle-feed updates).</span></span>  
  
 <span data-ttu-id="1445e-107">CDC 制御タスクでは、2 つのグループの操作がサポートされます。</span><span class="sxs-lookup"><span data-stu-id="1445e-107">The CDC Control task supports two groups of operations.</span></span> <span data-ttu-id="1445e-108">1 つ目のグループは初期読み込みと変更処理との間の同期処理を行い、もう 1 つのグループは CDC パッケージ実行時の LSN の変更処理範囲の管理と正常に処理された範囲の追跡を行います。</span><span class="sxs-lookup"><span data-stu-id="1445e-108">One group handles the synchronization of initial load and change processing, and the other manages the change-processing range of LSNs for a run of a CDC package and keeps track of what was processed successfully.</span></span>  
  
 <span data-ttu-id="1445e-109">次の操作は、初期読み込みと変更処理との間の同期処理を行います。</span><span class="sxs-lookup"><span data-stu-id="1445e-109">The following operations handle the synchronization of initial load and change processing:</span></span>  
  
|<span data-ttu-id="1445e-110">操作</span><span class="sxs-lookup"><span data-stu-id="1445e-110">Operation</span></span>|<span data-ttu-id="1445e-111">説明</span><span class="sxs-lookup"><span data-stu-id="1445e-111">Description</span></span>|  
|---------------|-----------------|  
|<span data-ttu-id="1445e-112">ResetCdcState</span><span class="sxs-lookup"><span data-stu-id="1445e-112">ResetCdcState</span></span>|<span data-ttu-id="1445e-113">この操作は、現在の CDC コンテキストに関連付けられた、永続的な CDC の状態をリセットするために使用されます。</span><span class="sxs-lookup"><span data-stu-id="1445e-113">This operation is used to reset the persistent CDC state associated with the current CDC context.</span></span> <span data-ttu-id="1445e-114">この操作の実行後に、LSN-timestamp `sys.fn_cdc_get_max_lsn` テーブルの現在の最大 LSN が次の処理範囲の開始位置になります。</span><span class="sxs-lookup"><span data-stu-id="1445e-114">After this operation is run, the current maximum LSN from the LSN-timestamp `sys.fn_cdc_get_max_lsn` table becomes the start of the range for the next processing range.</span></span> <span data-ttu-id="1445e-115">この操作には、ソース データベースへの接続が必要です。</span><span class="sxs-lookup"><span data-stu-id="1445e-115">This operation requires a connection to the source database.</span></span>|  
|<span data-ttu-id="1445e-116">MarkInitialLoadStart</span><span class="sxs-lookup"><span data-stu-id="1445e-116">MarkInitialLoadStart</span></span>|<span data-ttu-id="1445e-117">この操作は初期読み込みパッケージの開始時に使用され、ソース データベースで現在の LSN を記録します。その後、初期読み込みパッケージがソース テーブルの読み取りを開始します。</span><span class="sxs-lookup"><span data-stu-id="1445e-117">This operation is used at the beginning of an initial-load package to record the current LSN in the source database before the initial-load package starts reading the source tables.</span></span> <span data-ttu-id="1445e-118">この操作には、 `sys.fn_cdc_get_max_lsn`を呼び出すための、ソース データベースへの接続が必要です。</span><span class="sxs-lookup"><span data-stu-id="1445e-118">This requires a connection to the source database to call `sys.fn_cdc_get_max_lsn`.</span></span><br /><br /> <span data-ttu-id="1445e-119">(Oracle ではなく) [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] CDC での作業時に MarkInitialLoadStart を選択した場合、接続マネージャーで指定されたユーザーは、db_owner か sysadmin である必要があります。</span><span class="sxs-lookup"><span data-stu-id="1445e-119">If you select MarkInitialLoadStart when working on [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] CDC (that is, not Oracle) the user specified in the connection manager must be either  db_owner or sysadmin.</span></span>|  
|<span data-ttu-id="1445e-120">MarkInitialLoadEnd</span><span class="sxs-lookup"><span data-stu-id="1445e-120">MarkInitialLoadEnd</span></span>|<span data-ttu-id="1445e-121">この操作は初期読み込みパッケージの終了時に使用され、初期読み込みパッケージがソース テーブルの読み取りを終了した後で、ソース データベースで現在の LSN を記録します。</span><span class="sxs-lookup"><span data-stu-id="1445e-121">This operation is used at the end of an initial-load package to record the current LSN in the source database after the initial-load package finished reading the source tables.</span></span> <span data-ttu-id="1445e-122">この LSN を特定するために、この操作が発生したときの時刻が記録され、CDC データベース内の `cdc.lsn_time_`マッピング テーブルに対するクエリにより、その時刻より後に行われた変更が検索されます。</span><span class="sxs-lookup"><span data-stu-id="1445e-122">This LSN is determined by recording the current time when this operation occurred and then querying the `cdc.lsn_time_`mapping table in the CDC database looking for a change that occurred after that time.</span></span><br /><br /> <span data-ttu-id="1445e-123">(Oracle ではなく) [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] CDC での作業時に MarkInitialLoadEnd を選択した場合、接続マネージャーで指定されたユーザーは、db_owner か sysadmin である必要があります。</span><span class="sxs-lookup"><span data-stu-id="1445e-123">If you select MarkInitialLoadEnd when working on [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] CDC (that is , not Oracle) the user specified in the connection manager must be either  db_owner or sysadmin.</span></span>|  
|<span data-ttu-id="1445e-124">MarkCdcStart</span><span class="sxs-lookup"><span data-stu-id="1445e-124">MarkCdcStart</span></span>|<span data-ttu-id="1445e-125">この操作は、初期読み込みがスナップショット データベースから行われるときに使用されます。</span><span class="sxs-lookup"><span data-stu-id="1445e-125">This operation is used when then the initial load is made from a snapshot database.</span></span> <span data-ttu-id="1445e-126">この場合、変更処理は、スナップショット LSN の直後から開始されます。</span><span class="sxs-lookup"><span data-stu-id="1445e-126">In this case, the change processing should start immediately after the snapshot LSN.</span></span> <span data-ttu-id="1445e-127">使用するスナップショット データベースの名前と、スナップショット LSN に関するクエリを [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] に対して実行する CDC 制御タスクを使用できます。</span><span class="sxs-lookup"><span data-stu-id="1445e-127">You can specify the name of the snapshot database to use and the CDC Control task queries [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] for the snapshot LSN.</span></span> <span data-ttu-id="1445e-128">また、スナップショット LSN を直接指定するオプションもあります。</span><span class="sxs-lookup"><span data-stu-id="1445e-128">You also have the option to directly specify the snapshot LSN.</span></span><br /><br /> <span data-ttu-id="1445e-129">(Oracle ではなく) [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] CDC での作業時に MarkCdcStart を選択した場合、接続マネージャーで指定されたユーザーは、db_owner か sysadmin である必要があります。</span><span class="sxs-lookup"><span data-stu-id="1445e-129">If you select MarkCdcStart when working on [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] CDC (that is , not Oracle) the user specified in the connection manager must be either  db_owner or sysadmin.</span></span>|  
  
 <span data-ttu-id="1445e-130">処理範囲の管理には、次の操作を使用します。</span><span class="sxs-lookup"><span data-stu-id="1445e-130">The following operations are used to manage the processing range:</span></span>  
  
|<span data-ttu-id="1445e-131">操作</span><span class="sxs-lookup"><span data-stu-id="1445e-131">Operation</span></span>|<span data-ttu-id="1445e-132">説明</span><span class="sxs-lookup"><span data-stu-id="1445e-132">Description</span></span>|  
|---------------|-----------------|  
|<span data-ttu-id="1445e-133">GetProcessingRange</span><span class="sxs-lookup"><span data-stu-id="1445e-133">GetProcessingRange</span></span>|<span data-ttu-id="1445e-134">この操作は、CDC ソース データ フローを使用するデータ フローを呼び出す前に使用されます。</span><span class="sxs-lookup"><span data-stu-id="1445e-134">This operation is used before invoking the data flow that uses the CDC Source data flow.</span></span> <span data-ttu-id="1445e-135">この操作は、呼び出し時に CDC ソース データ フローが読み取る LSN の範囲を設定します。</span><span class="sxs-lookup"><span data-stu-id="1445e-135">It establishes a range of LSNs that the CDC Source data flow reads when invoked.</span></span> <span data-ttu-id="1445e-136">範囲は、データ フローの処理中に CDC ソースによって使用される SSIS パッケージ変数に格納されます。</span><span class="sxs-lookup"><span data-stu-id="1445e-136">The range is stored in an SSIS package variable that is used by the CDC Source during data-flow processing.</span></span><br /><br /> <span data-ttu-id="1445e-137">格納される状態の詳細については、「 [状態変数の定義](../data-flow/define-a-state-variable.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="1445e-137">For more information about the states that are stored, see [Define a State Variable](../data-flow/define-a-state-variable.md).</span></span>|  
|<span data-ttu-id="1445e-138">MarkProcessedRange</span><span class="sxs-lookup"><span data-stu-id="1445e-138">MarkProcessedRange</span></span>|<span data-ttu-id="1445e-139">この操作は、CDC 実行で完全に処理された最後の LSN を記録するために、各 CDC の実行後 (CDC データ フローが正常に完了した後) に実行されます。</span><span class="sxs-lookup"><span data-stu-id="1445e-139">: This operation is executed after each CDC run (after the CDC data flow is completed successfully) to record the last LSN that was fully processed in the CDC run.</span></span> <span data-ttu-id="1445e-140">GetProcessingRange を次に実行する際、この位置が次の処理範囲の開始位置になります。</span><span class="sxs-lookup"><span data-stu-id="1445e-140">The next time GetProcessingRange is executed, this position is the start of the processing range.</span></span>|  
  
## <a name="handling-cdc-state-persistency"></a><span data-ttu-id="1445e-141">CDC 状態の永続性の処理</span><span class="sxs-lookup"><span data-stu-id="1445e-141">Handling CDC State Persistency</span></span>  
 <span data-ttu-id="1445e-142">CDC 制御タスクは、アクティブ化のたびに永続的な状態を維持します。</span><span class="sxs-lookup"><span data-stu-id="1445e-142">The CDC Control task maintains a persistent state between activations.</span></span> <span data-ttu-id="1445e-143">CDC 状態に格納される情報を使用して CDC パッケージの処理範囲およびエラー条件を検出する処理範囲を決定し、管理します。</span><span class="sxs-lookup"><span data-stu-id="1445e-143">The information stored in the CDC state is used to determine and maintain the processing range for the CDC package and for detecting error conditions.</span></span> <span data-ttu-id="1445e-144">永続的な状態は文字列として格納されます。</span><span class="sxs-lookup"><span data-stu-id="1445e-144">The persistent state is stored as a string.</span></span> <span data-ttu-id="1445e-145">詳細については、「 [状態変数の定義](../data-flow/define-a-state-variable.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="1445e-145">For more information, see [Define a State Variable](../data-flow/define-a-state-variable.md).</span></span>  
  
 <span data-ttu-id="1445e-146">CDC 制御タスクは、2 種類の状態の永続性をサポートします。</span><span class="sxs-lookup"><span data-stu-id="1445e-146">The CDC Control task supports two types of state persistency</span></span>  
  
-   <span data-ttu-id="1445e-147">手動の状態の永続性: この場合、CDC 制御タスクがパッケージ変数に格納されている状態を管理しますが、パッケージ開発者は、CDC 制御を呼び出す前に永続的なストアから変数を読み取り、CDC 制御が最後に呼び出され、CDC の実行が完了した後で変数に書き戻す必要があります。</span><span class="sxs-lookup"><span data-stu-id="1445e-147">Manual State Persistency: In this case, the CDC Control task manages the state stored in a package variable but the package developer must read the variable from a persistent store before calling the CDC Control and then write it back to that persistent store after the CDC Control is last called and the CDC run completes.</span></span>  
  
-   <span data-ttu-id="1445e-148">自動の状態の永続性: CDC 状態はデータベースのテーブルに格納されます。</span><span class="sxs-lookup"><span data-stu-id="1445e-148">Automatic State Persistency: The CDC state is stored in a table in a database.</span></span> <span data-ttu-id="1445e-149">状態は、 **[状態の格納に使用するテーブル]** プロパティに指定されたテーブルに、 **StateName** プロパティに指定されている名前で格納されます。これは、状態を格納するために選択した接続マネージャー内にあります。</span><span class="sxs-lookup"><span data-stu-id="1445e-149">The state is stored under a name provided in the **StateName** property in a table named in the **Table to Use for Storing State** property, which is located in a selected connection manager for storing the state.</span></span> <span data-ttu-id="1445e-150">既定ではソース接続マネージャーですが、ターゲット接続マネージャーにするのが一般的です。</span><span class="sxs-lookup"><span data-stu-id="1445e-150">The default is the source connection manager but the common practice is for it to be the target connection manager.</span></span> <span data-ttu-id="1445e-151">CDC 制御タスクは状態テーブルの状態値を更新し、アンビエント トランザクションの一環としてコミットされます。</span><span class="sxs-lookup"><span data-stu-id="1445e-151">The CDC Control task updates the state value in the state table and this is committed as part of the ambient transaction.</span></span>  
  
## <a name="error-handling"></a><span data-ttu-id="1445e-152">エラー処理</span><span class="sxs-lookup"><span data-stu-id="1445e-152">Error Handling</span></span>  
 <span data-ttu-id="1445e-153">CDC 制御タスクは、次の場合にエラーを報告することがあります。</span><span class="sxs-lookup"><span data-stu-id="1445e-153">The CDC Control task may report an error when:</span></span>  
  
-   <span data-ttu-id="1445e-154">永続的な CDC 状態の読み取りに失敗したとき、または永続的な状態の更新が失敗したとき。</span><span class="sxs-lookup"><span data-stu-id="1445e-154">It fails to read the persistent CDC state or when updating the persistent state fails.</span></span>  
  
-   <span data-ttu-id="1445e-155">ソース データベースからの現在の LSN 情報の読み取りに失敗したとき。</span><span class="sxs-lookup"><span data-stu-id="1445e-155">It fails to read the current LSN information from the source database.</span></span>  
  
-   <span data-ttu-id="1445e-156">読み取った CDC 状態に一貫性がないとき。</span><span class="sxs-lookup"><span data-stu-id="1445e-156">The CDC state read is not consistent.</span></span>  
  
 <span data-ttu-id="1445e-157">このような場合、CDC 制御タスクはエラーを報告します。このエラーは、SSIS が制御フローのエラーを処理する標準的な方法で処理できます。</span><span class="sxs-lookup"><span data-stu-id="1445e-157">In all of these cases, the CDC Control task reports an error that can be handled in the standard way SSIS handles control-flow errors.</span></span>  
  
 <span data-ttu-id="1445e-158">CDC 制御タスクは、GetProcessingRange 操作の直後、MarkProcessedRange が呼び出される前に別の GetProcessingRange 操作が呼び出された場合に、警告も報告します。</span><span class="sxs-lookup"><span data-stu-id="1445e-158">The CDC Control task may also report a warning when the Get Processing Range operation is invoked directly after another Get Processing Range operation without Mark Processed Range being called.</span></span> <span data-ttu-id="1445e-159">これは、先に実行された操作が失敗した状況、または、別の CDC パッケージが同じ CDC 状態名を使用して実行されている状況を示します。</span><span class="sxs-lookup"><span data-stu-id="1445e-159">This is an indication that the previous run failed or that another CDC package may be running using the same CDC state name.</span></span>  
  
## <a name="configuring-the-cdc-control-task"></a><span data-ttu-id="1445e-160">CDC 制御タスクの構成</span><span class="sxs-lookup"><span data-stu-id="1445e-160">Configuring the CDC Control Task</span></span>  
 <span data-ttu-id="1445e-161">プロパティは、SSIS デザイナーを使用して、またはプログラムによって設定できます。</span><span class="sxs-lookup"><span data-stu-id="1445e-161">You can set properties through SSIS Designer or programmatically.</span></span>  
  
## <a name="in-this-section"></a><span data-ttu-id="1445e-162">このセクションの内容</span><span class="sxs-lookup"><span data-stu-id="1445e-162">In This Section</span></span>  
  
-   [<span data-ttu-id="1445e-163">CDC 制御タスク エディター</span><span class="sxs-lookup"><span data-stu-id="1445e-163">CDC Control Task Editor</span></span>](../cdc-control-task-editor.md)  
  
-   [<span data-ttu-id="1445e-164">CDC 制御タスクのカスタム プロパティ</span><span class="sxs-lookup"><span data-stu-id="1445e-164">CDC Control Task Custom Properties</span></span>](cdc-control-task-custom-properties.md)  
  
## <a name="related-tasks"></a><span data-ttu-id="1445e-165">Related Tasks</span><span class="sxs-lookup"><span data-stu-id="1445e-165">Related Tasks</span></span>  
 [<span data-ttu-id="1445e-166">状態変数の定義</span><span class="sxs-lookup"><span data-stu-id="1445e-166">Define a State Variable</span></span>](../data-flow/define-a-state-variable.md)  
  
## <a name="related-content"></a><span data-ttu-id="1445e-167">関連コンテンツ</span><span class="sxs-lookup"><span data-stu-id="1445e-167">Related Content</span></span>  
  
-   <span data-ttu-id="1445e-168">social.technet.microsoft.com の技術記事「 [Microsoft SQL Server 2012 Change Data Capture for Oracle by Attunity のインストール](https://go.microsoft.com/fwlink/?LinkId=252958)」</span><span class="sxs-lookup"><span data-stu-id="1445e-168">Technical article, [Installing Microsoft SQL Server 2012 Change Data Capture for Oracle by Attunity](https://go.microsoft.com/fwlink/?LinkId=252958), on social.technet.microsoft.com.</span></span>  
  
-   <span data-ttu-id="1445e-169">social.technet.microsoft.com の技術記事「 [Microsoft Change Data Capture for Oracle by Attunity の構成の問題のトラブルシューティング](https://go.microsoft.com/fwlink/?LinkId=252960)」</span><span class="sxs-lookup"><span data-stu-id="1445e-169">Technical article, [Troubleshoot Configuration Issues in Microsoft Change Data Capture for Oracle by Attunity](https://go.microsoft.com/fwlink/?LinkId=252960), on social.technet.microsoft.com.</span></span>  
  
-   <span data-ttu-id="1445e-170">social.technet.microsoft.com の技術記事「 [Microsoft Change Data Capture for Oracle by Attunity の CDC インスタンス エラーのトラブルシューティング](https://go.microsoft.com/fwlink/?LinkId=252961)」</span><span class="sxs-lookup"><span data-stu-id="1445e-170">Technical article, [Troubleshoot CDC Instance Errors in Microsoft Change Data Capture for Oracle by Attunity](https://go.microsoft.com/fwlink/?LinkId=252961), on social.technet.microsoft.com.</span></span>  
  
  
