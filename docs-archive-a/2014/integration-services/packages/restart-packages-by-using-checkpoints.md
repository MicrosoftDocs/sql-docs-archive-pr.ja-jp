---
title: チェックポイントを使用してパッケージを再開する | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: integration-services
ms.topic: conceptual
helpviewer_keywords:
- checkpoints [Integration Services]
- restarting packages
- starting packages
ms.assetid: 48f2fbb7-8964-484a-8311-5126cf594bfb
author: chugugrace
ms.author: chugu
ms.openlocfilehash: aa0e0e9ad1da67bfc70dec61396ab026df62d3ee
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87642153"
---
# <a name="restart-packages-by-using-checkpoints"></a><span data-ttu-id="a4167-102">チェックポイントを使用してパッケージを再開する</span><span class="sxs-lookup"><span data-stu-id="a4167-102">Restart Packages by Using Checkpoints</span></span>
  [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] <span data-ttu-id="a4167-103">では、失敗したパッケージ全体を再実行する代わりに、失敗した時点から再開することができます。</span><span class="sxs-lookup"><span data-stu-id="a4167-103">can restart failed packages from the point of failure, instead of rerunning the whole package.</span></span> <span data-ttu-id="a4167-104">パッケージがチェックポイントを使用するように設定されている場合、パッケージの実行に関する情報がチェックポイント ファイルに書き込まれます。</span><span class="sxs-lookup"><span data-stu-id="a4167-104">If a package is configured to use checkpoints, information about package execution is written to a checkpoint file.</span></span> <span data-ttu-id="a4167-105">失敗したパッケージを再実行する場合、チェックポイント ファイルを使用して、失敗した時点からパッケージを再開します。</span><span class="sxs-lookup"><span data-stu-id="a4167-105">When the failed package is rerun, the checkpoint file is used to restart the package from the point of failure.</span></span> <span data-ttu-id="a4167-106">パッケージの実行が成功するとチェックポイント ファイルは削除され、次にパッケージが実行されるときに再度作成されます。</span><span class="sxs-lookup"><span data-stu-id="a4167-106">If the package runs successfully, the checkpoint file is deleted, and then re-created the next time the package is run.</span></span>  
  
 <span data-ttu-id="a4167-107">パッケージでチェックポイントを使用すると、次の利点があります。</span><span class="sxs-lookup"><span data-stu-id="a4167-107">Using checkpoints in a package can provide the following benefits.</span></span>  
  
-   <span data-ttu-id="a4167-108">大きなファイルのダウンロードおよびアップロードの繰り返しを防止します。</span><span class="sxs-lookup"><span data-stu-id="a4167-108">Avoid repeating the downloading and uploading of large files.</span></span> <span data-ttu-id="a4167-109">たとえば、FTP タスクを使用して複数の大きなファイルをダウンロードするパッケージで 1 つのファイルのダウンロードが失敗した場合、パッケージを再開して、そのファイルのみをダウンロードすることができます。</span><span class="sxs-lookup"><span data-stu-id="a4167-109">For example, a package that downloads multiple large files by using an FTP task for each download can be restarted after the downloading of a single file fails and then download only that file.</span></span>  
  
-   <span data-ttu-id="a4167-110">大量データ読み込みの繰り返しを防止します。</span><span class="sxs-lookup"><span data-stu-id="a4167-110">Avoid repeating the loading of large amounts of data.</span></span> <span data-ttu-id="a4167-111">たとえば、ディメンションごとに別々の一括挿入タスクを使用してデータ ウェアハウスのディメンション テーブルに一括挿入を行うパッケージで 1 つのディメンション テーブルに対する挿入が失敗した場合、パッケージを再開して、そのディメンションのみを再読み込みすることができます。</span><span class="sxs-lookup"><span data-stu-id="a4167-111">For example, a package that performs bulk inserts into dimension tables in a data warehouse using a different Bulk Insert task for each dimension can be restarted if the insertion fails for one dimension table, and only that dimension will be reloaded.</span></span>  
  
-   <span data-ttu-id="a4167-112">値の集計の繰り返しを防止します。</span><span class="sxs-lookup"><span data-stu-id="a4167-112">Avoid repeating the aggregation of values.</span></span> <span data-ttu-id="a4167-113">たとえば、平均や合計など多くの集計値の計算を集計ごとに別々のデータ フロー タスクを使用して実行するパッケージで 1 つの集計値の計算が失敗した場合、パッケージを再開して、その集計のみを再実行することができます。</span><span class="sxs-lookup"><span data-stu-id="a4167-113">For example, a package that computes many aggregates, such as averages and sums, using a separate Data Flow task to perform each aggregation, can be restarted after computing an aggregation fails and only that aggregation will be recomputed.</span></span>  
  
 <span data-ttu-id="a4167-114">パッケージがチェックポイントを使用するように設定されている場合、 [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] はチェックポイント ファイルから再開ポイントを取得します。</span><span class="sxs-lookup"><span data-stu-id="a4167-114">If a package is configured to use checkpoints, [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] captures the restart point in the checkpoint file.</span></span> <span data-ttu-id="a4167-115">失敗したコンテナーの種類や、トランザクションなどの実装機能によって、チェックポイント ファイルに記録される再開ポイントは影響を受けます。</span><span class="sxs-lookup"><span data-stu-id="a4167-115">The type of container that fails and the implementation of features such as transactions affect the restart point that is recorded in the checkpoint file.</span></span> <span data-ttu-id="a4167-116">変数の現在の値も、チェックポイント ファイルにキャプチャされます。</span><span class="sxs-lookup"><span data-stu-id="a4167-116">The current values of variables are also captured in the checkpoint file.</span></span> <span data-ttu-id="a4167-117">ただし、`Object` データ型を持つ変数の値は、チェックポイント ファイルに保存されません。</span><span class="sxs-lookup"><span data-stu-id="a4167-117">However, the values of variables that have the `Object` data type are not saved in checkpoint files.</span></span>  
  
## <a name="defining-restart-points"></a><span data-ttu-id="a4167-118">再開ポイントの定義</span><span class="sxs-lookup"><span data-stu-id="a4167-118">Defining Restart Points</span></span>  
 <span data-ttu-id="a4167-119">単一のタスクがカプセル化されているタスク ホスト コンテナーが、再開可能な最小のアトミック作業単位です。</span><span class="sxs-lookup"><span data-stu-id="a4167-119">The task host container, which encapsulates a single task, is the smallest atomic unit of work that can be restarted.</span></span> <span data-ttu-id="a4167-120">Foreach ループ コンテナーおよびトランザクション化されたコンテナーも、アトミックな作業単位です。</span><span class="sxs-lookup"><span data-stu-id="a4167-120">The Foreach Loop container and a transacted container are also treated as atomic units of work.</span></span>  
  
 <span data-ttu-id="a4167-121">トランザクション化されたコンテナーの実行中にパッケージが停止した場合、トランザクションが終了し、コンテナーによって実行された作業がすべてロールバックされます。</span><span class="sxs-lookup"><span data-stu-id="a4167-121">If a package is stopped while a transacted container is running, the transaction ends and any work performed by the container is rolled back.</span></span> <span data-ttu-id="a4167-122">パッケージが再開されると、失敗したコンテナーが再実行されます。</span><span class="sxs-lookup"><span data-stu-id="a4167-122">When the package is restarted, the container that failed is rerun.</span></span> <span data-ttu-id="a4167-123">トランザクション化されたコンテナーのいずれかの子コンテナーが完了しても、チェックポイント ファイルには記録されません。</span><span class="sxs-lookup"><span data-stu-id="a4167-123">The completion of any child containers of transacted container is not recorded in the checkpoint file.</span></span> <span data-ttu-id="a4167-124">このため、パッケージが再開されると、トランザクション化されたコンテナーと子コンテナーが再実行されます。</span><span class="sxs-lookup"><span data-stu-id="a4167-124">Therefore, when the package is restarted, the transacted container and its child containers run again.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="a4167-125">同じパッケージでチェックポイントとトランザクションを使用すると、予期しない結果が生じる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="a4167-125">Using checkpoints and transactions in the same package could cause unexpected results.</span></span> <span data-ttu-id="a4167-126">たとえば、パッケージが失敗してチェックポイントから再開した場合、既に正常にコミットされているトランザクションがパッケージで繰り返し実行される可能性があります。</span><span class="sxs-lookup"><span data-stu-id="a4167-126">For example, when a package fails and restarts from a checkpoint, the package might repeat a transaction that has already been successfully committed.</span></span>  
  
 <span data-ttu-id="a4167-127">チェックポイント データは、For ループ コンテナーおよび Foreach ループ コンテナーには保存されません。</span><span class="sxs-lookup"><span data-stu-id="a4167-127">Checkpoint data is not saved for For Loop and Foreach Loop containers.</span></span> <span data-ttu-id="a4167-128">パッケージが再開されると、For ループ コンテナーおよび Foreach ループ コンテナーと、子コンテナーが再実行されます。</span><span class="sxs-lookup"><span data-stu-id="a4167-128">When a package is restarted, the For Loop and Foreach Loop containers and the child containers are run again.</span></span> <span data-ttu-id="a4167-129">ループ内の子コンテナーの実行が成功してもチェックポイント ファイルには記録されないため、子コンテナーは再実行されます。</span><span class="sxs-lookup"><span data-stu-id="a4167-129">If a child container in the loop runs successfully, it is not recorded in the checkpoint file, instead it is rerun.</span></span> <span data-ttu-id="a4167-130">詳細情報および回避策については、「 [SSIS チェックポイントが For ループ コンテナーまたは Foreach ループ コンテナーの項目に格納されない](https://go.microsoft.com/fwlink/?LinkId=241633)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a4167-130">For more information and a workaround, see [SSIS Checkpoints are not honored for For Loop or Foreach Loop container items](https://go.microsoft.com/fwlink/?LinkId=241633).</span></span>  
  
 <span data-ttu-id="a4167-131">パッケージの再開時にはパッケージの構成が再読み込みされず、チェックポイント ファイルに書き込まれた構成情報が代わりに使用されます。</span><span class="sxs-lookup"><span data-stu-id="a4167-131">If the package is restarted the package configurations are not reloaded, instead the package uses the configuration information written to the checkpoint file.</span></span> <span data-ttu-id="a4167-132">これによって、確実に、パッケージが失敗した時点と同じ構成を使用してパッケージが再実行されます。</span><span class="sxs-lookup"><span data-stu-id="a4167-132">This ensures that the package uses the same configurations when it is rerun as the time it failed.</span></span>  
  
 <span data-ttu-id="a4167-133">パッケージは、制御フロー レベルでのみ再開できます。</span><span class="sxs-lookup"><span data-stu-id="a4167-133">A package can be restarted only at the control flow level.</span></span> <span data-ttu-id="a4167-134">データ フローの途中からパッケージを再開することはできません。</span><span class="sxs-lookup"><span data-stu-id="a4167-134">You cannot restart a package in the middle of a data flow.</span></span> <span data-ttu-id="a4167-135">データ フロー全体の再実行を防止するには、パッケージを複数のデータ フローで設計して、各データ フローで別々のデータ フロー タスクを使用するようにします。</span><span class="sxs-lookup"><span data-stu-id="a4167-135">To avoid rerunning the whole data flow, the package might be designed to include multiple data flows, each one using a different Data Flow task.</span></span> <span data-ttu-id="a4167-136">これによりパッケージを再開すると、1 つのデータ フロー タスクだけを再実行できます。</span><span class="sxs-lookup"><span data-stu-id="a4167-136">This way the package can be restarted, rerunning only one Data Flow task.</span></span>  
  
## <a name="configuring-a-package-to-restart"></a><span data-ttu-id="a4167-137">パッケージを再開する設定</span><span class="sxs-lookup"><span data-stu-id="a4167-137">Configuring a Package to Restart</span></span>  
 <span data-ttu-id="a4167-138">チェックポイント ファイルには、完了したすべてのコンテナーの実行結果、システム変数およびユーザー定義変数の現在の値、およびパッケージの構成情報が記録されています。</span><span class="sxs-lookup"><span data-stu-id="a4167-138">The checkpoint file includes the execution results of all completed containers, the current values of system and user-defined variables, and package configuration information.</span></span> <span data-ttu-id="a4167-139">また、パッケージ固有の識別子も記録されています。</span><span class="sxs-lookup"><span data-stu-id="a4167-139">The file also includes the unique identifier of the package.</span></span> <span data-ttu-id="a4167-140">パッケージを正常に再開するには、チェックポイント ファイルに記録されたパッケージの識別子とパッケージが一致しなければなりません。一致しない場合、再開は失敗します。</span><span class="sxs-lookup"><span data-stu-id="a4167-140">To successfully restart a package, the package identifier in the checkpoint file and the package must match; otherwise the restart fails.</span></span> <span data-ttu-id="a4167-141">これにより、パッケージの別のバージョンで作成されたチェックポイント ファイルの使用を防止します。</span><span class="sxs-lookup"><span data-stu-id="a4167-141">This prevents a package from using a checkpoint file written by a different package version.</span></span> <span data-ttu-id="a4167-142">パッケージの再開後に実行が成功すると、チェックポイント ファイルは削除されます。</span><span class="sxs-lookup"><span data-stu-id="a4167-142">If the package runs successfully, after it is restarted the checkpoint file is deleted.</span></span>  
  
 <span data-ttu-id="a4167-143">次の表に、チェックポイントの実装時に設定するパッケージのプロパティの一覧を示します。</span><span class="sxs-lookup"><span data-stu-id="a4167-143">The following table lists the package properties that you set to implement checkpoints.</span></span>  
  
|<span data-ttu-id="a4167-144">プロパティ</span><span class="sxs-lookup"><span data-stu-id="a4167-144">Property</span></span>|<span data-ttu-id="a4167-145">説明</span><span class="sxs-lookup"><span data-stu-id="a4167-145">Description</span></span>|  
|--------------|-----------------|  
|<span data-ttu-id="a4167-146">CheckpointFileName</span><span class="sxs-lookup"><span data-stu-id="a4167-146">CheckpointFileName</span></span>|<span data-ttu-id="a4167-147">チェックポイント ファイルの名前を指定します。</span><span class="sxs-lookup"><span data-stu-id="a4167-147">Specifies the name of the checkpoint file.</span></span>|  
|<span data-ttu-id="a4167-148">CheckpointUsage</span><span class="sxs-lookup"><span data-stu-id="a4167-148">CheckpointUsage</span></span>|<span data-ttu-id="a4167-149">チェックポイントを使用するかどうかを指定します。</span><span class="sxs-lookup"><span data-stu-id="a4167-149">Specifies whether checkpoints are used.</span></span>|  
|<span data-ttu-id="a4167-150">SaveCheckpoints</span><span class="sxs-lookup"><span data-stu-id="a4167-150">SaveCheckpoints</span></span>|<span data-ttu-id="a4167-151">パッケージでチェックポイントを保存するかどうかを示します。</span><span class="sxs-lookup"><span data-stu-id="a4167-151">Indicates whether the package saves checkpoints.</span></span> <span data-ttu-id="a4167-152">失敗した時点からパッケージを再開するには、このプロパティを True に設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a4167-152">This property must be set to True to restart a package from a point of failure.</span></span>|  
  
 <span data-ttu-id="a4167-153">また、 `true` 再起動ポイントとして識別するパッケージ内のすべてのコンテナーに対して、FailPackageOnFailure プロパティをに設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a4167-153">Additionally, you must set the FailPackageOnFailure property to `true` for all the containers in the package that you want to identify as restart points.</span></span>  
  
 <span data-ttu-id="a4167-154">ForceExecutionResult プロパティを使用して、パッケージのチェックポイントの使用をテストできます。</span><span class="sxs-lookup"><span data-stu-id="a4167-154">You can use the ForceExecutionResult property to test the use of checkpoints in a package.</span></span> <span data-ttu-id="a4167-155">タスクまたはコンテナーの ForceExecutionResult を Failure に設定すると、実行時の障害を擬似的に実現できます。</span><span class="sxs-lookup"><span data-stu-id="a4167-155">By setting ForceExecutionResult of a task or container to Failure, you can imitate real-time failure.</span></span> <span data-ttu-id="a4167-156">パッケージを再実行すると、失敗したタスクとコンテナーが再実行されます。</span><span class="sxs-lookup"><span data-stu-id="a4167-156">When you rerun the package, the failed task and containers will be rerun.</span></span>  
  
### <a name="checkpoint-usage"></a><span data-ttu-id="a4167-157">チェックポイントの使用法</span><span class="sxs-lookup"><span data-stu-id="a4167-157">Checkpoint Usage</span></span>  
 <span data-ttu-id="a4167-158">CheckpointUsage プロパティは次の値に設定できます。</span><span class="sxs-lookup"><span data-stu-id="a4167-158">The CheckpointUsage property can be set to the following values:</span></span>  
  
|<span data-ttu-id="a4167-159">値</span><span class="sxs-lookup"><span data-stu-id="a4167-159">Value</span></span>|<span data-ttu-id="a4167-160">説明</span><span class="sxs-lookup"><span data-stu-id="a4167-160">Description</span></span>|  
|-----------|-----------------|  
|`Never`|<span data-ttu-id="a4167-161">チェックポイント ファイルを使用せず、パッケージのワークフローの最初からパッケージを実行することを指定します。</span><span class="sxs-lookup"><span data-stu-id="a4167-161">Specifies that the checkpoint file is not used and that the package runs from the start of the package workflow.</span></span>|  
|`Always`|<span data-ttu-id="a4167-162">チェックポイント ファイルを常に使用し、前の実行で失敗した時点からパッケージを再開することを指定します。</span><span class="sxs-lookup"><span data-stu-id="a4167-162">Specifies that the checkpoint file is always used and that the package restarts from the point of the previous execution failure.</span></span> <span data-ttu-id="a4167-163">チェックポイント ファイルが見つからない場合、パッケージは失敗します。</span><span class="sxs-lookup"><span data-stu-id="a4167-163">If the checkpoint file is not found, the package fails.</span></span>|  
|`IfExists`|<span data-ttu-id="a4167-164">チェックポイント ファイルが存在する場合、チェックポイント ファイルを使用することを指定します。</span><span class="sxs-lookup"><span data-stu-id="a4167-164">Specifies that the checkpoint file is used if it exists.</span></span> <span data-ttu-id="a4167-165">チェックポイント ファイルが存在する場合、パッケージは前の実行で失敗した時点から再開されます。存在しない場合、パッケージのワークフローの最初から実行されます。</span><span class="sxs-lookup"><span data-stu-id="a4167-165">If the checkpoint file exists, the package restarts from the point of the previous execution failure; otherwise, it runs from the start of the package workflow.</span></span>|  
  
> [!NOTE]  
>  <span data-ttu-id="a4167-166">Dtexec のチェック**ポイント**オプションは、 `SaveCheckpoints` パッケージのプロパティをに `True` 、プロパティを常にに設定することと同じです `CheckpointUsage` 。</span><span class="sxs-lookup"><span data-stu-id="a4167-166">The **/CheckPointing on** option of dtexec is equivalent to setting the `SaveCheckpoints` property of the package to `True`, and the `CheckpointUsage` property to Always.</span></span> <span data-ttu-id="a4167-167">詳細については、「[dtexec ユーティリティ](dtexec-utility.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a4167-167">For more information, see [dtexec Utility](dtexec-utility.md).</span></span>  
  
## <a name="securing-checkpoint-files"></a><span data-ttu-id="a4167-168">チェックポイント ファイルのセキュリティ保護</span><span class="sxs-lookup"><span data-stu-id="a4167-168">Securing Checkpoint Files</span></span>  
 <span data-ttu-id="a4167-169">パッケージ レベルの保護にはチェックポイント ファイルの保護が含まれないため、チェックポイント ファイルは個別にセキュリティ保護する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a4167-169">Package level protection does not include protection of checkpoint files and you must secure these files separately.</span></span> <span data-ttu-id="a4167-170">チェックポイントのデータはファイル システムにしか格納できないので、オペレーティング システムのアクセス制御リスト (ACL) を使用して、ファイルの格納先またはフォルダーのセキュリティを保護する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a4167-170">Checkpoint data can be stored only in the file system and you should use an operating system access control list (ACL) to secure the location or folder where you store the file.</span></span> <span data-ttu-id="a4167-171">チェックポイント ファイルには、現在の変数値などパッケージの状態に関する情報が含まれているため、セキュリティで保護することが重要です。</span><span class="sxs-lookup"><span data-stu-id="a4167-171">It is important to secure checkpoint files because they contain information about the package state, including the current values of variables.</span></span> <span data-ttu-id="a4167-172">たとえば変数には、電話番号などの個人データを含む多数の行で構成されるレコードセットが格納されている場合があります。</span><span class="sxs-lookup"><span data-stu-id="a4167-172">For example, a variable may contain a recordset with many rows of private data such as telephone numbers.</span></span> <span data-ttu-id="a4167-173">詳細については、「 [パッケージで使用されるファイルへのアクセス](../access-to-files-used-by-packages.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a4167-173">For more information, see [Access to Files Used by Packages](../access-to-files-used-by-packages.md).</span></span>  
  
### <a name="to-configure-the-checkpoint-properties"></a><span data-ttu-id="a4167-174">チェックポイント プロパティを設定するには</span><span class="sxs-lookup"><span data-stu-id="a4167-174">To configure the checkpoint properties</span></span>  
  
-   [<span data-ttu-id="a4167-175">失敗したパッケージを再開するためのチェックポイントを構成する</span><span class="sxs-lookup"><span data-stu-id="a4167-175">Configure Checkpoints for Restarting a Failed Package</span></span>](../configure-checkpoints-for-restarting-a-failed-package.md)  
  
## <a name="external-resources"></a><span data-ttu-id="a4167-176">外部リソース</span><span class="sxs-lookup"><span data-stu-id="a4167-176">External Resources</span></span>  
  
-   <span data-ttu-id="a4167-177">social.technet.microsoft.com の技術資料「 [フェールオーバーまたはエラー後の SSIS パッケージの自動再起動](https://go.microsoft.com/fwlink/?LinkId=200407)」</span><span class="sxs-lookup"><span data-stu-id="a4167-177">Technical article, [Automatic Restart of SSIS packages after Failover or Failure](https://go.microsoft.com/fwlink/?LinkId=200407), on social.technet.microsoft.com</span></span>  
  
-   <span data-ttu-id="a4167-178">support.microsoft.com のサポート技術情報の記事「 [SSIS チェックポイントが For ループ コンテナーまたは Foreach ループ コンテナーの項目に格納されない](https://go.microsoft.com/fwlink/?LinkId=241633)」</span><span class="sxs-lookup"><span data-stu-id="a4167-178">Support article, [SSIS Checkpoints are not honored for For Loop or Foreach Loop container items](https://go.microsoft.com/fwlink/?LinkId=241633), on support.microsoft.com.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="a4167-179">参照</span><span class="sxs-lookup"><span data-stu-id="a4167-179">See Also</span></span>  
 [<span data-ttu-id="a4167-180">SQL Server Integration Services</span><span class="sxs-lookup"><span data-stu-id="a4167-180">SQL Server Integration Services</span></span>](../sql-server-integration-services.md)  
  
  
