---
title: SQL Server プロファイラー | を使用したデッドロックの分析Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: profiler
ms.topic: conceptual
helpviewer_keywords:
- process nodes [SQL Server Profiler]
- Profiler [SQL Server Profiler], deadlocks
- deadlocks [SQL Server], identifying cause
- resource nodes [SQL Server Profiler]
- graphs [SQL Server Profiler]
- SQL Server Profiler, deadlocks
- events [SQL Server], deadlocks
- edges [SQL Server Profiler]
ms.assetid: 72d6718f-501b-4ea6-b344-c0e653f19561
author: stevestein
ms.author: sstein
ms.openlocfilehash: 3414cda74d75dbacf10ed98b6fc6d50da2feaa18
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87711294"
---
# <a name="analyze-deadlocks-with-sql-server-profiler"></a><span data-ttu-id="e5318-102">SQL Server Profiler を使用したデッドロックの分析</span><span class="sxs-lookup"><span data-stu-id="e5318-102">Analyze Deadlocks with SQL Server Profiler</span></span>
  <span data-ttu-id="e5318-103">[!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] を使用して、デッドロックの原因を特定します。</span><span class="sxs-lookup"><span data-stu-id="e5318-103">Use [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] to identify the cause of a deadlock.</span></span> <span data-ttu-id="e5318-104">デッドロックは、SQL Server 内のリソースの集合に対して複数のスレッド間またはプロセス間で相互に依存関係があるときに発生します。</span><span class="sxs-lookup"><span data-stu-id="e5318-104">A deadlock occurs when there is a cyclic dependency between two or more threads, or processes, for some set of resources within SQL Server.</span></span> <span data-ttu-id="e5318-105">[!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)]を使用すると、分析用にデッドロック イベントを記録、再生、および表示するトレースを作成できます。</span><span class="sxs-lookup"><span data-stu-id="e5318-105">Using [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)], you can create a trace that records, replays, and displays deadlock events for analysis.</span></span>  
  
 <span data-ttu-id="e5318-106">デッドロック イベントをトレースするには、 **Deadlock Graph** イベント クラスをトレースに追加します。</span><span class="sxs-lookup"><span data-stu-id="e5318-106">To trace deadlock events, add the **Deadlock graph** event class to a trace.</span></span> <span data-ttu-id="e5318-107">このイベント クラスにより、デッドロックに関連するプロセスとオブジェクトに関する XML データが、トレースの **TextData** データ列に設定されます。</span><span class="sxs-lookup"><span data-stu-id="e5318-107">This event class populates the **TextData** data column in the trace with XML data about the process and objects that are involved in the deadlock.</span></span> [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] <span data-ttu-id="e5318-108">では、この XML ドキュメントをデッドロック XML (.xdl) ファイルに抽出して、後で SQL Server Management Studio で表示できます。</span><span class="sxs-lookup"><span data-stu-id="e5318-108">can extract the XML document to a deadlock XML (.xdl) file which you can view later in SQL Server Management Studio.</span></span> <span data-ttu-id="e5318-109">[!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] Deadlock Graph **イベントを、すべての** Deadlock Graph **イベントが含まれた 1 つのファイルに抽出するか、または個別のファイルに抽出するように** を構成できます。</span><span class="sxs-lookup"><span data-stu-id="e5318-109">You can configure [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] to extract **Deadlock graph** events to a single file that contains all **Deadlock graph** events, or to separate files.</span></span> <span data-ttu-id="e5318-110">この抽出は、次の方法のいずれかを使用して実行できます。</span><span class="sxs-lookup"><span data-stu-id="e5318-110">This extraction can be done in any of the following ways:</span></span>  
  
-   <span data-ttu-id="e5318-111">トレースの構成時に、 **[イベント抽出の設定]** タブを使用する。このタブは、 **[イベントの選択]** タブで **Deadlock Graph** イベントを選択していないと表示されないので注意してください。</span><span class="sxs-lookup"><span data-stu-id="e5318-111">At trace configuration time, using the **Events Extraction Settings** tab. Note that this tab does not appear until you select the **Deadlock graph** event on the **Events Selection** tab.</span></span>  
  
-   <span data-ttu-id="e5318-112">**[ファイル]** メニューの **[SQL Server イベントの抽出]** オプションを使用する。</span><span class="sxs-lookup"><span data-stu-id="e5318-112">Using the **Extract SQL Server Events** option on the **File** menu.</span></span>  
  
-   <span data-ttu-id="e5318-113">特定のイベントを右クリックし、 **[イベント データの抽出]** をクリックすることにより、個々のイベントを抽出して保存することもできます。</span><span class="sxs-lookup"><span data-stu-id="e5318-113">Individual events can also be extracted and saved by right-clicking a specific event and choosing **Extract Event Data**.</span></span>  
  
## <a name="deadlock-graphs"></a><span data-ttu-id="e5318-114">Deadlock Graph</span><span class="sxs-lookup"><span data-stu-id="e5318-114">Deadlock Graphs</span></span>  
 [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] <span data-ttu-id="e5318-115">と [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] では、Deadlock Wait-for Graph を使用してデッドロックが説明されます。</span><span class="sxs-lookup"><span data-stu-id="e5318-115">and [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] use a deadlock wait-for graph to describe a deadlock.</span></span> <span data-ttu-id="e5318-116">Deadlock Wait-for Graph には、プロセス ノード、リソース ノード、およびプロセスとリソース間の関係を表すエッジが含まれています。</span><span class="sxs-lookup"><span data-stu-id="e5318-116">The deadlock wait-for graph contains process nodes, resource nodes, and edges representing the relationships between the processes and the resources.</span></span> <span data-ttu-id="e5318-117">次の表では、Deadlock Wait-for Graph の構成要素を定義します。</span><span class="sxs-lookup"><span data-stu-id="e5318-117">The components of wait-for graphs are defined in the following table:</span></span>  
  
 <span data-ttu-id="e5318-118">プロセス ノード</span><span class="sxs-lookup"><span data-stu-id="e5318-118">Process node</span></span>  
 <span data-ttu-id="e5318-119">INSERT、UPDATE、DELETE などのタスクを実行するスレッド。</span><span class="sxs-lookup"><span data-stu-id="e5318-119">A thread that performs a task; for example, INSERT, UPDATE, or DELETE.</span></span>  
  
 <span data-ttu-id="e5318-120">リソース ノード</span><span class="sxs-lookup"><span data-stu-id="e5318-120">Resource node</span></span>  
 <span data-ttu-id="e5318-121">テーブル、インデックス、行などのデータベース オブジェクト。</span><span class="sxs-lookup"><span data-stu-id="e5318-121">A database object; for example, a table, index, or row.</span></span>  
  
 <span data-ttu-id="e5318-122">Edge</span><span class="sxs-lookup"><span data-stu-id="e5318-122">Edge</span></span>  
 <span data-ttu-id="e5318-123">プロセスとリソース間の関係。</span><span class="sxs-lookup"><span data-stu-id="e5318-123">A relationship between a process and a resource.</span></span> <span data-ttu-id="e5318-124">`request`エッジは、プロセスがリソースを待機したときに発生します。</span><span class="sxs-lookup"><span data-stu-id="e5318-124">A `request` edge occurs when a process waits for a resource.</span></span> <span data-ttu-id="e5318-125">`owner`エッジは、リソースがプロセスを待機したときに発生します。</span><span class="sxs-lookup"><span data-stu-id="e5318-125">An `owner` edge occurs when a resource waits for a process.</span></span> <span data-ttu-id="e5318-126">ロック モードは、エッジの記述に含まれます。</span><span class="sxs-lookup"><span data-stu-id="e5318-126">The lock mode is included in the edge description.</span></span> <span data-ttu-id="e5318-127">たとえば、**モード:X** などです。</span><span class="sxs-lookup"><span data-stu-id="e5318-127">For example, **Mode: X**.</span></span>  
  
## <a name="deadlock-process-node"></a><span data-ttu-id="e5318-128">デッドロック プロセス ノード</span><span class="sxs-lookup"><span data-stu-id="e5318-128">Deadlock Process Node</span></span>  
 <span data-ttu-id="e5318-129">Deadlock Wait-for Graph には、プロセス ノードにプロセスに関する情報が含まれています。</span><span class="sxs-lookup"><span data-stu-id="e5318-129">In a wait-for graph, the process node contains information about the process.</span></span> <span data-ttu-id="e5318-130">次の表で、プロセスの構成要素について説明します。</span><span class="sxs-lookup"><span data-stu-id="e5318-130">The following table explains the components of a process.</span></span>  
  
|<span data-ttu-id="e5318-131">コンポーネント</span><span class="sxs-lookup"><span data-stu-id="e5318-131">Component</span></span>|<span data-ttu-id="e5318-132">定義</span><span class="sxs-lookup"><span data-stu-id="e5318-132">Definition</span></span>|  
|---------------|----------------|  
|<span data-ttu-id="e5318-133">[サーバー プロセス ID]</span><span class="sxs-lookup"><span data-stu-id="e5318-133">Server process Id</span></span>|<span data-ttu-id="e5318-134">サーバー プロセス ID (SPID)。ロックを所有しているプロセスのサーバー割り当て ID です。</span><span class="sxs-lookup"><span data-stu-id="e5318-134">Server process identifier (SPID), a server assigned identifier for the process owning the lock.</span></span>|  
|<span data-ttu-id="e5318-135">[サーバー バッチ ID]</span><span class="sxs-lookup"><span data-stu-id="e5318-135">Server batch Id</span></span>|<span data-ttu-id="e5318-136">サーバー バッチ ID (SBID)。</span><span class="sxs-lookup"><span data-stu-id="e5318-136">Server batch identifier (SBID).</span></span>|  
|<span data-ttu-id="e5318-137">[実行コンテキスト ID]</span><span class="sxs-lookup"><span data-stu-id="e5318-137">Execution context Id</span></span>|<span data-ttu-id="e5318-138">実行コンテキスト ID (ECID)。</span><span class="sxs-lookup"><span data-stu-id="e5318-138">Execution context identifier (ECID).</span></span> <span data-ttu-id="e5318-139">特定の SPID に関連付けられている特定のスレッドの実行コンテキスト ID です。</span><span class="sxs-lookup"><span data-stu-id="e5318-139">The execution context ID of a given thread associated with a specific SPID.</span></span><br /><br /> <span data-ttu-id="e5318-140">ECID = {0, 1, 2, 3, *...n*}。0 は常にメイン スレッドまたは親スレッドを表し、{1, 2, 3, ... *n*} は、サブスレッドを表します。</span><span class="sxs-lookup"><span data-stu-id="e5318-140">ECID = {0,1,2,3, *...n*}, where 0 always represents the main or parent thread, and {1,2,3, *...n*} represent the subthreads.</span></span>|  
|<span data-ttu-id="e5318-141">[デッドロックの優先度]</span><span class="sxs-lookup"><span data-stu-id="e5318-141">Deadlock priority</span></span>|<span data-ttu-id="e5318-142">プロセスのデッドロックの優先度。</span><span class="sxs-lookup"><span data-stu-id="e5318-142">Deadlock priority for the process.</span></span> <span data-ttu-id="e5318-143">詳細については、「[SET DEADLOCK_PRIORITY &#40;Transact-SQL&#41;](/sql/t-sql/statements/set-deadlock-priority-transact-sql)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="e5318-143">For more information about possible values, see [SET DEADLOCK_PRIORITY &#40;Transact-SQL&#41;](/sql/t-sql/statements/set-deadlock-priority-transact-sql).</span></span>|  
|<span data-ttu-id="e5318-144">[使用されたログ]</span><span class="sxs-lookup"><span data-stu-id="e5318-144">Log Used</span></span>|<span data-ttu-id="e5318-145">プロセスで使用されたログ領域の量。</span><span class="sxs-lookup"><span data-stu-id="e5318-145">Amount of log space used by the process.</span></span>|  
|<span data-ttu-id="e5318-146">[所有者 ID]</span><span class="sxs-lookup"><span data-stu-id="e5318-146">Owner Id</span></span>|<span data-ttu-id="e5318-147">トランザクションを使用しており、現在ロックを待機しているプロセスのトランザクション ID。</span><span class="sxs-lookup"><span data-stu-id="e5318-147">Transaction ID for the processes which are using transactions and currently waiting on a lock.</span></span>|  
|<span data-ttu-id="e5318-148">[トランザクション記述子]</span><span class="sxs-lookup"><span data-stu-id="e5318-148">Transaction descriptor</span></span>|<span data-ttu-id="e5318-149">トランザクションの状態を記述するトランザクション記述子へのポインター。</span><span class="sxs-lookup"><span data-stu-id="e5318-149">Pointer to the transaction descriptor that describes the state of the transaction.</span></span>|  
|<span data-ttu-id="e5318-150">[入力バッファー]</span><span class="sxs-lookup"><span data-stu-id="e5318-150">Input buffer</span></span>|<span data-ttu-id="e5318-151">現在のプロセスの入力バッファー。イベントの種類と実行中のステートメントを定義します。</span><span class="sxs-lookup"><span data-stu-id="e5318-151">Input buffer of the current process, defines the type of event and the statement being executed.</span></span> <span data-ttu-id="e5318-152">指定できる値は、次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="e5318-152">Possible values include:</span></span><br /><br /> <span data-ttu-id="e5318-153">**Language**</span><span class="sxs-lookup"><span data-stu-id="e5318-153">**Language**</span></span><br /><br /> <span data-ttu-id="e5318-154">**RPC**</span><span class="sxs-lookup"><span data-stu-id="e5318-154">**RPC**</span></span><br /><br /> <span data-ttu-id="e5318-155">**なし**</span><span class="sxs-lookup"><span data-stu-id="e5318-155">**None**</span></span>|  
|<span data-ttu-id="e5318-156">ステートメント</span><span class="sxs-lookup"><span data-stu-id="e5318-156">Statement</span></span>|<span data-ttu-id="e5318-157">ステートメントの種類。</span><span class="sxs-lookup"><span data-stu-id="e5318-157">Type of statement.</span></span> <span data-ttu-id="e5318-158">次のいずれかの値になります。</span><span class="sxs-lookup"><span data-stu-id="e5318-158">Possible values are:</span></span><br /><br /> <span data-ttu-id="e5318-159">**NOP**</span><span class="sxs-lookup"><span data-stu-id="e5318-159">**NOP**</span></span><br /><br /> <span data-ttu-id="e5318-160">**SELECT**</span><span class="sxs-lookup"><span data-stu-id="e5318-160">**SELECT**</span></span><br /><br /> <span data-ttu-id="e5318-161">**UPDATE**</span><span class="sxs-lookup"><span data-stu-id="e5318-161">**UPDATE**</span></span><br /><br /> <span data-ttu-id="e5318-162">**INSERT**</span><span class="sxs-lookup"><span data-stu-id="e5318-162">**INSERT**</span></span><br /><br /> <span data-ttu-id="e5318-163">**DELETE**</span><span class="sxs-lookup"><span data-stu-id="e5318-163">**DELETE**</span></span><br /><br /> <span data-ttu-id="e5318-164">**Unknown**</span><span class="sxs-lookup"><span data-stu-id="e5318-164">**Unknown**</span></span>|  
  
## <a name="deadlock-resource-node"></a><span data-ttu-id="e5318-165">デッドロック リソース ノード</span><span class="sxs-lookup"><span data-stu-id="e5318-165">Deadlock Resource Node</span></span>  
 <span data-ttu-id="e5318-166">デッドロックにおいて、2 つのプロセスが、他のプロセスで使用されているリソースをそれぞれ待機しています。</span><span class="sxs-lookup"><span data-stu-id="e5318-166">In a deadlock, two processes are each waiting for a resource held by the other process.</span></span> <span data-ttu-id="e5318-167">Deadlock Graph では、これらのリソースがリソース ノードとして表示されます。</span><span class="sxs-lookup"><span data-stu-id="e5318-167">In a deadlock graph, the resources are displayed as resource nodes.</span></span>  
  
  
