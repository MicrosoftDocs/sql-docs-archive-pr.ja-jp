---
title: 変更データ キャプチャについて (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ''
ms.topic: conceptual
helpviewer_keywords:
- change data capture [SQL Server], about
- change data capture [SQL Server]
- 22832 (Database Engine error)
ms.assetid: 7d8c4684-9eb1-4791-8c3b-0f0bb15d9634
author: rothja
ms.author: jroth
ms.openlocfilehash: cf8045ff45e7467a626bee85857ae8319f5d2649
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87642658"
---
# <a name="about-change-data-capture-sql-server"></a><span data-ttu-id="49848-102">変更データ キャプチャについて (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="49848-102">About Change Data Capture (SQL Server)</span></span>
  <span data-ttu-id="49848-103">変更データ キャプチャは、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] のテーブルに対して適用された挿入、更新、削除の各アクティビティを記録して、</span><span class="sxs-lookup"><span data-stu-id="49848-103">Change data capture records insert, update, and delete activity that is applied to a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] table.</span></span> <span data-ttu-id="49848-104">変更の詳細を、利用しやすいリレーショナル形式で格納します。</span><span class="sxs-lookup"><span data-stu-id="49848-104">This makes the details of the changes available in an easily consumed relational format.</span></span> <span data-ttu-id="49848-105">変更された行に対応する列情報が、その変更をターゲット環境に適用するために必要なメタデータと共にキャプチャされ、追跡対象となるソース テーブルの列構造がミラー化された変更テーブルに格納されます。</span><span class="sxs-lookup"><span data-stu-id="49848-105">Column information and the metadata that is required to apply the changes to a target environment is captured for the modified rows and stored in change tables that mirror the column structure of the tracked source tables.</span></span> <span data-ttu-id="49848-106">コンシューマーは、用意されているテーブル値関数を使用して、変更データに体系的にアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="49848-106">Table-valued functions are provided to allow systematic access to the change data by consumers.</span></span>  
  
 <span data-ttu-id="49848-107">この技術の対象となるデータ コンシューマーの好例が、ETL (抽出、変換、読み込み) アプリケーションです。</span><span class="sxs-lookup"><span data-stu-id="49848-107">A good example of a data consumer that is targeted by this technology is an extraction, transformation, and loading (ETL) application.</span></span> <span data-ttu-id="49848-108">ETL アプリケーションは、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] のソース テーブルからデータ ウェアハウスやデータ マートに変更データをインクリメンタルに読み込みます。</span><span class="sxs-lookup"><span data-stu-id="49848-108">An ETL application incrementally loads change data from [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] source tables to a data warehouse or data mart.</span></span> <span data-ttu-id="49848-109">ソース テーブルの変更をデータ ウェアハウス内のソース テーブルの表現に反映する必要がありますが、ソースのレプリカを更新するエンド ツー エンドのテクノロジでは不適切です。</span><span class="sxs-lookup"><span data-stu-id="49848-109">Although the representation of the source tables within the data warehouse must reflect changes in the source tables, an end-to-end technology that refreshes a replica of the source is not appropriate.</span></span> <span data-ttu-id="49848-110">ここで必要となるのは、対象となる異質なデータ表現に対して適用できるように構成された変更データの確実なストリームです。</span><span class="sxs-lookup"><span data-stu-id="49848-110">Instead, you need a reliable stream of change data that is structured so that consumers can apply it to dissimilar target representations of the data.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="49848-111">の変更データ キャプチャはこの技術を提供します。</span><span class="sxs-lookup"><span data-stu-id="49848-111">change data capture provides this technology.</span></span>  
  
## <a name="change-data-capture-data-flow"></a><span data-ttu-id="49848-112">変更データ キャプチャのデータ フロー</span><span class="sxs-lookup"><span data-stu-id="49848-112">Change Data Capture Data Flow</span></span>  
 <span data-ttu-id="49848-113">次の図は、変更データ キャプチャの主なデータ フローを示しています。</span><span class="sxs-lookup"><span data-stu-id="49848-113">The following illustration shows the principal data flow for change data capture.</span></span>  
  
 <span data-ttu-id="49848-114">![変更データ キャプチャのデータ フロー](../../database-engine/media/cdcdataflow.gif "変更データ キャプチャのデータ フロー")</span><span class="sxs-lookup"><span data-stu-id="49848-114">![Change data capture data flow](../../database-engine/media/cdcdataflow.gif "Change data capture data flow")</span></span>  
  
 <span data-ttu-id="49848-115">変更データ キャプチャの変更データのソースは [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] トランザクション ログです。</span><span class="sxs-lookup"><span data-stu-id="49848-115">The source of change data for change data capture is the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] transaction log.</span></span> <span data-ttu-id="49848-116">追跡対象のソース テーブルに対して挿入、更新、削除の各操作が適用されると、それらの変更を記述するエントリがこのログに追加されます。</span><span class="sxs-lookup"><span data-stu-id="49848-116">As inserts, updates, and deletes are applied to tracked source tables, entries that describe those changes are added to the log.</span></span> <span data-ttu-id="49848-117">このログは、キャプチャ プロセスへの入力として機能します。</span><span class="sxs-lookup"><span data-stu-id="49848-117">The log serves as input to the capture process.</span></span> <span data-ttu-id="49848-118">このプロセスによってログが読み取られ、変更に関する情報が、追跡対象のテーブルに関連付けられている変更テーブルに追加されます。</span><span class="sxs-lookup"><span data-stu-id="49848-118">This reads the log and adds information about changes to the tracked table's associated change table.</span></span> <span data-ttu-id="49848-119">用意されている関数を使用すると、指定した範囲にこの変更テーブルに追加された変更を列挙できます。この情報は、フィルター処理された結果セットの形式で返されます。</span><span class="sxs-lookup"><span data-stu-id="49848-119">Functions are provided to enumerate the changes that appear in the change tables over a specified range, returning the information in the form of a filtered result set.</span></span> <span data-ttu-id="49848-120">通常は、このフィルター処理された結果セットを使用して、アプリケーション プロセスによって外部環境のソースの表現が更新されます。</span><span class="sxs-lookup"><span data-stu-id="49848-120">The filtered result set is typically used by an application process to update a representation of the source in some external environment.</span></span>  
  
## <a name="understanding-change-data-capture-and-the-capture-instance"></a><span data-ttu-id="49848-121">変更データ キャプチャとキャプチャ インスタンスについて</span><span class="sxs-lookup"><span data-stu-id="49848-121">Understanding Change Data Capture and the Capture Instance</span></span>  
 <span data-ttu-id="49848-122">データベース内の個々のテーブルの変更を追跡するには、まずそのデータベースで変更データ キャプチャを明示的に有効にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="49848-122">Before changes to any individual tables within a database can be tracked, change data capture must be explicitly enabled for the database.</span></span> <span data-ttu-id="49848-123">これは、 [sys.sp_cdc_enable_db](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-enable-db-transact-sql)ストアド プロシージャを使用して実行します。</span><span class="sxs-lookup"><span data-stu-id="49848-123">This is done by using the stored procedure [sys.sp_cdc_enable_db](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-enable-db-transact-sql).</span></span> <span data-ttu-id="49848-124">データベースを有効にした後、 [sys.sp_cdc_enable_table](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-enable-table-transact-sql)ストアド プロシージャを使用して、ソース テーブルを追跡対象テーブルとして指定できます。</span><span class="sxs-lookup"><span data-stu-id="49848-124">When the database is enabled, source tables can be identified as tracked tables by using the stored procedure [sys.sp_cdc_enable_table](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-enable-table-transact-sql).</span></span> <span data-ttu-id="49848-125">テーブルに対して変更データ キャプチャを有効にすると、関連付けられたキャプチャ インスタンスが作成されます。これにより、ソース テーブルの変更データの伝播がサポートされます。</span><span class="sxs-lookup"><span data-stu-id="49848-125">When a table is enabled for change data capture, an associated capture instance is created to support the dissemination of the change data in the source table.</span></span> <span data-ttu-id="49848-126">キャプチャ インスタンスは、1 つの変更テーブルと、最大 2 つのクエリ関数で構成されます。</span><span class="sxs-lookup"><span data-stu-id="49848-126">The capture instance consists of a change table and up to two query functions.</span></span> <span data-ttu-id="49848-127">キャプチャ インスタンスの構成の詳細を記述するメタデータは、変更データ キャプチャのメタデータ テーブル (`cdc.change_tables`、`cdc.index_columns`、および `cdc.captured_columns`) に保持されます。</span><span class="sxs-lookup"><span data-stu-id="49848-127">Metadata that describes the configuration details of the capture instance is retained in the change data capture metadata tables `cdc.change_tables`, `cdc.index_columns`, and `cdc.captured_columns`.</span></span> <span data-ttu-id="49848-128">この情報を取得するには、 [sys.sp_cdc_help_change_data_capture](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-help-change-data-capture-transact-sql)ストアド プロシージャを使用します。</span><span class="sxs-lookup"><span data-stu-id="49848-128">This information can be retrieved by using the stored procedure [sys.sp_cdc_help_change_data_capture](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-help-change-data-capture-transact-sql).</span></span>  
  
 <span data-ttu-id="49848-129">キャプチャ インスタンスに関連付けられているオブジェクトはすべて、有効にされたデータベースの変更データ キャプチャ スキーマに作成されます。</span><span class="sxs-lookup"><span data-stu-id="49848-129">All objects that are associated with a capture instance are created in the change data capture schema of the enabled database.</span></span> <span data-ttu-id="49848-130">キャプチャ インスタンスの名前は、データベースのキャプチャ インスタンス間で重複しない有効なオブジェクト名である必要があります。</span><span class="sxs-lookup"><span data-stu-id="49848-130">The requirements for the capture instance name is that it be a valid object name, and that it be unique across the database capture instances.</span></span> <span data-ttu-id="49848-131">既定の名前は、ソース テーブルの \<*schema name*_*table name*> です。</span><span class="sxs-lookup"><span data-stu-id="49848-131">By default, the name is \<*schema name*_*table name*> of the source table.</span></span> <span data-ttu-id="49848-132">関連付けられている変更テーブルの名前は、キャプチャ インスタンス名の末尾に `_CT` を付けた名前になります。</span><span class="sxs-lookup"><span data-stu-id="49848-132">Its associated change table is named by appending `_CT` to the capture instance name.</span></span> <span data-ttu-id="49848-133">すべての変更のクエリを実行する関数の名前は、キャプチャ インスタンス名の先頭に `fn_cdc_get_all_changes_` を付けた名前になります。</span><span class="sxs-lookup"><span data-stu-id="49848-133">The function that is used to query for all changes is named by prepending `fn_cdc_get_all_changes_` to the capture instance name.</span></span> <span data-ttu-id="49848-134">キャプチャインスタンスがをサポートするように構成されている場合、 `net changes` `net_changes` クエリ関数も作成され、キャプチャインスタンス名に\*\* \_ fn_cdc_get_net_changes\*\*を付けることによって名前が付けられます。</span><span class="sxs-lookup"><span data-stu-id="49848-134">If the capture instance is configured to support `net changes`, the `net_changes` query function is also created and named by prepending **fn_cdc_get_net_changes\_** to the capture instance name.</span></span>  
  
## <a name="change-table"></a><span data-ttu-id="49848-135">変更テーブル</span><span class="sxs-lookup"><span data-stu-id="49848-135">Change Table</span></span>  
 <span data-ttu-id="49848-136">変更データ キャプチャの変更テーブルの最初の 5 つの列は、メタデータ列です。</span><span class="sxs-lookup"><span data-stu-id="49848-136">The first five columns of a change data capture change table are metadata columns.</span></span> <span data-ttu-id="49848-137">これらは、記録された変更に関係する追加情報を提供します。</span><span class="sxs-lookup"><span data-stu-id="49848-137">These provide additional information that is relevant to the recorded change.</span></span> <span data-ttu-id="49848-138">残りの列には、識別されたソース テーブルのキャプチャ対象列の名前 (および通常は型) が反映されます。</span><span class="sxs-lookup"><span data-stu-id="49848-138">The remaining columns mirror the identified captured columns from the source table in name and, typically, in type.</span></span> <span data-ttu-id="49848-139">これらの列は、ソース テーブルから収集されたキャプチャ対象列のデータを保持します。</span><span class="sxs-lookup"><span data-stu-id="49848-139">These columns hold the captured column data that is gathered from the source table.</span></span>  
  
 <span data-ttu-id="49848-140">ソース テーブルに適用された挿入または削除の各操作は、変更テーブル内の 1 つの行として表されます。</span><span class="sxs-lookup"><span data-stu-id="49848-140">Each insert or delete operation that is applied to a source table appears as a single row within the change table.</span></span> <span data-ttu-id="49848-141">挿入操作の結果となる行のデータ列には挿入後の列の値が含まれ、</span><span class="sxs-lookup"><span data-stu-id="49848-141">The data columns of the row that results from an insert operation contain the column values after the insert.</span></span> <span data-ttu-id="49848-142">削除操作の結果となる行のデータ列には削除前の列の値が含まれます。</span><span class="sxs-lookup"><span data-stu-id="49848-142">The data columns of the row that results from a delete operation contain the column values before the delete.</span></span> <span data-ttu-id="49848-143">更新操作では、更新前の列の値を識別する行と更新後の列の値を識別する行の 2 つの行エントリが必要になります。</span><span class="sxs-lookup"><span data-stu-id="49848-143">An update operation requires one row entry to identify the column values before the update, and a second row entry to identify the column values after the update.</span></span>  
  
 <span data-ttu-id="49848-144">変更テーブルの各行には、変更アクティビティの解釈に使用される追加のメタデータも含まれています。</span><span class="sxs-lookup"><span data-stu-id="49848-144">Each row in a change table also contains additional metadata to allow interpretation of the change activity.</span></span> <span data-ttu-id="49848-145">__$start_lsn 列は、変更に割り当てられたコミット ログ シーケンス番号 (LSN) を識別します。</span><span class="sxs-lookup"><span data-stu-id="49848-145">The column __$start_lsn identifies the commit log sequence number (LSN) that was assigned to the change.</span></span> <span data-ttu-id="49848-146">コミット LSN では、同じトランザクション内でコミットされた変更が識別されるだけでなく、それらのトランザクションが順序付けられます。</span><span class="sxs-lookup"><span data-stu-id="49848-146">The commit LSN both identifies changes that were committed within the same transaction, and orders those transactions.</span></span> <span data-ttu-id="49848-147">\_\_$seqval 列は、同じトランザクション内で発生したさらに多くの変更を順序付けるために使用できる列です。</span><span class="sxs-lookup"><span data-stu-id="49848-147">The column \_\_$seqval can be used to order more changes that occur in the same transaction.</span></span> <span data-ttu-id="49848-148">\_\_$operation 列は、変更に関連付けられている操作を記録します(1 = 削除、2 = 挿入、3 = 更新 (前イメージ)、4 = 更新 (後イメージ))。</span><span class="sxs-lookup"><span data-stu-id="49848-148">The column \_\_$operation records the operation that is associated with the change: 1 = delete, 2 = insert, 3 = update (before image), and 4 = update (after image).</span></span> <span data-ttu-id="49848-149">\_\_$update_mask 列は、キャプチャ対象列ごとに 1 つのビットを定義する可変ビット マスクです。</span><span class="sxs-lookup"><span data-stu-id="49848-149">The column \_\_$update_mask is a variable bit mask with one defined bit for each captured column.</span></span> <span data-ttu-id="49848-150">挿入と削除のエントリでは常にすべてのビットが設定されます。</span><span class="sxs-lookup"><span data-stu-id="49848-150">For insert and delete entries, the update mask will always have all bits set.</span></span> <span data-ttu-id="49848-151">更新の行では、変更された列に対応するビットのみが設定されます。</span><span class="sxs-lookup"><span data-stu-id="49848-151">Update rows, however, will only have those bits set that correspond to changed columns.</span></span>  
  
## <a name="change-data-capture-validity-interval-for-a-database"></a><span data-ttu-id="49848-152">データベースの変更データ キャプチャの有効期間</span><span class="sxs-lookup"><span data-stu-id="49848-152">Change Data Capture Validity Interval for a Database</span></span>  
 <span data-ttu-id="49848-153">データベースの変更データ キャプチャの有効期間とは、キャプチャ インスタンスが変更データを利用できる期間です。</span><span class="sxs-lookup"><span data-stu-id="49848-153">The change data capture validity interval for a database is the time during which change data is available for capture instances.</span></span> <span data-ttu-id="49848-154">この有効期間は、データベース テーブルに対して最初のキャプチャ インスタンスが作成されたときに始まり、現在まで続きます。</span><span class="sxs-lookup"><span data-stu-id="49848-154">The validity interval begins when the first capture instance is created for a database table, and continues to the present time.</span></span>  
  
 <span data-ttu-id="49848-155">変更テーブルに格納されるデータは、定期的かつ体系的にクリーンアップしないと、増大して管理しきれなくなります。</span><span class="sxs-lookup"><span data-stu-id="49848-155">Data that is deposited in change tables will grow unmanageably if you do not periodically and systematically prune the data.</span></span> <span data-ttu-id="49848-156">このため、変更データ キャプチャのクリーンアップ プロセスにより、保有期間に基づくクリーンアップ ポリシーが適用されます。</span><span class="sxs-lookup"><span data-stu-id="49848-156">The change data capture cleanup process is responsible for enforcing the retention-based cleanup policy.</span></span> <span data-ttu-id="49848-157">このプロセスでは、まず、時間制限を満たすように有効期間の下端が移動されます。</span><span class="sxs-lookup"><span data-stu-id="49848-157">First, it moves the low endpoint of the validity interval to satisfy the time restriction.</span></span> <span data-ttu-id="49848-158">次に、有効期限が切れた変更テーブル エントリが削除されます。</span><span class="sxs-lookup"><span data-stu-id="49848-158">Then, it removes expired change table entries.</span></span> <span data-ttu-id="49848-159">既定では、3 日分のデータが保持されます。</span><span class="sxs-lookup"><span data-stu-id="49848-159">By default, three days of data is retained.</span></span>  
  
 <span data-ttu-id="49848-160">上端では、キャプチャ プロセスによって変更データの新しいバッチがコミットされるたびに、変更テーブルのエントリを持つ各トランザクションに対応する新しいエントリが `cdc.lsn_time_mapping` に追加されます。</span><span class="sxs-lookup"><span data-stu-id="49848-160">At the high end, as the capture process commits each new batch of change data, new entries are added to `cdc.lsn_time_mapping` for each transaction that has change table entries.</span></span> <span data-ttu-id="49848-161">このマッピング テーブルでは、コミット ログ シーケンス番号 (LSN) とトランザクションのコミット時間の両方 (columns start_lsn と tran_end_time) が保持されます。</span><span class="sxs-lookup"><span data-stu-id="49848-161">Within the mapping table, both a commit Log Sequence Number (LSN) and a transaction commit time (columns start_lsn and tran_end_time, respectively) are retained.</span></span> <span data-ttu-id="49848-162">`cdc.lsn_time_mapping` 内で最も大きい LSN 値は、データベースの有効期間の上限を表します。</span><span class="sxs-lookup"><span data-stu-id="49848-162">The maximum LSN value that is found in `cdc.lsn_time_mapping` represents the high water mark of the database validity window.</span></span> <span data-ttu-id="49848-163">それに対応するコミット時間は、保有期間に基づくクリーンアップの新しい下限を計算するための基礎として使用されます。</span><span class="sxs-lookup"><span data-stu-id="49848-163">Its corresponding commit time is used as the base from which retention based cleanup computes a new low water mark.</span></span>  
  
 <span data-ttu-id="49848-164">キャプチャ プロセスではトランザクション ログから変更情報を抽出するため、変更がソース テーブルにコミットされてから、関連付けられている変更テーブルにその変更が反映されるまでの間に、構造的な待機時間が生じます。</span><span class="sxs-lookup"><span data-stu-id="49848-164">Because the capture process extracts change data from the transaction log, there is a built in latency between the time that a change is committed to a source table and the time that the change appears within its associated change table.</span></span> <span data-ttu-id="49848-165">この待機時間は一般に小さいとはいえ、関連するログ エントリの処理がキャプチャ プロセスによって完了するまでは変更データを利用できないということを覚えておく必要があります。</span><span class="sxs-lookup"><span data-stu-id="49848-165">While this latency is typically small, it is nevertheless important to remember that change data is not available until the capture process has processed the related log entries.</span></span>  
  
## <a name="change-data-capture-validity-interval-for-a-capture-instance"></a><span data-ttu-id="49848-166">キャプチャ インスタンスの変更データ キャプチャの有効期間</span><span class="sxs-lookup"><span data-stu-id="49848-166">Change Data Capture Validity Interval for a Capture Instance</span></span>  
 <span data-ttu-id="49848-167">データベースの有効期間と個々のキャプチャ インスタンスの有効期間は一致するのが一般的ですが、一致しない場合もあります。</span><span class="sxs-lookup"><span data-stu-id="49848-167">Although it is common for the database validity interval and the validity interval of individual capture instance to coincide, this is not always true.</span></span> <span data-ttu-id="49848-168">キャプチャ インスタンスの有効期間は、キャプチャ プロセスがそのキャプチャ インスタンスを認識して、関連する変更のログをその変更テーブルに記録し始めたときに始まります。</span><span class="sxs-lookup"><span data-stu-id="49848-168">The validity interval of the capture instance starts when the capture process recognizes the capture instance and starts to log associated changes to its change table.</span></span> <span data-ttu-id="49848-169">その結果、キャプチャ インスタンスが別々の時間に作成された場合は、最初は各キャプチャ インスタンスがそれぞれ異なる下端を持つことになります。</span><span class="sxs-lookup"><span data-stu-id="49848-169">As a result, if capture instances are created at different times, each will initially have a different low endpoint.</span></span> <span data-ttu-id="49848-170">定義されている各キャプチャ インスタンスの現在の下端は、 [sys.sp_cdc_help_change_data_capture](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-help-change-data-capture-transact-sql) によって返される結果セットの start_lsn 列で確認できます。</span><span class="sxs-lookup"><span data-stu-id="49848-170">The start_lsn column of the result set that is returned by [sys.sp_cdc_help_change_data_capture](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-help-change-data-capture-transact-sql) shows the current low endpoint for each defined capture instance.</span></span> <span data-ttu-id="49848-171">クリーンアップ プロセスによって変更テーブルのエントリがクリーンアップされると、すべてのキャプチャ インスタンスの start_lsn 値が、使用可能な変更データの新しい下限を反映して調整されます。</span><span class="sxs-lookup"><span data-stu-id="49848-171">When the cleanup process cleans up change table entries, it adjusts the start_lsn values for all capture instances to reflect the new low water mark for available change data.</span></span> <span data-ttu-id="49848-172">調整されるのは、その時点で start_lsn 値が新しい下限より小さいキャプチャ インスタンスだけです。</span><span class="sxs-lookup"><span data-stu-id="49848-172">Only those capture instances that have start_lsn values that are currently less than the new low water mark are adjusted.</span></span> <span data-ttu-id="49848-173">通常は、新しいキャプチャ インスタンスが作成されなければ、時間が経つにつれて、すべてのインスタンスの有効期間がデータベースの有効期間と一致するようになります。</span><span class="sxs-lookup"><span data-stu-id="49848-173">Over time, if no new capture instances are created, the validity intervals for all individual instances will tend to coincide with the database validity interval.</span></span>  
  
 <span data-ttu-id="49848-174">有効期間は変更データのコンシューマーにとって重要です。これは、要求の抽出範囲が、キャプチャ インスタンスの現在の変更データ キャプチャの有効期間によって完全にカバーされている必要があるからです。</span><span class="sxs-lookup"><span data-stu-id="49848-174">The validity interval is important to consumers of change data because the extraction interval for a request must be fully covered by the current change data capture validity interval for the capture instance.</span></span> <span data-ttu-id="49848-175">抽出範囲の下端が有効期間の下端より左にある場合は、積極的なクリーンアップによって変更データが失われる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="49848-175">If the low endpoint of the extraction interval is to the left of the low endpoint of the validity interval, there could be missing change data due to aggressive cleanup.</span></span> <span data-ttu-id="49848-176">抽出範囲の上端が有効期間の上端より右にある場合も、その抽出範囲によって表される期間の処理がまだ完了していないために、変更データが失われる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="49848-176">If the high endpoint of the extraction interval is to the right of the high endpoint of the validity interval, the capture process has not yet processed through the time period that is represented by the extraction interval, and change data could also be missing.</span></span>  
  
 <span data-ttu-id="49848-177">関数 [sys.fn_cdc_get_min_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-min-lsn-transact-sql) はキャプチャ インスタンスの LSN の現在の最小値の取得に使用し、 [sys.fn_cdc_get_max_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-max-lsn-transact-sql) は LSN の現在の最大値の取得に使用します。</span><span class="sxs-lookup"><span data-stu-id="49848-177">The function [sys.fn_cdc_get_min_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-min-lsn-transact-sql) is used to retrieve the current minimum LSN for a capture instance, while [sys.fn_cdc_get_max_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-max-lsn-transact-sql) is used to retrieve the current maximum LSN value.</span></span> <span data-ttu-id="49848-178">変更データのクエリを実行する際には、指定する LSN の範囲がこの 2 つの LSN 値の間にないと、変更データ キャプチャのクエリ関数が失敗します。</span><span class="sxs-lookup"><span data-stu-id="49848-178">When querying for change data, if the specified LSN range does not lie within these two LSN values, the change data capture query functions will fail.</span></span>  
  
## <a name="handling-changes-to-source-tables"></a><span data-ttu-id="49848-179">ソース テーブルに対する変更の処理</span><span class="sxs-lookup"><span data-stu-id="49848-179">Handling Changes to Source Tables</span></span>  
 <span data-ttu-id="49848-180">追跡対象となるソース テーブルの列の変更への対応は、下流のコンシューマーにとって困難な課題になります。</span><span class="sxs-lookup"><span data-stu-id="49848-180">To accommodate column changes in the source tables that are being tracked is a difficult issue for downstream consumers.</span></span> <span data-ttu-id="49848-181">ソース テーブルで変更データ キャプチャを有効にしても、そうした DDL の変更の発生を防ぐことはできませんが、変更データ キャプチャを使用すると、基になるソース テーブルの列構造が変更されていた場合でも、API を通じて返される、配信される結果セットは変更されないようにすることで、コンシューマーへの影響を緩和することができます。</span><span class="sxs-lookup"><span data-stu-id="49848-181">Although enabling change data capture on a source table does not prevent such DDL changes from occurring, change data capture helps to mitigate the effect on consumers by allowing the delivered result sets that are returned through the API to remain unchanged even as the column structure of the underlying source table changes.</span></span> <span data-ttu-id="49848-182">この固定された列構造は、定義済みのクエリ関数がアクセスする基になる変更テーブルにも反映されます。</span><span class="sxs-lookup"><span data-stu-id="49848-182">This fixed column structure is also reflected in the underlying change table that the defined query functions access.</span></span>  
  
 <span data-ttu-id="49848-183">変更テーブルへの書き込みを行うキャプチャ プロセスでは、列構造が固定された変更テーブルに対応するために、ソース テーブルで変更データ キャプチャが有効にされたときにキャプチャ対象として指定されていない新しい列は無視されます。</span><span class="sxs-lookup"><span data-stu-id="49848-183">To accommodate a fixed column structure change table, the capture process responsible for populating the change table will ignore any new columns that are not identified for capture when the source table was enabled for change data capture.</span></span> <span data-ttu-id="49848-184">追跡されている列が削除された場合には、その後の変更エントリでその列に NULL 値が割り当てられます。</span><span class="sxs-lookup"><span data-stu-id="49848-184">If a tracked column is dropped, null values will be supplied for the column in the subsequent change entries.</span></span> <span data-ttu-id="49848-185">一方、既存の列のデータ型が変更された場合は、追跡されている列のデータが失われないようにするために、その変更が変更テーブルに反映されます。</span><span class="sxs-lookup"><span data-stu-id="49848-185">However, if an existing column undergoes a change in its data type, the change is propagated to the change table to ensure that the capture mechanism does not introduce data loss to tracked columns.</span></span> <span data-ttu-id="49848-186">また、追跡されているテーブルの列構造の変更が検出されると、その変更が cdc.ddl_history テーブルに書き込まれます。</span><span class="sxs-lookup"><span data-stu-id="49848-186">The capture process also posts any detected changes to the column structure of tracked tables to the cdc.ddl_history table.</span></span> <span data-ttu-id="49848-187">下流のアプリケーションで調整を加える必要がある場合に通知されるようにするには、 [sys.sp_cdc_get_ddl_history](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-get-ddl-history-transact-sql)ストアド プロシージャを使用します。</span><span class="sxs-lookup"><span data-stu-id="49848-187">Consumers wishing to be alerted of adjustments that might have to be made in downstream applications, use the stored procedure [sys.sp_cdc_get_ddl_history](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-get-ddl-history-transact-sql).</span></span>  
  
 <span data-ttu-id="49848-188">通常は、関連付けられているソース テーブルに DDL の変更が適用されても、現在のキャプチャ インスタンスの構造はそのまま保持されます。</span><span class="sxs-lookup"><span data-stu-id="49848-188">Typically, the current capture instance will continue to retain its shape when DDL changes are applied to its associated source table.</span></span> <span data-ttu-id="49848-189">ただし、そのテーブルの 2 つ目のキャプチャ インスタンスを作成して、そのインスタンスに新しい列構造が反映されるようにすることもできます。</span><span class="sxs-lookup"><span data-stu-id="49848-189">However, it is possible to create a second capture instance for the table that reflects the new column structure.</span></span> <span data-ttu-id="49848-190">これにより、同じソース テーブルに対する変更が、それぞれ異なる列構造を持つ 2 つの個別の変更テーブルに記録されるようになります。</span><span class="sxs-lookup"><span data-stu-id="49848-190">This allows the capture process to make changes to the same source table into two distinct change tables having two different column structures.</span></span> <span data-ttu-id="49848-191">その結果、一方の変更テーブルで現在実行中のプログラムに引き続きデータを提供しながら、もう一方の変更テーブルを開発環境で使用して新しい列データの組み込みに取り組むことができます。</span><span class="sxs-lookup"><span data-stu-id="49848-191">Thus, while one change table can continue to feed current operational programs, the second one can drive a development environment that is trying to incorporate the new column data.</span></span> <span data-ttu-id="49848-192">このようにキャプチャ メカニズムで両方の変更テーブルに並行してデータを書き込むことができれば、一方の変更テーブルからもう一方の変更テーブルに、変更データを失うことなく移行できるようになります。</span><span class="sxs-lookup"><span data-stu-id="49848-192">Allowing the capture mechanism to populate both change tables in tandem means that a transition from one to the other can be accomplished without loss of change data.</span></span> <span data-ttu-id="49848-193">この移行は、2 つの変更データ キャプチャ タイムラインが重複している期間であればいつでも行うことができます。</span><span class="sxs-lookup"><span data-stu-id="49848-193">This can happen any time the two change data capture timelines overlap.</span></span> <span data-ttu-id="49848-194">移行が完了したら、古いキャプチャ インスタンスは削除できます。</span><span class="sxs-lookup"><span data-stu-id="49848-194">When the transition is effected, the obsolete capture instance can be removed.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="49848-195">1 つのソース テーブルに同時に関連付けることのできるキャプチャ インスタンスは最大 2 つです。</span><span class="sxs-lookup"><span data-stu-id="49848-195">The maximum number of capture instances that can be concurrently associated with a single source table is two.</span></span>  
  
## <a name="relationship-between-the-capture-job-and-the-transactional-replication-logreader"></a><span data-ttu-id="49848-196">キャプチャ ジョブとトランザクション レプリケーション ログ リーダーの関係</span><span class="sxs-lookup"><span data-stu-id="49848-196">Relationship Between the Capture Job and the Transactional Replication Logreader</span></span>  
 <span data-ttu-id="49848-197">変更データ キャプチャ プロセスのロジックは、ストアド プロシージャの [sp_replcmds](/sql/relational-databases/system-stored-procedures/sp-replcmds-transact-sql)に組み込まれています。これは、sqlservr.exe の一部として作成された内部サーバー関数で、トランザクション レプリケーションでトランザクション ログから変更を取得するためにも使用されます。</span><span class="sxs-lookup"><span data-stu-id="49848-197">The logic for change data capture process is embedded in the stored procedure [sp_replcmds](/sql/relational-databases/system-stored-procedures/sp-replcmds-transact-sql), an internal server function built as part of sqlservr.exe and also used by transactional replication to harvest changes from the transaction log.</span></span> <span data-ttu-id="49848-198">データベースで有効になっているのが変更データ キャプチャだけの場合は、sp_replcmds を呼び出すための手段として、変更データ キャプチャの SQL Server エージェント キャプチャ ジョブを作成します。</span><span class="sxs-lookup"><span data-stu-id="49848-198">When change data capture alone is enabled for a database, you create the change data capture SQL Server Agent capture job as the vehicle for invoking sp_replcmds.</span></span> <span data-ttu-id="49848-199">レプリケーションも存在する場合は、トランザクション ログ リーダーを使用するだけで、両方のコンシューマーの変更データのニーズを満たすことができます。</span><span class="sxs-lookup"><span data-stu-id="49848-199">When replication is also present, the transactional logreader alone is used to satisfy the change data needs for both of these consumers.</span></span> <span data-ttu-id="49848-200">これにより、同じデータベースでレプリケーションと変更データ キャプチャの両方が有効になっている場合にログの競合を大幅に削減できます。</span><span class="sxs-lookup"><span data-stu-id="49848-200">This strategy significantly reduces log contention when both replication and change data capture are enabled for the same database.</span></span>  
  
 <span data-ttu-id="49848-201">変更データをキャプチャするためのこの 2 つの操作モードの切り替えは、変更データ キャプチャが有効になっているデータベースのレプリケーションの状態が変更されるたびに自動的に行われます。</span><span class="sxs-lookup"><span data-stu-id="49848-201">The switch between these two operational modes for capturing change data occurs automatically whenever there is a change in the replication status of a change data capture enabled database.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="49848-202">キャプチャ ロジックのインスタンスはどちらも、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] エージェントが実行されていないとプロセスを実行できません。</span><span class="sxs-lookup"><span data-stu-id="49848-202">Both instances of the capture logic require [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent to be running for the process to execute.</span></span>  
  
 <span data-ttu-id="49848-203">キャプチャ プロセスの主なタスクは、ログをスキャンして、列データとトランザクション関連の情報を変更データ キャプチャの変更テーブルに書き込むことです。</span><span class="sxs-lookup"><span data-stu-id="49848-203">The principal task of the capture process is to scan the log and write column data and transaction related information to the change data capture change tables.</span></span> <span data-ttu-id="49848-204">キャプチャ プロセスでは、データを書き込むすべての変更データ キャプチャ変更テーブルでトランザクション的に一貫した境界を確保するために、各スキャン サイクルで独自のトランザクションを開いてコミットします。</span><span class="sxs-lookup"><span data-stu-id="49848-204">To ensure a transactionally consistent boundary across all the change data capture change tables that it populates, the capture process opens and commits its own transaction on each scan cycle.</span></span> <span data-ttu-id="49848-205">新たに変更データ キャプチャが有効にされたテーブルがあるとそれが検出されて、ログの変更エントリをアクティブに監視するテーブルのセットにそのテーブルが自動的に追加されます。</span><span class="sxs-lookup"><span data-stu-id="49848-205">It detects when tables are newly enabled for change data capture, and automatically includes them in the set of tables that are actively monitored for change entries in the log.</span></span> <span data-ttu-id="49848-206">同様に、変更データ キャプチャが無効にされた場合にもそれが検出されて、変更データをアクティブに監視するテーブルのセットからそのソース テーブルが削除されます。</span><span class="sxs-lookup"><span data-stu-id="49848-206">Similarly, disabling change data capture will also be detected, causing the source table to be removed from the set of tables actively monitored for change data.</span></span> <span data-ttu-id="49848-207">ログのセクションの処理が完了すると、サーバー ログ切り捨てロジックに情報が送られて、切り捨ての対象となるログ エントリが識別されます。</span><span class="sxs-lookup"><span data-stu-id="49848-207">When processing for a section of the log is finished, the capture process signals the server log truncation logic, which uses this information to identify log entries eligible for truncation.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="49848-208">データベースの変更データ キャプチャが有効になっている場合は、復旧モードが単純復旧に設定されていても、キャプチャ対象としてマークされた変更がすべてキャプチャ プロセスで収集されるまで、ログの切り捨て位置が進められることはありません。</span><span class="sxs-lookup"><span data-stu-id="49848-208">When a database is enabled for change data capture, even if the recovery mode is set to simple recovery the log truncation point will not advance until all the changes that are marked for capture have been gathered by the capture process.</span></span> <span data-ttu-id="49848-209">キャプチャ プロセスが実行されておらず、収集対象の変更がある場合は、CHECKPOINT を実行してもログが切り捨てられることはありません。</span><span class="sxs-lookup"><span data-stu-id="49848-209">If the capture process is not running and there are changes to be gathered, executing CHECKPOINT will not truncate the log.</span></span>  
  
 <span data-ttu-id="49848-210">キャプチャ プロセスは、追跡対象のテーブルに対する DDL の変更の履歴を保持するためにも使用されます。</span><span class="sxs-lookup"><span data-stu-id="49848-210">The capture process is also used to maintain history on the DDL changes to tracked tables.</span></span> <span data-ttu-id="49848-211">変更データ キャプチャが有効になっているデータベースまたはテーブルが削除されたり、変更データ キャプチャが有効になっているテーブルの列が追加、変更、または削除されたりするたびに、変更データ キャプチャに関連付けられている DDL ステートメントのエントリがデータベース トランザクション ログに作成されます。</span><span class="sxs-lookup"><span data-stu-id="49848-211">The DDL statements that are associated with change data capture make entries to the database transaction log whenever a change data capture-enabled database or table is dropped or columns of a change data capture-enabled table are added, modified, or dropped.</span></span> <span data-ttu-id="49848-212">これらのログ エントリがキャプチャ プロセスによって処理されると、関連する DDL イベントが cdc.ddl_history テーブルに書き込まれます。</span><span class="sxs-lookup"><span data-stu-id="49848-212">These log entries are processed by the capture process, which then posts the associated DDL events to the cdc.ddl_history table.</span></span> <span data-ttu-id="49848-213">追跡対象のテーブルに影響を与えた DDL イベントに関する情報を取得するには、 [sys.sp_cdc_get_ddl_history](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-get-ddl-history-transact-sql)ストアド プロシージャを使用します。</span><span class="sxs-lookup"><span data-stu-id="49848-213">You can obtain information about DDL events that affect tracked tables by using the stored procedure [sys.sp_cdc_get_ddl_history](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-get-ddl-history-transact-sql).</span></span>  
  
## <a name="change-data-capture-agent-jobs"></a><span data-ttu-id="49848-214">変更データ キャプチャのエージェント ジョブ</span><span class="sxs-lookup"><span data-stu-id="49848-214">Change Data Capture Agent Jobs</span></span>  
 <span data-ttu-id="49848-215">変更データ キャプチャが有効になっているデータベースには、通常、2 つの [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] エージェント ジョブが関連付けられています。1 つはデータベース変更テーブルへの書き込みに使用されるジョブ、もう 1 つは変更テーブルのクリーンアップを行うジョブです。</span><span class="sxs-lookup"><span data-stu-id="49848-215">Two [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent jobs are typically associated with a change data capture enabled database: one that is used to populate the database change tables, and one that is responsible for change table cleanup.</span></span> <span data-ttu-id="49848-216">どちらのジョブも、 [!INCLUDE[tsql](../../includes/tsql-md.md)] コマンドを実行する 1 つの手順で構成されています。</span><span class="sxs-lookup"><span data-stu-id="49848-216">Both jobs consist of a single step that runs a [!INCLUDE[tsql](../../includes/tsql-md.md)] command.</span></span> <span data-ttu-id="49848-217">呼び出される [!INCLUDE[tsql](../../includes/tsql-md.md)] コマンドは、ジョブのロジックを実装する変更データ キャプチャの定義済みストアド プロシージャです。</span><span class="sxs-lookup"><span data-stu-id="49848-217">The [!INCLUDE[tsql](../../includes/tsql-md.md)] command that is invoked is a change data capture defined stored procedure that implements the logic of the job.</span></span> <span data-ttu-id="49848-218">これらのジョブは、データベースの最初のテーブルの変更データ キャプチャを有効にしたときに作成されます。</span><span class="sxs-lookup"><span data-stu-id="49848-218">The jobs are created when the first table of the database is enabled for change data capture.</span></span> <span data-ttu-id="49848-219">クリーンアップ ジョブは常に作成されます。</span><span class="sxs-lookup"><span data-stu-id="49848-219">The Cleanup Job is always created.</span></span> <span data-ttu-id="49848-220">キャプチャ ジョブは、データベースに定義済みのトランザクション パブリケーションがない場合にのみ作成されます。</span><span class="sxs-lookup"><span data-stu-id="49848-220">The capture job will only be created if there are no defined transactional publications for the database.</span></span> <span data-ttu-id="49848-221">データベースで変更データ キャプチャとトランザクション レプリケーションの両方が有効になっている場合に、データベースに定義済みのパブリケーションがなくなったためにトランザクション ログ リーダー ジョブが削除されたときにも作成されます。</span><span class="sxs-lookup"><span data-stu-id="49848-221">The capture job is also created when both change data capture and transactional replication are enabled for a database, and the transactional logreader job is removed because the database no longer has defined publications.</span></span>  
  
 <span data-ttu-id="49848-222">キャプチャ ジョブとクリーンアップ ジョブはどちらも既定のパラメーターを使用して作成されます。</span><span class="sxs-lookup"><span data-stu-id="49848-222">Both the capture and cleanup jobs are created by using default parameters.</span></span> <span data-ttu-id="49848-223">キャプチャ ジョブはすぐに開始され、</span><span class="sxs-lookup"><span data-stu-id="49848-223">The capture job is started immediately.</span></span> <span data-ttu-id="49848-224">継続的に実行されます。各スキャン サイクルで最大 1000 のトランザクションが処理されます。サイクル間の待ち時間は 5 秒です。</span><span class="sxs-lookup"><span data-stu-id="49848-224">It runs continuously, processing a maximum of 1000 transactions per scan cycle with a wait of 5 seconds between cycles.</span></span> <span data-ttu-id="49848-225">クリーンアップ ジョブは毎日午前 2 時に実行されます。</span><span class="sxs-lookup"><span data-stu-id="49848-225">The cleanup job runs daily at 2 A.M.</span></span> <span data-ttu-id="49848-226">変更テーブルのエントリは 4320 分 (3 日間) 保持されます。1 つの DELETE ステートメントで最大 5000 のエントリを削除できます。</span><span class="sxs-lookup"><span data-stu-id="49848-226">It retains change table entries for 4320 minutes or 3 days, removing a maximum of 5000 entries with a single delete statement.</span></span>  
  
 <span data-ttu-id="49848-227">変更データ キャプチャのエージェント ジョブは、データベースで変更データ キャプチャが無効にされると削除されます。</span><span class="sxs-lookup"><span data-stu-id="49848-227">The change data capture agent jobs are removed when change data capture is disabled for a database.</span></span> <span data-ttu-id="49848-228">また、変更データ キャプチャとトランザクション レプリケーションの両方が有効になっている場合に、データベースに最初のパブリケーションが追加されたときに削除されることもあります。</span><span class="sxs-lookup"><span data-stu-id="49848-228">The capture job can also be removed when the first publication is added to a database, and both change data capture and transactional replication are enabled.</span></span>  
  
 <span data-ttu-id="49848-229">内部では、 [sys.sp_cdc_add_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-add-job-transact-sql) ストアド プロシージャと [sys.sp_cdc_drop_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-drop-job-transact-sql)ストアド プロシージャをそれぞれ使用して、変更データ キャプチャのエージェント ジョブが作成および削除されます。</span><span class="sxs-lookup"><span data-stu-id="49848-229">Internally, change data capture agent jobs are created and dropped by using the stored procedures [sys.sp_cdc_add_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-add-job-transact-sql) and [sys.sp_cdc_drop_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-drop-job-transact-sql), respectively.</span></span> <span data-ttu-id="49848-230">これらのストアド プロシージャは、管理者がこれらのジョブの作成および削除を制御できるように公開されています。</span><span class="sxs-lookup"><span data-stu-id="49848-230">These stored procedures are also exposed so that administrators can control the creation and removal of these jobs.</span></span>  
  
 <span data-ttu-id="49848-231">変更データ キャプチャのエージェント ジョブについて、既定の構成を管理者が明示的に制御することはできませんが、</span><span class="sxs-lookup"><span data-stu-id="49848-231">An administrator has no explicit control over the default configuration of the change data capture agent jobs.</span></span> <span data-ttu-id="49848-232">既定の構成パラメーターを変更できるように [sys.sp_cdc_change_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-change-job-transact-sql) ストアド プロシージャが用意されています。</span><span class="sxs-lookup"><span data-stu-id="49848-232">The stored procedure [sys.sp_cdc_change_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-change-job-transact-sql) is provided to allow the default configuration parameters to be modified.</span></span> <span data-ttu-id="49848-233">さらに、 [sys.sp_cdc_help_jobs](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-help-jobs-transact-sql) ストアド プロシージャを使用すると、現在の構成パラメーターを表示できます。</span><span class="sxs-lookup"><span data-stu-id="49848-233">In addition, the stored procedure [sys.sp_cdc_help_jobs](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-help-jobs-transact-sql) allows current configuration parameters to be viewed.</span></span> <span data-ttu-id="49848-234">キャプチャ ジョブとクリーンアップ ジョブの構成パラメーターは、どちらも起動時に msdb.dbo.cdc_jobs テーブルから抽出されます。</span><span class="sxs-lookup"><span data-stu-id="49848-234">Both the capture job and the cleanup job extract configuration parameters from the table msdb.dbo.cdc_jobs on startup.</span></span> <span data-ttu-id="49848-235">[sys.sp_cdc_change_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-change-job-transact-sql) を使用してこれらの値に変更を加えた場合、その変更を有効にするには、ジョブをいったん停止してから再開する必要があります。</span><span class="sxs-lookup"><span data-stu-id="49848-235">Any changes made to these values by using [sys.sp_cdc_change_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-change-job-transact-sql) will not take effect until the job is stopped and restarted.</span></span>  
  
 <span data-ttu-id="49848-236">変更データ キャプチャのエージェント ジョブを開始および停止できるように、さらに 2 つのストアド プロシージャ ( [sys.sp_cdc_start_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-start-job-transact-sql) と [sys.sp_cdc_stop_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-stop-job-transact-sql)) が用意されています。</span><span class="sxs-lookup"><span data-stu-id="49848-236">Two additional stored procedures are provided to allow the change data capture agent jobs to be started and stopped: [sys.sp_cdc_start_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-start-job-transact-sql) and [sys.sp_cdc_stop_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-stop-job-transact-sql).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="49848-237">キャプチャ ジョブを開始したり停止したりしても、変更データが失われることはありません。</span><span class="sxs-lookup"><span data-stu-id="49848-237">Starting and stopping the capture job does not result in a loss of change data.</span></span> <span data-ttu-id="49848-238">変更テーブルに格納される変更エントリについて、アクティブにログがスキャンされなくなるだけです。</span><span class="sxs-lookup"><span data-stu-id="49848-238">It only prevents the capture process from actively scanning the log for change entries to deposit in the change tables.</span></span> <span data-ttu-id="49848-239">要求のピーク時にキャプチャ ジョブを停止して、ピーク時を過ぎたら再開することにより、ログ スキャンの負荷をピーク時に合理的に取り除くことができます。</span><span class="sxs-lookup"><span data-stu-id="49848-239">A reasonable strategy to prevent log scanning from adding load during periods of peak demand is to stop the capture job and restart it when demand is reduced.</span></span>  
  
 <span data-ttu-id="49848-240">この 2 つの [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] エージェント ジョブはどちらも、変更データ キャプチャ環境の基本的なニーズに対応できるように十分な柔軟性と構成可能性を備えていますが、</span><span class="sxs-lookup"><span data-stu-id="49848-240">Both [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent jobs were designed to be flexible enough and sufficiently configurable to meet the basic needs of change data capture environments.</span></span> <span data-ttu-id="49848-241">コア機能を提供する基になるストアド プロシージャが公開されているため、さらなるカスタマイズも可能です。</span><span class="sxs-lookup"><span data-stu-id="49848-241">In both cases, however, the underlying stored procedures that provide the core functionality have been exposed so that further customization is possible.</span></span>  
  
 <span data-ttu-id="49848-242">NETWORK SERVICE アカウントでデータベース エンジン サービスまたは SQL Server エージェント サービスを実行中の場合、変更データ キャプチャは正しく機能できません。</span><span class="sxs-lookup"><span data-stu-id="49848-242">Change data capture cannot function properly when the Database Engine service or the SQL Server Agent service is running under the NETWORK SERVICE account.</span></span> <span data-ttu-id="49848-243">この結果、エラー 22832 が発生します。</span><span class="sxs-lookup"><span data-stu-id="49848-243">This can result in error 22832.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="49848-244">参照</span><span class="sxs-lookup"><span data-stu-id="49848-244">See Also</span></span>  
 <span data-ttu-id="49848-245">[データ変更の追跡 &#40;SQL Server&#41;](../track-changes/track-data-changes-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="49848-245">[Track Data Changes &#40;SQL Server&#41;](../track-changes/track-data-changes-sql-server.md) </span></span>  
 <span data-ttu-id="49848-246">[変更データ キャプチャの有効化と無効化 &#40;SQL Server&#41;](../track-changes/enable-and-disable-change-data-capture-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="49848-246">[Enable and Disable Change Data Capture &#40;SQL Server&#41;](../track-changes/enable-and-disable-change-data-capture-sql-server.md) </span></span>  
 <span data-ttu-id="49848-247">[変更データの処理 &#40;SQL Server&#41;](../track-changes/work-with-change-data-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="49848-247">[Work with Change Data &#40;SQL Server&#41;](../track-changes/work-with-change-data-sql-server.md) </span></span>  
 [<span data-ttu-id="49848-248">変更データ キャプチャの管理と監視 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="49848-248">Administer and Monitor Change Data Capture &#40;SQL Server&#41;</span></span>](../track-changes/administer-and-monitor-change-data-capture-sql-server.md)  
  
  
