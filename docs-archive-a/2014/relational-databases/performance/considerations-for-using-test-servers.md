---
title: テスト サーバーの使用に関する注意点 | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: performance
ms.topic: conceptual
helpviewer_keywords:
- overhead [Database Engine Tuning Advisor]
- tuning overhead [SQL Server]
- reducing production server tuning load
- Database Engine Tuning Advisor [SQL Server], test servers
- xp_msver
- test servers [Database Engine Tuning Advisor]
- production servers [SQL Server]
- offload tuning overhead [SQL Server]
ms.assetid: 94e6c3e5-1f09-4616-9da2-4e44d066d494
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 3fe835c1e92b382e3e2fadd7e80d4b2984929cc5
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87714218"
---
# <a name="considerations-for-using-test-servers"></a><span data-ttu-id="d94d8-102">テスト サーバーの使用に関する注意点</span><span class="sxs-lookup"><span data-stu-id="d94d8-102">Considerations for Using Test Servers</span></span>
  <span data-ttu-id="d94d8-103">実稼働サーバー上のデータベースのチューニングにテスト サーバーを使用することは、 [!INCLUDE[ssDE](../../includes/ssde-md.md)] チューニング アドバイザーの大きな利点です。</span><span class="sxs-lookup"><span data-stu-id="d94d8-103">Using a test server to tune a database on a production server is an important benefit of [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor.</span></span> <span data-ttu-id="d94d8-104">この機能を使用して、実際のデータを実稼働サーバーからテスト サーバーにコピーすることなく、チューニングにかかるオーバーヘッドをテスト サーバーに移行できます。</span><span class="sxs-lookup"><span data-stu-id="d94d8-104">Using this feature, you can offload tuning overhead to a test server without copying the actual data over to the test server from the production server.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="d94d8-105">[!INCLUDE[ssDE](../../includes/ssde-md.md)] チューニング アドバイザーのグラフィカル ユーザー インターフェイス (GUI) では、テスト サーバーのチューニング機能はサポートされません。</span><span class="sxs-lookup"><span data-stu-id="d94d8-105">The test server tuning feature is not supported in the [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor graphical user interface (GUI).</span></span>  
  
 <span data-ttu-id="d94d8-106">この機能を正しく使用するために、以下のセクションの考慮事項を確認してください。</span><span class="sxs-lookup"><span data-stu-id="d94d8-106">To use this feature successfully, review the considerations listed in the following sections.</span></span>  
  
## <a name="setting-up-the-test-serverproduction-server-environment"></a><span data-ttu-id="d94d8-107">テスト サーバー/実稼働サーバー環境の設定</span><span class="sxs-lookup"><span data-stu-id="d94d8-107">Setting Up the Test Server/Production Server Environment</span></span>  
  
-   <span data-ttu-id="d94d8-108">実稼働サーバー上のデータベースをチューニングするためにテスト サーバーを使用するユーザーは、両方のサーバーに存在している必要があります。存在しない場合、このシナリオは失敗します。</span><span class="sxs-lookup"><span data-stu-id="d94d8-108">The user who wants to use a test server to tune a database on a production server must exist on both servers, or this scenario will not work.</span></span>  
  
-   <span data-ttu-id="d94d8-109">テスト サーバーと実稼働サーバーのシナリオでは、拡張ストアド プロシージャ **xp_msver**を有効にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="d94d8-109">The extended stored procedure, **xp_msver**, must be enabled to use the test server/production server scenario.</span></span> [!INCLUDE[ssDE](../../includes/ssde-md.md)] <span data-ttu-id="d94d8-110">チューニング アドバイザーでは、この拡張ストアド プロシージャを使用して、実稼働サーバーのプロセッサ数と使用可能なメモリをフェッチし、テスト サーバーでのチューニングに使用します。</span><span class="sxs-lookup"><span data-stu-id="d94d8-110">Tuning Advisor uses this extended stored procedure to fetch the number of processors and the available memory of the production server to use while tuning the test server.</span></span> <span data-ttu-id="d94d8-111">**xp_msver** が有効ではない場合、 [!INCLUDE[ssDE](../../includes/ssde-md.md)] チューニング アドバイザーでは、 [!INCLUDE[ssDE](../../includes/ssde-md.md)] チューニング アドバイザーを実行しているコンピューターのハードウェア特性が想定値として使用されます。</span><span class="sxs-lookup"><span data-stu-id="d94d8-111">If **xp_msver** is not enabled, [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor assumes the hardware characteristics of the computer where [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor is running.</span></span> <span data-ttu-id="d94d8-112">[!INCLUDE[ssDE](../../includes/ssde-md.md)] チューニング アドバイザーを実行しているコンピューターのハードウェア特性を推定できない場合は、1 つのプロセッサと 1,024 MB のメモリがあると仮定します。</span><span class="sxs-lookup"><span data-stu-id="d94d8-112">If the hardware characteristics of the computer where [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor is running are not available, one processor and 1024 megabytes (MBs) of memory are assumed.</span></span> <span data-ttu-id="d94d8-113">この拡張ストアド プロシージャは、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]をインストールしたときに既定でオンになっています。</span><span class="sxs-lookup"><span data-stu-id="d94d8-113">This extended stored procedure is turned on by default when you install [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="d94d8-114">詳細については、「[セキュリティ構成](../security/surface-area-configuration.md)」および「[xp_msver &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/xp-msver-transact-sql)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="d94d8-114">For more information, see [Surface Area Configuration](../security/surface-area-configuration.md) and [xp_msver &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/xp-msver-transact-sql).</span></span>  
  
-   [!INCLUDE[ssDE](../../includes/ssde-md.md)] <span data-ttu-id="d94d8-115">チューニング アドバイザーでは、テスト サーバーと実稼働サーバーの [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] のエディションが同じである必要があります。</span><span class="sxs-lookup"><span data-stu-id="d94d8-115">Tuning Advisor expects the editions of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] to be the same on both the test server and the production server.</span></span> <span data-ttu-id="d94d8-116">2 つの異なるエディションがある場合は、テスト サーバーのエディションが優先されます。</span><span class="sxs-lookup"><span data-stu-id="d94d8-116">If there are two different editions, the edition on the test server takes precedence.</span></span> <span data-ttu-id="d94d8-117">たとえば、テスト サーバーで [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Standard が実行されている場合は、実稼働サーバーで実行されているのが [!INCLUDE[ssDE](../../includes/ssde-md.md)] Enterprise であっても、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] チューニング アドバイザーの推奨設定にはインデックス付きビュー、パーティション分割、およびオンライン操作は含まれません。</span><span class="sxs-lookup"><span data-stu-id="d94d8-117">For example, if the test server is running [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Standard, [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor will not include indexed views, partitioning, and online operations in its recommendations even if the production server is running [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Enterprise.</span></span>  
  
## <a name="about-test-serverproduction-server-behavior"></a><span data-ttu-id="d94d8-118">テスト サーバー/実稼働サーバーの動作について</span><span class="sxs-lookup"><span data-stu-id="d94d8-118">About Test Server/Production Server Behavior</span></span>  
  
-   [!INCLUDE[ssDE](../../includes/ssde-md.md)] <span data-ttu-id="d94d8-119">チューニング アドバイザーでは、推奨設定の作成時に実稼働サーバーとテスト サーバー間のハードウェア上の違いが考慮されます。</span><span class="sxs-lookup"><span data-stu-id="d94d8-119">Tuning Advisor takes into account hardware differences between the production and the test server when creating recommendations.</span></span> <span data-ttu-id="d94d8-120">推奨設定は、実稼働サーバーだけでチューニングを行った場合と同じになります。</span><span class="sxs-lookup"><span data-stu-id="d94d8-120">The recommendation is the same as though the tuning was done on the production server alone.</span></span>  
  
-   [!INCLUDE[ssDE](../../includes/ssde-md.md)] <span data-ttu-id="d94d8-121">チューニング アドバイザーでは、チューニングに必要な統計情報を作成したり、メタデータを収集するために、実稼働サーバーにある程度負荷をかける場合があります。</span><span class="sxs-lookup"><span data-stu-id="d94d8-121">Tuning Advisor may impose some load on the production server for gathering metadata as well as creation of statistics necessary for tuning.</span></span>  
  
-   [!INCLUDE[ssDE](../../includes/ssde-md.md)] <span data-ttu-id="d94d8-122">チューニング アドバイザーでは、実稼働サーバーからテスト サーバーに実際のデータがコピーされることはありません。</span><span class="sxs-lookup"><span data-stu-id="d94d8-122">Tuning Advisor does not copy actual data from the production server to the test server.</span></span> <span data-ttu-id="d94d8-123">データベースのメタデータと必要な統計情報がコピーされるだけです。</span><span class="sxs-lookup"><span data-stu-id="d94d8-123">It only copies the metadata of the databases and the necessary statistics.</span></span>  
  
-   <span data-ttu-id="d94d8-124">すべてのセッション情報が、実稼働サーバー上の **msdb** に格納されます。</span><span class="sxs-lookup"><span data-stu-id="d94d8-124">All session information is stored in **msdb** on the production server.</span></span> <span data-ttu-id="d94d8-125">そのため、使用可能なテスト サーバーはすべてチューニングに利用でき、すべてのセッションについての情報を 1 か所 (実稼働サーバー) で使用できます。</span><span class="sxs-lookup"><span data-stu-id="d94d8-125">This allows you to exploit any available test server for tuning, and information about all sessions is available in one place (the production server).</span></span>  
  
## <a name="issues-related-to-the-shell-database"></a><span data-ttu-id="d94d8-126">シェル データベースに関連する問題</span><span class="sxs-lookup"><span data-stu-id="d94d8-126">Issues Related to the Shell Database</span></span>  
  
-   <span data-ttu-id="d94d8-127">チューニング後は、チューニング処理中に [!INCLUDE[ssDE](../../includes/ssde-md.md)] チューニング アドバイザーによってテスト サーバー上に作成されたすべてのメタデータが削除されます。</span><span class="sxs-lookup"><span data-stu-id="d94d8-127">After tuning, [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor should remove any metadata that it created on the test server during the tuning process.</span></span> <span data-ttu-id="d94d8-128">シェル データベースも削除されます。</span><span class="sxs-lookup"><span data-stu-id="d94d8-128">This includes the shell database.</span></span> <span data-ttu-id="d94d8-129">同じ実稼働サーバーとテスト サーバーを使って一連のチューニング セッションを実行する場合は、このシェル データベースを保持しておいて時間を節約することができます。</span><span class="sxs-lookup"><span data-stu-id="d94d8-129">If you are performing a series of tuning sessions with the same production and test servers, you may want to retain this shell database to save time.</span></span> <span data-ttu-id="d94d8-130">XML 入力ファイルでは、 **RetainShellDB** サブ要素を、 **TuningOptions** 親要素の下のその他のサブ要素と共に指定します。</span><span class="sxs-lookup"><span data-stu-id="d94d8-130">In the XML input file, specify the **RetainShellDB** subelement with the other sub elements under the **TuningOptions** parent element.</span></span> <span data-ttu-id="d94d8-131">これらのオプションを使用することで、 [!INCLUDE[ssDE](../../includes/ssde-md.md)] チューニング アドバイザーでシェル データベースが保持されるようになります。</span><span class="sxs-lookup"><span data-stu-id="d94d8-131">Using these options causes [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor to retain the shell database.</span></span> <span data-ttu-id="d94d8-132">詳細については、「[XML 入力ファイル リファレンス &#40;データベース エンジン チューニング アドバイザー&#41;](database-engine-tuning-advisor.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="d94d8-132">For more information, see [XML Input File Reference &#40;Database Engine Tuning Advisor&#41;](database-engine-tuning-advisor.md).</span></span>  
  
-   <span data-ttu-id="d94d8-133">テスト サーバー/実稼働サーバーのチューニング セッションが成功した後、 **RetainShellDB** サブ要素を指定していないにもかかわらず、シェル データベースがテスト サーバーに残る場合があります。</span><span class="sxs-lookup"><span data-stu-id="d94d8-133">Shell databases may be left behind on the test server after a successful test server/production server tuning session even if you have not specified the **RetainShellDB** subelement.</span></span> <span data-ttu-id="d94d8-134">こうした不要なシェル データベースはその後のチューニング セッションに干渉する可能性があるため、別のテスト サーバー/実稼働サーバーのチューニング セッションを実行する前に削除する必要があります。</span><span class="sxs-lookup"><span data-stu-id="d94d8-134">These unwanted shell databases may interfere with subsequent tuning sessions and should be dropped before performing another test server/production server tuning session.</span></span> <span data-ttu-id="d94d8-135">また、チューニング セッションが予期せず終了した場合は、テスト サーバー上のシェル データベースと、それらのデータベース内のオブジェクトが、テスト サーバー上に残る可能性があります。</span><span class="sxs-lookup"><span data-stu-id="d94d8-135">In addition, if a tuning session exits unexpectedly, the shell databases on the test server and the objects within those databases may be left behind on the test server.</span></span> <span data-ttu-id="d94d8-136">これらのデータベースとオブジェクトも、新しいテスト サーバー/実稼働サーバーのチューニング セッションを開始する前に削除する必要があります。</span><span class="sxs-lookup"><span data-stu-id="d94d8-136">You should also delete these databases and objects before starting a new test server/production server tuning session.</span></span>  
  
## <a name="issues-related-to-the-tuning-process"></a><span data-ttu-id="d94d8-137">チューニング処理に関連する問題</span><span class="sxs-lookup"><span data-stu-id="d94d8-137">Issues Related to the Tuning Process</span></span>  
  
-   <span data-ttu-id="d94d8-138">ユーザーは、実稼働サーバーとテスト サーバー間の違いに起因するチューニング エラーと、実稼働サーバーからテスト サーバーへのメタデータのコピーに起因するエラーについて、チューニング ログを確認する必要があります。</span><span class="sxs-lookup"><span data-stu-id="d94d8-138">The user must check the tuning log for tuning errors that result from differences between the production and test servers, and for errors that result from copying metadata from the production to the test server.</span></span> <span data-ttu-id="d94d8-139">たとえば、ユーザーのログイン情報がテスト サーバーに存在しない場合があります。</span><span class="sxs-lookup"><span data-stu-id="d94d8-139">For example, a user login may not exist on the test server.</span></span> <span data-ttu-id="d94d8-140">ユーザーのログインがテスト サーバーに存在しない場合、ワークロード内のイベントのうち、そのユーザー ログインによって発生するイベントをチューニングできない場合があります。</span><span class="sxs-lookup"><span data-stu-id="d94d8-140">If a user login does not exist on the test server, those events in the workload that are issued by that user login may not be tunable.</span></span> <span data-ttu-id="d94d8-141">チューニング ログを表示するには、 [!INCLUDE[ssDE](../../includes/ssde-md.md)] チューニング アドバイザーの GUI を使用します。</span><span class="sxs-lookup"><span data-stu-id="d94d8-141">Use the [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor GUI to view the tuning log.</span></span> <span data-ttu-id="d94d8-142">詳細については、「 [データベース エンジン チューニング アドバイザーからの出力の表示および操作](view-and-work-with-the-output-from-the-database-engine-tuning-advisor.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="d94d8-142">For more information, see [View and Work with the Output from the Database Engine Tuning Advisor](view-and-work-with-the-output-from-the-database-engine-tuning-advisor.md)</span></span>  
  
-   <span data-ttu-id="d94d8-143">[!INCLUDE[ssDE](../../includes/ssde-md.md)] チューニング アドバイザーによってテスト サーバー上に作成されるシェル データベースにオブジェクトが見つからないために、 [!INCLUDE[ssDE](../../includes/ssde-md.md)] チューニング アドバイザーで多数のイベントをチューニングできない場合は、チューニング ログを確認する必要があります。</span><span class="sxs-lookup"><span data-stu-id="d94d8-143">If [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor cannot tune many events because objects are missing in the shell database that [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor creates on the test server, the user must check the tuning log.</span></span> <span data-ttu-id="d94d8-144">チューニングできないイベントは、ログに記録されます。</span><span class="sxs-lookup"><span data-stu-id="d94d8-144">Events that cannot be tuned are listed in the log.</span></span> <span data-ttu-id="d94d8-145">テスト サーバー上のデータベースを正常にチューニングするには、シェル データベースに見つからないオブジェクトを作成してから新しいチューニング セッションを開始する必要があります</span><span class="sxs-lookup"><span data-stu-id="d94d8-145">To successfully tune the database on the test server, the user must create the missing objects in the shell database, and then start a new tuning session.</span></span>  
  
-   <span data-ttu-id="d94d8-146">同一名のデータベースが既にテスト サーバー上に存在する場合は、 [!INCLUDE[ssDE](../../includes/ssde-md.md)] チューニング アドバイザーではメタデータがコピーされずにチューニングが続行され、必要に応じて統計情報が収集されます。</span><span class="sxs-lookup"><span data-stu-id="d94d8-146">If a database with the same name already exists on the test server, [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor does not copy metadata, but continues tuning and gathers statistics as necessary.</span></span> <span data-ttu-id="d94d8-147">これは、 [!INCLUDE[ssDE](../../includes/ssde-md.md)] チューニング アドバイザーを起動する前に、ユーザーが既にデータベースをテスト サーバー上に作成し、適切なメタデータをコピーし終わっている場合に便利です。</span><span class="sxs-lookup"><span data-stu-id="d94d8-147">This is useful if the user has already created a database on the test server and has copied the appropriate metadata before invoking [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor.</span></span>  
  
-   <span data-ttu-id="d94d8-148">DATE_CORRELATION_OPTIMIZATION オプションが実稼働サーバー上のデータベースに対して有効になっていると、メタデータと、このオプションに関連付けられているデータの一部が、テスト サーバーのチューニング中にスクリプト化されません。</span><span class="sxs-lookup"><span data-stu-id="d94d8-148">If the DATE_CORRELATION_OPTIMIZATION option is turned on for a database on the production server, metadata and the data associated with this option are not completely scripted while tuning the test server.</span></span> <span data-ttu-id="d94d8-149">テスト サーバーと実稼働サーバーのシナリオでチューニングを実行する場合、次の問題が当てはまる場合があります。</span><span class="sxs-lookup"><span data-stu-id="d94d8-149">When tuning is performed for a test server/production server scenario, the following issues may apply:</span></span>  
  
    -   <span data-ttu-id="d94d8-150">DATE_CORRELATION_OPTIMIZATION オプションを使用するクエリの場合、サーバー間でクエリ プランが異なることがあります。</span><span class="sxs-lookup"><span data-stu-id="d94d8-150">Users can have different query plans on the servers for queries that use the DATE_CORRELATION_OPTIMIZATION option.</span></span>  
  
    -   [!INCLUDE[ssDE](../../includes/ssde-md.md)] <span data-ttu-id="d94d8-151">インデックス付きビューの推奨設定スクリプトで DATE_CORRELATION_OPTIMIZATION オプションを設定している場合、チューニング アドバイザーからそのビューを削除するように提示されることがあります。</span><span class="sxs-lookup"><span data-stu-id="d94d8-151">Tuning Advisor may suggest dropping indexed views that enforce the DATE_CORRELATION_OPTIMIZATION option in the recommendation script.</span></span>  
  
     <span data-ttu-id="d94d8-152">このため、相関関係の統計情報を保持するインデックス付きビューについては、 [!INCLUDE[ssDE](../../includes/ssde-md.md)] チューニング アドバイザーによって作成される推奨設定を無視してもかまいません。 [!INCLUDE[ssDE](../../includes/ssde-md.md)] チューニング アドバイザーでは、このようなインデックス付きビューのコストのみが認識され、利点が認識されないためです。</span><span class="sxs-lookup"><span data-stu-id="d94d8-152">Therefore, you may want to ignore any recommendations that [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor makes about the indexed views that hold correlation statistics because [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor knows their costs but not their benefits.</span></span> [!INCLUDE[ssDE](../../includes/ssde-md.md)] <span data-ttu-id="d94d8-153">チューニング アドバイザーでは、DATE_CORRELATION_OPTIMIZATION が有効であれば有益だった可能性がある **datetime** 列のクラスター化インデックスなど、特定のインデックスの選択が推奨されない場合があります。</span><span class="sxs-lookup"><span data-stu-id="d94d8-153">Tuning Advisor may not recommend selection of certain indexes such as clustered indexes on **datetime** columns, which could be beneficial when DATE_CORRELATION_OPTIMIZATION is enabled.</span></span>  
  
     <span data-ttu-id="d94d8-154">特定のビューが相関関係の統計情報に基づいているかどうかを判断するには、 **sys.views** カタログ ビューの [is_date_correlation_view](/sql/relational-databases/system-catalog-views/sys-views-transact-sql) 列を選択します。</span><span class="sxs-lookup"><span data-stu-id="d94d8-154">To determine if a view is based on correlation statistics, select the **is_date_correlation_view** column of the [sys.views](/sql/relational-databases/system-catalog-views/sys-views-transact-sql) catalog view.</span></span>  
  
  
