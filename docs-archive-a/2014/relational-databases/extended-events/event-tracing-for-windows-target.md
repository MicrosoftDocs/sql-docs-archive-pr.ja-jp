---
title: Event Tracing for Windows ターゲット | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: xevents
ms.topic: conceptual
helpviewer_keywords:
- event tracing for windows target
- ETW target
- targets [SQL Server extended events], event tracing for windows target
ms.assetid: ca2bb295-b7f6-49c3-91ed-0ad4c39f89d5
author: rothja
ms.author: jroth
ms.openlocfilehash: 55f247af30b5278f614b6505a94266cc07ec6c54
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87632480"
---
# <a name="event-tracing-for-windows-target"></a><span data-ttu-id="f296a-102">Event Tracing for Windows ターゲット</span><span class="sxs-lookup"><span data-stu-id="f296a-102">Event Tracing for Windows Target</span></span>
  <span data-ttu-id="f296a-103">Event Tracing for Windows (ETW) をターゲットとして使用する前に、ETW を活用するための知識を身に付けておくことをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="f296a-103">Before you use Event Tracing for Windows (ETW) as a target, we recommend that you have a working knowledge of ETW.</span></span> <span data-ttu-id="f296a-104">ETW トレースは、拡張イベントと組み合わせて使用されるか、拡張イベントのイベント コンシューマーとして使用されます。</span><span class="sxs-lookup"><span data-stu-id="f296a-104">ETW tracing is either used together with Extended Events or as an Extended Events event consumer.</span></span> <span data-ttu-id="f296a-105">ETW の背景情報については、次の外部リンクを参照してください。</span><span class="sxs-lookup"><span data-stu-id="f296a-105">The following external links provide a starting point for obtaining background information about ETW:</span></span>  
  
-   [<span data-ttu-id="f296a-106">Windows イベント</span><span class="sxs-lookup"><span data-stu-id="f296a-106">Windows Events</span></span>](https://go.microsoft.com/fwlink/?LinkId=92380)  
  
-   [<span data-ttu-id="f296a-107">ETW によりデバッグおよびパフォーマンス調整を改善する</span><span class="sxs-lookup"><span data-stu-id="f296a-107">Improve Debugging And Performance Tuning With ETW</span></span>](https://go.microsoft.com/fwlink/?LinkId=92381)  
  
 <span data-ttu-id="f296a-108">ETW ターゲットは、多くのセッションに追加できますが、シングルトン ターゲットです。</span><span class="sxs-lookup"><span data-stu-id="f296a-108">The ETW target is a singleton target, although the target can be added to many sessions.</span></span> <span data-ttu-id="f296a-109">多くのセッションでイベントが発生した場合、イベントは、イベントの発生ごとに 1 回、ETW ターゲットのみに反映されます。</span><span class="sxs-lookup"><span data-stu-id="f296a-109">If an event is raised on many sessions, the event will only be propagated to the ETW target one time per event occurrence.</span></span> <span data-ttu-id="f296a-110">拡張イベント エンジンは、プロセスあたり 1 つのインスタンスに制限されます。</span><span class="sxs-lookup"><span data-stu-id="f296a-110">The Extended Events engine is limited to a single instance per process.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="f296a-111">ETW ターゲットを動作させるには、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] サービス開始アカウントが Performance Log Users グループのメンバーであることが必要です。</span><span class="sxs-lookup"><span data-stu-id="f296a-111">For the ETW target to work, the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Service startup account must be a member of the Performance Log Users group.</span></span>  
  
 <span data-ttu-id="f296a-112">ETW セッションに存在するイベントの構成は、拡張イベント エンジンがホストするプロセスによって制御されます。</span><span class="sxs-lookup"><span data-stu-id="f296a-112">The configuration of the events present in an ETW session is controlled by the process that hosts the Extended Events engine.</span></span> <span data-ttu-id="f296a-113">拡張イベント エンジンは、どのイベントを発生させるか、どのような条件が満たされた場合にイベントを発生させるかを制御します。</span><span class="sxs-lookup"><span data-stu-id="f296a-113">The engine controls which events to raise and what conditions must be met for an event to occur.</span></span>  
  
 <span data-ttu-id="f296a-114">拡張イベント セッションへのバインド後、つまり、プロセスの有効期間中に初めて ETW ターゲットがアタッチされたとき、ETW ターゲットは、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] プロバイダー上で単一の ETW セッションを開きます。</span><span class="sxs-lookup"><span data-stu-id="f296a-114">After binding to an Extended Events session, which attaches the ETW target for the first time during the lifetime of a process, the ETW target opens a single ETW session on the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] provider.</span></span> <span data-ttu-id="f296a-115">ETW セッションが既に存在していた場合、ETW ターゲットは、既存のセッションへの参照を取得します。</span><span class="sxs-lookup"><span data-stu-id="f296a-115">If an ETW session already exists, the ETW target obtains a reference to the existing session.</span></span> <span data-ttu-id="f296a-116">この ETW セッションは、特定のコンピューター上のすべての [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] インスタンス間で共有されます。</span><span class="sxs-lookup"><span data-stu-id="f296a-116">This ETW session is shared across all [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instances on a given computer.</span></span> <span data-ttu-id="f296a-117">ETW ターゲットが割り当てられているセッションで発生したすべてのイベントは、この ETW セッションが受け取ることになります。</span><span class="sxs-lookup"><span data-stu-id="f296a-117">This ETW session receives all the events from sessions that have the ETW target.</span></span>  
  
 <span data-ttu-id="f296a-118">ETW では、プロバイダーがイベントを利用して、それを ETW に渡すことができるようになっている必要があります。そのため、セッションでは、すべての拡張イベント パッケージが有効化されます。</span><span class="sxs-lookup"><span data-stu-id="f296a-118">Because ETW needs providers to be enabled to consume events and flow them down to the ETW, all Extended Events packages are enabled on the session.</span></span> <span data-ttu-id="f296a-119">ETW ターゲットは、発生したイベントを、そのイベントのプロバイダーが有効になっているセッションへ送信します。</span><span class="sxs-lookup"><span data-stu-id="f296a-119">When an event is fired, the ETW target sends the event to the session on which the provider for the event is enabled.</span></span>  
  
 <span data-ttu-id="f296a-120">ETW ターゲットは、発生元スレッドでのイベントの同期発行をサポートします。</span><span class="sxs-lookup"><span data-stu-id="f296a-120">The ETW target supports synchronous publishing of events on the thread that raises the event.</span></span> <span data-ttu-id="f296a-121">イベントの非同期発行はサポートしません。</span><span class="sxs-lookup"><span data-stu-id="f296a-121">However, the ETW target does not support asynchronous event publishing.</span></span>  
  
 <span data-ttu-id="f296a-122">ETW ターゲットは、外部 ETW コントローラー (たとえば Logman.exe) からのコントロールをサポートしません。</span><span class="sxs-lookup"><span data-stu-id="f296a-122">The ETW target does not support control from external ETW controllers such as Logman.exe.</span></span> <span data-ttu-id="f296a-123">ETW トレースを生成するには、ETW ターゲットを使用してイベント セッションを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f296a-123">To produce ETW traces, an event session must be created with the ETW target.</span></span> <span data-ttu-id="f296a-124">詳細については、「 [CREATE EVENT SESSION &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-event-session-transact-sql)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f296a-124">For more information, see [CREATE EVENT SESSION &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-event-session-transact-sql).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="f296a-125">ETW ターゲットを有効にすると、XE_DEFAULT_ETW_SESSION という名前の ETW セッションが作成されます。</span><span class="sxs-lookup"><span data-stu-id="f296a-125">Enabling the ETW target creates an ETW session that is named XE_DEFAULT_ETW_SESSION.</span></span> <span data-ttu-id="f296a-126">XE_DEFAULT_ETW_SESSION という名前のセッションが既に存在する場合は、既存のセッションのプロパティを変更せずに使用されます。</span><span class="sxs-lookup"><span data-stu-id="f296a-126">If a session with the name XE_DEFAULT_ETW_SESSION already exists, it is used without modifying any properties of the existing session.</span></span> <span data-ttu-id="f296a-127">XE_DEFAULT_ETW_SESSION はすべての [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]のインスタンス間で共有されます。</span><span class="sxs-lookup"><span data-stu-id="f296a-127">The XE_DEFAULT_ETW_SESSION is shared between all instances of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="f296a-128">XE_DEFAULT_ETW_SESSION を開始した後に停止する場合は、Logman ツールなどの ETW コントローラーを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f296a-128">After you start the XE_DEFAULT_ETW_SESSION, you must stop it by using an ETW controller, such as the Logman tool.</span></span> <span data-ttu-id="f296a-129">たとえば、コマンド プロンプトで次のコマンドを実行します: `logman stop XE_DEFAULT_ETW_SESSION -ets`</span><span class="sxs-lookup"><span data-stu-id="f296a-129">For example, you can run the following command at the command prompt: `logman stop XE_DEFAULT_ETW_SESSION -ets`.</span></span>  
  
 <span data-ttu-id="f296a-130">次の表では、ETW ターゲットの構成に使用できるオプションについて説明します。</span><span class="sxs-lookup"><span data-stu-id="f296a-130">The following table describes the available options for configuring the ETW target.</span></span>  
  
|<span data-ttu-id="f296a-131">オプション</span><span class="sxs-lookup"><span data-stu-id="f296a-131">Option</span></span>|<span data-ttu-id="f296a-132">使用できる値</span><span class="sxs-lookup"><span data-stu-id="f296a-132">Allowed values</span></span>|<span data-ttu-id="f296a-133">説明</span><span class="sxs-lookup"><span data-stu-id="f296a-133">Description</span></span>|  
|------------|--------------------|-----------------|  
|<span data-ttu-id="f296a-134">default_xe_session_name</span><span class="sxs-lookup"><span data-stu-id="f296a-134">default_xe_session_name</span></span>|<span data-ttu-id="f296a-135">256 文字までの任意の文字列。</span><span class="sxs-lookup"><span data-stu-id="f296a-135">Any string up to 256 characters.</span></span> <span data-ttu-id="f296a-136">この値は省略可能です。</span><span class="sxs-lookup"><span data-stu-id="f296a-136">This value is optional.</span></span>|<span data-ttu-id="f296a-137">拡張イベント セッション名。</span><span class="sxs-lookup"><span data-stu-id="f296a-137">The Extended Events session name.</span></span> <span data-ttu-id="f296a-138">既定値は、XE_DEFAULT_ETW_SESSION です。</span><span class="sxs-lookup"><span data-stu-id="f296a-138">By default, this is XE_DEFAULT_ETW_SESSION.</span></span>|  
|<span data-ttu-id="f296a-139">default_etw_session_logfile_path</span><span class="sxs-lookup"><span data-stu-id="f296a-139">default_etw_session_logfile_path</span></span>|<span data-ttu-id="f296a-140">256 文字までの任意の文字列。</span><span class="sxs-lookup"><span data-stu-id="f296a-140">Any string up to 256 characters.</span></span> <span data-ttu-id="f296a-141">この値は省略可能です。</span><span class="sxs-lookup"><span data-stu-id="f296a-141">This value is optional.</span></span>|<span data-ttu-id="f296a-142">拡張イベント セッションのログ ファイルへのパス。</span><span class="sxs-lookup"><span data-stu-id="f296a-142">The path of the log file for the Extended Events session.</span></span> <span data-ttu-id="f296a-143">既定値は %TEMP%\ XEEtw.etl です。</span><span class="sxs-lookup"><span data-stu-id="f296a-143">By default, this is %TEMP%\ XEEtw.etl.</span></span>|  
|<span data-ttu-id="f296a-144">default_etw_session_logfile_size_mb</span><span class="sxs-lookup"><span data-stu-id="f296a-144">default_etw_session_logfile_size_mb</span></span>|<span data-ttu-id="f296a-145">任意の符号なし整数。</span><span class="sxs-lookup"><span data-stu-id="f296a-145">Any unsigned integer.</span></span> <span data-ttu-id="f296a-146">この値は省略可能です。</span><span class="sxs-lookup"><span data-stu-id="f296a-146">This value is optional.</span></span>|<span data-ttu-id="f296a-147">拡張イベント セッションのログ ファイル サイズ (MB)。</span><span class="sxs-lookup"><span data-stu-id="f296a-147">The log file size, in megabytes (MB), for the Extended Events session.</span></span> <span data-ttu-id="f296a-148">既定値は 20 MB です。</span><span class="sxs-lookup"><span data-stu-id="f296a-148">The default is 20 MB.</span></span>|  
|<span data-ttu-id="f296a-149">default_etw_session_buffer_size_kb</span><span class="sxs-lookup"><span data-stu-id="f296a-149">default_etw_session_buffer_size_kb</span></span>|<span data-ttu-id="f296a-150">任意の符号なし整数。</span><span class="sxs-lookup"><span data-stu-id="f296a-150">Any unsigned integer.</span></span> <span data-ttu-id="f296a-151">この値は省略可能です。</span><span class="sxs-lookup"><span data-stu-id="f296a-151">This value is optional.</span></span>|<span data-ttu-id="f296a-152">拡張イベント セッションのメモリ内バッファーのサイズ (KB)。</span><span class="sxs-lookup"><span data-stu-id="f296a-152">The in-memory buffer size, in kilobytes (KB), for the Extended Events session.</span></span> <span data-ttu-id="f296a-153">既定値は 128 KB です。</span><span class="sxs-lookup"><span data-stu-id="f296a-153">The default is 128 KB.</span></span>|  
|<span data-ttu-id="f296a-154">retries</span><span class="sxs-lookup"><span data-stu-id="f296a-154">retries</span></span>|<span data-ttu-id="f296a-155">任意の符号なし整数。</span><span class="sxs-lookup"><span data-stu-id="f296a-155">Any unsigned integer.</span></span>|<span data-ttu-id="f296a-156">ETW サブシステムへのイベントのパブリッシュを再試行する回数。この回数を超えるとイベントが破棄されます。</span><span class="sxs-lookup"><span data-stu-id="f296a-156">The number of times to retry publishing the event to the ETW subsystem before dropping the event.</span></span> <span data-ttu-id="f296a-157">既定値は 0 です。</span><span class="sxs-lookup"><span data-stu-id="f296a-157">The default is 0.</span></span>|  
  
 <span data-ttu-id="f296a-158">これらの設定は省略できます。</span><span class="sxs-lookup"><span data-stu-id="f296a-158">Configuring these settings is optional.</span></span> <span data-ttu-id="f296a-159">これらの設定については既定値が使用されます。</span><span class="sxs-lookup"><span data-stu-id="f296a-159">The ETW target uses default values for these settings.</span></span>  
  
 <span data-ttu-id="f296a-160">ETW ターゲットには、次のような役割があります。</span><span class="sxs-lookup"><span data-stu-id="f296a-160">The ETW target is responsible for:</span></span>  
  
-   <span data-ttu-id="f296a-161">既定の ETW セッションを作成する。</span><span class="sxs-lookup"><span data-stu-id="f296a-161">Creating the default ETW session.</span></span>  
  
-   <span data-ttu-id="f296a-162">すべての拡張イベント パッケージを ETW に登録する。</span><span class="sxs-lookup"><span data-stu-id="f296a-162">Registering all Extended Events packages with ETW.</span></span> <span data-ttu-id="f296a-163">これによって、ETW に登録されたイベントは破棄されなくなります。</span><span class="sxs-lookup"><span data-stu-id="f296a-163">This ensures that events are not dropped by ETW.</span></span>  
  
-   <span data-ttu-id="f296a-164">ETW に対するイベント フローを管理する。</span><span class="sxs-lookup"><span data-stu-id="f296a-164">Managing the flow of events to ETW.</span></span> <span data-ttu-id="f296a-165">ETW ターゲットは、拡張イベント データを持つ ETW イベントを作成して、それを適切な ETW セッションに送信します。</span><span class="sxs-lookup"><span data-stu-id="f296a-165">The ETW target creates an ETW event with Extended Events data and sends it to the appropriate ETW session.</span></span> <span data-ttu-id="f296a-166">イベントがバッファー サイズを超えた場合、またはデータを 1 つの ETW イベントに収めることができなかった場合、そのイベントは ETW によって複数のフラグメントに分割されます。</span><span class="sxs-lookup"><span data-stu-id="f296a-166">If the event is larger than the buffer size, or data cannot fit in one ETW event, ETW splits the event into fragments.</span></span>  
  
-   <span data-ttu-id="f296a-167">拡張イベント パッケージを常時有効に保つ。</span><span class="sxs-lookup"><span data-stu-id="f296a-167">Keeping Extended Events packages enabled at all times.</span></span>  
  
 <span data-ttu-id="f296a-168">次に ETW で使用される既定のファイル パスを示します。</span><span class="sxs-lookup"><span data-stu-id="f296a-168">The following default file locations are used by ETW:</span></span>  
  
-   <span data-ttu-id="f296a-169">ETW 出力ファイルは %TEMP%\XEEtw.etl に格納されます。</span><span class="sxs-lookup"><span data-stu-id="f296a-169">The ETW output file is in %TEMP%\XEEtw.etl.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="f296a-170">最初のセッションの開始後にファイル パスを変更することはできません。</span><span class="sxs-lookup"><span data-stu-id="f296a-170">The file path cannot be changed after the first session starts.</span></span>  
  
-   <span data-ttu-id="f296a-171">マネージド オブジェクト フォーマット (MOF) ファイルは *\<your install path>* \Microsoft SQL Server\Shared に格納されます。</span><span class="sxs-lookup"><span data-stu-id="f296a-171">Managed Object Format (MOF) files are in *\<your install path>* \Microsoft SQL Server\Shared.</span></span> <span data-ttu-id="f296a-172">詳細については、MSDN の「[マネージド オブジェクト フォーマット](https://go.microsoft.com/fwlink/?LinkId=92851)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f296a-172">For more information, see [Managed Object Format](https://go.microsoft.com/fwlink/?LinkId=92851) on MSDN.</span></span>  
  
## <a name="adding-the-target-to-a-session"></a><span data-ttu-id="f296a-173">セッションへのターゲットの追加</span><span class="sxs-lookup"><span data-stu-id="f296a-173">Adding the Target to a Session</span></span>  
 <span data-ttu-id="f296a-174">ETW ターゲットを拡張イベント セッションに追加するには、イベント セッションの作成時または変更時に次のステートメントを含める必要があります。</span><span class="sxs-lookup"><span data-stu-id="f296a-174">To add the ETW target to an Extended Events session, you must include the following statement when you create or alter an event session:</span></span>  
  
```  
ADD TARGET package0.etw_classic_sync_target  
```  
  
 <span data-ttu-id="f296a-175">データの表示方法を含む、ETW ターゲットの使用法を示す完全な例の詳細については、「 [拡張イベントを使用したシステムの使用状況の監視](monitor-system-activity-using-extended-events.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f296a-175">For more information about a full example that shows how to use the ETW target, including how to view the data, see [Monitor System Activity Using Extended Events](monitor-system-activity-using-extended-events.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="f296a-176">参照</span><span class="sxs-lookup"><span data-stu-id="f296a-176">See Also</span></span>  
 <span data-ttu-id="f296a-177">[SQL Server 拡張イベント ターゲット](../../database-engine/sql-server-extended-events-targets.md) </span><span class="sxs-lookup"><span data-stu-id="f296a-177">[SQL Server Extended Events Targets](../../database-engine/sql-server-extended-events-targets.md) </span></span>  
 <span data-ttu-id="f296a-178">[sys.dm_xe_session_targets &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-xe-session-targets-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="f296a-178">[sys.dm_xe_session_targets &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-xe-session-targets-transact-sql) </span></span>  
 <span data-ttu-id="f296a-179">[CREATE EVENT SESSION &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-event-session-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="f296a-179">[CREATE EVENT SESSION &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-event-session-transact-sql) </span></span>  
 [<span data-ttu-id="f296a-180">ALTER EVENT SESSION &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="f296a-180">ALTER EVENT SESSION &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/alter-event-session-transact-sql)  
  
  
