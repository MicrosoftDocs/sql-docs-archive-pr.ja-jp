---
title: テーブル値パラメーターと列値のバインドとデータ転送 |Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- table-valued parameters (ODBC), binding and data transfer
ms.assetid: 0a2ea462-d613-42b6-870f-c7fa086a6b42
author: rothja
ms.author: jroth
ms.openlocfilehash: 2e9e30e22a69b2d500990cc1481506b4edbda99b
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87643823"
---
# <a name="binding-and-data-transfer-of-table-valued-parameters-and-column-values"></a><span data-ttu-id="fee1b-102">テーブル値パラメーターおよび列の値のバインドとデータ転送</span><span class="sxs-lookup"><span data-stu-id="fee1b-102">Binding and Data Transfer of Table-Valued Parameters and Column Values</span></span>
  <span data-ttu-id="fee1b-103">テーブル値パラメーターは、他のパラメーターと同様、サーバーに渡す前にバインドする必要があります。</span><span class="sxs-lookup"><span data-stu-id="fee1b-103">Table-valued parameters, like other parameters, must be bound before they are passed to the server.</span></span> <span data-ttu-id="fee1b-104">アプリケーションは、他のパラメーターをバインドするのと同じ方法で、テーブル値パラメーターをバインドします。 SQLBindParameter を使用するか、SQLSetDescField または SQLSetDescRec の同等の呼び出しを使用します。</span><span class="sxs-lookup"><span data-stu-id="fee1b-104">The application binds table-valued parameters the same way it binds other parameters: by using SQLBindParameter or equivalent calls to SQLSetDescField or SQLSetDescRec.</span></span> <span data-ttu-id="fee1b-105">テーブル値パラメーター用のサーバーのデータ型は SQL_SS_TABLE です。</span><span class="sxs-lookup"><span data-stu-id="fee1b-105">The server data type for a table-valued parameter is SQL_SS_TABLE.</span></span> <span data-ttu-id="fee1b-106">C 型は SQL_C_DEFAULT または SQL_C_BINARY として指定できます。</span><span class="sxs-lookup"><span data-stu-id="fee1b-106">The C type can be specified either as SQL_C_DEFAULT or SQL_C_BINARY.</span></span>  
  
 <span data-ttu-id="fee1b-107">[!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] 以降では、入力のテーブル値パラメーターのみがサポートされています。</span><span class="sxs-lookup"><span data-stu-id="fee1b-107">In [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] or later, only input table-valued parameters are supported.</span></span> <span data-ttu-id="fee1b-108">そのため、SQL_DESC_PARAMETER_TYPE に SQL_PARAM_INPUT 以外の値を設定しようとすると、SQLSTATE = HY105 の SQL_ERROR が発生し、"パラメーターの型が無効です。" というメッセージが返されます。</span><span class="sxs-lookup"><span data-stu-id="fee1b-108">Therefore, any attempt to set SQL_DESC_PARAMETER_TYPE to a value other than SQL_PARAM_INPUT will return SQL_ERROR with SQLSTATE = HY105 and the message "Invalid parameter type".</span></span>  
  
 <span data-ttu-id="fee1b-109">属性 SQL_CA_SS_COL_HAS_DEFAULT_VALUE を使用すると、テーブル値パラメーターのすべての列に既定値を割り当てることができます。</span><span class="sxs-lookup"><span data-stu-id="fee1b-109">Entire table-valued parameter columns can be assigned default values by using the attribute SQL_CA_SS_COL_HAS_DEFAULT_VALUE.</span></span> <span data-ttu-id="fee1b-110">ただし、テーブル値パラメーターの個々の列値には、SQLBindParameter で*StrLen_or_IndPtr*の SQL_DEFAULT_PARAM を使用して既定値を割り当てることはできません。</span><span class="sxs-lookup"><span data-stu-id="fee1b-110">Individual table-valued parameter column values, however, cannot be assigned default values by using SQL_DEFAULT_PARAM in *StrLen_or_IndPtr* with SQLBindParameter.</span></span> <span data-ttu-id="fee1b-111">テーブル値パラメーター全体を既定値に設定するには、with SQLBindParameter を*StrLen_or_IndPtr*で SQL_DEFAULT_PARAM を使用します。</span><span class="sxs-lookup"><span data-stu-id="fee1b-111">Table-valued parameters as a whole cannot be set to a default value by using SQL_DEFAULT_PARAM in *StrLen_or_IndPtr* with SQLBindParameter.</span></span> <span data-ttu-id="fee1b-112">これらの規則に従わないと、SQLExecute または SQLExecDirect は SQL_ERROR を返します。</span><span class="sxs-lookup"><span data-stu-id="fee1b-112">If these rules are not followed, SQLExecute or SQLExecDirect will return SQL_ERROR.</span></span> <span data-ttu-id="fee1b-113">生成される診断レコードは SQLSTATE = 07S01 で、"パラメーターの既定のパラメーターが正しく使用されていません" というメッセージが表示され \<p> \<p> ます。ここで、は、クエリステートメント内の tvp の序数です。</span><span class="sxs-lookup"><span data-stu-id="fee1b-113">A diagnostic record will be generated with SQLSTATE=07S01 and the message "Invalid use of default parameter for parameter \<p>", where \<p> is the ordinal of the TVP in the query statement.</span></span>  
  
 <span data-ttu-id="fee1b-114">テーブル値パラメーターをバインドしたら、アプリケーションでは、次に、テーブル値パラメーターの各列をバインドする必要があります。</span><span class="sxs-lookup"><span data-stu-id="fee1b-114">After binding the table-valued parameter, the application must then bind each table-valued parameter column.</span></span> <span data-ttu-id="fee1b-115">これを行うには、アプリケーションはまず SQLSetStmtAttr を呼び出して、テーブル値パラメーターの序数に SQL_SOPT_SS_PARAM_FOCUS を設定します。</span><span class="sxs-lookup"><span data-stu-id="fee1b-115">To do this, the application first calls SQLSetStmtAttr to set SQL_SOPT_SS_PARAM_FOCUS to the ordinal of a table-valued parameter.</span></span> <span data-ttu-id="fee1b-116">次に、アプリケーションは、SQLBindParameter、SQLSetDescRec、および SQLSetDescField の各ルーチンを呼び出して、テーブル値パラメーターの列をバインドします。</span><span class="sxs-lookup"><span data-stu-id="fee1b-116">Then the application binds the columns of the table-valued parameter by calls to the following routines: SQLBindParameter, SQLSetDescRec, and SQLSetDescField.</span></span> <span data-ttu-id="fee1b-117">SQL_SOPT_SS_PARAM_FOCUS を0に設定すると、通常の最上位レベルのパラメーターを操作するときに、SQLBindParameter、SQLSetDescRec、および SQLSetDescField の通常の効果が復元されます。</span><span class="sxs-lookup"><span data-stu-id="fee1b-117">Setting SQL_SOPT_SS_PARAM_FOCUS to 0 restores the usual effect of SQLBindParameter, SQLSetDescRec, and SQLSetDescField in operating on regular top-level parameters.</span></span>  
  
 <span data-ttu-id="fee1b-118">テーブル値パラメーター自体の実際のデータは送受信されませんが、テーブル値パラメーターを構成する各列のデータは送受信されます。</span><span class="sxs-lookup"><span data-stu-id="fee1b-118">No actual data is sent or received for the table-valued parameter itself, but data is sent and received for each of its constituent columns.</span></span> <span data-ttu-id="fee1b-119">テーブル値パラメーターは擬似列であるため、SQLBindParameter のパラメーターは、次のように、他のデータ型とは異なる属性を参照するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="fee1b-119">Because the table-valued parameter is a pseudo column, the parameters for SQLBindParameter are used to refer to different attributes than other data types, as follows:</span></span>  
  
|<span data-ttu-id="fee1b-120">パラメーター</span><span class="sxs-lookup"><span data-stu-id="fee1b-120">Parameter</span></span>|<span data-ttu-id="fee1b-121">テーブル値以外のパラメーターの型に関連する属性 (列を含む)</span><span class="sxs-lookup"><span data-stu-id="fee1b-121">Related attribute for non-table-valued parameter types, including columns</span></span>|<span data-ttu-id="fee1b-122">テーブル値パラメーターに関連する属性</span><span class="sxs-lookup"><span data-stu-id="fee1b-122">Related attribute for table-valued parameters</span></span>|  
|---------------|--------------------------------------------------------------------------------|----------------------------------------------------|  
|<span data-ttu-id="fee1b-123">*InputOutputType*</span><span class="sxs-lookup"><span data-stu-id="fee1b-123">*InputOutputType*</span></span>|<span data-ttu-id="fee1b-124">IPD の SQL_DESC_PARAMETER_TYPE。</span><span class="sxs-lookup"><span data-stu-id="fee1b-124">SQL_DESC_PARAMETER_TYPE in IPD.</span></span><br /><br /> <span data-ttu-id="fee1b-125">テーブル値パラメーターの列の場合、これはテーブル値パラメーター自体の設定と同じである必要があります。</span><span class="sxs-lookup"><span data-stu-id="fee1b-125">For table-valued parameter columns, this must be the same as the setting for the table-valued parameter itself.</span></span>|<span data-ttu-id="fee1b-126">IPD の SQL_DESC_PARAMETER_TYPE。</span><span class="sxs-lookup"><span data-stu-id="fee1b-126">SQL_DESC_PARAMETER_TYPE in IPD.</span></span><br /><br /> <span data-ttu-id="fee1b-127">これは SQL_PARAM_INPUT である必要があります。</span><span class="sxs-lookup"><span data-stu-id="fee1b-127">This must be SQL_PARAM_INPUT.</span></span>|  
|<span data-ttu-id="fee1b-128">*ValueType*</span><span class="sxs-lookup"><span data-stu-id="fee1b-128">*ValueType*</span></span>|<span data-ttu-id="fee1b-129">APD の SQL_DESC_TYPE、SQL_DESC_CONCISE_TYPE。</span><span class="sxs-lookup"><span data-stu-id="fee1b-129">SQL_DESC_TYPE, SQL_DESC_CONCISE_TYPE in APD.</span></span>|<span data-ttu-id="fee1b-130">APD の SQL_DESC_TYPE、SQL_DESC_CONCISE_TYPE。</span><span class="sxs-lookup"><span data-stu-id="fee1b-130">SQL_DESC_TYPE, SQL_DESC_CONCISE_TYPE in APD.</span></span><br /><br /> <span data-ttu-id="fee1b-131">これは SQL_C_DEFAULT または SQL_C_BINARY である必要があります。</span><span class="sxs-lookup"><span data-stu-id="fee1b-131">This must be SQL_C_DEFAULT or SQL_C_BINARY.</span></span>|  
|<span data-ttu-id="fee1b-132">*ParameterType*</span><span class="sxs-lookup"><span data-stu-id="fee1b-132">*ParameterType*</span></span>|<span data-ttu-id="fee1b-133">IPD の SQL_DESC_TYPE、SQL_DESC_CONCISE_TYPE。</span><span class="sxs-lookup"><span data-stu-id="fee1b-133">SQL_DESC_TYPE, SQL_DESC_CONCISE_TYPE in IPD.</span></span>|<span data-ttu-id="fee1b-134">IPD の SQL_DESC_TYPE、SQL_DESC_CONCISE_TYPE。</span><span class="sxs-lookup"><span data-stu-id="fee1b-134">SQL_DESC_TYPE, SQL_DESC_CONCISE_TYPE in IPD.</span></span><br /><br /> <span data-ttu-id="fee1b-135">これは SQL_SS_TABLE である必要があります。</span><span class="sxs-lookup"><span data-stu-id="fee1b-135">This must be SQL_SS_TABLE.</span></span>|  
|<span data-ttu-id="fee1b-136">*ColumnSize*</span><span class="sxs-lookup"><span data-stu-id="fee1b-136">*ColumnSize*</span></span>|<span data-ttu-id="fee1b-137">IPD の SQL_DESC_LENGTH または SQL_DESC_PRECISION。</span><span class="sxs-lookup"><span data-stu-id="fee1b-137">SQL_DESC_LENGTH or SQL_DESC_PRECISION in IPD.</span></span><br /><br /> <span data-ttu-id="fee1b-138">これは、 *ParameterType*の値によって異なります。</span><span class="sxs-lookup"><span data-stu-id="fee1b-138">This depends on the value of *ParameterType*.</span></span>|<span data-ttu-id="fee1b-139">SQL_DESC_ARRAY_SIZE</span><span class="sxs-lookup"><span data-stu-id="fee1b-139">SQL_DESC_ARRAY_SIZE</span></span><br /><br /> <span data-ttu-id="fee1b-140">テーブル値パラメーターにフォーカスが設定されている場合は SQL_ATTR_PARAM_SET_SIZE を使用して設定することもできます。</span><span class="sxs-lookup"><span data-stu-id="fee1b-140">Can also be set using SQL_ATTR_PARAM_SET_SIZE when the parameter focus is set to the table-valued parameter.</span></span><br /><br /> <span data-ttu-id="fee1b-141">テーブル値パラメーターの場合、これはテーブル値パラメーターの列バッファー内の行数です。</span><span class="sxs-lookup"><span data-stu-id="fee1b-141">For a table-valued parameter, this is the number of rows in the table-valued parameter column buffers.</span></span>|  
|<span data-ttu-id="fee1b-142">*DecimalDigits*</span><span class="sxs-lookup"><span data-stu-id="fee1b-142">*DecimalDigits*</span></span>|<span data-ttu-id="fee1b-143">IPD の SQL_DESC_PRECISION または SQL_DESC_SCALE。</span><span class="sxs-lookup"><span data-stu-id="fee1b-143">SQL_DESC_PRECISION or SQL_DESC_SCALE in IPD.</span></span>|<span data-ttu-id="fee1b-144">未使用。</span><span class="sxs-lookup"><span data-stu-id="fee1b-144">Unused.</span></span> <span data-ttu-id="fee1b-145">これは 0 である必要があります。</span><span class="sxs-lookup"><span data-stu-id="fee1b-145">This must be 0.</span></span><br /><br /> <span data-ttu-id="fee1b-146">このパラメーターが0以外の場合、SQLBindParameter は SQL_ERROR を返し、"有効桁数または小数点以下桁数が無効です" というメッセージで SQLSTATE = HY104 の診断レコードが生成されます。</span><span class="sxs-lookup"><span data-stu-id="fee1b-146">If this parameter is not 0, SQLBindParameter will return SQL_ERROR, and a diagnostic record will be generated with SQLSTATE= HY104 and the message "Invalid precision or scale".</span></span>|  
|<span data-ttu-id="fee1b-147">*ParameterValuePtr*</span><span class="sxs-lookup"><span data-stu-id="fee1b-147">*ParameterValuePtr*</span></span>|<span data-ttu-id="fee1b-148">APD の SQL_DESC_DATA_PTR。</span><span class="sxs-lookup"><span data-stu-id="fee1b-148">SQL_DESC_DATA_PTR in APD.</span></span>|<span data-ttu-id="fee1b-149">SQL_CA_SS_TYPE_NAME。</span><span class="sxs-lookup"><span data-stu-id="fee1b-149">SQL_CA_SS_TYPE_NAME.</span></span><br /><br /> <span data-ttu-id="fee1b-150">これは、ストアド プロシージャの呼び出しでは省略可能で、不要の場合は NULL を指定できます。</span><span class="sxs-lookup"><span data-stu-id="fee1b-150">This is optional for stored procedure calls, and NULL can be specified if it is not required.</span></span> <span data-ttu-id="fee1b-151">プロシージャの呼び出し以外の SQL ステートメントでは、指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="fee1b-151">It must be specified for SQL statements that are not procedure calls.</span></span><br /><br /> <span data-ttu-id="fee1b-152">このパラメーターは、可変の行バインドの使用時にアプリケーションがテーブル値パラメーターを特定するための一意の値としても機能します。</span><span class="sxs-lookup"><span data-stu-id="fee1b-152">This parameter also serves as a unique value that the application can use to identify this table-valued parameter when variable row binding is used.</span></span> <span data-ttu-id="fee1b-153">詳細については、「テーブル値パラメーターの可変の行バインド」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="fee1b-153">For more information, see the "Variable Table-Valued Parameter Row Binding" section, later in this topic.</span></span><br /><br /> <span data-ttu-id="fee1b-154">SQLBindParameter の呼び出しでテーブル値パラメーターの型名を指定する場合は、ANSI アプリケーションとしてビルドされたアプリケーションであっても、Unicode 値として指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="fee1b-154">When a table-valued parameter type name is specified on a call to SQLBindParameter, it must be specified as a Unicode value, even in applications that are built as ANSI applications.</span></span> <span data-ttu-id="fee1b-155">パラメーター *StrLen_or_IndPtr*に使用される値は、SQL_NTS か、名前の文字列の長さに SIZEOF (WCHAR) を掛けたものである必要があります。</span><span class="sxs-lookup"><span data-stu-id="fee1b-155">The value used for the parameter *StrLen_or_IndPtr* should be either SQL_NTS or the string length of the name multiplied by sizeof(WCHAR).</span></span>|  
|<span data-ttu-id="fee1b-156">*BufferLength*</span><span class="sxs-lookup"><span data-stu-id="fee1b-156">*BufferLength*</span></span>|<span data-ttu-id="fee1b-157">APD の SQL_DESC_OCTET_LENGTH。</span><span class="sxs-lookup"><span data-stu-id="fee1b-157">SQL_DESC_OCTET_LENGTH in APD.</span></span>|<span data-ttu-id="fee1b-158">テーブル値パラメーターの型名の長さ (バイト単位)。</span><span class="sxs-lookup"><span data-stu-id="fee1b-158">The length of the table-valued parameter type name in bytes.</span></span><br /><br /> <span data-ttu-id="fee1b-159">型名が NULL 終端の場合は SQL_NTS に、テーブル値パラメーターの型名が不要の場合は 0 になります。</span><span class="sxs-lookup"><span data-stu-id="fee1b-159">This can be SQL_NTS if the type name is null terminated, or 0 if the table-valued parameter type name is not required.</span></span>|  
|<span data-ttu-id="fee1b-160">*StrLen_or_IndPtr*</span><span class="sxs-lookup"><span data-stu-id="fee1b-160">*StrLen_or_IndPtr*</span></span>|<span data-ttu-id="fee1b-161">APD の SQL_DESC_OCTET_LENGTH_PTR。</span><span class="sxs-lookup"><span data-stu-id="fee1b-161">SQL_DESC_OCTET_LENGTH_PTR in APD.</span></span>|<span data-ttu-id="fee1b-162">APD の SQL_DESC_OCTET_LENGTH_PTR。</span><span class="sxs-lookup"><span data-stu-id="fee1b-162">SQL_DESC_OCTET_LENGTH_PTR in APD.</span></span><br /><br /> <span data-ttu-id="fee1b-163">テーブル値パラメーターの場合、これはデータ長ではなく行数です。</span><span class="sxs-lookup"><span data-stu-id="fee1b-163">For table-valued parameters, this is a row count rather than a data length.</span></span>|  
  
 <span data-ttu-id="fee1b-164">テーブル値パラメーターでは、固定の行バインドと可変の行バインドという 2 つのデータ転送モードがサポートされています。</span><span class="sxs-lookup"><span data-stu-id="fee1b-164">Two data transfer modes are supported for table-valued parameters: fixed row binding and variable row binding.</span></span>  
  
## <a name="fixed-table-valued-parameter-row-binding"></a><span data-ttu-id="fee1b-165">テーブル値パラメーターの固定の行バインド</span><span class="sxs-lookup"><span data-stu-id="fee1b-165">Fixed Table-Valued Parameter Row Binding</span></span>  
 <span data-ttu-id="fee1b-166">固定の行バインドの場合、アプリケーションでは、使用可能なすべての入力列の値に対して十分な大きさのバッファー (バッファー配列) を割り当てます。</span><span class="sxs-lookup"><span data-stu-id="fee1b-166">For fixed row binding, an application allocates buffers (or buffer arrays) large enough for all possible input column values.</span></span> <span data-ttu-id="fee1b-167">このアプリケーションによって次の処理が行われます。</span><span class="sxs-lookup"><span data-stu-id="fee1b-167">The application does the following:</span></span>  
  
1.  <span data-ttu-id="fee1b-168">SQLBindParameter、SQLSetDescRec、または SQLSetDescField の呼び出しを使用して、すべてのパラメーターをバインドします。</span><span class="sxs-lookup"><span data-stu-id="fee1b-168">Binds all parameters by using SQLBindParameter, SQLSetDescRec, or SQLSetDescField calls.</span></span>  
  
    1.  <span data-ttu-id="fee1b-169">SQL_DESC_ARRAY_SIZE に各テーブル値パラメーターの転送可能な最大行数を設定します。</span><span class="sxs-lookup"><span data-stu-id="fee1b-169">Sets SQL_DESC_ARRAY_SIZE to the maximum number of rows that can be transferred for each table-valued parameter.</span></span> <span data-ttu-id="fee1b-170">これは、SQLBindParameter の呼び出しで行うことができます。</span><span class="sxs-lookup"><span data-stu-id="fee1b-170">This can be done in the SQLBindParameter call.</span></span>  
  
2.  <span data-ttu-id="fee1b-171">SQLSetStmtAttr を呼び出して、各テーブル値パラメーターの序数に SQL_SOPT_SS_PARAM_FOCUS を設定します。</span><span class="sxs-lookup"><span data-stu-id="fee1b-171">Calls SQLSetStmtAttr to set SQL_SOPT_SS_PARAM_FOCUS to the ordinal of each table-valued parameter.</span></span>  
  
    1.  <span data-ttu-id="fee1b-172">テーブル値パラメーターごとに、SQLBindParameter、SQLSetDescRec、または SQLSetDescField の呼び出しを使用して、テーブル値パラメーターの列をバインドします。</span><span class="sxs-lookup"><span data-stu-id="fee1b-172">For each table-valued parameter, binds table-valued parameter columns by using SQLBindParameter, SQLSetDescRec, or SQLSetDescField calls.</span></span>  
  
    2.  <span data-ttu-id="fee1b-173">既定値を持つテーブル値パラメーターの列ごとに、SQLSetDescField を呼び出して SQL_CA_SS_COL_HAS_DEFAULT_VALUE を1に設定します。</span><span class="sxs-lookup"><span data-stu-id="fee1b-173">For each table-valued parameter column that is to have default values, calls SQLSetDescField to set SQL_CA_SS_COL_HAS_DEFAULT_VALUE to 1.</span></span>  
  
3.  <span data-ttu-id="fee1b-174">SQLSetStmtAttr を呼び出して、SQL_SOPT_SS_PARAM_FOCUS を0に設定します。</span><span class="sxs-lookup"><span data-stu-id="fee1b-174">Calls SQLSetStmtAttr to set SQL_SOPT_SS_PARAM_FOCUS to 0.</span></span> <span data-ttu-id="fee1b-175">これは、SQLExecute または SQLExecDirect が呼び出される前に実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="fee1b-175">This must be done before SQLExecute or SQLExecDirect is called.</span></span> <span data-ttu-id="fee1b-176">そうしないと、SQL_ERROR が返され、"属性値 SQL_SOPT_SS_PARAM_FOCUS が無効です (実行時に 0 である必要があります)" というメッセージを含む、SQLSTATE=HY024 の診断レコードが生成されます。</span><span class="sxs-lookup"><span data-stu-id="fee1b-176">Otherwise, SQL_ERROR is be returned and a diagnostic record is generated with SQLSTATE=HY024 and the message "Invalid attribute value, SQL_SOPT_SS_PARAM_FOCUS (must be zero at execution time)".</span></span>  
  
4.  <span data-ttu-id="fee1b-177">行を含まないテーブル値パラメーターの SQL_DEFAULT_PARAM に*StrLen_or_IndPtr*または SQL_DESC_OCTET_LENGTH_PTR を設定します。または、テーブル値パラメーターに行がある場合は、sqlexecute または SQLExecDirect の次回の呼び出し時に転送される行の数を設定します。</span><span class="sxs-lookup"><span data-stu-id="fee1b-177">Sets *StrLen_or_IndPtr* or SQL_DESC_OCTET_LENGTH_PTR to SQL_DEFAULT_PARAM for a table-valued parameter with no rows, or the number of rows to be transferred on the next call of SQLExecute or SQLExecDirect if the table-valued parameter has rows.</span></span> <span data-ttu-id="fee1b-178">*StrLen_or_IndPtr*または SQL_DESC_OCTET_LENGTH_PTR は、テーブル値パラメーターが null 値を許容しないため、テーブル値パラメーターに対して SQL_NULL_DATA に設定できません (ただし、テーブル値パラメーターには null 値が許容される可能性があります)。</span><span class="sxs-lookup"><span data-stu-id="fee1b-178">*StrLen_or_IndPtr* or SQL_DESC_OCTET_LENGTH_PTR cannot be set to SQL_NULL_DATA for a table-valued parameter as table-valued parameters are not nullable (though table-valued parameter constituent columns may be nullable).</span></span> <span data-ttu-id="fee1b-179">この値が無効な値に設定されている場合、SQLExecute または SQLExecDirect は SQL_ERROR を返し、"パラメーターの文字列またはバッファーの長さが無効です" というメッセージ (p はパラメーター番号) を使用して、診断レコードが生成され \<p> ます。</span><span class="sxs-lookup"><span data-stu-id="fee1b-179">If this is set to an invalid value, SQLExecute or SQLExecDirect returns SQL_ERROR, and a diagnostic record is generated with SQLSTATE=HY090 and the message "Invalid string or buffer length for parameter \<p>", where p is the parameter number.</span></span>  
  
5.  <span data-ttu-id="fee1b-180">SQLExecute または SQLExecDirect を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="fee1b-180">Calls SQLExecute or SQLExecDirect.</span></span>  
  
 <span data-ttu-id="fee1b-181">入力テーブル値パラメーターの列の値は、 *StrLen_or_IndPtr*が SQL_LEN_DATA_AT_EXEC (*長さ*) に設定されているか、列の SQL_DATA_AT_EXEC に設定されている場合に、部分的に渡すことができます。</span><span class="sxs-lookup"><span data-stu-id="fee1b-181">Input table-valued parameter column values can be passed in pieces if *StrLen_or_IndPtr* is set to SQL_LEN_DATA_AT_EXEC(*length*) or SQL_DATA_AT_EXEC for the column.</span></span> <span data-ttu-id="fee1b-182">これは、パラメーターの配列を使用するときに値を個別に渡す場合と似ています。</span><span class="sxs-lookup"><span data-stu-id="fee1b-182">This is similar to passing values in pieces when arrays of parameters are used.</span></span> <span data-ttu-id="fee1b-183">実行時データのすべてのパラメーターと同様に、SQLParamData は、ドライバーがデータを要求している配列の行を示しません。アプリケーションでは、このことに対処する必要があります。</span><span class="sxs-lookup"><span data-stu-id="fee1b-183">As with all data-at-execution parameters, SQLParamData does not indicate which row of the array the driver is requesting data for; the application must take care of this.</span></span> <span data-ttu-id="fee1b-184">アプリケーションでは、ドライバーが値を要求する順序についてどのような想定も行うことができません。</span><span class="sxs-lookup"><span data-stu-id="fee1b-184">The application cannot make any assumptions about the order in which the driver will request values.</span></span>  
  
## <a name="variable-table-valued-parameter-row-binding"></a><span data-ttu-id="fee1b-185">テーブル値パラメーターの可変の行バインド</span><span class="sxs-lookup"><span data-stu-id="fee1b-185">Variable Table-Valued Parameter Row Binding</span></span>  
 <span data-ttu-id="fee1b-186">可変の行バインドの場合、行は実行時にバッチで転送され、アプリケーションは要求時に行をドライバーに渡します。</span><span class="sxs-lookup"><span data-stu-id="fee1b-186">For variable row binding, rows are transferred in batches at execution time and the application passes rows to the driver on demand.</span></span> <span data-ttu-id="fee1b-187">これは、各パラメーター値の実行時データに似ています。</span><span class="sxs-lookup"><span data-stu-id="fee1b-187">This is similar to data-at-execution for individual parameter values.</span></span> <span data-ttu-id="fee1b-188">可変の行バインドでは、アプリケーションによって次の処理が行われます。</span><span class="sxs-lookup"><span data-stu-id="fee1b-188">For variable row binding, the application does the following:</span></span>  
  
1.  <span data-ttu-id="fee1b-189">前述の「テーブル値パラメーターの固定の行バインド」の手順 1. ～ 3. の説明に従って、パラメーターと、テーブル値パラメーターの列をバインドします。</span><span class="sxs-lookup"><span data-stu-id="fee1b-189">Binds parameters and table-valued parameter columns as described in steps 1 to 3 of the previous section, "Fixed Table-Valued Parameter Row Binding".</span></span>  
  
2.  <span data-ttu-id="fee1b-190">実行時に渡されるすべてのテーブル値パラメーターの*StrLen_or_IndPtr*または SQL_DESC_OCTET_LENGTH_PTR を SQL_DATA_AT_EXEC に設定します。</span><span class="sxs-lookup"><span data-stu-id="fee1b-190">Sets *StrLen_or_IndPtr* or SQL_DESC_OCTET_LENGTH_PTR for any table-valued parameters that are to be passed at execution time to SQL_DATA_AT_EXEC.</span></span> <span data-ttu-id="fee1b-191">どちらも設定しない場合、前のセクションで説明したように、パラメーターが処理されます。</span><span class="sxs-lookup"><span data-stu-id="fee1b-191">If neither is set, the parameter will be processed as described in the previous section.</span></span>  
  
3.  <span data-ttu-id="fee1b-192">SQLExecute または SQLExecDirect を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="fee1b-192">Calls SQLExecute or SQLExecDirect.</span></span> <span data-ttu-id="fee1b-193">実行時データ パラメーターとして処理される SQL_PARAM_INPUT パラメーターまたは SQL_PARAM_INPUT_OUTPUT パラメーターが存在する場合は、SQL_NEED_DATA が返されます。</span><span class="sxs-lookup"><span data-stu-id="fee1b-193">This will return SQL_NEED_DATA if there are any SQL_PARAM_INPUT or SQL_PARAM_INPUT_OUTPUT parameters to be handled as data-at-execution parameters.</span></span> <span data-ttu-id="fee1b-194">この場合、アプリケーションによって次の処理が行われます。</span><span class="sxs-lookup"><span data-stu-id="fee1b-194">In this case, the application does the following:</span></span>  
  
    -   <span data-ttu-id="fee1b-195">SQLParamData を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="fee1b-195">Calls SQLParamData.</span></span> <span data-ttu-id="fee1b-196">これにより、実行時データパラメーターの*Parametervalueptr*値と SQL_NEED_DATA のリターンコードが返されます。</span><span class="sxs-lookup"><span data-stu-id="fee1b-196">This returns the *ParameterValuePtr* value for a data-at-execution parameter and a return code of SQL_NEED_DATA.</span></span> <span data-ttu-id="fee1b-197">すべてのパラメーターデータがドライバーに渡されると、SQLParamData は SQL_SUCCESS、SQL_SUCCESS_WITH_INFO、または SQL_ERROR を返します。</span><span class="sxs-lookup"><span data-stu-id="fee1b-197">When all parameter data has been passed to the driver, SQLParamData returns SQL_SUCCESS, SQL_SUCCESS_WITH_INFO, or SQL_ERROR.</span></span> <span data-ttu-id="fee1b-198">実行時データパラメーターの場合、 *Parametervalueptr*は、記述子フィールド SQL_DESC_DATA_PTR と同じですが、値が必要なパラメーターを一意に識別するためのトークンと見なすことができます。</span><span class="sxs-lookup"><span data-stu-id="fee1b-198">For data-at-execution parameters, *ParameterValuePtr*, which is the same as the descriptor field SQL_DESC_DATA_PTR, can be regarded as a token to uniquely identify a parameter for which a value is required.</span></span> <span data-ttu-id="fee1b-199">この "トークン" は、バインド時にアプリケーションからドライバーに渡され、実行時にアプリケーションに返されます。</span><span class="sxs-lookup"><span data-stu-id="fee1b-199">This "token" is passed from the application to the driver at bind time, then passed back to the application at execution time.</span></span>  
  
4.  <span data-ttu-id="fee1b-200">Null テーブル値パラメーターのテーブル値パラメーターの行データを送信するには、テーブル値パラメーターに行がない場合、アプリケーションは*StrLen_or_Ind*を SQL_DEFAULT_PARAM に設定して SQLPutData を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="fee1b-200">To send table-valued parameter row data for null table-valued parameters, if the table-valued parameter has no rows, an application calls SQLPutData with *StrLen_or_Ind* set to SQL_DEFAULT_PARAM.</span></span>  
  
     <span data-ttu-id="fee1b-201">NULL 以外の TVP については、アプリケーションによって次の処理が行われます。</span><span class="sxs-lookup"><span data-stu-id="fee1b-201">For non-NULL TVPs, an application:</span></span>  
  
    -   <span data-ttu-id="fee1b-202">すべてのテーブル値パラメーター列の*Str_Len_or_Ind*を適切な値に設定し、実行時データパラメーターではないテーブル値パラメーター列のデータバッファーを設定します。</span><span class="sxs-lookup"><span data-stu-id="fee1b-202">Sets *Str_Len_or_Ind* for all the table-valued parameter columns to appropriate values, and populates data buffers for table-valued parameter columns that are not to be data-at-execution parameters.</span></span> <span data-ttu-id="fee1b-203">通常のパラメーターを個別にドライバーに渡すことができるように、テーブル値パラメーターの列の実行時データを使用することができます。</span><span class="sxs-lookup"><span data-stu-id="fee1b-203">You can use data-at-execution for table-valued parameter columns in a similar way to that in which ordinary parameters can be passed to the driver in pieces.</span></span>  
  
    -   <span data-ttu-id="fee1b-204">は、サーバーに送信される行の数に設定された*Str_Len_or_Ind*を使用して SQLPutData を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="fee1b-204">Calls SQLPutData with *Str_Len_or_Ind* set to the number of rows to be sent to the server.</span></span> <span data-ttu-id="fee1b-205">0 から SQL_DESC_ARRAY_SIZE の範囲を超える値と SQL_DEFAULT_PARAM 以外の値はエラーになります。"文字列長またはバッファー長が正しくありません。" というメッセージを含む SQLSTATE HY090 が返されます。</span><span class="sxs-lookup"><span data-stu-id="fee1b-205">Any value outside the range 0 to SQL_DESC_ARRAY_SIZE or SQL_DEFAULT_PARAM is an error, and will return SQLSTATE HY090, with the message "Invalid string or buffer length".</span></span> <span data-ttu-id="fee1b-206">0 は、すべての行が送信済みで、テーブル値パラメーターのデータが存在しないことを示します (この箇条書きの 2 番目の項目参照)。</span><span class="sxs-lookup"><span data-stu-id="fee1b-206">0 indicates that all rows have been sent and there is no more data for a table-valued parameter (as noted in the second bullet item in this list).</span></span> <span data-ttu-id="fee1b-207">SQL_DEFAULT_PARAM を使用できるのは、ドライバーがテーブル値パラメーターのデータを最初に要求するときだけです (この箇条書きの 1 番目の項目参照)。</span><span class="sxs-lookup"><span data-stu-id="fee1b-207">SQL_DEFAULT_PARAM can only be used the first time the driver requests data for a table-valued parameter (as described in the first bullet item in this list).</span></span>  
  
5.  <span data-ttu-id="fee1b-208">すべての行が送信されると、は*Str_Len_or_Ind*値が0のテーブル値パラメーターの SQLPutData を呼び出した後、上記の手順3a に進みます。</span><span class="sxs-lookup"><span data-stu-id="fee1b-208">When all rows have been sent, calls SQLPutData for the table-valued parameter with a *Str_Len_or_Ind* value of 0, then proceeds to step 3a above.</span></span>  
  
6.  <span data-ttu-id="fee1b-209">SQLParamData を再度呼び出します。</span><span class="sxs-lookup"><span data-stu-id="fee1b-209">Calls SQLParamData again.</span></span> <span data-ttu-id="fee1b-210">テーブル値パラメーターの列の間に実行時データパラメーターがある場合は、SQLParamData によって返される値*Valueptrptr*によって識別されます。</span><span class="sxs-lookup"><span data-stu-id="fee1b-210">If there are any data-at-execution parameters among the table-valued parameter columns, these will be identified by the value *ValuePtrPtr* returned by SQLParamData.</span></span> <span data-ttu-id="fee1b-211">すべての列の値を使用できる場合、SQLParamData はテーブル値パラメーターの*Parametervalueptr*値を再び返し、アプリケーションが再び開始されます。</span><span class="sxs-lookup"><span data-stu-id="fee1b-211">When all column values are available, SQLParamData will again return the *ParameterValuePtr* value for the table-valued parameter, and the application begins again.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="fee1b-212">参照</span><span class="sxs-lookup"><span data-stu-id="fee1b-212">See Also</span></span>  
 [<span data-ttu-id="fee1b-213">テーブル値パラメーター &#40;ODBC&#41;</span><span class="sxs-lookup"><span data-stu-id="fee1b-213">Table-Valued Parameters &#40;ODBC&#41;</span></span>](table-valued-parameters-odbc.md)  
  
  
