---
title: フルテキスト クエリのパフォーマンスの向上 | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: search
ms.topic: conceptual
ms.assetid: 0658dc74-25eb-4486-bbd6-e85c1f92c272
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: a1437f710725df5c87d31f6a80939a5d7869b412
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87717739"
---
# <a name="improve-the-performance-of-full-text-queries"></a><span data-ttu-id="f6a69-102">フルテキスト クエリのパフォーマンスの向上</span><span class="sxs-lookup"><span data-stu-id="f6a69-102">Improve the Performance of Full-Text Queries</span></span>
  <span data-ttu-id="f6a69-103">フルテキスト クエリのパフォーマンスを向上させるための推奨事項を次に示します。</span><span class="sxs-lookup"><span data-stu-id="f6a69-103">The following is a list of recommendations that will help to improve the performance of full-text queries.</span></span>  
  
 <span data-ttu-id="f6a69-104">フルテキスト クエリのパフォーマンスは、メモリ、ディスク速度、CPU 速度、コンピューター アーキテクチャなど、ハードウェア リソースの影響も受けます。</span><span class="sxs-lookup"><span data-stu-id="f6a69-104">The performance of full-text queries is also influenced by hardware resources, such as memory, disk speed, CPU speed, and machine architecture.</span></span>  
  
-   <span data-ttu-id="f6a69-105">[ALTER INDEX REORGANIZE](/sql/t-sql/statements/alter-index-transact-sql)を使用して、ベース テーブルのインデックスの断片化を解消します。</span><span class="sxs-lookup"><span data-stu-id="f6a69-105">Defragment the index of the base table by using [ALTER INDEX REORGANIZE](/sql/t-sql/statements/alter-index-transact-sql).</span></span>  
  
-   <span data-ttu-id="f6a69-106">[ALTER FULLTEXT CATALOG REORGANIZE](/sql/t-sql/statements/alter-fulltext-catalog-transact-sql)を使用して、フルテキスト カタログを再構成します。</span><span class="sxs-lookup"><span data-stu-id="f6a69-106">Reorganize the full-text catalog by using [ALTER FULLTEXT CATALOG REORGANIZE](/sql/t-sql/statements/alter-fulltext-catalog-transact-sql).</span></span> <span data-ttu-id="f6a69-107">このステートメントを実行するとそのカタログのフルテキスト インデックスがマスター マージされるため、この作業はパフォーマンス テストの前に行うようにしてください。</span><span class="sxs-lookup"><span data-stu-id="f6a69-107">Make sure that you do this before performance testing because running this statement causes a master merge of the full-text indexes in that catalog.</span></span>  
  
-   <span data-ttu-id="f6a69-108">フルテキスト キー列として、サイズの小さい列を選択します。</span><span class="sxs-lookup"><span data-stu-id="f6a69-108">Restrict your choice of full-text key columns to a small column.</span></span> <span data-ttu-id="f6a69-109">900 バイトの列がサポートされていますが、フルテキスト インデックスでは比較的小さいキー列を使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="f6a69-109">Although a 900-byte column is supported, we recommend using a smaller key column in a full-text index.</span></span> <span data-ttu-id="f6a69-110">`int` および `bigint` を使用すると、最適なパフォーマンスが得られます。</span><span class="sxs-lookup"><span data-stu-id="f6a69-110">`int` and `bigint` provide the best performance.</span></span>  
  
-   <span data-ttu-id="f6a69-111">整数型のフルテキスト キーを使用すると、 **docid** マッピング テーブルとの結合が回避されます。</span><span class="sxs-lookup"><span data-stu-id="f6a69-111">Using an integer full-text key avoids a join with the **docid** mapping table.</span></span> <span data-ttu-id="f6a69-112">したがって、整数型のフルテキスト キーにより、クエリのパフォーマンスが大幅に向上し、クロールのパフォーマンスも向上します。</span><span class="sxs-lookup"><span data-stu-id="f6a69-112">Therefore, an integer full-text key improves query performance by an order of magnitude and improves crawl performance.</span></span> <span data-ttu-id="f6a69-113">フルテキスト キーがクラスター化インデックス キーでもある場合、パフォーマンスがさらに向上する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="f6a69-113">Additional performance benefits might result if the full-text key is also the clustered index key.</span></span>  
  
-   <span data-ttu-id="f6a69-114">複数の [CONTAINS](/sql/t-sql/queries/contains-transact-sql) 述語を 1 つの CONTAINS 述語に統合します。</span><span class="sxs-lookup"><span data-stu-id="f6a69-114">Combine multiple [CONTAINS](/sql/t-sql/queries/contains-transact-sql) predicates into one CONTAINS predicate.</span></span> <span data-ttu-id="f6a69-115">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] では、CONTAINS クエリに列の一覧を指定できます。</span><span class="sxs-lookup"><span data-stu-id="f6a69-115">In [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] you can specify a list of columns in the CONTAINS query.</span></span>  
  
-   <span data-ttu-id="f6a69-116">フルテキスト キーまたは順位情報だけが必要な場合は、CONTAINS の代わりに [CONTAINSTABLE](/sql/relational-databases/system-functions/containstable-transact-sql) を使用し、FREETEXT の代わりに [FREETEXTTABLE](/sql/relational-databases/system-functions/freetexttable-transact-sql) を使用します。</span><span class="sxs-lookup"><span data-stu-id="f6a69-116">If you only require full-text key or rank information, use [CONTAINSTABLE](/sql/relational-databases/system-functions/containstable-transact-sql) or [FREETEXTTABLE](/sql/relational-databases/system-functions/freetexttable-transact-sql) instead of CONTAINS or FREETEXT, respectively.</span></span>  
  
-   <span data-ttu-id="f6a69-117">結果を制限してパフォーマンスを向上させるには、FREETEXTTABLE 関数および CONTAINSTABLE 関数の *top_n_by_rank* パラメーターを使用します。</span><span class="sxs-lookup"><span data-stu-id="f6a69-117">To limit results and increase performance, use the *top_n_by_rank* parameter of the FREETEXTTABLE and CONTAINSTABLE functions.</span></span> <span data-ttu-id="f6a69-118">*top_n_by_rank* を使用すると、最も関連性の高いヒットだけを呼び出すことができます。</span><span class="sxs-lookup"><span data-stu-id="f6a69-118">*top_n_by_rank* allows you to recall only the most relevant hits.</span></span> <span data-ttu-id="f6a69-119">ビジネス シナリオですべてのヒットを呼び出す必要がない場合 (つまり、 *総呼び出し*が不要な場合) にのみ、このパラメーターを使用してください。</span><span class="sxs-lookup"><span data-stu-id="f6a69-119">Use this parameter only if your business scenario does not require recalling all possible hits (that is, it does not require *total recall*).</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="f6a69-120">一般に、総呼び出しは法務シナリオで必要とされますが、e ビジネスなどのビジネス シナリオではパフォーマンスの方が重視されることがあります。</span><span class="sxs-lookup"><span data-stu-id="f6a69-120">Total recall is typically necessary for legal scenarios but might be less important than performance for business scenarios such as an e-business.</span></span>  
  
-   <span data-ttu-id="f6a69-121">フルテキスト クエリ プランをチェックして、適切な結合プランが選択されていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="f6a69-121">Check the full-text query plan to make sure that the appropriate join plan is chosen.</span></span> <span data-ttu-id="f6a69-122">必要であれば結合ヒントやクエリ ヒントを使用します。</span><span class="sxs-lookup"><span data-stu-id="f6a69-122">Use a join hint or query hint if you have to.</span></span> <span data-ttu-id="f6a69-123">フルテキスト クエリでパラメーターが使用されている場合は、パラメーターの初回の値によってクエリ プランが決定されます。</span><span class="sxs-lookup"><span data-stu-id="f6a69-123">If a parameter is used in the full-text query, the first-time value of the parameter determines the query plan.</span></span> <span data-ttu-id="f6a69-124">OPTIMIZE FOR [クエリ ヒント](/sql/t-sql/queries/hints-transact-sql-query) を使用すると、クエリのコンパイルに使用される値を強制的に指定できます。</span><span class="sxs-lookup"><span data-stu-id="f6a69-124">You can use the OPTIMIZE FOR [query hint](/sql/t-sql/queries/hints-transact-sql-query) to force the query to compile with the value you want.</span></span> <span data-ttu-id="f6a69-125">これにより、決定的なクエリ プランを実現してパフォーマンスを強化できます。</span><span class="sxs-lookup"><span data-stu-id="f6a69-125">This helps achieve a deterministic query plan and better performance.</span></span>  
  
-   <span data-ttu-id="f6a69-126">非常に多くのフルテキスト インデックス フラグメントがフルテキスト インデックスに含まれている場合、クエリのパフォーマンスが大幅に低下する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="f6a69-126">Too many full-text index fragments in the full-text index, can lead to substantial degradation in query performance.</span></span> <span data-ttu-id="f6a69-127">フラグメントの数を減らすには、 [ALTER FULLTEXT CATALOG](/sql/t-sql/statements/alter-fulltext-catalog-transact-sql)[!INCLUDE[tsql](../../includes/tsql-md.md)] ステートメントの REORGANIZE オプションを使用してフルテキスト カタログを再構成します。</span><span class="sxs-lookup"><span data-stu-id="f6a69-127">To reduce the number of fragments, reorganize the full-text catalog by using the REORGANIZE option of the [ALTER FULLTEXT CATALOG](/sql/t-sql/statements/alter-fulltext-catalog-transact-sql)[!INCLUDE[tsql](../../includes/tsql-md.md)] statement.</span></span> <span data-ttu-id="f6a69-128">このステートメントは、実質的に、すべてのフラグメントを単一のより大きなフラグメントにマージし、フルテキスト インデックスから古いエントリをすべて削除します。</span><span class="sxs-lookup"><span data-stu-id="f6a69-128">This statement essentially merges all the fragments into a single larger fragment and removes all obsolete entries from the full-text index.</span></span>  
  
-   <span data-ttu-id="f6a69-129">フルテキスト検索では、CONTAINSTABLE で指定した論理演算子 (AND、OR) を、SQL 結合として実装することも、フルテキスト実行 STVF (ストリーミング テーブル値関数) 内部に実装することもできます。</span><span class="sxs-lookup"><span data-stu-id="f6a69-129">In  full-text search, logical operators specified in CONTAINSTABLE (AND, OR) can be implemented either as SQL joins or inside the full-text execution streaming table-valued functions (STVF).</span></span> <span data-ttu-id="f6a69-130">通常、論理演算子を 1 種類だけ使用するクエリはフルテキスト実行によってのみ実装され、論理演算子が混在するクエリは SQL 結合も保持します。</span><span class="sxs-lookup"><span data-stu-id="f6a69-130">Typically, queries with only one type of logical operators are implemented purely by full-text execution, whereas queries that mix logical operators also possess SQL joins.</span></span> <span data-ttu-id="f6a69-131">フルテキスト実行 STVF 内部に論理演算子を実装すると、複数の特別なインデックス プロパティが使用され、SQL 結合よりはるかに高速になります。</span><span class="sxs-lookup"><span data-stu-id="f6a69-131">Implementation of a logical operator inside the full-text execution STVF uses some special index properties that make it much faster than SQL joins.</span></span> <span data-ttu-id="f6a69-132">この理由から、可能な限り 1 種類だけの論理演算子を使用してクエリを作成することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="f6a69-132">For this reason, we recommend that, where possible, you frame queries using only a single type of logical operator.</span></span>  
  
-   <span data-ttu-id="f6a69-133">選択的リレーションの述語が含まれているアプリケーションにおいて、選択的リレーションの述語と非選択的なフルテキスト述語を使用するクエリでは、クエリ オプティマイザーを使用するように記述した場合に最適なパフォーマンスを得られる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="f6a69-133">For applications that contain selective-relation predications, queries that use selective relational predicates and unselective full-text predicates might perform best when they are written to use the query optimizer.</span></span> <span data-ttu-id="f6a69-134">この場合、効果的なクエリ プランを作成するために述語を利用するかプッシュダウンを適用するかが、クエリ オプティマイザーによって判断されます。</span><span class="sxs-lookup"><span data-stu-id="f6a69-134">This allows the query optimizer to decide whether it can exploit predicate or range pushdown to produce an effective query plan.</span></span> <span data-ttu-id="f6a69-135">この方法は、リレーショナル データをフルテキスト データとしてインデックス作成するよりも単純であり、多くの場合、効率的でもあります。</span><span class="sxs-lookup"><span data-stu-id="f6a69-135">This approach is simpler and often more efficient than indexing relational data as full-text data.</span></span>  
  
## <a name="related-resources"></a><span data-ttu-id="f6a69-136">関連リソース</span><span class="sxs-lookup"><span data-stu-id="f6a69-136">Related Resources</span></span>  
 [<span data-ttu-id="f6a69-137">SQL Server 2008 フルテキスト検索: 内部構造と機能強化</span><span class="sxs-lookup"><span data-stu-id="f6a69-137">SQL Server 2008 Full-Text Search: Internals and Enhancements</span></span>](https://go.microsoft.com/fwlink/?LinkId=129544)  
  
## <a name="see-also"></a><span data-ttu-id="f6a69-138">参照</span><span class="sxs-lookup"><span data-stu-id="f6a69-138">See Also</span></span>  
 <span data-ttu-id="f6a69-139">[sys.dm_fts_memory_buffers &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-fts-memory-buffers-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="f6a69-139">[sys.dm_fts_memory_buffers &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-fts-memory-buffers-transact-sql) </span></span>  
 [<span data-ttu-id="f6a69-140">sys.dm_fts_memory_pools &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="f6a69-140">sys.dm_fts_memory_pools &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-dynamic-management-views/sys-dm-fts-memory-pools-transact-sql)  
  
  
