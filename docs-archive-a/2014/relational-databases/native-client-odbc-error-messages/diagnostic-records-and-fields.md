---
title: 診断レコードとフィールド |Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- header records [ODBC]
- SQL Server Native Client ODBC driver, errors
- messages [ODBC], diagnostic records
- ODBC error handling, diagnostic records
- SQLGetDiagField function
- diagnostic records [ODBC]
- errors [ODBC], diagnostic records
- fields [ODBC]
- status information [ODBC]
ms.assetid: 4949530c-62d1-4f1a-b592-144244444ce0
author: rothja
ms.author: jroth
ms.openlocfilehash: 4fe52b211eb6d5a0e4d875264609d036702b2b0b
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87738329"
---
# <a name="diagnostic-records-and-fields"></a><span data-ttu-id="9c8df-102">診断レコードと診断フィールド</span><span class="sxs-lookup"><span data-stu-id="9c8df-102">Diagnostic Records and Fields</span></span>
  <span data-ttu-id="9c8df-103">診断レコードは、ODBC 環境、接続、ステートメント、または記述子ハンドルに関連付けられています。</span><span class="sxs-lookup"><span data-stu-id="9c8df-103">Diagnostic records are associated with ODBC environment, connection, statement, or descriptor handles.</span></span> <span data-ttu-id="9c8df-104">ODBC 関数から SQL_SUCCESS または SQL_INVALID_HANDLE 以外のリターン コードが返されるときは、その関数で呼び出されたハンドルに、情報メッセージまたはエラー メッセージが格納された診断レコードが関連付けられます。</span><span class="sxs-lookup"><span data-stu-id="9c8df-104">When any ODBC function raises a return code other than SQL_SUCCESS or SQL_INVALID_HANDLE, the handle called by the function has associated diagnostic records that contain informational or error messages.</span></span> <span data-ttu-id="9c8df-105">これらの診断レコードは、同じハンドルを使用して別の関数が呼び出されるまで保持され、別の呼び出しが行われた時点で破棄されます。</span><span class="sxs-lookup"><span data-stu-id="9c8df-105">These records are retained until another function is called using that handle, at which time they are discarded.</span></span> <span data-ttu-id="9c8df-106">1 つのハンドルに同時に関連付けることができる診断レコードの数に制限はありません。</span><span class="sxs-lookup"><span data-stu-id="9c8df-106">There is no limit to the number of diagnostic records that can be associated with a handle at any one time.</span></span>  
  
 <span data-ttu-id="9c8df-107">診断レコードには、ヘッダー レコードと状態レコードの 2 種類があります。</span><span class="sxs-lookup"><span data-stu-id="9c8df-107">There are two types of diagnostic records: header and status.</span></span> <span data-ttu-id="9c8df-108">ヘッダー レコードはレコード 0 です。状態レコードが存在する場合は、レコード 1 以降が状態レコードになります。</span><span class="sxs-lookup"><span data-stu-id="9c8df-108">The header record is record 0; when there are status records, they are records 1 and later.</span></span> <span data-ttu-id="9c8df-109">診断レコードのヘッダー レコードと状態レコードには、それぞれ異なるフィールドが含まれています。</span><span class="sxs-lookup"><span data-stu-id="9c8df-109">Diagnostic records contain different fields for the header record and the status records.</span></span> <span data-ttu-id="9c8df-110">また、ODBC コンポーネントでは、診断レコードに独自のフィールドを定義することもできます。</span><span class="sxs-lookup"><span data-stu-id="9c8df-110">ODBC components can also define their own diagnostic record fields.</span></span>  
  
 <span data-ttu-id="9c8df-111">ヘッダー レコード内のフィールドには、リターン コード、行数、状態レコードの数、実行したステートメントの種類など、関数の実行に関する一般的な情報が保存されます。</span><span class="sxs-lookup"><span data-stu-id="9c8df-111">Fields in the header record contain general information about a function's execution, including the return code, row count, number of status records, and type of statement executed.</span></span> <span data-ttu-id="9c8df-112">ヘッダー レコードは、ODBC 関数から SQL_INVALID_HANDLE が返されない限り、常に作成されます。</span><span class="sxs-lookup"><span data-stu-id="9c8df-112">The header record is always created unless an ODBC function returns SQL_INVALID_HANDLE.</span></span> <span data-ttu-id="9c8df-113">ヘッダーレコード内のフィールドの完全な一覧については、「 [SQLGetDiagField](../native-client-odbc-api/sqlgetdiagfield.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9c8df-113">For a complete list of fields in the header record, see [SQLGetDiagField](../native-client-odbc-api/sqlgetdiagfield.md).</span></span>  
  
 <span data-ttu-id="9c8df-114">状態レコード内のフィールドには、SQLSTATE、ネイティブ エラー番号、診断メッセージ、列番号、行番号など、ODBC ドライバー マネージャー、ドライバー、またはデータ ソースから返される特定のエラーや警告に関する情報が保存されます。</span><span class="sxs-lookup"><span data-stu-id="9c8df-114">Fields in the status records contain information about specific errors or warnings returned by the ODBC Driver Manager, driver, or data source, including the SQLSTATE, native error number, diagnostic message, column number, and row number.</span></span> <span data-ttu-id="9c8df-115">状態レコードは、関数から SQL_ERROR、SQL_SUCCESS_WITH_INFO、SQL_NO_DATA、SQL_NEED_DATA、または SQL_STILL_EXECUTING が返された場合のみ作成されます。</span><span class="sxs-lookup"><span data-stu-id="9c8df-115">Status records are created only if the function returns SQL_ERROR, SQL_SUCCESS_WITH_INFO, SQL_NO_DATA, SQL_NEED_DATA, or SQL_STILL_EXECUTING.</span></span> <span data-ttu-id="9c8df-116">状態レコードのフィールドの完全な一覧については、「 **SQLGetDiagField**」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9c8df-116">For a complete list of fields in the status records, see **SQLGetDiagField**.</span></span>  
  
 <span data-ttu-id="9c8df-117">**SQLGetDiagRec**は、1つの診断レコードと、その ODBC SQLSTATE、ネイティブエラー番号、および診断メッセージフィールドを取得します。</span><span class="sxs-lookup"><span data-stu-id="9c8df-117">**SQLGetDiagRec** retrieves a single diagnostic record along with its ODBC SQLSTATE, native error number, and diagnostic-message fields.</span></span> <span data-ttu-id="9c8df-118">この機能は、ODBC 2 に似ています。_x_**SQLError**関数。</span><span class="sxs-lookup"><span data-stu-id="9c8df-118">This functionality is similar to the ODBC 2._x_**SQLError** function.</span></span> <span data-ttu-id="9c8df-119">ODBC 3 の最も単純なエラー処理関数です。*x*は、 *recnumber*パラメーターを1に設定して**SQLGetDiagRec**を繰り返し呼び出し、 **SQLGetDiagRec**が SQL_NO_DATA を返すまで、 *recnumber*を1ずつインクリメントします。</span><span class="sxs-lookup"><span data-stu-id="9c8df-119">The simplest error-handling function in ODBC 3.*x* is to repeatedly call **SQLGetDiagRec** starting with the *RecNumber* parameter set to 1 and incrementing *RecNumber* by 1 until **SQLGetDiagRec** returns SQL_NO_DATA.</span></span> <span data-ttu-id="9c8df-120">これは、ODBC 2 に相当します。SQL_NO_DATA_FOUND が返されるまで、 **SQLError**を呼び出す*x*アプリケーション。</span><span class="sxs-lookup"><span data-stu-id="9c8df-120">This is equivalent to an ODBC 2.*x* application calling **SQLError** until it returns SQL_NO_DATA_FOUND.</span></span>  
  
 <span data-ttu-id="9c8df-121">ODBC 3.*x*では、ODBC 2 よりも多くの診断情報がサポートされています。*x*。</span><span class="sxs-lookup"><span data-stu-id="9c8df-121">ODBC 3.*x* supports much more diagnostic information than ODBC 2.*x*.</span></span> <span data-ttu-id="9c8df-122">この情報は、 **SQLGetDiagField**を使用して取得した診断レコードの追加フィールドに格納されます。</span><span class="sxs-lookup"><span data-stu-id="9c8df-122">This information is stored in additional fields in diagnostic records retrieved by using **SQLGetDiagField**.</span></span>  
  
 <span data-ttu-id="9c8df-123">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]Native CLIENT ODBC ドライバーには、 **SQLGetDiagField**を使用して取得できるドライバー固有の診断フィールドがあります。</span><span class="sxs-lookup"><span data-stu-id="9c8df-123">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client ODBC driver has driver-specific diagnostic fields that can be retrieved with **SQLGetDiagField**.</span></span> <span data-ttu-id="9c8df-124">これらのドライバー固有のフィールドのラベルは、sqlncli.h で定義されています。</span><span class="sxs-lookup"><span data-stu-id="9c8df-124">Labels for these driver-specific fields are defined in sqlncli.h.</span></span> <span data-ttu-id="9c8df-125">これらのラベルを使用して、各診断レコードに関連付けられた [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] の状態、重大度レベル、サーバー名、プロシージャ名、および行番号を取得します。</span><span class="sxs-lookup"><span data-stu-id="9c8df-125">Use these labels to retrieve the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] state, severity level, server name, procedure name, and line number associated with each diagnostic record.</span></span> <span data-ttu-id="9c8df-126">また、sqlncli には、アプリケーションが*DiagIdentifier*を SQL_DIAG_DYNAMIC_FUNCTION_CODE に設定して**SQLGetDiagField**を呼び出す場合に、transact-sql ステートメントを識別するためにドライバーが使用するコードの定義が含まれています。</span><span class="sxs-lookup"><span data-stu-id="9c8df-126">Also, sqlncli.h contains definitions of the codes the driver uses to identify Transact-SQL statements if an application calls **SQLGetDiagField** with *DiagIdentifier* set to SQL_DIAG_DYNAMIC_FUNCTION_CODE.</span></span>  
  
 <span data-ttu-id="9c8df-127">**SQLGetDiagField**は、基になるドライバーからキャッシュするエラー情報を使用して、ODBC ドライバーマネージャーによって処理されます。</span><span class="sxs-lookup"><span data-stu-id="9c8df-127">**SQLGetDiagField** is processed by the ODBC Driver Manager using error information it caches from the underlying driver.</span></span> <span data-ttu-id="9c8df-128">ODBC ドライバー マネージャーでは、接続が正しく確立されるまでドライバー固有の診断フィールドをキャッシュしません。</span><span class="sxs-lookup"><span data-stu-id="9c8df-128">The ODBC Driver Manager does not cache driver-specific diagnostic fields until after a successful connection has been made.</span></span> <span data-ttu-id="9c8df-129">**SQLGetDiagField**は、正常に接続が完了する前にドライバー固有の診断フィールドを取得するために呼び出された場合に SQL_ERROR を返します。</span><span class="sxs-lookup"><span data-stu-id="9c8df-129">**SQLGetDiagField** returns SQL_ERROR if it is called to get driver-specific diagnostic fields before a successful connection has been completed.</span></span> <span data-ttu-id="9c8df-130">ODBC 接続関数から SQL_SUCCESS_WITH_INFO が返されても、その接続関数のドライバー固有の診断フィールドはまだ使用できません。</span><span class="sxs-lookup"><span data-stu-id="9c8df-130">If an ODBC connect function returns SQL_SUCCESS_WITH_INFO, the driver-specific diagnostic fields for the connect function are not yet available.</span></span> <span data-ttu-id="9c8df-131">接続関数の後に別の ODBC 関数呼び出しを行った後でのみ、ドライバー固有の診断フィールドに対して**SQLGetDiagField**の呼び出しを開始できます。</span><span class="sxs-lookup"><span data-stu-id="9c8df-131">You can start calling **SQLGetDiagField** for driver-specific diagnostic fields only after you have made another ODBC function call after the connect function.</span></span>  
  
 <span data-ttu-id="9c8df-132">Native Client ODBC ドライバーによって報告されるほとんどのエラー [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] は、 **SQLGetDiagRec**によって返された情報のみを使用して、効果的に診断することができます。</span><span class="sxs-lookup"><span data-stu-id="9c8df-132">Most errors reported by the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client ODBC driver can be effectively diagnosed using only the information returned by **SQLGetDiagRec**.</span></span> <span data-ttu-id="9c8df-133">ただし、ドライバー固有の診断フィールドから返される情報がエラーを診断するうえで重要になることもあります。</span><span class="sxs-lookup"><span data-stu-id="9c8df-133">In some cases, however, the information returned by the driver-specific diagnostic fields is important in diagnosing an error.</span></span> <span data-ttu-id="9c8df-134">Native Client ODBC ドライバーを使用してアプリケーションの ODBC エラーハンドラをコーディングする場合 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] は、 **SQLGetDiagField**を使用して、少なくとも SQL_DIAG_SS_MSGSTATE および SQL_DIAG_SS_SEVERITY ドライバ固有のフィールドを取得することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="9c8df-134">When coding an ODBC error handler for applications using the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client ODBC driver, it is a good idea to also use **SQLGetDiagField** to retrieve at least the SQL_DIAG_SS_MSGSTATE and SQL_DIAG_SS_SEVERITY driver-specific fields.</span></span> <span data-ttu-id="9c8df-135">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] コード内の複数の箇所で特定のエラーが発生した可能性がある場合は、SQL_DIAG_SS_MSGSTATE により、エラーの厳密な発生箇所がマイクロソフトのサポート エンジニアに報告されます。この情報は、問題の診断に役立つことがあります。</span><span class="sxs-lookup"><span data-stu-id="9c8df-135">If a particular error can be raised at several locations in the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] code, SQL_DIAG_SS_MSGSTATE indicates to a Microsoft support engineer specifically where an error was raised, which sometimes aids in diagnosing a problem.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="9c8df-136">参照</span><span class="sxs-lookup"><span data-stu-id="9c8df-136">See Also</span></span>  
 [<span data-ttu-id="9c8df-137">エラーとメッセージの処理</span><span class="sxs-lookup"><span data-stu-id="9c8df-137">Handling Errors and Messages</span></span>](handling-errors-and-messages.md)  
  
  
