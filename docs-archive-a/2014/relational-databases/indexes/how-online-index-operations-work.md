---
title: オンライン インデックス操作の動作原理 | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: table-view-index
ms.topic: conceptual
helpviewer_keywords:
- online index operations
- source indexes [SQL Server]
- preexisting indexes [SQL Server]
- target indexes [SQL Server]
- temporary mapping index [SQL Server]
- index temporary mappings [SQL Server]
ms.assetid: eef0c9d1-790d-46e4-a758-d0bf6742e6ae
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 9b74690c9dfb980787087899200ffb45c2c4b6b6
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87645054"
---
# <a name="how-online-index-operations-work"></a><span data-ttu-id="e562c-102">オンライン インデックス操作の動作原理</span><span class="sxs-lookup"><span data-stu-id="e562c-102">How Online Index Operations Work</span></span>
  <span data-ttu-id="e562c-103">このトピックでは、オンライン インデックスの操作中に存在する構造を定義し、これらの構造に関連した利用方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="e562c-103">This topic defines the structures that exist during an online index operation and shows the activities associated with these structures.</span></span>  
  
## <a name="online-index-structures"></a><span data-ttu-id="e562c-104">オンライン インデックスの構造</span><span class="sxs-lookup"><span data-stu-id="e562c-104">Online Index Structures</span></span>  
 <span data-ttu-id="e562c-105">インデックス DDL (データ定義言語) の操作中に同時ユーザー操作を可能にするために、オンライン インデックスの操作中に、ソースと既存のインデックス、ターゲット、(ヒープを再構築したりクラスター化インデックスをオンラインで削除したりする場合) 一時マッピング インデックスなどの構造が使用されます。</span><span class="sxs-lookup"><span data-stu-id="e562c-105">To allow for concurrent user activity during an index data definition language (DDL) operation, the following structures are used during the online index operation: source and preexisting indexes, target, and for rebuilding a heap or dropping a clustered index online, a temporary mapping index.</span></span>  
  
-   <span data-ttu-id="e562c-106">**ソースと既存のインデックス**</span><span class="sxs-lookup"><span data-stu-id="e562c-106">**Source and preexisting indexes**</span></span>  
  
     <span data-ttu-id="e562c-107">ソースとは、元のテーブルまたはクラスター化インデックス データです。</span><span class="sxs-lookup"><span data-stu-id="e562c-107">The source is the original table or clustered index data.</span></span> <span data-ttu-id="e562c-108">既存のインデックスとは、ソース構造に関連付けられた任意の非クラスター化インデックスです。</span><span class="sxs-lookup"><span data-stu-id="e562c-108">Preexisting indexes are any nonclustered indexes that are associated with the source structure.</span></span> <span data-ttu-id="e562c-109">たとえば、オンライン インデックス操作によって、関連付けられた 4 つの非クラスター化インデックスを含むクラスター化インデックスが再構築される場合、ソースは既存のクラスター化インデックスで、既存のインデックスは非クラスター化インデックスです。</span><span class="sxs-lookup"><span data-stu-id="e562c-109">For example, if the online index operation is rebuilding a clustered index that has four associated nonclustered indexes, the source is the existing clustered index and the preexisting indexes are the nonclustered indexes.</span></span>  
  
     <span data-ttu-id="e562c-110">同時実行ユーザーは、選択、挿入、更新、および削除の各操作に、既存のインデックスを使用できます。</span><span class="sxs-lookup"><span data-stu-id="e562c-110">The preexisting indexes are available to concurrent users for select, insert, update, and delete operations.</span></span> <span data-ttu-id="e562c-111">既存のインデックスを使用する操作には、トリガーや参照整合性制約による、一括挿入や暗黙の更新が含まれます (一括挿入は、サポートされますが、お勧めしません)。</span><span class="sxs-lookup"><span data-stu-id="e562c-111">This includes bulk inserts (supported but not recommended) and implicit updates by triggers and referential integrity constraints.</span></span> <span data-ttu-id="e562c-112">クエリや検索では、すべての既存のインデックスを使用できます。</span><span class="sxs-lookup"><span data-stu-id="e562c-112">All preexisting indexes are available for queries and searches.</span></span> <span data-ttu-id="e562c-113">つまり、クエリ オプティマイザーでは既存のインデックスが選択され、必要に応じて、それをインデックス ヒントに指定できます。</span><span class="sxs-lookup"><span data-stu-id="e562c-113">This means they may be selected by the query optimizer and, if necessary, specified in index hints.</span></span>  
  
-   <span data-ttu-id="e562c-114">**移行先**</span><span class="sxs-lookup"><span data-stu-id="e562c-114">**Target**</span></span>  
  
     <span data-ttu-id="e562c-115">ターゲットとは、作成または再構築される、新しいインデックス (または、ヒープ) です。</span><span class="sxs-lookup"><span data-stu-id="e562c-115">The target or targets is the new index (or heap) or a set of new indexes that is being created or rebuilt.</span></span> <span data-ttu-id="e562c-116">ユーザーによるソースへの挿入、更新、削除の各操作は、インデックス操作中、 [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] によってターゲットに適用されます。</span><span class="sxs-lookup"><span data-stu-id="e562c-116">User insert, update, and delete operations to the source are applied by the [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] to the target during the index operation.</span></span> <span data-ttu-id="e562c-117">たとえば、オンライン インデックス操作によってクラスター化インデックスが再構築される場合、ターゲットは再構築されるクラスター化インデックスです。 [!INCLUDE[ssDE](../../includes/ssde-md.md)] では、クラスター化インデックスが再構築されるときは、非クラスター化インデックスは再構築されません。</span><span class="sxs-lookup"><span data-stu-id="e562c-117">For example, if the online index operation is rebuilding a clustered index, the target is the rebuilt clustered index; the [!INCLUDE[ssDE](../../includes/ssde-md.md)] does not rebuild nonclustered indexes when a clustered index is rebuilt.</span></span>  
  
     <span data-ttu-id="e562c-118">SELECT ステートメントの処理中には、インデックス操作がコミットされるまでターゲット インデックスは検索されません。</span><span class="sxs-lookup"><span data-stu-id="e562c-118">The target index is not searched while processing SELECT statements until the index operation is committed.</span></span> <span data-ttu-id="e562c-119">内部的には、インデックスは書き込み専用に設定されます。</span><span class="sxs-lookup"><span data-stu-id="e562c-119">Internally, the index is marked as write-only.</span></span>  
  
-   <span data-ttu-id="e562c-120">**一時マッピング インデックス**</span><span class="sxs-lookup"><span data-stu-id="e562c-120">**Temporary mapping index**</span></span>  
  
     <span data-ttu-id="e562c-121">クラスター化インデックスを作成、削除、または再構築するオンライン インデックス操作では、一時マッピング インデックスも必要になります。</span><span class="sxs-lookup"><span data-stu-id="e562c-121">Online index operations that create, drop, or rebuild a clustered index also require a temporary mapping index.</span></span> <span data-ttu-id="e562c-122">基になるテーブルの行が更新または削除されるときに、構築される新しいインデックスのどのレコードを削除するかを決めるために、同時実行トランザクションによってこの一時インデックスが使用されます。</span><span class="sxs-lookup"><span data-stu-id="e562c-122">This temporary index is used by concurrent transactions to determine which records to delete in the new indexes that are being built when rows in the underlying table are updated or deleted.</span></span> <span data-ttu-id="e562c-123">新しいクラスター化インデックス (またはヒープ) と同じ手順で、この非クラスター化インデックスが作成されます。また、個別の並べ替え操作は必要ありません。</span><span class="sxs-lookup"><span data-stu-id="e562c-123">This nonclustered index is created in the same step as the new clustered index (or heap) and does not require a separate sort operation.</span></span> <span data-ttu-id="e562c-124">同時実行トランザクションでは、挿入、更新、削除の各操作のすべての一時マッピング インデックスもメンテナンスされます。</span><span class="sxs-lookup"><span data-stu-id="e562c-124">Concurrent transactions also maintain the temporary mapping index in all their insert, update, and delete operations.</span></span>  
  
## <a name="online-index-activities"></a><span data-ttu-id="e562c-125">オンライン インデックスでの処理</span><span class="sxs-lookup"><span data-stu-id="e562c-125">Online Index Activities</span></span>  
 <span data-ttu-id="e562c-126">インデックスが設定されていないテーブル (ヒープ) にクラスター化インデックスを作成する場合など、単純なオンライン インデックス操作中は、ソースとターゲットは準備、構築、最終工程の 3 つのフェーズで処理されます。</span><span class="sxs-lookup"><span data-stu-id="e562c-126">During a simple online index operation, such as creating a clustered index on a nonindexed table (heap), the source and target go through three phases: preparation, build, and final.</span></span>  
  
 <span data-ttu-id="e562c-127">次の図に、初期クラスター化インデックスをオンラインで作成する処理を示します。</span><span class="sxs-lookup"><span data-stu-id="e562c-127">The following illustration shows the process for creating an initial clustered index online.</span></span> <span data-ttu-id="e562c-128">ソース オブジェクト (ヒープ) には、他のインデックスはありません。</span><span class="sxs-lookup"><span data-stu-id="e562c-128">The source object (the heap) has no other indexes.</span></span> <span data-ttu-id="e562c-129">各フェーズでのソースとターゲットの利用状況が示されています。また、同時実行ユーザーによる選択、挿入、更新、削除の各操作についても示されています。</span><span class="sxs-lookup"><span data-stu-id="e562c-129">The source and target structure activities are shown for each phase; concurrent user select, insert, update, and delete operations are also shown.</span></span> <span data-ttu-id="e562c-130">準備、構築、最終工程の各フェーズは、フェーズで使用されるロック モードと共に示されています。</span><span class="sxs-lookup"><span data-stu-id="e562c-130">The preparation, build, and final phases are indicated together with the lock modes used in each phase.</span></span>  
  
 <span data-ttu-id="e562c-131">![オンライン インデックスの操作中に行われる処理](../../database-engine/media/online-index.gif "オンライン インデックスの操作中に行われる処理")</span><span class="sxs-lookup"><span data-stu-id="e562c-131">![Activities performed during online index operation](../../database-engine/media/online-index.gif "Activities performed during online index operation")</span></span>  
  
## <a name="source-structure-activities"></a><span data-ttu-id="e562c-132">ソース構造での処理</span><span class="sxs-lookup"><span data-stu-id="e562c-132">Source Structure Activities</span></span>  
 <span data-ttu-id="e562c-133">次の表に、インデックス操作と対応するロック操作の各フェーズ中に、ソース構造に関係する処理を一覧します。</span><span class="sxs-lookup"><span data-stu-id="e562c-133">The following table lists the activities involving the source structures during each phase of the index operation and the corresponding locking strategy.</span></span>  
  
|<span data-ttu-id="e562c-134">段階</span><span class="sxs-lookup"><span data-stu-id="e562c-134">Phase</span></span>|<span data-ttu-id="e562c-135">ソースでの処理</span><span class="sxs-lookup"><span data-stu-id="e562c-135">Source activity</span></span>|<span data-ttu-id="e562c-136">ソースのロック</span><span class="sxs-lookup"><span data-stu-id="e562c-136">Source locks</span></span>|  
|-----------|---------------------|------------------|  
|<span data-ttu-id="e562c-137">準備</span><span class="sxs-lookup"><span data-stu-id="e562c-137">Preparation</span></span><br /><br /> <span data-ttu-id="e562c-138">非常に短いフェーズ</span><span class="sxs-lookup"><span data-stu-id="e562c-138">Very short phase</span></span>|<span data-ttu-id="e562c-139">新しい空のインデックス構造を作成するための、システム メタデータの準備。</span><span class="sxs-lookup"><span data-stu-id="e562c-139">System metadata preparation to create the new empty index structure.</span></span><br /><br /> <span data-ttu-id="e562c-140">テーブルのスナップショットが定義されます。</span><span class="sxs-lookup"><span data-stu-id="e562c-140">A snapshot of the table is defined.</span></span> <span data-ttu-id="e562c-141">つまり、トランザクションレベルの読み取りの一貫性を提供するために、行のバージョン管理が使用されます。</span><span class="sxs-lookup"><span data-stu-id="e562c-141">That is, row versioning is used to provide transaction-level read consistency.</span></span><br /><br /> <span data-ttu-id="e562c-142">ごく短期間、ソース上での同時実行ユーザーの書き込み操作がブロックされます。</span><span class="sxs-lookup"><span data-stu-id="e562c-142">Concurrent user write operations on the source are blocked for a very short period.</span></span><br /><br /> <span data-ttu-id="e562c-143">複数の非クラスター化インデックスの作成を除き、同時実行 DDL 操作は許可されません。</span><span class="sxs-lookup"><span data-stu-id="e562c-143">No concurrent DDL operations are allowed except creating multiple nonclustered indexes.</span></span>|<span data-ttu-id="e562c-144">テーブルで S (共有) \*</span><span class="sxs-lookup"><span data-stu-id="e562c-144">S (Shared) on the table\*</span></span><br /><br /> <span data-ttu-id="e562c-145">IS (インテント共有)</span><span class="sxs-lookup"><span data-stu-id="e562c-145">IS (Intent Shared)</span></span><br /><br /> <span data-ttu-id="e562c-146">INDEX_BUILD_INTERNAL_RESOURCE\*\*</span><span class="sxs-lookup"><span data-stu-id="e562c-146">INDEX_BUILD_INTERNAL_RESOURCE\*\*</span></span>|  
|<span data-ttu-id="e562c-147">Build</span><span class="sxs-lookup"><span data-stu-id="e562c-147">Build</span></span><br /><br /> <span data-ttu-id="e562c-148">メイン フェーズ</span><span class="sxs-lookup"><span data-stu-id="e562c-148">Main phase</span></span>|<span data-ttu-id="e562c-149">一括読み込み操作で、データのスキャン、並べ替え、マージが行われ、ターゲットに挿入されます。</span><span class="sxs-lookup"><span data-stu-id="e562c-149">The data is scanned, sorted, merged, and inserted into the target in bulk load operations.</span></span><br /><br /> <span data-ttu-id="e562c-150">同時実行ユーザーの選択、挿入、更新、削除の各操作は、既存のインデックスと新しく構築されるインデックスの両方に適用されます。</span><span class="sxs-lookup"><span data-stu-id="e562c-150">Concurrent user select, insert, update, and delete operations are applied to both the preexisting indexes and any new indexes being built.</span></span>|<span data-ttu-id="e562c-151">IS</span><span class="sxs-lookup"><span data-stu-id="e562c-151">IS</span></span><br /><br /> <span data-ttu-id="e562c-152">INDEX_BUILD_INTERNAL_RESOURCE\*\*</span><span class="sxs-lookup"><span data-stu-id="e562c-152">INDEX_BUILD_INTERNAL_RESOURCE\*\*</span></span>|  
|<span data-ttu-id="e562c-153">最終工程</span><span class="sxs-lookup"><span data-stu-id="e562c-153">Final</span></span><br /><br /> <span data-ttu-id="e562c-154">非常に短いフェーズ</span><span class="sxs-lookup"><span data-stu-id="e562c-154">Very short phase</span></span>|<span data-ttu-id="e562c-155">コミットされていないすべての更新トランザクションは、このフェーズが始まる前に完了している必要があります。</span><span class="sxs-lookup"><span data-stu-id="e562c-155">All uncommitted update transactions must complete before this phase starts.</span></span> <span data-ttu-id="e562c-156">取得したロックによっては、このフェーズが完了するまでのごく短期間、新しいユーザーによる読み取りトランザクションや書き込みトランザクションはすべてブロックされます。</span><span class="sxs-lookup"><span data-stu-id="e562c-156">Depending on the acquired lock, all new user read or write transactions are blocked for a very short period until this phase is completed.</span></span><br /><br /> <span data-ttu-id="e562c-157">ソースをターゲットに置き換えるために、システム メタデータが更新されます。</span><span class="sxs-lookup"><span data-stu-id="e562c-157">System metadata is updated to replace the source with the target.</span></span><br /><br /> <span data-ttu-id="e562c-158">必要に応じて、ソースが削除されます。</span><span class="sxs-lookup"><span data-stu-id="e562c-158">The source is dropped if it is required.</span></span> <span data-ttu-id="e562c-159">たとえば、クラスター化インデックスを再構築したり、削除した後などにはソースが削除されます。</span><span class="sxs-lookup"><span data-stu-id="e562c-159">For example, after rebuilding or dropping a clustered index.</span></span>|<span data-ttu-id="e562c-160">INDEX_BUILD_INTERNAL_RESOURCE\*\*</span><span class="sxs-lookup"><span data-stu-id="e562c-160">INDEX_BUILD_INTERNAL_RESOURCE\*\*</span></span><br /><br /> <span data-ttu-id="e562c-161">非クラスター化インデックスを作成する場合、テーブルで S。\*</span><span class="sxs-lookup"><span data-stu-id="e562c-161">S on the table if creating a nonclustered index.\*</span></span><br /><br /> <span data-ttu-id="e562c-162">ソース構造 (インデックスやテーブル) が削除される場合、SCH-M (スキーマ変更)。\*</span><span class="sxs-lookup"><span data-stu-id="e562c-162">SCH-M (Schema Modification) if any source structure (index or table) is dropped.\*</span></span>|  
  
 <span data-ttu-id="e562c-163">\* インデックス操作は、テーブルに S ロックまたは SCH-M ロックを取得する前に、コミットされていない更新トランザクションが完了するまで待機します。</span><span class="sxs-lookup"><span data-stu-id="e562c-163">\* The index operation will wait for any uncommitted update transactions to complete before acquiring the S lock or SCH-M lock on the table.</span></span>  
  
 <span data-ttu-id="e562c-164">\*\* リソース ロック INDEX_BUILD_INTERNAL_RESOURCE により、インデックス操作の実行中に、ソースと既存の各構造で同時実行 DDL (データ定義言語) 操作を実行できなくなります。</span><span class="sxs-lookup"><span data-stu-id="e562c-164">\*\* The resource lock INDEX_BUILD_INTERNAL_RESOURCE prevents the execution of concurrent data definition language (DDL) operations on the source and preexisting structures while the index operation is in progress.</span></span> <span data-ttu-id="e562c-165">たとえばこのロックにより、同じテーブルで 2 つのインデックスの再構築を同時実行できなくなります。</span><span class="sxs-lookup"><span data-stu-id="e562c-165">For example, this lock prevents concurrent rebuild of two indexes on the same table.</span></span> <span data-ttu-id="e562c-166">このリソース ロックは Sch-M ロックと関連付けられていますが、データ操作ステートメントを実行できなくすることはできません。</span><span class="sxs-lookup"><span data-stu-id="e562c-166">Although this resource lock is associated with the Sch-M lock, it does not prevent data manipulation statements.</span></span>  
  
 <span data-ttu-id="e562c-167">上記の表は、1 つのインデックスに関係するオンライン インデックス操作の構築フェーズ中に 1 つの共有 (S) ロックが取得されることを示しています。</span><span class="sxs-lookup"><span data-stu-id="e562c-167">The previous table shows a single Shared (S) lock acquired during the build phase of an online index operation that involves a single index.</span></span> <span data-ttu-id="e562c-168">クラスター化インデックスや非クラスター化インデックスが構築されるときは、構築フェーズ中に 1 つのオンライン インデックス操作 (たとえば、1 つ以上の非クラスター化インデックスを含むテーブルでの最初のクラスター化インデックスの作成中など) で、短期間 2 つの共有 (S) ロックが取得された後、長期間インテント共有 (IS) ロックが取得されます。</span><span class="sxs-lookup"><span data-stu-id="e562c-168">When clustered and nonclustered indexes are built, or rebuilt, in a single online index operation (for example, during the initial clustered index creation on a table that contains one or more nonclustered indexes) two short-term S locks are acquired during the build phase followed by long-term Intent Shared (IS) locks.</span></span> <span data-ttu-id="e562c-169">最初に、クラスター化インデックスの作成のために 1 つの S ロックが取得され、クラスター化インデックスの作成完了時に、非クラスター化インデックスの作成のために 2 番目の S ロックが短期間取得されます。</span><span class="sxs-lookup"><span data-stu-id="e562c-169">One S lock is acquired first for the clustered index creation and when creating the clustered index is completed, a second short-term S lock is acquired for creating the nonclustered indexes.</span></span> <span data-ttu-id="e562c-170">非クラスター化インデックスが作成された後、オンライン インデックス操作の最終フェーズまで、S ロックが IS ロックにダウングレードされます。</span><span class="sxs-lookup"><span data-stu-id="e562c-170">After the nonclustered indexes are created, the S lock is downgraded to an IS lock until the final phase of the online index operation.</span></span>  
  
### <a name="target-structure-activities"></a><span data-ttu-id="e562c-171">ターゲット構造での処理</span><span class="sxs-lookup"><span data-stu-id="e562c-171">Target Structure Activities</span></span>  
 <span data-ttu-id="e562c-172">次の表に、インデックス操作と対応するロック操作の各フェーズ中に、ターゲット構造に関係する処理を一覧します。</span><span class="sxs-lookup"><span data-stu-id="e562c-172">The following table lists the activities that involve the target structure during each phase of the index operation and the corresponding locking strategy.</span></span>  
  
|<span data-ttu-id="e562c-173">段階</span><span class="sxs-lookup"><span data-stu-id="e562c-173">Phase</span></span>|<span data-ttu-id="e562c-174">ターゲットでの処理</span><span class="sxs-lookup"><span data-stu-id="e562c-174">Target activity</span></span>|<span data-ttu-id="e562c-175">ターゲットのロック</span><span class="sxs-lookup"><span data-stu-id="e562c-175">Target locks</span></span>|  
|-----------|---------------------|------------------|  
|<span data-ttu-id="e562c-176">準備</span><span class="sxs-lookup"><span data-stu-id="e562c-176">Preparation</span></span>|<span data-ttu-id="e562c-177">新しいインデックスが作成され、書き込み専用に設定されます。</span><span class="sxs-lookup"><span data-stu-id="e562c-177">New index is created and set to write-only.</span></span>|<span data-ttu-id="e562c-178">IS</span><span class="sxs-lookup"><span data-stu-id="e562c-178">IS</span></span>|  
|<span data-ttu-id="e562c-179">Build</span><span class="sxs-lookup"><span data-stu-id="e562c-179">Build</span></span>|<span data-ttu-id="e562c-180">ソースからデータが挿入されます。</span><span class="sxs-lookup"><span data-stu-id="e562c-180">Data is inserted from source.</span></span><br /><br /> <span data-ttu-id="e562c-181">ソースに適用されたユーザーの変更 (挿入、更新、削除) が適用されます。</span><span class="sxs-lookup"><span data-stu-id="e562c-181">User modifications (inserts, updates, deletes) applied to the source are applied.</span></span><br /><br /> <span data-ttu-id="e562c-182">この処理は、ユーザーが意識することはありません。</span><span class="sxs-lookup"><span data-stu-id="e562c-182">This activity is transparent to the user.</span></span>|<span data-ttu-id="e562c-183">IS</span><span class="sxs-lookup"><span data-stu-id="e562c-183">IS</span></span>|  
|<span data-ttu-id="e562c-184">最終工程</span><span class="sxs-lookup"><span data-stu-id="e562c-184">Final</span></span>|<span data-ttu-id="e562c-185">インデックス メタデータが更新されます。</span><span class="sxs-lookup"><span data-stu-id="e562c-185">Index metadata is updated.</span></span><br /><br /> <span data-ttu-id="e562c-186">インデックスが、読み取りと書き込みが可能な状態に設定されます。</span><span class="sxs-lookup"><span data-stu-id="e562c-186">Index is set to read/write status.</span></span>|<span data-ttu-id="e562c-187">S</span><span class="sxs-lookup"><span data-stu-id="e562c-187">S</span></span><br /><br /> <span data-ttu-id="e562c-188">or</span><span class="sxs-lookup"><span data-stu-id="e562c-188">or</span></span><br /><br /> <span data-ttu-id="e562c-189">SCH-M</span><span class="sxs-lookup"><span data-stu-id="e562c-189">SCH-M</span></span>|  
  
 <span data-ttu-id="e562c-190">インデックス操作が完了するまでは、ユーザーによって実行された SELECT ステートメントがターゲットにアクセスすることはありません。</span><span class="sxs-lookup"><span data-stu-id="e562c-190">The target is not accessed by SELECT statements issued by the user until the index operation is completed.</span></span>  
  
 <span data-ttu-id="e562c-191">準備フェーズと最終工程フェーズが完了した後は、プロシージャ キャッシュに格納されたクエリ プランと更新プランは無効になります。</span><span class="sxs-lookup"><span data-stu-id="e562c-191">After the preparation and final phase is completed, the query and update plans that are stored in the procedure cache are invalidated.</span></span> <span data-ttu-id="e562c-192">後続のクエリでは、新しいインデックスが使用されます。</span><span class="sxs-lookup"><span data-stu-id="e562c-192">Subsequent queries will use the new index.</span></span>  
  
 <span data-ttu-id="e562c-193">オンライン インデックス操作に関係するテーブルで宣言されたカーソルの有効期間は、オンライン インデックス フェーズによって制限されます。</span><span class="sxs-lookup"><span data-stu-id="e562c-193">The lifetime of a cursor declared on a table that is involved in an online index operation is limited by the online index phases.</span></span> <span data-ttu-id="e562c-194">更新カーソルは各フェーズで無効になります。</span><span class="sxs-lookup"><span data-stu-id="e562c-194">Update cursors are invalidated at each phase.</span></span> <span data-ttu-id="e562c-195">読み取り専用カーソルは、最終工程フェーズの後にのみ無効になります。</span><span class="sxs-lookup"><span data-stu-id="e562c-195">Read-only cursors are invalidated only after the final phase.</span></span>  
  
## <a name="related-content"></a><span data-ttu-id="e562c-196">関連コンテンツ</span><span class="sxs-lookup"><span data-stu-id="e562c-196">Related Content</span></span>  
 [<span data-ttu-id="e562c-197">オンラインでのインデックス操作の実行</span><span class="sxs-lookup"><span data-stu-id="e562c-197">Perform Index Operations Online</span></span>](perform-index-operations-online.md)  
  
 [<span data-ttu-id="e562c-198">オンライン インデックス操作のガイドライン</span><span class="sxs-lookup"><span data-stu-id="e562c-198">Guidelines for Online Index Operations</span></span>](guidelines-for-online-index-operations.md)  
  
  
