---
title: 行のフェッチ | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- fetching rows
- OLE DB rowsets, fetching
- rowsets [OLE DB], fetching
- IRowset interface
- SQL Server Native Client OLE DB provider, fetching
ms.assetid: 5e6dbe36-b682-464d-adfa-8e886f9bd452
author: rothja
ms.author: jroth
ms.openlocfilehash: 435e1d705091814b2544c75772f20882caddf942
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87633125"
---
# <a name="fetching-rows"></a><span data-ttu-id="4b733-102">行のフェッチ</span><span class="sxs-lookup"><span data-stu-id="4b733-102">Fetching Rows</span></span>
  <span data-ttu-id="4b733-103">**IRowset** インターフェイスは、行セットの基本インターフェイスです。</span><span class="sxs-lookup"><span data-stu-id="4b733-103">The **IRowset** interface is the base rowset interface.</span></span> <span data-ttu-id="4b733-104">**IRowset** インターフェイスには、行を順番にフェッチするメソッド、フェッチした行からデータを取得するメソッド、行を管理するメソッドが用意されています。</span><span class="sxs-lookup"><span data-stu-id="4b733-104">The **IRowset** interface provides methods for fetching rows sequentially, getting the data from those rows, and managing rows.</span></span> <span data-ttu-id="4b733-105">コンシューマーは、すべての基本的な行セット操作に **IRowset** のメソッドを使用します。</span><span class="sxs-lookup"><span data-stu-id="4b733-105">Consumers use the methods in **IRowset** for all basic rowset operations.</span></span> <span data-ttu-id="4b733-106">基本的な操作には、行のフェッチと解放、列値の取得などがあります。</span><span class="sxs-lookup"><span data-stu-id="4b733-106">This includes fetching and releasing rows and getting column values.</span></span>  
  
 <span data-ttu-id="4b733-107">コンシューマーは行セットのインターフェイス ポインターを取得してから、通常、まず **IRowsetInfo::GetProperties** メソッドを使用して行セットの機能を判断します。</span><span class="sxs-lookup"><span data-stu-id="4b733-107">When a consumer obtains an interface pointer on a rowset, the first step is ordinarily to determine the capabilities of the rowset by using the **IRowsetInfo::GetProperties** method.</span></span> <span data-ttu-id="4b733-108">このメソッドにより、行セットが公開しているインターフェイスに関する情報に加えて、個別のインターフェイスとしては提供されない行セットの機能に関する情報も返されます。このような行セットの情報には、アクティブ行の最大数や、保留中の更新を同時に含むことができる行数などが含まれています。</span><span class="sxs-lookup"><span data-stu-id="4b733-108">This returns information about the interfaces exposed by the rowset and also capabilities of the rowset that do not show up as distinct interfaces, such as the maximum number of active rows and the number of rows that can have pending updates at the same time.</span></span>  
  
 <span data-ttu-id="4b733-109">次に、コンシューマーは、行セット内の列の特性、つまりメタデータを調査します。</span><span class="sxs-lookup"><span data-stu-id="4b733-109">The next step for consumers is to determine the characteristics, or metadata, of the columns in the rowset.</span></span> <span data-ttu-id="4b733-110">この調査では、**IColumnsInfo** メソッドを使用して簡易列情報を取得するか、または **IColumnsRowset** を使用して拡張列情報を取得します。</span><span class="sxs-lookup"><span data-stu-id="4b733-110">For this they use the **IColumnsInfo** method for simple column information or the **IColumnsRowset** method for extended column information.</span></span> <span data-ttu-id="4b733-111">**GetColumnInfo** メソッドは、次の情報を返します。</span><span class="sxs-lookup"><span data-stu-id="4b733-111">The **GetColumnInfo** method returns the following information:</span></span>  
  
-   <span data-ttu-id="4b733-112">結果セット内の列数。</span><span class="sxs-lookup"><span data-stu-id="4b733-112">The number of columns in the result set.</span></span>  
  
-   <span data-ttu-id="4b733-113">DBCOLUMNINFO 構造体の配列。列ごとに 1 つの構造体があります。</span><span class="sxs-lookup"><span data-stu-id="4b733-113">An array of DBCOLUMNINFO structures, one per column.</span></span>  
  
     <span data-ttu-id="4b733-114">構造体の順序は、行セット内で列が表示される順序です。</span><span class="sxs-lookup"><span data-stu-id="4b733-114">The order of the structures is the order in which the columns appear in the rowset.</span></span> <span data-ttu-id="4b733-115">各 DBCOLUMNINFO 構造体には、列名、列の序数、列の値の最大長、列のデータ型、有効桁数、長さなど、列のメタデータが格納されます。</span><span class="sxs-lookup"><span data-stu-id="4b733-115">Each DBCOLUMNINFO structure includes column metadata, such as column name, ordinal of the column, maximum possible length of a value in the column, data type of the column, precision, and length.</span></span>  
  
-   <span data-ttu-id="4b733-116">1 つのアロケーション ブロック内にあるすべての文字列値に関するストレージへのポインター。</span><span class="sxs-lookup"><span data-stu-id="4b733-116">The pointer to a storage for all string values within a single allocation block.</span></span>  
  
 <span data-ttu-id="4b733-117">コンシューマーは必要な列を、メタデータから判断するか、行セットを生成したテキスト コマンドに基づいて判断します。</span><span class="sxs-lookup"><span data-stu-id="4b733-117">The consumer determines which columns it needs either from the metadata or based on the text command that generated the rowset.</span></span> <span data-ttu-id="4b733-118">**IColumnsInfo** によって返される列情報の順番、または **IColumnsRowset** によって返される列メタデータ行セット内の序数から、必要な列の序数が決まります。</span><span class="sxs-lookup"><span data-stu-id="4b733-118">It determines the ordinals of the needed columns from the ordering of the column information returned by **IColumnsInfo** or from the ordinals in the column metadata rowset returned by **IColumnsRowset**.</span></span>  
  
 <span data-ttu-id="4b733-119">**IColumnsInfo** インターフェイスと **IColumnsRowset** インターフェイスを使用して、行セット内の列に関する情報を抽出します。</span><span class="sxs-lookup"><span data-stu-id="4b733-119">The **IColumnsInfo** and **IColumnsRowset** interfaces are used to extract information about the columns in the rowset.</span></span> <span data-ttu-id="4b733-120">**IColumnsInfo** インターフェイスが限定された情報を返すのに対して、**IColumnsRowset** はすべてのメタデータを提供します。</span><span class="sxs-lookup"><span data-stu-id="4b733-120">The **IColumnsInfo** interface returns a limited set of information, whereas **IColumnsRowset** provides all the metadata.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="4b733-121">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Version 7.0 以前では、**IColumnsInfo::GetColumnsInfo** によって返される省略可能なメタデータ列 DBCOLUMN_COMPUTEMODE は、列が計算列かどうかを示す値ではなく、DBSTATUS_S_ISNULL を返します。これは、基になる列が計算列かどうかを判断できないためです。</span><span class="sxs-lookup"><span data-stu-id="4b733-121">In [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] version 7.0 and earlier, the optional metadata column DBCOLUMN_COMPUTEMODE returned by **IColumnsInfo::GetColumnsInfo** returns DBSTATUS_S_ISNULL (instead of the values describing whether the column is computed) because it cannot be determined whether the underlying column is computed.</span></span>  
  
 <span data-ttu-id="4b733-122">序数を使用して、列へのバインドを指定します。</span><span class="sxs-lookup"><span data-stu-id="4b733-122">The ordinals are used to specify a binding to a column.</span></span> <span data-ttu-id="4b733-123">バインドとは、コンシューマーの構造体の要素を列に関連付ける 1 つの構造体です。</span><span class="sxs-lookup"><span data-stu-id="4b733-123">A binding is a structure that associates an element of the consumer's structure with a column.</span></span> <span data-ttu-id="4b733-124">バインドでは、列のデータ値、長さ、および状態値をバインドできます。</span><span class="sxs-lookup"><span data-stu-id="4b733-124">The binding can bind the data value, length, and status value of the column.</span></span>  
  
 <span data-ttu-id="4b733-125">バインドのセットは、アクセサーでまとめて収集されます。</span><span class="sxs-lookup"><span data-stu-id="4b733-125">A set of bindings is gathered together in an accessor.</span></span> <span data-ttu-id="4b733-126">アクセサーは、**IAccessor::CreateAccessor** メソッドを使用して作成します。</span><span class="sxs-lookup"><span data-stu-id="4b733-126">This is created by using the **IAccessor::CreateAccessor** method.</span></span> <span data-ttu-id="4b733-127">アクセサーには複数のバインドを含めることができるので、複数の列のデータを 1 回の呼び出しで取得または設定できます。</span><span class="sxs-lookup"><span data-stu-id="4b733-127">An accessor can contain multiple bindings so that the data for multiple columns can be retrieved or set in a single call.</span></span> <span data-ttu-id="4b733-128">コンシューマーは、アプリケーションのさまざまな部分によって異なる使用パターンに合わせて、複数のアクセサーを作成できます。</span><span class="sxs-lookup"><span data-stu-id="4b733-128">The consumer can create several accessors to match different usage patterns in different parts of the application.</span></span> <span data-ttu-id="4b733-129">行セットが存在する間は、アクセサーを作成および解放できます。</span><span class="sxs-lookup"><span data-stu-id="4b733-129">It can create and release accessors while the rowset remains in existence.</span></span>  
  
 <span data-ttu-id="4b733-130">コンシューマーはデータベースから行をフェッチするために、**IRowset::GetNextRows** や **IRowsetLocate::GetRowsAt** などのメソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="4b733-130">To fetch rows from the database, the consumer calls a method, such as **IRowset::GetNextRows** or **IRowsetLocate::GetRowsAt**.</span></span> <span data-ttu-id="4b733-131">これらのフェッチ操作により、サーバーの行データがプロバイダーの行バッファーに格納されます。</span><span class="sxs-lookup"><span data-stu-id="4b733-131">These fetch operations put row data from the server into the row buffer of the provider.</span></span> <span data-ttu-id="4b733-132">コンシューマーは、プロバイダーの行バッファーに直接アクセスできません。</span><span class="sxs-lookup"><span data-stu-id="4b733-132">The consumer does not have direct access to the row buffer of the provider.</span></span> <span data-ttu-id="4b733-133">**IRowset::GetData** を使用して、プロバイダーのバッファーのデータをコンシューマーのバッファーにコピーし、**IRowsetChange::SetData** を使用して、コンシューマーのバッファー内で変更されたデータをプロバイダーのバッファーにコピーします。</span><span class="sxs-lookup"><span data-stu-id="4b733-133">The consumer uses **IRowset::GetData** to copy data from the buffer of the provider to the consumer buffer and **IRowsetChange::SetData** to copy data changes from the consumer buffer to the provider buffer.</span></span>  
  
 <span data-ttu-id="4b733-134">コンシューマーは行へのハンドル、アクセサーへのハンドル、およびコンシューマーが割り当てたバッファーへのポインターを渡して、**GetData** メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="4b733-134">The consumer calls the **GetData** method and passes the handle to a row, the handle to an accessor, and a pointer to a consumer-allocated buffer.</span></span> <span data-ttu-id="4b733-135">**GetData** は、アクセサーの作成に使用したバインドに指定されているとおりに、データを変換し、列を返します。</span><span class="sxs-lookup"><span data-stu-id="4b733-135">**GetData** converts the data and returns the columns as specified in the bindings used to create the accessor.</span></span> <span data-ttu-id="4b733-136">コンシューマーはさまざまなアクセサーやバッファーを使用して、1 つの行に対して **GetData** を複数回呼び出すことができます。その結果、同じデータの複数のコピーを取得することができます。</span><span class="sxs-lookup"><span data-stu-id="4b733-136">The consumer can call **GetData** more than one time for a row, using different accessors and buffers and therefore the consumer can obtain multiple copies of the same data.</span></span>  
  
 <span data-ttu-id="4b733-137">可変長列のデータは、さまざまな方法で処理できます。</span><span class="sxs-lookup"><span data-stu-id="4b733-137">Data from variable-length columns can be treated several ways.</span></span> <span data-ttu-id="4b733-138">最初に、このような列をコンシューマーの構造体の有限部分にバインドできます。</span><span class="sxs-lookup"><span data-stu-id="4b733-138">First, such columns can be bound to a finite section of the consumer's structure.</span></span> <span data-ttu-id="4b733-139">この場合、データの長さがバッファー長を超えると切り捨てが発生します。</span><span class="sxs-lookup"><span data-stu-id="4b733-139">This causes truncation when the length of the data exceeds the length of the buffer.</span></span> <span data-ttu-id="4b733-140">コンシューマーは状態 DBSTATUS_S_TRUNCATED を確認することで、切り捨てが発生したかどうかを判断できます。</span><span class="sxs-lookup"><span data-stu-id="4b733-140">The consumer can determine that truncation has occurred by checking for the status DBSTATUS_S_TRUNCATED.</span></span> <span data-ttu-id="4b733-141">返される長さは、常に、実際のバイト単位の長さなので、切り捨てられたデータ量も判断できます。</span><span class="sxs-lookup"><span data-stu-id="4b733-141">The returned length is always the true length in bytes, so that the consumer also can determine how much data was truncated.</span></span>  
  
 <span data-ttu-id="4b733-142">コンシューマーは行のフェッチまたは更新を終了するときに、**ReleaseRows** メソッドを使用して行を解放します。</span><span class="sxs-lookup"><span data-stu-id="4b733-142">When the consumer has finished fetching or updating rows, it releases them with the **ReleaseRows** method.</span></span> <span data-ttu-id="4b733-143">これにより、行セット内の行のコピーからリソースが解放され、新しい行の空き領域が確保されます。</span><span class="sxs-lookup"><span data-stu-id="4b733-143">This releases resources from the copy of the rows in the rowset and makes room for new rows.</span></span> <span data-ttu-id="4b733-144">その後、行のフェッチや作成、行データへのアクセスといったサイクルを繰り返すことができます。</span><span class="sxs-lookup"><span data-stu-id="4b733-144">The consumer can then repeat its cycle of fetching or creating rows and accessing the data in them.</span></span>  
  
 <span data-ttu-id="4b733-145">コンシューマーは行セットの操作を終了するときに、**IAccessor::ReleaseAccessor** メソッドを呼び出してアクセサーを解放します。</span><span class="sxs-lookup"><span data-stu-id="4b733-145">When the consumer is finished with the rowset, it calls the **IAccessor::ReleaseAccessor** method to release any accessor.</span></span> <span data-ttu-id="4b733-146">さらに、行セットが公開しているすべてのインターフェイスで **IUnknown::Release** メソッドを呼び出して、行セットを解放します。</span><span class="sxs-lookup"><span data-stu-id="4b733-146">It calls the **IUnknown::Release** method on all interfaces exposed by the rowset to release the rowset.</span></span> <span data-ttu-id="4b733-147">行セットが解放されると、コンシューマーが保持している残りの行やアクセサーも強制的に解放されます。</span><span class="sxs-lookup"><span data-stu-id="4b733-147">When the rowset is released, it forces the release of any remaining rows or accessors the consumer may hold.</span></span>  
  
## <a name="in-this-section"></a><span data-ttu-id="4b733-148">このセクションの内容</span><span class="sxs-lookup"><span data-stu-id="4b733-148">In This Section</span></span>  
  
-   [<span data-ttu-id="4b733-149">次のフェッチ位置</span><span class="sxs-lookup"><span data-stu-id="4b733-149">Next Fetch Position</span></span>](fetching-rows-next-fetch-position.md)  
  
## <a name="see-also"></a><span data-ttu-id="4b733-150">参照</span><span class="sxs-lookup"><span data-stu-id="4b733-150">See Also</span></span>  
 [<span data-ttu-id="4b733-151">行セット</span><span class="sxs-lookup"><span data-stu-id="4b733-151">Rowsets</span></span>](rowsets.md)  
  
  
