---
title: 復元シーケンスの計画と実行 (完全復旧モデル) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
helpviewer_keywords:
- restore sequences [SQL Server], planning for
- full recovery model [SQL Server], planning restore sequences
ms.assetid: 9cbefaf8-d2b6-41c9-83fc-b3807a841fe2
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 85558c0a6361837b5645b9fc38ad040254265d72
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87643440"
---
# <a name="plan-and-perform-restore-sequences-full-recovery-model"></a><span data-ttu-id="ac309-102">復元シーケンスの計画と実行 (完全復旧モデル)</span><span class="sxs-lookup"><span data-stu-id="ac309-102">Plan and Perform Restore Sequences (Full Recovery Model)</span></span>
  <span data-ttu-id="ac309-103">このトピックでは、主に完全復旧モデルが使用される [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] データベースの復元シーケンスを計画し、実行する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="ac309-103">This topic explains how to plan and perform a restore sequence for a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] databases that ordinarily uses the full recovery model.</span></span> <span data-ttu-id="ac309-104">*復元シーケンス* は、1 つ以上の連続した [RESTORE](/sql/t-sql/statements/restore-statements-transact-sql) ステートメントです。</span><span class="sxs-lookup"><span data-stu-id="ac309-104">A *restore sequence* is a sequence of one or more [RESTORE](/sql/t-sql/statements/restore-statements-transact-sql) statements.</span></span> <span data-ttu-id="ac309-105">通常、復元シーケンスでは、復元対象のデータベース、ファイル、ページのコンテンツの初期化 (データ コピー フェーズ)、ログに記録されたトランザクションのロールフォワード (再実行フェーズ)、コミットされていないトランザクションのロールバック (元に戻すフェーズ) が実行されます。</span><span class="sxs-lookup"><span data-stu-id="ac309-105">Typically, a restore sequences initializes the contents of the database, files, and/or pages being restored (the data-copy phase), rolls forward logged transactions (the redo phase), and rolls back uncommitted transactions (the undo phase).</span></span>  
  
 <span data-ttu-id="ac309-106">単純な復元シーケンスの場合、必要なのはデータベースの完全バックアップ、差分バックアップ、およびそれ以降のログ バックアップのみです。</span><span class="sxs-lookup"><span data-stu-id="ac309-106">In simple cases, a restore sequence requires only a full database backup, a differential database backup, and the subsequent log backups.</span></span> <span data-ttu-id="ac309-107">このような場合は、適切な復元シーケンスの構築は簡単です。</span><span class="sxs-lookup"><span data-stu-id="ac309-107">In these cases, constructing a correct restore sequence is easy.</span></span> <span data-ttu-id="ac309-108">たとえば、障害が発生した時点までデータベース全体を復元するには、まずアクティブなトランザクション ログ (ログの *末尾* ) をバックアップします。</span><span class="sxs-lookup"><span data-stu-id="ac309-108">For example, to restore a whole database to the point of a failure, start by backing up the active transaction log (the *tail* of the log).</span></span> <span data-ttu-id="ac309-109">次に、データベースの最新の完全バックアップ、最新の差分バックアップ (存在する場合) の順に復元してから、それ以降のすべてのログ バックアップを作成順に復元します。</span><span class="sxs-lookup"><span data-stu-id="ac309-109">Then, restore the most recent full database backup, the most recent differential backup (if any), and all subsequent log backups in the order in which they were taken.</span></span>  
  
 <span data-ttu-id="ac309-110">適切な復元シーケンスの構築がもっと複雑になる場合もあります。</span><span class="sxs-lookup"><span data-stu-id="ac309-110">In more complex cases, constructing a correct restore sequence can be a complex process.</span></span> <span data-ttu-id="ac309-111">たとえば、複数のファイル バックアップが必要になったり、特定の時点へのデータの復元が必要になる場合があります。</span><span class="sxs-lookup"><span data-stu-id="ac309-111">For example, a restore sequence might require multiple file backups or restoring data to a specific point in time.</span></span> <span data-ttu-id="ac309-112">非常に複雑な復元シーケンスでは、1 つ以上の復旧分岐にまたがる、分岐した復旧パスをたどることが必要になる場合もあります。</span><span class="sxs-lookup"><span data-stu-id="ac309-112">In very complex cases, you might even have to traverse a forked recovery path that spans one or more recovery forks.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="ac309-113">*復旧パス* は、データベースをある特定の時点 (復旧ポイント) の状態にするための、連続したデータおよびログ バックアップです。</span><span class="sxs-lookup"><span data-stu-id="ac309-113">A *recovery path* is the sequence of data and log backups that have brought a database to a particular point in time (known as a recovery point).</span></span> <span data-ttu-id="ac309-114">復旧パスは、データベースの一貫性を維持しつつ、その内容がどのような操作によって、時間の経過と共にどのように変化してきたかを具体的に表します。</span><span class="sxs-lookup"><span data-stu-id="ac309-114">A recovery path is a specific set of transformations that have evolved the database over time, yet have maintained the consistency of the database.</span></span> <span data-ttu-id="ac309-115">開始ポイント (LSN、GUID) から終了ポイント (LSN、GUID) までの一連の LSN が 1 つの復旧パスとなります。</span><span class="sxs-lookup"><span data-stu-id="ac309-115">A recovery path describes a range of LSNs from a start point (LSN,GUID) to an end point (LSN,GUID).</span></span> <span data-ttu-id="ac309-116">復旧パスの LSN は、開始ポイントから終了ポイントまですべてが 1 つの復旧ブランチに属する場合もあれば、複数の復旧ブランチに属する場合もあります。</span><span class="sxs-lookup"><span data-stu-id="ac309-116">The range of LSNs in a recovery path can traverse one or more recovery branches from start to end.</span></span>  
  
## <a name="to-plan-a-restore-sequence"></a><span data-ttu-id="ac309-117">復元シーケンスを計画するには</span><span class="sxs-lookup"><span data-stu-id="ac309-117">To Plan a Restore Sequence</span></span>  
 <span data-ttu-id="ac309-118">復元シーケンスを開始する前に、次の手順を実行します。</span><span class="sxs-lookup"><span data-stu-id="ac309-118">Before you start a restore sequence, follow these steps:</span></span>  
  
1.  <span data-ttu-id="ac309-119">データベースのログ末尾のバックアップを (作成できる場合は) 作成します。</span><span class="sxs-lookup"><span data-stu-id="ac309-119">Create a tail-log backup of the database, if you can.</span></span> <span data-ttu-id="ac309-120">詳細については、「[ログ末尾のバックアップ &#40;SQL Server&#41;](tail-log-backups-sql-server.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ac309-120">For more information, see [Tail-Log Backups &#40;SQL Server&#41;](tail-log-backups-sql-server.md).</span></span>  
  
2.  <span data-ttu-id="ac309-121">目的の復旧ポイントを決定します。</span><span class="sxs-lookup"><span data-stu-id="ac309-121">Determine the target recovery point.</span></span>  
  
     <span data-ttu-id="ac309-122">目的の復旧ポイントとして、トランザクション ログ バックアップ内の任意の時点またはマークを選択することができます。</span><span class="sxs-lookup"><span data-stu-id="ac309-122">The target recovery point can be any point in time or mark within a transaction log backup.</span></span> <span data-ttu-id="ac309-123">詳細については、「[SQL Server データベースを特定の時点に復元する &#40;完全復旧モデル&#41;](restore-a-sql-server-database-to-a-point-in-time-full-recovery-model.md)」または「[マークされたトランザクションを使用して関連するデータベースを一貫した状態に復元する方法 &#40;完全復旧モデル#41;](use-marked-transactions-to-recover-related-databases-consistently.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ac309-123">For more information, see [Restore a SQL Server Database to a Point in Time &#40;Full Recovery Model&#41;](restore-a-sql-server-database-to-a-point-in-time-full-recovery-model.md) or [Use Marked Transactions to Recover Related Databases Consistently &#40;Full Recovery Model&#41;](use-marked-transactions-to-recover-related-databases-consistently.md).</span></span>  
  
3.  <span data-ttu-id="ac309-124">実行する復元の種類を決定します。</span><span class="sxs-lookup"><span data-stu-id="ac309-124">Determine the type of restore you want to perform.</span></span> <span data-ttu-id="ac309-125">詳細については、「 [復元と復旧の概要 &#40;SQL Server&#41;](restore-and-recovery-overview-sql-server.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ac309-125">For more information, see [Restore and Recovery Overview &#40;SQL Server&#41;](restore-and-recovery-overview-sql-server.md).</span></span>  
  
4.  <span data-ttu-id="ac309-126">必要なバックアップを特定し、必要なメディア セットとバックアップ デバイスが使用可能であることを確認します。</span><span class="sxs-lookup"><span data-stu-id="ac309-126">Identify which backups you require and make sure that the necessary media sets and backup devices are available.</span></span> <span data-ttu-id="ac309-127">詳細については、「[バックアップ デバイス &#40;SQL Server&#41;](backup-devices-sql-server.md)」と「[メディア セット、メディア ファミリ、およびバックアップ セット &#40;SQL Server&#41;](media-sets-media-families-and-backup-sets-sql-server.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ac309-127">For more information, see [Backup Devices &#40;SQL Server&#41;](backup-devices-sql-server.md) and [Media Sets, Media Families, and Backup Sets &#40;SQL Server&#41;](media-sets-media-families-and-backup-sets-sql-server.md).</span></span>  
  
## <a name="to-perform-a-restore-sequence"></a><span data-ttu-id="ac309-128">復元シーケンスを実行するには</span><span class="sxs-lookup"><span data-stu-id="ac309-128">To Perform a Restore Sequence</span></span>  
 <span data-ttu-id="ac309-129">復元シーケンスを実行するには、次の手順を実行します。</span><span class="sxs-lookup"><span data-stu-id="ac309-129">To perform a restore sequence, follow these steps:</span></span>  
  
1.  <span data-ttu-id="ac309-130">シーケンスを開始するために、データベース バックアップ、部分バックアップ、1 つ以上のファイル バックアップなど、1 つ以上のデータ バックアップを復元します。</span><span class="sxs-lookup"><span data-stu-id="ac309-130">To start the sequence, restore a one or more data backups, such as: a database backup, a partial backup, one or more file backups.</span></span>  
  
2.  <span data-ttu-id="ac309-131">必要に応じて、これらの完全バックアップを基にした最新の差分バックアップを復元します。</span><span class="sxs-lookup"><span data-stu-id="ac309-131">Optionally, restore the latest differential backups that are based on these full backups.</span></span>  
  
     <span data-ttu-id="ac309-132">復元する各完全バックアップがいずれかの差分バックアップのベースであるかどうかを確認します。</span><span class="sxs-lookup"><span data-stu-id="ac309-132">For each full backup that you plan to restore, determine whether it is the base for any differential backups.</span></span> <span data-ttu-id="ac309-133">その場合は、最新の差分バックアップを (復元できる場合は) 復元します。</span><span class="sxs-lookup"><span data-stu-id="ac309-133">If so, restore most recent differential backup, if you can.</span></span> <span data-ttu-id="ac309-134">詳細については、「 [差分バックアップ &#40;SQL Server&#41;](differential-backups-sql-server.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ac309-134">For more information, see [Differential Backups &#40;SQL Server&#41;](differential-backups-sql-server.md).</span></span>  
  
3.  <span data-ttu-id="ac309-135">ログ バックアップを順番に復元することによって、データベースをロールフォワードします。最後に復旧ポイントを含むログ バックアップを復元します。</span><span class="sxs-lookup"><span data-stu-id="ac309-135">Roll forward the database by restoring log backups in sequence, finishing with the backup that contains the recovery point.</span></span> <span data-ttu-id="ac309-136">すべてのログ バックアップを適用する必要があるかどうかは、どのログ バックアップに目的の復旧ポイントが含まれているかによって、次のように異なります。</span><span class="sxs-lookup"><span data-stu-id="ac309-136">Whether you have to apply all the log backups depends on what log backup contains the target recovery point, as follows:</span></span>  
  
    -   <span data-ttu-id="ac309-137">復旧ポイントが障害の発生時点である場合は、最後に復元したデータ バックアップ (完全バックアップまたは差分バックアップ) 以降に作成されたすべてのログ バックアップを復元する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ac309-137">If the recovery point is the point of a failure, you must restore every log backup that was created since the last data (full or differential) backup you restored.</span></span> <span data-ttu-id="ac309-138">詳細については、「[トランザクション ログ バックアップの適用 &#40;SQL Server&#41;](transaction-log-backups-sql-server.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ac309-138">For more information, see [Apply Transaction Log Backups &#40;SQL Server&#41;](transaction-log-backups-sql-server.md).</span></span>  
  
    -   <span data-ttu-id="ac309-139">特定の時点への復元の場合は、最新のログ バックアップを復元する必要がないことがあります。</span><span class="sxs-lookup"><span data-stu-id="ac309-139">For a point-in-time restore, you might not require the most recent log backups.</span></span> <span data-ttu-id="ac309-140">[!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]を使用する場合、データベース復旧アドバイザーによって、指定された時点に復元するために必要なバックアップだけが選択されます。</span><span class="sxs-lookup"><span data-stu-id="ac309-140">If you use [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], the Database Recovery Advisor ensures that only backups that are required to restore to your specified point in time are selected.</span></span> <span data-ttu-id="ac309-141">これらのバックアップは、特定の時点への復元用として推奨される復元プランを示しています。</span><span class="sxs-lookup"><span data-stu-id="ac309-141">These backups make up the recommended restore plan for your point-in-time restore.</span></span> <span data-ttu-id="ac309-142">詳細については、「[SQL Server データベースを特定の時点に復元する &#40;完全復旧モデル&#41;](restore-a-sql-server-database-to-a-point-in-time-full-recovery-model.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ac309-142">For more information, see [Restore a SQL Server Database to a Point in Time &#40;Full Recovery Model&#41;](restore-a-sql-server-database-to-a-point-in-time-full-recovery-model.md).</span></span>  
  
## <a name="restarting-a-restore-sequence"></a><span data-ttu-id="ac309-143">復元シーケンスの再実行</span><span class="sxs-lookup"><span data-stu-id="ac309-143">Restarting a Restore Sequence</span></span>  
 <span data-ttu-id="ac309-144">復元シーケンスの結果に問題がある場合、復元シーケンスを停止し、最初から再実行することができます。</span><span class="sxs-lookup"><span data-stu-id="ac309-144">If you encounter a problem with the outcome of a restore sequence, you can quit it and restart the restore sequence over from the start.</span></span> <span data-ttu-id="ac309-145">たとえば、誤ってログ バックアップを多く復元しすぎて、目的の復旧ポイントを超えてしまった場合は、目的の復旧ポイントを含むログ バックアップまでの復元シーケンスを再実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ac309-145">For example, if you accidentally restore too many log backups and overshoot the intended recovery point, you must restart the restore sequence up to log backup that contains the target recovery point.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="ac309-146">参照</span><span class="sxs-lookup"><span data-stu-id="ac309-146">See Also</span></span>  
 <span data-ttu-id="ac309-147">[バックアップの概要 &#40;SQL Server&#41;](backup-overview-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="ac309-147">[Backup Overview &#40;SQL Server&#41;](backup-overview-sql-server.md) </span></span>  
 <span data-ttu-id="ac309-148">[復元と復旧の概要 &#40;SQL Server&#41;](restore-and-recovery-overview-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="ac309-148">[Restore and Recovery Overview &#40;SQL Server&#41;](restore-and-recovery-overview-sql-server.md) </span></span>  
 <span data-ttu-id="ac309-149">[データベースの全体復元 &#40;完全復旧モデル&#41;](complete-database-restores-full-recovery-model.md) </span><span class="sxs-lookup"><span data-stu-id="ac309-149">[Complete Database Restores &#40;Full Recovery Model&#41;](complete-database-restores-full-recovery-model.md) </span></span>  
 <span data-ttu-id="ac309-150">[Online Restore &#40;SQL Server&#41;](online-restore-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="ac309-150">[Online Restore &#40;SQL Server&#41;](online-restore-sql-server.md) </span></span>  
 <span data-ttu-id="ac309-151">[ファイルの復元 &#40;完全復旧モデル&#41;](file-restores-full-recovery-model.md) </span><span class="sxs-lookup"><span data-stu-id="ac309-151">[File Restores &#40;Full Recovery Model&#41;](file-restores-full-recovery-model.md) </span></span>  
 <span data-ttu-id="ac309-152">[ページ復元 &#40;SQL Server&#41;](restore-pages-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="ac309-152">[Restore Pages &#40;SQL Server&#41;](restore-pages-sql-server.md) </span></span>  
 [<span data-ttu-id="ac309-153">段階的な部分復元 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="ac309-153">Piecemeal Restores &#40;SQL Server&#41;</span></span>](piecemeal-restores-sql-server.md)  
  
  
