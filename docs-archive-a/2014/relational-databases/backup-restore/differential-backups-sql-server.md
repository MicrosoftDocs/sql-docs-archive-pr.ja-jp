---
title: 差分バックアップ (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
helpviewer_keywords:
- differential backups
- differential backups, about
ms.assetid: 123bb7af-1367-4bde-bfcb-76d36799b905
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 5c057e0d41cb46adef0ec1e01c3406190db900e4
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87644486"
---
# <a name="differential-backups-sql-server"></a><span data-ttu-id="6a4dc-102">差分バックアップ (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="6a4dc-102">Differential Backups (SQL Server)</span></span>
  <span data-ttu-id="6a4dc-103">このトピックで取り上げるバックアップと復元は、すべての [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] データベースに当てはまります。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-103">This backup and restore topic is relevant for all [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] databases.</span></span>  
  
 <span data-ttu-id="6a4dc-104">差分バックアップは、直近の完全データ バックアップに基づきます。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-104">A differential backup is based on the most recent, previous full data backup.</span></span> <span data-ttu-id="6a4dc-105">差分バックアップでは、その完全バックアップの作成後に変更されたデータのみがキャプチャされます。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-105">A differential backup captures only the data that has changed since that full backup.</span></span> <span data-ttu-id="6a4dc-106">差分バックアップの基になる完全バックアップを差分の *ベース* といいます。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-106">The full backup upon which a differential backup is based is known as the *base* of the differential.</span></span> <span data-ttu-id="6a4dc-107">完全バックアップ (コピーのみのバックアップを除く) は、データベース バックアップ、部分バックアップ、ファイル バックアップなど、一連の差分バックアップのベースとなります。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-107">Full backups, except for copy-only backups, can serve as the base for a series of differential backups, including database backups, partial backups, and file backups.</span></span> <span data-ttu-id="6a4dc-108">ファイルの差分バックアップのベース バックアップは、完全バックアップ、ファイル バックアップ、または部分バックアップ内に格納できます。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-108">The base backup for a file differential backup can be contained within a full backup, a file backup, or a partial backup.</span></span>  
  
  
##  <a name="benefits"></a><a name="Benefits"></a> <span data-ttu-id="6a4dc-109">利点</span><span class="sxs-lookup"><span data-stu-id="6a4dc-109">Benefits</span></span>  
  
-   <span data-ttu-id="6a4dc-110">完全バックアップを作成するときと比べて、差分バックアップはきわめて短時間で作成できます。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-110">Creating a differential backups can be very fast compared to creating a full backup.</span></span> <span data-ttu-id="6a4dc-111">差分バックアップでは、差分バックアップのベースとなる完全バックアップ以降に変更されたデータのみが記録されます。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-111">A differential backup records only the data that has changed since the full backup upon the differential backup is based.</span></span> <span data-ttu-id="6a4dc-112">そのため、データのバックアップを頻繁に作成することができ、データ損失のリスクが軽減されます。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-112">This facilitates taking frequent data backups, which decrease the risk of data loss.</span></span> <span data-ttu-id="6a4dc-113">ただし、差分バックアップを復元するには、先に差分ベースを復元しておく必要があります。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-113">However, before you restore a differential backup, you must restore its base.</span></span> <span data-ttu-id="6a4dc-114">2 つのバックアップ ファイルが必要となるため、差分バックアップを復元するときは、完全バックアップを復元するときと比べて、より多くの手間と時間がかかります。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-114">Therefore restoring from a differential backup will necessarily take more steps and time than restoring from a full backup because two backup files are required.</span></span>  
  
-   <span data-ttu-id="6a4dc-115">データベースの差分バックアップは、データベースのある部分が他の部分よりも頻繁に変更される場合に特に役立ちます。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-115">Differential database backups are especially useful if a subset of a database is modified more frequently than the rest of the database.</span></span> <span data-ttu-id="6a4dc-116">そのような場合にデータベースの差分バックアップを使用すると、完全バックアップのオーバーヘッドをかけることなく頻繁にバックアップを行うことが可能になります。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-116">In these cases, differential database backups enable you back up frequently without the overhead of full database backups.</span></span>  
  
-   <span data-ttu-id="6a4dc-117">完全復旧モデルでは、差分バックアップを使用することによって、復元する必要のあるログ バックアップの数を減らすことができます。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-117">Under the full recovery model, using differential backups can reduce the number of log backups that you have to restore.</span></span>  
  
##  <a name="overview-of-differential-backups"></a><a name="Overview"></a> <span data-ttu-id="6a4dc-118">差分バックアップの概要</span><span class="sxs-lookup"><span data-stu-id="6a4dc-118">Overview of Differential Backups</span></span>  
 <span data-ttu-id="6a4dc-119">差分バックアップは、差分ベースが作成されてから差分バックアップが作成されるまでの間に変更されたすべての *エクステント* (物理的に連続する 8 ページ分のまとまり) の状態をキャプチャします。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-119">A differential backup captures the state of any *extents* (collections of eight physically contiguous pages) that have changed between when the differential base was created and the when differential backup is created.</span></span> <span data-ttu-id="6a4dc-120">したがって、差分バックアップのサイズは、ベースの作成後に変更されたデータの量に依存します。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-120">This means that the size of a given differential backup depends on the amount of data that has changed since the base.</span></span> <span data-ttu-id="6a4dc-121">通常、ベースが古いほど、新しい差分バックアップの量は多くなります。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-121">Generally, the older a base is, the larger a new differential backup will be.</span></span> <span data-ttu-id="6a4dc-122">一連の差分バックアップにおいて、更新頻度の高いエクステントは、差分バックアップごとに異なるデータを格納している可能性が高くなります。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-122">In a series of differential backups, a frequently updated extent is likely to contain different data in each differential backup.</span></span>  
  
 <span data-ttu-id="6a4dc-123">次の図に差分バックアップの動作を示します。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-123">The following illustration shows how a differential backup works.</span></span> <span data-ttu-id="6a4dc-124">この図では、24 個のデータ エクステントがあり、そのうちの 6 個が変更されています。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-124">The figure shows 24 data extents, 6 of which have changed.</span></span> <span data-ttu-id="6a4dc-125">差分バックアップには、これら 6 個のデータ エクステントのみが含まれます。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-125">The differential backup contains only these 6 data extents.</span></span> <span data-ttu-id="6a4dc-126">差分バックアップ操作は、エクステントごとに 1 つのビットを含むビットマップ ページに依存します。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-126">The differential backup operation relies on a bitmap page that contains a bit for every extent.</span></span> <span data-ttu-id="6a4dc-127">ベース以降に更新されたエクステントそれぞれにつき、ビットマップ内のビットが 1 に設定されます。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-127">For each extent updated since the base, the bit is set to 1 in the bitmap.</span></span>  
  
 <span data-ttu-id="6a4dc-128">![差分ビットマップでの変更されたエクステントの識別](../../database-engine/media/bnr-how-diff-backups-work.gif "差分ビットマップでの変更されたエクステントの識別")</span><span class="sxs-lookup"><span data-stu-id="6a4dc-128">![Differential bitmap identifies changed extents](../../database-engine/media/bnr-how-diff-backups-work.gif "Differential bitmap identifies changed extents")</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="6a4dc-129">コピーのみのバックアップを実行しても、差分ビットマップは更新されません。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-129">The differential bitmap is not updated by a copy-only backup.</span></span> <span data-ttu-id="6a4dc-130">したがって、コピーのみのバックアップを実行しても、それ以降の差分バックアップに影響はありません。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-130">Therefore, a copy-only backup does not affect subsequent differential backups.</span></span>  
  
 <span data-ttu-id="6a4dc-131">通常、差分ベースの直後に作成された差分バックアップは、差分ベースよりも大幅に小さくなります。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-131">A differential backup that is taken fairly soon after its base is usually significantly smaller than the differential base.</span></span> <span data-ttu-id="6a4dc-132">そのため、ストレージ領域とバックアップ時間が節約されます。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-132">This saves storage space and backup time.</span></span> <span data-ttu-id="6a4dc-133">一方、データベースは時間の経過と共に変化するため、データベースと個々の差分ベースの間の差分は大きくなっていきます。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-133">However, as a database changes over time, the difference between the database and a specific differential base increases.</span></span> <span data-ttu-id="6a4dc-134">差分バックアップとそのベースの間の時間が長くなればなるほど、差分バックアップが大きくなる可能性が高くなります。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-134">The longer the time between a differential backup and its base, the larger the differential backup is likely to be.</span></span> <span data-ttu-id="6a4dc-135">これは、最終的には差分バックアップが差分ベースのサイズにほぼ等しくなる可能性があることを意味しています。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-135">This means that the differential backups can eventually approach the differential base in size.</span></span> <span data-ttu-id="6a4dc-136">差分バックアップが大きくなると、高速で小さなバックアップの利点が失われます。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-136">A large differential backup loses the advantages of a faster and smaller backup.</span></span>  
  
 <span data-ttu-id="6a4dc-137">差分バックアップのサイズが大きくなると、データベースを復元するときに、差分バックアップの復元に要する時間がかなり長くなる場合があります。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-137">As the differential backups increase in size, restoring a differential backup can significantly increase the time that is required to restore a database.</span></span> <span data-ttu-id="6a4dc-138">このため、定期的に新しい完全バックアップを実行することにより、データの新しい差分ベースを作成することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-138">Therefore, we recommend that you take a new full backup at set intervals to establish a new differential base for the data.</span></span> <span data-ttu-id="6a4dc-139">たとえば、データベース全体のバックアップ (つまり、データベースの完全バックアップ) を週に 1 回実行し、次の週の完全バックアップまでの間、一連のデータベースの差分バックアップを定期的に実行します。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-139">For example, you might take a weekly full backup of the whole database (that is, a full database backup) followed by a regular series of differential database backups during the week.</span></span>  
  
 <span data-ttu-id="6a4dc-140">復元時には、差分バックアップを復元する前に、ベースを復元する必要があります。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-140">At restore time, before you restore a differential backup, you must restore its base.</span></span> <span data-ttu-id="6a4dc-141">次に、最新の差分バックアップのみを復元して、データベースをその差分バックアップが作成されたときの状態にします。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-141">Then, restore only the most recent differential backup to bring the database forward to the time when that differential backup was created.</span></span> <span data-ttu-id="6a4dc-142">通常は、最新の完全バックアップを復元してから、その完全バックアップを基にした最新の差分バックアップを復元します。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-142">Typically, you would restore the most recent full backup followed by the most recent differential backup that is based on that full backup.</span></span>  
  
## <a name="differential-backups-of-databases-with-memory-optimized-tables"></a><span data-ttu-id="6a4dc-143">メモリ最適化テーブルを含むデータベースの差分バックアップ</span><span class="sxs-lookup"><span data-stu-id="6a4dc-143">Differential Backups of Databases with Memory-Optimized Tables</span></span>  
 <span data-ttu-id="6a4dc-144">差分バックアップおよびメモリ最適化テーブルを含むデータベースの詳細については、「 [メモリ最適化テーブルが含まれるデータベースのバックアップ](../in-memory-oltp/memory-optimized-tables.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-144">For information about differential backups and databases with memory-optimized tables, see [Backing Up a Database with Memory-Optimized Tables](../in-memory-oltp/memory-optimized-tables.md).</span></span>  
  
##  <a name="differential-backups-of-read-only-databases"></a><a name="ReadOnlyDbs"></a> <span data-ttu-id="6a4dc-145">読み取り専用データベースの差分バックアップ</span><span class="sxs-lookup"><span data-stu-id="6a4dc-145">Differential Backups of Read-Only Databases</span></span>  
 <span data-ttu-id="6a4dc-146">読み取り専用データベースの場合は、完全バックアップと差分バックアップを組み合わせて使用するよりも、完全バックアップを単独で使用する方が管理が容易になります。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-146">For read-only databases, full backups used alone are easier to manage than when they are used with differential backups.</span></span> <span data-ttu-id="6a4dc-147">データベースが読み取り専用の場合は、ファイルに含まれるメタデータをバックアップやその他の操作で変更することはできません。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-147">When a database is read-only, backup and other operations cannot change the metadata that is contained in the file.</span></span> <span data-ttu-id="6a4dc-148">このため、差分バックアップに必要な、差分バックアップを開始するログ シーケンス番号 (差分のベース LSN) などのメタデータは **master** データベースに格納されます。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-148">Therefore, metadata that is required by a differential backup, such as the log sequence number at which the differential backup begins (the differential base LSN) is stored in the **master** database.</span></span> <span data-ttu-id="6a4dc-149">データベースが読み取り専用のときに差分ベースを作成した場合、ベース バックアップ以降に実際に発生した変更よりも多くの変更内容が差分ビットマップに示されます。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-149">If the differential base is taken when the database is read-only, the differential bitmap indicates more changes than have actually occurred since the base backup.</span></span> <span data-ttu-id="6a4dc-150">**backupset** システム テーブルに格納されている [differential_base_lsn](/sql/relational-databases/system-tables/backupset-transact-sql) は、ベースの作成以降にデータが実際に変更されたかどうかの判断に使用されるため、この余分なデータは読み取られますが、バックアップには書き込まれません。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-150">The extra data is read by backup, but is not written to the backup, because the **differential_base_lsn** stored in the [backupset](/sql/relational-databases/system-tables/backupset-transact-sql) system table is used to determine whether the data has actually changed since the base.</span></span>  
  
 <span data-ttu-id="6a4dc-151">読み取り専用データベースの再構築、復元、またはデタッチとアタッチが行われると、差分ベースの情報が失われます。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-151">When a read-only database is rebuilt, restored, or detached and attached, the differential-base information is lost.</span></span> <span data-ttu-id="6a4dc-152">このことは、 **master** データベースがユーザー データベースと同期されないために発生します。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-152">This occurs because the **master** database is not synchronized with the user database.</span></span> <span data-ttu-id="6a4dc-153">[!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] で、この問題を検出または防止することはできません。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-153">The [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] cannot detect or prevent this problem.</span></span> <span data-ttu-id="6a4dc-154">以降の差分バックアップはどれも、最新の完全バックアップに基づいていないことになり、予期しない結果になる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-154">Any later differential backups are not based on the most recent full backup and could provide unexpected results.</span></span> <span data-ttu-id="6a4dc-155">新しい差分ベースを確立するには、データベースの完全バックアップを作成することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-155">To establish a new differential base, we recommend that you create a full database backup.</span></span>  
  
### <a name="best-practices-for-using-differential-backups-with-a-read-only-database"></a><span data-ttu-id="6a4dc-156">読み取り専用データベースで差分バックアップを使用する場合のベスト プラクティス</span><span class="sxs-lookup"><span data-stu-id="6a4dc-156">Best Practices for Using Differential Backups with a Read-Only Database</span></span>  
 <span data-ttu-id="6a4dc-157">読み取り専用データベースの完全バックアップを作成した後、引き続き差分バックアップを作成することを予定している場合は、 **master** データベースをバックアップします。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-157">After you create a full database backup of a read-only database, if you intend to create a subsequent differential backup, back up the **master** database.</span></span>  
  
 <span data-ttu-id="6a4dc-158">**master** データベースが失われた場合は、まず、このデータベースを復元してから、ユーザー データベースの任意の差分バックアップを復元します。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-158">If the **master** database is lost, restore it before you restore any differential backup of a user database.</span></span>  
  
 <span data-ttu-id="6a4dc-159">後から差分バックアップを使用する予定があり、読み取り専用データベースのデタッチとアタッチを行う場合は、可能な限り早い時点で、読み取り専用データベースと **master** データベースの両方の完全バックアップを実行します。</span><span class="sxs-lookup"><span data-stu-id="6a4dc-159">If you detach and attach a read-only database for which you plan to later use differential backups, as soon as it is practical, take a full database backup of both the read-only database and of the **master** database.</span></span>  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="6a4dc-160">関連タスク</span><span class="sxs-lookup"><span data-stu-id="6a4dc-160">Related Tasks</span></span>  
  
-   [<span data-ttu-id="6a4dc-161">データベースの差分バックアップの作成 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="6a4dc-161">Create a Differential Database Backup &#40;SQL Server&#41;</span></span>](create-a-differential-database-backup-sql-server.md)  
  
-   [<span data-ttu-id="6a4dc-162">データベースの差分バックアップの復元 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="6a4dc-162">Restore a Differential Database Backup &#40;SQL Server&#41;</span></span>](restore-a-differential-database-backup-sql-server.md)  
  
  
## <a name="see-also"></a><span data-ttu-id="6a4dc-163">参照</span><span class="sxs-lookup"><span data-stu-id="6a4dc-163">See Also</span></span>  
 <span data-ttu-id="6a4dc-164">[バックアップの概要 &#40;SQL Server&#41;](backup-overview-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="6a4dc-164">[Backup Overview &#40;SQL Server&#41;](backup-overview-sql-server.md) </span></span>  
 <span data-ttu-id="6a4dc-165">[データベースの完全バックアップ &#40;SQL Server&#41;](full-database-backups-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="6a4dc-165">[Full Database Backups &#40;SQL Server&#41;](full-database-backups-sql-server.md) </span></span>  
 <span data-ttu-id="6a4dc-166">[データベースの全体復元 &#40;完全復旧モデル&#41;](complete-database-restores-full-recovery-model.md) </span><span class="sxs-lookup"><span data-stu-id="6a4dc-166">[Complete Database Restores &#40;Full Recovery Model&#41;](complete-database-restores-full-recovery-model.md) </span></span>  
 <span data-ttu-id="6a4dc-167">[データベースの全体復元 &#40;単純復旧モデル&#41;](complete-database-restores-simple-recovery-model.md) </span><span class="sxs-lookup"><span data-stu-id="6a4dc-167">[Complete Database Restores &#40;Simple Recovery Model&#41;](complete-database-restores-simple-recovery-model.md) </span></span>  
 [<span data-ttu-id="6a4dc-168">トランザクション ログのバックアップ &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="6a4dc-168">Transaction Log Backups &#40;SQL Server&#41;</span></span>](transaction-log-backups-sql-server.md)  
  
  
