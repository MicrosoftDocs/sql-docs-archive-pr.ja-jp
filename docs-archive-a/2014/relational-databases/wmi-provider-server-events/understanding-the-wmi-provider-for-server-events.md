---
title: WMI Provider for Server Events についてMicrosoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: wmi
ms.topic: reference
helpviewer_keywords:
- architecture [WMI]
- SQL Server Agent [WMI]
- WMI Provider for Server Events, about WMI Provider for Server Events
ms.assetid: 8fd7bd18-76d0-4b28-8fee-8ad861441ab2
author: CarlRabeler
ms.author: carlrab
ms.openlocfilehash: ef583d479e473b6f5e71fef59f2221697248b45f
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87739636"
---
# <a name="understanding-the-wmi-provider-for-server-events"></a><span data-ttu-id="c64f2-102">WMI Provider for Server Events について</span><span class="sxs-lookup"><span data-stu-id="c64f2-102">Understanding the WMI Provider for Server Events</span></span>
  <span data-ttu-id="c64f2-103">WMI Provider for Server Events を使用すれば、Windows Management Instrumentation (WMI) を使用して [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]のイベントを監視できます。</span><span class="sxs-lookup"><span data-stu-id="c64f2-103">The WMI Provider for Server Events lets you use the Windows Management Instrumentation (WMI) to monitor events in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="c64f2-104">このプロバイダーは、[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] を WMI マネージド オブジェクトに変えることによって機能します。</span><span class="sxs-lookup"><span data-stu-id="c64f2-104">The provider works by turning [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] into a managed WMI object.</span></span> <span data-ttu-id="c64f2-105">このプロバイダーを使用することにより、[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] でイベント通知を生成できるイベントはすべて、WMI で利用できるようになります。</span><span class="sxs-lookup"><span data-stu-id="c64f2-105">Any event that can generate an event notification in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] can be leveraged by the WMI by using this provider.</span></span> <span data-ttu-id="c64f2-106">さらに、WMI と連動する管理アプリケーションとして、[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] エージェントがそのイベントに応答できるので、[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] エージェントで対応できるイベントのスコープが以前のリリースより広くなります。</span><span class="sxs-lookup"><span data-stu-id="c64f2-106">Additionally, as a management application that interacts with the WMI, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent can respond to these events, increasing the scope of events covered by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent over earlier releases.</span></span>

 <span data-ttu-id="c64f2-107">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] エージェントなどの管理アプリケーションは、WQL (WMI Query Language) ステートメントを実行することで WMI Provider for Server Events を使用して、[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] イベントにアクセスすることができます。</span><span class="sxs-lookup"><span data-stu-id="c64f2-107">Management applications such as [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent can access [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] events using the WMI Provider for Server Events by issuing WMI Query Language (WQL) statements.</span></span> <span data-ttu-id="c64f2-108">WQL は、WMI 特有の拡張機能を複数持つ、構造化照会言語 (SQL) の単純化されたサブセットです。</span><span class="sxs-lookup"><span data-stu-id="c64f2-108">WQL is a simplified subset of structured query language (SQL), with some WMI-specific extensions.</span></span> <span data-ttu-id="c64f2-109">WQL を使用した場合、アプリケーションは特定のデータベースまたはデータベース オブジェクトに対してイベントの種類を取得します。</span><span class="sxs-lookup"><span data-stu-id="c64f2-109">In using WQL, an application retrieves an event type against a specific database or database object.</span></span> <span data-ttu-id="c64f2-110">WMI Provider for Server Events は、クエリをイベント通知に変換し、対象データベース内のイベント通知を効率的に作成します。</span><span class="sxs-lookup"><span data-stu-id="c64f2-110">The WMI Provider for Server Events translates the query into an event notification, effectively creating an event notification in the target database.</span></span> <span data-ttu-id="c64f2-111">でのイベント通知の動作の詳細について [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] は、「 [WMI Provider For Server Events の概念](https://technet.microsoft.com/library/ms180560.aspx)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c64f2-111">For more information about how event notifications work in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], see [WMI Provider for Server Events Concepts](https://technet.microsoft.com/library/ms180560.aspx).</span></span> <span data-ttu-id="c64f2-112">クエリ可能なイベントは、「 [WMI Provider For Server events のクラスとプロパティ](../../relational-databases/wmi-provider-server-events/wmi-provider-for-server-events-classes-and-properties.md)」に記載されています。</span><span class="sxs-lookup"><span data-stu-id="c64f2-112">The events that can be queried are listed in [WMI Provider for Server Events Classes and Properties](../../relational-databases/wmi-provider-server-events/wmi-provider-for-server-events-classes-and-properties.md).</span></span>

 <span data-ttu-id="c64f2-113">イベント通知をトリガーしてメッセージを送信するイベントが発生すると、メッセージは、 **SQL/notification/Processの Eventprovidernotification/** v1.0 という名前の**msdb**内の定義済みの対象サービスに送られます。</span><span class="sxs-lookup"><span data-stu-id="c64f2-113">When an event occurs that triggers the event notification to send a message, the message goes to a predefined target service in **msdb** that is named **SQL/Notifications/ProcessWMIEventProviderNotification/v1.0**.</span></span> <span data-ttu-id="c64f2-114">サービスは、このイベントを、" **wmi**" という名前の**msdb**内の定義済みキューに配置します。</span><span class="sxs-lookup"><span data-stu-id="c64f2-114">The service puts the event into a predefined queue in **msdb** that is named **WMIEventProviderNotificationQueue**.</span></span> <span data-ttu-id="c64f2-115">(サービスとキューの両方が、に最初に接続したときにプロバイダーによって動的に作成され [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ます)。次に、プロバイダーはこのキューからイベントデータを読み取り、それをマネージオブジェクト形式 (MOF) に変換してからアプリケーションに返します。</span><span class="sxs-lookup"><span data-stu-id="c64f2-115">(Both the service and the queue are created dynamically by the provider when it first connects to [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].) The provider then reads the event data from this queue and transforms it into managed object format (MOF) before returning it to the application.</span></span> <span data-ttu-id="c64f2-116">次に、このプロセスの図を示します。</span><span class="sxs-lookup"><span data-stu-id="c64f2-116">The following illustration shows this process.</span></span>

 <span data-ttu-id="c64f2-117">![サーバー イベントの WMI プロバイダーのフロー図](../../../2014/database-engine/dev-guide/media/wmi-provider-functional-spec.gif "サーバー イベントの WMI プロバイダーのフロー図")</span><span class="sxs-lookup"><span data-stu-id="c64f2-117">![Flow diagram of the WMI Provider for Server Events](../../../2014/database-engine/dev-guide/media/wmi-provider-functional-spec.gif "Flow diagram of the WMI Provider for Server Events")</span></span>

 <span data-ttu-id="c64f2-118">たとえば、次の WQL クエリについて考えてみます。</span><span class="sxs-lookup"><span data-stu-id="c64f2-118">For example, consider the following WQL Query:</span></span>

```
SELECT * FROM DDL_DATABASE_LEVEL_EVENTS
WHERE DatabaseName = 'AdventureWorks'
```

 <span data-ttu-id="c64f2-119">このクエリに応答して、WMI Provider for Server Events は、対象データベース内に同等のイベント通知を作成します。</span><span class="sxs-lookup"><span data-stu-id="c64f2-119">In response to this query, the WMI Provider for Server Events creates the equivalent event notification in the target database:</span></span>

```
USE AdventureWorks ;
GO
CREATE EVENT NOTIFICATION SQLWEP_76CF38C1_18BB_42DD_A7DC_C8820155B0E9
    ON DATABASE
    WITH FAN_IN
    FOR DDL_DATABASE_LEVEL_EVENTS
    TO SERVICE
        'SQL/Notifications/ProcessWMIEventProviderNotification/v1.0', 
        'A7E5521A-1CA6-4741-865D-826F804E5135';
GO
```

 <span data-ttu-id="c64f2-120">この例では、`SQLWEP_76CF38C1_18BB_42DD_A7DC_C8820155B0E9` は、プレフィックス `SQLWEP_` と GUID から構成される [!INCLUDE[tsql](../../includes/tsql-md.md)] 識別子です。</span><span class="sxs-lookup"><span data-stu-id="c64f2-120">In this example, `SQLWEP_76CF38C1_18BB_42DD_A7DC_C8820155B0E9` is a [!INCLUDE[tsql](../../includes/tsql-md.md)] identifier that is made up of the prefix `SQLWEP_` and a GUID.</span></span> <span data-ttu-id="c64f2-121">`SQLWEP` は、各識別子に対して新しい GUID を作成します。</span><span class="sxs-lookup"><span data-stu-id="c64f2-121">`SQLWEP` creates a new GUID for each identifier.</span></span> <span data-ttu-id="c64f2-122">句の値 `A7E5521A-1CA6-4741-865D-826F804E5135` `TO SERVICE` は、 **msdb**データベース内のブローカーインスタンスを識別する GUID です。</span><span class="sxs-lookup"><span data-stu-id="c64f2-122">The value `A7E5521A-1CA6-4741-865D-826F804E5135` in the `TO SERVICE` clause is the GUID that identifies the broker instance in the **msdb** database.</span></span>

 <span data-ttu-id="c64f2-123">WQL の使用方法の詳細については、「 [WMI Provider For Server Events での wql の使用](https://technet.microsoft.com/library/ms180524\(v=sql.105\).aspx)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c64f2-123">For more information about how to work with WQL, see [Using WQL with the WMI Provider for Server Events](https://technet.microsoft.com/library/ms180524\(v=sql.105\).aspx).</span></span>

 <span data-ttu-id="c64f2-124">管理アプリケーションは、プロバイダーによって定義された WMI 名前空間に接続することで、WMI Provider for Server Events を [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] のインスタンスにダイレクトします。</span><span class="sxs-lookup"><span data-stu-id="c64f2-124">Management applications direct the WMI Provider for Server Events to an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] by connecting to a WMI namespace that is defined by the provider.</span></span> <span data-ttu-id="c64f2-125">Windows WMI サービスは、この名前空間をプロバイダー DLL である Sqlwep.dll にマップし、これをメモリに読み込みます。</span><span class="sxs-lookup"><span data-stu-id="c64f2-125">The Windows WMI service maps this namespace to the provider DLL, Sqlwep.dll, and loads it into memory.</span></span> <span data-ttu-id="c64f2-126">プロバイダーは、の各インスタンスについて、サーバーイベントの WMI 名前空間を管理します [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 。形式は次のとおりです \\ \\ 。 \\*root*\Microsoft\SqlServer\ServerEvents \\ *instance_name*。既定では、 *instance_name* MSSQLSERVER になります。</span><span class="sxs-lookup"><span data-stu-id="c64f2-126">The provider manages a WMI namespace for Server Events for each instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], and the format is: \\\\.\\*root*\Microsoft\SqlServer\ServerEvents\\*instance_name*, where *instance_name* defaults to MSSQLSERVER.</span></span> <span data-ttu-id="c64f2-127">のインスタンスの WMI 名前空間に接続する方法の詳細については [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 、「 [wmi Provider For Server Events での WQL の使用](https://technet.microsoft.com/library/ms180524\(v=sql.105\).aspx)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c64f2-127">For more information about how to connect to a WMI namespace for an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], see [Using WQL with the WMI Provider for Server Events](https://technet.microsoft.com/library/ms180524\(v=sql.105\).aspx).</span></span>

 <span data-ttu-id="c64f2-128">プロバイダー DLL である Sqlwep.dll は、サーバー上にある [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] のインスタンスの数にかかわらず、サーバーのオペレーティング システムの WMI ホスト サービスに一度だけ読み込まれます。</span><span class="sxs-lookup"><span data-stu-id="c64f2-128">The provider DLL, Sqlwep.dll, is loaded only one time into the WMI host service of the operating system of the server, regardless of how many instances of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] are on the server.</span></span>

 <span data-ttu-id="c64f2-129">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]Wmi provider for Server events を使用するエージェント管理アプリケーションの例については、「[サンプル: wmi Provider For Server Events を使用した SQL Server エージェントアラートの作成](https://technet.microsoft.com/library/ms186385.aspx)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c64f2-129">For an example of a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent management application that uses the WMI Provider for Server Events, see [Sample: Creating a SQL Server Agent Alert Using the WMI Provider for Server Events](https://technet.microsoft.com/library/ms186385.aspx).</span></span> <span data-ttu-id="c64f2-130">WMI Provider for Server Events をマネージコードで使用する管理アプリケーションの例については、「[サンプル: マネージコードでの Wmi イベントプロバイダーの使用](https://technet.microsoft.com/library/ms179315.aspx)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c64f2-130">For an example of a management application that uses the WMI Provider for Server Events in managed code, see [Sample: Using the WMI Event Provider in Managed Code](https://technet.microsoft.com/library/ms179315.aspx).</span></span> <span data-ttu-id="c64f2-131">詳細については、SDK の WMI に関する情報も参照 [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[dnprdnshort](../../includes/dnprdnshort-md.md)] してください。</span><span class="sxs-lookup"><span data-stu-id="c64f2-131">More information is also available about WMI in the [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[dnprdnshort](../../includes/dnprdnshort-md.md)] SDK.</span></span>

## <a name="see-also"></a><span data-ttu-id="c64f2-132">参照</span><span class="sxs-lookup"><span data-stu-id="c64f2-132">See Also</span></span>
 [<span data-ttu-id="c64f2-133">WMI Provider for Server Events の概念</span><span class="sxs-lookup"><span data-stu-id="c64f2-133">WMI Provider for Server Events Concepts</span></span>](https://technet.microsoft.com/library/ms180560.aspx)


