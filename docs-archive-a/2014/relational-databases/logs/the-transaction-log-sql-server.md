---
title: トランザクション ログ (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 01/04/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: supportability
ms.topic: conceptual
helpviewer_keywords:
- transaction logs [SQL Server], about
- databases [SQL Server], transaction logs
- logs [SQL Server], transaction logs
ms.assetid: d7be5ac5-4c8e-4d0a-b114-939eb97dac4d
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 025ef22e6dee1fcfaa1225a4709fa01b6c326b12
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87639495"
---
# <a name="the-transaction-log-sql-server"></a><span data-ttu-id="d8f24-102">トランザクション ログ (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="d8f24-102">The Transaction Log (SQL Server)</span></span>
  <span data-ttu-id="d8f24-103">すべての [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] データベースにはトランザクション ログがあり、データベース内のすべてのトランザクションとそれらのトランザクションによって加えられた変更が記録されます。</span><span class="sxs-lookup"><span data-stu-id="d8f24-103">Every [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] database has a transaction log that records all transactions and the database modifications made by each transaction.</span></span> <span data-ttu-id="d8f24-104">トランザクション ログは、いっぱいにならないように、定期的に切り捨てる必要があります。</span><span class="sxs-lookup"><span data-stu-id="d8f24-104">The transaction log must be truncated on a regular basis to keep it from filling up.</span></span> <span data-ttu-id="d8f24-105">ただし、いくつかの要因によってログの切り捨てが遅れる可能性があるため、ログのサイズを監視することは重要です。</span><span class="sxs-lookup"><span data-stu-id="d8f24-105">However, some factors can delay log truncation, so monitoring log size is important.</span></span> <span data-ttu-id="d8f24-106">一部の操作は、トランザクション ログのサイズへの影響を軽減するためにログへの記録を最小限に抑えることができます。</span><span class="sxs-lookup"><span data-stu-id="d8f24-106">Some operations can be minimally logged to reduce their impact on transaction log size.</span></span>  
  
 <span data-ttu-id="d8f24-107">トランザクション ログはデータベースの重要なコンポーネントの 1 つであり、システム障害が発生すると、データベースを一貫性のある状態にするために求められる場合があります。</span><span class="sxs-lookup"><span data-stu-id="d8f24-107">The transaction log is a critical component of the database and, if there is a system failure, the transaction log might be required to bring your database back to a consistent state.</span></span> <span data-ttu-id="d8f24-108">結果がどのようになるかを完全に把握できる場合を除き、トランザクション ログを削除または移動しないでください。</span><span class="sxs-lookup"><span data-stu-id="d8f24-108">The transaction log should never be deleted or moved unless you fully understand the ramifications of doing this.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="d8f24-109">データベース復旧時にトランザクション ログの適用を開始する既知の最適なポイントがチェックポイントによって作成されます。</span><span class="sxs-lookup"><span data-stu-id="d8f24-109">Known good points from which to begin applying transaction logs during database recovery are created by checkpoints.</span></span> <span data-ttu-id="d8f24-110">詳細については、「[データベース チェックポイント &#40;SQL Server&#41;](database-checkpoints-sql-server.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="d8f24-110">For more information, see [Database Checkpoints &#40;SQL Server&#41;](database-checkpoints-sql-server.md).</span></span>  
  
 <span data-ttu-id="d8f24-111">**このトピックの内容**</span><span class="sxs-lookup"><span data-stu-id="d8f24-111">**In this Topic:**</span></span>  
  
-   [<span data-ttu-id="d8f24-112">利点: トランザクション ログによりサポートされる操作</span><span class="sxs-lookup"><span data-stu-id="d8f24-112">Benefits: Operations Supported by the Transaction Log</span></span>](#Benefits)  
  
-   [<span data-ttu-id="d8f24-113">トランザクションログの切り捨て</span><span class="sxs-lookup"><span data-stu-id="d8f24-113">Transaction Log Truncation</span></span>](#Truncation)  
  
-   [<span data-ttu-id="d8f24-114">ログの切り捨てが遅れる原因となる要因</span><span class="sxs-lookup"><span data-stu-id="d8f24-114">Factors That Can Delay Log Truncation</span></span>](#FactorsThatDelayTruncation)  
  
-   [<span data-ttu-id="d8f24-115">最小ログ記録が可能な操作</span><span class="sxs-lookup"><span data-stu-id="d8f24-115">Operations That Can Be Minimally Logged</span></span>](#MinimallyLogged)  
  
-   [<span data-ttu-id="d8f24-116">関連タスク</span><span class="sxs-lookup"><span data-stu-id="d8f24-116">Related Tasks</span></span>](#RelatedTasks)  
  
##  <a name="benefits-operations-supported-by-the-transaction-log"></a><a name="Benefits"></a><span data-ttu-id="d8f24-117">利点: トランザクションログでサポートされている操作</span><span class="sxs-lookup"><span data-stu-id="d8f24-117">Benefits: Operations Supported by the Transaction Log</span></span>  
 <span data-ttu-id="d8f24-118">トランザクション ログでは、次の操作がサポートされます。</span><span class="sxs-lookup"><span data-stu-id="d8f24-118">The transaction log supports the following operations:</span></span>  
  
-   <span data-ttu-id="d8f24-119">個別のトランザクションの復旧</span><span class="sxs-lookup"><span data-stu-id="d8f24-119">Recovery of individual transactions.</span></span>  
  
-   <span data-ttu-id="d8f24-120">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] の起動時に未完了だったすべてのトランザクションの復旧</span><span class="sxs-lookup"><span data-stu-id="d8f24-120">Recovery of all incomplete transactions when [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is started.</span></span>  
  
-   <span data-ttu-id="d8f24-121">復元したデータベース、ファイル、ファイル グループ、またはページの障害時点までのロールフォワード</span><span class="sxs-lookup"><span data-stu-id="d8f24-121">Rolling a restored database, file, filegroup, or page forward to the point of failure.</span></span>  
  
-   <span data-ttu-id="d8f24-122">トランザクション レプリケーションのサポート</span><span class="sxs-lookup"><span data-stu-id="d8f24-122">Supporting transactional replication.</span></span>  
  
-   <span data-ttu-id="d8f24-123">高可用性およびディザスター リカバリー ソリューションのサポート: [!INCLUDE[ssHADR](../../includes/sshadr-md.md)]、データベース ミラーリング、およびログ配布</span><span class="sxs-lookup"><span data-stu-id="d8f24-123">Supporting high availability and disaster recovery solutions: [!INCLUDE[ssHADR](../../includes/sshadr-md.md)], database mirroring, and log shipping.</span></span>  
  
##  <a name="transaction-log-truncation"></a><a name="Truncation"></a> <span data-ttu-id="d8f24-124">トランザクション ログの切り捨て</span><span class="sxs-lookup"><span data-stu-id="d8f24-124">Transaction Log Truncation</span></span>  
 <span data-ttu-id="d8f24-125">ログの切り捨てによりログ ファイルの領域が解放され、トランザクション ログで再利用できるようになります。</span><span class="sxs-lookup"><span data-stu-id="d8f24-125">Log truncation frees space in the log file for reuse by the transaction log.</span></span> <span data-ttu-id="d8f24-126">ログの切り捨ては、ログがいっぱいにならないようにするために不可欠です。</span><span class="sxs-lookup"><span data-stu-id="d8f24-126">Log truncation is essential to keep the log from filling.</span></span> <span data-ttu-id="d8f24-127">ログの切り捨てでは、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] データベースの論理トランザクション ログから非アクティブな仮想ログ ファイルが削除されます。また、論理ログの領域が解放され、物理トランザクション ログで再利用できるようになります。</span><span class="sxs-lookup"><span data-stu-id="d8f24-127">Log truncation deletes inactive virtual log files from the logical transaction log of a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] database, freeing space in the logical log for reuse by the Physical transaction log.</span></span> <span data-ttu-id="d8f24-128">トランザクション ログが切り捨てられなければ、物理ログ ファイルに割り当てられているディスク上の領域がいっぱいになってしまいます。</span><span class="sxs-lookup"><span data-stu-id="d8f24-128">If a transaction log were never truncated, it would eventually fill all the disk space that is allocated to its physical log files.</span></span>  
  
 <span data-ttu-id="d8f24-129">この問題を回避するために、何かの理由でログの切り捨てが遅れている場合を除き、次のイベントの後に切り捨てが自動的に発生します。</span><span class="sxs-lookup"><span data-stu-id="d8f24-129">To avoid this problem, unless log truncation is being delayed for some reason, truncation occurs automatically after the following events:</span></span>  
  
-   <span data-ttu-id="d8f24-130">単純復旧モデルでは、チェックポイント以降。</span><span class="sxs-lookup"><span data-stu-id="d8f24-130">Under the simple recovery model, after a checkpoint.</span></span>  
  
-   <span data-ttu-id="d8f24-131">完全復旧モデルまたは一括ログ復旧モデルでは、前回のバックアップ後にチェックポイントが発生した場合、ログ バックアップ (コピーのみのログ バックアップの場合を除く) の後に切り捨てが発生します。</span><span class="sxs-lookup"><span data-stu-id="d8f24-131">Under the full recovery model or bulk-logged recovery model, if a checkpoint has occurred since the previous backup, truncation occurs after a log backup (unless it is a copy-only log backup).</span></span>  
  
 <span data-ttu-id="d8f24-132">詳細については、このトピックの「[ログの切り捨てが遅れる原因となる要因](#FactorsThatDelayTruncation)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="d8f24-132">For more information, see [Factors That Can Delay Log Truncation](#FactorsThatDelayTruncation), later in this topic.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="d8f24-133">ログの切り捨てを行っても、物理ログ ファイルのサイズは縮小されません。</span><span class="sxs-lookup"><span data-stu-id="d8f24-133">Log truncation does not reduce the size of the physical log file.</span></span> <span data-ttu-id="d8f24-134">物理ログ ファイルの物理サイズを削減するには、ログ ファイルを圧縮する必要があります。</span><span class="sxs-lookup"><span data-stu-id="d8f24-134">To reduce the physical size of a physical log file, you need to shrink the log file.</span></span> <span data-ttu-id="d8f24-135">物理ログ ファイルのサイズの圧縮の詳細については、「 [トランザクション ログ ファイルのサイズの管理](manage-the-size-of-the-transaction-log-file.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="d8f24-135">For information about shrinking the size of the physical log file, see [Manage the Size of the Transaction Log File](manage-the-size-of-the-transaction-log-file.md).</span></span>  
  
##  <a name="factors-that-can-delay-log-truncation"></a><a name="FactorsThatDelayTruncation"></a><span data-ttu-id="d8f24-136">ログの切り捨てが遅れる原因となる要因</span><span class="sxs-lookup"><span data-stu-id="d8f24-136">Factors That Can Delay Log Truncation</span></span>  
 <span data-ttu-id="d8f24-137">ログ レコードが長い間アクティブなままになると、トランザクション ログの切り捨てが遅れて、トランザクション ログがいっぱいになる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="d8f24-137">When log records remain active for a long time transaction log truncation is delayed, and potentially the transaction log can fill up.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="d8f24-138">トランザクション ログがいっぱいに応答する方法については、「 [Troubleshoot a Full Transaction Log &#40;SQL Server Error 9002&#41;](troubleshoot-a-full-transaction-log-sql-server-error-9002.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="d8f24-138">For information about how to respond to a full transaction log, see [Troubleshoot a Full Transaction Log &#40;SQL Server Error 9002&#41;](troubleshoot-a-full-transaction-log-sql-server-error-9002.md).</span></span>  
  
 <span data-ttu-id="d8f24-139">ログの切り捨ては、さまざまな要因で遅延が発生する場合があります。</span><span class="sxs-lookup"><span data-stu-id="d8f24-139">Log truncation can be delayed by a variety of factors.</span></span> <span data-ttu-id="d8f24-140">ログの切り捨てを妨げている原因は、 **sys.databases** カタログ ビューの **log_reuse_wait** 列と [log_reuse_wait_desc](/sql/relational-databases/system-catalog-views/sys-databases-transact-sql) 列に対するクエリを実行して見つけることができます。</span><span class="sxs-lookup"><span data-stu-id="d8f24-140">You can discover what, if anything, is preventing log truncation by querying the **log_reuse_wait** and **log_reuse_wait_desc** columns of the [sys.databases](/sql/relational-databases/system-catalog-views/sys-databases-transact-sql) catalog view.</span></span> <span data-ttu-id="d8f24-141">次の表では、これらの列の値について説明します。</span><span class="sxs-lookup"><span data-stu-id="d8f24-141">The following table describes the values of these columns.</span></span>  
  
|<span data-ttu-id="d8f24-142">log_reuse_wait の値</span><span class="sxs-lookup"><span data-stu-id="d8f24-142">log_reuse_wait value</span></span>|<span data-ttu-id="d8f24-143">log_reuse_wait_desc の値</span><span class="sxs-lookup"><span data-stu-id="d8f24-143">log_reuse_wait_desc value</span></span>|<span data-ttu-id="d8f24-144">説明</span><span class="sxs-lookup"><span data-stu-id="d8f24-144">Description</span></span>|  
|----------------------------|----------------------------------|-----------------|  
|<span data-ttu-id="d8f24-145">0</span><span class="sxs-lookup"><span data-stu-id="d8f24-145">0</span></span>|<span data-ttu-id="d8f24-146">NOTHING</span><span class="sxs-lookup"><span data-stu-id="d8f24-146">NOTHING</span></span>|<span data-ttu-id="d8f24-147">現在 1 つ以上の再利用可能な仮想ログ ファイルがある。</span><span class="sxs-lookup"><span data-stu-id="d8f24-147">Currently there are one or more reusable virtual log files.</span></span>|  
|<span data-ttu-id="d8f24-148">1</span><span class="sxs-lookup"><span data-stu-id="d8f24-148">1</span></span>|<span data-ttu-id="d8f24-149">CHECKPOINT</span><span class="sxs-lookup"><span data-stu-id="d8f24-149">CHECKPOINT</span></span>|<span data-ttu-id="d8f24-150">最後にログの切り捨てを行ってからチェックポイントが発生していないか、ログの先頭が仮想ログ ファイルを超えて移動していない</span><span class="sxs-lookup"><span data-stu-id="d8f24-150">No checkpoint has occurred since the last log truncation, or the head of the log has not yet moved beyond a virtual log file.</span></span> <span data-ttu-id="d8f24-151">(すべての復旧モデル)。</span><span class="sxs-lookup"><span data-stu-id="d8f24-151">(All recovery models)</span></span><br /><br /> <span data-ttu-id="d8f24-152">これは、ログの切り捨てが遅れる一般的な原因です。</span><span class="sxs-lookup"><span data-stu-id="d8f24-152">This is a routine reason for delaying log truncation.</span></span> <span data-ttu-id="d8f24-153">詳細については、「[データベース チェックポイント &#40;SQL Server&#41;](database-checkpoints-sql-server.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="d8f24-153">For more information, see [Database Checkpoints &#40;SQL Server&#41;](database-checkpoints-sql-server.md).</span></span>|  
|<span data-ttu-id="d8f24-154">2</span><span class="sxs-lookup"><span data-stu-id="d8f24-154">2</span></span>|<span data-ttu-id="d8f24-155">LOG_BACKUP</span><span class="sxs-lookup"><span data-stu-id="d8f24-155">LOG_BACKUP</span></span>|<span data-ttu-id="d8f24-156">トランザクション ログを切り捨てる前にログ バックアップが必要である</span><span class="sxs-lookup"><span data-stu-id="d8f24-156">A log backup is required before the transaction log can be truncated.</span></span> <span data-ttu-id="d8f24-157">(完全復旧モデルまたは一括ログ復旧モデルのみ)。</span><span class="sxs-lookup"><span data-stu-id="d8f24-157">(Full or bulk-logged recovery models only)</span></span><br /><br /> <span data-ttu-id="d8f24-158">次のログ バックアップが完了した時点で、ログ領域の一部が再利用可能になります。</span><span class="sxs-lookup"><span data-stu-id="d8f24-158">When the next log backup is completed, some log space might become reusable.</span></span>|  
|<span data-ttu-id="d8f24-159">3</span><span class="sxs-lookup"><span data-stu-id="d8f24-159">3</span></span>|<span data-ttu-id="d8f24-160">ACTIVE_BACKUP_OR_RESTORE</span><span class="sxs-lookup"><span data-stu-id="d8f24-160">ACTIVE_BACKUP_OR_RESTORE</span></span>|<span data-ttu-id="d8f24-161">データ バックアップまたは復元が実行中である (すべての復旧モデル)。</span><span class="sxs-lookup"><span data-stu-id="d8f24-161">A data backup or a restore is in progress (all recovery models).</span></span><br /><br /> <span data-ttu-id="d8f24-162">データ バックアップによってログの切り捨てが妨げられる場合、バックアップ操作を取り消すと、当面の問題には対処できます。</span><span class="sxs-lookup"><span data-stu-id="d8f24-162">If a data backup is preventing log truncation, canceling the backup operation might help the immediate problem.</span></span>|  
|<span data-ttu-id="d8f24-163">4</span><span class="sxs-lookup"><span data-stu-id="d8f24-163">4</span></span>|<span data-ttu-id="d8f24-164">ACTIVE_TRANSACTION</span><span class="sxs-lookup"><span data-stu-id="d8f24-164">ACTIVE_TRANSACTION</span></span>|<span data-ttu-id="d8f24-165">トランザクションがアクティブである (すべての復旧モデル)。</span><span class="sxs-lookup"><span data-stu-id="d8f24-165">A transaction is active (all recovery models).</span></span><br /><br /> <span data-ttu-id="d8f24-166">実行時間の長いトランザクションがログ バックアップの先頭に存在する可能性がある。</span><span class="sxs-lookup"><span data-stu-id="d8f24-166">A long-running transaction might exist at the start of the log backup.</span></span> <span data-ttu-id="d8f24-167">この場合、領域を解放するには再度ログ バックアップが必要になります。</span><span class="sxs-lookup"><span data-stu-id="d8f24-167">In this case, freeing the space might require another log backup.</span></span> <span data-ttu-id="d8f24-168">実行時間の長いトランザクションにより、単純復旧モデルを含むすべての復旧モデルでのログの切り捨てが妨げられることに注意してください。この場合、通常は、各自動チェックポイントでトランザクションログが切り捨てられます。</span><span class="sxs-lookup"><span data-stu-id="d8f24-168">Note that a long-running transactions prevent log truncation under all recovery models, including the simple recovery model, under which the transaction log is generally truncated on each automatic checkpoint.</span></span><br /><br /> <span data-ttu-id="d8f24-169">トランザクションが遅延している。</span><span class="sxs-lookup"><span data-stu-id="d8f24-169">A transaction is deferred.</span></span> <span data-ttu-id="d8f24-170">*遅延トランザクション* は、一部リソースが確保できないためにロールバックがブロックされている、実質的にはアクティブなトランザクションです。</span><span class="sxs-lookup"><span data-stu-id="d8f24-170">A *deferred transaction* is effectively an active transaction whose rollback is blocked because of some unavailable resource.</span></span> <span data-ttu-id="d8f24-171">遅延トランザクションの原因、およびトランザクションの遅延を解決する方法については、「[遅延トランザクション &#40;SQL Server&#41;](../backup-restore/deferred-transactions-sql-server.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="d8f24-171">For information about the causes of deferred transactions and how to move them out of the deferred state, see [Deferred Transactions &#40;SQL Server&#41;](../backup-restore/deferred-transactions-sql-server.md).</span></span> <br /><br /><span data-ttu-id="d8f24-172">実行時間の長いトランザクションも、tempdb のトランザクション ログをいっぱいにする可能性があります。</span><span class="sxs-lookup"><span data-stu-id="d8f24-172">Long-running transactions might also fill up tempdb's transaction log.</span></span> <span data-ttu-id="d8f24-173">tempdb は、並べ替えの作業テーブル、ハッシュの作業ファイル、カーソル作業テーブル、行のバージョン管理といった、内部オブジェクトに対するユーザー トランザクションで暗黙的に使用されます。</span><span class="sxs-lookup"><span data-stu-id="d8f24-173">Tempdb is used implicitly by user transactions for internal objects such as work tables for sorting, work files for hashing, cursor work tables, and row versioning.</span></span> <span data-ttu-id="d8f24-174">ユーザートランザクションにデータの読み取りのみが含まれている場合 (SELECT クエリ) でも、ユーザートランザクションで内部オブジェクトが作成され、使用されることがあります。</span><span class="sxs-lookup"><span data-stu-id="d8f24-174">Even if the user transaction includes only reading data (SELECT queries), internal objects may be created and used under user transactions.</span></span> <span data-ttu-id="d8f24-175">その結果 tempdb のトランザクション ログがいっぱいになる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="d8f24-175">Then the tempdb transaction log can be filled.</span></span>|  
|<span data-ttu-id="d8f24-176">5</span><span class="sxs-lookup"><span data-stu-id="d8f24-176">5</span></span>|<span data-ttu-id="d8f24-177">DATABASE_MIRRORING</span><span class="sxs-lookup"><span data-stu-id="d8f24-177">DATABASE_MIRRORING</span></span>|<span data-ttu-id="d8f24-178">データベース ミラーリングが一時中断されるか、高パフォーマンス モードでは、ミラー データベースがプリンシパル データベースに大幅に遅れる</span><span class="sxs-lookup"><span data-stu-id="d8f24-178">Database mirroring is paused, or under high-performance mode, the mirror database is significantly behind the principal database.</span></span> <span data-ttu-id="d8f24-179">(完全復旧モデルのみ)。</span><span class="sxs-lookup"><span data-stu-id="d8f24-179">(Full recovery model only)</span></span><br /><br /> <span data-ttu-id="d8f24-180">詳細については、「[データベース ミラーリング &#40;SQL Server&#41;](../../database-engine/database-mirroring/database-mirroring-sql-server.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="d8f24-180">For more information, see [Database Mirroring &#40;SQL Server&#41;](../../database-engine/database-mirroring/database-mirroring-sql-server.md).</span></span>|  
|<span data-ttu-id="d8f24-181">6</span><span class="sxs-lookup"><span data-stu-id="d8f24-181">6</span></span>|<span data-ttu-id="d8f24-182">レプリケーション</span><span class="sxs-lookup"><span data-stu-id="d8f24-182">REPLICATION</span></span>|<span data-ttu-id="d8f24-183">トランザクション レプリケーション中、パブリケーションに関連するトランザクションがディストリビューション データベースにまだ配信されていない</span><span class="sxs-lookup"><span data-stu-id="d8f24-183">During transactional replications, transactions relevant to the publications are still undelivered to the distribution database.</span></span> <span data-ttu-id="d8f24-184">(完全復旧モデルのみ)。</span><span class="sxs-lookup"><span data-stu-id="d8f24-184">(Full recovery model only)</span></span><br /><br /> <span data-ttu-id="d8f24-185">トランザクション レプリケーションの詳細については、「 [SQL Server Replication](../../relational-databases/replication/sql-server-replication.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="d8f24-185">For information about transactional replication, see [SQL Server Replication](../../relational-databases/replication/sql-server-replication.md).</span></span>|  
|<span data-ttu-id="d8f24-186">7</span><span class="sxs-lookup"><span data-stu-id="d8f24-186">7</span></span>|<span data-ttu-id="d8f24-187">DATABASE_SNAPSHOT_CREATION</span><span class="sxs-lookup"><span data-stu-id="d8f24-187">DATABASE_SNAPSHOT_CREATION</span></span>|<span data-ttu-id="d8f24-188">データベース スナップショットが作成されている</span><span class="sxs-lookup"><span data-stu-id="d8f24-188">A database snapshot is being created.</span></span> <span data-ttu-id="d8f24-189">(すべての復旧モデル)。</span><span class="sxs-lookup"><span data-stu-id="d8f24-189">(All recovery models)</span></span><br /><br /> <span data-ttu-id="d8f24-190">これは、通常、短い時間ログの切り捨てが遅れる一般的な原因となります。</span><span class="sxs-lookup"><span data-stu-id="d8f24-190">This is a routine, and typically brief, cause of delayed log truncation.</span></span>|  
|<span data-ttu-id="d8f24-191">8</span><span class="sxs-lookup"><span data-stu-id="d8f24-191">8</span></span>|<span data-ttu-id="d8f24-192">LOG_SCAN</span><span class="sxs-lookup"><span data-stu-id="d8f24-192">LOG_SCAN</span></span>|<span data-ttu-id="d8f24-193">ログ スキャンが行われている</span><span class="sxs-lookup"><span data-stu-id="d8f24-193">A log scan is occurring.</span></span> <span data-ttu-id="d8f24-194">(すべての復旧モデル)。</span><span class="sxs-lookup"><span data-stu-id="d8f24-194">(All recovery models)</span></span><br /><br /> <span data-ttu-id="d8f24-195">これは、通常、短い時間ログの切り捨てが遅れる一般的な原因となります。</span><span class="sxs-lookup"><span data-stu-id="d8f24-195">This is a routine, and typically brief, cause of delayed log truncation.</span></span>|  
|<span data-ttu-id="d8f24-196">9</span><span class="sxs-lookup"><span data-stu-id="d8f24-196">9</span></span>|<span data-ttu-id="d8f24-197">AVAILABILITY_REPLICA</span><span class="sxs-lookup"><span data-stu-id="d8f24-197">AVAILABILITY_REPLICA</span></span>|<span data-ttu-id="d8f24-198">可用性グループのセカンダリ レプリカが、このデータベースのトランザクション ログ レコードを対応するセカンダリ データベースに適用中である</span><span class="sxs-lookup"><span data-stu-id="d8f24-198">A secondary replica of an availability group is applying transaction log records of this database to a corresponding secondary database.</span></span> <span data-ttu-id="d8f24-199">(完全復旧モデル)。</span><span class="sxs-lookup"><span data-stu-id="d8f24-199">(Full recovery model)</span></span><br /><br /> <span data-ttu-id="d8f24-200">詳細については、「 [AlwaysOn 可用性グループ &#40;SQL Server&#41;の概要](../../database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="d8f24-200">For more information, see [Overview of AlwaysOn Availability Groups &#40;SQL Server&#41;](../../database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server.md).</span></span>|  
|<span data-ttu-id="d8f24-201">10</span><span class="sxs-lookup"><span data-stu-id="d8f24-201">10</span></span>|-|<span data-ttu-id="d8f24-202">内部使用のみ</span><span class="sxs-lookup"><span data-stu-id="d8f24-202">For internal use only</span></span>|  
|<span data-ttu-id="d8f24-203">11</span><span class="sxs-lookup"><span data-stu-id="d8f24-203">11</span></span>|-|<span data-ttu-id="d8f24-204">内部使用のみ</span><span class="sxs-lookup"><span data-stu-id="d8f24-204">For internal use only</span></span>|  
|<span data-ttu-id="d8f24-205">12</span><span class="sxs-lookup"><span data-stu-id="d8f24-205">12</span></span>|-|<span data-ttu-id="d8f24-206">内部使用のみ</span><span class="sxs-lookup"><span data-stu-id="d8f24-206">For internal use only</span></span>|  
|<span data-ttu-id="d8f24-207">13</span><span class="sxs-lookup"><span data-stu-id="d8f24-207">13</span></span>|<span data-ttu-id="d8f24-208">OLDEST_PAGE</span><span class="sxs-lookup"><span data-stu-id="d8f24-208">OLDEST_PAGE</span></span>|<span data-ttu-id="d8f24-209">データベースが間接的なチェックポイントを使用するように構成されている場合、データベース上の最も古いページはチェックポイントの LSN よりも古くなることがある。</span><span class="sxs-lookup"><span data-stu-id="d8f24-209">If a database is configured to use indirect checkpoints, the oldest page on the database might be older than the checkpoint LSN.</span></span> <span data-ttu-id="d8f24-210">この場合、最も古いページのログの切り捨てが遅れる可能性があります</span><span class="sxs-lookup"><span data-stu-id="d8f24-210">In this case, the oldest page can delay log truncation.</span></span> <span data-ttu-id="d8f24-211">(すべての復旧モデル)。</span><span class="sxs-lookup"><span data-stu-id="d8f24-211">(All recovery models)</span></span><br /><br /> <span data-ttu-id="d8f24-212">間接的なチェックポイントの詳細については、「 [Database Checkpoints &#40;SQL Server&#41;](database-checkpoints-sql-server.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="d8f24-212">For information about indirect checkpoints, see [Database Checkpoints &#40;SQL Server&#41;](database-checkpoints-sql-server.md).</span></span>|  
|<span data-ttu-id="d8f24-213">14</span><span class="sxs-lookup"><span data-stu-id="d8f24-213">14</span></span>|<span data-ttu-id="d8f24-214">OTHER_TRANSIENT</span><span class="sxs-lookup"><span data-stu-id="d8f24-214">OTHER_TRANSIENT</span></span>|<span data-ttu-id="d8f24-215">この値は現在使用されていません。</span><span class="sxs-lookup"><span data-stu-id="d8f24-215">This value is currently not used.</span></span>|  
|<span data-ttu-id="d8f24-216">16</span><span class="sxs-lookup"><span data-stu-id="d8f24-216">16</span></span>|<span data-ttu-id="d8f24-217">XTP_CHECKPOINT</span><span class="sxs-lookup"><span data-stu-id="d8f24-217">XTP_CHECKPOINT</span></span>|<span data-ttu-id="d8f24-218">データベースにメモリ最適化ファイル グループがある場合は、自動 [!INCLUDE[hek_2](../../includes/hek-2-md.md)] チェックポイントがトリガーされるまで (これはログが 512 MB 増加するたびに発生します)、トランザクション ログは切り捨てられません。</span><span class="sxs-lookup"><span data-stu-id="d8f24-218">When a database has a memory-optimized filegroup, the transaction log may not truncate until automatic [!INCLUDE[hek_2](../../includes/hek-2-md.md)] checkpoint is triggered (which happens at every 512 MB of log growth).</span></span><br /><br /> <span data-ttu-id="d8f24-219">注: 512 MB のサイズより前にトランザクションログを切り捨てるには、対象のデータベースに対して Checkpoint コマンドを手動で起動します。</span><span class="sxs-lookup"><span data-stu-id="d8f24-219">Note: To truncate transaction log before 512 MB size, fire the Checkpoint command manually against the database in question.</span></span>|  
  
##  <a name="operations-that-can-be-minimally-logged"></a><a name="MinimallyLogged"></a><span data-ttu-id="d8f24-220">最小ログ記録が可能な操作</span><span class="sxs-lookup"><span data-stu-id="d8f24-220">Operations That Can Be Minimally Logged</span></span>  
 <span data-ttu-id="d8f24-221">*最小ログ記録* では、トランザクションの復旧に必要な情報だけが記録されます。特定の時点への復旧はサポートしません。</span><span class="sxs-lookup"><span data-stu-id="d8f24-221">*Minimal logging* involves logging only the information that is required to recover the transaction without supporting point-in-time recovery.</span></span> <span data-ttu-id="d8f24-222">このトピックでは、一括ログ復旧モデルで (バックアップが実行されていない場合は単純復旧モデルで) 最小ログが記録される操作について説明します。</span><span class="sxs-lookup"><span data-stu-id="d8f24-222">This topic identifies the operations that are minimally logged under the bulk-logged recovery model (as well as under the simple recovery model, except when a backup is running).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="d8f24-223">最小ログ記録は、メモリ最適化テーブルではサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="d8f24-223">Minimal logging is not supported for memory-optimized tables.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="d8f24-224">完全復旧モデルでは、すべての一括操作が完全にログに記録されます。</span><span class="sxs-lookup"><span data-stu-id="d8f24-224">Under the full recovery model, all bulk operations are fully logged.</span></span> <span data-ttu-id="d8f24-225">ただし、一括操作のためにデータベースを一時的に一括ログ復旧モデルに切り替えることで、一連の一括操作用のログ記録を最小限に抑えることができます。</span><span class="sxs-lookup"><span data-stu-id="d8f24-225">However, you can minimize logging for a set of bulk operations by switching the database to the bulk-logged recovery model temporarily for bulk operations.</span></span> <span data-ttu-id="d8f24-226">最小ログ記録は、完全ログ記録より効率的であり、一括トランザクションの実行中に、使用可能なトランザクション ログ領域が大規模な一括操作でいっぱいになる可能性を低減します。</span><span class="sxs-lookup"><span data-stu-id="d8f24-226">Minimal logging is more efficient than full logging, and it reduces the possibility of a large-scale bulk operation filling the available transaction log space during a bulk transaction.</span></span> <span data-ttu-id="d8f24-227">ただし、最小ログ記録が有効なときにデータベースが破損または消失した場合は、データベースを障害発生時点まで復旧できません。</span><span class="sxs-lookup"><span data-stu-id="d8f24-227">However, if the database is damaged or lost when minimal logging is in effect, you cannot recover the database to the point of failure.</span></span>  
  
 <span data-ttu-id="d8f24-228">次に示す操作は、完全復旧モデルで完全にログ記録されますが、単純復旧モデルと一括ログ復旧モデルでは最小限にしかログ記録されません。</span><span class="sxs-lookup"><span data-stu-id="d8f24-228">The following operations, which are fully logged under the full recovery model, are minimally logged under the simple and bulk-logged recovery model:</span></span>  
  
-   <span data-ttu-id="d8f24-229">一括インポート操作 ([bcp](../../tools/bcp-utility.md)、[BULK INSERT](/sql/t-sql/statements/bulk-insert-transact-sql)、[INSERT...SELECT](/sql/t-sql/statements/insert-transact-sql))。</span><span class="sxs-lookup"><span data-stu-id="d8f24-229">Bulk import operations ([bcp](../../tools/bcp-utility.md), [BULK INSERT](/sql/t-sql/statements/bulk-insert-transact-sql), and [INSERT... SELECT](/sql/t-sql/statements/insert-transact-sql)).</span></span> <span data-ttu-id="d8f24-230">テーブルへの一括インポートの最小ログ記録の詳細については、「 [Prerequisites for Minimal Logging in Bulk Import](../import-export/prerequisites-for-minimal-logging-in-bulk-import.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="d8f24-230">For more information about when bulk import into a table is minimally logged, see [Prerequisites for Minimal Logging in Bulk Import](../import-export/prerequisites-for-minimal-logging-in-bulk-import.md).</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="d8f24-231">トランザクション レプリケーションが有効な場合、BULK INSERT 操作は、一括ログ復旧モデルでも完全にログ記録されます。</span><span class="sxs-lookup"><span data-stu-id="d8f24-231">When transactional replication is enabled, BULK INSERT operations are fully logged even under the Bulk Logged recovery model.</span></span>  
  
-   <span data-ttu-id="d8f24-232">SELECT [INTO](/sql/t-sql/queries/select-into-clause-transact-sql)操作。</span><span class="sxs-lookup"><span data-stu-id="d8f24-232">SELECT [INTO](/sql/t-sql/queries/select-into-clause-transact-sql) operations.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="d8f24-233">トランザクション レプリケーションが有効な場合、SELECT INTO 操作は、一括ログ復旧モデルでも完全にログ記録されます。</span><span class="sxs-lookup"><span data-stu-id="d8f24-233">When transactional replication is enabled, SELECT INTO operations are fully logged even under the Bulk Logged recovery model.</span></span>  
  
-   <span data-ttu-id="d8f24-234">新規データの挿入時または追加時の、 [UPDATE](/sql/t-sql/queries/update-transact-sql) ステートメントの .WRITE 句を使用した、大きな値のデータ型の部分更新。</span><span class="sxs-lookup"><span data-stu-id="d8f24-234">Partial updates to large value data types, using the .WRITE clause in the [UPDATE](/sql/t-sql/queries/update-transact-sql) statement when inserting or appending new data.</span></span> <span data-ttu-id="d8f24-235">既存の値を更新する場合は、最小ログ記録は使用されません。</span><span class="sxs-lookup"><span data-stu-id="d8f24-235">Note that minimal logging is not used when existing values are updated.</span></span> <span data-ttu-id="d8f24-236">大きな値のデータ型の詳細については、「[データ型 &#40;Transact-SQL&#41;](/sql/t-sql/data-types/data-types-transact-sql)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="d8f24-236">For more information about large value data types, see [Data Types &#40;Transact-SQL&#41;](/sql/t-sql/data-types/data-types-transact-sql).</span></span>  
  
-   <span data-ttu-id="d8f24-237">[WRITETEXT](/sql/t-sql/queries/writetext-transact-sql) 、、およびの各[UPDATETEXT](/sql/t-sql/queries/updatetext-transact-sql) `text` `ntext` データ型の列に新しいデータを挿入または追加するときの WRITETEXT ステートメントおよび UPDATETEXT ステートメント `image` 。</span><span class="sxs-lookup"><span data-stu-id="d8f24-237">[WRITETEXT](/sql/t-sql/queries/writetext-transact-sql) and [UPDATETEXT](/sql/t-sql/queries/updatetext-transact-sql) statements when inserting or appending new data into the `text`, `ntext`, and `image` data type columns.</span></span> <span data-ttu-id="d8f24-238">既存の値を更新する場合は、最小ログ記録は使用されません。</span><span class="sxs-lookup"><span data-stu-id="d8f24-238">Note that minimal logging is not used when existing values are updated.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="d8f24-239">WRITETEXT ステートメントおよび UPDATETEXT ステートメントは非推奨とされます。新しいアプリケーションでは、これらを使用しないようにしてください。</span><span class="sxs-lookup"><span data-stu-id="d8f24-239">The WRITETEXT and UPDATETEXT statements are deprecated, so you should avoid using them in new applications.</span></span>  
  
-   <span data-ttu-id="d8f24-240">データベースが単純復旧モデルまたは一括ログ復旧モデルに設定されている場合、一部のインデックス DDL 操作は、オフラインで実行されても、オンラインで実行されても、最小ログ記録の対象になります。</span><span class="sxs-lookup"><span data-stu-id="d8f24-240">If the database is set to the simple or bulk-logged recovery model, some index DDL operations are minimally logged whether the operation is executed offline or online.</span></span> <span data-ttu-id="d8f24-241">最小ログ記録が行われるインデックス操作は、次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="d8f24-241">The minimally logged index operations are as follows:</span></span>  
  
    -   <span data-ttu-id="d8f24-242">[CREATE INDEX](/sql/t-sql/statements/create-index-transact-sql) 操作 (インデックス付きビューを含む)。</span><span class="sxs-lookup"><span data-stu-id="d8f24-242">[CREATE INDEX](/sql/t-sql/statements/create-index-transact-sql) operations (including indexed views).</span></span>  
  
    -   <span data-ttu-id="d8f24-243">[ALTER INDEX](/sql/t-sql/statements/alter-index-transact-sql) REBUILD 操作または DBCC DBREINDEX 操作。</span><span class="sxs-lookup"><span data-stu-id="d8f24-243">[ALTER INDEX](/sql/t-sql/statements/alter-index-transact-sql) REBUILD or DBCC DBREINDEX operations.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="d8f24-244">DBCC DBREINDEX ステートメントは非推奨とされます。新しいアプリケーションでは、これを使用しないようにしてください。</span><span class="sxs-lookup"><span data-stu-id="d8f24-244">The DBCC DBREINDEX statement is deprecated so you should avoid using it in new applications.</span></span>  
  
    -   <span data-ttu-id="d8f24-245">DROP INDEX による新しいヒープの再構築 (適用可能な場合)。</span><span class="sxs-lookup"><span data-stu-id="d8f24-245">DROP INDEX new heap rebuild (if applicable).</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="d8f24-246">[DROP INDEX](/sql/t-sql/statements/drop-index-transact-sql) 操作中のインデックス ページの割り当て解除は、常に完全にログ記録されます。</span><span class="sxs-lookup"><span data-stu-id="d8f24-246">Index page deallocation during a [DROP INDEX](/sql/t-sql/statements/drop-index-transact-sql) operation is always fully logged.</span></span>  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="d8f24-247">関連タスク</span><span class="sxs-lookup"><span data-stu-id="d8f24-247">Related Tasks</span></span>  
 `Managing the transaction log`  
  
-   [<span data-ttu-id="d8f24-248">トランザクション ログ ファイルのサイズの管理</span><span class="sxs-lookup"><span data-stu-id="d8f24-248">Manage the Size of the Transaction Log File</span></span>](manage-the-size-of-the-transaction-log-file.md)  
  
-   [<span data-ttu-id="d8f24-249">満杯になったトランザクション ログのトラブルシューティング &#40;SQL Server エラー 9002&#41;</span><span class="sxs-lookup"><span data-stu-id="d8f24-249">Troubleshoot a Full Transaction Log &#40;SQL Server Error 9002&#41;</span></span>](troubleshoot-a-full-transaction-log-sql-server-error-9002.md)  
  
 <span data-ttu-id="d8f24-250">**トランザクション ログのバックアップ (完全復旧モデル)**</span><span class="sxs-lookup"><span data-stu-id="d8f24-250">**Backing Up the Transaction Log (Full Recovery Model)**</span></span>  
  
-   [<span data-ttu-id="d8f24-251">トランザクション ログのバックアップ &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="d8f24-251">Back Up a Transaction Log &#40;SQL Server&#41;</span></span>](../backup-restore/back-up-a-transaction-log-sql-server.md)  
  
 <span data-ttu-id="d8f24-252">**トランザクション ログの復元 (完全復旧モデル)**</span><span class="sxs-lookup"><span data-stu-id="d8f24-252">**Restoring the Transaction Log (Full Recovery Model)**</span></span>  
  
-  [<span data-ttu-id="d8f24-253">トランザクション ログ バックアップの復元</span><span class="sxs-lookup"><span data-stu-id="d8f24-253">Restore a Transaction Log Backup</span></span>](../backup-restore/restore-a-transaction-log-backup-sql-server.md)   
  
## <a name="see-also"></a><span data-ttu-id="d8f24-254">参照</span><span class="sxs-lookup"><span data-stu-id="d8f24-254">See Also</span></span>  
 <span data-ttu-id="d8f24-255">[トランザクションの持続性の制御](control-transaction-durability.md) </span><span class="sxs-lookup"><span data-stu-id="d8f24-255">[Control Transaction Durability](control-transaction-durability.md) </span></span>  
 <span data-ttu-id="d8f24-256">[一括インポートで最小ログ記録を行うための前提条件](../import-export/prerequisites-for-minimal-logging-in-bulk-import.md) </span><span class="sxs-lookup"><span data-stu-id="d8f24-256">[Prerequisites for Minimal Logging in Bulk Import](../import-export/prerequisites-for-minimal-logging-in-bulk-import.md) </span></span>  
 <span data-ttu-id="d8f24-257">[SQL Server データベースのバックアップと復元](../backup-restore/back-up-and-restore-of-sql-server-databases.md) </span><span class="sxs-lookup"><span data-stu-id="d8f24-257">[Back Up and Restore of SQL Server Databases](../backup-restore/back-up-and-restore-of-sql-server-databases.md) </span></span>  
 <span data-ttu-id="d8f24-258">[データベース チェックポイント &#40;SQL Server&#41;](database-checkpoints-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="d8f24-258">[Database Checkpoints &#40;SQL Server&#41;](database-checkpoints-sql-server.md) </span></span>  
 <span data-ttu-id="d8f24-259">[データベースのプロパティの表示または変更](../databases/view-or-change-the-properties-of-a-database.md) </span><span class="sxs-lookup"><span data-stu-id="d8f24-259">[View or Change the Properties of a Database](../databases/view-or-change-the-properties-of-a-database.md) </span></span>  
 [<span data-ttu-id="d8f24-260">復旧モデル &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="d8f24-260">Recovery Models &#40;SQL Server&#41;</span></span>](../backup-restore/recovery-models-sql-server.md)  
  
  
