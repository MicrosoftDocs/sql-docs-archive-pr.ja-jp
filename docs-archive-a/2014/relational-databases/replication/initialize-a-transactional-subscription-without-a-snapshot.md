---
title: スナップショットを使用しないトランザクション サブスクリプションの初期化 | Microsoft Docs
ms.custom: ''
ms.date: 03/07/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- transactional replication, initializing
- replication [SQL Server], initializing
- initializing subscriptions [SQL Server replication], without snapshots
ms.assetid: 75c8c1f8-60bc-44a8-944b-d18d1f6bda11
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 88e240b75cdbb239548cfcb8e5d8df5eb2af2973
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87632335"
---
# <a name="initialize-a-transactional-subscription-without-a-snapshot"></a><span data-ttu-id="644c6-102">スナップショットを使用しないトランザクション サブスクリプションの初期化</span><span class="sxs-lookup"><span data-stu-id="644c6-102">Initialize a Transactional Subscription Without a Snapshot</span></span>
  <span data-ttu-id="644c6-103">トランザクション パブリケーションへのサブスクリプションは、既定ではスナップショットを使用して初期化されます。このスナップショットはスナップショット エージェントによって生成され、ディストリビューション エージェントによって適用されます。</span><span class="sxs-lookup"><span data-stu-id="644c6-103">By default, a subscription to a transactional publication is initialized with a snapshot, which is generated by the Snapshot Agent and applied by the Distribution Agent.</span></span> <span data-ttu-id="644c6-104">初期データセットが大規模な場合など、状況によっては、別の方法でサブスクリプションを初期化するのが望ましい場合があります。</span><span class="sxs-lookup"><span data-stu-id="644c6-104">In some scenarios, such as those involving large initial datasets, it is preferable to initialize a subscription using another method.</span></span> <span data-ttu-id="644c6-105">サブスクライバーを初期化する他の方法としては、以下のものがあります。</span><span class="sxs-lookup"><span data-stu-id="644c6-105">Other methods of initializing a Subscriber include:</span></span>  
  
-   <span data-ttu-id="644c6-106">バックアップを指定する方法。</span><span class="sxs-lookup"><span data-stu-id="644c6-106">Specifying a backup.</span></span> <span data-ttu-id="644c6-107">サブスクライバー上でバックアップを復元してから、ディストリビューション エージェントにより、必要なレプリケーション メタデータとシステム プロシージャがコピーされます。</span><span class="sxs-lookup"><span data-stu-id="644c6-107">Restore the backup on the Subscriber, and then the Distribution Agent copies any required replication metadata and system procedures.</span></span> <span data-ttu-id="644c6-108">バックアップを使用した初期化は、サブスクライバーにデータを配信する最も高速な方法であり便利です。バックアップを使用した初期化をパブリケーションで有効にした後で取得したバックアップであれば、どのバックアップでも使用できます。</span><span class="sxs-lookup"><span data-stu-id="644c6-108">Initializing with a backup is the fastest way to deliver data to the Subscriber and is convenient, because any recent backup can be used if it was taken after the publication was enabled for initialization with a backup.</span></span>  
  
-   <span data-ttu-id="644c6-109">データベースのインポートなど、他の手法で初期データセットをサブスクライバーにコピーする方法。</span><span class="sxs-lookup"><span data-stu-id="644c6-109">Copying an initial dataset to the Subscriber through another mechanism, such as attaching a database.</span></span> <span data-ttu-id="644c6-110">正しいデータとスキーマがサブスクライバーにあることを確認してから、ディストリビューション エージェントにより、必要なメタデータとシステム プロシージャがコピーされます。</span><span class="sxs-lookup"><span data-stu-id="644c6-110">You must ensure the correct data and schema are at the Subscriber, and then the Distribution Agent copies any required metadata and system procedures.</span></span>  
  
## <a name="initializing-a-subscription-with-a-backup"></a><span data-ttu-id="644c6-111">バックアップを使用したサブスクリプションの初期化</span><span class="sxs-lookup"><span data-stu-id="644c6-111">Initializing a subscription with a backup</span></span>  
 <span data-ttu-id="644c6-112">バックアップにはデータベース全体が含まれるため、各サブスクリプション データベースを初期化した後は、パブリケーション データベースの完全なコピーが含まれます。</span><span class="sxs-lookup"><span data-stu-id="644c6-112">A backup contains an entire database; therefore each subscription database will contain a complete copy of the publication database when it is initialized:</span></span>  
  
-   <span data-ttu-id="644c6-113">バックアップには、パブリケーションでアーティクルとして指定されていないテーブルが含まれます。</span><span class="sxs-lookup"><span data-stu-id="644c6-113">The backup includes tables not specified as articles for the publication.</span></span>  
  
-   <span data-ttu-id="644c6-114">バックアップには、テーブルに対して行フィルターや列フィルターが指定してある場合でも、すべてのデータが含まれます。</span><span class="sxs-lookup"><span data-stu-id="644c6-114">The backup includes all data, even if row or column filters are specified on a table.</span></span>  
  
 <span data-ttu-id="644c6-115">バックアップを復元した後に不要なオブジェクトやデータを削除するのは、管理者またはアプリケーションの責任です。</span><span class="sxs-lookup"><span data-stu-id="644c6-115">It is the responsibility of the administrator or application to remove any unwanted objects or data after the backup has been restored.</span></span> <span data-ttu-id="644c6-116">以降の同期では、アーティクルとして指定されたテーブルに該当するデータの変更と、指定したフィルター条件に一致した変更だけがレプリケートされます。</span><span class="sxs-lookup"><span data-stu-id="644c6-116">In subsequent synchronizations, data changes are only replicated if they apply to tables specified as articles, and the changes meet any filtering criteria you specified.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="644c6-117">バックアップを復元する際、サブスクライバーを使用して自動的に同期させる場合には、そのバックアップがパブリッシャーのものであることを確認する必要があります。</span><span class="sxs-lookup"><span data-stu-id="644c6-117">When restoring a backup, you must ensure that the backup came from the Publisher if you want the Subscriber to automatically synchronize.</span></span> <span data-ttu-id="644c6-118">同期を開始する位置の設定に使用する、バックアップ内のログ シーケンス番号 (LSN) の値は、パブリッシャーに固有です。</span><span class="sxs-lookup"><span data-stu-id="644c6-118">The log sequence number (LSN) values in the backup (which are used to set the point at which to start synchronizing) are specific to the Publisher.</span></span>  
  
 <span data-ttu-id="644c6-119">**バックアップを使用してサブスクリプションを初期化するには**</span><span class="sxs-lookup"><span data-stu-id="644c6-119">**To initialize a subscription with a backup**</span></span>  
  
 <span data-ttu-id="644c6-120">バックアップを使用してサブスクリプションを初期化するには、まずパブリケーションを作成する際にオプションを有効にし、さらにサブスクリプションを作成する際にいくつかのオプションに値を指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="644c6-120">To initialize a subscription with a backup, you first must enable the option when you create a publication, and then specify values for a number of options when you create a subscription.</span></span> <span data-ttu-id="644c6-121">パブリケーションは、パブリケーションの新規作成ウィザードかプログラムで有効にできます。</span><span class="sxs-lookup"><span data-stu-id="644c6-121">Publications can be enabled through the New Publication Wizard or programmatically.</span></span> <span data-ttu-id="644c6-122">ただし、サブスクリプション オプションで必要な値は、プログラムでしか指定できません。</span><span class="sxs-lookup"><span data-stu-id="644c6-122">However, the values required for the subscription options can only be specified programmatically.</span></span>  
  
-   [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]<span data-ttu-id="644c6-123">: [トランザクション パブリケーションに対してバックアップを使用した初期化を有効にする &#40;SQL Server Management Studio&#41;](enable-initialization-with-backup-for-transactional-publications.md)</span><span class="sxs-lookup"><span data-stu-id="644c6-123">: [Enable Initialization with a Backup for Transactional Publications &#40;SQL Server Management Studio&#41;](enable-initialization-with-backup-for-transactional-publications.md)</span></span>  
  
-   <span data-ttu-id="644c6-124">レプリケーション Transact-SQL プログラミング: [トランザクション サブスクリプションのバックアップからの初期化 &#40;レプリケーション Transact-SQL プログラミング&#41;](initialize-a-transactional-subscription-from-a-backup.md)</span><span class="sxs-lookup"><span data-stu-id="644c6-124">Replication Transact-SQL programming: [Initialize a Transactional Subscription from a Backup &#40;Replication Transact-SQL Programming&#41;](initialize-a-transactional-subscription-from-a-backup.md)</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="644c6-125">スナップショットを使用せずにサブスクリプションを初期化する場合、パブリッシャーで SQL Server サービスを実行する際に使用されるアカウントには、ディストリビューターのスナップショット フォルダーに対する書き込み権限が必要です。</span><span class="sxs-lookup"><span data-stu-id="644c6-125">If a subscription is initialized without using a snapshot, the account under which the SQL Server service runs at the Publisher must have write permissions on the snapshot folder at the Distributor.</span></span> <span data-ttu-id="644c6-126">権限の詳細については、「 [Replication Agent Security Model](security/replication-agent-security-model.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="644c6-126">For more information about permissions, see [Replication Agent Security Model](security/replication-agent-security-model.md).</span></span>  
  
### <a name="ensuring-the-suitability-of-a-backup"></a><span data-ttu-id="644c6-127">バックアップの適合性の確認</span><span class="sxs-lookup"><span data-stu-id="644c6-127">Ensuring the suitability of a backup</span></span>  
 <span data-ttu-id="644c6-128">バックアップがサブスクライバーの初期化に適しているのは、バックアップの取得後に実行されたすべてのトランザクションがディストリビューターに保存されている場合です。</span><span class="sxs-lookup"><span data-stu-id="644c6-128">A backup is suitable for initializing a Subscriber if all transactions that occur after the backup was taken are stored at the Distributor.</span></span> <span data-ttu-id="644c6-129">バックアップが適していない場合には、レプリケーションでエラー メッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="644c6-129">Replication will display an error message if the backup is not suitable.</span></span>  
  
 <span data-ttu-id="644c6-130">バックアップが使用に適したものになるように、次のガイドラインに従ってください。</span><span class="sxs-lookup"><span data-stu-id="644c6-130">To help ensure that a backup is suitable for use, follow these guidelines:</span></span>  
  
-   <span data-ttu-id="644c6-131">利用できる最新のバックアップを使用してください。最新のバックアップがディストリビューションの最長保有期間より古い場合には、バックアップを使用してサブスクリプションを初期化する前に、新しいバックアップを作成してください。</span><span class="sxs-lookup"><span data-stu-id="644c6-131">Use the latest backup available, and if the latest backup is older than the maximum distribution retention period, create a new backup before attempting to initialize a subscription with a backup.</span></span> <span data-ttu-id="644c6-132">保有期間の詳細については、「 [Subscription Expiration and Deactivation](subscription-expiration-and-deactivation.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="644c6-132">For more information about retention period, see [Subscription Expiration and Deactivation](subscription-expiration-and-deactivation.md).</span></span>  
  
-   <span data-ttu-id="644c6-133">既定では、ディストリビューション クリーンアップ ジョブにより、72 時間よりも古いトランザクションがディストリビューション データベースから削除されます。</span><span class="sxs-lookup"><span data-stu-id="644c6-133">By default, the distribution cleanup job clears transactions older than 72 hours from the distribution database.</span></span> <span data-ttu-id="644c6-134">クリーンアップは、パブリケーションで設定された保有期間に基づきます。</span><span class="sxs-lookup"><span data-stu-id="644c6-134">Cleanup is based on the retention period set for the publication.</span></span> <span data-ttu-id="644c6-135">古いバックアップを使用して同期する場合は、バックアップを復元する前にジョブを一時的に無効にし、サブスクリプションが正常に作成された後で再度有効にすることを検討してください。</span><span class="sxs-lookup"><span data-stu-id="644c6-135">When synchronizing with older backups, consider temporarily disabling the job before the backup you would like to restore and re-enabling it after the subscription is successfully created.</span></span> <span data-ttu-id="644c6-136">これにより、バックアップから正常に同期するために必要となるトランザクションが、ディストリビューション データベースから削除されることを防ぐことができます。</span><span class="sxs-lookup"><span data-stu-id="644c6-136">This prevents removal of transactions from the distribution database that might be needed to synchronize successfully from the backup.</span></span> <span data-ttu-id="644c6-137">クリーンアップ ジョブの詳細については、「[Run Replication Maintenance Jobs &#40;SQL Server Management Studio&#41;](administration/run-replication-maintenance-jobs-sql-server-management-studio.md)」(レプリケーション メンテナンス ジョブの実行 &#40;SQL Server Management Studio&#41;) を参照してください。</span><span class="sxs-lookup"><span data-stu-id="644c6-137">For information about running cleanup jobs, see [Run Replication Maintenance Jobs &#40;SQL Server Management Studio&#41;](administration/run-replication-maintenance-jobs-sql-server-management-studio.md).</span></span>  
  
 <span data-ttu-id="644c6-138">場合によっては、バックアップを使用してサブスクリプションを初期化した後で、復元したサブスクライバー データベースを手動でカスタマイズする必要があります。</span><span class="sxs-lookup"><span data-stu-id="644c6-138">In some cases you must manually perform customizations in the restored Subscriber database after setting up subscriptions that are initialized with a backup.</span></span> <span data-ttu-id="644c6-139">一般に、復元したサブスクライバー データベースを手動で変更する必要があるのは、サブスクライバー データベースの内容がパブリッシャー データベースの内容と異なるようにパブリケーションが定義されている場合です。</span><span class="sxs-lookup"><span data-stu-id="644c6-139">In general, manual modifications at the restored Subscriber database are required if the Publication is defined in such a way that the Subscriber database content is expected to be different from the Publisher database content.</span></span>  
  
-   <span data-ttu-id="644c6-140">復元されたデータベースのインデックス付きビューが、ログに基づくテーブルへのインデックス付きビューのアーティクルとしてパブリッシュされている場合は、テーブルに変換する必要があります。</span><span class="sxs-lookup"><span data-stu-id="644c6-140">Indexed-views at the restored database have to be converted to tables if they are published as log-based indexed-view-to-table articles</span></span>  
  
-   <span data-ttu-id="644c6-141">復元したデータベースでサブスクライブされた timestamp 列は、 **binary(8)** 列に変換する必要があります。そのためにまず、timestamp 列を含むテーブルの内容を新しいテーブル (ほぼ同じスキーマで、timestamp 列の代わりに **binary(8)** 列を使用したテーブル) にコピーしてください。次に、元のテーブルを削除し、新しいテーブルを元のテーブルと同じ名前に変更してください。</span><span class="sxs-lookup"><span data-stu-id="644c6-141">Subscribed timestamp columns at the restored database must be converted to **binary(8)** columns: copy the content of the tables containing timestamp columns to new tables with matching schemas except having **binary(8)** columns in place of the timestamp columns, drop the original tables, and rename the new tables with the same names as the original tables.</span></span>  
  
## <a name="initializing-a-subscription-with-an-alternative-method"></a><span data-ttu-id="644c6-142">代替手段を使用したサブスクリプションの初期化</span><span class="sxs-lookup"><span data-stu-id="644c6-142">Initializing a subscription with an alternative method</span></span>  
 <span data-ttu-id="644c6-143">[!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)]のように、パブリケーション データベースのスキーマとデータをサブスクライバーにコピーできる方法であれば、任意の方法を使ってサブスクリプションを初期化することができます。</span><span class="sxs-lookup"><span data-stu-id="644c6-143">It is possible to initialize a subscription using any method that allows you to copy the publication database schema and data to the Subscriber, such as [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)].</span></span> <span data-ttu-id="644c6-144">代替手段を使用してサブスクライバーを初期化すると、レプリケーション サポート オブジェクトはサブスクライバーにコピーされます。</span><span class="sxs-lookup"><span data-stu-id="644c6-144">When you use an alternative method to initialize the Subscriber, replication support objects are copied to the Subscriber.</span></span>  
  
 <span data-ttu-id="644c6-145">バックアップを使用して初期化する場合と違い、サブスクリプションを追加した時点でデータとスキーマが正しく同期されていることを手動またはアプリケーションで確認する必要があります。</span><span class="sxs-lookup"><span data-stu-id="644c6-145">Unlike initializing with a backup, you or your application must ensure the data and schema are properly synchronized at the time you add the subscription.</span></span> <span data-ttu-id="644c6-146">たとえば、データとスキーマをサブスクライバーにコピーしてからサブスクリプションを追加するまでの間にパブリッシャー上で処理が実行されると、この処理による変更がサブスクライバーにレプリケートされない場合があります。</span><span class="sxs-lookup"><span data-stu-id="644c6-146">If, for example, there is activity on the Publisher between the time data and schema are copied to the Subscriber and the time at which the subscription is added, changes resulting from this activity might not be replicated to the Subscriber.</span></span>  
  
 <span data-ttu-id="644c6-147">代替手段を使用してサブスクリプションを初期化するには、「 [Initialize a Subscription Manually](initialize-a-subscription-manually.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="644c6-147">To initialize a subscription with an alternative method, see [Initialize a Subscription Manually](initialize-a-subscription-manually.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="644c6-148">参照</span><span class="sxs-lookup"><span data-stu-id="644c6-148">See Also</span></span>  
 [<span data-ttu-id="644c6-149">サブスクリプションを初期化する</span><span class="sxs-lookup"><span data-stu-id="644c6-149">Initialize a Subscription</span></span>](initialize-a-subscription.md)  
  
  
