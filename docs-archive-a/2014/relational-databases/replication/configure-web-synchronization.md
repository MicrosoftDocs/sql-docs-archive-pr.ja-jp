---
title: Web 同期の構成 | Microsoft Docs
ms.custom: ''
ms.date: 01/10/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
f1_keywords:
- SQL10.REP.CONFIGWEBSYNCWIZARD.SUBTYPE.F1
- SQL10.REP.CONFIGWEBSYNCWIZARD.CLIENTAUTH.F1
- SQL10.REP.CONFIGWEBSYNCWIZARD.WEBSERV.F1
- SQL10.REP.CONFIGWEBSYNCWIZARD.DIRACCESS.F1
- SQL10.REP.CONFIGWEBSYNCWIZARD.VIRDIRINFO.F1
- SQL10.REP.CONFIGWEBSYNCWIZARD.AUTHACCESS.F1
- SQL10.REP.CONFIGWEBSYNCWIZARD.COMPLETEWIZ.F1
- SQL10.REP.CONFIGWEBSYNCWIZARD.ANONACCESS.F1
- SQL10.REP.CONFIGWEBSYNCWIZARD.SNAPSHARE.F1
helpviewer_keywords:
- Web synchronization, security best practices
- Web synchronization, configuring
ms.assetid: 21f8e4d4-cd07-4856-98f0-9c9890ebbc82
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 406175533b92d13dce8c14b91b654fbb6099dc22
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87631835"
---
# <a name="configure-web-synchronization"></a><span data-ttu-id="ae59f-102">Web 同期の構成</span><span class="sxs-lookup"><span data-stu-id="ae59f-102">Configure Web Synchronization</span></span>
  <span data-ttu-id="ae59f-103">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] マージ レプリケーションの Web 同期オプションを使用すると、インターネット経由で HTTPS プロトコルを使用してデータをレプリケートできます。</span><span class="sxs-lookup"><span data-stu-id="ae59f-103">The Web synchronization option for [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Merge Replication enables data replication using the HTTPS protocol over the Internet.</span></span> <span data-ttu-id="ae59f-104">Web 同期を使用するには、最初に次の構成操作を実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ae59f-104">To use Web synchronization, you first need to perform the following configuration actions:</span></span>  
  
1.  <span data-ttu-id="ae59f-105">新しいドメイン アカウントを作成し、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ログインをマップします。</span><span class="sxs-lookup"><span data-stu-id="ae59f-105">Create new domain accounts and map [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] logins.</span></span>  
  
2.  <span data-ttu-id="ae59f-106">[!INCLUDE[msCoName](../../includes/msconame-md.md)] インターネット インフォメーション サービス (IIS) を実行しているコンピューターで、サブスクリプションが同期されるように構成します。</span><span class="sxs-lookup"><span data-stu-id="ae59f-106">Configure the computer that is running [!INCLUDE[msCoName](../../includes/msconame-md.md)] Internet Information Services (IIS) to synchronize subscriptions.</span></span>  
  
3.  <span data-ttu-id="ae59f-107">Web 同期が許可されるようにマージ パブリケーションを構成します。</span><span class="sxs-lookup"><span data-stu-id="ae59f-107">Configure a merge publication to allow Web synchronization.</span></span>  
  
4.  <span data-ttu-id="ae59f-108">Web 同期が使用されるように 1 つ以上のサブスクリプションを構成します。</span><span class="sxs-lookup"><span data-stu-id="ae59f-108">Configure one or more subscriptions to use Web synchronization.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="ae59f-109">大量のデータや `varchar(max)` などのサイズの大きなデータ型を含むデータをレプリケートする場合は、このトピックの「大量のデータのレプリケート」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ae59f-109">If you plan to replicate large volumes of data or use large data types such as `varchar(max)`, read the section "Replicating Large Volumes of Data" in this topic.</span></span>  
  
 <span data-ttu-id="ae59f-110">Web 同期を正しく設定するには、特定の要件やポリシーを満たすためにセキュリティをどのように構成するかを決める必要があります。</span><span class="sxs-lookup"><span data-stu-id="ae59f-110">To successfully set up Web synchronization, you must decide how you will configure security to meet your particular requirements and policies.</span></span> <span data-ttu-id="ae59f-111">先にこれらについて決定し、必要なアカウントを作成してから、IIS、パブリケーション、およびサブスクリプションの構成を開始することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="ae59f-111">It is best to make these decisions and create the necessary accounts before you attempt to configure IIS, the publication, and subscriptions.</span></span>  
  
 <span data-ttu-id="ae59f-112">以降の手順では、説明を簡単にするために、ローカル アカウントを使用した場合の簡素化されたセキュリティ構成について説明します。</span><span class="sxs-lookup"><span data-stu-id="ae59f-112">In the procedures that follow, a simplified security configuration using local accounts is described, for brevity.</span></span> <span data-ttu-id="ae59f-113">この簡素化された構成は、IIS と [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] のパブリッシャーおよびディストリビューターの両方を同一のコンピューターで実行する環境に適しています。ただし、運用環境ではマルチサーバー トポロジを使用する可能性が高く、その方が推奨されます。</span><span class="sxs-lookup"><span data-stu-id="ae59f-113">This simplified configuration is suitable for installations where both IIS and the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Publisher and Distributor are running on the same computer, even though it is much more likely (and recommended) that you will use a multiple-server topology for a production installation.</span></span> <span data-ttu-id="ae59f-114">この手順のローカル アカウントは、ドメイン アカウントに置き換えることもできます。</span><span class="sxs-lookup"><span data-stu-id="ae59f-114">You can substitute domain accounts for the local accounts in the procedures.</span></span>  
  
## <a name="creating-new-accounts-and-mapping-sql-server-logins"></a><span data-ttu-id="ae59f-115">新しいアカウントの作成と SQL Server ログインのマッピング</span><span class="sxs-lookup"><span data-stu-id="ae59f-115">Creating New Accounts and Mapping SQL Server Logins</span></span>  
 <span data-ttu-id="ae59f-116">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] レプリケーション リスナー (replisapi.dll) は、レプリケーション Web サイトに関連付けられたアプリケーション プールに指定されているアカウントを借用することでパブリッシャーに接続します。</span><span class="sxs-lookup"><span data-stu-id="ae59f-116">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Replication Listener (replisapi.dll) connects to the Publisher by impersonating the account specified for the application pool that is associated with the replication web site.</span></span>  
  
 <span data-ttu-id="ae59f-117">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] レプリケーション リスナーに使用するアカウントには、「[Merge Agent Security](merge-agent-security.md)」(マージ エージェント セキュリティ) の「Connect to the Publisher or Distributor」(パブリッシャーまたはディストリビューターへの接続) で説明されている権限が必要です。</span><span class="sxs-lookup"><span data-stu-id="ae59f-117">The account used for the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Replication Listener must have permissions as described in [Merge Agent Security](merge-agent-security.md), under the section "Connect to the Publisher or Distributor."</span></span> <span data-ttu-id="ae59f-118">このアカウントに必要な権限の概要を以下に示します。</span><span class="sxs-lookup"><span data-stu-id="ae59f-118">In summary, the account must:</span></span>  
  
-   <span data-ttu-id="ae59f-119">パブリケーション アクセス リスト (PAL) のメンバーである。</span><span class="sxs-lookup"><span data-stu-id="ae59f-119">Be a member of the Publication Access List (PAL).</span></span>  
  
-   <span data-ttu-id="ae59f-120">パブリケーション データベースのユーザーに関連付けられたログインにマップされている。</span><span class="sxs-lookup"><span data-stu-id="ae59f-120">Be mapped to a login associated with a user in the publication database.</span></span>  
  
-   <span data-ttu-id="ae59f-121">ディストリビューション データベース内のユーザーに関連付けられているログインにマップされている。</span><span class="sxs-lookup"><span data-stu-id="ae59f-121">Be mapped to a login associated with a user in the distribution database.</span></span>  
  
-   <span data-ttu-id="ae59f-122">スナップショット共有の読み取り権限を持つ。</span><span class="sxs-lookup"><span data-stu-id="ae59f-122">Have Read permissions on the snapshot share.</span></span>  
  
 <span data-ttu-id="ae59f-123">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] レプリケーションを初めて使用する場合は、レプリケーション エージェントのアカウントとログインも作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ae59f-123">If this is the first time you are using [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Replication, you will also need to create accounts and logins for the replication agents.</span></span> <span data-ttu-id="ae59f-124">詳細については、このトピックの「パブリケーションの構成」および「サブスクリプションの構成」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ae59f-124">For more information, see the "Configuring the Publication" and "Configuring the Subscription" sections in this topic.</span></span>  
  
 <span data-ttu-id="ae59f-125">Web 同期を構成する前に、このトピックの「Web 同期のセキュリティの推奨事項」を一読することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="ae59f-125">Before you configure Web synchronization, we recommend that you read the "Security Best Practices for Web Synchronization" section in this topic.</span></span> <span data-ttu-id="ae59f-126">Web 同期のセキュリティの詳細については、「 [Security Architecture for Web Synchronization](security/security-architecture-for-web-synchronization.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ae59f-126">For more information about Web synchronization security, see [Security Architecture for Web Synchronization](security/security-architecture-for-web-synchronization.md).</span></span>  
  
## <a name="configuring-the-computer-that-is-running-iis"></a><span data-ttu-id="ae59f-127">IIS を実行しているコンピューターの構成</span><span class="sxs-lookup"><span data-stu-id="ae59f-127">Configuring the Computer That Is Running IIS</span></span>  
 <span data-ttu-id="ae59f-128">Web 同期を使用するには、IIS をインストールして構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ae59f-128">Web synchronization requires that you install and configure IIS.</span></span> <span data-ttu-id="ae59f-129">レプリケーション Web サイトの URL がないと、Web 同期を使用するようにパブリケーションを構成できません。</span><span class="sxs-lookup"><span data-stu-id="ae59f-129">You will need the URL to the replication Web site before you can configure a publication to use Web synchronization.</span></span>  
  
<span data-ttu-id="ae59f-130">Web 同期は、バージョン 5.0 以降の IIS でサポートされます。</span><span class="sxs-lookup"><span data-stu-id="ae59f-130">Web synchronization is supported on IIS beginning with version 5.0.</span></span> <span data-ttu-id="ae59f-131">IIS 7.0 では、Web 同期の構成ウィザードはサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="ae59f-131">The Configure Web Synchronization Wizard is not supported on IIS version 7.0.</span></span> <span data-ttu-id="ae59f-132">SQL Server 2012 以降では、IIS サーバーで Web 同期コンポーネントを使用する場合は、レプリケーションとともに SQL Server をインストールすることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="ae59f-132">Beginning with SQL Server 2012, to use the web sync component on IIS server, we recommend users install SQL Server with replication.</span></span> <span data-ttu-id="ae59f-133">これは無料の SQL Server Express edition で構いません。</span><span class="sxs-lookup"><span data-stu-id="ae59f-133">This can be the free SQL Server Express edition.</span></span>  
  
 <span data-ttu-id="ae59f-134">Web 同期では SSL は必須です。</span><span class="sxs-lookup"><span data-stu-id="ae59f-134">SSL is required for Web synchronization.</span></span> <span data-ttu-id="ae59f-135">証明機関によって発行されたセキュリティ証明書が必要になります。</span><span class="sxs-lookup"><span data-stu-id="ae59f-135">You will need a security certificate issued by a certification authority.</span></span> <span data-ttu-id="ae59f-136">テストだけが目的の場合は、独自に発行したセキュリティ証明書を使用できます。</span><span class="sxs-lookup"><span data-stu-id="ae59f-136">For testing purposes only, you can use a self-issued security certificate.</span></span>  
  
  
 <span data-ttu-id="ae59f-137">**Web 同期用に IIS を構成するには**</span><span class="sxs-lookup"><span data-stu-id="ae59f-137">**To configure IIS for Web synchronization**</span></span>  
  
-   [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]<span data-ttu-id="ae59f-138">:[Web 同期用の IIS の構成](configure-iis-for-web-synchronization.md)</span><span class="sxs-lookup"><span data-stu-id="ae59f-138">: [Configure IIS for Web Synchronization](configure-iis-for-web-synchronization.md)</span></span>  
  
-   [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]<span data-ttu-id="ae59f-139">:[Web 同期用の IIS 7 の構成](configure-iis-7-for-web-synchronization.md)</span><span class="sxs-lookup"><span data-stu-id="ae59f-139">: [Configure IIS 7 for Web Synchronization](configure-iis-7-for-web-synchronization.md)</span></span>  
  
## <a name="creating-a-web-garden"></a><span data-ttu-id="ae59f-140">Web ガーデンの作成</span><span class="sxs-lookup"><span data-stu-id="ae59f-140">Creating a Web Garden</span></span>  
 <span data-ttu-id="ae59f-141">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] レプリケーション リスナーでは、スレッドごとに同時に 2 つの同期処理がサポートされます。</span><span class="sxs-lookup"><span data-stu-id="ae59f-141">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Replication Listener supports two concurrent synchronization operations per thread.</span></span> <span data-ttu-id="ae59f-142">この制限を超えると、レプリケーション リスナーが応答しなくなる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="ae59f-142">Exceeding this limit may cause the Replication Listener to stop responding.</span></span> <span data-ttu-id="ae59f-143">replisapi.dll に割り当てられるスレッドの数は、アプリケーション プールの "ワーカー プロセスの最大数" プロパティで決まります。</span><span class="sxs-lookup"><span data-stu-id="ae59f-143">The number of threads allocated to replisapi.dll is determined by the application pool Maximum Worker Processes property.</span></span> <span data-ttu-id="ae59f-144">既定では、このプロパティは 1 に設定されます。</span><span class="sxs-lookup"><span data-stu-id="ae59f-144">By default, this property is set at 1.</span></span>  
  
 <span data-ttu-id="ae59f-145">1 つの CPU で同時にサポートできる同期処理の数を増やすには、"ワーカー プロセスの最大数" プロパティの値を大きくします。</span><span class="sxs-lookup"><span data-stu-id="ae59f-145">You can support a greater number of concurrent synchronization operations per CPU by increasing the Maximum Worker Process property value.</span></span> <span data-ttu-id="ae59f-146">CPU ごとのワーカー プロセスの数を増やしてスケールアウトすることを、"Web ガーデン" を作成するといいます。</span><span class="sxs-lookup"><span data-stu-id="ae59f-146">Scaling out by increasing the number of worker processes per CPU is known as creating a "Web garden."</span></span>  
  
 <span data-ttu-id="ae59f-147">Web ガーデンを作成すると、同時に 3 つ以上のサブスクライバーを同期できるようになります。</span><span class="sxs-lookup"><span data-stu-id="ae59f-147">Web gardening will allow more than two Subscribers to synchronize at the same time.</span></span> <span data-ttu-id="ae59f-148">このとき、replisapi.dll による CPU 使用率も増加するため、サーバーの全体的なパフォーマンスは低下することがあります。</span><span class="sxs-lookup"><span data-stu-id="ae59f-148">It will also increase CPU utilization by replisapi.dll, which can negatively impact overall server performance.</span></span> <span data-ttu-id="ae59f-149">"ワーカー プロセスの最大数" の値を選択するときは、それらのバランスを考慮することが重要です。</span><span class="sxs-lookup"><span data-stu-id="ae59f-149">It is important to balance these considerations when you choose a value for Maximum Worker Processes.</span></span>  
  
#### <a name="to-increase-maximum-worker-processes-in-iis-7"></a><span data-ttu-id="ae59f-150">IIS 7 のワーカー プロセスの最大数を増やすには</span><span class="sxs-lookup"><span data-stu-id="ae59f-150">To increase Maximum Worker Processes in IIS 7</span></span>  
  
1.  <span data-ttu-id="ae59f-151">**インターネット インフォメーション サービス (IIS) マネージャー**で、ローカル サーバーのノードを展開し、 **[アプリケーション プール]** ノードをクリックします。</span><span class="sxs-lookup"><span data-stu-id="ae59f-151">In **Internet Information Services (IIS) Manager**, expand the local server node, and then click on the **Application Pool** node.</span></span>  
  
2.  <span data-ttu-id="ae59f-152">Web 同期サイトに関連付けられているアプリケーション プールを選択し、 **[アクション]** ペインの **[詳細設定]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="ae59f-152">Select the application pool associated with the Web synchronization site, and then click **Advanced Settings** on the **Actions** pane.</span></span>  
  
3.  <span data-ttu-id="ae59f-153">[詳細設定] ダイアログで、 **[モデルの処理]** という見出しの下にある **[ワーカー プロセスの最大数]** というラベルの行をクリックします。</span><span class="sxs-lookup"><span data-stu-id="ae59f-153">On the Advanced Settings dialog, under the **Process Model** heading, click the row labeled **Maximum Worker Processes**.</span></span> <span data-ttu-id="ae59f-154">プロパティの値を変更し、 **[OK]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="ae59f-154">Change the property value, and then click **OK**.</span></span>  
  
## <a name="configuring-the-publication"></a><span data-ttu-id="ae59f-155">パブリケーションの構成</span><span class="sxs-lookup"><span data-stu-id="ae59f-155">Configuring the Publication</span></span>  
 <span data-ttu-id="ae59f-156">Web 同期を使用するには、標準のマージ トポロジと同じ方法でパブリケーションを作成します。</span><span class="sxs-lookup"><span data-stu-id="ae59f-156">To use Web synchronization, create a publication in the same way that you would for a standard merge topology.</span></span> <span data-ttu-id="ae59f-157">詳細については、「[Publish Data and Database Objects](publish/publish-data-and-database-objects.md)」(データとデータベース オブジェクトのパブリッシュ) をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ae59f-157">For more information, see [Publish Data and Database Objects](publish/publish-data-and-database-objects.md).</span></span>  
  
 <span data-ttu-id="ae59f-158">パブリケーションを作成した後、 [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]、 [!INCLUDE[tsql](../../includes/tsql-md.md)]、レプリケーション管理オブジェクト (RMO) のいずれかを使用して、Web 同期を許可するオプションを有効にします。</span><span class="sxs-lookup"><span data-stu-id="ae59f-158">After the publication is created, enable the option to allow for Web synchronization by using one of the following methods: [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../includes/tsql-md.md)], or Replication Management Objects (RMO).</span></span> <span data-ttu-id="ae59f-159">Web 同期を有効にするには、サブスクライバー接続の Web サーバー アドレスを指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ae59f-159">To enable Web synchronization, you will need to supply the Web server address for Subscriber connections.</span></span>  
  
 <span data-ttu-id="ae59f-160">初めてパブリッシャーを使用している場合は、ディストリビューターおよびスナップショット共有も構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ae59f-160">If you are using a Publisher for the first time, you must also configure a Distributor and a snapshot share.</span></span> <span data-ttu-id="ae59f-161">各サブスクライバー側のマージ エージェントには、スナップショット共有の読み取り権限が必要です。</span><span class="sxs-lookup"><span data-stu-id="ae59f-161">The Merge Agent at each Subscriber must have read permissions on the snapshot share.</span></span> <span data-ttu-id="ae59f-162">詳細については、「[Configure Distribution](configure-distribution.md)」(ディストリビューションの構成) と「[Secure the Snapshot Folder](security/secure-the-snapshot-folder.md)」(スナップショット フォルダーのセキュリティ保護) をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ae59f-162">For more information, see [Configure Distribution](configure-distribution.md) and [Secure the Snapshot Folder](security/secure-the-snapshot-folder.md).</span></span>  
  
 <span data-ttu-id="ae59f-163">`gen` は、websync xml ファイルの予約語です。</span><span class="sxs-lookup"><span data-stu-id="ae59f-163">`gen` is a reserved word in websync xml files.</span></span> <span data-ttu-id="ae59f-164">`gen` という名前の列を含むテーブルをパブリッシュしようとしないでください。</span><span class="sxs-lookup"><span data-stu-id="ae59f-164">Do not attempt to publish tables containing columns named `gen`.</span></span>  
  
## <a name="configuring-the-subscription"></a><span data-ttu-id="ae59f-165">サブスクリプションの構成</span><span class="sxs-lookup"><span data-stu-id="ae59f-165">Configuring the Subscription</span></span>  
 <span data-ttu-id="ae59f-166">パブリケーションを有効にし、IIS を構成した後、プル サブスクリプションを作成し、そのプル サブスクリプションが IIS を使用して同期するように指定します。</span><span class="sxs-lookup"><span data-stu-id="ae59f-166">After you enable a publication and configure IIS, create a pull subscription and specify that the pull subscription should synchronize by using IIS.</span></span> <span data-ttu-id="ae59f-167">(Web 同期はプル サブスクリプションでのみサポートされます)。</span><span class="sxs-lookup"><span data-stu-id="ae59f-167">(Web synchronization is supported only for pull subscriptions.)</span></span>  
  
## <a name="upgrading-from-an-earlier-version-of-sql-server"></a><span data-ttu-id="ae59f-168">以前のバージョンの SQL Server からのアップグレード</span><span class="sxs-lookup"><span data-stu-id="ae59f-168">Upgrading from an Earlier Version of SQL Server</span></span>  
 <span data-ttu-id="ae59f-169">既存の構成済み Web 同期トポロジがあるときに、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]をアップグレードする場合は、Replisapi.dll の最新バージョンが、Web 同期で使用される仮想ディレクトリにコピーされていることを確認する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ae59f-169">If you have an existing Web synchronization topology configured and you upgrade [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], you must ensure that the latest version of Replisapi.dll is copied to the virtual directory used by Web synchronization.</span></span> <span data-ttu-id="ae59f-170">既定では、Replisapi.dll の最新バージョンは C:\Program Files\Microsoft SQL Server\\<nnn\>\COM にあります。</span><span class="sxs-lookup"><span data-stu-id="ae59f-170">By default, the latest version of Replisapi.dll is located in C:\Program Files\Microsoft SQL Server\\<nnn\>\COM.</span></span>  
  
## <a name="replicating-large-volumes-of-data"></a><span data-ttu-id="ae59f-171">大量のデータのレプリケート</span><span class="sxs-lookup"><span data-stu-id="ae59f-171">Replicating Large Volumes of Data</span></span>  
 <span data-ttu-id="ae59f-172">サブスクライバー コンピューター上で発生する可能性があるメモリの問題を回避できるように、Web 同期では、変更の転送に使用する XML ファイルに既定の最大サイズの 100 MB を使用します。</span><span class="sxs-lookup"><span data-stu-id="ae59f-172">To help avoid potential memory problems on Subscriber computers Web synchronization uses a default maximum size of 100 MB for the XML file used to transfer changes.</span></span> <span data-ttu-id="ae59f-173">この制限は、次のレジストリ キーを設定して引き上げることができます。</span><span class="sxs-lookup"><span data-stu-id="ae59f-173">The limit can be raised by setting the following registry key:</span></span>  
  
 <span data-ttu-id="ae59f-174">**HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Microsoft SQL Server\100\Replication**</span><span class="sxs-lookup"><span data-stu-id="ae59f-174">**HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Microsoft SQL Server\100\Replication**</span></span>  
  
 <span data-ttu-id="ae59f-175">**WebSyncMaxXmlSize DWORD 2000000**</span><span class="sxs-lookup"><span data-stu-id="ae59f-175">**WebSyncMaxXmlSize DWORD 2000000**</span></span>  
  
 <span data-ttu-id="ae59f-176">このキーに許容される値の範囲は 100 MB ～ 4 GB です。</span><span class="sxs-lookup"><span data-stu-id="ae59f-176">The range of acceptable values for this key is 100 MB to 4GB.</span></span> <span data-ttu-id="ae59f-177">値は KB 単位で指定します。</span><span class="sxs-lookup"><span data-stu-id="ae59f-177">The value is specified in KB.</span></span> <span data-ttu-id="ae59f-178">このパラメーターに大きな値を設定することで、その量のデータを同期できることが保証されるわけではありません。</span><span class="sxs-lookup"><span data-stu-id="ae59f-178">Setting this parameter to a high value does not guarantee that you can synchronize that amount of data.</span></span> <span data-ttu-id="ae59f-179">サブスクライバー コンピューター上で使用できる連続したメモリの量によって制限することが効果的です。</span><span class="sxs-lookup"><span data-stu-id="ae59f-179">The effective limit is constrained by how much contiguous memory is available on the Subscriber computer.</span></span> <span data-ttu-id="ae59f-180">100 MB を超える値を設定する必要がある場合は、値を段階的に増加させ、サブスクライバー上の一般的なワークロードでメモリの使用量をテストすることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="ae59f-180">If you must have a value larger than 100 MB, we recommend that you increase the value incrementally and test memory consumption with a typical workload on the Subscriber.</span></span>  
  
 <span data-ttu-id="ae59f-181">XML ファイルの最大サイズが 4 GB でも、バッチ内のそのファイルからの変更がレプリケーションによって同期されます。</span><span class="sxs-lookup"><span data-stu-id="ae59f-181">The maximum size for the XML file is 4 GB, but replication synchronizes the changes from that file in batches.</span></span> <span data-ttu-id="ae59f-182">データとメタデータの最大バッチ サイズは 25 MB です。</span><span class="sxs-lookup"><span data-stu-id="ae59f-182">The maximum batch size of data and metadata is 25 MB.</span></span> <span data-ttu-id="ae59f-183">各バッチ内のデータが約 20 MB を超えないようにする必要があります。この場合、メタデータやその他のオーバーヘッドも考慮に入れます。</span><span class="sxs-lookup"><span data-stu-id="ae59f-183">You must ensure that the data in each batch does not exceed approximately 20 MB, which allows for metadata and any other overhead.</span></span> <span data-ttu-id="ae59f-184">この制限による影響を次に示します。</span><span class="sxs-lookup"><span data-stu-id="ae59f-184">This limit has the following implications:</span></span>  
  
-   <span data-ttu-id="ae59f-185">データとメタデータが 25 MB を超す要因となる列はレプリケートできません。</span><span class="sxs-lookup"><span data-stu-id="ae59f-185">You cannot replicate any column that causes the data and metadata to exceed 25 MB.</span></span> <span data-ttu-id="ae59f-186">これは、`varchar(max)` などのサイズの大きなデータ型を含む行をレプリケートするときに問題になる場合があります。</span><span class="sxs-lookup"><span data-stu-id="ae59f-186">This might be an issue when you are replicating rows that contain large data types, such as `varchar(max)`.</span></span>  
  
-   <span data-ttu-id="ae59f-187">大量のデータをレプリケートする場合に、マージ エージェントのバッチ サイズの調整が必要になることがあります。</span><span class="sxs-lookup"><span data-stu-id="ae59f-187">If you replicate large volumes of data, you might have to adjust the Merge Agent batch size.</span></span>  
  
 <span data-ttu-id="ae59f-188">マージ レプリケーションのバッチ サイズは、アーティクルごとの変更のコレクションである *生成結果*で示されます。</span><span class="sxs-lookup"><span data-stu-id="ae59f-188">Batch size for merge replication is measured in *generations*, which are collections of changes per article.</span></span> <span data-ttu-id="ae59f-189">バッチ内の生成の数は、 `DownloadGenerationsPerBatch` マージエージェントの-パラメーターと-パラメーターを使用して指定し `UploadGenerationsPerBatch` ます。</span><span class="sxs-lookup"><span data-stu-id="ae59f-189">The number of generations in a batch is specified by using the-`DownloadGenerationsPerBatch` and -`UploadGenerationsPerBatch` parameters of the Merge Agent.</span></span> <span data-ttu-id="ae59f-190">詳細については、「 [Replication Merge Agent](agents/replication-merge-agent.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ae59f-190">For more information, see [Replication Merge Agent](agents/replication-merge-agent.md).</span></span>  
  
 <span data-ttu-id="ae59f-191">大量のデータを扱う場合は、バッチ処理の各パラメーターに小さい数を指定します。</span><span class="sxs-lookup"><span data-stu-id="ae59f-191">For large volumes of data, specify a small number for each of the batching parameters.</span></span> <span data-ttu-id="ae59f-192">最初は値を 10 にして、アプリケーションのニーズとパフォーマンスに応じて調整することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="ae59f-192">We recommend that you start with a value of 10, and then tune based on application needs and performance.</span></span> <span data-ttu-id="ae59f-193">通常、これらのパラメーターは、エージェント プロファイルで指定します。</span><span class="sxs-lookup"><span data-stu-id="ae59f-193">Typically, these parameters are specified in an agent profile.</span></span> <span data-ttu-id="ae59f-194">プロファイルの詳細については、「 [Replication Agent Profiles](agents/replication-agent-profiles.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ae59f-194">For more information about profiles, see [Replication Agent Profiles](agents/replication-agent-profiles.md).</span></span>  
  
## <a name="security-best-practices-for-web-synchronization"></a><span data-ttu-id="ae59f-195">Web 同期のセキュリティの推奨事項</span><span class="sxs-lookup"><span data-stu-id="ae59f-195">Security Best Practices for Web Synchronization</span></span>  
 <span data-ttu-id="ae59f-196">Web 同期にはセキュリティ関連の選択項目が多数あります。</span><span class="sxs-lookup"><span data-stu-id="ae59f-196">There are many choices for security-related settings in Web synchronization.</span></span> <span data-ttu-id="ae59f-197">次の方法が推奨されます。</span><span class="sxs-lookup"><span data-stu-id="ae59f-197">We recommend the following approach:</span></span>  
  
-   <span data-ttu-id="ae59f-198">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ディストリビューターおよびパブリッシャーは、同じコンピューター上に存在できます (マージ レプリケーションの一般的なセットアップ)。</span><span class="sxs-lookup"><span data-stu-id="ae59f-198">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Distributor and Publisher can be on the same computer (a typical setup for merge replication).</span></span> <span data-ttu-id="ae59f-199">ただし、IIS は別のコンピューターにインストールする必要があります。</span><span class="sxs-lookup"><span data-stu-id="ae59f-199">However, IIS should be installedon a separate computer.</span></span>  
  
-   <span data-ttu-id="ae59f-200">SSL (Secure Sockets Layer) を使用して、IIS を実行しているコンピューターとサブスクライバーとの間の接続を暗号化します。</span><span class="sxs-lookup"><span data-stu-id="ae59f-200">Use Secure Sockets Layer (SSL) to encrypt the connection between the Subscriber and the computer running IIS.</span></span> <span data-ttu-id="ae59f-201">これは、Web 同期では必須です。</span><span class="sxs-lookup"><span data-stu-id="ae59f-201">This is required for Web synchronization.</span></span>  
  
-   <span data-ttu-id="ae59f-202">サブスクライバーから IIS までの接続に基本認証を使用します。</span><span class="sxs-lookup"><span data-stu-id="ae59f-202">Use Basic Authentication for connections from the Subscriber to IIS.</span></span> <span data-ttu-id="ae59f-203">基本認証を使用すると、IIS では、委任を必要とすることなくサブスクライバーの代わりにパブリッシャーやディストリビューターに接続できます。</span><span class="sxs-lookup"><span data-stu-id="ae59f-203">Using Basic Authentication, IIS can make connections to the Publisher/Distributor on behalf of the Subscriber without requiring delegation.</span></span> <span data-ttu-id="ae59f-204">統合認証を使用する場合は、委任が必要です。</span><span class="sxs-lookup"><span data-stu-id="ae59f-204">Delegation is required if you use Integrated Authentication.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="ae59f-205">基本認証は、資格情報を IIS に渡すための方法です。</span><span class="sxs-lookup"><span data-stu-id="ae59f-205">Basic Authentication is the method by which credentials are passed to IIS.</span></span> <span data-ttu-id="ae59f-206">基本認証を使用しても、IIS への接続に Windows ドメイン アカウントを指定する機能には影響ありません。</span><span class="sxs-lookup"><span data-stu-id="ae59f-206">Basic Authentication does not prevent specifying Windows domain accounts for connections that are made to IIS.</span></span>  
  
-   <span data-ttu-id="ae59f-207">スナップショット エージェントを Windows ドメイン アカウントで実行するように指定し、エージェントがそのアカウントとして接続を確立するように指定します</span><span class="sxs-lookup"><span data-stu-id="ae59f-207">Specify that the Snapshot Agent should run under a Windows domain account, and specify that the agent should make connections as that account.</span></span> <span data-ttu-id="ae59f-208">(これは既定の構成です)。各マージ エージェントを、サブスクライバー コンピューターを使用するユーザーのドメイン アカウントで実行するように指定し、エージェントがそのアカウントとして接続を確立するように指定します。</span><span class="sxs-lookup"><span data-stu-id="ae59f-208">(This is the default configuration.) Specify that each Merge Agent should run under the domain account of the user that uses the Subscriber computer, and specify that the agent should make connections as that account.</span></span>  
  
     <span data-ttu-id="ae59f-209">エージェントに必要な権限の詳細については、「 [Replication Agent Security Model](security/replication-agent-security-model.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ae59f-209">For more information about the permissions that are required by agents, see [Replication Agent Security Model](security/replication-agent-security-model.md).</span></span>  
  
-   <span data-ttu-id="ae59f-210">サブスクリプションの新規作成ウィザードの [ **Web サーバー情報**] ページでアカウントとパスワードを指定するとき、または **@internet_url** **@internet_login** [sp_addpullsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-agent-transact-sql)のパラメーターとパラメーターに値を指定するときに、マージエージェントで使用するものと同じドメインアカウントを指定します。</span><span class="sxs-lookup"><span data-stu-id="ae59f-210">Specify the same domain account as the one the Merge Agent uses when you specify an account and password on the **Web Server Information** page of the New Subscription Wizard or when you specify values for the **@internet_url** and **@internet_login** parameters of [sp_addpullsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-agent-transact-sql).</span></span> <span data-ttu-id="ae59f-211">このアカウントには、スナップショット共有の読み取り権限が必要です。</span><span class="sxs-lookup"><span data-stu-id="ae59f-211">This account must have read permissions for the snapshot share.</span></span>  
  
-   <span data-ttu-id="ae59f-212">各パブリケーションでは、IIS 用に個別の仮想ディレクトリを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ae59f-212">Each publication should use a separate virtual directory for IIS.</span></span>  
  
-   <span data-ttu-id="ae59f-213">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] レプリケーション リスナー (Replisapi.dll) の実行に使用するアカウントは、同期の際にパブリッシャーとディストリビューターに接続するアカウントでもあります。</span><span class="sxs-lookup"><span data-stu-id="ae59f-213">The account under which the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Replication Listener (Replisapi.dll) runs is also the account that will connect to the Publisher and Distributor during synchronization.</span></span> <span data-ttu-id="ae59f-214">したがって、パブリッシャーとディストリビューターで SQL ログイン アカウントにマップされている必要があります。</span><span class="sxs-lookup"><span data-stu-id="ae59f-214">This account must be mapped to a SQL Login account on the Publisher and Distributor.</span></span> <span data-ttu-id="ae59f-215">詳細については、「[Configure IIS for Web Synchronization](configure-iis-for-web-synchronization.md)」(Web 同期用の IIS の構成) の「Setting Permissions for the SQL Server Replication Listener」(SQL Server レプリケーション リスナーの権限の設定) セクションをご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ae59f-215">For more information, see the "Setting Permissions for the SQL Server Replication Listener" section in the [Configure IIS for Web Synchronization](configure-iis-for-web-synchronization.md).</span></span>  
  
-   <span data-ttu-id="ae59f-216">IIS を実行しているコンピューターにパブリッシャーからスナップショットを配信するときに、FTP を使用できます。</span><span class="sxs-lookup"><span data-stu-id="ae59f-216">You can use FTP to deliver the snapshot from the Publisher to the computer that is running IIS.</span></span> <span data-ttu-id="ae59f-217">IIS を実行しているコンピューターからサブスクライバーにスナップショットを配信するときには、常に HTTPS が使用されます。</span><span class="sxs-lookup"><span data-stu-id="ae59f-217">The snapshot is always delivered from the computer that is running IIS to the Subscriber by using HTTPS.</span></span> <span data-ttu-id="ae59f-218">詳細については、「[FTP によるスナップショットの転送](transfer-snapshots-through-ftp.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ae59f-218">For more information, see [Transfer Snapshots Through FTP](transfer-snapshots-through-ftp.md).</span></span>  
  
-   <span data-ttu-id="ae59f-219">レプリケーション トポロジ内のサーバーがファイアウォールの内側にあるとき、Web 同期を有効にするために、ファイアウォールのポートを開くことが必要になる場合があります。</span><span class="sxs-lookup"><span data-stu-id="ae59f-219">If servers in the replication topology are behind a firewall, you might need to open ports in the firewall to enable Web synchronization.</span></span>  
  
    -   <span data-ttu-id="ae59f-220">サブスクライバー コンピューターは、SSL を使用する HTTPS (通常はポート 443 を使用するように構成されます) 経由で、IIS を実行しているコンピューターに接続します。</span><span class="sxs-lookup"><span data-stu-id="ae59f-220">The Subscriber computer connects to the computer that is running IIS over HTTPS using SSL, which is typically configured to use port 443.</span></span> [!INCLUDE[ssEW](../../includes/ssew-md.md)] <span data-ttu-id="ae59f-221">サブスクライバーは、HTTP (通常はポート 80 を使用するように構成されます) 経由の接続を実行することもできます。</span><span class="sxs-lookup"><span data-stu-id="ae59f-221">Subscribers can also connect over HTTP, which is typically configured to use port 80.</span></span>  
  
    -   <span data-ttu-id="ae59f-222">通常、IIS を実行しているコンピューターは、ポート 1433 (既定のインスタンス用) を使用してパブリッシャーまたはディストリビューターに接続します。</span><span class="sxs-lookup"><span data-stu-id="ae59f-222">The computer that is running IIS typically connects to the Publisher or Distributor using port 1433 (default instance).</span></span> <span data-ttu-id="ae59f-223">パブリッシャーまたはディストリビューターが、サーバー上の既定のインスタンスとは別に存在する名前付きインスタンスである場合、その名前付きインスタンスへの接続には通常はポート 1500 が使用されます。</span><span class="sxs-lookup"><span data-stu-id="ae59f-223">When the Publisher or Distributor is a named instance on a server with another default instance, port 1500 is typically used to connect to the named instance.</span></span>  
  
    -   <span data-ttu-id="ae59f-224">IIS を実行しているコンピューターがファイアウォールによってディストリビューターから分離されており、スナップショットの配信に FTP 共有が使用される場合は、FTP 用のポートが開かれている必要があります。</span><span class="sxs-lookup"><span data-stu-id="ae59f-224">If the computer running IIS is separated from the Distributor by a firewall and an FTP share is used for snapshot delivery, the ports used for FTP must be opened.</span></span> <span data-ttu-id="ae59f-225">詳細については、「[FTP によるスナップショットの転送](transfer-snapshots-through-ftp.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ae59f-225">For more information, see [Transfer Snapshots Through FTP](transfer-snapshots-through-ftp.md).</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="ae59f-226">ファイアウォールのポートを開くと、サーバーが攻撃を受けやすくなります。</span><span class="sxs-lookup"><span data-stu-id="ae59f-226">Opening ports in your firewall can leave your server exposed to malicious attacks.</span></span> <span data-ttu-id="ae59f-227">ポートを開く前に、ファイアウォール システムについて理解しておいてください。</span><span class="sxs-lookup"><span data-stu-id="ae59f-227">Make sure that you understand firewall systems before you open ports.</span></span> <span data-ttu-id="ae59f-228">詳細については、「 [Security Considerations for a SQL Server Installation](../../sql-server/install/security-considerations-for-a-sql-server-installation.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ae59f-228">For more information, see [Security Considerations for a SQL Server Installation](../../sql-server/install/security-considerations-for-a-sql-server-installation.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="ae59f-229">参照</span><span class="sxs-lookup"><span data-stu-id="ae59f-229">See Also</span></span>  
 [<span data-ttu-id="ae59f-230">マージ レプリケーションの Web 同期</span><span class="sxs-lookup"><span data-stu-id="ae59f-230">Web Synchronization for Merge Replication</span></span>](web-synchronization-for-merge-replication.md)  
  
  
