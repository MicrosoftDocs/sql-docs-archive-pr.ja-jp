---
title: パラメーター化されたフィルターを使用したパブリケーションのスナップショットの作成 | Microsoft Docs
ms.custom: ''
ms.date: 06/30/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- parameterized filters [SQL Server replication], snapshots
- snapshots [SQL Server replication], parameterized filters and
- filters [SQL Server replication], parameterized
ms.assetid: 00dfb229-f1de-4d33-90b0-d7c99ab52dcb
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: dad6f1648cba44b38e37720f7e395687f769d91e
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87714206"
---
# <a name="create-a-snapshot-for-a-merge-publication-with-parameterized-filters"></a><span data-ttu-id="24109-102">パラメーター化されたフィルターを使用したパブリケーションのスナップショットの作成</span><span class="sxs-lookup"><span data-stu-id="24109-102">Create a Snapshot for a Merge Publication with Parameterized Filters</span></span>
  <span data-ttu-id="24109-103">このトピックでは、 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] で [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]、 [!INCLUDE[tsql](../../includes/tsql-md.md)]、またはレプリケーション管理オブジェクト (RMO) を使用して、パラメーター化されたフィルターでマージ パブリケーションのスナップショットを作成する方法ついて説明します。</span><span class="sxs-lookup"><span data-stu-id="24109-103">This topic describes how to create a snapshot for a merge publication with parameterized filters in [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] by using [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../includes/tsql-md.md)], or Replication Management Objects (RMO).</span></span>  
  
  
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> <span data-ttu-id="24109-104">はじめに</span><span class="sxs-lookup"><span data-stu-id="24109-104">Before You Begin</span></span>  
  
###  <a name="recommendations"></a><a name="Recommendations"></a> <span data-ttu-id="24109-105">推奨事項</span><span class="sxs-lookup"><span data-stu-id="24109-105">Recommendations</span></span>  
  
-   <span data-ttu-id="24109-106">パラメーター化されたフィルターを使用してマージ パブリケーションのスナップショットを生成する際には、最初にすべてのパブリッシュ済みデータとサブスクリプションのサブスクライバー メタデータを含む標準 (スキーマ) スナップショットを生成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="24109-106">When generating a snapshot for a merge publication using parameterized filters, you must first generate a standard (schema) snapshot that contains all of the published data and Subscriber metadata for the subscription.</span></span> <span data-ttu-id="24109-107">詳しくは、「 [初期スナップショットの作成および適用](create-and-apply-the-initial-snapshot.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="24109-107">For more information, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span> <span data-ttu-id="24109-108">スキーマ スナップショットを作成した後で、パブリッシュ済みデータのサブスクライバー固有のパーティションを含むスナップショットを作成できます。</span><span class="sxs-lookup"><span data-stu-id="24109-108">After you have created the schema snapshot, you can generate the snapshot that contains the Subscriber-specific partition of the published data.</span></span>  
  
-   <span data-ttu-id="24109-109">パブリケーション内の 1 つ以上のアーティクルにフィルターを適用して、各サブスクリプション固有の重複しないパーティションが得られる場合、マージ エージェントが実行されるたびにメタデータがクリーンアップされます。</span><span class="sxs-lookup"><span data-stu-id="24109-109">If the filtering for one or more articles in the publication yields non-overlapping partitions that are unique for each subscription, metadata is cleaned up whenever the Merge Agent runs.</span></span> <span data-ttu-id="24109-110">これは、パーティション スナップショットの有効期間が短時間で切れてしまうことを意味します。</span><span class="sxs-lookup"><span data-stu-id="24109-110">This means that the partitioned snapshot expires more quickly.</span></span> <span data-ttu-id="24109-111">このオプションを使用する場合は、サブスクライバーに対してスナップショットの生成と配信を許可することを検討する必要があります。</span><span class="sxs-lookup"><span data-stu-id="24109-111">When using this option, you should consider allowing Subscribers to initiate snapshot generation and delivery.</span></span> <span data-ttu-id="24109-112">フィルター オプションの詳細については、「[Snapshots for Merge Publications with Parameterized Filters](snapshots-for-merge-publications-with-parameterized-filters.md)」(パラメーター化されたフィルターを使用したマージ パブリケーションのスナップショット) の「Setting 'partition options」(パーティション オプションの設定) を参照してください。</span><span class="sxs-lookup"><span data-stu-id="24109-112">For more information about filtering options, see the "Setting 'partition options'" section of [Snapshots for Merge Publications with Parameterized Filters](snapshots-for-merge-publications-with-parameterized-filters.md).</span></span>  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> <span data-ttu-id="24109-113">SQL Server Management Studio の使用</span><span class="sxs-lookup"><span data-stu-id="24109-113">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="24109-114">**[パブリケーションのプロパティ - \<Publication>]** ダイアログ ボックスの **[データ パーティション]** ページでパーティションのスナップショットを作成します。</span><span class="sxs-lookup"><span data-stu-id="24109-114">Generate snapshots for partitions on the **Data Partitions** page of the **Publication Properties - \<Publication>** dialog box.</span></span> <span data-ttu-id="24109-115">このダイアログ ボックスへのアクセス方法の詳細については、「[パブリケーション プロパティの表示および変更](publish/view-and-modify-publication-properties.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="24109-115">For more information about accessing this dialog box, see [View and Modify Publication Properties](publish/view-and-modify-publication-properties.md).</span></span> <span data-ttu-id="24109-116">サブスクライバーには、スナップショットの生成と配信の開始や、スナップショットの生成を許可できます。</span><span class="sxs-lookup"><span data-stu-id="24109-116">You can allow Subscribers to initiate snapshot generation and delivery and/or generate snapshots.</span></span>  
  
 <span data-ttu-id="24109-117">1 つ以上のパーティションに対してスナップショットを生成する前に、以下の作業を行う必要があります。</span><span class="sxs-lookup"><span data-stu-id="24109-117">Before generating snapshots for one or more partitions, you must:</span></span>  
  
1.  <span data-ttu-id="24109-118">新規パブリーケーション ウィザードを使用してマージ パブリケーションを作成し、ウィザードの **[フィルターの追加]** ページで 1 つ以上のパラメーター化された行フィルターを指定します。</span><span class="sxs-lookup"><span data-stu-id="24109-118">Create a merge publication with the New Publication Wizard, and specify one or more parameterized row filters on the **Add Filter** page of the wizard.</span></span> <span data-ttu-id="24109-119">詳しくは、「 [マージ アーティクルのパラメーター化された行フィルターの定義および変更](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="24109-119">For more information, see [Define and Modify a Parameterized Row Filter for a Merge Article](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span></span>  
  
2.  <span data-ttu-id="24109-120">パブリケーションのスキーマ スナップショットを生成します。</span><span class="sxs-lookup"><span data-stu-id="24109-120">Generate a schema snapshot for the publication.</span></span> <span data-ttu-id="24109-121">既定では、新規パブリケーション ウィザードが完了すると、スキーマ スナップショットが生成されます。また、 [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]からスキーマ スナップショットを生成することもできます。</span><span class="sxs-lookup"><span data-stu-id="24109-121">By default, a schema snapshot is generated when you complete the New Publication Wizard; you can also generate a schema snapshot from [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)].</span></span>  
  
#### <a name="to-generate-a-schema-snapshot"></a><span data-ttu-id="24109-122">スキーマ スナップショットを生成するには</span><span class="sxs-lookup"><span data-stu-id="24109-122">To generate a schema snapshot</span></span>  
  
1.  <span data-ttu-id="24109-123">[!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)]でパブリッシャーに接続し、サーバー ノードを展開します。</span><span class="sxs-lookup"><span data-stu-id="24109-123">Connect to the Publisher in [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)], and then expand the server node.</span></span>  
  
2.  <span data-ttu-id="24109-124">**[レプリケーション]** フォルダーを展開し、 **[パブリケーション]** フォルダーを展開します。</span><span class="sxs-lookup"><span data-stu-id="24109-124">Expand the **Replication** folder, and then expand the **Publications** folder.</span></span>  
  
3.  <span data-ttu-id="24109-125">スナップショットを作成するパブリケーションを右クリックして、 **[スナップショット エージェントの状態の表示]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="24109-125">Right-click the publication for which you want to create a snapshot, and then click **View Snapshot Agent Status**.</span></span>  
  
4.  <span data-ttu-id="24109-126">**[スナップショット エージェントの状態の表示 - \<Publication>]** ダイアログ ボックスで **[開始]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="24109-126">In the **View Snapshot Agent Status - \<Publication>** dialog box, click **Start**.</span></span>  
  
     <span data-ttu-id="24109-127">スナップショット エージェントによるスナップショットの生成が完了すると、"[100%] 17 個のアーティクルのスナップショットが生成されました。" などのメッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="24109-127">When the Snapshot Agent finishes generating the snapshot, a message will be displayed, such as "[100%] A snapshot of 17 article(s) was generated."</span></span>  
  
#### <a name="to-allow-subscribers-to-initiate-snapshot-generation-and-delivery"></a><span data-ttu-id="24109-128">サブスクライバーにスナップショットの生成と配信を許可するには</span><span class="sxs-lookup"><span data-stu-id="24109-128">To allow Subscribers to initiate snapshot generation and delivery</span></span>  
  
1.  <span data-ttu-id="24109-129">**[パブリケーションのプロパティ - \<Publication>]** ダイアログ ボックスの **[データ パーティション]** ページで、 **[新規サブスクライバーで同期を行うとき、パーティションを自動的に定義し、必要に応じてスナップショットを生成する]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="24109-129">On the **Data Partitions** page of the **Publication Properties - \<Publication>** dialog box, select **Automatically define a partition and generate a snapshot if needed when a new Subscriber tries to synchronize**.</span></span>  
  
2.  [!INCLUDE[clickOK](../../includes/clickok-md.md)]  
  
#### <a name="to-generate-and-refresh-snapshots"></a><span data-ttu-id="24109-130">スナップショットの生成と更新を行うには</span><span class="sxs-lookup"><span data-stu-id="24109-130">To generate and refresh snapshots</span></span>  
  
1.  <span data-ttu-id="24109-131">**[パブリケーションのプロパティ - \<Publication>]** ダイアログ ボックスの **[データ パーティション]** ページで **[追加]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="24109-131">On the **Data Partitions** page of the **Publication Properties - \<Publication>** dialog box, click **Add**.</span></span>  
  
2.  <span data-ttu-id="24109-132">スナップショットを作成するパーティションに関連付けられた **HOST_NAME()** と **SUSER_SNAME()** に値を入力します。</span><span class="sxs-lookup"><span data-stu-id="24109-132">Enter a value for the **HOST_NAME()** and/or **SUSER_SNAME()** value associated with the partition for which you want to create a snapshot.</span></span>  
  
3.  <span data-ttu-id="24109-133">オプションでスナップショットの更新スケジュールを指定します。</span><span class="sxs-lookup"><span data-stu-id="24109-133">Optionally specify a schedule for refreshing snapshots:</span></span>  
  
    1.  <span data-ttu-id="24109-134">**[以下のスケジュールでこのパーティションのスナップショット エージェントを実行する]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="24109-134">Select **Schedule the Snapshot Agent for this partition to run at the following time(s)**</span></span>  
  
    2.  <span data-ttu-id="24109-135">スナップショットの既定の更新スケジュールをそのまま使用するか、または **[変更]** をクリックして別のスケジュールを指定します。</span><span class="sxs-lookup"><span data-stu-id="24109-135">Accept the default schedule for refreshing snapshots, or click **Change** to specify a different schedule.</span></span>  
  
4.  <span data-ttu-id="24109-136">**[OK]** をクリックして、 **[パブリケーションのプロパティ - \<Publication>]** ダイアログ ボックスに戻ります。</span><span class="sxs-lookup"><span data-stu-id="24109-136">Click **OK**, which returns you to the **Publication Properties - \<Publication>** dialog box.</span></span>  
  
5.  <span data-ttu-id="24109-137">プロパティ グリッドでパーティションを選択し、 **[今すぐ選択したスナップショットを生成する]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="24109-137">Select the partition in the property grid, and then click **Generate the selected snapshots now**.</span></span>  
  
6.  [!INCLUDE[clickOK](../../includes/clickok-md.md)]  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="24109-138">Transact-SQL の使用</span><span class="sxs-lookup"><span data-stu-id="24109-138">Using Transact-SQL</span></span>  
 <span data-ttu-id="24109-139">ストアド プロシージャとスナップショット エージェントを使用して、次を実行できます。</span><span class="sxs-lookup"><span data-stu-id="24109-139">Using stored procedures and the Snapshot Agent, you can perform the following:</span></span>  
  
-   <span data-ttu-id="24109-140">サブスクライバーが初めて同期されたときに、スナップショットの生成と適用を要求できるようにします。</span><span class="sxs-lookup"><span data-stu-id="24109-140">Allow Subscribers to request snapshot generation and application the first time they synchronize.</span></span>  
  
-   <span data-ttu-id="24109-141">各パーティションのスナップショットを事前に生成します。</span><span class="sxs-lookup"><span data-stu-id="24109-141">Pre-generate snapshots for each partition.</span></span>  
  
-   <span data-ttu-id="24109-142">各サブスクライバーのスナップショットを手動で生成できます。</span><span class="sxs-lookup"><span data-stu-id="24109-142">Manually generate a snapshot for each Subscriber.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="24109-143">可能であれば、実行時、ユーザーに対してセキュリティ資格情報の入力を要求します。</span><span class="sxs-lookup"><span data-stu-id="24109-143">When possible, prompt users to enter security credentials at runtime.</span></span> <span data-ttu-id="24109-144">スクリプト ファイルに資格情報を格納する必要がある場合は、不正アクセスを防ぐために、ファイルを保護します。</span><span class="sxs-lookup"><span data-stu-id="24109-144">If you must store credentials in a script file, you must secure the file to prevent unauthorized access.</span></span>  
  
#### <a name="to-create-a-publication-that-allows-subscribers-to-initiate-snapshot-generation-and-delivery"></a><span data-ttu-id="24109-145">サブスクライバーでスナップショットの生成と配信を開始するためのパブリケーションを作成するには</span><span class="sxs-lookup"><span data-stu-id="24109-145">To create a publication that allows Subscribers to initiate snapshot generation and delivery</span></span>  
  
1.  <span data-ttu-id="24109-146">パブリッシャー側のパブリケーション データベースに対して、[sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql) を実行します。</span><span class="sxs-lookup"><span data-stu-id="24109-146">At the Publisher on the publication database, execute [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql).</span></span> <span data-ttu-id="24109-147">次のパラメーターを指定します。</span><span class="sxs-lookup"><span data-stu-id="24109-147">Specify the following parameters:</span></span>  
  
    -   <span data-ttu-id="24109-148">**\@publication** のパブリケーションの名前。</span><span class="sxs-lookup"><span data-stu-id="24109-148">The name of the publication for **\@publication**.</span></span>  
  
    -   <span data-ttu-id="24109-149">Allow_subscriber_initiated_snapshot の値 `true` 。 \*\* \@ \*\*これにより、サブスクライバーがスナップショットプロセスを開始できるようになります。</span><span class="sxs-lookup"><span data-stu-id="24109-149">A value of `true` for **\@allow_subscriber_initiated_snapshot**, which enables Subscribers to initiate the snapshot process.</span></span>  
  
    -   <span data-ttu-id="24109-150">(省略可能) **\@max_concurrent_dynamic_snapshots** に、同時に実行できる動的スナップショット プロセスの数を指定します。</span><span class="sxs-lookup"><span data-stu-id="24109-150">(Optional) The number of dynamic snapshot processes that can run concurrently for **\@max_concurrent_dynamic_snapshots**.</span></span> <span data-ttu-id="24109-151">最大限の数のプロセスが実行しているときに、サブスクライバーがスナップショットを生成しようとすると、そのプロセスはキューに格納されます。</span><span class="sxs-lookup"><span data-stu-id="24109-151">If the maximum number of processes is running and a Subscriber attempts to generate a snapshot, the process is placed in a queue.</span></span> <span data-ttu-id="24109-152">既定では、同時プロセスの数に限度はありません。</span><span class="sxs-lookup"><span data-stu-id="24109-152">By default there is no limit to the number of concurrent processes.</span></span>  
  
2.  <span data-ttu-id="24109-153">パブリッシャーで [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql) を実行します。</span><span class="sxs-lookup"><span data-stu-id="24109-153">At the Publisher, execute [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span></span> <span data-ttu-id="24109-154">手順 1. で使用したパブリケーション名\*\* \@ と、\*\* [!INCLUDE[msCoName](../../includes/msconame-md.md)] パブリッシャーへの接続時に[レプリケーションスナップショットエージェント](agents/replication-snapshot-agent.md)認証を使用する Windows 資格情報を指定します。 \*\* \@ publisher_security_mode**の場合は**0\*\* 、 [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] \*\* \@ publisher_login**と** \@ publisher_password\*\*の場合はログイン情報も指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="24109-154">Specify the publication name used in step 1 for **\@publication** and the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows credentials under which the [Replication Snapshot Agent](agents/replication-snapshot-agent.md) Authentication when connecting to the Publisher, you must also specify a value of **0** for **\@publisher_security_mode** and the [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **\@publisher_login** and **\@publisher_password**.</span></span> <span data-ttu-id="24109-155">これにより、パブリケーション用のスナップショット エージェント ジョブが作成されます。</span><span class="sxs-lookup"><span data-stu-id="24109-155">This creates a Snapshot Agent job for the publication.</span></span> <span data-ttu-id="24109-156">初期スナップショットの作成と、スナップショット エージェントのカスタム スケジュールの定義については、「 [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="24109-156">For more information about generating an initial snapshot and defining a custom schedule for the Snapshot Agent, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="24109-157">リモート ディストリビューターを使用するパブリッシャーを構成する場合は、 *job_login* および *job_password*を含むすべてのパラメーターに指定された値がディストリビューターにプレーン テキストとして送信されます。</span><span class="sxs-lookup"><span data-stu-id="24109-157">When configuring a Publisher with a remote Distributor, the values supplied for all parameters, including *job_login* and *job_password*, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="24109-158">このストアド プロシージャを実行する前に、パブリッシャーとリモート ディストリビューターの間の接続を暗号化する必要があります。</span><span class="sxs-lookup"><span data-stu-id="24109-158">You should encrypt the connection between the Publisher and its remote Distributor before executing this stored procedure.</span></span> <span data-ttu-id="24109-159">詳細については、「[データベース エンジンへの暗号化接続の有効化 &#40;SQL Server 構成マネージャー&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="24109-159">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
3.  <span data-ttu-id="24109-160">[sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) を実行して、パブリケーションにアーティクルを追加します。</span><span class="sxs-lookup"><span data-stu-id="24109-160">Execute [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) to add articles to the publication.</span></span> <span data-ttu-id="24109-161">このストアド プロシージャは、パブリケーション内の各アーティクルについて 1 回ずつ実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="24109-161">This stored procedure must be executed once for each article in the publication.</span></span> <span data-ttu-id="24109-162">パラメーター化されたフィルターを使用する場合には、 **\@subset_filterclause** パラメーターを使用して 1 つ以上のアーティクルにパラメーター化された行フィルターを指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="24109-162">When using parameterized filters, you must specify a parameterized row filter for one or more articles using the **\@subset_filterclause** parameter.</span></span> <span data-ttu-id="24109-163">詳しくは、「 [マージ アーティクルのパラメーター化された行フィルターの定義および変更](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="24109-163">For more information, see [Define and Modify a Parameterized Row Filter for a Merge Article](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span></span>  
  
4.  <span data-ttu-id="24109-164">他のアーティクルがパラメーター化された行フィルターに基づいてフィルター選択される場合、[sp_addmergefilter &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql) を実行して、アーティクル間の結合レコード リレーションシップまたは論理レコード リレーションシップを定義します。</span><span class="sxs-lookup"><span data-stu-id="24109-164">If other articles will be filtered based on the parameterized row filter, execute [sp_addmergefilter &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql) to define the join or logical record relationships between articles.</span></span> <span data-ttu-id="24109-165">このストアド プロシージャは、定義する各リレーションシップにつき 1 回ずつ実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="24109-165">This stored procedure must be executed once for each relationship being defined.</span></span> <span data-ttu-id="24109-166">詳しくは、「 [マージ アーティクル間の結合フィルターの定義および変更](publish/define-and-modify-a-join-filter-between-merge-articles.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="24109-166">For more information, see [Define and Modify a Join Filter Between Merge Articles](publish/define-and-modify-a-join-filter-between-merge-articles.md).</span></span>  
  
5.  <span data-ttu-id="24109-167">マージ エージェントでサブスクライバーを初期化するためにスナップショットが必要な場合、要求側のサブスクリプションのパーティションのスナップショットが自動的に生成されます。</span><span class="sxs-lookup"><span data-stu-id="24109-167">When the Merge Agent requests the snapshot to initialize the Subscriber, the snapshot for the requesting subscription's partition is automatically generated.</span></span>  
  
#### <a name="to-create-a-publication-and-pre-generate-or-automatically-refresh-snapshots"></a><span data-ttu-id="24109-168">パブリケーションを作成し、スナップショットを事前に生成、または自動更新するには</span><span class="sxs-lookup"><span data-stu-id="24109-168">To create a publication and pre-generate or automatically refresh snapshots</span></span>  
  
1.  <span data-ttu-id="24109-169">[sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql) を実行して、パブリケーションを作成します。</span><span class="sxs-lookup"><span data-stu-id="24109-169">Execute [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql) to create the publication.</span></span> <span data-ttu-id="24109-170">詳しくは、「 [パブリケーションを作成](publish/create-a-publication.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="24109-170">For more information, see [Create a Publication](publish/create-a-publication.md).</span></span>  
  
2.  <span data-ttu-id="24109-171">パブリッシャーで [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql) を実行します。</span><span class="sxs-lookup"><span data-stu-id="24109-171">At the Publisher, execute [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span></span> <span data-ttu-id="24109-172">手順 1. で使用したパブリケーション名を **\@publication** に指定し、スナップショット エージェントを実行するときに使用される Windows 資格情報を **\@job_login** と **\@password** に指定します。</span><span class="sxs-lookup"><span data-stu-id="24109-172">Specify the publication name used in step 1 for **\@publication** and the Windows credentials under which the Snapshot Agent runs for **\@job_login** and **\@password**.</span></span> <span data-ttu-id="24109-173">エージェントがパブリッシャーに接続する際に [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 認証を使用する場合、さらに **\@publisher_security_mode** に **0** を指定し、 **\@publisher_login** と **\@publisher_password** に [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ログイン情報を指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="24109-173">If the agent will use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Publisher, you must also specify a value of **0** for **\@publisher_security_mode** and the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **\@publisher_login** and **\@publisher_password**.</span></span> <span data-ttu-id="24109-174">これにより、パブリケーション用のスナップショット エージェント ジョブが作成されます。</span><span class="sxs-lookup"><span data-stu-id="24109-174">This creates a Snapshot Agent job for the publication.</span></span> <span data-ttu-id="24109-175">初期スナップショットの作成と、スナップショット エージェントのカスタム スケジュールの定義については、「 [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="24109-175">For more information about generating an initial snapshot and defining a custom schedule for the Snapshot Agent, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="24109-176">リモート ディストリビューターを使用するパブリッシャーを構成する場合は、 *job_login* および *job_password*を含むすべてのパラメーターに指定された値がディストリビューターにプレーン テキストとして送信されます。</span><span class="sxs-lookup"><span data-stu-id="24109-176">When configuring a Publisher with a remote Distributor, the values supplied for all parameters, including *job_login* and *job_password*, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="24109-177">このストアド プロシージャを実行する前に、パブリッシャーとリモート ディストリビューターの間の接続を暗号化する必要があります。</span><span class="sxs-lookup"><span data-stu-id="24109-177">You should encrypt the connection between the Publisher and its remote Distributor before executing this stored procedure.</span></span> <span data-ttu-id="24109-178">詳細については、「[データベース エンジンへの暗号化接続の有効化 &#40;SQL Server 構成マネージャー&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="24109-178">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
3.  <span data-ttu-id="24109-179">[sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) を実行して、パブリケーションにアーティクルを追加します。</span><span class="sxs-lookup"><span data-stu-id="24109-179">Execute [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) to add articles to the publication.</span></span> <span data-ttu-id="24109-180">このストアド プロシージャは、パブリケーション内の各アーティクルについて 1 回ずつ実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="24109-180">This stored procedure must be executed once for each article in the publication.</span></span> <span data-ttu-id="24109-181">パラメーター化されたフィルターを使用する場合には、 **\@subset_filterclause** パラメーターを使用して 1 つのアーティクルにパラメーター化された行フィルターを指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="24109-181">When using parameterized filters, you must specify a parameterized row filter for one article using the **\@subset_filterclause** parameter.</span></span> <span data-ttu-id="24109-182">詳しくは、「 [マージ アーティクルのパラメーター化された行フィルターの定義および変更](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="24109-182">For more information, see [Define and Modify a Parameterized Row Filter for a Merge Article](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span></span>  
  
4.  <span data-ttu-id="24109-183">他のアーティクルがパラメーター化された行フィルターに基づいてフィルター選択される場合、[sp_addmergefilter &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql) を実行して、アーティクル間の結合レコード リレーションシップまたは論理レコード リレーションシップを定義します。</span><span class="sxs-lookup"><span data-stu-id="24109-183">If other articles will be filtered based on the parameterized row filter, execute [sp_addmergefilter &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql) to define the join or logical record relationships between articles.</span></span> <span data-ttu-id="24109-184">このストアド プロシージャは、定義する各リレーションシップにつき 1 回ずつ実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="24109-184">This stored procedure must be executed once for each relationship being defined.</span></span> <span data-ttu-id="24109-185">詳しくは、「 [マージ アーティクル間の結合フィルターの定義および変更](publish/define-and-modify-a-join-filter-between-merge-articles.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="24109-185">For more information, see [Define and Modify a Join Filter Between Merge Articles](publish/define-and-modify-a-join-filter-between-merge-articles.md).</span></span>  
  
5.  <span data-ttu-id="24109-186">パブリケーション データベースのパブリッシャーで [sp_helpmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpmergepublication-transact-sql) を実行し、手順 1 の **\@publication** の値を指定します。</span><span class="sxs-lookup"><span data-stu-id="24109-186">At the Publisher on the publication database, execute [sp_helpmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpmergepublication-transact-sql), specifying the value of **\@publication** from step 1.</span></span> <span data-ttu-id="24109-187">結果セットの **snapshot_jobid** の値を確認します。</span><span class="sxs-lookup"><span data-stu-id="24109-187">Note the value of the **snapshot_jobid** in the result set.</span></span>  
  
6.  <span data-ttu-id="24109-188">手順 5. で得られた **snapshot_jobid** の値を、 **uniqueidentifier**に変換します。</span><span class="sxs-lookup"><span data-stu-id="24109-188">Convert the value of the **snapshot_jobid** obtained in step 5 to **uniqueidentifier**.</span></span>  
  
7.  <span data-ttu-id="24109-189">パブリッシャーの **msdb** データベースに対して、[sp_start_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-start-job-transact-sql) を実行します。 **\@job_id** には、手順 6 で得られた変換済みの値を指定します。</span><span class="sxs-lookup"><span data-stu-id="24109-189">At the Publisher on the **msdb** database, execute [sp_start_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-start-job-transact-sql), specifying the converted value obtained in step 6 for **\@job_id**.</span></span>  
  
8.  <span data-ttu-id="24109-190">パブリッシャー側のパブリケーション データベースに対して、[sp_addmergepartition &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepartition-transact-sql) を実行します。</span><span class="sxs-lookup"><span data-stu-id="24109-190">At the Publisher on the publication database, execute [sp_addmergepartition &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepartition-transact-sql).</span></span> <span data-ttu-id="24109-191">手順 1. のパブリケーション名を **\@publication** に指定します。パーティションの定義に使用する値には、フィルター句で [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql) が使用されている場合は **\@suser_sname**、フィルター句で [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) が使用されている場合は **\@host_name** を指定します。</span><span class="sxs-lookup"><span data-stu-id="24109-191">Specify the name of the publication from step 1 for **\@publication** and the value used to define the partition for **\@suser_sname** if [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql) is used in the filter clause or for **\@host_name** if [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) is used in the filter clause.</span></span>  
  
9. <span data-ttu-id="24109-192">パブリッシャー側のパブリケーション データベースに対して、[sp_adddynamicsnapshot_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddynamicsnapshot-job-transact-sql) を実行します。</span><span class="sxs-lookup"><span data-stu-id="24109-192">At the publisher on the publication database, execute [sp_adddynamicsnapshot_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddynamicsnapshot-job-transact-sql).</span></span> <span data-ttu-id="24109-193">手順 1 のパブリケーション名を **\@publication** に指定します。手順 8. で使用した **\@suser_sname** または **\@host_name** の値を指定し、ジョブのスケジュールを指定します。</span><span class="sxs-lookup"><span data-stu-id="24109-193">Specify the name of the publication from step 1 for **\@publication**, the value of **\@suser_sname** or **\@host_name** from step 8, and a schedule for the job.</span></span> <span data-ttu-id="24109-194">これにより、指定されたパーティションにパラメーター化スナップショットを生成するジョブが作成されます。</span><span class="sxs-lookup"><span data-stu-id="24109-194">This creates the job that generates the parameterized snapshot for the specified partition.</span></span> <span data-ttu-id="24109-195">詳細については、「 [Specify Synchronization Schedules](specify-synchronization-schedules.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="24109-195">For more information, see [Specify Synchronization Schedules](specify-synchronization-schedules.md).</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="24109-196">このジョブは、手順 2. で定義した初期スナップショット ジョブと同じ Windows アカウントを使用して実行されます。</span><span class="sxs-lookup"><span data-stu-id="24109-196">This job runs using the same Windows account as the initial snapshot job defined in step 2.</span></span> <span data-ttu-id="24109-197">このパラメーター化されたスナップショット ジョブおよび関連するデータ パーティションを削除するには、[sp_dropdynamicsnapshot_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-dropdynamicsnapshot-job-transact-sql) を実行します。</span><span class="sxs-lookup"><span data-stu-id="24109-197">To remove the parameterized snapshot job and its related data partition, execute [sp_dropdynamicsnapshot_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-dropdynamicsnapshot-job-transact-sql).</span></span>  
  
10. <span data-ttu-id="24109-198">パブリッシャー側のパブリケーション データベースに対して、[sp_helpmergepartition &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpmergepartition-transact-sql) を実行し、手順 1 の **\@publication** の値および手順 8 の **\@suser_sname** または **\@host_name** の値を指定します。</span><span class="sxs-lookup"><span data-stu-id="24109-198">At the Publisher on the publication database, execute [sp_helpmergepartition &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpmergepartition-transact-sql), specifying the value of **\@publication** from step 1 and the value of **\@suser_sname** or **\@host_name** from step 8.</span></span> <span data-ttu-id="24109-199">結果セットの **dynamic_snapshot_jobid** の値を確認します。</span><span class="sxs-lookup"><span data-stu-id="24109-199">Note the value of the **dynamic_snapshot_jobid** in the result set.</span></span>  
  
11. <span data-ttu-id="24109-200">ディストリビューターの **msdb** データベースに対して、[sp_start_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-start-job-transact-sql) を実行します。 **\@job_id** には、手順 9 で得られた値を指定します。</span><span class="sxs-lookup"><span data-stu-id="24109-200">At the Distributor on the **msdb** database, execute [sp_start_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-start-job-transact-sql), specifying the value obtained in step 9 for **\@job_id**.</span></span> <span data-ttu-id="24109-201">これにより、そのパーティションに対してパラメーター化されたスナップショット ジョブが開始されます。</span><span class="sxs-lookup"><span data-stu-id="24109-201">This starts the parameterized snapshot job for the partition.</span></span>  
  
12. <span data-ttu-id="24109-202">手順 8. ～ 11. を繰り返し実行して、各サブスクリプションについてパーティション スナップショットを生成します。</span><span class="sxs-lookup"><span data-stu-id="24109-202">Repeat steps 8-11 to generate a partitioned snapshot for each subscription.</span></span>  
  
#### <a name="to-create-a-publication-and-manually-create-snapshots-for-each-partition"></a><span data-ttu-id="24109-203">パブリケーションを作成し、各パーティションのスナップショットを手動で作成するには</span><span class="sxs-lookup"><span data-stu-id="24109-203">To create a publication and manually create snapshots for each partition</span></span>  
  
1.  <span data-ttu-id="24109-204">[sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql) を実行して、パブリケーションを作成します。</span><span class="sxs-lookup"><span data-stu-id="24109-204">Execute [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql) to create the publication.</span></span> <span data-ttu-id="24109-205">詳しくは、「 [パブリケーションを作成](publish/create-a-publication.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="24109-205">For more information, see [Create a Publication](publish/create-a-publication.md).</span></span>  
  
2.  <span data-ttu-id="24109-206">パブリッシャーで [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql) を実行します。</span><span class="sxs-lookup"><span data-stu-id="24109-206">At the Publisher, execute [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span></span> <span data-ttu-id="24109-207">手順 1. で使用したパブリケーション名を **\@publication** に指定し、スナップショット エージェントを実行するときに使用される Windows 資格情報を **\@job_login** と **\@password** に指定します。</span><span class="sxs-lookup"><span data-stu-id="24109-207">Specify the publication name used in step 1 for **\@publication** and the Windows credentials under which the Snapshot Agent runs for **\@job_login** and **\@password**.</span></span> <span data-ttu-id="24109-208">エージェントがパブリッシャーに接続する際に [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 認証を使用する場合、さらに **\@publisher_security_mode** に **0** を指定し、 **\@publisher_login** と **\@publisher_password** に [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ログイン情報を指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="24109-208">If the agent will use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Publisher, you must also specify a value of **0** for **\@publisher_security_mode** and the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **\@publisher_login** and **\@publisher_password**.</span></span> <span data-ttu-id="24109-209">これにより、パブリケーション用のスナップショット エージェント ジョブが作成されます。</span><span class="sxs-lookup"><span data-stu-id="24109-209">This creates a Snapshot Agent job for the publication.</span></span> <span data-ttu-id="24109-210">初期スナップショットの作成と、スナップショット エージェントのカスタム スケジュールの定義については、「 [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="24109-210">For more information about generating an initial snapshot and defining a custom schedule for the Snapshot Agent, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="24109-211">リモート ディストリビューターを使用するパブリッシャーを構成する場合は、 *job_login* および *job_password*を含むすべてのパラメーターに指定された値がディストリビューターにプレーン テキストとして送信されます。</span><span class="sxs-lookup"><span data-stu-id="24109-211">When configuring a Publisher with a remote Distributor, the values supplied for all parameters, including *job_login* and *job_password*, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="24109-212">このストアド プロシージャを実行する前に、パブリッシャーとリモート ディストリビューターの間の接続を暗号化する必要があります。</span><span class="sxs-lookup"><span data-stu-id="24109-212">You should encrypt the connection between the Publisher and its remote Distributor before executing this stored procedure.</span></span> <span data-ttu-id="24109-213">詳細については、「[データベース エンジンへの暗号化接続の有効化 &#40;SQL Server 構成マネージャー&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="24109-213">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
3.  <span data-ttu-id="24109-214">[sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) を実行して、パブリケーションにアーティクルを追加します。</span><span class="sxs-lookup"><span data-stu-id="24109-214">Execute [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) to add articles to the publication.</span></span> <span data-ttu-id="24109-215">このストアド プロシージャは、パブリケーション内の各アーティクルについて 1 回ずつ実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="24109-215">This stored procedure must be executed once for each article in the publication.</span></span> <span data-ttu-id="24109-216">パラメーター化されたフィルターを使用する場合には、 **\@subset_filterclause** パラメーターを使用して 1 つ以上のアーティクルにパラメーター化された行フィルターを指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="24109-216">When using parameterized filters, you must specify a parameterized row filter for at least one article using the **\@subset_filterclause** parameter.</span></span> <span data-ttu-id="24109-217">詳しくは、「 [マージ アーティクルのパラメーター化された行フィルターの定義および変更](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="24109-217">For more information, see [Define and Modify a Parameterized Row Filter for a Merge Article](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span></span>  
  
4.  <span data-ttu-id="24109-218">他のアーティクルがパラメーター化された行フィルターに基づいてフィルター選択される場合、[sp_addmergefilter &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql) を実行して、アーティクル間の結合レコード リレーションシップまたは論理レコード リレーションシップを定義します。</span><span class="sxs-lookup"><span data-stu-id="24109-218">If other articles will be filtered based on the parameterized row filter, execute [sp_addmergefilter &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql) to define the join or logical record relationships between articles.</span></span> <span data-ttu-id="24109-219">このストアド プロシージャは、定義する各リレーションシップにつき 1 回ずつ実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="24109-219">This stored procedure must be executed once for each relationship being defined.</span></span> <span data-ttu-id="24109-220">詳しくは、「 [マージ アーティクル間の結合フィルターの定義および変更](publish/define-and-modify-a-join-filter-between-merge-articles.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="24109-220">For more information, see [Define and Modify a Join Filter Between Merge Articles](publish/define-and-modify-a-join-filter-between-merge-articles.md).</span></span>  
  
5.  <span data-ttu-id="24109-221">スナップショット ジョブを開始するか、コマンド プロンプトからレプリケーション スナップショット エージェントを実行して、標準のスナップショット スキーマおよびその他のファイルを生成します。</span><span class="sxs-lookup"><span data-stu-id="24109-221">Start the snapshot job or run the Replication Snapshot Agent from the command prompt to generate the standard snapshot schema and other files.</span></span> <span data-ttu-id="24109-222">詳しくは、「 [初期スナップショットの作成および適用](create-and-apply-the-initial-snapshot.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="24109-222">For more information, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
6.  <span data-ttu-id="24109-223">再びコマンド プロンプトからレプリケーション スナップショット エージェントを実行し、一括コピー (.bcp) ファイルを生成します。パーティション スナップショットの場所を **-DynamicSnapshotLocation** に指定し、次の 2 つのプロパティを指定して、パーティションを定義します。</span><span class="sxs-lookup"><span data-stu-id="24109-223">Run the Replication Snapshot Agent again from the command prompt to generate bulk copy (.bcp) files, specifying the location of the partitioned snapshot for **-DynamicSnapshotLocation** and one or both of the following properties that defines the partition:</span></span>  
  
    -   <span data-ttu-id="24109-224">**-DynamicFilterHostName** - [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) が使用される場合の値。</span><span class="sxs-lookup"><span data-stu-id="24109-224">**-DynamicFilterHostName** - the value if [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) is used.</span></span>  
  
    -   <span data-ttu-id="24109-225">**-DynamicFilterLogin** - [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql) が使用される場合の値。</span><span class="sxs-lookup"><span data-stu-id="24109-225">**-DynamicFilterLogin** - the value if [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql) is used.</span></span>  
  
7.  <span data-ttu-id="24109-226">手順 6. を繰り返し実行して、各サブスクリプションについてパーティション スナップショットを生成します。</span><span class="sxs-lookup"><span data-stu-id="24109-226">Repeat step 6 to generate a partitioned snapshot for each subscription.</span></span>  
  
8.  <span data-ttu-id="24109-227">サブスクリプションごとにマージ エージェントを実行して、初期のパーティション スナップショットをサブスクライバーに適用します。次のプロパティを指定します。</span><span class="sxs-lookup"><span data-stu-id="24109-227">Run the Merge Agent for each subscription to apply the initial partitioned snapshot at the Subscribers, specifying the following properties:</span></span>  
  
    -   <span data-ttu-id="24109-228">**-Hostname** - HOST_NAME の実際の値がオーバーライドされている場合にパーティションの定義に使用する値。</span><span class="sxs-lookup"><span data-stu-id="24109-228">**-Hostname** - the value used to define the partition if the actual value of HOST_NAME is being overridden.</span></span>  
  
    -   <span data-ttu-id="24109-229">**-DynamicSnapshotLocation** - このパーティションの動的スナップショットの場所。</span><span class="sxs-lookup"><span data-stu-id="24109-229">**-DynamicSnapshotLocation** - the location of the dynamic snapshot for this partition.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="24109-230">レプリケーション エージェントのプログラミングの詳細については、「[Replication Agent Executables Concepts](concepts/replication-agent-executables-concepts.md)」(レプリケーション エージェントの実行可能ファイルの概念) を参照してください。</span><span class="sxs-lookup"><span data-stu-id="24109-230">For more information about programming replication agents, see [Replication Agent Executables Concepts](concepts/replication-agent-executables-concepts.md).</span></span>  
  
###  <a name="examples-transact-sql"></a><a name="TsqlExample"></a> <span data-ttu-id="24109-231">例 (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="24109-231">Examples (Transact-SQL)</span></span>  
 <span data-ttu-id="24109-232">次の例では、サブスクライバーによってスナップショット生成プロセスが開始される場合に、パラメーター化されたフィルターを使用してマージ パブリケーションを作成します。</span><span class="sxs-lookup"><span data-stu-id="24109-232">This example creates a merge publication with parameterized filters where Subscribers initiate the snapshot generation process.</span></span> <span data-ttu-id="24109-233">**\@job_login** と **\@job_password** に指定する値は、スクリプト変数を使用して渡されます。</span><span class="sxs-lookup"><span data-stu-id="24109-233">Values for **\@job_login** and **\@job_password** are passed in using scripting variables.</span></span>  
  
 [!code-sql[HowTo#sp_MergeDynamicPub1](../../snippets/tsql/SQL15/replication/howto/tsql/createmergepubdynamic1.sql#sp_mergedynamicpub1)]  
  
 <span data-ttu-id="24109-234">次の例では、パラメーター化されたフィルターを使用してパブリケーションを作成します。各サブスクライバーでは [sp_addmergepartition](/sql/relational-databases/system-stored-procedures/sp-addmergepartition-transact-sql) を実行することでパーティションを定義し、パーティション情報を渡して [sp_adddynamicsnapshot_job](/sql/relational-databases/system-stored-procedures/sp-adddynamicsnapshot-job-transact-sql) を実行することで、フィルター選択したスナップショット ジョブを作成します。</span><span class="sxs-lookup"><span data-stu-id="24109-234">This example creates a publication using a parameterized filter where each Subscriber has its partition defined by executing [sp_addmergepartition](/sql/relational-databases/system-stored-procedures/sp-addmergepartition-transact-sql) and the filtered snapshot job created by executing [sp_adddynamicsnapshot_job](/sql/relational-databases/system-stored-procedures/sp-adddynamicsnapshot-job-transact-sql) passing the partitioning information.</span></span> <span data-ttu-id="24109-235">**\@job_login** と **\@job_password** に指定する値は、スクリプト変数を使用して渡されます。</span><span class="sxs-lookup"><span data-stu-id="24109-235">Values for **\@job_login** and **\@job_password** are passed in using scripting variables.</span></span>  
  
 [!code-sql[HowTo#sp_MergeDynamicPubPlusPartition](../../snippets/tsql/SQL15/replication/howto/tsql/createmergepubdynamic2.sql#sp_mergedynamicpubpluspartition)]  
  
 <span data-ttu-id="24109-236">次の例では、各サブスクライバーでパーティション情報を入力してデータ パーティションとフィルター選択したスナップショット ジョブを作成する必要がある場合に、パラメーター化されたフィルターを使用してパブリケーションを作成します。</span><span class="sxs-lookup"><span data-stu-id="24109-236">This example creates a publication using a parameterized filter where each Subscriber must have its data partition and filtered snapshot job created by supplying the partitioning information.</span></span> <span data-ttu-id="24109-237">レプリケーション エージェントを手動で実行する場合、サブスクライバーではコマンド ライン パラメーターを使用してパーティション情報を入力します。</span><span class="sxs-lookup"><span data-stu-id="24109-237">A Subscriber supplies partitioning information using command-line parameters when manually running the replication agents.</span></span> <span data-ttu-id="24109-238">この例では、パブリケーションに対するサブスクリプションも作成されることを想定しています。</span><span class="sxs-lookup"><span data-stu-id="24109-238">This example assumes that a subscription to the publication has also been created.</span></span>  
  
 [!code-sql[HowTo#sp_MergeDynamicPubPartitionManual](../../snippets/tsql/SQL15/replication/howto/tsql/createmergepubdynamic3.sql#sp_mergedynamicpubpartitionmanual)]  
  
 
```
REM Line breaks are added to improve readability.   
REM In a batch file, commands must be made in a single line.  
REM Run the Snapshot agent from the command line to generate the standard snapshot   
REM schema and other files.   
SET DistPub=%computername%  
SET PubDB=AdventureWorks2012   
SET PubName=AdvWorksSalesPersonMerge  
  
"C:\Program Files\Microsoft SQL Server\120\COM\SNAPSHOT.EXE" -Publication %PubName%    
-Publisher %DistPub% -Distributor  %DistPub%  -PublisherDB %PubDB%  -ReplicationType 2    
-OutputVerboseLevel 1  -DistributorSecurityMode 1  
  
PAUSE  
```

```
REM Run the Snapshot agent from the command line, this time to generate   
REM the bulk copy (.bcp) data for each Subscriber partition.    
SET DistPub=%computername%  
SET PubDB=AdventureWorks2012   
SET PubName=AdvWorksSalesPersonMerge  
SET SnapshotDir=\\%DistPub%\repldata\unc\fernando  
  
MD %SnapshotDir%  
  
"C:\Program Files\Microsoft SQL Server\120\COM\SNAPSHOT.EXE" -Publication %PubName%    
-Publisher %DistPub%  -Distributor  %DistPub%  -PublisherDB %PubDB%  -ReplicationType 2    
-OutputVerboseLevel 1  -DistributorSecurityMode 1  -DynamicFilterHostName "adventure-works\Fernando"    
-DynamicSnapshotLocation %SnapshotDir%  
  
PAUSE  
```

```
REM Run the Merge Agent for each subscription to apply the partitioned   
REM snapshot for each Subscriber.    
SET Publisher = %computername%  
SET Subscriber = %computername%  
SET PubDB = AdventureWorks2012   
SET SubDB = AdventureWorks2012Replica   
SET PubName = AdvWorksSalesPersonMerge   
SET SnapshotDir=\\%DistPub%\repldata\unc\fernando  
  
"C:\Program Files\Microsoft SQL Server\120\COM\REPLMERG.EXE" -Publisher  %Publisher%    
-Subscriber  %Subscriber%  -Distributor %Publisher%  -PublisherDB %PubDB%    
-SubscriberDB %SubDB% -Publication %PubName%  -PublisherSecurityMode 1  -OutputVerboseLevel 3    
-Output -SubscriberSecurityMode 1  -SubscriptionType 3 -DistributorSecurityMode 1    
-Hostname "adventure-works\Fernando"  -DynamicSnapshotLocation %SnapshotDir%  
  
PAUSE
```
  
  
##  <a name="using-replication-management-objects-rmo"></a><a name="RMOProcedure"></a> <span data-ttu-id="24109-239">レプリケーション管理オブジェクト (RMO) の使用</span><span class="sxs-lookup"><span data-stu-id="24109-239">Using Replication Management Objects (RMO)</span></span>  
 <span data-ttu-id="24109-240">パーティション スナップショットは、プログラムからレプリケーション管理オブジェクト (RMO) を使用して生成できます。その方法を次に示します。</span><span class="sxs-lookup"><span data-stu-id="24109-240">You can use Replication Management Objects (RMO) to generate partitioned snapshots programmatically in the following ways:</span></span>  
  
-   <span data-ttu-id="24109-241">サブスクライバーが初めて同期されたときに、スナップショットの生成と適用を要求できるようにします。</span><span class="sxs-lookup"><span data-stu-id="24109-241">Allow Subscribers to request snapshot generation and application the first time they synchronize.</span></span>  
  
-   <span data-ttu-id="24109-242">各パーティションのスナップショットを事前に生成します。</span><span class="sxs-lookup"><span data-stu-id="24109-242">Pre-generate snapshots for each partition.</span></span>  
  
-   <span data-ttu-id="24109-243">スナップショット エージェントを実行してサブスクライバーごとにスナップショットを手動で生成できます。</span><span class="sxs-lookup"><span data-stu-id="24109-243">Manually generate a snapshot for each Subscriber by running the Snapshot Agent.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="24109-244">アーティクルをフィルター選択して、サブスクリプションごとに一意の重複しないパーティションを取得する場合 (マージ アーティクルの作成時、<xref:Microsoft.SqlServer.Replication.PartitionOptions.NonOverlappingSingleSubscription> の値に <xref:Microsoft.SqlServer.Replication.MergeArticle.PartitionOption%2A> を指定した場合)、マージ エージェントの実行時に常にメタデータがクリーンアップされます。</span><span class="sxs-lookup"><span data-stu-id="24109-244">When filtering for an article yields non-overlapping partitions that are unique for each subscription (by specifying a value of <xref:Microsoft.SqlServer.Replication.PartitionOptions.NonOverlappingSingleSubscription> for <xref:Microsoft.SqlServer.Replication.MergeArticle.PartitionOption%2A> when creating a merge article), metadata is cleaned up whenever the Merge Agent runs.</span></span> <span data-ttu-id="24109-245">これは、パーティション スナップショットの有効期間が短時間で切れてしまうことを意味します。</span><span class="sxs-lookup"><span data-stu-id="24109-245">This means that the partitioned snapshot expires more quickly.</span></span> <span data-ttu-id="24109-246">このオプションを使用する場合は、サブスクライバーからスナップショットの生成を要求できるようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="24109-246">When you use this option, you should consider allowing Subscribers to request snapshot generation.</span></span> <span data-ttu-id="24109-247">詳細については、「 [Parameterized Row Filters](merge/parameterized-filters-parameterized-row-filters.md)」の「適切なフィルター選択オプションの使用」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="24109-247">For more information, see the section Using the Appropriate Filtering Options in the topic [Parameterized Row Filters](merge/parameterized-filters-parameterized-row-filters.md).</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="24109-248">可能であれば、実行時、ユーザーに対してセキュリティ資格情報の入力を要求します。</span><span class="sxs-lookup"><span data-stu-id="24109-248">When possible, prompt users to enter security credentials at runtime.</span></span> <span data-ttu-id="24109-249">資格情報を保存する必要がある場合は、 [Windows .NET&#xA0;Framework に用意されている](https://go.microsoft.com/fwlink/?LinkId=34733) 暗号化サービス [!INCLUDE[msCoName](../../includes/msconame-md.md)] を使用します。</span><span class="sxs-lookup"><span data-stu-id="24109-249">If you must store credentials, use the [cryptographic services](https://go.microsoft.com/fwlink/?LinkId=34733) provided by the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows .NET Framework.</span></span>  
  
#### <a name="to-create-a-publication-that-allows-subscribers-to-initiate-snapshot-generation-and-delivery"></a><span data-ttu-id="24109-250">サブスクライバーでスナップショットの生成と配信を開始するためのパブリケーションを作成するには</span><span class="sxs-lookup"><span data-stu-id="24109-250">To create a publication that allows Subscribers to initiate snapshot generation and delivery</span></span>  
  
1.  <span data-ttu-id="24109-251"><xref:Microsoft.SqlServer.Management.Common.ServerConnection> クラスを使用して、パブリッシャーへの接続を作成します。</span><span class="sxs-lookup"><span data-stu-id="24109-251">Create a connection to the Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="24109-252">パブリケーション データベースに <xref:Microsoft.SqlServer.Replication.ReplicationDatabase> クラスのインスタンスを作成するには、 <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> プロパティに手順 1. の <xref:Microsoft.SqlServer.Management.Common.ServerConnection> インスタンスを設定し、 <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="24109-252">Create an instance of the <xref:Microsoft.SqlServer.Replication.ReplicationDatabase> class for the publication database, set the <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> property to the instance of <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 1, and call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method.</span></span> <span data-ttu-id="24109-253"><xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> から `false` が返された場合は、データベースが存在していることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="24109-253">If <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> returns `false`, confirm that the database exists.</span></span>  
  
3.  <span data-ttu-id="24109-254"><xref:Microsoft.SqlServer.Replication.ReplicationDatabase.EnabledMergePublishing%2A> プロパティが `false` の場合は、このプロパティに `true` を設定して、<xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A> を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="24109-254">If <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.EnabledMergePublishing%2A> property is `false`, set it to `true` and call <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A>.</span></span>  
  
4.  <span data-ttu-id="24109-255"><xref:Microsoft.SqlServer.Replication.MergePublication> クラスのインスタンスを作成し、このオブジェクトに次のプロパティを設定します。</span><span class="sxs-lookup"><span data-stu-id="24109-255">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class, and set the following properties for this object:</span></span>  
  
    -   <span data-ttu-id="24109-256">手順 1. の <xref:Microsoft.SqlServer.Management.Common.ServerConnection> を <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>に指定します。</span><span class="sxs-lookup"><span data-stu-id="24109-256">The <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 1 for <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span></span>  
  
    -   <span data-ttu-id="24109-257">パブリッシュするデータベースの名前を <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>に指定します。</span><span class="sxs-lookup"><span data-stu-id="24109-257">The name of the published database for <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>.</span></span>  
  
    -   <span data-ttu-id="24109-258"><xref:Microsoft.SqlServer.Replication.Publication.Name%2A>にパブリケーションの名前を指定します。</span><span class="sxs-lookup"><span data-stu-id="24109-258">A name for the publication for <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>.</span></span>  
  
    -   <span data-ttu-id="24109-259"><xref:Microsoft.SqlServer.Replication.MergePublication.MaxConcurrentDynamicSnapshots%2A>に、実行する動的スナップショット ジョブの最大数を指定します。</span><span class="sxs-lookup"><span data-stu-id="24109-259">The maximum number of dynamic snapshot jobs to run for <xref:Microsoft.SqlServer.Replication.MergePublication.MaxConcurrentDynamicSnapshots%2A>.</span></span> <span data-ttu-id="24109-260">サブスクライバーがスナップショットを要求するタイミングは不定です。そのため、同時に複数のサブスクライバーがパーティション スナップショットを要求した場合に、このプロパティを使って、同時に実行できるスナップショット エージェント ジョブの数を制限します。</span><span class="sxs-lookup"><span data-stu-id="24109-260">Because Subscriber initiated snapshot requests can occur at any time, this property limits the number of Snapshot Agent jobs that can run simultaneously when multiple Subscribers request their partitioned snapshot at the same time.</span></span> <span data-ttu-id="24109-261">実行中のジョブが最大数に達した場合は、パーティション スナップショットに対するそれ以降の要求は、実行されているいずれかのジョブが完了するまでキューに格納されます。</span><span class="sxs-lookup"><span data-stu-id="24109-261">When the maximum number of jobs are running, additional partitioned snapshot requests are queued until one of the running jobs is completed.</span></span>  
  
    -   <span data-ttu-id="24109-262">ビットごとの論理和演算 (Visual C# の場合は `|`、Visual Basic の場合は `Or`) を使用して、<xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowSubscriberInitiatedSnapshot> 値を <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> に追加します。</span><span class="sxs-lookup"><span data-stu-id="24109-262">Use the bitwise logical OR (`|` in Visual C# and `Or` in Visual Basic) operator to add the value <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowSubscriberInitiatedSnapshot> to <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A>.</span></span>  
  
    -   <span data-ttu-id="24109-263"><xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> の <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> フィールドおよび <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> フィールドに、スナップショット エージェント ジョブの実行に使用する [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows アカウントの資格情報を指定します。</span><span class="sxs-lookup"><span data-stu-id="24109-263">The <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> and <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> fields of <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> to provide the credentials for the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows account under which the Snapshot Agent job runs.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="24109-264">パブリケーションが固定サーバー ロール `sysadmin` のメンバーによって作成された場合、<xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> を設定することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="24109-264">Setting <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> is recommended when the publication is created by a member of the `sysadmin` fixed server role.</span></span> <span data-ttu-id="24109-265">詳細については、「 [レプリケーション エージェント セキュリティ モデル](security/replication-agent-security-model.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="24109-265">For more information, see [Replication Agent Security Model](security/replication-agent-security-model.md).</span></span>  
  
5.  <span data-ttu-id="24109-266"><xref:Microsoft.SqlServer.Replication.Publication.Create%2A> メソッドを呼び出して、パブリケーションを作成します。</span><span class="sxs-lookup"><span data-stu-id="24109-266">Call the <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> method to create the publication.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="24109-267">リモート ディストリビューターを使用するパブリッシャーを構成する場合は、 <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A>を含むすべてのプロパティに指定された値がディストリビューターにプレーンテキストとして送信されます。</span><span class="sxs-lookup"><span data-stu-id="24109-267">When configuring a Publisher with a remote Distributor, the values supplied for all properties, including <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A>, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="24109-268"><xref:Microsoft.SqlServer.Replication.Publication.Create%2A> メソッドを呼び出す前に、パブリッシャーとリモート ディストリビューター間の接続を暗号化する必要があります。</span><span class="sxs-lookup"><span data-stu-id="24109-268">You should encrypt the connection between the Publisher and its remote Distributor before calling the <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> method.</span></span> <span data-ttu-id="24109-269">詳細については、「[データベース エンジンへの暗号化接続の有効化 &#40;SQL Server 構成マネージャー&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="24109-269">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
6.  <span data-ttu-id="24109-270"><xref:Microsoft.SqlServer.Replication.MergeArticle> プロパティを使用して、アーティクルをパブリケーションに追加します。</span><span class="sxs-lookup"><span data-stu-id="24109-270">Use the <xref:Microsoft.SqlServer.Replication.MergeArticle> property to add articles to the publication.</span></span> <span data-ttu-id="24109-271">パラメーター化されたフィルターを定義する <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> プロパティを少なくとも 1 つのアーティクルについて指定します。</span><span class="sxs-lookup"><span data-stu-id="24109-271">Specify the <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> property for at least one article that defines the parameterized filter.</span></span> <span data-ttu-id="24109-272">(省略可) アーティクル間の結合フィルターを定義する <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> オブジェクトを作成します。</span><span class="sxs-lookup"><span data-stu-id="24109-272">(Optional) Create <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> objects that define join filters between articles.</span></span> <span data-ttu-id="24109-273">詳しくは、「 [アーティクルを定義](publish/define-an-article.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="24109-273">For more information, see [Define an Article](publish/define-an-article.md).</span></span>  
  
7.  <span data-ttu-id="24109-274"><xref:Microsoft.SqlServer.Replication.Publication.SnapshotAgentExists%2A> の値が `false` の場合は、<xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> を呼び出して、このパブリケーション用の初期スナップショット エージェント ジョブを作成します。</span><span class="sxs-lookup"><span data-stu-id="24109-274">If the value of <xref:Microsoft.SqlServer.Replication.Publication.SnapshotAgentExists%2A> is `false`, call <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> to create the initial Snapshot Agent job for this publication.</span></span>  
  
8.  <span data-ttu-id="24109-275">手順 4. で作成した <xref:Microsoft.SqlServer.Replication.Publication.StartSnapshotGenerationAgentJob%2A> オブジェクトの <xref:Microsoft.SqlServer.Replication.MergePublication> メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="24109-275">Call the <xref:Microsoft.SqlServer.Replication.Publication.StartSnapshotGenerationAgentJob%2A> method of the <xref:Microsoft.SqlServer.Replication.MergePublication> object created in step 4.</span></span> <span data-ttu-id="24109-276">これにより、初期スナップショットを生成するエージェント ジョブが開始されます。</span><span class="sxs-lookup"><span data-stu-id="24109-276">This starts the agent job that generates the initial snapshot.</span></span> <span data-ttu-id="24109-277">初期スナップショットの作成と、スナップショット エージェントのカスタム スケジュールの定義については、「 [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="24109-277">For more information about generating an initial snapshot and defining a custom schedule for the Snapshot Agent, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
9. <span data-ttu-id="24109-278">(省略可) 初期スナップショットが使用できる状態にあるかを調べるには、<xref:Microsoft.SqlServer.Replication.MergePublication.SnapshotAvailable%2A> プロパティの値が `true` であることを確認します。</span><span class="sxs-lookup"><span data-stu-id="24109-278">(Optional) Check for a value of `true` for the <xref:Microsoft.SqlServer.Replication.MergePublication.SnapshotAvailable%2A> property to determine when the initial snapshot is ready for use.</span></span>  
  
10. <span data-ttu-id="24109-279">サブスクライバーのマージ エージェントの初回接続時に、パーティション スナップショットが自動的に生成されます。</span><span class="sxs-lookup"><span data-stu-id="24109-279">When the Merge Agent for a Subscriber connects for the first time, a partitioned snapshot is generated automatically.</span></span>  
  
#### <a name="to-create-a-publication-and-pregenerate-or-automatically-refresh-snapshots"></a><span data-ttu-id="24109-280">パブリケーションを作成し、スナップショットを事前に生成したり、自動的に更新するには</span><span class="sxs-lookup"><span data-stu-id="24109-280">To create a publication and pregenerate or automatically refresh snapshots</span></span>  
  
1.  <span data-ttu-id="24109-281"><xref:Microsoft.SqlServer.Replication.MergePublication> クラスのインスタンスを使用して、マージ パブリケーションを定義します。</span><span class="sxs-lookup"><span data-stu-id="24109-281">Use an instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class to define a merge publication.</span></span> <span data-ttu-id="24109-282">詳しくは、「 [パブリケーションを作成](publish/create-a-publication.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="24109-282">For more information, see [Create a Publication](publish/create-a-publication.md).</span></span>  
  
2.  <span data-ttu-id="24109-283"><xref:Microsoft.SqlServer.Replication.MergeArticle> プロパティを使用して、アーティクルをパブリケーションに追加します。</span><span class="sxs-lookup"><span data-stu-id="24109-283">Use the <xref:Microsoft.SqlServer.Replication.MergeArticle> property to add articles to the publication.</span></span> <span data-ttu-id="24109-284">パラメーター化されたフィルターを定義する <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> プロパティを少なくとも 1 つのアーティクルについて指定し、さらに、必要に応じて、アーティクル間の結合フィルターを定義する <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> オブジェクトを作成します。</span><span class="sxs-lookup"><span data-stu-id="24109-284">Specify the <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> property for at least one article that defines the parameterized filter, and create any <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> objects that define join filters between articles.</span></span> <span data-ttu-id="24109-285">詳しくは、「 [アーティクルを定義](publish/define-an-article.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="24109-285">For more information, see [Define an Article](publish/define-an-article.md).</span></span>  
  
3.  <span data-ttu-id="24109-286"><xref:Microsoft.SqlServer.Replication.Publication.SnapshotAgentExists%2A> の値が `false` の場合は、<xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> を呼び出して、このパブリケーション用のスナップショット エージェント ジョブを作成します。</span><span class="sxs-lookup"><span data-stu-id="24109-286">If the value of <xref:Microsoft.SqlServer.Replication.Publication.SnapshotAgentExists%2A> is `false`, call <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> to create the snapshot agent job for this publication.</span></span>  
  
4.  <span data-ttu-id="24109-287">手順 1. で作成した <xref:Microsoft.SqlServer.Replication.Publication.StartSnapshotGenerationAgentJob%2A> オブジェクトの <xref:Microsoft.SqlServer.Replication.MergePublication> メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="24109-287">Call the <xref:Microsoft.SqlServer.Replication.Publication.StartSnapshotGenerationAgentJob%2A> method of the <xref:Microsoft.SqlServer.Replication.MergePublication> object created in step 1.</span></span> <span data-ttu-id="24109-288">このメソッドにより、初期スナップショットを生成するエージェント ジョブが開始されます。</span><span class="sxs-lookup"><span data-stu-id="24109-288">This method starts the agent job that generates the initial snapshot.</span></span> <span data-ttu-id="24109-289">初期スナップショットを生成する方法、およびスナップショット エージェントのカスタム スケジュールを定義する方法については、「 [初期スナップショットの作成および適用](create-and-apply-the-initial-snapshot.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="24109-289">For more information on generating an initial snapshot and defining a custom schedule for the Snapshot Agent, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
5.  <span data-ttu-id="24109-290"><xref:Microsoft.SqlServer.Replication.MergePublication.SnapshotAvailable%2A> プロパティの値が `true` であることを確認し、初期スナップショットが使用できる状態にあるかを調べます。</span><span class="sxs-lookup"><span data-stu-id="24109-290">Check for a value of `true` for the <xref:Microsoft.SqlServer.Replication.MergePublication.SnapshotAvailable%2A> property to determine when the initial snapshot is ready for use.</span></span>  
  
6.  <span data-ttu-id="24109-291"><xref:Microsoft.SqlServer.Replication.MergePartition> クラスのインスタンスを作成し、次のいずれかまたは両方のプロパティを使って、サブスクライバー用のパラメーター化されたフィルター条件を設定します。</span><span class="sxs-lookup"><span data-stu-id="24109-291">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergePartition> class, and set the parameterized filtering criteria for the Subscriber by using one or both of the following properties:</span></span>  
  
    -   <span data-ttu-id="24109-292">サブスクライバーのパーティションが [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql) の結果によって定義される場合は、<xref:Microsoft.SqlServer.Replication.MergePartition.DynamicFilterLogin%2A> を使用します。</span><span class="sxs-lookup"><span data-stu-id="24109-292">If the Subscriber's partition is defined by the result of [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql), use <xref:Microsoft.SqlServer.Replication.MergePartition.DynamicFilterLogin%2A>.</span></span>  
  
    -   <span data-ttu-id="24109-293">サブスクライバーのパーティションが [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) またはこの関数のオーバーロードの結果によって定義される場合は、<xref:Microsoft.SqlServer.Replication.MergePartition.DynamicFilterHostName%2A> を使用します。</span><span class="sxs-lookup"><span data-stu-id="24109-293">If the Subscriber's partition is defined by the result of [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) or an overload of this function, use <xref:Microsoft.SqlServer.Replication.MergePartition.DynamicFilterHostName%2A>.</span></span>  
  
7.  <span data-ttu-id="24109-294"><xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> クラスのインスタンスを作成し、手順 6. と同じプロパティを設定します。</span><span class="sxs-lookup"><span data-stu-id="24109-294">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> class, and set the same property as in step 6.</span></span>  
  
8.  <span data-ttu-id="24109-295"><xref:Microsoft.SqlServer.Replication.ReplicationAgentSchedule> クラスを使用し、サブスクライバーのパーティションに対してフィルター選択されたスナップショットを生成するスケジュールを定義します。</span><span class="sxs-lookup"><span data-stu-id="24109-295">Use the <xref:Microsoft.SqlServer.Replication.ReplicationAgentSchedule> class to define a schedule for generating the filtered snapshot for the Subscriber partition.</span></span>  
  
9. <span data-ttu-id="24109-296">手順 1. で作成した <xref:Microsoft.SqlServer.Replication.MergePublication> のインスタンスを使用して、 <xref:Microsoft.SqlServer.Replication.MergePublication.AddMergePartition%2A>を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="24109-296">Using the instance of <xref:Microsoft.SqlServer.Replication.MergePublication> from step 1, call <xref:Microsoft.SqlServer.Replication.MergePublication.AddMergePartition%2A>.</span></span> <span data-ttu-id="24109-297">手順 6. の <xref:Microsoft.SqlServer.Replication.MergePartition> オブジェクトを渡します。</span><span class="sxs-lookup"><span data-stu-id="24109-297">Pass the <xref:Microsoft.SqlServer.Replication.MergePartition> object from step 6.</span></span>  
  
10. <span data-ttu-id="24109-298">手順 1. で作成した <xref:Microsoft.SqlServer.Replication.MergePublication> のインスタンスを使用して、 <xref:Microsoft.SqlServer.Replication.MergePublication.AddMergeDynamicSnapshotJob%2A> メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="24109-298">Using the instance of <xref:Microsoft.SqlServer.Replication.MergePublication> from step 1, call the <xref:Microsoft.SqlServer.Replication.MergePublication.AddMergeDynamicSnapshotJob%2A> method.</span></span> <span data-ttu-id="24109-299">このとき、手順 7. の <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> オブジェクトと、手順 8. の <xref:Microsoft.SqlServer.Replication.ReplicationAgentSchedule> オブジェクトを引数として指定します。</span><span class="sxs-lookup"><span data-stu-id="24109-299">Pass the <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> object from step 7 and the <xref:Microsoft.SqlServer.Replication.ReplicationAgentSchedule> object from step 8.</span></span>  
  
11. <span data-ttu-id="24109-300"><xref:Microsoft.SqlServer.Replication.MergePublication.EnumMergeDynamicSnapshotJobs%2A>を呼び出し、返された配列から <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> オブジェクトを検索し、パーティション スナップショットを要求するジョブが新たに追加されていないか確認します。</span><span class="sxs-lookup"><span data-stu-id="24109-300">Call <xref:Microsoft.SqlServer.Replication.MergePublication.EnumMergeDynamicSnapshotJobs%2A>, and locate the <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> object for the newly added partitioned snapshot job in the returned array.</span></span>  
  
12. <span data-ttu-id="24109-301">このジョブの <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob.Name%2A> プロパティを取得します。</span><span class="sxs-lookup"><span data-stu-id="24109-301">Get the <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob.Name%2A> property for the job.</span></span>  
  
13. <span data-ttu-id="24109-302"><xref:Microsoft.SqlServer.Management.Common.ServerConnection> クラスを使用して、ディストリビューターへの接続を作成します。</span><span class="sxs-lookup"><span data-stu-id="24109-302">Create a connection to the Distributor by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
14. <span data-ttu-id="24109-303">SQL Server 管理オブジェクト (SMO) の <xref:Microsoft.SqlServer.Management.Smo.Server> クラスのインスタンスを作成し、手順 13. の <xref:Microsoft.SqlServer.Management.Common.ServerConnection> オブジェクトを渡します。</span><span class="sxs-lookup"><span data-stu-id="24109-303">Create an instance of the SQL Server Management Objects (SMO) <xref:Microsoft.SqlServer.Management.Smo.Server> class, passing the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> object from step 13.</span></span>  
  
15. <span data-ttu-id="24109-304"><xref:Microsoft.SqlServer.Management.Smo.Agent.Job> クラスのインスタンスを作成し、手順 14. の <xref:Microsoft.SqlServer.Management.Smo.Server.JobServer%2A> オブジェクトの <xref:Microsoft.SqlServer.Management.Smo.Server> プロパティと、手順 12. のジョブ名を渡します。</span><span class="sxs-lookup"><span data-stu-id="24109-304">Create an instance of the <xref:Microsoft.SqlServer.Management.Smo.Agent.Job> class, passing the <xref:Microsoft.SqlServer.Management.Smo.Server.JobServer%2A> property of the <xref:Microsoft.SqlServer.Management.Smo.Server> object from step 14 and the job name from step 12.</span></span>  
  
16. <span data-ttu-id="24109-305"><xref:Microsoft.SqlServer.Management.Smo.Agent.Job.Start%2A> メソッドを呼び出して、パーティション スナップショットを要求するジョブを開始します。</span><span class="sxs-lookup"><span data-stu-id="24109-305">Call the <xref:Microsoft.SqlServer.Management.Smo.Agent.Job.Start%2A> method to start the partitioned snapshot job.</span></span>  
  
17. <span data-ttu-id="24109-306">手順 6. から手順 16. を各サブスクライバーについて繰り返します。</span><span class="sxs-lookup"><span data-stu-id="24109-306">Repeat steps 6-16 for each Subscriber.</span></span>  
  
#### <a name="to-create-a-publication-and-manually-create-snapshots-for-each-partition"></a><span data-ttu-id="24109-307">パブリケーションを作成し、各パーティションのスナップショットを手動で作成するには</span><span class="sxs-lookup"><span data-stu-id="24109-307">To create a publication and manually create snapshots for each partition</span></span>  
  
1.  <span data-ttu-id="24109-308"><xref:Microsoft.SqlServer.Replication.MergePublication> クラスのインスタンスを使用して、マージ パブリケーションを定義します。</span><span class="sxs-lookup"><span data-stu-id="24109-308">Use an instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class to define a merge publication.</span></span> <span data-ttu-id="24109-309">詳しくは、「 [パブリケーションを作成](publish/create-a-publication.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="24109-309">For more information, see [Create a Publication](publish/create-a-publication.md).</span></span>  
  
2.  <span data-ttu-id="24109-310"><xref:Microsoft.SqlServer.Replication.MergeArticle> プロパティを使用して、パブリケーションにアーティクルを追加します。パラメーター化されたフィルターを定義する <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> プロパティを少なくとも 1 つのアーティクルについて指定し、さらに、必要に応じて、アーティクル間の結合フィルターを定義する <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> オブジェクトを作成します。</span><span class="sxs-lookup"><span data-stu-id="24109-310">Use the <xref:Microsoft.SqlServer.Replication.MergeArticle> property to add articles to the publication Specify the <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> property for at least one article that defines the parameterized filter, and create any <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> objects that define join filters between articles.</span></span> <span data-ttu-id="24109-311">詳しくは、「 [アーティクルを定義](publish/define-an-article.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="24109-311">For more information, see [Define an Article](publish/define-an-article.md).</span></span>  
  
3.  <span data-ttu-id="24109-312">初期スナップショットを生成します。</span><span class="sxs-lookup"><span data-stu-id="24109-312">Generate the initial snapshot.</span></span> <span data-ttu-id="24109-313">詳しくは、「 [初期スナップショットの作成および適用](create-and-apply-the-initial-snapshot.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="24109-313">For more information, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
4.  <span data-ttu-id="24109-314"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent> クラスのインスタンスを作成し、次の必須プロパティを設定します。</span><span class="sxs-lookup"><span data-stu-id="24109-314">Create an instance of the <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent> class, and set the following required properties:</span></span>  
  
    -   <span data-ttu-id="24109-315"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publisher%2A> - パブリッシャーの名前</span><span class="sxs-lookup"><span data-stu-id="24109-315"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publisher%2A> - name of the Publisher</span></span>  
  
    -   <span data-ttu-id="24109-316"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherDatabase%2A> - パブリケーション データベースの名前</span><span class="sxs-lookup"><span data-stu-id="24109-316"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherDatabase%2A> - name of the publication database</span></span>  
  
    -   <span data-ttu-id="24109-317"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publication%2A> - パブリケーションの名前</span><span class="sxs-lookup"><span data-stu-id="24109-317"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publication%2A> - name of the publication</span></span>  
  
    -   <span data-ttu-id="24109-318"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Distributor%2A> - ディストリビューターの名前</span><span class="sxs-lookup"><span data-stu-id="24109-318"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Distributor%2A> - name of the Distributor</span></span>  
  
    -   <span data-ttu-id="24109-319"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherSecurityMode%2A> - 値 <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> (Windows 統合認証を使用する場合) または値 <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> (SQL Server 認証を使用する場合)</span><span class="sxs-lookup"><span data-stu-id="24109-319"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherSecurityMode%2A> - a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> to used Windows Integrated Authentication or a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> to use SQL Server Authentication.</span></span>  
  
    -   <span data-ttu-id="24109-320"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorSecurityMode%2A> - 値 <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> (Windows 統合認証を使用する場合) または値 <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> (SQL Server 認証を使用する場合)</span><span class="sxs-lookup"><span data-stu-id="24109-320"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorSecurityMode%2A> - a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> to used Windows Integrated Authentication or a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> to use SQL Server Authentication.</span></span>  
  
5.  <span data-ttu-id="24109-321"><xref:Microsoft.SqlServer.Replication.ReplicationType.Merge> に <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.ReplicationType%2A>を設定します。</span><span class="sxs-lookup"><span data-stu-id="24109-321">Set a value of <xref:Microsoft.SqlServer.Replication.ReplicationType.Merge> for <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.ReplicationType%2A>.</span></span>  
  
6.  <span data-ttu-id="24109-322">次に示したプロパティを少なくとも 1 つ設定し、パーティションのパラメーターを定義します。</span><span class="sxs-lookup"><span data-stu-id="24109-322">Set one or more of the following properties to define the partitioning parameters:</span></span>  
  
    -   <span data-ttu-id="24109-323">サブスクライバーのパーティションが [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql) の結果によって定義される場合は、<xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DynamicFilterLogin%2A> を使用します。</span><span class="sxs-lookup"><span data-stu-id="24109-323">If the Subscriber's partition is defined by the result of [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql), use <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DynamicFilterLogin%2A>.</span></span>  
  
    -   <span data-ttu-id="24109-324">サブスクライバーのパーティションが [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) またはこの関数のオーバーロードの結果によって定義される場合は、<xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DynamicFilterHostName%2A> を使用します。</span><span class="sxs-lookup"><span data-stu-id="24109-324">If the Subscriber's partition is defined by the result of [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) or an overload of this function, use <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DynamicFilterHostName%2A>.</span></span>  
  
7.  <span data-ttu-id="24109-325"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.GenerateSnapshot%2A> メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="24109-325">Call the <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.GenerateSnapshot%2A> method.</span></span>  
  
8.  <span data-ttu-id="24109-326">手順 4. から手順 7. を各サブスクライバーについて繰り返します。</span><span class="sxs-lookup"><span data-stu-id="24109-326">Repeat steps 4-7 for each Subscriber.</span></span>  
  
###  <a name="examples-rmo"></a><a name="PShellExample"></a> <span data-ttu-id="24109-327">例 (RMO)</span><span class="sxs-lookup"><span data-stu-id="24109-327">Examples (RMO)</span></span>  
 <span data-ttu-id="24109-328">次の例では、サブスクライバーがスナップショット生成を要求できるマージ パブリケーションを作成します。</span><span class="sxs-lookup"><span data-stu-id="24109-328">This example creates a merge publication that allows Subscribers to requested snapshot generation.</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateMergePub](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createmergepub)]  
  
 [!code-vb[HowTo#rmo_vb_CreateMergePub](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createmergepub)]  
  
 <span data-ttu-id="24109-329">次の例では、手動でサブスクライバーのパーティションを作成し、さらに、パラメーター化された行フィルターを使って、マージ パブリケーションのフィルター選択されたスナップショットを作成します。</span><span class="sxs-lookup"><span data-stu-id="24109-329">This example manually creates the Subscriber partition and the filtered snapshot for a merge publication with parameterized row filters.</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateMergePartition](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createmergepartition)]  
  
 [!code-vb[HowTo#rmo_vb_CreateMergePartition](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createmergepartition)]  
  
 <span data-ttu-id="24109-330">次の例では、手動でスナップショット エージェントを起動し、パラメーター化された行フィルターを使って、マージ パブリケーションのサブスクライバー用にフィルター選択されたデータ スナップショットを生成します。</span><span class="sxs-lookup"><span data-stu-id="24109-330">This example manually starts the Snapshot Agent to generate the filtered data snapshot for a Subscriber to a merge publication with parameterized row filters.</span></span>  
  
 [!code-csharp[HowTo#rmo_GenerateFilteredSnapshot](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_generatefilteredsnapshot)]  
  
 [!code-vb[HowTo#rmo_vb_GenerateFilteredSnapshot](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_generatefilteredsnapshot)]  
  
## <a name="see-also"></a><span data-ttu-id="24109-331">参照</span><span class="sxs-lookup"><span data-stu-id="24109-331">See Also</span></span>  
 <span data-ttu-id="24109-332">[Parameterized Row Filters](merge/parameterized-filters-parameterized-row-filters.md) </span><span class="sxs-lookup"><span data-stu-id="24109-332">[Parameterized Row Filters](merge/parameterized-filters-parameterized-row-filters.md) </span></span>  
 <span data-ttu-id="24109-333">[Replication System Stored Procedures Concepts](concepts/replication-system-stored-procedures-concepts.md) </span><span class="sxs-lookup"><span data-stu-id="24109-333">[Replication System Stored Procedures Concepts](concepts/replication-system-stored-procedures-concepts.md) </span></span>  
 <span data-ttu-id="24109-334">[パラメーター化されたフィルターを使用したマージパブリケーションのスナップショット](snapshots-for-merge-publications-with-parameterized-filters.md) </span><span class="sxs-lookup"><span data-stu-id="24109-334">[Snapshots for Merge Publications with Parameterized Filters](snapshots-for-merge-publications-with-parameterized-filters.md) </span></span>  
 [<span data-ttu-id="24109-335">レプリケーション セキュリティの推奨事項</span><span class="sxs-lookup"><span data-stu-id="24109-335">Replication Security Best Practices</span></span>](security/replication-security-best-practices.md)  
  
  
