---
title: プル サブスクリプションの作成 | Microsoft Docs
ms.custom: ''
ms.date: 05/24/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- pull subscriptions [SQL Server replication], creating
- merge replication subscribing [SQL Server replication], pull subscriptions
- subscriptions [SQL Server replication], pull
- snapshot replication [SQL Server], subscribing
- transactional replication, subscribing
ms.assetid: 41d1886d-59c9-41fc-9bd6-a59b40e0af6e
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 12ef7d658496c0fb7281827259e8e46f0c5fac64
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87646135"
---
# <a name="create-a-pull-subscription"></a><span data-ttu-id="9565a-102">プル サブスクリプションの作成</span><span class="sxs-lookup"><span data-stu-id="9565a-102">Create a Pull Subscription</span></span>
  <span data-ttu-id="9565a-103">このトピックでは、 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] で [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]、 [!INCLUDE[tsql](../../includes/tsql-md.md)]、またはレプリケーション管理オブジェクト (RMO) を使用してプル サブスクリプションを作成する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="9565a-103">This topic describes how create a pull subscription in [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] by using [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../includes/tsql-md.md)], or Replication Management Objects (RMO).</span></span>  
  
 <span data-ttu-id="9565a-104">P2P レプリケーションのプル サブスクリプションの設定にはスクリプトを使用できますが、ウィザードは使用できません。</span><span class="sxs-lookup"><span data-stu-id="9565a-104">Setting up a pull subscription for P2P replication is possible by script, but is not available through the wizard.</span></span>  
  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> <span data-ttu-id="9565a-105">SQL Server Management Studio の使用</span><span class="sxs-lookup"><span data-stu-id="9565a-105">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="9565a-106">サブスクリプションの新規作成ウィザードを使用して、パブリッシャーまたはサブスクライバーでプル サブスクリプションを作成します。</span><span class="sxs-lookup"><span data-stu-id="9565a-106">Create a pull subscription at the Publisher or the Subscriber using the New Subscription Wizard.</span></span> <span data-ttu-id="9565a-107">ウィザードのページに従って、次の操作を実行します。</span><span class="sxs-lookup"><span data-stu-id="9565a-107">Follow the pages in the wizard to:</span></span>  
  
-   <span data-ttu-id="9565a-108">パブリッシャーとパブリケーションを指定します。</span><span class="sxs-lookup"><span data-stu-id="9565a-108">Specify the Publisher and publication.</span></span>  
  
-   <span data-ttu-id="9565a-109">レプリケーション エージェントが実行される場所を選択します。</span><span class="sxs-lookup"><span data-stu-id="9565a-109">Select where replication agents will run.</span></span> <span data-ttu-id="9565a-110">プル サブスクリプションでは、パブリケーションの種類に応じて、 **[ディストリビューション エージェントの場所]** ページまたは **[マージ エージェントの場所]** ページで、 **[サブスクライバーで各エージェントを実行する (プル サブスクリプション)]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="9565a-110">For a pull subscription, select **Run each agent at its Subscriber (pull subscriptions)** on the **Distribution Agent Location** page or **Merge Agent Location** page, depending on the type of publication.</span></span>  
  
-   <span data-ttu-id="9565a-111">サブスクライバーとサブスクリプション データベースを指定します。</span><span class="sxs-lookup"><span data-stu-id="9565a-111">Specify Subscribers and subscription databases.</span></span>  
  
-   <span data-ttu-id="9565a-112">レプリケーション エージェントによって作成された接続に対して使用されるログインとパスワードを指定します。</span><span class="sxs-lookup"><span data-stu-id="9565a-112">Specify the logins and passwords used for connections made by replication agents:</span></span>  
  
    -   <span data-ttu-id="9565a-113">スナップショット パブリケーションとトランザクション パブリケーションに対するサブスクリプションでは、 **[ディストリビューション エージェント セキュリティ]** ページで資格情報を指定します。</span><span class="sxs-lookup"><span data-stu-id="9565a-113">For subscriptions to snapshot and transactional publications, specify credentials on the **Distribution Agent Security** page.</span></span>  
  
    -   <span data-ttu-id="9565a-114">マージ パブリケーションに対するサブスクリプションでは、 **[マージ エージェント セキュリティ]** ページで資格情報を指定します。</span><span class="sxs-lookup"><span data-stu-id="9565a-114">For subscriptions to merge publications, specify credentials on the **Merge Agent Security** page.</span></span>  
  
     <span data-ttu-id="9565a-115">各エージェントで必要な権限の詳細については、「 [レプリケーション エージェント セキュリティ モデル](security/replication-agent-security-model.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9565a-115">For information about the permissions required by each agent, see [Replication Agent Security Model](security/replication-agent-security-model.md).</span></span>  
  
-   <span data-ttu-id="9565a-116">同期スケジュール、およびサブスクライバーをいつ初期化するかを指定します。</span><span class="sxs-lookup"><span data-stu-id="9565a-116">Specify a synchronization schedule and when the Subscriber should be initialized.</span></span>  
  
-   <span data-ttu-id="9565a-117">マージ パブリケーションの追加オプションである、サブスクリプションの種類、パラメーター化されたフィルターの値、およびパブリケーションが Web 同期に対して有効になっている場合の HTTPS を使用した同期に関する情報を指定します。</span><span class="sxs-lookup"><span data-stu-id="9565a-117">Specify additional options for merge publications: subscription type; values for parameterized filtering; and information for synchronization through HTTPS if the publication is enabled for Web synchronization.</span></span>  
  
-   <span data-ttu-id="9565a-118">サブスクリプションの更新が許可されるトランザクション パブリケーションの追加オプションを指定します。サブスクライバーがパブリッシャーで変更をすぐにコミットするかどうか、変更をキューに書き込むかどうか、およびサブスクライバーからパブリッシャーへの接続に使用される資格情報を指定します。</span><span class="sxs-lookup"><span data-stu-id="9565a-118">Specify additional options for transactional publications that allow updating subscriptions: whether Subscribers should commit changes at the Publisher immediately or write them to a queue; credentials used to connect from the Subscriber to the Publisher.</span></span>  
  
-   <span data-ttu-id="9565a-119">必要に応じて、サブスクリプションのスクリプトを作成します。</span><span class="sxs-lookup"><span data-stu-id="9565a-119">Optionally script the subscription.</span></span>  
  
#### <a name="to-create-a-pull-subscription-from-the-publisher"></a><span data-ttu-id="9565a-120">パブリッシャーからプル サブスクリプションを作成するには</span><span class="sxs-lookup"><span data-stu-id="9565a-120">To create a pull subscription from the Publisher</span></span>  
  
1.  <span data-ttu-id="9565a-121">[!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] でパブリッシャーに接続し、サーバー ノードを展開します。</span><span class="sxs-lookup"><span data-stu-id="9565a-121">Connect to the Publisher in [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], and then expand the server node.</span></span>  
  
2.  <span data-ttu-id="9565a-122">**[レプリケーション]** フォルダーを展開し、 **[ローカル パブリケーション]** フォルダーを展開します。</span><span class="sxs-lookup"><span data-stu-id="9565a-122">Expand the **Replication** folder, and then expand the **Local Publications** folder.</span></span>  
  
3.  <span data-ttu-id="9565a-123">1 つ以上のサブスクリプションを作成するパブリケーションを右クリックし、 **[新しいサブスクリプション]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="9565a-123">Right-click the publication for which you want to create one or more subscriptions, and then click **New Subscriptions**.</span></span>  
  
4.  <span data-ttu-id="9565a-124">サブスクリプションの新規作成ウィザードのページに従って操作を実行します。</span><span class="sxs-lookup"><span data-stu-id="9565a-124">Complete the pages in the New Subscription Wizard.</span></span>  
  
#### <a name="to-create-a-pull-subscription-from-the-subscriber"></a><span data-ttu-id="9565a-125">サブスクライバーからプル サブスクリプションを作成するには</span><span class="sxs-lookup"><span data-stu-id="9565a-125">To create a pull subscription from the Subscriber</span></span>  
  
1.  <span data-ttu-id="9565a-126">[!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]でサブスクライバーに接続して、サーバー ノードを展開します。</span><span class="sxs-lookup"><span data-stu-id="9565a-126">Connect to the Subscriber in [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], and then expand the server node.</span></span>  
  
2.  <span data-ttu-id="9565a-127">**[レプリケーション]** フォルダーを展開します。</span><span class="sxs-lookup"><span data-stu-id="9565a-127">Expand the **Replication** folder.</span></span>  
  
3.  <span data-ttu-id="9565a-128">**[ローカル サブスクリプション]** フォルダーを右クリックし、 **[新しいサブスクリプション]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="9565a-128">Right-click the **Local Subscriptions** folder, and then click **New Subscriptions**.</span></span>  
  
4.  <span data-ttu-id="9565a-129">サブスクリプションの新規作成ウィザードの **[パブリケーション]** ページで、 **[パブリッシャー]** ドロップダウン リストから **[\<Find SQL Server Publisher>]** または **[\<Find Oracle Publisher>]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="9565a-129">On the **Publication** page of the New Subscription Wizard, select **\<Find SQL Server Publisher>** or **\<Find Oracle Publisher>** from the **Publisher** drop-down list.</span></span>  
  
5.  <span data-ttu-id="9565a-130">**[サーバーへの接続]** ダイアログ ボックスでパブリッシャーに接続します。</span><span class="sxs-lookup"><span data-stu-id="9565a-130">Connect to the Publisher in the **Connect to Server** dialog box.</span></span>  
  
6.  <span data-ttu-id="9565a-131">**[パブリケーション]** ページでパブリケーションを選択します。</span><span class="sxs-lookup"><span data-stu-id="9565a-131">Select a publication on the **Publication** page.</span></span>  
  
7.  <span data-ttu-id="9565a-132">サブスクリプションの新規作成ウィザードのページに従って操作を実行します。</span><span class="sxs-lookup"><span data-stu-id="9565a-132">Complete the pages in the New Subscription Wizard.</span></span>  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="9565a-133">Transact-SQL の使用</span><span class="sxs-lookup"><span data-stu-id="9565a-133">Using Transact-SQL</span></span>  
 <span data-ttu-id="9565a-134">レプリケーション ストアド プロシージャを使用して、プル サブスクリプションをプログラムで作成できます。</span><span class="sxs-lookup"><span data-stu-id="9565a-134">Pull subscriptions can be created programmatically using replication stored procedures.</span></span> <span data-ttu-id="9565a-135">使用するストアド プロシージャは、サブスクリプションが属するパブリケーションの種類によって変わります。</span><span class="sxs-lookup"><span data-stu-id="9565a-135">The stored procedures used will depend on the type of publication to which the subscription belongs.</span></span>  
  
#### <a name="to-create-a-pull-subscription-to-a-snapshot-or-transactional-publication"></a><span data-ttu-id="9565a-136">スナップショット パブリケーションまたはトランザクション パブリケーションに対するプル サブスクリプションを作成するには</span><span class="sxs-lookup"><span data-stu-id="9565a-136">To create a pull subscription to a snapshot or transactional publication</span></span>  
  
1.  <span data-ttu-id="9565a-137">パブリッシャーで、 [sp_helppublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helppublication-transact-sql) を実行することにより、パブリケーションがプル サブスクリプションをサポートしていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="9565a-137">At the Publisher, verify that the publication supports pull subscriptions by executing [sp_helppublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helppublication-transact-sql).</span></span>  
  
    -   <span data-ttu-id="9565a-138">結果セットの **allow_pull** の値が **1**である場合、パブリケーションはプル サブスクリプションをサポートします。</span><span class="sxs-lookup"><span data-stu-id="9565a-138">If the value of **allow_pull** in the result set is **1**, then the publication supports pull subscriptions.</span></span>  
  
    -   <span data-ttu-id="9565a-139">**Allow_pull**の値が**0**の場合は、 [transact-sql&#41;&#40;sp_changepublication](/sql/relational-databases/system-stored-procedures/sp-changepublication-transact-sql)を実行します。には、およびに対して**allow_pull**を指定し **@property** `true` **@value** ます。</span><span class="sxs-lookup"><span data-stu-id="9565a-139">If the value of **allow_pull** is **0**, execute [sp_changepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-changepublication-transact-sql), specifying **allow_pull** for **@property** and `true` for **@value**.</span></span>  
  
2.  <span data-ttu-id="9565a-140">サブスクライバーで、[sp_addpullsubscription &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-transact-sql) を実行します。</span><span class="sxs-lookup"><span data-stu-id="9565a-140">At the Subscriber, execute [sp_addpullsubscription &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-transact-sql).</span></span> <span data-ttu-id="9565a-141">およびを指定し **@publisher** **@publication** ます。</span><span class="sxs-lookup"><span data-stu-id="9565a-141">Specify **@publisher** and **@publication**.</span></span> <span data-ttu-id="9565a-142">サブスクリプションの更新の詳細については、「 [トランザクション パブリケーションの更新可能なサブスクリプションの作成](publish/create-an-updatable-subscription-to-a-transactional-publication.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9565a-142">For information about updating subscriptions, see [Create an Updatable Subscription to a Transactional Publication](publish/create-an-updatable-subscription-to-a-transactional-publication.md).</span></span>  
  
3.  <span data-ttu-id="9565a-143">サブスクライバーで、[sp_addpullsubscription_agent &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-agent-transact-sql) を実行します。</span><span class="sxs-lookup"><span data-stu-id="9565a-143">At the Subscriber, execute [sp_addpullsubscription_agent &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-agent-transact-sql).</span></span> <span data-ttu-id="9565a-144">次の指定を行います。</span><span class="sxs-lookup"><span data-stu-id="9565a-144">Specify the following:</span></span>  
  
    -   <span data-ttu-id="9565a-145">、、およびの各 **@publisher** **@publisher_db** **@publication** パラメーター。</span><span class="sxs-lookup"><span data-stu-id="9565a-145">The **@publisher**, **@publisher_db**, and **@publication** parameters.</span></span>  
  
    -   <span data-ttu-id="9565a-146">[!INCLUDE[msCoName](../../includes/msconame-md.md)]およびに対してサブスクライバーでディストリビューションエージェントを実行するときに使用する Windows 資格情報 **@job_login** **@job_password** 。</span><span class="sxs-lookup"><span data-stu-id="9565a-146">The [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows credentials under which the Distribution Agent at the Subscriber runs for **@job_login** and **@job_password**.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="9565a-147">Windows 統合認証を使用して確立される接続は、常におよびで指定された Windows 資格情報を使用し **@job_login** **@job_password** ます。</span><span class="sxs-lookup"><span data-stu-id="9565a-147">Connections made using Windows Integrated Authentication always use the Windows credentials specified by **@job_login** and **@job_password**.</span></span> <span data-ttu-id="9565a-148">ディストリビューション エージェントは、常に Windows 統合認証を使用してサブスクライバーへのローカル接続を作成します。</span><span class="sxs-lookup"><span data-stu-id="9565a-148">The Distribution Agent always makes the local connection to the Subscriber using Windows Integrated Authentication.</span></span> <span data-ttu-id="9565a-149">既定では、エージェントは Windows 統合認証を使用してディストリビューターに接続します。</span><span class="sxs-lookup"><span data-stu-id="9565a-149">By default, the agent will connect to the Distributor using Windows Integrated Authentication.</span></span>  
  
    -   <span data-ttu-id="9565a-150">(省略可) ディストリビューターへの接続時に **0** allow_pull **@distributor_security_mode** 0 [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] @distributor_login **@distributor_login** @value **@distributor_password**に [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ログイン情報。</span><span class="sxs-lookup"><span data-stu-id="9565a-150">(Optional) A value of **0** for **@distributor_security_mode** and the [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **@distributor_login** and **@distributor_password**, if you need to use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Distributor.</span></span>  
  
    -   <span data-ttu-id="9565a-151">このサブスクリプションでのディストリビューション エージェント ジョブのスケジュール。</span><span class="sxs-lookup"><span data-stu-id="9565a-151">A schedule for the Distribution Agent job for this subscription.</span></span> <span data-ttu-id="9565a-152">詳細については、「 [Specify Synchronization Schedules](specify-synchronization-schedules.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9565a-152">For more information, see [Specify Synchronization Schedules](specify-synchronization-schedules.md).</span></span>  
  
4.  <span data-ttu-id="9565a-153">パブリッシャー側で [sp_addsubscription &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql) を実行し、プル サブスクリプションを登録します。</span><span class="sxs-lookup"><span data-stu-id="9565a-153">At the Publisher, execute [sp_addsubscription &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql) to register the pull subscription.</span></span> <span data-ttu-id="9565a-154">**@publication**、、およびを指定し **@subscriber** **@destination_db** ます。</span><span class="sxs-lookup"><span data-stu-id="9565a-154">Specify **@publication**, **@subscriber**, and **@destination_db**.</span></span> <span data-ttu-id="9565a-155">**@subscription_type** に **pull** を指定します。</span><span class="sxs-lookup"><span data-stu-id="9565a-155">Specify a value of **pull** for **@subscription_type**.</span></span>  
  
#### <a name="to-create-a-pull-subscription-to-a-merge-publication"></a><span data-ttu-id="9565a-156">マージ パブリケーションに対するプル サブスクリプションを作成するには</span><span class="sxs-lookup"><span data-stu-id="9565a-156">To create a pull subscription to a merge publication</span></span>  
  
1.  <span data-ttu-id="9565a-157">パブリッシャーで、[sp_helpmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpmergepublication-transact-sql) を実行することにより、パブリケーションがプル サブスクリプションをサポートしていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="9565a-157">At the Publisher, verify that the publication supports pull subscriptions by executing [sp_helpmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpmergepublication-transact-sql).</span></span>  
  
    -   <span data-ttu-id="9565a-158">結果セットの **allow_pull** の値が **1**である場合、パブリケーションはプル サブスクリプションをサポートします。</span><span class="sxs-lookup"><span data-stu-id="9565a-158">If the value of **allow_pull** in the result set is **1**, then the publication supports pull subscriptions.</span></span>  
  
    -   <span data-ttu-id="9565a-159">**Allow_pull**の値が**0**の場合は、 [transact-sql&#41;&#40;sp_changemergepublication](/sql/relational-databases/system-stored-procedures/sp-changemergepublication-transact-sql)を実行します。には、およびに対して**allow_pull**を指定し **@property** `true` **@value** ます。</span><span class="sxs-lookup"><span data-stu-id="9565a-159">If the value of **allow_pull** is **0**, execute [sp_changemergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-changemergepublication-transact-sql), specifying **allow_pull** for **@property** and `true` for **@value**.</span></span>  
  
2.  <span data-ttu-id="9565a-160">サブスクライバーで、[sp_addmergepullsubscription &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-transact-sql) を実行します。</span><span class="sxs-lookup"><span data-stu-id="9565a-160">At the Subscriber, execute [sp_addmergepullsubscription &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-transact-sql).</span></span> <span data-ttu-id="9565a-161">**@publisher**、、 **@publisher_db** **@publication** 、および次のパラメーターを指定します。</span><span class="sxs-lookup"><span data-stu-id="9565a-161">Specify **@publisher**, **@publisher_db**, **@publication**, and the following parameters:</span></span>  
  
    -   <span data-ttu-id="9565a-162">**@subscriber_type**-クライアントサブスクリプションには**local**を、サーバーサブスクリプションには**global**を指定します。</span><span class="sxs-lookup"><span data-stu-id="9565a-162">**@subscriber_type** - specify **local** for a client subscription and **global** for a server subscription.</span></span>  
  
    -   <span data-ttu-id="9565a-163">**@subscription_priority**-サブスクリプションの優先度を指定します (**0.00** ~ **99.99**)。</span><span class="sxs-lookup"><span data-stu-id="9565a-163">**@subscription_priority** - Specify a priority for the subscription (**0.00** to **99.99**).</span></span> <span data-ttu-id="9565a-164">これは、サーバー サブスクリプションにのみ必要です。</span><span class="sxs-lookup"><span data-stu-id="9565a-164">This is only required for a server subscription.</span></span>  
  
         <span data-ttu-id="9565a-165">詳細については、「 [マージ レプリケーションの競合検出および解決の詳細](merge/advanced-merge-replication-conflict-detection-and-resolution.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9565a-165">For more information, see [Advanced Merge Replication Conflict Detection and Resolution](merge/advanced-merge-replication-conflict-detection-and-resolution.md).</span></span>  
  
3.  <span data-ttu-id="9565a-166">サブスクライバーで、 [sp_addmergepullsubscription_agent &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-agent-transact-sql) を実行します。</span><span class="sxs-lookup"><span data-stu-id="9565a-166">At the Subscriber, execute [sp_addmergepullsubscription_agent &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-agent-transact-sql).</span></span> <span data-ttu-id="9565a-167">次のパラメーターを指定します。</span><span class="sxs-lookup"><span data-stu-id="9565a-167">Specify the following parameters:</span></span>  
  
    -   <span data-ttu-id="9565a-168">**@publisher**、 **@publisher_db** 、および **@publication** 。</span><span class="sxs-lookup"><span data-stu-id="9565a-168">**@publisher**, **@publisher_db**, and **@publication**.</span></span>  
  
    -   <span data-ttu-id="9565a-169">およびに対してサブスクライバーでマージエージェントを実行するときに使用する Windows 資格情報 **@job_login** **@job_password** 。</span><span class="sxs-lookup"><span data-stu-id="9565a-169">The Windows credentials under which the Merge Agent at the Subscriber runs for **@job_login** and **@job_password**.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="9565a-170">Windows 統合認証を使用して確立される接続は、常におよびで指定された Windows 資格情報を使用し **@job_login** **@job_password** ます。</span><span class="sxs-lookup"><span data-stu-id="9565a-170">Connections made using Windows Integrated Authentication always use the Windows credentials specified by **@job_login** and **@job_password**.</span></span> <span data-ttu-id="9565a-171">マージ エージェントは、常に Windows 統合認証を使用してサブスクライバーへのローカル接続を作成します。</span><span class="sxs-lookup"><span data-stu-id="9565a-171">The Merge Agent always makes the local connection to the Subscriber using Windows Integrated Authentication.</span></span> <span data-ttu-id="9565a-172">既定では、エージェントは Windows 統合認証を使用してディストリビューターおよびパブリッシャーに接続します。</span><span class="sxs-lookup"><span data-stu-id="9565a-172">By default, the agent will connect to the Distributor and Publisher using Windows Integrated Authentication.</span></span>  
  
    -   <span data-ttu-id="9565a-173">(省略可) ディストリビューターへの接続時に **0** allow_pull **@distributor_security_mode** 0 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] @distributor_login **@distributor_login** @value **@distributor_password**に [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ログイン情報。</span><span class="sxs-lookup"><span data-stu-id="9565a-173">(Optional) A value of **0** for **@distributor_security_mode** and the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **@distributor_login** and **@distributor_password**, if you need to use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Distributor.</span></span>  
  
    -   <span data-ttu-id="9565a-174">(省略可) ディストリビューターへの接続時に **0** allow_pull **@publisher_security_mode** 0 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] @distributor_login **@publisher_login** @value **@publisher_password**に [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ログイン情報。</span><span class="sxs-lookup"><span data-stu-id="9565a-174">(Optional) A value of **0** for **@publisher_security_mode** and the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **@publisher_login** and **@publisher_password**, if you need to use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Publisher.</span></span>  
  
    -   <span data-ttu-id="9565a-175">このサブスクリプションでのマージ エージェント ジョブのスケジュール。</span><span class="sxs-lookup"><span data-stu-id="9565a-175">A schedule for the Merge Agent job for this subscription.</span></span> <span data-ttu-id="9565a-176">詳しくは、「 [トランザクション パブリケーションの更新可能なサブスクリプションの作成](publish/create-an-updatable-subscription-to-a-transactional-publication.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="9565a-176">For more information, see [Create an Updatable Subscription to a Transactional Publication](publish/create-an-updatable-subscription-to-a-transactional-publication.md).</span></span>  
  
4.  <span data-ttu-id="9565a-177">パブリッシャーで [sp_addmergesubscription &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergesubscription-transact-sql) を実行します。</span><span class="sxs-lookup"><span data-stu-id="9565a-177">At the Publisher, execute [sp_addmergesubscription &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergesubscription-transact-sql).</span></span> <span data-ttu-id="9565a-178">**@publication**、、 **@subscriber** **@subscriber_db** 、およびの**pull**の値を指定し **@subscription_type** ます。</span><span class="sxs-lookup"><span data-stu-id="9565a-178">Specify **@publication**, **@subscriber**, **@subscriber_db**, and a value of **pull** for **@subscription_type**.</span></span> <span data-ttu-id="9565a-179">これにより、プル サブスクリプションが登録されます。</span><span class="sxs-lookup"><span data-stu-id="9565a-179">This registers the pull subscription.</span></span>  
  
###  <a name="examples-transact-sql"></a><a name="TsqlExample"></a> <span data-ttu-id="9565a-180">例 (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="9565a-180">Examples (Transact-SQL)</span></span>  
 <span data-ttu-id="9565a-181">次の例では、トランザクション パブリケーションに対するプル サブスクリプションを作成します。</span><span class="sxs-lookup"><span data-stu-id="9565a-181">The following example creates a pull subscription to a transactional publication.</span></span> <span data-ttu-id="9565a-182">最初のバッチはサブスクライバーで実行され、2 番目のバッチはパブリッシャーで実行されます。</span><span class="sxs-lookup"><span data-stu-id="9565a-182">The first batch is executed at the Subscriber, and the second batch is executed at the Publisher.</span></span> <span data-ttu-id="9565a-183">ログインとパスワードの値は、実行時に sqlcmd スクリプト変数を使用して入力されます。</span><span class="sxs-lookup"><span data-stu-id="9565a-183">Login and password values are supplied at runtime using sqlcmd scripting variables.</span></span>  
  
 [!code-sql[HowTo#sp_addtranpullsubscriptionagent](../../snippets/tsql/SQL15/replication/howto/tsql/createtranpullsub.sql#sp_addtranpullsubscriptionagent)]  
  
 [!code-sql[HowTo#sp_addtranpullsubscription](../../snippets/tsql/SQL15/replication/howto/tsql/createtranpullsub.sql#sp_addtranpullsubscription)]  
  
 <span data-ttu-id="9565a-184">次の例では、マージ パブリケーションに対するプル サブスクリプションを作成します。</span><span class="sxs-lookup"><span data-stu-id="9565a-184">The following example creates a pull subscription to a merge publication.</span></span> <span data-ttu-id="9565a-185">最初のバッチはサブスクライバーで実行され、2 番目のバッチはパブリッシャーで実行されます。</span><span class="sxs-lookup"><span data-stu-id="9565a-185">The first batch is executed at the Subscriber, and the second batch is executed at the Publisher.</span></span> <span data-ttu-id="9565a-186">ログインとパスワードの値は、実行時に **sqlcmd** スクリプト変数を使用して入力されます。</span><span class="sxs-lookup"><span data-stu-id="9565a-186">Login and password values are supplied at runtime using **sqlcmd** scripting variables.</span></span>  
  
 [!code-sql[HowTo#sp_addmergepullsubscriptionagent](../../snippets/tsql/SQL15/replication/howto/tsql/createmergepullsub.sql#sp_addmergepullsubscriptionagent)]  
  
 [!code-sql[HowTo#sp_addmergepullsubscription](../../snippets/tsql/SQL15/replication/howto/tsql/createmergepullsub.sql#sp_addmergepullsubscription)]  
  
##  <a name="using-replication-management-objects-rmo"></a><a name="RMOProcedure"></a> <span data-ttu-id="9565a-187">レプリケーション管理オブジェクト (RMO) の使用</span><span class="sxs-lookup"><span data-stu-id="9565a-187">Using Replication Management Objects (RMO)</span></span>  
 <span data-ttu-id="9565a-188">プル サブスクリプションの作成に使用する RMO のクラスは、サブスクリプションが属しているパブリケーションの種類によって異なります。</span><span class="sxs-lookup"><span data-stu-id="9565a-188">The RMO classes used to create a pull subscription depend on the type of publication to which the subscription belongs.</span></span>  
  
#### <a name="to-create-a-pull-subscription-to-a-snapshot-or-transactional-publication"></a><span data-ttu-id="9565a-189">スナップショット パブリケーションまたはトランザクション パブリケーションに対するプル サブスクリプションを作成するには</span><span class="sxs-lookup"><span data-stu-id="9565a-189">To create a pull subscription to a snapshot or transactional publication</span></span>  
  
1.  <span data-ttu-id="9565a-190"><xref:Microsoft.SqlServer.Management.Common.ServerConnection> クラスを使用して、サブスクライバーおよびパブリッシャーへの接続を作成します。</span><span class="sxs-lookup"><span data-stu-id="9565a-190">Create connections to both the Subscriber and Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> Class.</span></span>  
  
2.  <span data-ttu-id="9565a-191">手順 1. のパブリッシャー接続を使用して、 <xref:Microsoft.SqlServer.Replication.TransPublication> クラスのインスタンスを作成します。</span><span class="sxs-lookup"><span data-stu-id="9565a-191">Create an instance of the <xref:Microsoft.SqlServer.Replication.TransPublication> class by using the Publisher connection from step 1.</span></span> <span data-ttu-id="9565a-192"><xref:Microsoft.SqlServer.Replication.Publication.Name%2A>、 <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A> 、および <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>を指定します。</span><span class="sxs-lookup"><span data-stu-id="9565a-192">Specify <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>, <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A> and <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span></span>  
  
3.  <span data-ttu-id="9565a-193"><xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="9565a-193">Call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method.</span></span> <span data-ttu-id="9565a-194">このメソッドが `false` を返す場合、手順 2. で指定したプロパティが誤っているか、サーバーにパブリケーションが存在していません。</span><span class="sxs-lookup"><span data-stu-id="9565a-194">If this method returns `false`, either the properties specified in step 2 are incorrect or the publication does not exist on the server.</span></span>  
  
4.  <span data-ttu-id="9565a-195"><xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> プロパティと <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPull> のビットごとの論理積演算 (Visual C# では `&`、Visual Basic では `And`) を実行します。</span><span class="sxs-lookup"><span data-stu-id="9565a-195">Perform a bitwise logical AND (`&` in Visual C# and `And` in Visual Basic) between the <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> property and <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPull>.</span></span> <span data-ttu-id="9565a-196">結果が <xref:Microsoft.SqlServer.Replication.PublicationAttributes.None> の場合、<xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> と <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> のビットごとの論理和演算 (Visual C# では `|`、Visual Basic では `Or`) の結果を <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPull> に設定します。</span><span class="sxs-lookup"><span data-stu-id="9565a-196">If the result is <xref:Microsoft.SqlServer.Replication.PublicationAttributes.None>, set <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> to the result of a bitwise logical OR (`|` in Visual C# and `Or` in Visual Basic) between <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> and <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPull>.</span></span> <span data-ttu-id="9565a-197">続けて、 <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A> を呼び出して、プル サブスクリプションを有効にします。</span><span class="sxs-lookup"><span data-stu-id="9565a-197">Then, call <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A> to enable pull subscriptions.</span></span>  
  
5.  <span data-ttu-id="9565a-198">サブスクリプション データベースが存在しない場合は、 <xref:Microsoft.SqlServer.Management.Smo.Database> クラスを使用して作成します。</span><span class="sxs-lookup"><span data-stu-id="9565a-198">If the subscription database does not exist, create it by using the <xref:Microsoft.SqlServer.Management.Smo.Database> class.</span></span> <span data-ttu-id="9565a-199">詳細については、「[データベースの作成、変更、および削除](../server-management-objects-smo/tasks/creating-altering-and-removing-databases.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9565a-199">For more information, see [Creating, Altering, and Removing Databases](../server-management-objects-smo/tasks/creating-altering-and-removing-databases.md).</span></span>  
  
6.  <span data-ttu-id="9565a-200"><xref:Microsoft.SqlServer.Replication.TransPullSubscription> クラスのインスタンスを作成します。</span><span class="sxs-lookup"><span data-stu-id="9565a-200">Create an instance of the <xref:Microsoft.SqlServer.Replication.TransPullSubscription> class.</span></span>  
  
7.  <span data-ttu-id="9565a-201">次のサブスクリプション プロパティを設定します。</span><span class="sxs-lookup"><span data-stu-id="9565a-201">Set the following subscription properties:</span></span>  
  
    -   <span data-ttu-id="9565a-202">手順 1. で作成した、サブスクライバーに対する <xref:Microsoft.SqlServer.Management.Common.ServerConnection> を <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>に指定します。</span><span class="sxs-lookup"><span data-stu-id="9565a-202">The <xref:Microsoft.SqlServer.Management.Common.ServerConnection> to the Subscriber created in step 1 for <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span></span>  
  
    -   <span data-ttu-id="9565a-203">サブスクリプション データベース名を <xref:Microsoft.SqlServer.Replication.PullSubscription.DatabaseName%2A>に指定します。</span><span class="sxs-lookup"><span data-stu-id="9565a-203">Name of the subscription database for <xref:Microsoft.SqlServer.Replication.PullSubscription.DatabaseName%2A>.</span></span>  
  
    -   <span data-ttu-id="9565a-204">パブリッシャー名を <xref:Microsoft.SqlServer.Replication.PullSubscription.PublisherName%2A>に指定します。</span><span class="sxs-lookup"><span data-stu-id="9565a-204">Name of the Publisher for <xref:Microsoft.SqlServer.Replication.PullSubscription.PublisherName%2A>.</span></span>  
  
    -   <span data-ttu-id="9565a-205">パブリケーション データベース名を <xref:Microsoft.SqlServer.Replication.PullSubscription.PublicationDBName%2A>に指定します。</span><span class="sxs-lookup"><span data-stu-id="9565a-205">Name of the publication database for <xref:Microsoft.SqlServer.Replication.PullSubscription.PublicationDBName%2A>.</span></span>  
  
    -   <span data-ttu-id="9565a-206">パブリケーション名を <xref:Microsoft.SqlServer.Replication.PullSubscription.PublicationName%2A>に指定します。</span><span class="sxs-lookup"><span data-stu-id="9565a-206">Name of the publication for <xref:Microsoft.SqlServer.Replication.PullSubscription.PublicationName%2A>.</span></span>  
  
    -   <span data-ttu-id="9565a-207">サブスクライバーで実行されるディストリビューション エージェントが使用するための [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows アカウントの資格情報を <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> の <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> フィールドおよび <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.SecurePassword%2A> (または <xref:Microsoft.SqlServer.Replication.PullSubscription.SynchronizationAgentProcessSecurity%2A>) フィールドに指定します。</span><span class="sxs-lookup"><span data-stu-id="9565a-207">The <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> and <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> or <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.SecurePassword%2A> fields of <xref:Microsoft.SqlServer.Replication.PullSubscription.SynchronizationAgentProcessSecurity%2A> to provide the credentials for the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows account under which the Distribution Agent runs at the Subscriber.</span></span> <span data-ttu-id="9565a-208">このアカウントは、サブスクライバーとのローカル接続を確立したり、Windows 認証を使用したリモート接続を確立するときに使用されます。</span><span class="sxs-lookup"><span data-stu-id="9565a-208">This account is used to make local connections to the Subscriber and to make remote connections using Windows Authentication.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="9565a-209">サブスクリプションが `sysadmin` 固定サーバー ロールのメンバーにより作成される場合、<xref:Microsoft.SqlServer.Replication.PullSubscription.SynchronizationAgentProcessSecurity%2A> の設定は必須ではありませんが、推奨されます。</span><span class="sxs-lookup"><span data-stu-id="9565a-209">Setting <xref:Microsoft.SqlServer.Replication.PullSubscription.SynchronizationAgentProcessSecurity%2A> is not required when the subscription is created by a member of the `sysadmin` fixed server role, however it is recommended.</span></span> <span data-ttu-id="9565a-210">この場合、エージェントは SQL Server エージェントのアカウントを借用します。</span><span class="sxs-lookup"><span data-stu-id="9565a-210">In this case, the agent will impersonate the SQL Server Agent account.</span></span> <span data-ttu-id="9565a-211">詳細については、「 [レプリケーション エージェント セキュリティ モデル](security/replication-agent-security-model.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9565a-211">For more information, see [Replication Agent Security Model](security/replication-agent-security-model.md).</span></span>  
  
    -   <span data-ttu-id="9565a-212">(省略可) サブスクリプションを同期するためのエージェント ジョブを作成する場合は、<xref:Microsoft.SqlServer.Replication.PullSubscription.CreateSyncAgentByDefault%2A> の値に `true` を指定します。</span><span class="sxs-lookup"><span data-stu-id="9565a-212">(Optional) A value of `true` for <xref:Microsoft.SqlServer.Replication.PullSubscription.CreateSyncAgentByDefault%2A> to create an agent job that is used to synchronize the subscription.</span></span> <span data-ttu-id="9565a-213">`false` (既定値) を指定した場合、サブスクリプションはプログラムによってのみ同期できます。また、このオブジェクトに <xref:Microsoft.SqlServer.Replication.TransSynchronizationAgent> プロパティからアクセスする場合は、<xref:Microsoft.SqlServer.Replication.TransPullSubscription.SynchronizationAgent%2A> のプロパティを別途指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="9565a-213">If you specify `false` (the default), the subscription can only be synchronized programmatically and you must specify additional properties of <xref:Microsoft.SqlServer.Replication.TransSynchronizationAgent> when you access this object from the <xref:Microsoft.SqlServer.Replication.TransPullSubscription.SynchronizationAgent%2A> property.</span></span> <span data-ttu-id="9565a-214">詳細については、「 [Synchronize a Pull Subscription](synchronize-a-pull-subscription.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="9565a-214">For more information, see [Synchronize a Pull Subscription](synchronize-a-pull-subscription.md).</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="9565a-215">SQL Server エージェントは、 [!INCLUDE[msCoName](../../includes/msconame-md.md)][!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9565a-215">SQL Server Agent is not available in every edition of [!INCLUDE[msCoName](../../includes/msconame-md.md)][!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="9565a-216">の各エディションでサポートされる機能の一覧につい [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ては、「 [SQL Server 2014 の各エディションがサポートする機能](../../getting-started/features-supported-by-the-editions-of-sql-server-2014.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9565a-216">For a list of features that are supported by the editions of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], see [Features Supported by the Editions of SQL Server 2014](../../getting-started/features-supported-by-the-editions-of-sql-server-2014.md).</span></span> <span data-ttu-id="9565a-217">Express のサブスクライバーに対して値 `true` を指定しても、エージェント ジョブは作成されません。</span><span class="sxs-lookup"><span data-stu-id="9565a-217">When you specify a value of `true` for Express Subscribers, the agent job is not created.</span></span> <span data-ttu-id="9565a-218">ただし、サブスクリプション関連の重要なメタデータについてはサブスクライバーに保存されます。</span><span class="sxs-lookup"><span data-stu-id="9565a-218">However, important subscription-related metadata is stored at the Subscriber.</span></span>  
  
    -   <span data-ttu-id="9565a-219">(省略可) SQL Server 認証を使ってディストリビューターに接続する場合は、 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> の <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> フィールドおよび <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> (または <xref:Microsoft.SqlServer.Replication.PullSubscription.DistributorSecurity%2A> ) フィールドを設定します。</span><span class="sxs-lookup"><span data-stu-id="9565a-219">(Optional) Set the <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> and <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> or <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> fields of <xref:Microsoft.SqlServer.Replication.PullSubscription.DistributorSecurity%2A> when using SQL Server Authentication to connect to the Distributor.</span></span>  
  
8.  <span data-ttu-id="9565a-220"><xref:Microsoft.SqlServer.Replication.PullSubscription.Create%2A> メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="9565a-220">Call the <xref:Microsoft.SqlServer.Replication.PullSubscription.Create%2A> method.</span></span>  
  
9. <span data-ttu-id="9565a-221">手順 2. で作成した <xref:Microsoft.SqlServer.Replication.TransPublication> クラスのインスタンスを使用して、 <xref:Microsoft.SqlServer.Replication.TransPublication.MakePullSubscriptionWellKnown%2A> メソッドを呼び出し、パブリッシャーにプル サブスクリプションを登録します。</span><span class="sxs-lookup"><span data-stu-id="9565a-221">Using the instance of the <xref:Microsoft.SqlServer.Replication.TransPublication> class from step 2, call the <xref:Microsoft.SqlServer.Replication.TransPublication.MakePullSubscriptionWellKnown%2A> method to register the pull subscription with the Publisher.</span></span> <span data-ttu-id="9565a-222">既に登録されている場合は、例外が発生します。</span><span class="sxs-lookup"><span data-stu-id="9565a-222">If this registration already exists, an exception occurs.</span></span>  
  
#### <a name="to-create-a-pull-subscription-to-a-merge-publication"></a><span data-ttu-id="9565a-223">マージ パブリケーションに対するプル サブスクリプションを作成するには</span><span class="sxs-lookup"><span data-stu-id="9565a-223">To create a pull subscription to a merge publication</span></span>  
  
1.  <span data-ttu-id="9565a-224"><xref:Microsoft.SqlServer.Management.Common.ServerConnection> クラスを使用して、サブスクライバーとパブリッシャーの両方に対する接続を作成します。</span><span class="sxs-lookup"><span data-stu-id="9565a-224">Create connections to both the Subscriber and Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="9565a-225">手順 1. のパブリッシャー接続を使用して、 <xref:Microsoft.SqlServer.Replication.MergePublication> クラスのインスタンスを作成します。</span><span class="sxs-lookup"><span data-stu-id="9565a-225">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class by using the Publisher connection from step 1.</span></span> <span data-ttu-id="9565a-226"><xref:Microsoft.SqlServer.Replication.Publication.Name%2A>、 <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>、および <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>を指定します。</span><span class="sxs-lookup"><span data-stu-id="9565a-226">Specify <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>, <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>, and <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span></span>  
  
3.  <span data-ttu-id="9565a-227"><xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="9565a-227">Call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method.</span></span> <span data-ttu-id="9565a-228">このメソッドが `false` を返す場合、手順 2. で指定したプロパティが誤っているか、サーバーにパブリケーションが存在していません。</span><span class="sxs-lookup"><span data-stu-id="9565a-228">If this method returns `false`, either the properties specified in step 2 are incorrect or the publication does not exist on the server.</span></span>  
  
4.  <span data-ttu-id="9565a-229"><xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> プロパティと <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPull> のビットごとの論理積演算 (Visual C# では `&`、Visual Basic では `And`) を実行します。</span><span class="sxs-lookup"><span data-stu-id="9565a-229">Perform a bitwise logical AND (`&` in Visual C# and `And` in Visual Basic) between the <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> property and <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPull>.</span></span> <span data-ttu-id="9565a-230">結果が <xref:Microsoft.SqlServer.Replication.PublicationAttributes.None> の場合、<xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> と <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> のビットごとの論理和演算 (Visual C# では `|`、Visual Basic では `Or`) の結果を <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPull> に設定します。</span><span class="sxs-lookup"><span data-stu-id="9565a-230">If the result is <xref:Microsoft.SqlServer.Replication.PublicationAttributes.None>, set <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> to the result of a bitwise logical OR (`|` in Visual C# and `Or` in Visual Basic) between <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> and <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPull>.</span></span> <span data-ttu-id="9565a-231">続けて、 <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A> を呼び出して、プル サブスクリプションを有効にします。</span><span class="sxs-lookup"><span data-stu-id="9565a-231">Then, call <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A> to enable pull subscriptions.</span></span>  
  
5.  <span data-ttu-id="9565a-232">サブスクリプション データベースが存在しない場合は、 <xref:Microsoft.SqlServer.Management.Smo.Database> クラスを使用して作成します。</span><span class="sxs-lookup"><span data-stu-id="9565a-232">If the subscription database does not exist, create it by using the <xref:Microsoft.SqlServer.Management.Smo.Database> class.</span></span> <span data-ttu-id="9565a-233">詳細については、「[データベースの作成、変更、および削除](../server-management-objects-smo/tasks/creating-altering-and-removing-databases.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9565a-233">For more information, see [Creating, Altering, and Removing Databases](../server-management-objects-smo/tasks/creating-altering-and-removing-databases.md).</span></span>  
  
6.  <span data-ttu-id="9565a-234"><xref:Microsoft.SqlServer.Replication.MergePullSubscription> クラスのインスタンスを作成します。</span><span class="sxs-lookup"><span data-stu-id="9565a-234">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergePullSubscription> class.</span></span>  
  
7.  <span data-ttu-id="9565a-235">次のサブスクリプション プロパティを設定します。</span><span class="sxs-lookup"><span data-stu-id="9565a-235">Set the following subscription properties:</span></span>  
  
    -   <span data-ttu-id="9565a-236">手順 1. で作成した、サブスクライバーに対する <xref:Microsoft.SqlServer.Management.Common.ServerConnection> を <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>に指定します。</span><span class="sxs-lookup"><span data-stu-id="9565a-236">The <xref:Microsoft.SqlServer.Management.Common.ServerConnection> to the Subscriber created in step 1 for <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span></span>  
  
    -   <span data-ttu-id="9565a-237">サブスクリプション データベース名を <xref:Microsoft.SqlServer.Replication.PullSubscription.DatabaseName%2A>に指定します。</span><span class="sxs-lookup"><span data-stu-id="9565a-237">Name of the subscription database for <xref:Microsoft.SqlServer.Replication.PullSubscription.DatabaseName%2A>.</span></span>  
  
    -   <span data-ttu-id="9565a-238">パブリッシャー名を <xref:Microsoft.SqlServer.Replication.PullSubscription.PublisherName%2A>に指定します。</span><span class="sxs-lookup"><span data-stu-id="9565a-238">Name of the Publisher for <xref:Microsoft.SqlServer.Replication.PullSubscription.PublisherName%2A>.</span></span>  
  
    -   <span data-ttu-id="9565a-239">パブリケーション データベース名を <xref:Microsoft.SqlServer.Replication.PullSubscription.PublicationDBName%2A>に指定します。</span><span class="sxs-lookup"><span data-stu-id="9565a-239">Name of the publication database for <xref:Microsoft.SqlServer.Replication.PullSubscription.PublicationDBName%2A>.</span></span>  
  
    -   <span data-ttu-id="9565a-240">パブリケーション名を <xref:Microsoft.SqlServer.Replication.PullSubscription.PublicationName%2A>に指定します。</span><span class="sxs-lookup"><span data-stu-id="9565a-240">Name of the publication for <xref:Microsoft.SqlServer.Replication.PullSubscription.PublicationName%2A>.</span></span>  
  
    -   <span data-ttu-id="9565a-241">サブスクライバーで実行されるマージ エージェントが使用するための [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows アカウントの資格情報を <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> の <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> フィールドおよび <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.SecurePassword%2A> (または <xref:Microsoft.SqlServer.Replication.PullSubscription.SynchronizationAgentProcessSecurity%2A>) フィールドに指定します。</span><span class="sxs-lookup"><span data-stu-id="9565a-241">The <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> and <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> or <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.SecurePassword%2A> fields of <xref:Microsoft.SqlServer.Replication.PullSubscription.SynchronizationAgentProcessSecurity%2A> to provide the credentials for the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows account under which the Merge Agent runs at the Subscriber.</span></span> <span data-ttu-id="9565a-242">このアカウントは、サブスクライバーとのローカル接続を確立したり、Windows 認証を使用したリモート接続を確立するときに使用されます。</span><span class="sxs-lookup"><span data-stu-id="9565a-242">This account is used to make local connections to the Subscriber and to make remote connections using Windows Authentication.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="9565a-243">サブスクリプションが `sysadmin` 固定サーバー ロールのメンバーにより作成される場合、<xref:Microsoft.SqlServer.Replication.PullSubscription.SynchronizationAgentProcessSecurity%2A> の設定は必須ではありませんが、推奨されます。</span><span class="sxs-lookup"><span data-stu-id="9565a-243">Setting <xref:Microsoft.SqlServer.Replication.PullSubscription.SynchronizationAgentProcessSecurity%2A> is not required when the subscription is created by a member of the `sysadmin` fixed server role, however it is recommended.</span></span> <span data-ttu-id="9565a-244">この場合、エージェントは SQL Server エージェントのアカウントを借用します。</span><span class="sxs-lookup"><span data-stu-id="9565a-244">In this case, the agent will impersonate the SQL Server Agent account.</span></span> <span data-ttu-id="9565a-245">詳細については、「 [レプリケーション エージェント セキュリティ モデル](security/replication-agent-security-model.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9565a-245">For more information, see [Replication Agent Security Model](security/replication-agent-security-model.md).</span></span>  
  
    -   <span data-ttu-id="9565a-246">(省略可) サブスクリプションを同期するためのエージェント ジョブを作成する場合は、<xref:Microsoft.SqlServer.Replication.PullSubscription.CreateSyncAgentByDefault%2A> の値に `true` を指定します。</span><span class="sxs-lookup"><span data-stu-id="9565a-246">(Optional) A value of `true` for <xref:Microsoft.SqlServer.Replication.PullSubscription.CreateSyncAgentByDefault%2A> to create an agent job that is used to synchronize the subscription.</span></span> <span data-ttu-id="9565a-247">`false` (既定値) を指定した場合、サブスクリプションはプログラムによってのみ同期できます。また、このオブジェクトに <xref:Microsoft.SqlServer.Replication.MergeSynchronizationAgent> プロパティからアクセスする場合は、<xref:Microsoft.SqlServer.Replication.MergePullSubscription.SynchronizationAgent%2A> のプロパティを別途指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="9565a-247">If you specify `false` (the default), the subscription can only be synchronized programmatically and you must specify additional properties of <xref:Microsoft.SqlServer.Replication.MergeSynchronizationAgent> when you access this object from the <xref:Microsoft.SqlServer.Replication.MergePullSubscription.SynchronizationAgent%2A> property.</span></span> <span data-ttu-id="9565a-248">詳細については、「 [Synchronize a Pull Subscription](synchronize-a-pull-subscription.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="9565a-248">For more information, see [Synchronize a Pull Subscription](synchronize-a-pull-subscription.md).</span></span>  
  
    -   <span data-ttu-id="9565a-249">(省略可) SQL Server 認証を使ってディストリビューターに接続する場合は、 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> の <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> フィールドおよび <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> (または <xref:Microsoft.SqlServer.Replication.PullSubscription.DistributorSecurity%2A> ) フィールドを設定します。</span><span class="sxs-lookup"><span data-stu-id="9565a-249">(Optional) Set the <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> and <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> or <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> fields of <xref:Microsoft.SqlServer.Replication.PullSubscription.DistributorSecurity%2A> when using SQL Server Authentication to connect to the Distributor.</span></span>  
  
    -   <span data-ttu-id="9565a-250">(省略可) SQL Server 認証を使用してパブリッシャーに接続する場合、 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> の <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> フィールドおよび <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> (または <xref:Microsoft.SqlServer.Replication.PullSubscription.PublisherSecurity%2A> ) フィールドを設定します。</span><span class="sxs-lookup"><span data-stu-id="9565a-250">(Optional) Set the <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> and <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> or <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> fields of <xref:Microsoft.SqlServer.Replication.PullSubscription.PublisherSecurity%2A> when using SQL Server Authentication to connect to the Publisher.</span></span>  
  
8.  <span data-ttu-id="9565a-251"><xref:Microsoft.SqlServer.Replication.PullSubscription.Create%2A> メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="9565a-251">Call the <xref:Microsoft.SqlServer.Replication.PullSubscription.Create%2A> method.</span></span>  
  
9. <span data-ttu-id="9565a-252">手順 2. で作成した <xref:Microsoft.SqlServer.Replication.MergePublication> クラスのインスタンスを使用して、 <xref:Microsoft.SqlServer.Replication.MergePublication.MakePullSubscriptionWellKnown%2A> メソッドを呼び出し、パブリッシャーにプル サブスクリプションを登録します。</span><span class="sxs-lookup"><span data-stu-id="9565a-252">Using the instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class from step 2, call the <xref:Microsoft.SqlServer.Replication.MergePublication.MakePullSubscriptionWellKnown%2A> method to register the pull subscription with the Publisher.</span></span> <span data-ttu-id="9565a-253">既に登録されている場合は、例外が発生します。</span><span class="sxs-lookup"><span data-stu-id="9565a-253">If this registration already exists, an exception occurs.</span></span>  
  
###  <a name="example-rmo"></a><a name="PShellExample"></a> <span data-ttu-id="9565a-254">例 (RMO)</span><span class="sxs-lookup"><span data-stu-id="9565a-254">Example (RMO)</span></span>  
 <span data-ttu-id="9565a-255">次の例では、トランザクション パブリケーションに対するプル サブスクリプションを作成します。</span><span class="sxs-lookup"><span data-stu-id="9565a-255">This example creates a pull subscription to a transactional publication.</span></span> <span data-ttu-id="9565a-256">ディストリビューション エージェント ジョブを作成するために使用する [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows アカウントの資格情報は実行時に渡されます。</span><span class="sxs-lookup"><span data-stu-id="9565a-256">The [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows account credentials used to create the Distribution Agent job are passed at runtime.</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateTranPullSub](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createtranpullsub)]  
  
 [!code-vb[HowTo#rmo_vb_CreateTranPullSub](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createtranpullsub)]  
  
 <span data-ttu-id="9565a-257">次の例では、マージ パブリケーションに対するプル サブスクリプションを作成します。</span><span class="sxs-lookup"><span data-stu-id="9565a-257">This example creates a pull subscription to a merge publication.</span></span> <span data-ttu-id="9565a-258">マージ エージェント ジョブを作成するために使用する Windows アカウントの資格情報は実行時に渡されます。</span><span class="sxs-lookup"><span data-stu-id="9565a-258">The Windows account credentials used to create the Merge Agent job are passed at runtime.</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateMergePullSub](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createmergepullsub)]  
  
 [!code-vb[HowTo#rmo_vb_CreateMergePullSub](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createmergepullsub)]  
  
 <span data-ttu-id="9565a-259">次の例では、関連するエージェント ジョブやサブスクリプション メタデータを [MSsubscription_properties](/sql/relational-databases/system-tables/mssubscription-properties-transact-sql)に作成せずに、マージ パブリケーションに対するプル サブスクリプションを作成しています。</span><span class="sxs-lookup"><span data-stu-id="9565a-259">This example creates a pull subscription to a merge publication without creating an associated agent job and subscription metadata in [MSsubscription_properties](/sql/relational-databases/system-tables/mssubscription-properties-transact-sql).</span></span> <span data-ttu-id="9565a-260">マージ エージェント ジョブを作成するために使用する Windows アカウントの資格情報は実行時に渡されます。</span><span class="sxs-lookup"><span data-stu-id="9565a-260">The Windows account credentials used to create the Merge Agent job are passed at runtime.</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateMergePullSub_NoJob](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createmergepullsub_nojob)]  
  
 [!code-vb[HowTo#rmo_vb_CreateMergePullSub_NoJob](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createmergepullsub_nojob)]  
  
 <span data-ttu-id="9565a-261">次の例では、Web 同期によるインターネットを介した同期が可能な、マージ パブリケーションに対するプル サブスクリプションを作成しています。</span><span class="sxs-lookup"><span data-stu-id="9565a-261">This example creates a pull subscription to a merge publication that can be synchronized over the Internet using Web synchronization.</span></span> <span data-ttu-id="9565a-262">マージ エージェント ジョブを作成するために使用する Windows アカウントの資格情報は実行時に渡されます。</span><span class="sxs-lookup"><span data-stu-id="9565a-262">The Windows account credentials used to create the Merge Agent job are passed at runtime.</span></span> <span data-ttu-id="9565a-263">詳しくは、「 [Configure Web Synchronization](configure-web-synchronization.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="9565a-263">For more information, see [Configure Web Synchronization](configure-web-synchronization.md).</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateMergePullSub_WebSync](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createmergepullsub_websync)]  
  
 [!code-vb[HowTo#rmo_vb_CreateMergePullSub_WebSync](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createmergepullsub_websync)]  
  
## <a name="see-also"></a><span data-ttu-id="9565a-264">参照</span><span class="sxs-lookup"><span data-stu-id="9565a-264">See Also</span></span>  
 <span data-ttu-id="9565a-265">[Replication Management Objects Concepts](concepts/replication-management-objects-concepts.md) </span><span class="sxs-lookup"><span data-stu-id="9565a-265">[Replication Management Objects Concepts](concepts/replication-management-objects-concepts.md) </span></span>  
 <span data-ttu-id="9565a-266">[プル サブスクリプションのプロパティの表示または変更](view-and-modify-pull-subscription-properties.md) </span><span class="sxs-lookup"><span data-stu-id="9565a-266">[View and Modify Pull Subscription Properties](view-and-modify-pull-subscription-properties.md) </span></span>  
 <span data-ttu-id="9565a-267">[Configure Web Synchronization](configure-web-synchronization.md) </span><span class="sxs-lookup"><span data-stu-id="9565a-267">[Configure Web Synchronization](configure-web-synchronization.md) </span></span>  
 <span data-ttu-id="9565a-268">[Subscribe to Publications](subscribe-to-publications.md) </span><span class="sxs-lookup"><span data-stu-id="9565a-268">[Subscribe to Publications](subscribe-to-publications.md) </span></span>  
 [<span data-ttu-id="9565a-269">レプリケーション セキュリティの推奨事項</span><span class="sxs-lookup"><span data-stu-id="9565a-269">Replication Security Best Practices</span></span>](security/replication-security-best-practices.md)  
  
  
