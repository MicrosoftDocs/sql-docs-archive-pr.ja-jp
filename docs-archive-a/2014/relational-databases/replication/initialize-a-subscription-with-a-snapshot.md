---
title: スナップショットを使用したサブスクリプションの初期化 | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- snapshots [SQL Server replication], initializing subscriptions
- initializing subscriptions [SQL Server replication], snapshots
ms.assetid: 77a9ade2-cdc0-4ae9-a02d-6e29d7c2ada0
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: f8b776e71e9d1197bc174169aee8ccf692884308
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87632340"
---
# <a name="initialize-a-subscription-with-a-snapshot"></a><span data-ttu-id="99af5-102">スナップショットを使用したサブスクリプションの初期化</span><span class="sxs-lookup"><span data-stu-id="99af5-102">Initialize a Subscription with a Snapshot</span></span>
  <span data-ttu-id="99af5-103">パブリケーションを作成すると、通常は初期スナップショットが作成され、スナップショット フォルダーにコピーされます (この動作は、パブリケーションの新規作成ウィザードを使用して作成されたマージ パブリケーションに対して既定で実行されます)。</span><span class="sxs-lookup"><span data-stu-id="99af5-103">After a publication has been created, an initial snapshot is typically created and copied to the snapshot folder (this occurs by default for merge publications created with the New Publication Wizard).</span></span> <span data-ttu-id="99af5-104">その後スナップショットは、サブスクリプションの最初の同期時に、ディストリビューション エージェント (トランザクション パブリケーションおよびスナップショット パブリケーションの場合) またはマージ エージェント (マージ パブリケーションの場合) によってサブスクライバーに適用されます。</span><span class="sxs-lookup"><span data-stu-id="99af5-104">It is then applied to the Subscriber by the Distribution Agent (for transactional and snapshot publications) or the Merge Agent (for merge publications) during the initial synchronization of the subscription.</span></span> <span data-ttu-id="99af5-105">スナップショット処理は、パブリケーションの種類によって変わります。</span><span class="sxs-lookup"><span data-stu-id="99af5-105">The snapshot process depends on the type of publication:</span></span>  
  
-   <span data-ttu-id="99af5-106">パラメーター化されたフィルターを使用しないスナップショット パブリケーション、トランザクション パブリケーション、またはマージ パブリケーションに対するスナップショットの場合、スナップショットにはスキーマとデータが含まれ、一括コピー プログラム (bcp) ファイルとして作成されます。また、レプリケーションで必要な制約、拡張プロパティ、インデックス、トリガー、およびシステム テーブルも含まれます。</span><span class="sxs-lookup"><span data-stu-id="99af5-106">If the snapshot is for a snapshot publication, a transactional publication, or a merge publication that doesn't use parameterized filters, the snapshot contains the schema and data in bulk copy program (bcp) files, as well as constraints, extended properties, indexes, triggers, and the system tables necessary for replication.</span></span> <span data-ttu-id="99af5-107">スナップショットの作成と適用の詳細については、「[Create and Apply the Snapshot](create-and-apply-the-snapshot.md)」(スナップショットの作成と適用) を参照してください。</span><span class="sxs-lookup"><span data-stu-id="99af5-107">For more information about creating and applying the snapshot, see [Create and Apply the Snapshot](create-and-apply-the-snapshot.md).</span></span>  
  
-   <span data-ttu-id="99af5-108">パラメーター化されたフィルターを使用するマージ パブリケーションに対するスナップショットの場合は、2 段階の処理でスナップショットが作成されます。</span><span class="sxs-lookup"><span data-stu-id="99af5-108">If the snapshot is for a merge publication that uses parameterized filters, the snapshot is created using a two-part process.</span></span> <span data-ttu-id="99af5-109">まず、パブリッシュされたオブジェクトのレプリケーション スクリプトとスキーマが含まれるスキーマ スナップショットが作成されます。ただしデータは含まれません。</span><span class="sxs-lookup"><span data-stu-id="99af5-109">First a schema snapshot is created that contains the replication scripts and the schema of the published objects, but not the data.</span></span> <span data-ttu-id="99af5-110">次に、スキーマ スナップショットからコピーしたスクリプトとスキーマが含まれるスナップショットと、サブスクリプションのパーティションに属するデータを使用して、各サブスクリプションが初期化されます。</span><span class="sxs-lookup"><span data-stu-id="99af5-110">Each subscription is then initialized with a snapshot that includes the scripts and schema copied from the schema snapshot and the data that belongs to the subscription's partition.</span></span> <span data-ttu-id="99af5-111">詳しくは、「 [Snapshots for Merge Publications with Parameterized Filters](snapshots-for-merge-publications-with-parameterized-filters.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="99af5-111">For more information, see [Snapshots for Merge Publications with Parameterized Filters](snapshots-for-merge-publications-with-parameterized-filters.md).</span></span>  
  
 <span data-ttu-id="99af5-112">スナップショットは、レプリケーションの種類やパブリケーションのアーティクルに応じて異なるファイルで構成されます。</span><span class="sxs-lookup"><span data-stu-id="99af5-112">The snapshot consists of different files depending on the type of replication and the articles in your publication.</span></span> <span data-ttu-id="99af5-113">これらのファイルは、ディストリビューターの構成時に指定した既定のスナップショット フォルダーか、パブリケーションを作成する際に指定した代替スナップショット フォルダーにコピーされます。</span><span class="sxs-lookup"><span data-stu-id="99af5-113">These files are copied to the default snapshot folder specified when the Distributor was configured or the alternate snapshot folder specified when the publication was created.</span></span>  
  
|<span data-ttu-id="99af5-114">レプリケーションの種類</span><span class="sxs-lookup"><span data-stu-id="99af5-114">Type of Replication</span></span>|<span data-ttu-id="99af5-115">通常のスナップショット ファイル</span><span class="sxs-lookup"><span data-stu-id="99af5-115">Common Snapshot Files</span></span>|  
|-------------------------|---------------------------|  
|<span data-ttu-id="99af5-116">スナップショット レプリケーションまたはトランザクション レプリケーション</span><span class="sxs-lookup"><span data-stu-id="99af5-116">Snapshot Replication or Transactional Replication</span></span>|<span data-ttu-id="99af5-117">スキーマ (.sch)、データ (.bcp)、制約とインデックス (.dri)、制約 (.idx)、トリガー (.trg) (サブスクライバーの更新専用)、圧縮スナップショットファイル (.cab)</span><span class="sxs-lookup"><span data-stu-id="99af5-117">schema (.sch); data (.bcp); constraints and indexes (.dri); constraints (.idx); triggers (.trg):for updating Subscribers only; compressed snapshot files (.cab).</span></span>|  
|<span data-ttu-id="99af5-118">マージ レプリケーション</span><span class="sxs-lookup"><span data-stu-id="99af5-118">Merge Replication</span></span>|<span data-ttu-id="99af5-119">スキーマ (.sch)、データ (.bcp)、制約とインデックス (.dri)、トリガー (.trg)、システム テーブル データ (.sys)、競合テーブル (.cft)、圧縮スナップショットファイル (.cab)</span><span class="sxs-lookup"><span data-stu-id="99af5-119">schema (.sch); data (.bcp); constraints and indexes (.dri); triggers (.trg); system table data (.sys); conflict tables (.cft); compressed snapshot files (.cab).</span></span>|  
  
 <span data-ttu-id="99af5-120">ある時点でスナップショットの転送が中断された場合、転送は自動的に再開され、既に転送が完了したファイルは再送されません。</span><span class="sxs-lookup"><span data-stu-id="99af5-120">If the snapshot transfer is interrupted at any point, it will automatically resume and will not resend any files that have already been completely transferred.</span></span> <span data-ttu-id="99af5-121">スナップショット エージェントの配信単位は、各パブリケーション アーティクルに対する bcp ファイルであるため、部分的に配信されたファイルは再度全体を配信する必要があります。</span><span class="sxs-lookup"><span data-stu-id="99af5-121">The unit of delivery for the Snapshot Agent is the bcp file for each publication article, so files that are partially delivered must be completely redelivered.</span></span> <span data-ttu-id="99af5-122">しかし、スナップショットの再開機能を使うことで、転送されるデータ量が大幅に削減され、接続が不安定な場合でもタイムリーにスナップショットを配信できます。</span><span class="sxs-lookup"><span data-stu-id="99af5-122">However, resuming the snapshot can significantly reduce the amount of data transmitted and ensure timely snapshot delivery even if the connection is unreliable.</span></span>  
  
## <a name="snapshot-options"></a><span data-ttu-id="99af5-123">スナップショット オプション</span><span class="sxs-lookup"><span data-stu-id="99af5-123">Snapshot Options</span></span>  
 <span data-ttu-id="99af5-124">スナップショットを使用してサブスクリプションを初期化する際には、いくつかのオプションがあります。</span><span class="sxs-lookup"><span data-stu-id="99af5-124">There are a number of options available when initializing a subscription with a snapshot.</span></span> <span data-ttu-id="99af5-125">次のようにすることができます。</span><span class="sxs-lookup"><span data-stu-id="99af5-125">You can:</span></span>  
  
-   <span data-ttu-id="99af5-126">既定のスナップショット フォルダーを代替または追加する場所として、代替スナップショット フォルダーの場所を指定できます。</span><span class="sxs-lookup"><span data-stu-id="99af5-126">Specify an alternate snapshot folder location instead of, or in addition, to the default snapshot folder location.</span></span> <span data-ttu-id="99af5-127">詳細については、「 [Alternate Snapshot Folder Locations](alternate-snapshot-folder-locations.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="99af5-127">For more information, see [Alternate Snapshot Folder Locations](alternate-snapshot-folder-locations.md).</span></span>  
  
-   <span data-ttu-id="99af5-128">リムーバブル メディア上に格納するためや低速なネットワーク上で転送するための圧縮スナップショットを使用できます。</span><span class="sxs-lookup"><span data-stu-id="99af5-128">Compress snapshots for storage on removable media or for transfer over a slow network.</span></span> <span data-ttu-id="99af5-129">詳細については、「 [Compressed Snapshots](compressed-snapshots.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="99af5-129">For more information, see [Compressed Snapshots](compressed-snapshots.md).</span></span>  
  
-   <span data-ttu-id="99af5-130">スナップショットを適用する前または後に Transact-SQL スクリプトを実行できます。</span><span class="sxs-lookup"><span data-stu-id="99af5-130">Execute Transact-SQL scripts before or after the snapshot is applied.</span></span> <span data-ttu-id="99af5-131">詳細については、「[スナップショットが適用される前および後のスクリプトの実行](snapshot-options.md#execute-scripts-before-and-after-snapshot-is-applied)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="99af5-131">For more information, see [Execute Scripts Before and After the Snapshot Is Applied](snapshot-options.md#execute-scripts-before-and-after-snapshot-is-applied).</span></span>  
  
-   <span data-ttu-id="99af5-132">ファイル転送プロトコル (FTP) を使用してスナップショット ファイルを転送できます。</span><span class="sxs-lookup"><span data-stu-id="99af5-132">Transfer snapshot files using File Transfer Protocol (FTP).</span></span> <span data-ttu-id="99af5-133">詳細については、「[FTP によるスナップショットの転送](transfer-snapshots-through-ftp.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="99af5-133">For more information, see [Transfer Snapshots Through FTP](transfer-snapshots-through-ftp.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="99af5-134">参照</span><span class="sxs-lookup"><span data-stu-id="99af5-134">See Also</span></span>  
 <span data-ttu-id="99af5-135">[サブスクリプションの初期化](initialize-a-subscription.md) </span><span class="sxs-lookup"><span data-stu-id="99af5-135">[Initialize a Subscription](initialize-a-subscription.md) </span></span>  
 [<span data-ttu-id="99af5-136">スナップショット フォルダーのセキュリティ保護</span><span class="sxs-lookup"><span data-stu-id="99af5-136">Secure the Snapshot Folder</span></span>](security/secure-the-snapshot-folder.md)  
  
  
