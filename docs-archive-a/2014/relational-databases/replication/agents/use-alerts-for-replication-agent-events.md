---
title: レプリケーション エージェント イベントに対する警告の使用 | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- viewing alerts
- Queue Reader Agent, alerts
- alerts [SQL Server replication]
- predefined replication alerts [SQL Server replication]
- Log Reader Agent, alerts
- Distribution Agent, alerts
- Merge Agent, alerts
- agents [SQL Server replication], alerts
- displaying alerts
- Snapshot Agent, alerts
ms.assetid: 8c42e523-7020-471d-8977-a0bd044b9471
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 9d3e30c0a8768a872dc86745ef986faec509c3c6
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87632404"
---
# <a name="use-alerts-for-replication-agent-events"></a><span data-ttu-id="116f4-102">レプリケーション エージェント イベントに対する警告の使用</span><span class="sxs-lookup"><span data-stu-id="116f4-102">Use Alerts for Replication Agent Events</span></span>
  [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] <span data-ttu-id="116f4-103">および [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] エージェントでは、レプリケーション エージェント イベントなどのイベントを、警告を使用して監視する方法が用意されています。</span><span class="sxs-lookup"><span data-stu-id="116f4-103">and [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Agent provide a way to monitor events, such as replication agent events, using alerts.</span></span> [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="116f4-104">エージェントでは、警告に関連するイベントに対し、Windows アプリケーション ログを監視します。</span><span class="sxs-lookup"><span data-stu-id="116f4-104">Agent monitors the Windows application log for events that are associated with alerts.</span></span> <span data-ttu-id="116f4-105">このようなイベントが発生すると、 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] エージェントは、定義されたタスクを実行したり、電子メールまたはポケットベルのメッセージを指定したオペレーターに送信することにより、自動的に応答します。</span><span class="sxs-lookup"><span data-stu-id="116f4-105">If such an event occurs, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Agent responds automatically, by executing a task that you have defined and/or sending e-mail or a pager message to a specified operator.</span></span> [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="116f4-106">には、タスクを実行したりオペレーターに通知するように設定できる、レプリケーション エージェントに対する一連の定義済みの警告が含まれます。</span><span class="sxs-lookup"><span data-stu-id="116f4-106">includes a set of predefined alerts for replication agents that you can configure to execute a task and/or notify an operator.</span></span> <span data-ttu-id="116f4-107">実行するタスクの定義の詳細については、このトピックの「警告への応答の自動化」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="116f4-107">For more information about defining a task to execute, see the section "Automating a Response to an Alert" in this topic.</span></span>  
  
 <span data-ttu-id="116f4-108">次の警告は、コンピューターをディストリビューターとして構成したときにインストールされます。</span><span class="sxs-lookup"><span data-stu-id="116f4-108">The following alerts are installed when a computer is configured as a Distributor:</span></span>  
  
|<span data-ttu-id="116f4-109">メッセージ ID</span><span class="sxs-lookup"><span data-stu-id="116f4-109">Message ID</span></span>|<span data-ttu-id="116f4-110">定義済みの警告</span><span class="sxs-lookup"><span data-stu-id="116f4-110">Predefined alert</span></span>|<span data-ttu-id="116f4-111">警告を表示する原因となった条件</span><span class="sxs-lookup"><span data-stu-id="116f4-111">Condition causing the alert to fire</span></span>|<span data-ttu-id="116f4-112">msdb..sysreplicationalerts への追加情報の入力</span><span class="sxs-lookup"><span data-stu-id="116f4-112">Enters additional information in msdb..sysreplicationalerts</span></span>|  
|----------------|----------------------|-----------------------------------------|-----------------------------------------------------------------|  
|<span data-ttu-id="116f4-113">14150</span><span class="sxs-lookup"><span data-stu-id="116f4-113">14150</span></span>|<span data-ttu-id="116f4-114">**レプリケーション: エージェントが成功しました**</span><span class="sxs-lookup"><span data-stu-id="116f4-114">**Replication: agent success**</span></span>|<span data-ttu-id="116f4-115">エージェントが正常にシャットダウンされました。</span><span class="sxs-lookup"><span data-stu-id="116f4-115">Agent shuts down successfully.</span></span>|<span data-ttu-id="116f4-116">はい</span><span class="sxs-lookup"><span data-stu-id="116f4-116">Yes</span></span>|  
|<span data-ttu-id="116f4-117">14151</span><span class="sxs-lookup"><span data-stu-id="116f4-117">14151</span></span>|<span data-ttu-id="116f4-118">**レプリケーション: エージェントが失敗しました**</span><span class="sxs-lookup"><span data-stu-id="116f4-118">**Replication: agent failure**</span></span>|<span data-ttu-id="116f4-119">エージェントがエラーでシャットダウンされました。</span><span class="sxs-lookup"><span data-stu-id="116f4-119">Agent shuts down with an error.</span></span>|<span data-ttu-id="116f4-120">はい</span><span class="sxs-lookup"><span data-stu-id="116f4-120">Yes</span></span>|  
|<span data-ttu-id="116f4-121">14152</span><span class="sxs-lookup"><span data-stu-id="116f4-121">14152</span></span>|<span data-ttu-id="116f4-122">**レプリケーション: エージェントを再試行します**</span><span class="sxs-lookup"><span data-stu-id="116f4-122">**Replication: agent retry**</span></span>|<span data-ttu-id="116f4-123">操作の再試行が成功せず、エージェントはシャットダウンされました (エージェントが、サーバーの利用不能、デッドロック、接続の失敗、タイムアウト障害などのエラーを検出しました)。</span><span class="sxs-lookup"><span data-stu-id="116f4-123">Agent shuts down after unsuccessfully retrying an operation (agent encounters an error such as server not available, deadlock, connection failure, or time-out failure).</span></span>|<span data-ttu-id="116f4-124">はい</span><span class="sxs-lookup"><span data-stu-id="116f4-124">Yes</span></span>|  
|<span data-ttu-id="116f4-125">14157</span><span class="sxs-lookup"><span data-stu-id="116f4-125">14157</span></span>|<span data-ttu-id="116f4-126">**レプリケーション: 有効期限の切れたサブスクリプションを削除しました**</span><span class="sxs-lookup"><span data-stu-id="116f4-126">**Replication: expired subscription dropped**</span></span>|<span data-ttu-id="116f4-127">有効期限の切れたサブスクリプションが削除されました。</span><span class="sxs-lookup"><span data-stu-id="116f4-127">Expired subscription was dropped.</span></span>|<span data-ttu-id="116f4-128">いいえ</span><span class="sxs-lookup"><span data-stu-id="116f4-128">No</span></span>|  
|<span data-ttu-id="116f4-129">20572</span><span class="sxs-lookup"><span data-stu-id="116f4-129">20572</span></span>|<span data-ttu-id="116f4-130">**レプリケーション: データ検証で問題が見つかった後、サブスクリプションが再初期化されました**</span><span class="sxs-lookup"><span data-stu-id="116f4-130">**Replication: Subscription reinitialized after validation failure**</span></span>|<span data-ttu-id="116f4-131">応答ジョブ "データ検証で問題が見つかったサブスクリプションの再初期化" でサブスクリプションが正常に再初期化されました。</span><span class="sxs-lookup"><span data-stu-id="116f4-131">Response job 'Reinitialize subscriptions on data validation failure' reinitializes a subscription successfully.</span></span>|<span data-ttu-id="116f4-132">いいえ</span><span class="sxs-lookup"><span data-stu-id="116f4-132">No</span></span>|  
|<span data-ttu-id="116f4-133">20574</span><span class="sxs-lookup"><span data-stu-id="116f4-133">20574</span></span>|<span data-ttu-id="116f4-134">**レプリケーション: サブスクライバーでデータ検証で問題が見つかりました**</span><span class="sxs-lookup"><span data-stu-id="116f4-134">**Replication: Subscriber has failed data validation**</span></span>|<span data-ttu-id="116f4-135">ディストリビューション エージェントまたはマージ エージェントはデータの検証で問題が見つかりました。</span><span class="sxs-lookup"><span data-stu-id="116f4-135">Distribution or Merge Agent fails data validation.</span></span>|<span data-ttu-id="116f4-136">はい</span><span class="sxs-lookup"><span data-stu-id="116f4-136">Yes</span></span>|  
|<span data-ttu-id="116f4-137">20575</span><span class="sxs-lookup"><span data-stu-id="116f4-137">20575</span></span>|<span data-ttu-id="116f4-138">**レプリケーション: サブスクライバーでデータ検証を正常に終了しました**</span><span class="sxs-lookup"><span data-stu-id="116f4-138">**Replication: Subscriber has passed data validation**</span></span>|<span data-ttu-id="116f4-139">ディストリビューション エージェントまたはマージ エージェントはデータの検証を正常に終了しました。</span><span class="sxs-lookup"><span data-stu-id="116f4-139">Distribution or Merge Agent passes data validation.</span></span>|<span data-ttu-id="116f4-140">はい</span><span class="sxs-lookup"><span data-stu-id="116f4-140">Yes</span></span>|  
|<span data-ttu-id="116f4-141">20578</span><span class="sxs-lookup"><span data-stu-id="116f4-141">20578</span></span>|<span data-ttu-id="116f4-142">**レプリケーション: エージェントのカスタム シャットダウン**</span><span class="sxs-lookup"><span data-stu-id="116f4-142">**Replication: agent custom shutdown**</span></span>|||  
|<span data-ttu-id="116f4-143">22815</span><span class="sxs-lookup"><span data-stu-id="116f4-143">22815</span></span>|<span data-ttu-id="116f4-144">**ピア ツー ピア競合検出の警告**</span><span class="sxs-lookup"><span data-stu-id="116f4-144">**Peer-to-peer conflict detection alert**</span></span>|<span data-ttu-id="116f4-145">ピア ツー ピア ノードで変更を適用しようとしたときにディストリビューション エージェントで競合が検出されました。</span><span class="sxs-lookup"><span data-stu-id="116f4-145">Distribution Agent detected a conflict when it tries to apply a change at a peer-to-peer node.</span></span>|<span data-ttu-id="116f4-146">はい</span><span class="sxs-lookup"><span data-stu-id="116f4-146">Yes</span></span>|  
  
 <span data-ttu-id="116f4-147">これらの警告に加え、レプリケーション モニターでは、ステータスおよびパフォーマンスに関連する一連の警告を使用できます。</span><span class="sxs-lookup"><span data-stu-id="116f4-147">In addition to these alerts, Replication Monitor provides a set of warnings and alerts related to status and performance.</span></span> <span data-ttu-id="116f4-148">詳細については、「[レプリケーションモニターの警告インフラストラクチャでのしきい値と警告の設定](../monitor/set-thresholds-and-warnings-in-replication-monitor.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="116f4-148">For more information, see [Set Thresholds and Warnings in Replication Monitor](../monitor/set-thresholds-and-warnings-in-replication-monitor.md) alerts infrastructure.</span></span> <span data-ttu-id="116f4-149">詳細については、「[ユーザー定義イベントの作成](../../../ssms/agent/create-a-user-defined-event.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="116f4-149">For more information, see [Create a User-Defined Event](../../../ssms/agent/create-a-user-defined-event.md).</span></span>  
  
 <span data-ttu-id="116f4-150">**定義済みのレプリケーションの警告を構成するには**</span><span class="sxs-lookup"><span data-stu-id="116f4-150">**To configure predefined replication alerts**</span></span>  
  
-   [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)]<span data-ttu-id="116f4-151">: [定義済みのレプリケーションの警告の構成 &#40;SQL Server Management Studio&#41;](../administration/configure-predefined-replication-alerts-sql-server-management-studio.md)</span><span class="sxs-lookup"><span data-stu-id="116f4-151">: [Configure Predefined Replication Alerts &#40;SQL Server Management Studio&#41;](../administration/configure-predefined-replication-alerts-sql-server-management-studio.md)</span></span>  
  
## <a name="viewing-the-application-log-directly"></a><span data-ttu-id="116f4-152">アプリケーション ログの直接表示</span><span class="sxs-lookup"><span data-stu-id="116f4-152">Viewing the Application Log Directly</span></span>  
 <span data-ttu-id="116f4-153">Windows アプリケーション ログを表示するには、 [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Windows イベント ビューアーを使用します。</span><span class="sxs-lookup"><span data-stu-id="116f4-153">To view the Windows application log, use the [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Windows Event Viewer.</span></span> <span data-ttu-id="116f4-154">アプリケーション ログには [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] のエラー メッセージだけでなく、コンピューターのその他多くの利用状況に関するメッセージが含まれます。</span><span class="sxs-lookup"><span data-stu-id="116f4-154">The application log contains [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] error messages as well as messages for many other activities on the computer.</span></span> <span data-ttu-id="116f4-155">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] エラー ログとは異なり、 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] を起動するたびに新しいアプリケーション ログが作成されることはありません (各 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] セッションでは、既存のアプリケーション ログに新しいイベントを書き込みます)。ただし、ログに記録されたイベントを保有する期間を指定できます。</span><span class="sxs-lookup"><span data-stu-id="116f4-155">Unlike the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] error log, a new application log is not created each time you start [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] (each [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] session writes new events to an existing application log); however, you can specify how long logged events will be retained.</span></span> <span data-ttu-id="116f4-156">Windows アプリケーション ログを表示するときに、特定のイベントのログをフィルター選択できます。</span><span class="sxs-lookup"><span data-stu-id="116f4-156">When you view the Windows application log, you can filter the log for specific events.</span></span> <span data-ttu-id="116f4-157">詳細については、Windows のマニュアルを参照してください。</span><span class="sxs-lookup"><span data-stu-id="116f4-157">For more information, see the Windows documentation.</span></span>  
  
## <a name="automating-a-response-to-an-alert"></a><span data-ttu-id="116f4-158">警告への応答の自動化</span><span class="sxs-lookup"><span data-stu-id="116f4-158">Automating a Response to an Alert</span></span>  
 <span data-ttu-id="116f4-159">レプリケーションでは、データ検証に失敗するサブスクリプションに対する応答ジョブ、および自動化された警告への応答を追加作成するためのフレームワークが用意されています。</span><span class="sxs-lookup"><span data-stu-id="116f4-159">Replication provides a response job for subscriptions that fail data validation, and also provides a framework for creating additional automated responses to alerts.</span></span> <span data-ttu-id="116f4-160">応答ジョブは、" **データ検証で問題が見つかったサブスクリプションの再初期化** " というタイトルが付けられ、 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] にある **エージェントの** [ジョブ] [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)]フォルダーに保存されます。</span><span class="sxs-lookup"><span data-stu-id="116f4-160">The response job is titled **Reinitialize subscriptions on data validation failure** and is stored in the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Agent **Jobs** folder in [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)].</span></span> <span data-ttu-id="116f4-161">この応答ジョブを有効にする方法については、「[Configure Predefined Replication Alerts &#40;SQL Server Management Studio&#41;](../administration/configure-predefined-replication-alerts-sql-server-management-studio.md)」 (定義済みのレプリケーションの警告の構成 &#40;SQL Server Management Studio&#41;) を参照してください。</span><span class="sxs-lookup"><span data-stu-id="116f4-161">For information about enabling this response job, see [Configure Predefined Replication Alerts &#40;SQL Server Management Studio&#41;](../administration/configure-predefined-replication-alerts-sql-server-management-studio.md).</span></span> <span data-ttu-id="116f4-162">トランザクション パブリケーション内のアーティクルが検証に失敗すると、応答ジョブは、その失敗したアーティクルのみを再初期化します。</span><span class="sxs-lookup"><span data-stu-id="116f4-162">If articles in a transactional publication fail validation, the response job reinitializes only those articles that failed.</span></span> <span data-ttu-id="116f4-163">マージ パブリケーション内のアーティクルが検証に失敗すると、応答ジョブは、パブリケーション内のすべてのアーティクルを再初期化します。</span><span class="sxs-lookup"><span data-stu-id="116f4-163">If articles in a merge publication fail validation, the response job reinitializes all articles in the publication.</span></span>  
  
### <a name="framework-for-automating-responses"></a><span data-ttu-id="116f4-164">応答の自動化のためのフレームワーク</span><span class="sxs-lookup"><span data-stu-id="116f4-164">Framework for Automating Responses</span></span>  
 <span data-ttu-id="116f4-165">通常では、警告が表示された場合、警告の原因と実行する適切な操作を知るのに役立つ唯一の情報は、警告自体に含まれています。</span><span class="sxs-lookup"><span data-stu-id="116f4-165">Usually, when an alert occurs, the only information you have to help you understand what caused the alert and the appropriate action to take is contained in the alert message itself.</span></span> <span data-ttu-id="116f4-166">この情報の解析は間違いやすく、時間がかかります。</span><span class="sxs-lookup"><span data-stu-id="116f4-166">Parsing this information can be error-prone and time-consuming.</span></span> <span data-ttu-id="116f4-167">レプリケーションでは、 **sysreplicationalerts** システム テーブルで警告についての追加情報が提供され、応答の自動化を容易にしています。提供される情報は、既に解析済みで、カスタマイズしたプログラムで簡単に使用できます。</span><span class="sxs-lookup"><span data-stu-id="116f4-167">Replication makes automating responses easier by providing additional information about the alert in the **sysreplicationalerts** system table; the information provided is already parsed in a form easily used by customized programs.</span></span>  
  
 <span data-ttu-id="116f4-168">たとえば、サブスクライバー A の **Sales.SalesOrderHeader** テーブルのデータが検証に失敗した場合、 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] は、その失敗を通知するメッセージ 20574 を表示します。</span><span class="sxs-lookup"><span data-stu-id="116f4-168">For example, if the data in the **Sales.SalesOrderHeader** table at Subscriber A fails validation, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] can trigger message 20574, notifying you of that failure.</span></span> <span data-ttu-id="116f4-169">"パブリケーション 'MyPublication' のアーティクル 'SalesOrderHeader' に対するサブスクライバー 'A' のサブスクリプションで、データ検証に失敗しました" というメッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="116f4-169">The message you receive will be: "Subscriber 'A', subscription to article 'SalesOrderHeader' in publication 'MyPublication' failed data validation."</span></span>  
  
 <span data-ttu-id="116f4-170">このメッセージに基づいた応答を作成する場合は、サブスクライバー名、アーティクル名、パブリケーション名、およびエラーをメッセージから手動で解析する必要があります。</span><span class="sxs-lookup"><span data-stu-id="116f4-170">If you create a response based on the message, you must manually parse the Subscriber name, article name, publication name, and error from the message.</span></span> <span data-ttu-id="116f4-171">しかし、ディストリビューション エージェントおよびマージ エージェントは **sysreplicationalerts** にそれらの情報 (およびエージェントの種類、警告の時刻、パブリケーション データベース、サブスクライバー データベース、パブリケーションの種類などの詳細) を書き込みます。このため、応答ジョブではテーブルから関連情報を直接クエリできます。</span><span class="sxs-lookup"><span data-stu-id="116f4-171">However, because the Distribution Agent and Merge Agent write that same information to **sysreplicationalerts** (along with details such as the type of agent, time of the alert, publication database, Subscriber database, and type of publication) the response job can directly query the relevant information from the table.</span></span> <span data-ttu-id="116f4-172">正確な行を警告の特定のインスタンスへ関連付けることはできませんが、このテーブルにある **status** 列を使用して、対象となるエントリを追跡できます。</span><span class="sxs-lookup"><span data-stu-id="116f4-172">Although the exact row cannot be associated with a specific instance of the alert, the table has a **status** column, which can be used to keep track of serviced entries.</span></span> <span data-ttu-id="116f4-173">このテーブルのエントリは、履歴の保有期間の間、維持されます。</span><span class="sxs-lookup"><span data-stu-id="116f4-173">The entries in this table are maintained for the history retention period.</span></span>  
  
 <span data-ttu-id="116f4-174">たとえば、 [!INCLUDE[tsql](../../../includes/tsql-md.md)] で警告メッセージ 20574 を対象とする応答を作成する場合、次のロジックを使用します。</span><span class="sxs-lookup"><span data-stu-id="116f4-174">For example, if you were to create a response job in [!INCLUDE[tsql](../../../includes/tsql-md.md)] that services alert message 20574, you might use the following logic:</span></span>  
  
```  
declare @publisher sysname, @publisher_db sysname, @publication sysname, @publication_type int, @article sysname, @subscriber sysname, @subscriber_db sysname, @alert_id int  
declare hc cursor local for select publisher, publisher_db, publication, publication_type, article, subscriber,   
  subscriber_db, alert_id from   
  msdb..sysreplicationalerts where  
  alert_error_code = 20574 and status = 0  
  for read only  
open hc  
fetch hc into  @publisher, @publisher_db, @publication, @publication_type, @article, @subscriber, @subscriber_db, @alert_id  
while (@@fetch_status <> -1)  
begin  
/* Do custom work  */  
/* Update status to 1, which means the alert has been serviced. This prevents subsequent runs of this job from doing this again */  
update msdb..sysreplicationalerts set status = 1 where alert_id = @alert_id  
 fetch hc into  @publisher, @publisher_db, @publication, @publication_type, @article, @subscriber, @subscriber_db, @alert_id  
end  
close hc  
deallocate hc  
```  
  
## <a name="see-also"></a><span data-ttu-id="116f4-175">参照</span><span class="sxs-lookup"><span data-stu-id="116f4-175">See Also</span></span>  
 <span data-ttu-id="116f4-176">[レプリケーション エージェントの管理](replication-agent-administration.md) </span><span class="sxs-lookup"><span data-stu-id="116f4-176">[Replication Agent Administration](replication-agent-administration.md) </span></span>  
 <span data-ttu-id="116f4-177">[レプリケーション管理のベストプラクティス](../administration/best-practices-for-replication-administration.md) </span><span class="sxs-lookup"><span data-stu-id="116f4-177">[Best Practices for Replication Administration](../administration/best-practices-for-replication-administration.md) </span></span>  
 [<span data-ttu-id="116f4-178">監視 (レプリケーション)</span><span class="sxs-lookup"><span data-stu-id="116f4-178">Monitoring &#40;Replication&#41;</span></span>](../monitoring-replication.md)  
  
  
