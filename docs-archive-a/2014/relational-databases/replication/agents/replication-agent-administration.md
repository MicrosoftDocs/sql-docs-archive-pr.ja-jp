---
title: レプリケーション エージェントの管理 | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- Snapshot Agent, administering
- Log Reader Agent, administering
- Queue Reader Agent, administering
- shared agents [SQL Server replication]
- Merge Agent, administering
- Distribution Agent, administering
- agents [SQL Server replication], administering
- replication cleanup jobs [SQL Server]
- administering replication, agents
- replication [SQL Server], administering
- independent agents [SQL Server replication]
ms.assetid: f27186b8-b1b2-4da0-8b2b-91f632c2ab7e
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 99cf9be6b31310e5ae0ebac3c096851ac4f63452
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87634417"
---
# <a name="replication-agent-administration"></a><span data-ttu-id="fcab2-102">レプリケーション エージェントの管理</span><span class="sxs-lookup"><span data-stu-id="fcab2-102">Replication Agent Administration</span></span>
  <span data-ttu-id="fcab2-103">レプリケーション エージェントは、レプリケーションに関連した数多くのタスクを実行します。たとえば、スキーマとデータのコピーの作成、パブリッシャーまたはサブスクライバーでの更新の検出、およびサーバー間での変更の反映などを行います。</span><span class="sxs-lookup"><span data-stu-id="fcab2-103">Replication agents carry out many of the tasks associated with replication, including creating copies of schema and data, detecting updates at the Publisher or Subscriber, and propagating changes between servers.</span></span> <span data-ttu-id="fcab2-104">既定では、レプリケーション エージェントは [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] エージェントのジョブ ステップで実行されます。</span><span class="sxs-lookup"><span data-stu-id="fcab2-104">By default, replication agents run under [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Agent job steps.</span></span> <span data-ttu-id="fcab2-105">エージェントは単なる実行可能ファイルであるため、コマンド ラインやバッチ スクリプトから直接呼び出すこともできます。</span><span class="sxs-lookup"><span data-stu-id="fcab2-105">The agents are simply executables, so they can also be called directly from the command line and from batch scripts.</span></span> <span data-ttu-id="fcab2-106">各レプリケーション エージェントでは、ランタイム パラメーターのセットを使用して実行方法を制御できます。このパラメーターはエージェント プロファイルまたはコマンド ラインで指定します。</span><span class="sxs-lookup"><span data-stu-id="fcab2-106">Each replication agent supports a set of run-time parameters used to control how it runs; these parameters are specified in an agent profile or on the command line.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="fcab2-107">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] のインストール時に、サービスがインストール中に自動開始されるように明示的に選択しない限り、 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] エージェント サービスは既定で無効になります。</span><span class="sxs-lookup"><span data-stu-id="fcab2-107">By default, the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Agent service is disabled when [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] is installed unless you explicitly choose to autostart the service during installation.</span></span>  
  
 <span data-ttu-id="fcab2-108">レプリケーション エージェントのファイルは、 [!INCLUDE[ssInstallPathVar](../../../includes/ssinstallpathvar-md.md)]\COM に保存されています。</span><span class="sxs-lookup"><span data-stu-id="fcab2-108">Replication agent files are located under [!INCLUDE[ssInstallPathVar](../../../includes/ssinstallpathvar-md.md)]\COM.</span></span> <span data-ttu-id="fcab2-109">次の表は、レプリケーション実行可能ファイル名およびファイル名を示しています。</span><span class="sxs-lookup"><span data-stu-id="fcab2-109">The following table lists the replication executable names and file names.</span></span> <span data-ttu-id="fcab2-110">パラメーター参照を表示するにはエージェントのリンクをクリックしてください。</span><span class="sxs-lookup"><span data-stu-id="fcab2-110">Click the link for an agent to view its parameter reference.</span></span>  
  
|<span data-ttu-id="fcab2-111">エージェント実行可能ファイル</span><span class="sxs-lookup"><span data-stu-id="fcab2-111">Agent Executable</span></span>|<span data-ttu-id="fcab2-112">ファイル名</span><span class="sxs-lookup"><span data-stu-id="fcab2-112">File Name</span></span>|  
|----------------------|---------------|  
|[<span data-ttu-id="fcab2-113">Replication Snapshot Agent</span><span class="sxs-lookup"><span data-stu-id="fcab2-113">Replication Snapshot Agent</span></span>](replication-snapshot-agent.md)|<span data-ttu-id="fcab2-114">snapshot.exe</span><span class="sxs-lookup"><span data-stu-id="fcab2-114">snapshot.exe</span></span>|  
|[<span data-ttu-id="fcab2-115">Replication Distribution Agent</span><span class="sxs-lookup"><span data-stu-id="fcab2-115">Replication Distribution Agent</span></span>](replication-distribution-agent.md)|<span data-ttu-id="fcab2-116">distrib.exe</span><span class="sxs-lookup"><span data-stu-id="fcab2-116">distrib.exe</span></span>|  
|[<span data-ttu-id="fcab2-117">レプリケーション ログ リーダー エージェント</span><span class="sxs-lookup"><span data-stu-id="fcab2-117">Replication Log Reader Agent</span></span>](replication-log-reader-agent.md)|<span data-ttu-id="fcab2-118">logread.exe</span><span class="sxs-lookup"><span data-stu-id="fcab2-118">logread.exe</span></span>|  
|[<span data-ttu-id="fcab2-119">レプリケーション キュー リーダー エージェント</span><span class="sxs-lookup"><span data-stu-id="fcab2-119">Replication Queue Reader Agent</span></span>](replication-queue-reader-agent.md)|<span data-ttu-id="fcab2-120">qrdrsvc.exe</span><span class="sxs-lookup"><span data-stu-id="fcab2-120">qrdrsvc.exe</span></span>|  
|[<span data-ttu-id="fcab2-121">Replication Merge Agent</span><span class="sxs-lookup"><span data-stu-id="fcab2-121">Replication Merge Agent</span></span>](replication-merge-agent.md)|<span data-ttu-id="fcab2-122">replmerg.exe</span><span class="sxs-lookup"><span data-stu-id="fcab2-122">replmerg.exe</span></span>|  
  
 <span data-ttu-id="fcab2-123">レプリケーション エージェントに加え、レプリケーションには定期的なメンテナンスおよび要求時メンテナンスを実行するさまざまなジョブがあります。</span><span class="sxs-lookup"><span data-stu-id="fcab2-123">In addition to replication agents, replication has a number of jobs that perform scheduled and on-demand maintenance.</span></span>  
  
 <span data-ttu-id="fcab2-124">**エージェントおよびメンテナンス ジョブを実行するには**</span><span class="sxs-lookup"><span data-stu-id="fcab2-124">**To run agents and maintenance jobs**</span></span>  
  
-   [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)]<span data-ttu-id="fcab2-125">およびレプリケーションモニター:[レプリケーションエージェント &#40;SQL Server Management Studio&#41;を開始および停止](start-and-stop-a-replication-agent-sql-server-management-studio.md)します。</span><span class="sxs-lookup"><span data-stu-id="fcab2-125">and Replication Monitor: [Start and Stop a Replication Agent &#40;SQL Server Management Studio&#41;](start-and-stop-a-replication-agent-sql-server-management-studio.md).</span></span>  
  
-   <span data-ttu-id="fcab2-126">レプリケーション プログラミング: [Replication Agent Executables Concepts](../concepts/replication-agent-executables-concepts.md)</span><span class="sxs-lookup"><span data-stu-id="fcab2-126">Replication programming: [Replication Agent Executables Concepts](../concepts/replication-agent-executables-concepts.md)</span></span>  
  
## <a name="agent-profiles"></a><span data-ttu-id="fcab2-127">[エージェント プロファイル]</span><span class="sxs-lookup"><span data-stu-id="fcab2-127">Agent Profiles</span></span>  
 <span data-ttu-id="fcab2-128">レプリケーションを構成すると、エージェント プロファイルのセットがディストリビューターにインストールされます。</span><span class="sxs-lookup"><span data-stu-id="fcab2-128">When replication is configured, a set of agent profiles is installed on the Distributor.</span></span> <span data-ttu-id="fcab2-129">エージェント プロファイルには、エージェントが実行されるたびに使用されるパラメーターのセットが含まれています。スタートアップ処理中に各エージェントはディストリビューターにログインし、各エージェントのプロファイルのパラメーターをクエリします。</span><span class="sxs-lookup"><span data-stu-id="fcab2-129">An agent profile contains a set of parameters that are used each time an agent runs: each agent logs in to the Distributor during its startup process and queries for the parameters in its profile.</span></span> <span data-ttu-id="fcab2-130">レプリケーションでは、各エージェント用の既定のプロファイルの他に、ログ リーダー エージェント、ディストリビューション エージェント、およびマージ エージェント用の追加の定義済みプロファイルが利用できます。</span><span class="sxs-lookup"><span data-stu-id="fcab2-130">Replication provides a default profile for each agent and additional predefined profiles for the Log Reader Agent, Distribution Agent, and Merge Agent.</span></span> <span data-ttu-id="fcab2-131">提供されているプロファイルに加えて、アプリケーションの要件に合わせてプロファイルを作成することもできます。</span><span class="sxs-lookup"><span data-stu-id="fcab2-131">In addition to the profiles provided, you can create profiles suited to your application requirements.</span></span> <span data-ttu-id="fcab2-132">詳しくは、「 [レプリケーション エージェント プロファイル](replication-agent-profiles.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="fcab2-132">For more information, see [Replication Agent Profiles](replication-agent-profiles.md).</span></span>  
  
 <span data-ttu-id="fcab2-133">コマンド ラインでパラメーターを直接指定する方法の詳細については、「[レプリケーション エージェント実行可能ファイルの概念](../concepts/replication-agent-executables-concepts.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="fcab2-133">For information about specifying command line parameters directly, see [Replication Agent Executables Concepts](../concepts/replication-agent-executables-concepts.md).</span></span>  
  
## <a name="monitoring-replication-agents"></a><span data-ttu-id="fcab2-134">レプリケーション エージェントの監視</span><span class="sxs-lookup"><span data-stu-id="fcab2-134">Monitoring Replication Agents</span></span>  
 <span data-ttu-id="fcab2-135">レプリケーション モニターを使用すると、各レプリケーション エージェントに関連する情報を表示し、タスクを実行できます。</span><span class="sxs-lookup"><span data-stu-id="fcab2-135">Replication Monitor allows you to view information and perform tasks associated with each replication agent.</span></span> <span data-ttu-id="fcab2-136">次の一覧に、各エージェント、各エージェントを利用できるレプリケーション モニターのタブ、およびそれらのタブへのアクセス方法について説明しているトピックへのリンクを示します。</span><span class="sxs-lookup"><span data-stu-id="fcab2-136">The following list includes each agent, the tabs in the Replication Monitor on which it can be found, and a link to a topic that explains how to access these tabs:</span></span>  
  
-   <span data-ttu-id="fcab2-137">以下のエージェントは、レプリケーション モニターでパブリケーションと関連付けられています。</span><span class="sxs-lookup"><span data-stu-id="fcab2-137">The following agents are associated with publications in Replication Monitor:</span></span>  
  
    -   <span data-ttu-id="fcab2-138">スナップショット エージェント</span><span class="sxs-lookup"><span data-stu-id="fcab2-138">Snapshot Agent</span></span>  
  
    -   <span data-ttu-id="fcab2-139">ログ リーダー エージェント (Log Reader Agent)</span><span class="sxs-lookup"><span data-stu-id="fcab2-139">Log Reader Agent</span></span>  
  
    -   <span data-ttu-id="fcab2-140">キュー リーダー エージェント (Queue Reader Agent)</span><span class="sxs-lookup"><span data-stu-id="fcab2-140">Queue Reader Agent</span></span>  
  
     <span data-ttu-id="fcab2-141">[**エージェント**] タブを使用して、これらのエージェントに関連付けられている情報とタスクにアクセスします。詳細については、「[レプリケーションモニターを使用して情報を表示し、タスクを実行する](../monitor/view-information-and-perform-tasks-replication-monitor.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="fcab2-141">Access information and tasks associated with these agents through the **Agents** tab. For more information, see [View Information and Perform Tasks using Replication Monitor](../monitor/view-information-and-perform-tasks-replication-monitor.md).</span></span>  
  
-   <span data-ttu-id="fcab2-142">以下のエージェントは、レプリケーション モニターでサブスクリプションと関連付けられています。</span><span class="sxs-lookup"><span data-stu-id="fcab2-142">The following agents are associated with subscriptions in Replication Monitor:</span></span>  
  
    -   <span data-ttu-id="fcab2-143">ディストリビューション エージェント</span><span class="sxs-lookup"><span data-stu-id="fcab2-143">Distribution Agent</span></span>  
  
    -   <span data-ttu-id="fcab2-144">[マージ エージェント]</span><span class="sxs-lookup"><span data-stu-id="fcab2-144">Merge Agent</span></span>  
  
     <span data-ttu-id="fcab2-145">これらのエージェントに関連付けられている情報およびタスクにアクセスするには、次のタブを使用します。 **[サブスクリプション ウォッチ リスト]** (各パブリッシャーで使用可能)、または **[すべてのサブスクリプション]** タブ (各パブリケーションで使用可能)。</span><span class="sxs-lookup"><span data-stu-id="fcab2-145">Access information and tasks associated with these agents through the following tabs: **Subscription Watch List** (available for each Publisher) or the **All Subscriptions** tab (available for each publication).</span></span> <span data-ttu-id="fcab2-146">詳細については、「[レプリケーション モニターを使用して情報を表示し、タスクを実行する](../monitor/view-information-and-perform-tasks-replication-monitor.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="fcab2-146">For more information, see [View Information and Perform Tasks using Replication Monitor](../monitor/view-information-and-perform-tasks-replication-monitor.md).</span></span>  
  
## <a name="independent-and-shared-agents"></a><span data-ttu-id="fcab2-147">独立したエージェントと共有エージェント</span><span class="sxs-lookup"><span data-stu-id="fcab2-147">Independent and Shared Agents</span></span>  
 <span data-ttu-id="fcab2-148">独立したエージェントとは、1 つのサブスクリプションを処理するエージェントのことです。</span><span class="sxs-lookup"><span data-stu-id="fcab2-148">An independent agent is an agent that services one subscription.</span></span> <span data-ttu-id="fcab2-149">共有エージェントは複数のサブスクリプションにサービスを提供します。同じ共有エージェントを使用している複数のサブスクリプションで同期する必要がある場合、既定では、それらのサブスクリプションはキューに格納されて待機し、共有エージェントがそれらを一度に 1 つずつ処理します。</span><span class="sxs-lookup"><span data-stu-id="fcab2-149">A shared agent services multiple subscriptions; if multiple subscriptions using the same shared agent need to synchronize, by default they wait in a queue, and the shared agent services them one at a time.</span></span> <span data-ttu-id="fcab2-150">独立したエージェントは、サブスクリプションが必要に応じていつでも同期できるように常に待機しているので、待機時間が短くなります。</span><span class="sxs-lookup"><span data-stu-id="fcab2-150">Latency is reduced when using independent agents because the agent is ready whenever the subscription needs to be synchronized.</span></span> <span data-ttu-id="fcab2-151">マージ レプリケーションでは常に独立したエージェントが使用され、トランザクション レプリケーションでは、既定ではパブリケーションの新規作成ウィザードで作成されたパブリケーションに対して独立したエージェントが使用されます (以前のバージョンの [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]では、トランザクション レプリケーションは既定で共有エージェントを使用していました)。</span><span class="sxs-lookup"><span data-stu-id="fcab2-151">Merge replication always uses independent agents, and transactional replication uses independent agents by default for publications created in the New Publication Wizard (in previous versions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], transactional replication used shared agents by default).</span></span>  
  
## <a name="replication-maintenance-jobs"></a><span data-ttu-id="fcab2-152">レプリケーション メンテナンス ジョブ</span><span class="sxs-lookup"><span data-stu-id="fcab2-152">Replication Maintenance Jobs</span></span>  
 <span data-ttu-id="fcab2-153">レプリケーションでは、次のジョブを使用して定期的なメンテナンスおよび要求時メンテナンスを実行します。</span><span class="sxs-lookup"><span data-stu-id="fcab2-153">Replication uses the following jobs to perform scheduled and on-demand maintenance.</span></span>  
  
|<span data-ttu-id="fcab2-154">クリーンアップ ジョブ</span><span class="sxs-lookup"><span data-stu-id="fcab2-154">Clean up job</span></span>|<span data-ttu-id="fcab2-155">説明</span><span class="sxs-lookup"><span data-stu-id="fcab2-155">Description</span></span>|<span data-ttu-id="fcab2-156">既定のスケジュール</span><span class="sxs-lookup"><span data-stu-id="fcab2-156">Default schedule</span></span>|  
|------------------|-----------------|----------------------|  
|<span data-ttu-id="fcab2-157">エージェント履歴のクリーンアップ: Distribution</span><span class="sxs-lookup"><span data-stu-id="fcab2-157">Agent History Clean Up: Distribution</span></span>|<span data-ttu-id="fcab2-158">ディストリビューション データベースからレプリケーション エージェントの履歴を削除します。</span><span class="sxs-lookup"><span data-stu-id="fcab2-158">Removes replication agent history from the distribution database.</span></span>|<span data-ttu-id="fcab2-159">10 分おきに実行されます。</span><span class="sxs-lookup"><span data-stu-id="fcab2-159">Runs every ten minutes</span></span>|  
|<span data-ttu-id="fcab2-160">ディストリビューションのクリーンアップ: Distribution</span><span class="sxs-lookup"><span data-stu-id="fcab2-160">Distribution Clean Up: Distribution</span></span>|<span data-ttu-id="fcab2-161">ディストリビューション データベースからレプリケートされたトランザクションを削除します。</span><span class="sxs-lookup"><span data-stu-id="fcab2-161">Removes replicated transactions from the distribution database.</span></span> <span data-ttu-id="fcab2-162">ディストリビューションの最大保有期間内に同期されなかったサブスクリプションを非アクティブ化します。</span><span class="sxs-lookup"><span data-stu-id="fcab2-162">Deactivates subscriptions that have not been synchronized within the maximum distribution retention period.</span></span>|<span data-ttu-id="fcab2-163">10 分おきに実行されます。</span><span class="sxs-lookup"><span data-stu-id="fcab2-163">Runs every ten minutes</span></span>|  
|<span data-ttu-id="fcab2-164">有効期限が切れたサブスクリプションのクリーンアップ</span><span class="sxs-lookup"><span data-stu-id="fcab2-164">Expired Subscription Clean Up</span></span>|<span data-ttu-id="fcab2-165">パブリケーション データベースから期限切れのサブスクリプションを検出し、削除します。</span><span class="sxs-lookup"><span data-stu-id="fcab2-165">Detects and removes expired subscriptions from publication databases.</span></span>|<span data-ttu-id="fcab2-166">毎日、午前 1 時に実行されます。</span><span class="sxs-lookup"><span data-stu-id="fcab2-166">Runs every day at 1:00 A.M.</span></span>|  
|<span data-ttu-id="fcab2-167">データ検証で問題が見つかったサブスクリプションの再初期化</span><span class="sxs-lookup"><span data-stu-id="fcab2-167">Reinitialize Subscriptions Having Data Validation Failures</span></span>|<span data-ttu-id="fcab2-168">データ検証に失敗したすべてのサブスクリプションを検出し、再初期化のマークを付けます。</span><span class="sxs-lookup"><span data-stu-id="fcab2-168">Detects all subscriptions that have data validation failures and marks them for reinitialization.</span></span> <span data-ttu-id="fcab2-169">次回マージ エージェントまたはディストリビューション エージェントが実行されたときに、サブスクライバーで新しいスナップショットが適用されます。</span><span class="sxs-lookup"><span data-stu-id="fcab2-169">The next time the Merge Agent or Distribution Agent runs, a new snapshot will be applied at the Subscribers.</span></span>|<span data-ttu-id="fcab2-170">既定のスケジュールはありません。既定では、有効ではありません。</span><span class="sxs-lookup"><span data-stu-id="fcab2-170">No default schedule (not enabled by default).</span></span>|  
|<span data-ttu-id="fcab2-171">レプリケーション エージェントの検査</span><span class="sxs-lookup"><span data-stu-id="fcab2-171">Replication Agents Checkup</span></span>|<span data-ttu-id="fcab2-172">履歴をログに記録していないレプリケーション エージェントを検出します。</span><span class="sxs-lookup"><span data-stu-id="fcab2-172">Detects replication agents that are not actively logging history.</span></span> <span data-ttu-id="fcab2-173">ジョブ ステップが失敗した場合に、 [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Windows イベント ログに書き込みます。</span><span class="sxs-lookup"><span data-stu-id="fcab2-173">It writes to the [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Windows event log if a job step fails.</span></span>|<span data-ttu-id="fcab2-174">10 分おきに実行されます。</span><span class="sxs-lookup"><span data-stu-id="fcab2-174">Runs every ten minutes.</span></span>|  
|<span data-ttu-id="fcab2-175">ディストリビューションのレプリケーション モニターの状態更新機能</span><span class="sxs-lookup"><span data-stu-id="fcab2-175">Replication monitoring refresher for distribution</span></span>|<span data-ttu-id="fcab2-176">レプリケーション モニターで使用される、キャッシュされたクエリを更新します。</span><span class="sxs-lookup"><span data-stu-id="fcab2-176">Refreshes cached queries used by Replication Monitor..</span></span>|<span data-ttu-id="fcab2-177">連続的に実行されます。</span><span class="sxs-lookup"><span data-stu-id="fcab2-177">Runs continuously.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="fcab2-178">参照</span><span class="sxs-lookup"><span data-stu-id="fcab2-178">See Also</span></span>  
 [<span data-ttu-id="fcab2-179">レプリケーションの監視</span><span class="sxs-lookup"><span data-stu-id="fcab2-179">Monitoring Replication</span></span>](../monitoring-replication.md)  
  
  
