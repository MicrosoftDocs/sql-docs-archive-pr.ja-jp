---
title: プッシュ サブスクリプションの作成 | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- push subscriptions [SQL Server replication], creating
- merge replication subscribing [SQL Server replication], push subscriptions
- subscriptions [SQL Server replication], push
- snapshot replication [SQL Server], subscribing
- transactional replication, subscribing
ms.assetid: adfbbc61-58d1-4330-9ad6-b14ab1142e2b
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 2195d96f4337cc60ba213deb5e3cc2831d27da76
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87646134"
---
# <a name="create-a-push-subscription"></a><span data-ttu-id="486a6-102">プッシュ サブスクリプションの作成</span><span class="sxs-lookup"><span data-stu-id="486a6-102">Create a Push Subscription</span></span>
  <span data-ttu-id="486a6-103">このトピックでは、 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] で [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]、 [!INCLUDE[tsql](../../includes/tsql-md.md)]、またはレプリケーション管理オブジェクト (RMO) を使用して、プッシュ サブスクリプションを作成する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="486a6-103">This topic describes how to create a push subscription in [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] by using [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../includes/tsql-md.md)], or Replication Management Objects (RMO).</span></span> <span data-ttu-id="486a6-104">以外のサブスクライバーに対するプッシュサブスクリプションの作成の詳細につい [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ては、「 [SQL Server 以外のサブスクライバーのサブスクリプションを作成](create-a-subscription-for-a-non-sql-server-subscriber.md)する」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="486a6-104">For information about creating a push subscription for a non-[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Subscriber, see [Create a Subscription for a Non-SQL Server Subscriber](create-a-subscription-for-a-non-sql-server-subscriber.md).</span></span>  
  
  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> <span data-ttu-id="486a6-105">SQL Server Management Studio の使用</span><span class="sxs-lookup"><span data-stu-id="486a6-105">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="486a6-106">サブスクリプションの新規作成ウィザードを使用して、パブリッシャーまたはサブスクライバーでプッシュ サブスクリプションを作成します。</span><span class="sxs-lookup"><span data-stu-id="486a6-106">Create a push subscription at the Publisher or the Subscriber using the New Subscription Wizard.</span></span> <span data-ttu-id="486a6-107">ウィザードのページに従って、次の操作を実行します。</span><span class="sxs-lookup"><span data-stu-id="486a6-107">Follow the pages in the wizard to:</span></span>  
  
-   <span data-ttu-id="486a6-108">パブリッシャーとパブリケーションを指定します。</span><span class="sxs-lookup"><span data-stu-id="486a6-108">Specify the Publisher and publication.</span></span>  
  
-   <span data-ttu-id="486a6-109">レプリケーション エージェントが実行される場所を選択します。</span><span class="sxs-lookup"><span data-stu-id="486a6-109">Select where replication agents will run.</span></span> <span data-ttu-id="486a6-110">プッシュ サブスクリプションでは、パブリケーションの種類に応じて、 **[ディストリビューション エージェントの場所]** ページまたは **[マージ エージェントの場所]** ページで **[ディストリビューター &lt;Distributor&gt; ですべてのエージェントを実行する (プッシュ サブスクリプション)]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="486a6-110">For a push subscription, select **Run all agents at the Distributor (push subscriptions)** on the **Distribution Agent Location** page or **Merge Agent Location** page, depending on the type of publication.</span></span>  
  
-   <span data-ttu-id="486a6-111">サブスクライバーとサブスクリプション データベースを指定します。</span><span class="sxs-lookup"><span data-stu-id="486a6-111">Specify Subscribers and subscription databases.</span></span>  
  
-   <span data-ttu-id="486a6-112">レプリケーション エージェントによって作成された接続に対して使用されるログインとパスワードを指定します。</span><span class="sxs-lookup"><span data-stu-id="486a6-112">Specify the logins and passwords used for connections made by replication agents:</span></span>  
  
    -   <span data-ttu-id="486a6-113">スナップショット パブリケーションとトランザクション パブリケーションに対するサブスクリプションでは、 **[ディストリビューション エージェント セキュリティ]** ページで資格情報を指定します。</span><span class="sxs-lookup"><span data-stu-id="486a6-113">For subscriptions to snapshot and transactional publications, specify credentials on the **Distribution Agent Security** page.</span></span>  
  
    -   <span data-ttu-id="486a6-114">マージ パブリケーションに対するサブスクリプションでは、 **[マージ エージェント セキュリティ]** ページで資格情報を指定します。</span><span class="sxs-lookup"><span data-stu-id="486a6-114">For subscriptions to merge publications, specify credentials on the **Merge Agent Security** page.</span></span>  
  
     <span data-ttu-id="486a6-115">各エージェントで必要な権限の詳細については、「 [レプリケーション エージェント セキュリティ モデル](security/replication-agent-security-model.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="486a6-115">For information about the permissions required by each agent, see [Replication Agent Security Model](security/replication-agent-security-model.md).</span></span>  
  
-   <span data-ttu-id="486a6-116">同期スケジュール、およびサブスクライバーをいつ初期化するかを指定します。</span><span class="sxs-lookup"><span data-stu-id="486a6-116">Specify a synchronization schedule and when the Subscriber should be initialized.</span></span>  
  
-   <span data-ttu-id="486a6-117">マージ パブリケーションの追加オプションとして、サブスクリプションの種類、およびパラメーター化されたフィルターの値を指定します。</span><span class="sxs-lookup"><span data-stu-id="486a6-117">Specify additional options for merge publications: subscription type; and values for parameterized filtering.</span></span>  
  
-   <span data-ttu-id="486a6-118">サブスクリプションの更新が許可されるトランザクション パブリケーションの追加オプションを指定します。サブスクライバーがパブリッシャーで変更をすぐにコミットするかどうか、変更をキューに書き込むかどうか、およびサブスクライバーからパブリッシャーへの接続に使用される資格情報を指定します。</span><span class="sxs-lookup"><span data-stu-id="486a6-118">Specify additional options for transactional publications that allow updating subscriptions: whether Subscribers should commit changes at the Publisher immediately or write them to a queue; credentials used to connect from the Subscriber to the Publisher.</span></span>  
  
-   <span data-ttu-id="486a6-119">必要に応じて、サブスクリプションのスクリプトを作成します。</span><span class="sxs-lookup"><span data-stu-id="486a6-119">Optionally script the subscription.</span></span>  
  
#### <a name="to-create-a-push-subscription-from-the-publisher"></a><span data-ttu-id="486a6-120">パブリッシャーからプッシュ サブスクリプションを作成するには</span><span class="sxs-lookup"><span data-stu-id="486a6-120">To create a push subscription from the Publisher</span></span>  
  
1.  <span data-ttu-id="486a6-121">[!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] でパブリッシャーに接続し、サーバー ノードを展開します。</span><span class="sxs-lookup"><span data-stu-id="486a6-121">Connect to the Publisher in [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], and then expand the server node.</span></span>  
  
2.  <span data-ttu-id="486a6-122">**[レプリケーション]** フォルダーを展開し、 **[ローカル パブリケーション]** フォルダーを展開します。</span><span class="sxs-lookup"><span data-stu-id="486a6-122">Expand the **Replication** folder, and then expand the **Local Publications** folder.</span></span>  
  
3.  <span data-ttu-id="486a6-123">1 つ以上のサブスクリプションを作成するパブリケーションを右クリックし、 **[新しいサブスクリプション]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="486a6-123">Right-click the publication for which you want to create one or more subscriptions, and then click **New Subscriptions**.</span></span>  
  
4.  <span data-ttu-id="486a6-124">サブスクリプションの新規作成ウィザードのページに従って操作を実行します。</span><span class="sxs-lookup"><span data-stu-id="486a6-124">Complete the pages in the New Subscription Wizard.</span></span>  
  
#### <a name="to-create-a-push-subscription-from-the-subscriber"></a><span data-ttu-id="486a6-125">サブスクライバーからプッシュ サブスクリプションを作成するには</span><span class="sxs-lookup"><span data-stu-id="486a6-125">To create a push subscription from the Subscriber</span></span>  
  
1.  <span data-ttu-id="486a6-126">[!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]でサブスクライバーに接続して、サーバー ノードを展開します。</span><span class="sxs-lookup"><span data-stu-id="486a6-126">Connect to the Subscriber in [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], and then expand the server node.</span></span>  
  
2.  <span data-ttu-id="486a6-127">**[レプリケーション]** フォルダーを展開します。</span><span class="sxs-lookup"><span data-stu-id="486a6-127">Expand the **Replication** folder.</span></span>  
  
3.  <span data-ttu-id="486a6-128">**[ローカル サブスクリプション]** フォルダーを右クリックし、 **[新しいサブスクリプション]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="486a6-128">Right-click the **Local Subscriptions** folder, and then click **New Subscriptions**.</span></span>  
  
4.  <span data-ttu-id="486a6-129">サブスクリプションの新規作成ウィザードの **[パブリケーション]** ページで、 **[パブリッシャー]** ドロップダウン リストから **[\<Find SQL Server Publisher>]** または **[\<Find Oracle Publisher>]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="486a6-129">On the **Publication** page of the New Subscription Wizard, select **\<Find SQL Server Publisher>** or **\<Find Oracle Publisher>** from the **Publisher** drop-down list.</span></span>  
  
5.  <span data-ttu-id="486a6-130">**[サーバーへの接続]** ダイアログ ボックスでパブリッシャーに接続します。</span><span class="sxs-lookup"><span data-stu-id="486a6-130">Connect to the Publisher in the **Connect to Server** dialog box.</span></span>  
  
6.  <span data-ttu-id="486a6-131">**[パブリケーション]** ページでパブリケーションを選択します。</span><span class="sxs-lookup"><span data-stu-id="486a6-131">Select a publication on the **Publication** page.</span></span>  
  
7.  <span data-ttu-id="486a6-132">サブスクリプションの新規作成ウィザードのページに従って操作を実行します。</span><span class="sxs-lookup"><span data-stu-id="486a6-132">Complete the pages in the New Subscription Wizard.</span></span>  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="486a6-133">Transact-SQL の使用</span><span class="sxs-lookup"><span data-stu-id="486a6-133">Using Transact-SQL</span></span>  
 <span data-ttu-id="486a6-134">プッシュ サブスクリプションは、レプリケーション ストアド プロシージャを使用してプログラムで作成できます。</span><span class="sxs-lookup"><span data-stu-id="486a6-134">Push subscriptions can be created programmatically using replication stored procedures.</span></span> <span data-ttu-id="486a6-135">使用するストアド プロシージャは、サブスクリプションが属するパブリケーションの種類によって変わります。</span><span class="sxs-lookup"><span data-stu-id="486a6-135">The stored procedures used will depend on the type of publication to which the subscription belongs.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="486a6-136">可能であれば、実行時にセキュリティ資格情報の入力を求めるメッセージをユーザーに対して表示します。</span><span class="sxs-lookup"><span data-stu-id="486a6-136">When possible, prompt users to enter security credentials at run time.</span></span> <span data-ttu-id="486a6-137">スクリプト ファイルに資格情報を格納する必要がある場合は、不正アクセスを防ぐために、ファイルを保護します。</span><span class="sxs-lookup"><span data-stu-id="486a6-137">If you must store credentials in a script file, you must secure the file to prevent unauthorized access.</span></span>  
  
#### <a name="to-create-a-push-subscription-to-a-snapshot-or-transactional-publication"></a><span data-ttu-id="486a6-138">スナップショット パブリケーションまたはトランザクション パブリケーションに対するプッシュ サブスクリプションを作成するには</span><span class="sxs-lookup"><span data-stu-id="486a6-138">To create a push subscription to a snapshot or transactional publication</span></span>  
  
1.  <span data-ttu-id="486a6-139">パブリッシャー側のパブリケーション データベースに対して、 [sp_helppublication](/sql/relational-databases/system-stored-procedures/sp-helppublication-transact-sql)を実行して、パブリケーションがプッシュ サブスクリプションをサポートしていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="486a6-139">At the Publisher on the publication database, verify that the publication supports push subscriptions by executing [sp_helppublication](/sql/relational-databases/system-stored-procedures/sp-helppublication-transact-sql).</span></span>  
  
    -   <span data-ttu-id="486a6-140">**allow_push** の値が **1**の場合、プッシュ サブスクリプションがサポートされます。</span><span class="sxs-lookup"><span data-stu-id="486a6-140">If the value of **allow_push** is **1**, push subscriptions are supported.</span></span>  
  
    -   <span data-ttu-id="486a6-141">**Allow_push**の値が**0**の場合、 [sp_changepublication](/sql/relational-databases/system-stored-procedures/sp-changepublication-transact-sql)を実行します。また、の場合は**allow_push**を指定 **@property** `true` **@value** します。</span><span class="sxs-lookup"><span data-stu-id="486a6-141">If the value of **allow_push** is **0**, execute [sp_changepublication](/sql/relational-databases/system-stored-procedures/sp-changepublication-transact-sql), specifying **allow_push** for **@property** and `true` for **@value**.</span></span>  
  
2.  <span data-ttu-id="486a6-142">パブリッシャー側のパブリケーション データベースに対して、 [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql)を実行します。</span><span class="sxs-lookup"><span data-stu-id="486a6-142">At the Publisher on the publication database, execute [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql).</span></span> <span data-ttu-id="486a6-143">**@publication**、、およびを指定し **@subscriber** **@destination_db** ます。</span><span class="sxs-lookup"><span data-stu-id="486a6-143">Specify **@publication**, **@subscriber** and **@destination_db**.</span></span> <span data-ttu-id="486a6-144">**@subscription_type** に **push** を指定します。</span><span class="sxs-lookup"><span data-stu-id="486a6-144">Specify a value of **push** for **@subscription_type**.</span></span> <span data-ttu-id="486a6-145">サブスクリプションを更新する方法の詳細については、「[トランザクションパブリケーションに対する更新可能なサブスクリプションの作成](publish/create-an-updatable-subscription-to-a-transactional-publication.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="486a6-145">For information about how to update subscriptions, see [Create an Updatable Subscription to a Transactional Publication](publish/create-an-updatable-subscription-to-a-transactional-publication.md)</span></span>  
  
3.  <span data-ttu-id="486a6-146">パブリッシャー側のパブリケーション データベースに対して、 [sp_addpushsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addpushsubscription-agent-transact-sql)を実行します。</span><span class="sxs-lookup"><span data-stu-id="486a6-146">At the Publisher on the publication database, execute [sp_addpushsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addpushsubscription-agent-transact-sql).</span></span> <span data-ttu-id="486a6-147">次の指定を行います。</span><span class="sxs-lookup"><span data-stu-id="486a6-147">Specify the following:</span></span>  
  
    -   <span data-ttu-id="486a6-148">、、およびの各 **@subscriber** **@subscriber_db** **@publication** パラメーター。</span><span class="sxs-lookup"><span data-stu-id="486a6-148">The **@subscriber**, **@subscriber_db**, and **@publication** parameters.</span></span>  
  
    -   <span data-ttu-id="486a6-149">[!INCLUDE[msCoName](../../includes/msconame-md.md)]およびに対してディストリビューターでディストリビューションエージェントを実行するときに使用する Windows 資格情報 **@job_login** **@job_password** 。</span><span class="sxs-lookup"><span data-stu-id="486a6-149">The [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows credentials under which the Distribution Agent at the Distributor runs for **@job_login** and **@job_password**.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="486a6-150">Windows 統合認証を使用して確立される接続は、常におよびで指定された Windows 資格情報を使用し **@job_login** **@job_password** ます。</span><span class="sxs-lookup"><span data-stu-id="486a6-150">Connections made using Windows Integrated Authentication always use the Windows credentials specified by **@job_login** and **@job_password**.</span></span> <span data-ttu-id="486a6-151">ディストリビューション エージェントは、常に Windows 統合認証を使用してディストリビューターにローカル接続します。</span><span class="sxs-lookup"><span data-stu-id="486a6-151">The Distribution Agent always makes the local connection to the Distributor using Windows Integrated Authentication.</span></span> <span data-ttu-id="486a6-152">既定では、エージェントは Windows 統合認証を使用してサブスクライバーに接続します。</span><span class="sxs-lookup"><span data-stu-id="486a6-152">By default, the agent will connect to the Subscriber using Windows Integrated Authentication.</span></span>  
  
    -   <span data-ttu-id="486a6-153">(省略可) **0** を、 **@subscriber_security_mode** を指定し、 [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] および **@subscriber_login** に **@subscriber_password**」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="486a6-153">(Optional) A value of **0** for **@subscriber_security_mode** and the [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **@subscriber_login** and **@subscriber_password**.</span></span> <span data-ttu-id="486a6-154">サブスクライバーに接続するときに SQL Server 認証を使用する必要がある場合、これらのパラメーターを指定します。</span><span class="sxs-lookup"><span data-stu-id="486a6-154">Specify these parameters if you need to use SQL Server Authentication when connecting to the Subscriber.</span></span>  
  
    -   <span data-ttu-id="486a6-155">このサブスクリプションでのディストリビューション エージェント ジョブのスケジュール。</span><span class="sxs-lookup"><span data-stu-id="486a6-155">A schedule for the Distribution Agent job for this subscription.</span></span> <span data-ttu-id="486a6-156">詳細については、「 [Specify Synchronization Schedules](specify-synchronization-schedules.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="486a6-156">For more information, see [Specify Synchronization Schedules](specify-synchronization-schedules.md).</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="486a6-157">リモート ディストリビューターを使用するパブリッシャー側でプッシュ サブスクリプションを作成する場合は、 *job_login* および *job_password*を含むすべてのパラメーターに指定された値がディストリビューターにプレーン テキストとして送信されます。</span><span class="sxs-lookup"><span data-stu-id="486a6-157">When creating a push subscription at a Publisher with a remote Distributor, the values supplied for all parameters, including *job_login* and *job_password*, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="486a6-158">このストアド プロシージャを実行する前に、パブリッシャーとリモート ディストリビューターの間の接続を暗号化する必要があります。</span><span class="sxs-lookup"><span data-stu-id="486a6-158">You should encrypt the connection between the Publisher and its remote Distributor before executing this stored procedure.</span></span> <span data-ttu-id="486a6-159">詳細については、「[データベース エンジンへの暗号化接続の有効化 &#40;SQL Server 構成マネージャー&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="486a6-159">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
#### <a name="to-create-a-push-subscription-to-a-merge-publication"></a><span data-ttu-id="486a6-160">マージ パブリケーションに対するプッシュ サブスクリプションを作成するには</span><span class="sxs-lookup"><span data-stu-id="486a6-160">To create a push subscription to a merge publication</span></span>  
  
1.  <span data-ttu-id="486a6-161">パブリッシャー側のパブリケーション データベースに対して、 [sp_helpmergepublication](/sql/relational-databases/system-stored-procedures/sp-helpmergepublication-transact-sql)を実行して、パブリケーションがプッシュ サブスクリプションをサポートしていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="486a6-161">At the Publisher on the publication database, verify that the publication supports push subscriptions by executing [sp_helpmergepublication](/sql/relational-databases/system-stored-procedures/sp-helpmergepublication-transact-sql).</span></span>  
  
    -   <span data-ttu-id="486a6-162">**allow_push** の値が **1**の場合、パブリケーションでプッシュ サブスクリプションがサポートされます。</span><span class="sxs-lookup"><span data-stu-id="486a6-162">If the value of **allow_push** is **1**, the publication supports push subscriptions.</span></span>  
  
    -   <span data-ttu-id="486a6-163">**Allow_push**の値が**1**でない場合は、 [sp_changemergepublication](/sql/relational-databases/system-stored-procedures/sp-changemergepublication-transact-sql)を実行します。また、の場合は**allow_push**を指定 **@property** `true` **@value** します。</span><span class="sxs-lookup"><span data-stu-id="486a6-163">If the value of **allow_push** is not **1**, execute [sp_changemergepublication](/sql/relational-databases/system-stored-procedures/sp-changemergepublication-transact-sql), specifying **allow_push** for **@property** and `true` for **@value**.</span></span>  
  
2.  <span data-ttu-id="486a6-164">パブリッシャー側のパブリケーション データベースに対して、 [sp_addmergesubscription](/sql/relational-databases/system-stored-procedures/sp-addmergesubscription-transact-sql)を実行します。次のパラメーターを指定します。</span><span class="sxs-lookup"><span data-stu-id="486a6-164">At the Publisher on the publication database, execute [sp_addmergesubscription](/sql/relational-databases/system-stored-procedures/sp-addmergesubscription-transact-sql), specifying the following parameters:</span></span>  
  
    -   <span data-ttu-id="486a6-165">**@publication**.</span><span class="sxs-lookup"><span data-stu-id="486a6-165">**@publication**.</span></span> <span data-ttu-id="486a6-166">これはパブリケーションの名前です。</span><span class="sxs-lookup"><span data-stu-id="486a6-166">This is the name of the publication.</span></span>  
  
    -   <span data-ttu-id="486a6-167">**@subscriber_type**.</span><span class="sxs-lookup"><span data-stu-id="486a6-167">**@subscriber_type**.</span></span> <span data-ttu-id="486a6-168">クライアント サブスクリプションの場合は **local** を指定し、サーバー サブスクリプションの場合は **global**を指定します。</span><span class="sxs-lookup"><span data-stu-id="486a6-168">For a client subscription, specify **local** and for a server subscription, specify **global**.</span></span>  
  
    -   <span data-ttu-id="486a6-169">**@subscription_priority**.</span><span class="sxs-lookup"><span data-stu-id="486a6-169">**@subscription_priority**.</span></span> <span data-ttu-id="486a6-170">サーバー サブスクリプションの場合、サブスクリプションの優先度 (**0.00** ～ **99.99**) を指定します。</span><span class="sxs-lookup"><span data-stu-id="486a6-170">For a server subscription, specify a priority for the subscription (**0.00** to **99.99**).</span></span>  
  
         <span data-ttu-id="486a6-171">詳細については、「 [マージ レプリケーションの競合検出および解決の詳細](merge/advanced-merge-replication-conflict-detection-and-resolution.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="486a6-171">For more information, see [Advanced Merge Replication Conflict Detection and Resolution](merge/advanced-merge-replication-conflict-detection-and-resolution.md).</span></span>  
  
3.  <span data-ttu-id="486a6-172">パブリッシャー側のパブリケーション データベースに対して、 [sp_addmergepushsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addmergepushsubscription-agent-transact-sql)を実行します。</span><span class="sxs-lookup"><span data-stu-id="486a6-172">At the Publisher on the publication database, execute [sp_addmergepushsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addmergepushsubscription-agent-transact-sql).</span></span> <span data-ttu-id="486a6-173">次の指定を行います。</span><span class="sxs-lookup"><span data-stu-id="486a6-173">Specify the following:</span></span>  
  
    -   <span data-ttu-id="486a6-174">、、およびの各 **@subscriber** **@subscriber_db** **@publication** パラメーター。</span><span class="sxs-lookup"><span data-stu-id="486a6-174">The **@subscriber**, **@subscriber_db**, and **@publication** parameters.</span></span>  
  
    -   <span data-ttu-id="486a6-175">およびに対してディストリビューターでマージエージェントを実行するときに使用する Windows 資格情報 **@job_login** **@job_password** 。</span><span class="sxs-lookup"><span data-stu-id="486a6-175">The Windows credentials under which the Merge Agent at the Distributor runs for **@job_login** and **@job_password**.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="486a6-176">Windows 統合認証を使用して確立される接続は、常におよびで指定された Windows 資格情報を使用し **@job_login** **@job_password** ます。</span><span class="sxs-lookup"><span data-stu-id="486a6-176">Connections made using Windows Integrated Authentication always use the Windows credentials specified by **@job_login** and **@job_password**.</span></span> <span data-ttu-id="486a6-177">マージ エージェントは、常に Windows 統合認証を使用してディストリビューターにローカル接続します。</span><span class="sxs-lookup"><span data-stu-id="486a6-177">The Merge Agent always makes the local connection to the Distributor using Windows Integrated Authentication.</span></span> <span data-ttu-id="486a6-178">既定では、エージェントは Windows 統合認証を使用してサブスクライバーに接続します。</span><span class="sxs-lookup"><span data-stu-id="486a6-178">By default, the agent will connect to the Subscriber using Windows Integrated Authentication.</span></span>  
  
    -   <span data-ttu-id="486a6-179">(省略可) **0** を、 **@subscriber_security_mode** を指定し、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] および **@subscriber_login** に **@subscriber_password**」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="486a6-179">(Optional) A value of **0** for **@subscriber_security_mode** and the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **@subscriber_login** and **@subscriber_password**.</span></span> <span data-ttu-id="486a6-180">サブスクライバーに接続するときに SQL Server 認証を使用する必要がある場合、これらのパラメーターを指定します。</span><span class="sxs-lookup"><span data-stu-id="486a6-180">Specify these parameters if you need to use SQL Server Authentication when connecting to the Subscriber.</span></span>  
  
    -   <span data-ttu-id="486a6-181">(省略可) **0** を、 **@publisher_security_mode** を指定し、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] および **@publisher_login** に **@publisher_password**」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="486a6-181">(Optional) A value of **0** for **@publisher_security_mode** and the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **@publisher_login** and **@publisher_password**.</span></span> <span data-ttu-id="486a6-182">パブリッシャーに接続するときに SQL Server 認証を使用する必要がある場合、これらの値を指定します。</span><span class="sxs-lookup"><span data-stu-id="486a6-182">Specify these values if you need to use SQL Server Authentication when connecting to the Publisher.</span></span>  
  
    -   <span data-ttu-id="486a6-183">このサブスクリプションでのマージ エージェント ジョブのスケジュール。</span><span class="sxs-lookup"><span data-stu-id="486a6-183">A schedule for the Merge Agent job for this subscription.</span></span> <span data-ttu-id="486a6-184">詳細については、「 [Specify Synchronization Schedules](specify-synchronization-schedules.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="486a6-184">For more information, see [Specify Synchronization Schedules](specify-synchronization-schedules.md).</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="486a6-185">リモート ディストリビューターを使用するパブリッシャー側でプッシュ サブスクリプションを作成する場合は、 *job_login* および *job_password*を含むすべてのパラメーターに指定された値がディストリビューターにプレーン テキストとして送信されます。</span><span class="sxs-lookup"><span data-stu-id="486a6-185">When creating a push subscription at a Publisher with a remote Distributor, the values supplied for all parameters, including *job_login* and *job_password*, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="486a6-186">このストアド プロシージャを実行する前に、パブリッシャーとリモート ディストリビューターの間の接続を暗号化する必要があります。</span><span class="sxs-lookup"><span data-stu-id="486a6-186">You should encrypt the connection between the Publisher and its remote Distributor before executing this stored procedure.</span></span> <span data-ttu-id="486a6-187">詳細については、「[データベース エンジンへの暗号化接続の有効化 &#40;SQL Server 構成マネージャー&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="486a6-187">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
###  <a name="examples-transact-sql"></a><a name="TsqlExample"></a> <span data-ttu-id="486a6-188">例 (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="486a6-188">Examples (Transact-SQL)</span></span>  
 <span data-ttu-id="486a6-189">次の例では、トランザクション パブリケーションに対するプッシュ サブスクリプションを作成します。</span><span class="sxs-lookup"><span data-stu-id="486a6-189">The following example creates a push subscription to a transactional publication.</span></span> <span data-ttu-id="486a6-190">ログインとパスワードの値は、実行時に **sqlcmd** スクリプト変数を使用して入力されます。</span><span class="sxs-lookup"><span data-stu-id="486a6-190">Login and password values are supplied at run time by using **sqlcmd** scripting variables.</span></span>  
  
 [!code-sql[HowTo#sp_addtranpushsubscription_agent](../../snippets/tsql/SQL15/replication/howto/tsql/createtranpushsub.sql#sp_addtranpushsubscription_agent)]  
  
 <span data-ttu-id="486a6-191">次の例では、マージ パブリケーションに対するプッシュ サブスクリプションを作成します。</span><span class="sxs-lookup"><span data-stu-id="486a6-191">The following example creates a push subscription to a merge publication.</span></span> <span data-ttu-id="486a6-192">ログインとパスワードの値は、実行時に **sqlcmd** スクリプト変数を使用して入力されます。</span><span class="sxs-lookup"><span data-stu-id="486a6-192">Login and password values are supplied at run time by using **sqlcmd** scripting variables.</span></span>  
  
 [!code-sql[HowTo#sp_addmergepushsubscriptionagent](../../snippets/tsql/SQL15/replication/howto/tsql/createmergepushsub.sql#sp_addmergepushsubscriptionagent)]  
  
##  <a name="using-replication-management-objects-rmo"></a><a name="RMOProcedure"></a> <span data-ttu-id="486a6-193">レプリケーション管理オブジェクト (RMO) の使用</span><span class="sxs-lookup"><span data-stu-id="486a6-193">Using Replication Management Objects (RMO)</span></span>  
 <span data-ttu-id="486a6-194">レプリケーション管理オブジェクト (RMO) を使用することで、プログラムによってプッシュ サブスクリプションを作成できます。</span><span class="sxs-lookup"><span data-stu-id="486a6-194">You can create push subscriptions programmatically by using Replication Management Objects (RMO).</span></span> <span data-ttu-id="486a6-195">プッシュ サブスクリプションを作成する際に使用する RMO クラスは、作成するサブスクリプションの対象となるパブリケーションの種類によって異なります。</span><span class="sxs-lookup"><span data-stu-id="486a6-195">The RMO classes you use to create a push subscription depend on the type of publication to which the subscription is created.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="486a6-196">可能であれば、実行時、ユーザーに対してセキュリティ資格情報の入力を要求します。</span><span class="sxs-lookup"><span data-stu-id="486a6-196">When possible, prompt users to enter security credentials at runtime.</span></span> <span data-ttu-id="486a6-197">資格情報を保存する必要がある場合は、 [Windows .NET&#xA0;Framework に用意されている](https://go.microsoft.com/fwlink/?LinkId=34733) 暗号化サービス [!INCLUDE[msCoName](../../includes/msconame-md.md)] を使用します。</span><span class="sxs-lookup"><span data-stu-id="486a6-197">If you must store credentials, use the [cryptographic services](https://go.microsoft.com/fwlink/?LinkId=34733) provided by the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows .NET Framework.</span></span>  
  
#### <a name="to-create-a-push-subscription-to-a-snapshot-or-transactional-publication"></a><span data-ttu-id="486a6-198">スナップショット パブリケーションまたはトランザクション パブリケーションに対するプッシュ サブスクリプションを作成するには</span><span class="sxs-lookup"><span data-stu-id="486a6-198">To create a push subscription to a snapshot or transactional publication</span></span>  
  
1.  <span data-ttu-id="486a6-199"><xref:Microsoft.SqlServer.Management.Common.ServerConnection> クラスを使用して、パブリッシャーへの接続を作成します。</span><span class="sxs-lookup"><span data-stu-id="486a6-199">Create a connection to the Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="486a6-200">手順 1. のパブリッシャー接続を使用して、 <xref:Microsoft.SqlServer.Replication.TransPublication> クラスのインスタンスを作成します。</span><span class="sxs-lookup"><span data-stu-id="486a6-200">Create an instance of the <xref:Microsoft.SqlServer.Replication.TransPublication> class by using the Publisher connection from step 1.</span></span> <span data-ttu-id="486a6-201"><xref:Microsoft.SqlServer.Replication.Publication.Name%2A>、 <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>、および <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>を指定します。</span><span class="sxs-lookup"><span data-stu-id="486a6-201">Specify <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>, <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>, and <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span></span>  
  
3.  <span data-ttu-id="486a6-202"><xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="486a6-202">Call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method.</span></span> <span data-ttu-id="486a6-203">このメソッドがを返す場合 `false` 、手順 2. で指定したプロパティが正しくないか、パブリケーションがサーバーに存在していません。</span><span class="sxs-lookup"><span data-stu-id="486a6-203">If this method returns `false`, either the properties specified in step 2 are incorrect or the publication does not exists on the server.</span></span>  
  
4.  <span data-ttu-id="486a6-204"><xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> プロパティと <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPush> のビットごとの論理積演算 (Visual C# では `&`、Visual Basic では `And`) を実行します。</span><span class="sxs-lookup"><span data-stu-id="486a6-204">Perform a bitwise logical AND (`&` in Visual C# and `And` in Visual Basic) between the <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> property and <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPush>.</span></span> <span data-ttu-id="486a6-205">結果が <xref:Microsoft.SqlServer.Replication.PublicationAttributes.None> の場合、<xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> と <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> のビットごとの論理和演算 (Visual C# では `|`、Visual Basic では `Or`) の結果を <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPush> に設定します。</span><span class="sxs-lookup"><span data-stu-id="486a6-205">If the result is <xref:Microsoft.SqlServer.Replication.PublicationAttributes.None>, set <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> to the result of a bitwise logical OR (`|` in Visual C# and `Or` in Visual Basic) between <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> and <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPush>.</span></span> <span data-ttu-id="486a6-206">次に、 <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A> を呼び出してプッシュ サブスクリプションを有効にします。</span><span class="sxs-lookup"><span data-stu-id="486a6-206">Then, call <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A> to enable push subscriptions.</span></span>  
  
5.  <span data-ttu-id="486a6-207">サブスクリプション データベースが存在しない場合は、 <xref:Microsoft.SqlServer.Management.Smo.Database> クラスを使用して作成します。</span><span class="sxs-lookup"><span data-stu-id="486a6-207">If the subscription database does not exist, create it by using the <xref:Microsoft.SqlServer.Management.Smo.Database> class.</span></span> <span data-ttu-id="486a6-208">詳細については、「[データベースの作成、変更、および削除](../server-management-objects-smo/tasks/creating-altering-and-removing-databases.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="486a6-208">For more information, see [Creating, Altering, and Removing Databases](../server-management-objects-smo/tasks/creating-altering-and-removing-databases.md).</span></span>  
  
6.  <span data-ttu-id="486a6-209"><xref:Microsoft.SqlServer.Replication.TransSubscription> クラスのインスタンスを作成します。</span><span class="sxs-lookup"><span data-stu-id="486a6-209">Create an instance of the <xref:Microsoft.SqlServer.Replication.TransSubscription> class.</span></span>  
  
7.  <span data-ttu-id="486a6-210">次のサブスクリプション プロパティを設定します。</span><span class="sxs-lookup"><span data-stu-id="486a6-210">Set the following subscription properties:</span></span>  
  
    -   <span data-ttu-id="486a6-211">手順 1. で作成した、パブリッシャーに対する <xref:Microsoft.SqlServer.Management.Common.ServerConnection> を <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>に指定します。</span><span class="sxs-lookup"><span data-stu-id="486a6-211">The <xref:Microsoft.SqlServer.Management.Common.ServerConnection> to the Publisher created in step 1 for <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span></span>  
  
    -   <span data-ttu-id="486a6-212">サブスクリプション データベース名を <xref:Microsoft.SqlServer.Replication.Subscription.SubscriptionDBName%2A>に指定します。</span><span class="sxs-lookup"><span data-stu-id="486a6-212">Name of the subscription database for <xref:Microsoft.SqlServer.Replication.Subscription.SubscriptionDBName%2A>.</span></span>  
  
    -   <span data-ttu-id="486a6-213">サブスクライバー名を <xref:Microsoft.SqlServer.Replication.Subscription.SubscriberName%2A>に指定します。</span><span class="sxs-lookup"><span data-stu-id="486a6-213">Name of the Subscriber for <xref:Microsoft.SqlServer.Replication.Subscription.SubscriberName%2A>.</span></span>  
  
    -   <span data-ttu-id="486a6-214">パブリケーション データベース名を <xref:Microsoft.SqlServer.Replication.Subscription.DatabaseName%2A>に指定します。</span><span class="sxs-lookup"><span data-stu-id="486a6-214">Name of the publication database for <xref:Microsoft.SqlServer.Replication.Subscription.DatabaseName%2A>.</span></span>  
  
    -   <span data-ttu-id="486a6-215">パブリケーション名を <xref:Microsoft.SqlServer.Replication.Subscription.PublicationName%2A>に指定します。</span><span class="sxs-lookup"><span data-stu-id="486a6-215">Name of the publication for <xref:Microsoft.SqlServer.Replication.Subscription.PublicationName%2A>.</span></span>  
  
    -   <span data-ttu-id="486a6-216"><xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> の <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> フィールドおよび <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.SecurePassword%2A> (または <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A>) フィールド。これにより、ディストリビューターでディストリビューション エージェントを実行するときに使用される [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows アカウントの資格情報が得られます。</span><span class="sxs-lookup"><span data-stu-id="486a6-216">The <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> and <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> or <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.SecurePassword%2A> fields of <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A> to provide the credentials for the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows account under which the Distribution Agent runs at the Distributor.</span></span> <span data-ttu-id="486a6-217">このアカウントは、ディストリビューターとのローカル接続を確立したり、Windows 認証を使用したリモート接続を確立するときに使用されます。</span><span class="sxs-lookup"><span data-stu-id="486a6-217">This account is used to make local connections to the Distributor and to make remote connections using Windows Authentication.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="486a6-218">サブスクリプションが `sysadmin` 固定サーバー ロールのメンバーにより作成される場合、<xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A> の設定は必須ではありませんが、推奨されます。</span><span class="sxs-lookup"><span data-stu-id="486a6-218">Setting <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A> is not required when the subscription is created by a member of the `sysadmin` fixed server role, however it is recommended.</span></span> <span data-ttu-id="486a6-219">この場合、エージェントは SQL Server エージェントのアカウントを借用します。</span><span class="sxs-lookup"><span data-stu-id="486a6-219">In this case, the agent will impersonate the SQL Server Agent account.</span></span> <span data-ttu-id="486a6-220">詳細については、「 [レプリケーション エージェント セキュリティ モデル](security/replication-agent-security-model.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="486a6-220">For more information, see [Replication Agent Security Model](security/replication-agent-security-model.md).</span></span>  
  
    -   <span data-ttu-id="486a6-221">(省略可) サブスクリプションを同期するために使用されるエージェント ジョブを作成する場合は、<xref:Microsoft.SqlServer.Replication.Subscription.CreateSyncAgentByDefault%2A> に `true` (既定値) を指定します。</span><span class="sxs-lookup"><span data-stu-id="486a6-221">(Optional) A value of `true` (the default) for <xref:Microsoft.SqlServer.Replication.Subscription.CreateSyncAgentByDefault%2A> to create an agent job that is used to synchronize the subscription.</span></span> <span data-ttu-id="486a6-222">`false` を指定した場合、サブスクリプションはプログラムでのみ同期が可能になります。</span><span class="sxs-lookup"><span data-stu-id="486a6-222">If you specify `false`, the subscription can only be synchronized programmatically.</span></span>  
  
    -   <span data-ttu-id="486a6-223">(省略可) SQL Server 認証を使用してサブスクライバーに接続する場合、 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> の <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> フィールドおよび <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> (または <xref:Microsoft.SqlServer.Replication.Subscription.SubscriberSecurity%2A> ) フィールドを設定します。</span><span class="sxs-lookup"><span data-stu-id="486a6-223">(Optional) Set the <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> and <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> or <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> fields of <xref:Microsoft.SqlServer.Replication.Subscription.SubscriberSecurity%2A> when using SQL Server Authentication to connect to the Subscriber.</span></span>  
  
8.  <span data-ttu-id="486a6-224"><xref:Microsoft.SqlServer.Replication.Subscription.Create%2A> メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="486a6-224">Call the <xref:Microsoft.SqlServer.Replication.Subscription.Create%2A> method.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="486a6-225">リモート ディストリビューターを使用するパブリッシャー側でプッシュ サブスクリプションを作成する場合は、 <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A>を含むすべてのプロパティに指定された値がディストリビューターにプレーン テキストとして送信されます。</span><span class="sxs-lookup"><span data-stu-id="486a6-225">When creating a push subscription at a Publisher with a remote Distributor, the values supplied for all properties, including <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A>, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="486a6-226"><xref:Microsoft.SqlServer.Replication.Subscription.Create%2A> メソッドを呼び出す前に、パブリッシャーとリモート ディストリビューター間の接続を暗号化する必要があります。</span><span class="sxs-lookup"><span data-stu-id="486a6-226">You should encrypt the connection between the Publisher and its remote Distributor before calling the <xref:Microsoft.SqlServer.Replication.Subscription.Create%2A> method.</span></span> <span data-ttu-id="486a6-227">詳細については、「[データベース エンジンへの暗号化接続の有効化 &#40;SQL Server 構成マネージャー&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="486a6-227">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
#### <a name="to-create-a-push-subscription-to-a-merge-publication"></a><span data-ttu-id="486a6-228">マージ パブリケーションに対するプッシュ サブスクリプションを作成するには</span><span class="sxs-lookup"><span data-stu-id="486a6-228">To create a push subscription to a merge publication</span></span>  
  
1.  <span data-ttu-id="486a6-229"><xref:Microsoft.SqlServer.Management.Common.ServerConnection> クラスを使用して、パブリッシャーへの接続を作成します。</span><span class="sxs-lookup"><span data-stu-id="486a6-229">Create a connection to the Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="486a6-230">手順 1. のパブリッシャー接続を使用して、 <xref:Microsoft.SqlServer.Replication.MergePublication> クラスのインスタンスを作成します。</span><span class="sxs-lookup"><span data-stu-id="486a6-230">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class by using the Publisher connection from step 1.</span></span> <span data-ttu-id="486a6-231"><xref:Microsoft.SqlServer.Replication.Publication.Name%2A>、 <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>、および <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>を指定します。</span><span class="sxs-lookup"><span data-stu-id="486a6-231">Specify <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>, <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>, and <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span></span>  
  
3.  <span data-ttu-id="486a6-232"><xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="486a6-232">Call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method.</span></span> <span data-ttu-id="486a6-233">このメソッドがを返す場合 `false` 、手順 2. で指定したプロパティが正しくないか、パブリケーションがサーバーに存在していません。</span><span class="sxs-lookup"><span data-stu-id="486a6-233">If this method returns `false`, either the properties specified in step 2 are incorrect or the publication does not exists on the server.</span></span>  
  
4.  <span data-ttu-id="486a6-234"><xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> プロパティと <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPush> のビットごとの論理積演算 (Visual C# では `&`、Visual Basic では `And`) を実行します。</span><span class="sxs-lookup"><span data-stu-id="486a6-234">Perform a bitwise logical AND (`&` in Visual C# and `And` in Visual Basic) between the <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> property and <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPush>.</span></span> <span data-ttu-id="486a6-235">結果が <xref:Microsoft.SqlServer.Replication.PublicationAttributes.None> の場合、<xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> と <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> のビットごとの論理和演算 (Visual C# では `|`、Visual Basic では `Or`) の結果を <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPush> に設定します。</span><span class="sxs-lookup"><span data-stu-id="486a6-235">If the result is <xref:Microsoft.SqlServer.Replication.PublicationAttributes.None>, set <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> to the result of a bitwise logical OR (`|` in Visual C# and `Or` in Visual Basic) between <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> and <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPush>.</span></span> <span data-ttu-id="486a6-236">次に、 <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A> を呼び出してプッシュ サブスクリプションを有効にします。</span><span class="sxs-lookup"><span data-stu-id="486a6-236">Then, call <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A> to enable push subscriptions.</span></span>  
  
5.  <span data-ttu-id="486a6-237">サブスクリプション データベースが存在しない場合は、 <xref:Microsoft.SqlServer.Management.Smo.Database> クラスを使用して作成します。</span><span class="sxs-lookup"><span data-stu-id="486a6-237">If the subscription database does not exist, create it by using the <xref:Microsoft.SqlServer.Management.Smo.Database> class.</span></span> <span data-ttu-id="486a6-238">詳細については、「[データベースの作成、変更、および削除](../server-management-objects-smo/tasks/creating-altering-and-removing-databases.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="486a6-238">For more information, see [Creating, Altering, and Removing Databases](../server-management-objects-smo/tasks/creating-altering-and-removing-databases.md).</span></span>  
  
6.  <span data-ttu-id="486a6-239"><xref:Microsoft.SqlServer.Replication.MergeSubscription> クラスのインスタンスを作成します。</span><span class="sxs-lookup"><span data-stu-id="486a6-239">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergeSubscription> class.</span></span>  
  
7.  <span data-ttu-id="486a6-240">次のサブスクリプション プロパティを設定します。</span><span class="sxs-lookup"><span data-stu-id="486a6-240">Set the following subscription properties:</span></span>  
  
    -   <span data-ttu-id="486a6-241">手順 1. で作成した、パブリッシャーに対する <xref:Microsoft.SqlServer.Management.Common.ServerConnection> を <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>に指定します。</span><span class="sxs-lookup"><span data-stu-id="486a6-241">The <xref:Microsoft.SqlServer.Management.Common.ServerConnection> to the Publisher created in step 1 for <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span></span>  
  
    -   <span data-ttu-id="486a6-242">サブスクリプション データベース名を <xref:Microsoft.SqlServer.Replication.Subscription.SubscriptionDBName%2A>に指定します。</span><span class="sxs-lookup"><span data-stu-id="486a6-242">Name of the subscription database for <xref:Microsoft.SqlServer.Replication.Subscription.SubscriptionDBName%2A>.</span></span>  
  
    -   <span data-ttu-id="486a6-243">サブスクライバー名を <xref:Microsoft.SqlServer.Replication.Subscription.SubscriberName%2A>に指定します。</span><span class="sxs-lookup"><span data-stu-id="486a6-243">Name of the Subscriber for <xref:Microsoft.SqlServer.Replication.Subscription.SubscriberName%2A>.</span></span>  
  
    -   <span data-ttu-id="486a6-244">パブリケーション データベース名を <xref:Microsoft.SqlServer.Replication.Subscription.DatabaseName%2A>に指定します。</span><span class="sxs-lookup"><span data-stu-id="486a6-244">Name of the publication database for <xref:Microsoft.SqlServer.Replication.Subscription.DatabaseName%2A>.</span></span>  
  
    -   <span data-ttu-id="486a6-245">パブリケーション名を <xref:Microsoft.SqlServer.Replication.Subscription.PublicationName%2A>に指定します。</span><span class="sxs-lookup"><span data-stu-id="486a6-245">Name of the publication for <xref:Microsoft.SqlServer.Replication.Subscription.PublicationName%2A>.</span></span>  
  
    -   <span data-ttu-id="486a6-246"><xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> の <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> フィールドおよび <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.SecurePassword%2A> (または <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A>) フィールド。これにより、ディストリビューターでマージ エージェントを実行するときに使用される [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows アカウントの資格情報が得られます。</span><span class="sxs-lookup"><span data-stu-id="486a6-246">The <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> and <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> or <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.SecurePassword%2A> fields of <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A> to provide the credentials for the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows account under which the Merge Agent runs at the Distributor.</span></span> <span data-ttu-id="486a6-247">このアカウントは、ディストリビューターとのローカル接続を確立したり、Windows 認証を使用したリモート接続を確立するときに使用されます。</span><span class="sxs-lookup"><span data-stu-id="486a6-247">This account is used to make local connections to the Distributor and to make remote connections using Windows Authentication.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="486a6-248">サブスクリプションが `sysadmin` 固定サーバー ロールのメンバーにより作成される場合、<xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A> の設定は必須ではありませんが、推奨されます。</span><span class="sxs-lookup"><span data-stu-id="486a6-248">Setting <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A> is not required when the subscription is created by a member of the `sysadmin` fixed server role, however it is recommended.</span></span> <span data-ttu-id="486a6-249">この場合、エージェントは SQL Server エージェントのアカウントを借用します。</span><span class="sxs-lookup"><span data-stu-id="486a6-249">In this case, the agent will impersonate the SQL Server Agent account.</span></span> <span data-ttu-id="486a6-250">詳細については、「 [レプリケーション エージェント セキュリティ モデル](security/replication-agent-security-model.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="486a6-250">For more information, see [Replication Agent Security Model](security/replication-agent-security-model.md).</span></span>  
  
    -   <span data-ttu-id="486a6-251">(省略可) サブスクリプションを同期するために使用されるエージェント ジョブを作成する場合は、<xref:Microsoft.SqlServer.Replication.Subscription.CreateSyncAgentByDefault%2A> に `true` (既定値) を指定します。</span><span class="sxs-lookup"><span data-stu-id="486a6-251">(Optional) A value of `true` (the default) for <xref:Microsoft.SqlServer.Replication.Subscription.CreateSyncAgentByDefault%2A> to create an agent job that is used to synchronize the subscription.</span></span> <span data-ttu-id="486a6-252">`false` を指定した場合、サブスクリプションはプログラムでのみ同期が可能になります。</span><span class="sxs-lookup"><span data-stu-id="486a6-252">If you specify `false`, the subscription can only be synchronized programmatically.</span></span>  
  
    -   <span data-ttu-id="486a6-253">(省略可) SQL Server 認証を使用してサブスクライバーに接続する場合、 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> の <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> フィールドおよび <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> (または <xref:Microsoft.SqlServer.Replication.Subscription.SubscriberSecurity%2A> ) フィールドを設定します。</span><span class="sxs-lookup"><span data-stu-id="486a6-253">(Optional) Set the <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> and <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> or <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> fields of <xref:Microsoft.SqlServer.Replication.Subscription.SubscriberSecurity%2A> when using SQL Server Authentication to connect to the Subscriber.</span></span>  
  
    -   <span data-ttu-id="486a6-254">(省略可) SQL Server 認証を使用してパブリッシャーに接続する場合、 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> の <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> フィールドおよび <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> (または <xref:Microsoft.SqlServer.Replication.PullSubscription.PublisherSecurity%2A> ) フィールドを設定します。</span><span class="sxs-lookup"><span data-stu-id="486a6-254">(Optional) Set the <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> and <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> or <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> fields of <xref:Microsoft.SqlServer.Replication.PullSubscription.PublisherSecurity%2A> when using SQL Server Authentication to connect to the Publisher.</span></span>  
  
8.  <span data-ttu-id="486a6-255"><xref:Microsoft.SqlServer.Replication.Subscription.Create%2A> メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="486a6-255">Call the <xref:Microsoft.SqlServer.Replication.Subscription.Create%2A> method.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="486a6-256">リモート ディストリビューターを使用するパブリッシャー側でプッシュ サブスクリプションを作成する場合は、 <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A>を含むすべてのプロパティに指定された値がディストリビューターにプレーン テキストとして送信されます。</span><span class="sxs-lookup"><span data-stu-id="486a6-256">When creating a push subscription at a Publisher with a remote Distributor, the values supplied for all properties, including <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A>, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="486a6-257"><xref:Microsoft.SqlServer.Replication.Subscription.Create%2A> メソッドを呼び出す前に、パブリッシャーとリモート ディストリビューター間の接続を暗号化する必要があります。</span><span class="sxs-lookup"><span data-stu-id="486a6-257">You should encrypt the connection between the Publisher and its remote Distributor before calling the <xref:Microsoft.SqlServer.Replication.Subscription.Create%2A> method.</span></span> <span data-ttu-id="486a6-258">詳細については、「[データベース エンジンへの暗号化接続の有効化 &#40;SQL Server 構成マネージャー&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="486a6-258">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
###  <a name="examples-rmo"></a><a name="PShellExample"></a> <span data-ttu-id="486a6-259">例 (RMO)</span><span class="sxs-lookup"><span data-stu-id="486a6-259">Examples (RMO)</span></span>  
 <span data-ttu-id="486a6-260">次の例では、トランザクション パブリケーションに対する新しいプッシュ サブスクリプションを作成します。</span><span class="sxs-lookup"><span data-stu-id="486a6-260">This example creates a new push subscription to a transactional publication.</span></span> <span data-ttu-id="486a6-261">ディストリビューション エージェント ジョブを実行するために使用される Windows アカウントの資格情報は、実行時に渡されます。</span><span class="sxs-lookup"><span data-stu-id="486a6-261">The Windows account credentials you use to run the Distribution Agent job are passed at runtime.</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateTranPushSub](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createtranpushsub)]  
  
 [!code-vb[HowTo#rmo_vb_CreateTranPushSub](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createtranpushsub)]  
  
 <span data-ttu-id="486a6-262">次の例では、マージ パブリケーションに対する新しいプッシュ サブスクリプションを作成します。</span><span class="sxs-lookup"><span data-stu-id="486a6-262">This example creates a new push subscription to a merge publication.</span></span> <span data-ttu-id="486a6-263">マージ エージェント ジョブを実行するために使用される Windows アカウントの資格情報は、実行時に渡されます。</span><span class="sxs-lookup"><span data-stu-id="486a6-263">The Windows account credentials you use to run the Merge Agent job are passed at runtime.</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateMergePushSub](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createmergepushsub)]  
  
 [!code-vb[HowTo#rmo_vb_CreateMergePushSub](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createmergepushsub)]  
  
## <a name="see-also"></a><span data-ttu-id="486a6-264">参照</span><span class="sxs-lookup"><span data-stu-id="486a6-264">See Also</span></span>  
 <span data-ttu-id="486a6-265">[プッシュ サブスクリプションのプロパティの表示または変更](view-and-modify-push-subscription-properties.md) </span><span class="sxs-lookup"><span data-stu-id="486a6-265">[View and Modify Push Subscription Properties](view-and-modify-push-subscription-properties.md) </span></span>  
 <span data-ttu-id="486a6-266">[Replication Security Best Practices](security/replication-security-best-practices.md) </span><span class="sxs-lookup"><span data-stu-id="486a6-266">[Replication Security Best Practices](security/replication-security-best-practices.md) </span></span>  
 <span data-ttu-id="486a6-267">[Create a Publication](publish/create-a-publication.md) </span><span class="sxs-lookup"><span data-stu-id="486a6-267">[Create a Publication](publish/create-a-publication.md) </span></span>  
 <span data-ttu-id="486a6-268">[Replication Management Objects Concepts](concepts/replication-management-objects-concepts.md) </span><span class="sxs-lookup"><span data-stu-id="486a6-268">[Replication Management Objects Concepts](concepts/replication-management-objects-concepts.md) </span></span>  
 <span data-ttu-id="486a6-269">[プッシュ サブスクリプションの同期](synchronize-a-push-subscription.md) </span><span class="sxs-lookup"><span data-stu-id="486a6-269">[Synchronize a Push Subscription](synchronize-a-push-subscription.md) </span></span>  
 <span data-ttu-id="486a6-270">[Subscribe to Publications](subscribe-to-publications.md) </span><span class="sxs-lookup"><span data-stu-id="486a6-270">[Subscribe to Publications](subscribe-to-publications.md) </span></span>  
 [<span data-ttu-id="486a6-271">sqlcmd でのスクリプト変数の使用</span><span class="sxs-lookup"><span data-stu-id="486a6-271">Use sqlcmd with Scripting Variables</span></span>](../scripting/sqlcmd-use-with-scripting-variables.md)  
  
  
