---
title: パラメーター化された行フィルター | Microsoft Docs
ms.custom: ''
ms.date: 06/02/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- publications [SQL Server replication], dynamic filters
- merge replication [SQL Server replication], dynamic filters
- parameterized filters [SQL Server replication]
- filters [SQL Server replication], dynamic
- merge replication parameterized filters [SQL Server replication]
- publications [SQL Server replication], parameterized filters
- parameterized filters [SQL Server replication], about parameterized filters
- filters [SQL Server replication], parameterized
- dynamic filters [SQL Server replication]
ms.assetid: b48a6825-068f-47c8-afdc-c83540da4639
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: a293d5dfc6bfbdf66afb680f0604117e2cc02b2d
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87631828"
---
# <a name="parameterized-row-filters"></a><span data-ttu-id="429ee-102">Parameterized Row Filters</span><span class="sxs-lookup"><span data-stu-id="429ee-102">Parameterized Row Filters</span></span>
  <span data-ttu-id="429ee-103">パラメーター化された行フィルターを使用すると、複数のパブリケーションを作成しなくても、パーティションの異なるデータを各サブスクライバーに送信できます (以前のバージョンの [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]では、パラメーター化されたフィルターは動的フィルターと呼ばれていました)。</span><span class="sxs-lookup"><span data-stu-id="429ee-103">Parameterized row filters allow different partitions of data to be sent to different Subscribers without requiring multiple publications to be created (parameterized filters were referred to as dynamic filters in previous versions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]).</span></span> <span data-ttu-id="429ee-104">パーティションとは、テーブル内の行のサブセットのことです。パラメーター化された行フィルターの作成時に選択した設定に基づき、パブリッシュされたテーブルの各行は、1 つのパーティションのみに属するか (重複しないパーティションが作成されます)、2 つ以上のパーティションに属します (重複するパーティションが作成されます)。</span><span class="sxs-lookup"><span data-stu-id="429ee-104">A partition is a subset of the rows in a table; depending on the settings chosen when creating a parameterized row filter, each row in a published table can belong to one partition only (which produces nonoverlapping partitions) or to two or more partitions (which produces overlapping partitions).</span></span>  
  
 <span data-ttu-id="429ee-105">重複しないパーティションは、サブスクリプション間で共有するか、または 1 つのサブスクリプションのみが特定のパーティションを受け取るように制限することができます。</span><span class="sxs-lookup"><span data-stu-id="429ee-105">Nonoverlapping partitions can be shared among subscriptions or they can be restricted so that only one subscription receives a given partition.</span></span> <span data-ttu-id="429ee-106">パーティションの動作を制御する設定については、このトピックの「適切なフィルター選択オプションの使用」で説明します。</span><span class="sxs-lookup"><span data-stu-id="429ee-106">The settings that control partition behavior are described in "Using the Appropriate Filtering Options" later in this topic.</span></span> <span data-ttu-id="429ee-107">これらの設定を使用すると、アプリケーションおよびパフォーマンスの要件に応じて、パラメーター化されたフィルター選択を調整できます。</span><span class="sxs-lookup"><span data-stu-id="429ee-107">Using these settings you can tailor parameterized filtering according to application and performance requirements.</span></span> <span data-ttu-id="429ee-108">一般に、重複するパーティションを使用すると柔軟性が向上し、重複しないパーティションを単一のサブスクリプションにレプリケートするとパフォーマンスが向上します。</span><span class="sxs-lookup"><span data-stu-id="429ee-108">In general, overlapping partitions allow for greater flexibility, and nonoverlapping partitions replicated to a single subscription provide better performance.</span></span>  
  
 <span data-ttu-id="429ee-109">パラメーター化されたフィルターは単一のテーブルで使用し、通常は関連するテーブルに対するフィルター選択を拡張するために結合フィルターと組み合わせて使用します。</span><span class="sxs-lookup"><span data-stu-id="429ee-109">Parameterized filters are used on a single table and are typically combined with join filters to extend filtering to related tables.</span></span> <span data-ttu-id="429ee-110">詳しくは、「 [Join Filters](join-filters.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="429ee-110">For more information, see [Join Filters](join-filters.md).</span></span>  
  
 <span data-ttu-id="429ee-111">パラメーター化された行フィルターを定義または変更するには、「 [マージ アーティクルのパラメーター化された行フィルターの定義および変更](../publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="429ee-111">To define or modify a parameterized row filter, see [Define and Modify a Parameterized Row Filter for a Merge Article](../publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span></span>  
  
## <a name="how-parameterized-filters-work"></a><span data-ttu-id="429ee-112">パラメーター化されたフィルターの動作</span><span class="sxs-lookup"><span data-stu-id="429ee-112">How Parameterized Filters Work</span></span>  
 <span data-ttu-id="429ee-113">パラメーター化された行フィルターでは、WHERE 句を使用して、パブリッシュする適切なデータを選択します。</span><span class="sxs-lookup"><span data-stu-id="429ee-113">A parameterized row filter uses a WHERE clause to select the appropriate data to be published.</span></span> <span data-ttu-id="429ee-114">静的行フィルターのようにこの句でリテラル値を指定するのではなく、システム関数 SUSER_SNAME() および HOST_NAME() のいずれかまたは両方を指定します。</span><span class="sxs-lookup"><span data-stu-id="429ee-114">Rather than specifying a literal value in the clause (as you do with a static row filter), you specify one or both of the following system functions: SUSER_SNAME() and HOST_NAME().</span></span> <span data-ttu-id="429ee-115">ユーザー定義関数も使用できますが、その場合はユーザー定義関数の本体に SUSER_SNAME() または HOST_NAME() を含めるか、または `MyUDF(SUSER_SNAME()`のように、ユーザー定義関数でこれらのシステム関数のいずれかを評価する必要があります。</span><span class="sxs-lookup"><span data-stu-id="429ee-115">User-defined functions can also be used, but they must include SUSER_SNAME() or HOST_NAME() in the body of the function, or evaluate one of these system functions (such as `MyUDF(SUSER_SNAME()`).</span></span> <span data-ttu-id="429ee-116">ユーザー定義関数の本体に SUSER_SNAME() または HOST_NAME() を含める場合、その関数にパラメーターを渡すことはできません。</span><span class="sxs-lookup"><span data-stu-id="429ee-116">If a user-defined function includes SUSER_SNAME() or HOST_NAME() in the body of the function, you cannot pass parameters to the function.</span></span>  
  
 <span data-ttu-id="429ee-117">システム関数 SUSER_SNAME() および HOST_NAME() は、マージ レプリケーションに固有のものではありませんが、パラメーター化されたフィルター選択のためにマージ レプリケーションで使用されます。</span><span class="sxs-lookup"><span data-stu-id="429ee-117">The system functions SUSER_SNAME() and HOST_NAME() are not specific to merge replication, but they are used by merge replication for parameterized filtering:</span></span>  
  
-   <span data-ttu-id="429ee-118">SUSER_SNAME() は、 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]のインスタンスに対する接続のログイン情報を返します。</span><span class="sxs-lookup"><span data-stu-id="429ee-118">SUSER_SNAME() returns login information for connections made to an instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="429ee-119">この関数をパラメーター化されたフィルターで使用した場合、マージ エージェントがパブリッシャーに接続するために使用するログインが返されます (ログインはサブスクリプションを作成するときに指定します)。</span><span class="sxs-lookup"><span data-stu-id="429ee-119">When used in a parameterized filter, it returns the login used by the Merge Agent to connect to the Publisher (you specify a login when you create a subscription).</span></span>  
  
-   <span data-ttu-id="429ee-120">HOST_NAME() は、 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]のインスタンスに接続しているコンピューターの名前を返します。</span><span class="sxs-lookup"><span data-stu-id="429ee-120">HOST_NAME() returns the name of the computer that is connecting to an instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="429ee-121">この関数をパラメーター化されたフィルターで使用した場合、既定では、マージ エージェントが実行されているコンピューターの名前が返されます。</span><span class="sxs-lookup"><span data-stu-id="429ee-121">When used in a parameterized filter, by default it returns the name of the computer on which the Merge Agent is running.</span></span> <span data-ttu-id="429ee-122">プル サブスクリプションの場合はサブスクライバーの名前になり、プッシュ サブスクリプションの場合はディストリビューターの名前になります。</span><span class="sxs-lookup"><span data-stu-id="429ee-122">For pull subscriptions it is the name of the Subscriber; for push subscriptions it is the name of the Distributor.</span></span>  
  
     <span data-ttu-id="429ee-123">サブスクライバーまたはディストリビューターの名前以外の値で、この関数をオーバーライドすることも可能です。</span><span class="sxs-lookup"><span data-stu-id="429ee-123">It is also possible to override this function with a value other than the name of the Subscriber or Distributor.</span></span> <span data-ttu-id="429ee-124">通常、アプリケーションでは、販売員の名前や ID など、より具体的な意味のある値でこの関数をオーバーライドします。</span><span class="sxs-lookup"><span data-stu-id="429ee-124">Typically applications override this function with more meaningful values, such as a salesperson name or salesperson ID.</span></span> <span data-ttu-id="429ee-125">詳細については、このトピックの「HOST_NAME() 値のオーバーライド」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="429ee-125">For more information, see the section "Overriding the HOST_NAME() Value" in this topic.</span></span>  
  
 <span data-ttu-id="429ee-126">システム関数によって返された値は、フィルター選択しているテーブルで指定した列と比較され、適切なデータがサブスクライバーにダウンロードされます。</span><span class="sxs-lookup"><span data-stu-id="429ee-126">The value returned by the system function is compared to a column you specify in the table you are filtering, and the appropriate data is downloaded to the Subscriber.</span></span> <span data-ttu-id="429ee-127">この比較は、サブスクリプションが初期化されたときに実行され (これにより初期スナップショットには適切なデータのみが含まれます)、またサブスクリプションが同期されるたびに実行されます。</span><span class="sxs-lookup"><span data-stu-id="429ee-127">This comparison is made when the subscription is initialized (so only the appropriate data is contained in the initial snapshot) and every time the subscription is synchronized.</span></span> <span data-ttu-id="429ee-128">既定では、パブリッシャーでの変更によってパーティションから行が移動された場合、その行はサブスクライバーで削除されます (この動作は、 **@allow_partition_realignment** [Sp_addmergepublication &#40;transact-sql&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql)のパラメーターを使用して制御されます)。</span><span class="sxs-lookup"><span data-stu-id="429ee-128">By default, if a change at the Publisher results in a row being moved out of a partition, the row is deleted at the Subscriber (this behavior is controlled using the **@allow_partition_realignment** parameter of [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql)).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="429ee-129">パラメーター化されたフィルターの比較が実行されるときは、常にデータベース照合順序が使用されます。</span><span class="sxs-lookup"><span data-stu-id="429ee-129">When comparisons are made for parameterized filters, the database collation is always used.</span></span> <span data-ttu-id="429ee-130">たとえば、データベース照合順序で大文字と小文字が区別されず、テーブルまたは列の照合順序で大文字と小文字が区別される場合、比較では大文字と小文字は区別されません。</span><span class="sxs-lookup"><span data-stu-id="429ee-130">For example, if the database collation is case insensitive, but the table or column collation is case sensitive, the comparison will be case insensitive.</span></span>  
  
### <a name="filtering-with-suser_sname"></a><span data-ttu-id="429ee-131">SUSER_SNAME() によるフィルター選択</span><span class="sxs-lookup"><span data-stu-id="429ee-131">Filtering with SUSER_SNAME()</span></span>  
 <span data-ttu-id="429ee-132">**サンプル データベースの** Employee テーブル [!INCLUDE[ssSampleDBCoShort](../../../includes/sssampledbcoshort-md.md)] について考えてみます。</span><span class="sxs-lookup"><span data-stu-id="429ee-132">Consider the **Employee Table** in the [!INCLUDE[ssSampleDBCoShort](../../../includes/sssampledbcoshort-md.md)] sample database.</span></span> <span data-ttu-id="429ee-133">このテーブルには **LoginID**列が含まれており、この列には各従業員のログインが '*domain\login*' という形式で格納されています。</span><span class="sxs-lookup"><span data-stu-id="429ee-133">This table includes the column **LoginID**, which contains the login for each employee in the form '*domain\login*'.</span></span> <span data-ttu-id="429ee-134">このテーブルにフィルターを適用して、従業員が各自に関連するデータのみを受け取れるようにするには、フィルター句を次のように指定します。</span><span class="sxs-lookup"><span data-stu-id="429ee-134">To filter this table so that employees receive only the data related to them, specify a filter clause of:</span></span>  
  
```  
LoginID = SUSER_SNAME()  
```  
  
 <span data-ttu-id="429ee-135">たとえば、ある従業員の値が 'adventure-works\john5' であるとします。</span><span class="sxs-lookup"><span data-stu-id="429ee-135">For example, the value for one of the employees is 'adventure-works\john5'.</span></span> <span data-ttu-id="429ee-136">マージ エージェントはパブリッシャーに接続するときに、サブスクリプションの作成時に指定されたログインを使用します (この場合は 'adventure-works\john5')。</span><span class="sxs-lookup"><span data-stu-id="429ee-136">When the Merge Agent connects to the Publisher, it uses the login you specified when creating the subscription (in this case 'adventure-works\john5').</span></span> <span data-ttu-id="429ee-137">次に、マージ エージェントは SUSER_SNAME() によって返された値をこのテーブル内の値と比較し、 **LoginID** 列に 'adventure-works\john5' という値が格納された行のみをダウンロードします。</span><span class="sxs-lookup"><span data-stu-id="429ee-137">The Merge Agent then compares the value returned by SUSER_SNAME() to the values in the table and downloads only the row that contains a value of 'adventure-works\john5' in the **LoginID** column.</span></span>  
  
### <a name="filtering-with-host_name"></a><span data-ttu-id="429ee-138">HOST_NAME() によるフィルター選択</span><span class="sxs-lookup"><span data-stu-id="429ee-138">Filtering with HOST_NAME()</span></span>  
 <span data-ttu-id="429ee-139">**HumanResources.Employee** テーブルについて考えてみます。</span><span class="sxs-lookup"><span data-stu-id="429ee-139">Consider the **HumanResources.Employee** table.</span></span> <span data-ttu-id="429ee-140">このテーブルに、 **ComputerName** という列が含まれており、この列に各従業員のコンピューターの名前が '*name_computertype*' という形式で格納されているとします。</span><span class="sxs-lookup"><span data-stu-id="429ee-140">Suppose this table contained a column such as **ComputerName** with the name of each employee's computer in the form '*name_computertype*'.</span></span> <span data-ttu-id="429ee-141">このテーブルにフィルターを適用して、従業員が各自に関連するデータのみを受け取れるようにするには、フィルター句を次のように指定します。</span><span class="sxs-lookup"><span data-stu-id="429ee-141">To filter this table so that employees receive only the data related to them, specify a filter clause of:</span></span>  
  
```  
ComputerName = HOST_NAME()  
```  
  
 <span data-ttu-id="429ee-142">たとえば、ある従業員の値が 'john5_laptop' であるとします。</span><span class="sxs-lookup"><span data-stu-id="429ee-142">For example, the value for one of the employees could be 'john5_laptop'.</span></span> <span data-ttu-id="429ee-143">マージ エージェントはパブリッシャーに接続すると、HOST_NAME() によって返された値をこのテーブル内の値と比較し、 **ComputerName** 列に 'john5_laptop' という値が格納された行のみをダウンロードします。</span><span class="sxs-lookup"><span data-stu-id="429ee-143">When the Merge Agent connects to the Publisher, it compares the value returned by HOST_NAME() to the values in the table and downloads only the row that contains a value of 'john5_laptop' in the **ComputerName** column.</span></span>  
  
 <span data-ttu-id="429ee-144">フィルターでは関数を組み合わせて使用することもできます。</span><span class="sxs-lookup"><span data-stu-id="429ee-144">It is also possible to combine the functions in a filter.</span></span> <span data-ttu-id="429ee-145">たとえば、従業員が自分のコンピューターで自分のログインを使用している場合にのみデータを受け取れるようにするには、フィルター句を次のように指定します。</span><span class="sxs-lookup"><span data-stu-id="429ee-145">For example, if you wanted to ensure that an employee received data only if they used their login on their computer, the filter clause could be:</span></span>  
  
```  
LoginID = SUSER_SNAME() AND ComputerName = HOST_NAME()  
```  
  
 <span data-ttu-id="429ee-146">HOST_NAME() の値をオーバーライドしている場合を除き、HOST_NAME() によるフィルター選択は、通常はプル サブスクリプションでのみ使用します。</span><span class="sxs-lookup"><span data-stu-id="429ee-146">Unless you are overriding the HOST_NAME() value, filtering with HOST_NAME() is typically used only with pull subscriptions.</span></span> <span data-ttu-id="429ee-147">この関数によって返される値は、マージ エージェントが実行されているコンピューターの名前です。</span><span class="sxs-lookup"><span data-stu-id="429ee-147">The value returned by the function is the name of the computer on which the Merge Agent is running.</span></span> <span data-ttu-id="429ee-148">この値は、プル サブスクリプションの場合は各サブスクリプションによって異なりますが、プッシュ サブスクリプションの場合は同じです (プッシュ サブスクリプションの場合、すべてのマージ エージェントがディストリビューターで実行されます)。</span><span class="sxs-lookup"><span data-stu-id="429ee-148">For pull subscriptions, the value is different for each subscription, but for push subscriptions, the value is the same (all Merge Agents run at the Distributor for push subscriptions).</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="429ee-149">HOST_NAME() 関数の値はオーバーライドされている場合があります。したがって、HOST_NAME() を含むフィルターを使用してデータのパーティションへのアクセスを制御することはできません。</span><span class="sxs-lookup"><span data-stu-id="429ee-149">The value for the HOST_NAME() function can be overridden; therefore it is not possible to use filters that include HOST_NAME() to control access to partitions of data.</span></span> <span data-ttu-id="429ee-150">データのパーティションへのアクセスを制御するには、SUSER_SNAME()、SUSER_SNAME() と HOST_NAME() の組み合わせ、または静的行フィルターを使用します。</span><span class="sxs-lookup"><span data-stu-id="429ee-150">To control access to partitions of data, use SUSER_SNAME(), SUSER_SNAME() in combination with HOST_NAME(), or use static row filters.</span></span>  
  
#### <a name="overriding-the-host_name-value"></a><span data-ttu-id="429ee-151">HOST_NAME() 値のオーバーライド</span><span class="sxs-lookup"><span data-stu-id="429ee-151">Overriding the HOST_NAME() Value</span></span>  
 <span data-ttu-id="429ee-152">既に述べたとおり、HOST_NAME() は、既定では [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]のインスタンスに接続しているコンピューターの名前を返します。</span><span class="sxs-lookup"><span data-stu-id="429ee-152">As noted earlier, HOST_NAME() by default returns the name of the computer that is connecting to an instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="429ee-153">パラメーター化されたフィルターを使用する場合、サブスクリプションの作成時に値を指定することによって、この値をオーバーライドすることがよくあります。</span><span class="sxs-lookup"><span data-stu-id="429ee-153">When using parameterized filters, it is common to override this value by supplying a value when you create a subscription.</span></span> <span data-ttu-id="429ee-154">これにより、HOST_NAME() 関数は、コンピューターの名前ではなく、指定された値を返します。</span><span class="sxs-lookup"><span data-stu-id="429ee-154">The HOST_NAME() function then returns the value you specify rather than the name of the computer.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="429ee-155">HOST_NAME() をオーバーライドした場合、HOST_NAME() 関数のすべての呼び出しは、指定された値を返します。</span><span class="sxs-lookup"><span data-stu-id="429ee-155">If you override HOST_NAME(), all calls to the HOST_NAME() function will return the value you specify.</span></span> <span data-ttu-id="429ee-156">他のアプリケーションが、コンピューター名を返す HOST_NAME() 関数に依存していないことを確認してください。</span><span class="sxs-lookup"><span data-stu-id="429ee-156">Ensure that other applications are not depending on HOST_NAME() returning the computer name.</span></span>  
  
 <span data-ttu-id="429ee-157">**HumanResources.Employee** テーブルについて考えてみます。</span><span class="sxs-lookup"><span data-stu-id="429ee-157">Consider the **HumanResources.Employee** table.</span></span> <span data-ttu-id="429ee-158">このテーブルには **EmployeeID**という列があります。</span><span class="sxs-lookup"><span data-stu-id="429ee-158">This table includes the column **EmployeeID**.</span></span> <span data-ttu-id="429ee-159">このテーブルにフィルターを適用して各従業員が関連データのみを受け取れるようにするには、フィルター句を次のように指定します。</span><span class="sxs-lookup"><span data-stu-id="429ee-159">To filter this table so that each employee receives only the data related to them, specify a filter clause of:</span></span>  
  
 `EmployeeID = CONVERT(int,HOST_NAME())`  
  
 <span data-ttu-id="429ee-160">たとえば、従業員の Pamela Ansman-Wolfe には、280 という従業員 ID が割り当てられています。</span><span class="sxs-lookup"><span data-stu-id="429ee-160">For example, employee Pamela Ansman-Wolfe has been assigned an employee ID of 280.</span></span> <span data-ttu-id="429ee-161">この従業員のサブスクリプションの作成時に、従業員 ID の値 (この場合は 280) を HOST_NAME() 値に指定します。</span><span class="sxs-lookup"><span data-stu-id="429ee-161">Specify the value of the employee ID (280 in our example) for the HOST_NAME() value when creating a subscription for this employee.</span></span> <span data-ttu-id="429ee-162">マージ エージェントはパブリッシャーに接続すると、HOST_NAME() によって返された値をこのテーブル内の値と比較し、 **EmployeeID** 列に 280 という値が格納された行のみをダウンロードします。</span><span class="sxs-lookup"><span data-stu-id="429ee-162">When the Merge Agent connects to the Publisher, it compares the value returned by HOST_NAME() to the values in the table and downloads only the row that contains a value of 280 in the **EmployeeID** column.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="429ee-163">HOST_NAME() 関数は `nchar` 型の値を返します。したがって、上記の例のようにフィルター句の列が数値データ型の場合は、CONVERT を使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="429ee-163">The HOST_NAME() function returns an `nchar` value, so you must use CONVERT if the column in the filter clause is of a numeric data type, as it is in the example above.</span></span> <span data-ttu-id="429ee-164">`CONVERT(nchar,EmployeeID) = HOST_NAME()`のように、パラメーター化された行フィルターの句で列名に関数を適用するとパフォーマンスが低下するため、使用しないことをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="429ee-164">For performance reasons, we recommended that you do not apply functions to column names in parameterized row filter clauses, such as `CONVERT(nchar,EmployeeID) = HOST_NAME()`.</span></span> <span data-ttu-id="429ee-165">代わりに、この例で示されている `EmployeeID = CONVERT(int,HOST_NAME())`という句を使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="429ee-165">Instead, we recommend using the approach shown in the example: `EmployeeID = CONVERT(int,HOST_NAME())`.</span></span> <span data-ttu-id="429ee-166">この句は sp_addmergearticle のパラメーターに使用できます **@subset_filterclause** が、通常はパブリケーションの新規作成ウィザードでは使用できません (このウィザードでは、フィルター句を実行して検証します。これは、コンピューター名をに変換できないために失敗し[sp_addmergearticle](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) `int` ます)。</span><span class="sxs-lookup"><span data-stu-id="429ee-166">This clause can be used for the **@subset_filterclause** parameter of [sp_addmergearticle](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql), but it typically cannot be used in the New Publication Wizard (the wizard executes the filter clause to validate it, which fails because the computer name cannot be converted to an `int`).</span></span> <span data-ttu-id="429ee-167">パブリケーションの新規作成ウィザードを使用する場合は、このウィザードで `CONVERT(nchar,EmployeeID) = HOST_NAME()` を指定し、次に [sp_changemergearticle](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql) を使用して句を `EmployeeID = CONVERT(int,HOST_NAME())` に変更してから、パブリケーションのスナップショットを作成することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="429ee-167">If you use the New Publication Wizard, we recommend specifying `CONVERT(nchar,EmployeeID) = HOST_NAME()` in the wizard and then use [sp_changemergearticle](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql) to change the clause to `EmployeeID = CONVERT(int,HOST_NAME())` before creating a snapshot for the publication.</span></span>  
  
 <span data-ttu-id="429ee-168">**HOST_NAME() 値をオーバーライドするには**</span><span class="sxs-lookup"><span data-stu-id="429ee-168">**To override the HOST_NAME() value**</span></span>  
  
 <span data-ttu-id="429ee-169">以下のいずれかの方法で、HOST_NAME() 値をオーバーライドします。</span><span class="sxs-lookup"><span data-stu-id="429ee-169">Use one of the following methods to override the HOST_NAME() value:</span></span>  
  
-   [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)]<span data-ttu-id="429ee-170">: サブスクリプションの新規作成ウィザードの **HOST\_NAME\(\) 値** ページで値を指定します。</span><span class="sxs-lookup"><span data-stu-id="429ee-170">: specify a value on the **HOST\_NAME\(\) Values** page of the New Subscription Wizard.</span></span> <span data-ttu-id="429ee-171">サブスクリプションの作成については、「[パブリケーションのサブスクライブ](../subscribe-to-publications.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="429ee-171">For more information about creating subscriptions, see [Subscribe to Publications](../subscribe-to-publications.md).</span></span>  
  
-   <span data-ttu-id="429ee-172">レプリケーション [!INCLUDE[tsql](../../../includes/tsql-md.md)] プログラミング: **@hostname** [sp_addmergesubscription &#40;transact-sql&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergesubscription-transact-sql) (プッシュサブスクリプションの場合) または[sp_addmergepullsubscription_agent &#40;transact-sql&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-agent-transact-sql) (プルサブスクリプションの場合) のパラメーターの値を指定します。</span><span class="sxs-lookup"><span data-stu-id="429ee-172">Replication [!INCLUDE[tsql](../../../includes/tsql-md.md)] programming: specify a value for the **@hostname** parameter of [sp_addmergesubscription &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergesubscription-transact-sql) (for push subscriptions) or [sp_addmergepullsubscription_agent &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-agent-transact-sql) (for pull subscriptions).</span></span>  
  
-   <span data-ttu-id="429ee-173">マージ エージェント: コマンド ラインまたはエージェント プロファイルで **-Hostname** パラメーターの値を指定します。</span><span class="sxs-lookup"><span data-stu-id="429ee-173">Merge Agent: specify a value for the **-Hostname** parameter at the command line or through an agent profile.</span></span> <span data-ttu-id="429ee-174">マージ エージェントの詳細については、「 [Replication Merge Agent](../agents/replication-merge-agent.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="429ee-174">For more information about the Merge Agent, see [Replication Merge Agent](../agents/replication-merge-agent.md).</span></span> <span data-ttu-id="429ee-175">エージェント プロファイルの詳細については、「 [Replication Agent Profiles](../agents/replication-agent-profiles.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="429ee-175">For more information about agent profiles, see [Replication Agent Profiles](../agents/replication-agent-profiles.md).</span></span>  
  
## <a name="initializing-a-subscription-to-a-publication-with-parameterized-filters"></a><span data-ttu-id="429ee-176">パラメーター化されたフィルターを使用したパブリケーションへのサブスクリプションの初期化</span><span class="sxs-lookup"><span data-stu-id="429ee-176">Initializing a Subscription to a Publication with Parameterized Filters</span></span>  
 <span data-ttu-id="429ee-177">パラメーター化された行フィルターがマージ パブリケーションで使用される場合、レプリケーションは 2 つの要素から成るスナップショットを持つ各サブスクリプションを初期化します。</span><span class="sxs-lookup"><span data-stu-id="429ee-177">When parameterized row filters are used in merge publications, replication initializes each subscription with a two-part snapshot.</span></span> <span data-ttu-id="429ee-178">詳しくは、「 [Snapshots for Merge Publications with Parameterized Filters](../snapshots-for-merge-publications-with-parameterized-filters.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="429ee-178">For more information, see [Snapshots for Merge Publications with Parameterized Filters](../snapshots-for-merge-publications-with-parameterized-filters.md).</span></span>  
  
## <a name="using-the-appropriate-filtering-options"></a><span data-ttu-id="429ee-179">適切なフィルター選択オプションの使用</span><span class="sxs-lookup"><span data-stu-id="429ee-179">Using the Appropriate Filtering Options</span></span>  
 <span data-ttu-id="429ee-180">パラメーター化されたフィルターを使用する場合、制御できる主要な要素が 2 つあります。</span><span class="sxs-lookup"><span data-stu-id="429ee-180">There are two key areas over which you have control when using parameterized filters:</span></span>  
  
-   <span data-ttu-id="429ee-181">マージ レプリケーションによるフィルターの処理方法。" **パーティション グループを使用** " および " **パーティションの変更を保持**" の 2 つのパブリケーション設定のいずれかで制御されます。</span><span class="sxs-lookup"><span data-stu-id="429ee-181">How the filters are processed by merge replication, which is controlled by one of two publication settings: **use partition groups** and **keep partition changes**.</span></span>  
  
-   <span data-ttu-id="429ee-182">サブスクライバー間でのデータの共有方法。アーティクル設定の **[パーティションのオプション]** で指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="429ee-182">How the data is shared among Subscribers, which must be reflected by the article setting **partition options**.</span></span>  
  
 <span data-ttu-id="429ee-183">フィルター選択オプションを設定するには、「 [Optimize Parameterized Row Filters](../publish/optimize-parameterized-row-filters.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="429ee-183">To set filtering options, see [Optimize Parameterized Row Filters](../publish/optimize-parameterized-row-filters.md).</span></span>  
  
### <a name="setting-use-partition-groups-and-keep-partition-changes"></a><span data-ttu-id="429ee-184">"パーティション グループを使用" および "パーティションの変更を保持" の設定</span><span class="sxs-lookup"><span data-stu-id="429ee-184">Setting 'use partition groups' and 'keep partition changes'</span></span>  
 <span data-ttu-id="429ee-185">**パーティション グループを使用** オプションと **パーティションの変更を保持** オプションでは、いずれもパブリケーション データベースに追加のメタデータを格納することにより、フィルター選択されたアーティクルを持つパブリケーションの同期パフォーマンスを向上します。</span><span class="sxs-lookup"><span data-stu-id="429ee-185">Both the **use partition groups** and **keep partition changes** options improve the synchronization performance for publications with filtered articles by storing additional metadata in the publication database.</span></span> <span data-ttu-id="429ee-186">**パーティション グループを使用** オプションでは、事前計算済みパーティション機能を使用することにより、パフォーマンスを向上させることができます。</span><span class="sxs-lookup"><span data-stu-id="429ee-186">The **use partition groups** option provides greater performance improvement through the use of the precomputed partitions feature.</span></span> <span data-ttu-id="429ee-187">このオプションは、パブリケーションのアーティクルが一連の要件を満たしている場合に、既定で `true` に設定されています。</span><span class="sxs-lookup"><span data-stu-id="429ee-187">This option is set to `true` by default if the articles in your publication adhere to a set of requirements.</span></span> <span data-ttu-id="429ee-188">これらの要件の詳細については、「[事前計算済みパーティションによるパラメーター化されたフィルターのパフォーマンス最適化](parameterized-filters-optimize-for-precomputed-partitions.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="429ee-188">For more information about these requirements, see [Optimize Parameterized Filter Performance with Precomputed Partitions](parameterized-filters-optimize-for-precomputed-partitions.md).</span></span> <span data-ttu-id="429ee-189">アーティクルが事前計算済みパーティションを使用するための要件を満たしていない場合は、[**パーティションの変更を保持**する] オプションをに設定し `true` ます。</span><span class="sxs-lookup"><span data-stu-id="429ee-189">If your articles do not meet the requirements for using precomputed partitions, the **keep partition changes** option to is set to `true`.</span></span>  
  
### <a name="setting-partition-options"></a><span data-ttu-id="429ee-190">[パーティションのオプション] の設定</span><span class="sxs-lookup"><span data-stu-id="429ee-190">Setting 'partition options'</span></span>  
 <span data-ttu-id="429ee-191">**[パーティションのオプション]** プロパティの値は、アーティクルを作成するときに、フィルター選択されたテーブルのデータをサブスクライバーが共有する方法に応じて設定します。</span><span class="sxs-lookup"><span data-stu-id="429ee-191">You specify a value for the **partition options** property when creating an article, according to the way in which data in the filtered table will be shared by Subscribers.</span></span> <span data-ttu-id="429ee-192">このプロパティは、 [sp_addmergearticle](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql)、 [sp_changemergearticle](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql)、および **[アーティクルのプロパティ]** ダイアログ ボックスを使用して、4 つの値のいずれかに設定できます。</span><span class="sxs-lookup"><span data-stu-id="429ee-192">The property can be set to one of four values using [sp_addmergearticle](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql), [sp_changemergearticle](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql), and the **Article Properties** dialog box.</span></span> <span data-ttu-id="429ee-193">このプロパティは、 **[フィルターの追加]** ダイアログ ボックスまたは **[フィルターの編集]** ダイアログ ボックスを使用して、2 つの値のいずれかに設定できます。これらのダイアログ ボックスは、パブリケーションの新規作成ウィザードおよび **[パブリケーションのプロパティ]** ダイアログ ボックスから使用できます。</span><span class="sxs-lookup"><span data-stu-id="429ee-193">The property can be set to one of two values using the **Add Filter** or **Edit Filter** dialog boxes, which are available from the New Publication Wizard and the **Publication Properties** dialog box.</span></span> <span data-ttu-id="429ee-194">次の表は、利用可能な値をまとめたものです。</span><span class="sxs-lookup"><span data-stu-id="429ee-194">The following table summarizes the available values:</span></span>  
  
|<span data-ttu-id="429ee-195">説明</span><span class="sxs-lookup"><span data-stu-id="429ee-195">Description</span></span>|<span data-ttu-id="429ee-196">[フィルターの追加] および [フィルターの編集] の値</span><span class="sxs-lookup"><span data-stu-id="429ee-196">Value in Add Filter and Edit Filter</span></span>|<span data-ttu-id="429ee-197">[アーティクルのプロパティ] の値</span><span class="sxs-lookup"><span data-stu-id="429ee-197">Value in Article Properties</span></span>|<span data-ttu-id="429ee-198">ストアド プロシージャ内の値</span><span class="sxs-lookup"><span data-stu-id="429ee-198">Value in stored procedures</span></span>|  
|-----------------|-----------------------------------------|---------------------------------|--------------------------------|  
|<span data-ttu-id="429ee-199">パーティション内のデータは重複しています。サブスクライバーはパラメーター化されたフィルターで参照されている列を更新できます。</span><span class="sxs-lookup"><span data-stu-id="429ee-199">Data in the partitions is overlapping, and the Subscriber can update columns referenced in a parameterized filter.</span></span>|<span data-ttu-id="429ee-200">**[このテーブルの 1 行を複数のサブスクリプションに移動する]**</span><span class="sxs-lookup"><span data-stu-id="429ee-200">**A row from this table will go to multiple subscriptions**</span></span>|<span data-ttu-id="429ee-201">**[重複する]**</span><span class="sxs-lookup"><span data-stu-id="429ee-201">**Overlapping**</span></span>|<span data-ttu-id="429ee-202">**0**</span><span class="sxs-lookup"><span data-stu-id="429ee-202">**0**</span></span>|  
|<span data-ttu-id="429ee-203">パーティション内のデータは重複しています。サブスクライバーはパラメーター化されたフィルターで参照されている列を更新できません。</span><span class="sxs-lookup"><span data-stu-id="429ee-203">Data in the partitions is overlapping, and the Subscriber cannot update columns referenced in a parameterized filter.</span></span>|<span data-ttu-id="429ee-204">N/A<sup>1</sup></span><span class="sxs-lookup"><span data-stu-id="429ee-204">N/A<sup>1</sup></span></span>|<span data-ttu-id="429ee-205">**[重複する (パーティション外のデータ変更を禁止)]**</span><span class="sxs-lookup"><span data-stu-id="429ee-205">**Overlapping, disallow out-of-partition data changes**</span></span>|<span data-ttu-id="429ee-206">**1**</span><span class="sxs-lookup"><span data-stu-id="429ee-206">**1**</span></span>|  
|<span data-ttu-id="429ee-207">パーティション内のデータは重複していません。データはサブスクリプション間で共有されます。</span><span class="sxs-lookup"><span data-stu-id="429ee-207">Data in the partitions is not overlapping, and the data is shared between subscriptions.</span></span> <span data-ttu-id="429ee-208">サブスクライバーはパラメーター化されたフィルターで参照されている列を更新できません。</span><span class="sxs-lookup"><span data-stu-id="429ee-208">The Subscriber cannot update columns referenced in a parameterized filter.</span></span>|<span data-ttu-id="429ee-209">N/A<sup>1</sup></span><span class="sxs-lookup"><span data-stu-id="429ee-209">N/A<sup>1</sup></span></span>|<span data-ttu-id="429ee-210">**[重複しない (複数のサブスクリプションで共有)]**</span><span class="sxs-lookup"><span data-stu-id="429ee-210">**Nonoverlapping, shared between subscriptions**</span></span>|<span data-ttu-id="429ee-211">**2**</span><span class="sxs-lookup"><span data-stu-id="429ee-211">**2**</span></span>|  
|<span data-ttu-id="429ee-212">パーティション内のデータは重複していません。パーティションごとに単一のサブスクリプションが存在します。</span><span class="sxs-lookup"><span data-stu-id="429ee-212">Data in the partitions is not overlapping, and there is a single subscription per partition.</span></span> <span data-ttu-id="429ee-213">サブスクライバーは、パラメーター化されたフィルターで参照されている列を更新できません。<sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="429ee-213">The Subscriber cannot update columns referenced in a parameterized filter.<sup>2</sup></span></span>|<span data-ttu-id="429ee-214">**[このテーブルの 1 行を 1 つのサブスクリプションのみに移動する]**</span><span class="sxs-lookup"><span data-stu-id="429ee-214">**A row from this table will go to only one subscription**</span></span>|<span data-ttu-id="429ee-215">**[重複しない (単一のサブスクリプション)]**</span><span class="sxs-lookup"><span data-stu-id="429ee-215">**Nonoverlapping, single subscription**</span></span>|<span data-ttu-id="429ee-216">**3**</span><span class="sxs-lookup"><span data-stu-id="429ee-216">**3**</span></span>|  
  
 <span data-ttu-id="429ee-217"><sup>1</sup>基になるフィルター選択オプションが**0**、 **1**、または**2**に設定されている場合、[**フィルターの追加**] および [フィルターの**編集**] ダイアログボックスには、**このテーブルの行が複数のサブスクリプションに**表示されます。</span><span class="sxs-lookup"><span data-stu-id="429ee-217"><sup>1</sup> If the underlying filtering option is set to **0**, or **1**, or **2**, the **Add Filter** and **Edit Filter** dialog boxes will display **A row from this table will go to multiple subscriptions**.</span></span>  
  
 <span data-ttu-id="429ee-218"><sup>2</sup>このオプションを指定すると、そのアーティクル内のデータの各パーティションに対して1つのサブスクリプションのみを使用できます。</span><span class="sxs-lookup"><span data-stu-id="429ee-218"><sup>2</sup> If you specify this option, there can only be a single subscription for each partition of data in that article.</span></span> <span data-ttu-id="429ee-219">第 2 のサブスクリプションを作成し、その新しいサブスクリプションのフィルター選択条件が既存のサブスクリプションと同じパーティションとして判別される場合、既存のサブスクリプションは削除されます。</span><span class="sxs-lookup"><span data-stu-id="429ee-219">If a second subscription is created in which the filtering criterion of the new subscription resolves to the same partition as the existing subscription, the existing subscription is dropped.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="429ee-220">**[パーティションのオプション]** の値は、サブスクライバーによるデータの共有方法に応じて設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="429ee-220">The **partition options** value must be set according to how data is shared by Subscribers.</span></span> <span data-ttu-id="429ee-221">たとえば、パーティションが重複せず、パーティションごとに単一のサブスクリプションが存在するように指定したにもかかわらず、データが別のサブスクライバーで更新された場合、マージ エージェントは同期中に失敗し、未集約が発生することがあります。</span><span class="sxs-lookup"><span data-stu-id="429ee-221">If, for example, you specify that a partition is nonoverlapping with a single subscription per partition, but data is then updated at another Subscriber, the Merge Agent can fail during synchronization and non-convergence can occur.</span></span>  
  
#### <a name="selecting-the-appropriate-partition-option"></a><span data-ttu-id="429ee-222">適切なパーティション オプションの選択</span><span class="sxs-lookup"><span data-stu-id="429ee-222">Selecting the Appropriate Partition Option</span></span>  
 <span data-ttu-id="429ee-223">重複しないパーティションは事前計算済みパーティションと連動して、一部の機能上の制限が許容される状況でパフォーマンスを向上します。</span><span class="sxs-lookup"><span data-stu-id="429ee-223">Nonoverlapping partitions work in conjunction with precomputed partitions to improve performance in situations where some functional limitations are acceptable.</span></span> <span data-ttu-id="429ee-224">事前計算済みパーティションを使用すると、サブスクライバーへのダウンロードの速度は向上しますが、アップロードの速度は低下します。</span><span class="sxs-lookup"><span data-stu-id="429ee-224">Precomputed partitions quicken downloads to Subscribers, but slow uploads.</span></span> <span data-ttu-id="429ee-225">重複しないパーティションを使用すると、事前計算済みパーティションに関連するアップロードの負荷は最小限に抑えられます。</span><span class="sxs-lookup"><span data-stu-id="429ee-225">Nonoverlapping partitions minimize the upload cost associated with precomputed partitions.</span></span> <span data-ttu-id="429ee-226">重複しないパーティションのパフォーマンス上の利点は、使用するパラメーター化されたフィルターと結合フィルターが複雑になるほど明確になります。</span><span class="sxs-lookup"><span data-stu-id="429ee-226">The performance benefit of nonoverlapping partitions is more noticeable when the parameterized filters and join filters used are more complex.</span></span>  
  
 <span data-ttu-id="429ee-227">パブリケーションで使用するパーティション オプションを決めるときは、次のシナリオを検討してください。</span><span class="sxs-lookup"><span data-stu-id="429ee-227">Consider the following scenarios when deciding which partition options to use in a publication.</span></span>  
  
-   [!INCLUDE[ssSampleDBCoShort](../../../includes/sssampledbcoshort-md.md)] <span data-ttu-id="429ee-228">には移動営業部門があり、郵便番号ごとに顧客の担当が決まっています。</span><span class="sxs-lookup"><span data-stu-id="429ee-228">has a mobile sales force with each sales person responsible for customers in a given zip code.</span></span> <span data-ttu-id="429ee-229">アプリケーションでは、顧客がある営業区域から別の営業区域に移動した場合に、郵便番号を更新し、その顧客が別の営業担当者に割り当てられるようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="429ee-229">The application requires that  the zip code be updated if a customer moves from one sales territory to another, so that the customer is assigned to a different sales person.</span></span> <span data-ttu-id="429ee-230">パラメーター化されたフィルターは顧客の郵便番号に基づいています。更新により、該当する郵便番号が、ある営業担当者のパーティションから削除されて別の営業担当者のパーティションに挿入されます。</span><span class="sxs-lookup"><span data-stu-id="429ee-230">The parameterized filter is based on the customer's zip code, and the update removes the zip code from one sales person's partition and inserts it into another sales person's partition.</span></span> <span data-ttu-id="429ee-231">このためには、パラメーター化されたフィルターで参照されている列を更新する機能を持つ、重複するパーティションが必要です。</span><span class="sxs-lookup"><span data-stu-id="429ee-231">This requires overlapping partitions with the ability to update columns referenced in a parameterized filter.</span></span> <span data-ttu-id="429ee-232">このオプションでは、柔軟性は最大になりますが、重複しないパーティションほどのパフォーマンスは得られない可能性があります。</span><span class="sxs-lookup"><span data-stu-id="429ee-232">This option maximizes flexibility but might not perform as well as nonoverlapping partitions.</span></span>  
  
-   <span data-ttu-id="429ee-233">ある人材紹介会社では、州の各郡にある地域事務所にデータを提供しています。</span><span class="sxs-lookup"><span data-stu-id="429ee-233">An employment agency has data that is supplied to regional offices in each county of the state.</span></span> <span data-ttu-id="429ee-234">このデータは重複していません。この会社の本社にあるテーブルの各行は、1 つのパーティションにのみ含まれていますが、そのパーティションは同じ郡にある複数の事務所に送信されます。</span><span class="sxs-lookup"><span data-stu-id="429ee-234">The data does not overlap; each row in the table at the agency's headquarters is included in only one partition, but that partition is sent to multiple offices in the same county.</span></span> <span data-ttu-id="429ee-235">この場合、サブスクリプション間で共有されるパーティションに対して重複しないパーティション オプションを使用するのが適切です。これにより、重複するパーティションよりも高いパフォーマンスを実現しつつ、アプリケーションの要件を満たすことができます。</span><span class="sxs-lookup"><span data-stu-id="429ee-235">The nonoverlapping partition option with partitions shared between subscriptions is appropriate, providing a performance improvement over overlapping partitions while satisfying the application requirements.</span></span>  
  
-   <span data-ttu-id="429ee-236">重複しないパーティションを使用し、1 つのサブスクリプションだけが 1 つのパーティション内のデータを受信および更新する場合は、さらにパフォーマンスを向上させることができます。</span><span class="sxs-lookup"><span data-stu-id="429ee-236">If you have nonoverlapping partitions and only one subscription receives and updates the data in a partition, further performance benefits can be realized.</span></span> <span data-ttu-id="429ee-237">このシナリオは、POS システムや、データが主にサブスクライバーで収集されてパブリッシャーにアップロードされるフィールド フォース アプリケーションで一般的です。</span><span class="sxs-lookup"><span data-stu-id="429ee-237">This scenario is common for point of sale systems, and field force applications in which data is primarily collected at the Subscriber and uploaded to the Publisher.</span></span> <span data-ttu-id="429ee-238">配送アプリケーションの **Package** テーブルについて考えてみます。各配送物がトラックに積み込まれると、その配送物の状態が **Package** テーブルで変更され、変更が本部にレプリケートされます。</span><span class="sxs-lookup"><span data-stu-id="429ee-238">Consider a **Package** table in a delivery application: as each package is loaded onto a truck, the status of the package is changed in the **Package** table, and the change is replicated back to headquarters.</span></span> <span data-ttu-id="429ee-239">別のトラックの運転手が同じ配送物の状態を更新することはありません。したがって **Package** テーブルには、パーティションごとに単一のサブスクリプションが存在する重複しないパーティションが適しています。</span><span class="sxs-lookup"><span data-stu-id="429ee-239">Drivers would not update the status of the same package on two different trucks, so the **Package** table is a good candidate for a nonoverlapping partition with a single subscription per partition.</span></span>  
  
#### <a name="considerations-for-nonoverlapping-partitions"></a><span data-ttu-id="429ee-240">重複しないパーティションに関する注意点</span><span class="sxs-lookup"><span data-stu-id="429ee-240">Considerations for Nonoverlapping Partitions</span></span>  
 <span data-ttu-id="429ee-241">重複しないパーティションを使用するときは、以下の点に注意してください。</span><span class="sxs-lookup"><span data-stu-id="429ee-241">Keep the following considerations in mind when using nonoverlapping partitions.</span></span>  
  
##### <a name="general-considerations"></a><span data-ttu-id="429ee-242">一般的な考慮事項</span><span class="sxs-lookup"><span data-stu-id="429ee-242">General Considerations</span></span>  
  
-   <span data-ttu-id="429ee-243">パブリケーションでは事前計算済みパーティションを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="429ee-243">The publication must use precomputed partitions.</span></span>  
  
-   <span data-ttu-id="429ee-244">1 つの行は 1 つのパーティションにのみ属している必要があります。</span><span class="sxs-lookup"><span data-stu-id="429ee-244">A row must belong to only one partition.</span></span>  
  
-   <span data-ttu-id="429ee-245">アーティクルを論理レコードの一部にすることはできません。</span><span class="sxs-lookup"><span data-stu-id="429ee-245">Articles cannot be part of a logical record.</span></span>  
  
-   <span data-ttu-id="429ee-246">代替同期パートナーはサポートされません (この機能は非推奨とされます)。</span><span class="sxs-lookup"><span data-stu-id="429ee-246">Alternate synchronization partners are not supported (this feature is deprecated).</span></span>  
  
-   <span data-ttu-id="429ee-247">サブスクライバーはパラメーター化されたフィルターで参照されている列を更新できません。</span><span class="sxs-lookup"><span data-stu-id="429ee-247">The Subscriber cannot update columns referenced in a parameterized filter.</span></span>  
  
-   <span data-ttu-id="429ee-248">サブスクライバーでの挿入がパーティションに属さない場合、その挿入は削除されません。</span><span class="sxs-lookup"><span data-stu-id="429ee-248">If an insert at a Subscriber does not belong to the partition, it is not deleted.</span></span> <span data-ttu-id="429ee-249">ただし、他のサブスクライバーにはレプリケートされません。</span><span class="sxs-lookup"><span data-stu-id="429ee-249">However, it will not be replicated to other Subscribers.</span></span>  
  
-   <span data-ttu-id="429ee-250">重複するパーティションを使用する一部の状況では、マージ エージェントがデータを挿入するときに、ID 範囲が調整されます。</span><span class="sxs-lookup"><span data-stu-id="429ee-250">In some circumstances with overlapping partitions, identity ranges are adjusted when the Merge Agent inserts data.</span></span> <span data-ttu-id="429ee-251">重複しないパーティションでは、サブスクリプション データベースで ID 範囲を調整する権限を持つユーザーのみが、挿入時に範囲を調整できます。</span><span class="sxs-lookup"><span data-stu-id="429ee-251">With nonoverlapping partitions, ranges can only be adjusted during inserts by a user who has permission to adjust identity ranges in the subscription database.</span></span> <span data-ttu-id="429ee-252">ユーザーはテーブルを所有しているか、 **sysadmin** 固定サーバー ロール、 **db_owner** 固定データベース ロール、または **db_ddladmin** 固定データベース ロールのメンバーである必要があります。</span><span class="sxs-lookup"><span data-stu-id="429ee-252">The user must either own the table, or be a member of the **sysadmin** fixed server role, the **db_owner** fixed database role, or the **db_ddladmin** fixed database role.</span></span>  
  
##### <a name="additional-considerations-for-nonoverlapping-partitions-with-a-single-subscription-per-partition"></a><span data-ttu-id="429ee-253">パーティションごとに単一のサブスクリプションが存在する重複しないパーティションに関するその他の注意点</span><span class="sxs-lookup"><span data-stu-id="429ee-253">Additional Considerations for Nonoverlapping Partitions with a Single Subscription per Partition</span></span>  
  
-   <span data-ttu-id="429ee-254">アーティクルは 1 つのパブリケーションにのみ存在することができます。アーティクルを再パブリッシュすることはできません。</span><span class="sxs-lookup"><span data-stu-id="429ee-254">Articles can exist in only one publication; articles cannot be republished.</span></span>  
  
-   <span data-ttu-id="429ee-255">パブリケーションでは、サブスクライバーによるスナップショット処理の開始を許可する必要があります。</span><span class="sxs-lookup"><span data-stu-id="429ee-255">The publication must allow Subscribers to initiate the snapshot process.</span></span> <span data-ttu-id="429ee-256">詳しくは、「 [Snapshots for Merge Publications with Parameterized Filters](../snapshots-for-merge-publications-with-parameterized-filters.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="429ee-256">For more information, see [Snapshots for Merge Publications with Parameterized Filters](../snapshots-for-merge-publications-with-parameterized-filters.md).</span></span>  
  
##### <a name="additional-considerations-for-join-filters"></a><span data-ttu-id="429ee-257">結合フィルターに関するその他の注意点</span><span class="sxs-lookup"><span data-stu-id="429ee-257">Additional Considerations for Join Filters</span></span>  
  
-   <span data-ttu-id="429ee-258">結合フィルター階層では、重複するパーティションのアーティクルを、重複しないパーティションのアーティクルよりも上位にすることはできません。</span><span class="sxs-lookup"><span data-stu-id="429ee-258">In a join filter hierarchy, an article with an overlapping partition cannot appear above an article with a nonoverlapping partition.</span></span> <span data-ttu-id="429ee-259">つまり、子アーティクルで重複しないパーティションを使用する場合、親アーティクルでも重複しないパーティションを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="429ee-259">In other words, a parent article must use nonoverlapping partitions if the child article does.</span></span> <span data-ttu-id="429ee-260">結合フィルターの詳細については、「 [Join Filters](join-filters.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="429ee-260">For information about join filters, see [Join Filters](join-filters.md).</span></span>  
  
-   <span data-ttu-id="429ee-261">重複しないパーティションを子に持つ結合フィルターでは、 **一意キーの結合** プロパティを 1 に設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="429ee-261">A join filter in which the nonoverlapping partition is a child must have the **join unique key** property set to 1.</span></span> <span data-ttu-id="429ee-262">詳しくは、「 [Join Filters](join-filters.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="429ee-262">For more information, see [Join Filters](join-filters.md).</span></span>  
  
-   <span data-ttu-id="429ee-263">アーティクルは、1 つのパラメーター化されたフィルターまたは結合フィルターのみを持っている必要があります。</span><span class="sxs-lookup"><span data-stu-id="429ee-263">The article should only have one parameterized filter or join filter.</span></span> <span data-ttu-id="429ee-264">パラメーター化されたフィルターを持ち、かつ結合フィルターの親になることは可能です。</span><span class="sxs-lookup"><span data-stu-id="429ee-264">Having a parameterized filter and being the parent in a join filter is allowed.</span></span> <span data-ttu-id="429ee-265">パラメーター化されたフィルターを持ち、かつ結合フィルターの子になることはできません。</span><span class="sxs-lookup"><span data-stu-id="429ee-265">Having a parameterized filter and being the child in a join filter is not allowed.</span></span> <span data-ttu-id="429ee-266">複数の結合フィルターを持つことはできません。</span><span class="sxs-lookup"><span data-stu-id="429ee-266">Having more than one join filter is also not allowed.</span></span>  
  
-   <span data-ttu-id="429ee-267">パブリッシャーの 2 つのテーブルに結合フィルター リレーションシップがあり、子テーブルの行が親テーブルの行と対応していない場合、その行を親テーブルに挿入しても、関連する行はサブスクライバーにダウンロードされません (行は重複するパーティションによってダウンロードされます)。</span><span class="sxs-lookup"><span data-stu-id="429ee-267">If two tables at the Publisher have a join filter relationship and the child table has rows that have no corresponding row in the parent table, an insert of the missing parent row will not result in the related rows being downloaded to the Subscriber (the rows would be downloaded with overlapping partitions).</span></span> <span data-ttu-id="429ee-268">たとえば、 **SalesOrderDetail** テーブルの行に対応する行が **SalesOrderHeader** テーブル内に存在せず、その行を **SalesOrderHeader**に挿入した場合、その行はサブスクライバーにダウンロードされますが、 **SalesOrderDetail** 内の対応する行はダウンロードされません。</span><span class="sxs-lookup"><span data-stu-id="429ee-268">For example, if the **SalesOrderDetail** table has rows with no corresponding row in the **SalesOrderHeader** table, and you insert the missing row in **SalesOrderHeader**, the row is downloaded to the Subscriber, but the corresponding rows in **SalesOrderDetail** are not.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="429ee-269">参照</span><span class="sxs-lookup"><span data-stu-id="429ee-269">See Also</span></span>  
 <span data-ttu-id="429ee-270">[時間ベースの行フィルターの推奨事項](best-practices-for-time-based-row-filters.md) </span><span class="sxs-lookup"><span data-stu-id="429ee-270">[Best Practices for Time-Based Row Filters](best-practices-for-time-based-row-filters.md) </span></span>  
 <span data-ttu-id="429ee-271">[パブリッシュされたデータのフィルター処理](../publish/filter-published-data.md) </span><span class="sxs-lookup"><span data-stu-id="429ee-271">[Filter Published Data](../publish/filter-published-data.md) </span></span>  
 [<span data-ttu-id="429ee-272">マージ レプリケーション用にパブリッシュされたデータのフィルター選択</span><span class="sxs-lookup"><span data-stu-id="429ee-272">Filter Published Data for Merge Replication</span></span>](filter-published-data-for-merge-replication.md)  
  
  
