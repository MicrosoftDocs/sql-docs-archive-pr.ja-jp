---
title: トポロジの構成 (ピア ツー ピア レプリケーション) | Microsoft Docs
ms.custom: ''
ms.date: 03/08/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
f1_keywords:
- sql12.rep.p2pwizard.peers.f1
ms.assetid: 5377c59f-2e25-4852-a306-c87ae3dca9fd
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 2dfc09f5ae7f488afd46f29c301d11b7687e0a4b
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87631837"
---
# <a name="configure-topology-peer-to-peer-replication"></a><span data-ttu-id="e07ad-102">[トポロジの構成] (ピア ツー ピア レプリケーション)</span><span class="sxs-lookup"><span data-stu-id="e07ad-102">Configure Topology (Peer-to-Peer Replication)</span></span>
  <span data-ttu-id="e07ad-103">**[トポロジの構成]** ページを使用すると、新しいノードの追加、ノードの削除、既存のノード間の新しい接続の追加など、一般的な構成タスクを実行できます。</span><span class="sxs-lookup"><span data-stu-id="e07ad-103">Use the **Configure topology** page to perform common configuration tasks, such as adding new nodes, deleting nodes, and adding new connections between existing nodes.</span></span> <span data-ttu-id="e07ad-104">このウィザードの **[パブリケーション]** ページで選択したノードがデザイン画面に表示されます。</span><span class="sxs-lookup"><span data-stu-id="e07ad-104">The node you selected on the **Publication** page of this wizard is displayed on the design surface.</span></span> <span data-ttu-id="e07ad-105">構成オプションを指定するには、ノード、接続、またはデザイン画面を右クリックします。</span><span class="sxs-lookup"><span data-stu-id="e07ad-105">To specify configuration options, right-click a node, a connection, or the design surface.</span></span>

> [!NOTE]
>  <span data-ttu-id="e07ad-106">ピア ツー ピア トポロジ構成ウィザードでは、ウィザードの終了時にトポロジ情報が要求されます。</span><span class="sxs-lookup"><span data-stu-id="e07ad-106">The Configure Peer to Peer Topology Wizard requests topology information when the wizard is closed.</span></span> <span data-ttu-id="e07ad-107">すべてのノードが情報の要求に応答する前にウィザードを閉じて再度開くと、ウィザードに不完全なネットワークが表示される場合があります。</span><span class="sxs-lookup"><span data-stu-id="e07ad-107">If the wizard is closed and reopened before all nodes respond to the request for information, the wizard might show a partial network.</span></span>

## <a name="options"></a><span data-ttu-id="e07ad-108">オプション</span><span class="sxs-lookup"><span data-stu-id="e07ad-108">Options</span></span>
 <span data-ttu-id="e07ad-109">**[トポロジの構成]** ページには、要素を右クリックすると表示されるインターフェイス要素およびオプションがあります。</span><span class="sxs-lookup"><span data-stu-id="e07ad-109">The **Configure topology** page contains interface elements and options that are available when you right-click an element.</span></span> <span data-ttu-id="e07ad-110">次の表では、各インターフェイス要素を説明します。</span><span class="sxs-lookup"><span data-stu-id="e07ad-110">The following table describes each interface element.</span></span>

|<span data-ttu-id="e07ad-111">インターフェイス要素</span><span class="sxs-lookup"><span data-stu-id="e07ad-111">Interface Element</span></span>|<span data-ttu-id="e07ad-112">説明</span><span class="sxs-lookup"><span data-stu-id="e07ad-112">Description</span></span>|
|-----------------------|-----------------|
|<span data-ttu-id="e07ad-113">デザイン画面</span><span class="sxs-lookup"><span data-stu-id="e07ad-113">Design surface</span></span>|<span data-ttu-id="e07ad-114">その他のインターフェイス要素を表示します。</span><span class="sxs-lookup"><span data-stu-id="e07ad-114">Displays other interface elements.</span></span> <span data-ttu-id="e07ad-115">要素を追加するには、デザイン画面を右クリックします。</span><span class="sxs-lookup"><span data-stu-id="e07ad-115">To add elements, right-click the design surface.</span></span>|
|<span data-ttu-id="e07ad-116">![トポロジの最初のノード](media/p2pwizard-firstnode.gif "トポロジの最初のノード")</span><span class="sxs-lookup"><span data-stu-id="e07ad-116">![The first node in a topology](media/p2pwizard-firstnode.gif "The first node in a topology")</span></span>|<span data-ttu-id="e07ad-117">トポロジの元のノード。</span><span class="sxs-lookup"><span data-stu-id="e07ad-117">The original node in the topology.</span></span> <span data-ttu-id="e07ad-118">元のノードのパブリケーション データベースのコピーを使用して、新しいノードが初期化されます。</span><span class="sxs-lookup"><span data-stu-id="e07ad-118">New nodes are initialized by using a copy of the publication database from the original node.</span></span>|
|<span data-ttu-id="e07ad-119">完全な情報またはそれ以降のバージョンを![持つノード](media/p2pwizard-complete.gif "情報が完全なノード")。レプリケーションには完全な情報が含まれています。</span><span class="sxs-lookup"><span data-stu-id="e07ad-119">![A node for which we have complete information](media/p2pwizard-complete.gif "A node for which we have complete information") or a later version, for which replication has complete information.</span></span> <span data-ttu-id="e07ad-120">構成オプションを指定するには、ノードを右クリックします。</span><span class="sxs-lookup"><span data-stu-id="e07ad-120">To specify configuration options, right-click the node.</span></span>|
|<span data-ttu-id="e07ad-121">![情報が不完全なノード](media/p2pwizard-incomplete.gif "情報が不完全なノード")</span><span class="sxs-lookup"><span data-stu-id="e07ad-121">![A node for which we have incomplete information](media/p2pwizard-incomplete.gif "A node for which we have incomplete information")</span></span>|<span data-ttu-id="e07ad-122">レプリケーションに含まれている情報が不完全なノード。</span><span class="sxs-lookup"><span data-stu-id="e07ad-122">A node for which replication has incomplete information.</span></span> <span data-ttu-id="e07ad-123">構成オプションを指定するには、ノードを右クリックします。</span><span class="sxs-lookup"><span data-stu-id="e07ad-123">To specify configuration options, right-click the node.</span></span> <span data-ttu-id="e07ad-124">レプリケーションに含まれている情報は、次のいずれかの理由で不完全になっています。</span><span class="sxs-lookup"><span data-stu-id="e07ad-124">Replication has incomplete information because of one of the following reasons:</span></span><br /><br /> <span data-ttu-id="e07ad-125">ウィザードで必要なメタデータが一部格納されない [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] のインスタンスがノードで実行されています。</span><span class="sxs-lookup"><span data-stu-id="e07ad-125">The node is running an instance of [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)], which does not store all the metadata required by the wizard.</span></span><br /><br /> <span data-ttu-id="e07ad-126">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] の最新バージョンがノードで実行されていますが、レプリケーションがノードからサブスクリプション情報を取得できません。</span><span class="sxs-lookup"><span data-stu-id="e07ad-126">The node is running a later version of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], but replication cannot retrieve subscription information from the node.</span></span> <span data-ttu-id="e07ad-127">このような場合は、次の方法で対処してください。</span><span class="sxs-lookup"><span data-stu-id="e07ad-127">To troubleshoot this situation:</span></span><br /><span data-ttu-id="e07ad-128">-ノードのデータベースがオンラインであること、およびノードに接続するディストリビューションエージェントと同じ資格情報を使用して接続できることを確認します。</span><span class="sxs-lookup"><span data-stu-id="e07ad-128">-Make sure that the database at the node is online and that you can connect to it by using the same credentials as the Distribution Agents that connect to the node.</span></span><br /><span data-ttu-id="e07ad-129">-ノードに接続するログリーダーエージェントおよびすべてのディストリビューションエージェントが実行されていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="e07ad-129">-Make sure that the Log Reader Agent and all Distribution Agents that connect to the node are running.</span></span><br /><span data-ttu-id="e07ad-130">-すべてのトポロジ情報を収集するために、更新のタイムアウトが十分に高い値に設定されていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="e07ad-130">-Make sure that the refresh timeout is set high enough to gather all topology information.</span></span> <span data-ttu-id="e07ad-131">タイムアウトを設定するには、デザイン画面を右クリックして **[更新のタイムアウトの設定]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="e07ad-131">To set the time-out, right-click the design surface, and click **Set Refresh Timeout**.</span></span>|
|<span data-ttu-id="e07ad-132">矢印の付いた灰色の線</span><span class="sxs-lookup"><span data-stu-id="e07ad-132">Gray line with arrows</span></span>|<span data-ttu-id="e07ad-133">2 つのノード間の接続。</span><span class="sxs-lookup"><span data-stu-id="e07ad-133">The connection between two nodes.</span></span> <span data-ttu-id="e07ad-134">接続を追加するには、接続するノードのいずれかを右クリックします。</span><span class="sxs-lookup"><span data-stu-id="e07ad-134">To add a connection, right-click one of the nodes that you want to connect.</span></span> <span data-ttu-id="e07ad-135">接続を削除するには、接続を右クリックします。</span><span class="sxs-lookup"><span data-stu-id="e07ad-135">To remove a connection, right-click the connection.</span></span><br /><br /> <span data-ttu-id="e07ad-136">線に付いている矢印が単一の場合、レプリケーションに含まれているいずれかのノードの情報が不完全です。</span><span class="sxs-lookup"><span data-stu-id="e07ad-136">If the line has a single arrow, replication has incomplete information for one of the nodes.</span></span>|

### <a name="options-for-the-design-surface"></a><span data-ttu-id="e07ad-137">デザイン画面のオプション</span><span class="sxs-lookup"><span data-stu-id="e07ad-137">Options for the Design Surface</span></span>
 <span data-ttu-id="e07ad-138">**グラフの再描画**トポロジを更新せずに、デザイン画面でオブジェクトを再描画します。</span><span class="sxs-lookup"><span data-stu-id="e07ad-138">**Redraw Graph** Redraw the objects on the design surface without refreshing the topology.</span></span> <span data-ttu-id="e07ad-139">再表示すると、トポロジが見やすくなる場合があります。</span><span class="sxs-lookup"><span data-stu-id="e07ad-139">Redrawing might provide a better view of the topology.</span></span>

 <span data-ttu-id="e07ad-140">**トポロジの更新**トポロジ内の各ノードに対してクエリを実行し、各ノードに関する更新された情報を表示します。</span><span class="sxs-lookup"><span data-stu-id="e07ad-140">**Refresh Topology** Query each node in the topology, and display updated information about each node.</span></span> <span data-ttu-id="e07ad-141">多数のノードが存在する場合、このプロセスには数分かかる場合があります。</span><span class="sxs-lookup"><span data-stu-id="e07ad-141">With many nodes, this process can take several minutes.</span></span>

 <span data-ttu-id="e07ad-142">ウィザードによってトポロジ情報が要求された場合、すべてのノードが要求に応答する前にウィザードを閉じて再度開くと、このページにトポロジのノードが一部表示されない場合があります。</span><span class="sxs-lookup"><span data-stu-id="e07ad-142">If the wizard requests topology information, and then you close and reopen the wizard before all nodes respond to the request, this page might not display all nodes in the topology.</span></span>

 <span data-ttu-id="e07ad-143">**新しいピアノードの追加**のインスタンスを [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ピアツーピアトポロジに追加します。</span><span class="sxs-lookup"><span data-stu-id="e07ad-143">**Add a New Peer Node** Add an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] to the peer-to-peer topology.</span></span> <span data-ttu-id="e07ad-144">インスタンスをノードとして追加すると、ウィザードの完了後にそのインスタンスでパブリケーションが作成されます。</span><span class="sxs-lookup"><span data-stu-id="e07ad-144">Adding an instance as a node creates a publication at that instance after the wizard completes.</span></span> <span data-ttu-id="e07ad-145">ノードの追加後に、そのノードを右クリックして新しいノードと既存のノード間の接続を追加します。</span><span class="sxs-lookup"><span data-stu-id="e07ad-145">After you add the node, right-click it to add a connection between the new node and an existing node.</span></span>

 <span data-ttu-id="e07ad-146">ピア ツー ピア トポロジに参加するためには、インスタンスが次の要件を満たしている必要があります。</span><span class="sxs-lookup"><span data-stu-id="e07ad-146">To participate in a peer-to-peer topology, the instance must meet the following requirements:</span></span>

-   <span data-ttu-id="e07ad-147">ディストリビューターとして構成されているか、リモート ディストリビューターに関連付けられている。</span><span class="sxs-lookup"><span data-stu-id="e07ad-147">It must already be configured as a Distributor or be associated with a remote Distributor.</span></span>

-   <span data-ttu-id="e07ad-148">レプリケーションに関係するデータベースのコピーが含まれている。</span><span class="sxs-lookup"><span data-stu-id="e07ad-148">It must contain a copy of the database involved in replication.</span></span> <span data-ttu-id="e07ad-149">このコピーは通常、元のパブリケーション データベースの復元されたバックアップです。</span><span class="sxs-lookup"><span data-stu-id="e07ad-149">This copy is typically a restored backup of the original publication database.</span></span>

 <span data-ttu-id="e07ad-150">**表示するノードの選択**デザイン画面に表示するノードを選択します。</span><span class="sxs-lookup"><span data-stu-id="e07ad-150">**Select Node(s) to View** Select which nodes to view on the design surface.</span></span> <span data-ttu-id="e07ad-151">このオプションは、トポロジに多数のノードが存在する場合に役立ちます。</span><span class="sxs-lookup"><span data-stu-id="e07ad-151">This option is useful if the topology has a large number of nodes.</span></span> <span data-ttu-id="e07ad-152">デザイン画面に表示されているノード間にしか接続を追加できないことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="e07ad-152">Be aware that you can add connections only between nodes that are visible on the design surface.</span></span>

 <span data-ttu-id="e07ad-153">**更新のタイムアウトの設定**操作がタイムアウトするまでに更新プロセスを実行できる期間を指定します。</span><span class="sxs-lookup"><span data-stu-id="e07ad-153">**Set Refresh Timeout** Specify how long the refresh process can run before the operation times out.</span></span>

### <a name="options-for-each-node"></a><span data-ttu-id="e07ad-154">各ノードのオプション</span><span class="sxs-lookup"><span data-stu-id="e07ad-154">Options for Each Node</span></span>
 <span data-ttu-id="e07ad-155">**新しいピア接続の追加**2つのノード間の接続を追加します。</span><span class="sxs-lookup"><span data-stu-id="e07ad-155">**Add a New Peer Connection** Add a connection between two nodes.</span></span> <span data-ttu-id="e07ad-156">たとえば、ノード A とノード B 間の接続を追加すると、レプリケーションによって 2 つのサブスクリプションが追加されます。最初のサブスクリプションによってノード A がノード B のパブリケーションから変更を受信できるようになり、2 番目のサブスクリプションによってノード B がノード A のパブリケーションから変更を受信できるようになります。</span><span class="sxs-lookup"><span data-stu-id="e07ad-156">For example, if you add a connection between Node A and Node B, replication adds two subscriptions: The first enables Node A to receive changes from the publication at Node B, and the second enables Node B to receive changes from the publication at Node A.</span></span>

 <span data-ttu-id="e07ad-157">**ピアノードの削除**トポロジからノードを削除します。</span><span class="sxs-lookup"><span data-stu-id="e07ad-157">**Delete Peer Node** Removes a node from the topology.</span></span> <span data-ttu-id="e07ad-158">たとえば、ノード C を削除すると、そのノードのパブリケーションが削除されます。</span><span class="sxs-lookup"><span data-stu-id="e07ad-158">For example, if you remove Node C, the publication at that node is removed.</span></span> <span data-ttu-id="e07ad-159">ノード A とノード C、およびノード B とノード C 間のサブスクリプションも削除されます。</span><span class="sxs-lookup"><span data-stu-id="e07ad-159">Subscriptions between Node A and Node C, and Node B and Node C are also removed.</span></span> <span data-ttu-id="e07ad-160">ノード C のデータベースは削除されず、パブリッシングおよびディストリビューションは無効になりません。</span><span class="sxs-lookup"><span data-stu-id="e07ad-160">The database at Node C is not deleted, and publishing and distribution are not disabled.</span></span>

> [!NOTE]
>  <span data-ttu-id="e07ad-161">ピア ツー ピア レプリケーションを構成する場合は、各ノードに ID を指定します。</span><span class="sxs-lookup"><span data-stu-id="e07ad-161">When you configure peer-to-peer replication, you specify an ID for each node.</span></span> <span data-ttu-id="e07ad-162">この ID は、トポロジ内のすべてのノードに対して一意である必要があり、[MSpeer_originatorid_history](/sql/relational-databases/system-tables/mspeer-originatorid-history-transact-sql) システム テーブルの originator_id 列に格納されます。</span><span class="sxs-lookup"><span data-stu-id="e07ad-162">This ID, which must be unique across all nodes in the topology, is stored in the originator_id column in the [MSpeer_originatorid_history](/sql/relational-databases/system-tables/mspeer-originatorid-history-transact-sql) system table.</span></span> <span data-ttu-id="e07ad-163">ノードがトポロジから削除されても、ID は履歴テーブルに保持されたままです。</span><span class="sxs-lookup"><span data-stu-id="e07ad-163">If a node is removed from the topology, the ID is still retained in the history table.</span></span> <span data-ttu-id="e07ad-164">ID が保持されるのは、削除されたノードからの変更がトポロジ全体でレプリケートされたままである場合に誤った競合が発生しないようにするためです。</span><span class="sxs-lookup"><span data-stu-id="e07ad-164">The ID is retained to prevent false conflicts from occurring if there are changes from the removed node that are still being replicated across the topology.</span></span> <span data-ttu-id="e07ad-165">新しいノードに対してこの ID を再利用する場合は、先にすべてのノードで MSpeer_originatorid_history テーブルからこの ID を手動で削除する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e07ad-165">If you want to reuse the ID for a new node, you must first manually delete the ID from the MSpeer_originatorid_history table at all nodes.</span></span> <span data-ttu-id="e07ad-166">ノードの ID を削除する前に、 [sp_requestpeerresponse](/sql/relational-databases/system-stored-procedures/sp-requestpeerresponse-transact-sql) を実行して、そのノードから発行されたすべての変更がレプリケートされていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="e07ad-166">Before you delete an ID for a node, execute [sp_requestpeerresponse](/sql/relational-databases/system-stored-procedures/sp-requestpeerresponse-transact-sql) to verify that all changes that originated from that node have been replicated.</span></span>

 <span data-ttu-id="e07ad-167">**表示されているすべてのノードに接続する**選択したノードと他のすべてのノード間の接続を追加します。</span><span class="sxs-lookup"><span data-stu-id="e07ad-167">**Connect to ALL Displayed Nodes** Adds connections between the selected node and all other nodes.</span></span> <span data-ttu-id="e07ad-168">たとえば、3 ノード トポロジのノード C に対してこのオプションを選択すると、レプリケーションによって 4 つのサブスクリプションが追加されます。このうちの 2 つのサブスクリプションによってノード A とノード B がノード C のパブリケーションから変更を受信できるようになり、他の 2 つのサブスクリプションによってノード C がノード A とノード B のパブリケーションから変更を受信できるようになります。</span><span class="sxs-lookup"><span data-stu-id="e07ad-168">For example, if you selected this option for Node C in a three node topology, replication adds four subscriptions: two that enable Node A and Node B to receive changes from the publication at Node C, and two that enable Node C to receive changes from the publications at Node A and Node B.</span></span>

 <span data-ttu-id="e07ad-169">**表示するノードの選択**デザイン画面に表示するノードを選択します。</span><span class="sxs-lookup"><span data-stu-id="e07ad-169">**Select Node(s) to View** Select which nodes to view on the design surface.</span></span> <span data-ttu-id="e07ad-170">このオプションは、トポロジに多数のノードが存在する場合に役立ちます。</span><span class="sxs-lookup"><span data-stu-id="e07ad-170">This option is useful if the topology has a large number of nodes.</span></span> <span data-ttu-id="e07ad-171">デザイン画面に表示されているノード間にしか接続を追加できないことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="e07ad-171">Be aware that you can add connections only between nodes that are visible on the design surface.</span></span>

### <a name="options-for-the-connection-arrows"></a><span data-ttu-id="e07ad-172">接続矢印のオプション</span><span class="sxs-lookup"><span data-stu-id="e07ad-172">Options for the Connection Arrows</span></span>
 <span data-ttu-id="e07ad-173">**ピア接続の削除**2つのノード間の接続を削除します。</span><span class="sxs-lookup"><span data-stu-id="e07ad-173">**Remove Peer Connection** Remove a connection between two nodes.</span></span> <span data-ttu-id="e07ad-174">たとえば、ノード A とノード B 間の接続を削除すると、レプリケーションによって 2 つのサブスクリプション (ノード A がノード B のパブリケーションから変更を受信できるようにしているサブスクリプションと、ノード B がノード A のパブリケーションから変更を受信できるようにしているサブスクリプション) が削除されます。</span><span class="sxs-lookup"><span data-stu-id="e07ad-174">For example, if you remove a connection between Node A and Node B, replication drops two subscriptions: the one that enables Node A to receive changes from the publication at Node B, and the one that enables Node B to receive changes from the publication at Node A.</span></span>

## <a name="see-also"></a><span data-ttu-id="e07ad-175">参照</span><span class="sxs-lookup"><span data-stu-id="e07ad-175">See Also</span></span>
 <span data-ttu-id="e07ad-176">[パブリッシングおよびディストリビューション](configure-publishing-and-distribution.md)[の構成ピアツーピアトポロジの管理レプリケーション Transact-sql プログラミング&#41;](administration/administer-a-peer-to-peer-topology-replication-transact-sql-programming.md) [ピアツーピアトランザクションレプリケーション](transactional/peer-to-peer-transactional-replication.md)の &#40;</span><span class="sxs-lookup"><span data-stu-id="e07ad-176">[Configure Publishing and Distribution](configure-publishing-and-distribution.md) [Administer a Peer-to-Peer Topology &#40;Replication Transact-SQL Programming&#41;](administration/administer-a-peer-to-peer-topology-replication-transact-sql-programming.md) [Peer-to-Peer Transactional Replication](transactional/peer-to-peer-transactional-replication.md)</span></span>


