---
title: ID 列のレプリケート | Microsoft Docs
ms.custom: ''
ms.date: 10/04/2016
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- identities [SQL Server replication]
- identity values [SQL Server replication]
- merge replication [SQL Server replication], identity range management
- publishing [SQL Server replication], identity columns
- transactional replication, identity range management
- identity columns [SQL Server], replication
ms.assetid: eb2f23a8-7ec2-48af-9361-0e3cb87ebaf7
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: c899d902e403e9f7cdbdfd1a83cde110e627ab11
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87633057"
---
# <a name="replicate-identity-columns"></a><span data-ttu-id="a7725-102">ID 列のレプリケート</span><span class="sxs-lookup"><span data-stu-id="a7725-102">Replicate Identity Columns</span></span>
  <span data-ttu-id="a7725-103">IDENTITY プロパティを列に割り当てると、[!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] では、その ID 列を含むテーブルに挿入された新しい行に対して連続する番号が自動的に生成されます。</span><span class="sxs-lookup"><span data-stu-id="a7725-103">When you assign an IDENTITY property to a column, [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] automatically generates sequential numbers for new rows inserted in the table containing the identity column.</span></span> <span data-ttu-id="a7725-104">詳細については、「[IDENTITY &#40;プロパティ&#41; &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-table-transact-sql-identity-property)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a7725-104">For more information, see [IDENTITY &#40;Property&#41; &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-table-transact-sql-identity-property).</span></span> <span data-ttu-id="a7725-105">ID 列は主キーの一部に含まれる場合があるため、ID 列の値が重複しないようにすることが重要です。</span><span class="sxs-lookup"><span data-stu-id="a7725-105">Because identity columns might be included as a part of the primary key, it is important to avoid duplicate values in the identity columns.</span></span> <span data-ttu-id="a7725-106">複数のノードで更新されるレプリケーション トポロジで ID 列を使用するには、レプリケーション トポロジ内の各ノードで異なる範囲の ID 値を使用して、重複が生じないようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="a7725-106">To use identity columns in a replication topology that has updates at more than one node, each node in the replication topology must use a different range of identity values, so that duplicates do not occur.</span></span>  
  
 <span data-ttu-id="a7725-107">たとえば、パブリッシャーに 1 ～ 100 の範囲を、サブスクライバー A に 101 ～ 200 の範囲を、サブスクライバー B に 201 ～ 300 の範囲を、それぞれ割り当てることができます。</span><span class="sxs-lookup"><span data-stu-id="a7725-107">For example, the Publisher could be assigned the range 1-100, Subscriber A the range 101-200, and Subscriber B the range 201-300.</span></span> <span data-ttu-id="a7725-108">パブリッシャーに行が挿入され、ID 値がたとえば 65 の場合、この値が各サブスクライバーにレプリケートされます。</span><span class="sxs-lookup"><span data-stu-id="a7725-108">If a row is inserted at the Publisher and the identity value is, for example, 65, that value is replicated to each Subscriber.</span></span> <span data-ttu-id="a7725-109">レプリケーションによって各サブスクライバーにデータが挿入されると、サブスクライバー テーブル内の ID 列の値は増えずに、リテラル値 65 が挿入されます。</span><span class="sxs-lookup"><span data-stu-id="a7725-109">When replication inserts data at each Subscriber, it does not increment the identity column value in the Subscriber table; instead, the literal value 65 is inserted.</span></span> <span data-ttu-id="a7725-110">ID 列の値が増えるのは、ユーザーによる挿入のみで、レプリケーション エージェントの挿入では増えません。</span><span class="sxs-lookup"><span data-stu-id="a7725-110">Only user inserts, but not replication agent inserts cause the identity column value to be incremented.</span></span>  
  
 <span data-ttu-id="a7725-111">レプリケーションではすべての種類のパブリケーションおよびサブスクリプションの ID 列が処理され、列は手動で管理することも、レプリケーションで自動で管理することもできます。</span><span class="sxs-lookup"><span data-stu-id="a7725-111">Replication handles identity columns across all publication and subscription types, allowing you to manage the columns manually or have replication manage them automatically.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="a7725-112">パブリッシュされたテーブルに ID 列を追加することはサポートされていません。これは、列がサブスクライバーにレプリケートされると集約されなくなる可能性があるからです。</span><span class="sxs-lookup"><span data-stu-id="a7725-112">Adding an identity column to a published table is not supported, because it can result in non-convergence when the column is replicated to the Subscriber.</span></span> <span data-ttu-id="a7725-113">パブリッシャーの ID 列の値は、影響を受けるテーブルの行が物理的に格納されている順序に依存します。</span><span class="sxs-lookup"><span data-stu-id="a7725-113">The values in the identity column at the Publisher depend on the order in which the rows for the affected table are physically stored.</span></span> <span data-ttu-id="a7725-114">サブスクライバーで行が同じように格納されているとは限らないため、同じ行で ID 列の値が異なる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="a7725-114">The rows might be stored differently at the Subscriber; therefore the value for the identity column can be different for the same rows.</span></span>  
  
## <a name="specifying-an-identity-range-management-option"></a><span data-ttu-id="a7725-115">ID 範囲の管理オプションの指定</span><span class="sxs-lookup"><span data-stu-id="a7725-115">Specifying an Identity Range Management Option</span></span>  
 <span data-ttu-id="a7725-116">レプリケーションには、次の 3 つの ID 範囲の管理オプションがあります。</span><span class="sxs-lookup"><span data-stu-id="a7725-116">Replication offers three identity range management options:</span></span>  
  
-   <span data-ttu-id="a7725-117">自動。</span><span class="sxs-lookup"><span data-stu-id="a7725-117">Automatic.</span></span> <span data-ttu-id="a7725-118">サブスクリプションでの更新を使用するマージ レプリケーションおよびトランザクション レプリケーションで使用されます。</span><span class="sxs-lookup"><span data-stu-id="a7725-118">Used for merge replication and transactional replication with updates at the Subscriber.</span></span> <span data-ttu-id="a7725-119">パブリッシャーおよびサブスクライバーのサイズの範囲を指定し、レプリケーションによって新しい範囲の割り当てを自動的に管理します。</span><span class="sxs-lookup"><span data-stu-id="a7725-119">Specify size ranges for the Publisher and Subscribers, and replication automatically manages the assignment of new ranges.</span></span> <span data-ttu-id="a7725-120">レプリケーションによって、サブスクライバーの ID 列に NOT FOR REPLICATION オプションが設定されるため、サブスクライバーではユーザーの挿入のみによって値が増えます。</span><span class="sxs-lookup"><span data-stu-id="a7725-120">Replication sets the NOT FOR REPLICATION option on the identity column at the Subscriber, so that only user inserts cause the value to be incremented at the Subscriber.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="a7725-121">サブスクライバーは、パブリッシャーと同期して新しい範囲を受け取る必要があります。</span><span class="sxs-lookup"><span data-stu-id="a7725-121">Subscribers must synchronize with the Publisher to receive new ranges.</span></span> <span data-ttu-id="a7725-122">サブスクライバーには ID の範囲が自動的に割り当てられるため、サブスクライバーが新しい範囲を繰り返し要求すると、サブスクライバーは ID 範囲をすべて使用してしまう可能性があります。</span><span class="sxs-lookup"><span data-stu-id="a7725-122">Because Subscribers are assigned identity ranges automatically, it is possible for any Subscriber to exhaust the entire supply of identity ranges if it repeatedly requests new ranges.</span></span>  
  
-   <span data-ttu-id="a7725-123">手動。</span><span class="sxs-lookup"><span data-stu-id="a7725-123">Manual.</span></span> <span data-ttu-id="a7725-124">サブスクライバーでの更新を使用しないスナップショット レプリケーションおよびトランザクション レプリケーション、ピア ツー ピア トランザクション レプリケーション、またはアプリケーションがプログラムを介して ID 範囲を管理する必要がある場合に使用されます。</span><span class="sxs-lookup"><span data-stu-id="a7725-124">Used for snapshot and transactional replication without updates at the Subscriber, peer-to-peer transactional replication, or if your application must control identity ranges programmatically.</span></span> <span data-ttu-id="a7725-125">手動による管理を指定した場合は、範囲をパブリッシャーおよび各サブスクライバーに割り当て、初期の範囲が使用された場合は新しい範囲を割り当てる必要があります。</span><span class="sxs-lookup"><span data-stu-id="a7725-125">If you specify manual management, you must ensure that ranges are assigned to the Publisher and each Subscriber and that new ranges are assigned if the initial ranges are used.</span></span> <span data-ttu-id="a7725-126">レプリケーションによって、サブスクライバーの ID 列に NOT FOR REPLICATION オプションが設定されます。</span><span class="sxs-lookup"><span data-stu-id="a7725-126">Replication sets the NOT FOR REPLICATION option on the identity column at the Subscriber.</span></span>  
  
-   <span data-ttu-id="a7725-127">[なし] :</span><span class="sxs-lookup"><span data-stu-id="a7725-127">None.</span></span> <span data-ttu-id="a7725-128">このオプションは、 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] の以前のバージョンとの互換性が必要な場合のみ使用することをお勧めします。また、このオプションは、トランザクション パブリケーションのストアド プロシージャ インターフェイスからのみ使用できます。</span><span class="sxs-lookup"><span data-stu-id="a7725-128">This option is recommended only for backwards compatibility with earlier versions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] and is available only from the stored procedure interface for transactional publications.</span></span>  
  
 <span data-ttu-id="a7725-129">ID 範囲の管理のオプションを指定するには、「[ID 列の管理](manage-identity-columns.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a7725-129">To specify an identity range management option, see [Manage Identity Columns](manage-identity-columns.md).</span></span>  
  
## <a name="assigning-identity-ranges"></a><span data-ttu-id="a7725-130">ID 範囲の割り当て</span><span class="sxs-lookup"><span data-stu-id="a7725-130">Assigning Identity Ranges</span></span>  
 <span data-ttu-id="a7725-131">マージ レプリケーションとトランザクション レプリケーションでは、範囲の割り当てにさまざまな方法を使用します。これらの方法についてこのセクションで説明します。</span><span class="sxs-lookup"><span data-stu-id="a7725-131">Merge replication and transactional replication use different methods for assigning ranges; these methods are described in this section.</span></span>  
  
 <span data-ttu-id="a7725-132">ID 列をレプリケートする場合は 2 種類の範囲を考慮する必要があります。1 つはパブリッシャーおよびサブスクライバーに割り当てる範囲で、もう 1 つは列のデータ型の範囲です。</span><span class="sxs-lookup"><span data-stu-id="a7725-132">There are two types of ranges to take into account when replicating identity columns: the ranges assigned to the Publisher and Subscribers, and the range of the data type in the column.</span></span> <span data-ttu-id="a7725-133">以下の表に、ID 列で通常使用されるデータ型で利用可能な範囲を示します。</span><span class="sxs-lookup"><span data-stu-id="a7725-133">The following table shows the ranges available for the data types typically used in identity columns.</span></span> <span data-ttu-id="a7725-134">この範囲は、トポロジ内のすべてのノードで使用されます。</span><span class="sxs-lookup"><span data-stu-id="a7725-134">The range is used across all nodes in a topology.</span></span> <span data-ttu-id="a7725-135">たとえば、増分値が `smallint` 1 の1から始まるを使用する場合、挿入の最大数は、パブリッシャーとすべてのサブスクライバーに対して32767になります。</span><span class="sxs-lookup"><span data-stu-id="a7725-135">For example, if you use `smallint` starting at 1 with an increment of 1, the maximum number of inserts is 32,767 for the Publisher and all Subscribers.</span></span> <span data-ttu-id="a7725-136">実際の挿入数は、使用する値にギャップがあるかどうか、およびしきい値が使用されているかどうかによって変わります。</span><span class="sxs-lookup"><span data-stu-id="a7725-136">The actual number of inserts depends on whether there are gaps in the values used and whether a threshold value is used.</span></span> <span data-ttu-id="a7725-137">しきい値の詳細については、「マージ レプリケーション」「キュー更新サブスクリプションを使用するトランザクション レプリケーション」のセクションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="a7725-137">For more information about thresholds, see the following sections "Merge Replication" and "Transactional Replication with Queued Updating Subscriptions".</span></span>  
  
 <span data-ttu-id="a7725-138">挿入が **db_owner** 固定データベース ロールのメンバーによって実行されている場合は、パブリッシャーがその挿入後に ID 範囲をすべて使用すると、新しい範囲が自動的に割り当てられます。</span><span class="sxs-lookup"><span data-stu-id="a7725-138">If the Publisher exhausts its identity range after an insert, it can automatically assign a new range if the insert was performed by a member of the **db_owner** fixed database role.</span></span> <span data-ttu-id="a7725-139">挿入がそのロール以外のユーザー、ログ リーダー エージェント、マージ エージェントによって実行されている場合は、**db_owner** ロールのメンバーであるユーザーが [sp_adjustpublisheridentityrange &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adjustpublisheridentityrange-transact-sql) を実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a7725-139">If the insert was performed by a user not in that role, the Log Reader Agent, Merge Agent, or a user who is a member of the **db_owner** role must run [sp_adjustpublisheridentityrange &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adjustpublisheridentityrange-transact-sql).</span></span> <span data-ttu-id="a7725-140">トランザクション パブリケーションの場合は、ログ リーダー エージェントを実行して新しい範囲を自動で割り当てる必要があります (既定ではエージェントは継続して実行されます)。</span><span class="sxs-lookup"><span data-stu-id="a7725-140">For transactional publications, the Log Reader Agent must be running to automatically allocate a new range (the default is for the agent to run continuously).</span></span>  
  
> [!WARNING]  
>  <span data-ttu-id="a7725-141">大規模な一括挿入処理中、レプリケーション トリガーが起動されるのは、挿入の行ごとではなく 1 度だけです。</span><span class="sxs-lookup"><span data-stu-id="a7725-141">During a large batch insert the replication trigger is fired only once, not for each row of the insert.</span></span> <span data-ttu-id="a7725-142">その結果、大規模な挿入処理中に ID 範囲が使い果たされると、`INSERT INTO` ステートメントなど、挿入ステートメントが失敗する場合があります。</span><span class="sxs-lookup"><span data-stu-id="a7725-142">This can lead to a failure of the insert statement if an identity range is exhausted during an large insert, such as an `INSERT INTO` statement.</span></span>  
  
|<span data-ttu-id="a7725-143">データ型</span><span class="sxs-lookup"><span data-stu-id="a7725-143">Data type</span></span>|<span data-ttu-id="a7725-144">Range</span><span class="sxs-lookup"><span data-stu-id="a7725-144">Range</span></span>|  
|---------------|-----------|  
|`tinyint`|<span data-ttu-id="a7725-145">自動管理ではサポートされません。</span><span class="sxs-lookup"><span data-stu-id="a7725-145">Not supported for automatic management</span></span>|  
|`smallint`|<span data-ttu-id="a7725-146">-2^15 (-32,768) ～ 2^15-1 (32,767)</span><span class="sxs-lookup"><span data-stu-id="a7725-146">-2^15 (-32,768) to 2^15-1 (32,767)</span></span>|  
|`int`|<span data-ttu-id="a7725-147">-2^31 (-2,147,483,648) ～ 2^31-1 (2,147,483,647)</span><span class="sxs-lookup"><span data-stu-id="a7725-147">-2^31 (-2,147,483,648) to 2^31-1 (2,147,483,647)</span></span>|  
|`bigint`|<span data-ttu-id="a7725-148">-2^63 (-9,223,372,036,854,775,808) ～ 2^63-1 (9,223,372,036,854,775,807)</span><span class="sxs-lookup"><span data-stu-id="a7725-148">-2^63 (-9,223,372,036,854,775,808) to 2^63-1 (9,223,372,036,854,775,807)</span></span>|  
|<span data-ttu-id="a7725-149">`decimal` および `numeric`</span><span class="sxs-lookup"><span data-stu-id="a7725-149">`decimal` and `numeric`</span></span>|<span data-ttu-id="a7725-150">-10^38+1 ～ 10^38-1</span><span class="sxs-lookup"><span data-stu-id="a7725-150">-10^38+1 through 10^38-1</span></span>|  
  
> [!NOTE]  
>  <span data-ttu-id="a7725-151">複数のテーブルで使用できる自動的に増分する番号、またはテーブルを参照せずにアプリケーションから呼び出すことができる自動的に増分する番号を作成するには、「[シーケンス番号](../../sequence-numbers/sequence-numbers.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a7725-151">To create an automatically incrementing number that can be used in multiple tables or that can be called from applications without referencing any table, see [Sequence Numbers](../../sequence-numbers/sequence-numbers.md).</span></span>  
  
### <a name="merge-replication"></a><span data-ttu-id="a7725-152">マージ レプリケーション</span><span class="sxs-lookup"><span data-stu-id="a7725-152">Merge Replication</span></span>  
 <span data-ttu-id="a7725-153">ID 範囲はパブリッシャーで管理されて、マージ エージェントによってサブスクライバーに反映されます (再パブリッシュ階層では、範囲はルートのパブリッシャーとリパブリッシャーで管理されます)。</span><span class="sxs-lookup"><span data-stu-id="a7725-153">Identity ranges are managed by the Publisher and propagated to Subscribers by the Merge Agent (in a republishing hierarchy, ranges are managed by the root Publisher and the republishers).</span></span> <span data-ttu-id="a7725-154">ID 値はパブリッシャーのプールから割り当てられます。</span><span class="sxs-lookup"><span data-stu-id="a7725-154">The identity values are assigned from a pool at the Publisher.</span></span> <span data-ttu-id="a7725-155">パブリケーションの新規作成ウィザードまたは [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) を使用して ID 列を含むアーティクルをパブリケーションに追加する場合は、次の値を指定します。</span><span class="sxs-lookup"><span data-stu-id="a7725-155">When you add an article with an identity column to a publication in the New Publication Wizard or by using [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql), you specify values for:</span></span>  
  
-   <span data-ttu-id="a7725-156">\*\* \@ Identity_range\*\*パラメーター。パブリッシャーと、クライアントサブスクリプションを使用するサブスクライバーの両方に最初に割り当てられる id 範囲のサイズを制御します。</span><span class="sxs-lookup"><span data-stu-id="a7725-156">The **\@identity_range** parameter, which controls the identity range size initially allocated both to the Publisher and to Subscribers with client subscriptions.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="a7725-157">以前のバージョンのを実行しているサブスクライバーの場合 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 、このパラメーター ( \*\* \@ pub_identity_range\*\*パラメーターではなく) では、再パブリッシュサブスクライバーの id 範囲のサイズも制御します。</span><span class="sxs-lookup"><span data-stu-id="a7725-157">For Subscribers running previous versions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], this parameter (rather than the **\@pub_identity_range** parameter) also controls the identity range size at republishing Subscribers.</span></span>  
  
-   <span data-ttu-id="a7725-158">\*\* \@ Pub_identity_range\*\*パラメーター。サーバーサブスクリプションを持つサブスクライバーに割り当てられた再パブリッシュの id 範囲のサイズを制御します (データの再パブリッシュに必要です)。</span><span class="sxs-lookup"><span data-stu-id="a7725-158">The **\@pub_identity_range** parameter, which controls the identity range size for republishing allocated to Subscribers with server subscriptions (required for republishing data).</span></span> <span data-ttu-id="a7725-159">サーバー サブスクリプションを使用するすべてのサブスクライバーは、実際にはデータを再パブリッシュしない場合でも、再パブリッシュ用の範囲を受け取ります。</span><span class="sxs-lookup"><span data-stu-id="a7725-159">All Subscribers with server subscriptions receive a range for republishing, even if they don't actually republish data.</span></span>  
  
-   <span data-ttu-id="a7725-160">\*\* \@ Threshold\*\*パラメーター [!INCLUDE[ssEW](../../../includes/ssew-md.md)] 。または以前のバージョンのに対するサブスクリプションに新しい id 範囲が必要な場合に、このパラメーターを使用して判断し [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] ます。</span><span class="sxs-lookup"><span data-stu-id="a7725-160">The **\@threshold** parameter, which is used to determine when a new range of identities is required for a subscription to [!INCLUDE[ssEW](../../../includes/ssew-md.md)] or a previous version of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span>  
  
 <span data-ttu-id="a7725-161">たとえば、 \*\* \@ identity_range**の場合は1万、 \*\* \@ pub_identity_range**の場合は50万を指定できます。</span><span class="sxs-lookup"><span data-stu-id="a7725-161">For example, you could specify 10000 for **\@identity_range** and 500000 for **\@pub_identity_range**.</span></span> <span data-ttu-id="a7725-162">[!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] 以降のバージョンを実行しているパブリッシャーとすべてのサブスクライバー (サーバー サブスクリプションを使用するサブスクライバーを含む) には、プライマリ範囲として 10,000 が割り当てられます。</span><span class="sxs-lookup"><span data-stu-id="a7725-162">The Publisher and all Subscribers running [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or a later version, including the Subscriber with the server subscription, are assigned a primary range of 10000.</span></span> <span data-ttu-id="a7725-163">サーバーサブスクリプションを使用するサブスクライバーには、50万のプライマリ範囲も割り当てられます。この範囲は、再パブリッシュサブスクライバーと同期するサブスクライバーで使用できます (再パブリッシュサブスクライバーのパブリケーションのアーティクルに対して、 \*\* \@ identity_range**、 \*\* \@ pub_identity_range**、および\*\* \@ しきい値\*\*も指定する必要があります)。</span><span class="sxs-lookup"><span data-stu-id="a7725-163">The Subscriber with the server subscription is also assigned a primary range of 500000, which can be used by Subscribers that synchronize with the republishing Subscriber (you must also specify **\@identity_range**, **\@pub_identity_range**, and **\@threshold** for the articles in the publication at the republishing Subscriber).</span></span>  
  
 <span data-ttu-id="a7725-164">[!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] 以降のバージョンを実行している各サブスクライバーは、セカンダリ ID 範囲も受け取ります。</span><span class="sxs-lookup"><span data-stu-id="a7725-164">Each Subscriber running [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or a later version also receives a secondary identity range.</span></span> <span data-ttu-id="a7725-165">セカンダリ範囲のサイズはプライマリ範囲のサイズと同じです。プライマリ範囲がすべて使用されると、セカンダリ範囲が使用されて、マージ エージェントによって新しい範囲がサブスクライバーに割り当てられます。</span><span class="sxs-lookup"><span data-stu-id="a7725-165">The secondary range is equal in size to the primary range; when the primary range is exhausted, the secondary range is used, and the Merge Agent assigns a new range to the Subscriber.</span></span> <span data-ttu-id="a7725-166">新しい範囲はセカンダリ範囲となり、サブスクライバーで ID 値が使用される限りこのプロセスは継続されます。</span><span class="sxs-lookup"><span data-stu-id="a7725-166">The new range becomes the secondary range, and the process continues as the Subscriber uses identity values.</span></span>  
  
  
### <a name="transactional-replication-with-queued-updating-subscriptions"></a><span data-ttu-id="a7725-167">キュー更新サブスクリプションを使用するトランザクション レプリケーション</span><span class="sxs-lookup"><span data-stu-id="a7725-167">Transactional Replication with Queued Updating Subscriptions</span></span>  
 <span data-ttu-id="a7725-168">ID 範囲はディストリビューターで管理されて、ディストリビューション エージェントによってサブスクライバーに反映されます。</span><span class="sxs-lookup"><span data-stu-id="a7725-168">Identity ranges are managed by the Distributor and propagated to Subscribers by the Distribution Agent.</span></span> <span data-ttu-id="a7725-169">ID 値はディストリビューターのプールから割り当てられます。</span><span class="sxs-lookup"><span data-stu-id="a7725-169">The identity values are assigned from a pool at the Distributor.</span></span> <span data-ttu-id="a7725-170">プールのサイズは、データ型のサイズと、ID 列に対して使用される増分に基づいています。</span><span class="sxs-lookup"><span data-stu-id="a7725-170">The pool size is based on the size of the data type and the increment used for the identity column.</span></span> <span data-ttu-id="a7725-171">パブリケーションの新規作成ウィザードまたは [sp_addarticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addarticle-transact-sql) を使用して ID 列を含むアーティクルをパブリケーションに追加する場合は、次の値を指定します。</span><span class="sxs-lookup"><span data-stu-id="a7725-171">When you add an article with an identity column to a publication in the New Publication Wizard or by using [sp_addarticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addarticle-transact-sql), you specify values for:</span></span>  
  
-   <span data-ttu-id="a7725-172">\*\* \@ Identity_range\*\*パラメーター。すべてのサブスクライバーに最初に割り当てられた id 範囲のサイズを制御します。</span><span class="sxs-lookup"><span data-stu-id="a7725-172">The **\@identity_range** parameter, which controls the identity range size initially allocated to all Subscribers.</span></span>  
  
-   <span data-ttu-id="a7725-173">\*\* \@ Pub_identity_range\*\*パラメーター。パブリッシャーに割り当てる id 範囲のサイズを制御します。</span><span class="sxs-lookup"><span data-stu-id="a7725-173">The **\@pub_identity_range** parameter, which controls the identity range size allocated to the Publisher.</span></span>  
  
-   <span data-ttu-id="a7725-174">\*\* \@ Threshold\*\*パラメーター。サブスクリプションに id の新しい範囲が必要かどうかを判断するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="a7725-174">The **\@threshold** parameter, which is used to determine when a new range of identities is required for a subscription.</span></span>  
  
 <span data-ttu-id="a7725-175">たとえば、 \*\* \@ pub_identity_range**の場合は1万、 \*\* \@ identity_range**の場合は 1000 (サブスクライバーでの更新回数が少なくなると想定)、 \*\* \@ しきい値\*\*の80% を指定できます。</span><span class="sxs-lookup"><span data-stu-id="a7725-175">For example, you could specify 10000 for **\@pub_identity_range**, 1000 for **\@identity_range** (assuming fewer updates at the Subscriber), and 80 percent for **\@threshold**.</span></span> <span data-ttu-id="a7725-176">サブスクライバーの挿入数が 800 (1,000 の 80%) を超えると、サブスクライバーに新しい範囲が割り当てられます。</span><span class="sxs-lookup"><span data-stu-id="a7725-176">After 800 inserts at a Subscriber (80 percent of 1000), a Subscriber is assigned a new range.</span></span> <span data-ttu-id="a7725-177">パブリッシャーの挿入数が 8,000 を超えると、パブリッシャーに新しい範囲が割り当てられます。</span><span class="sxs-lookup"><span data-stu-id="a7725-177">After 8000 inserts at the Publisher, the Publisher is assigned a new range.</span></span> <span data-ttu-id="a7725-178">新しい範囲が割り当てられると、テーブル内の ID 範囲値にはギャップが生じます。</span><span class="sxs-lookup"><span data-stu-id="a7725-178">When a new range is assigned, there will be a gap in the identity range values in the table.</span></span> <span data-ttu-id="a7725-179">高いしきい値を指定すると、ギャップは小さくなりますが、システムのフォールト トレランスは低くなります。ディストリビューション エージェントが何らかの理由で実行できない場合、サブスクライバーで ID の消費がさらに進みやすくなります。</span><span class="sxs-lookup"><span data-stu-id="a7725-179">Specifying a higher threshold results in smaller gaps, but the system is less fault-tolerant: if the Distribution Agent cannot run for some reason, a Subscriber could more easily run out of identities.</span></span>  
  
## <a name="assigning-ranges-for-manual-identity-range-management"></a><span data-ttu-id="a7725-180">手動で ID 範囲を管理する場合の範囲の割り当て</span><span class="sxs-lookup"><span data-stu-id="a7725-180">Assigning ranges for manual identity range management</span></span>  
 <span data-ttu-id="a7725-181">手動による ID 範囲の管理を指定した場合は、パブリッシャーと各サブスクライバーがそれぞれ異なる ID 範囲を使用することが必要です。</span><span class="sxs-lookup"><span data-stu-id="a7725-181">If you specify manual identity range management, you must ensure that the Publisher and each Subscriber use different identity ranges.</span></span> <span data-ttu-id="a7725-182">たとえば、 `IDENTITY(1,1)`と定義されている ID 列を含むパブリッシャーのテーブルがあるとします。ID 列は 1 から開始し、行が挿入されるたびに 1 ずつ増えていきます。</span><span class="sxs-lookup"><span data-stu-id="a7725-182">For example, consider a table at the Publisher with an identity column defined as `IDENTITY(1,1)`: the identity column starts at 1 and is incremented by 1 each time a row is inserted.</span></span> <span data-ttu-id="a7725-183">パブリッシャーのテーブルの行数が 5,000 で、アプリケーションを実行中にテーブルがある程度大きくなると考えられる場合、パブリッシャーでは範囲 1 ～ 10,000 を使用できます。</span><span class="sxs-lookup"><span data-stu-id="a7725-183">If the table at the Publisher has 5,000 rows, and you expect some growth in the table over the life of the application, the Publisher could use the range 1-10,000.</span></span> <span data-ttu-id="a7725-184">2 つのサブスクライバーの場合、サブスクライバー A では 10,001 ～ 20,000 を使用し、サブスクライバー B では 20,001 ～ 30,000 を使用できます。</span><span class="sxs-lookup"><span data-stu-id="a7725-184">Given two Subscribers, Subscriber A could use 10,001-20,000, and Subscriber B could use 20,001-30,000.</span></span>  
  
 <span data-ttu-id="a7725-185">サブスクライバーが、スナップショットまたは別の方法で初期化された後に、DBCC CHECKIDENT を実行してサブスクライバーに ID 範囲の開始位置を割り当てます。</span><span class="sxs-lookup"><span data-stu-id="a7725-185">After a Subscriber is initialized with a snapshot or through another means, execute DBCC CHECKIDENT to assign the Subscriber a starting point for its identity range.</span></span> <span data-ttu-id="a7725-186">たとえば、サブスクライバー A では、 `DBCC CHECKIDENT('<TableName>','reseed',10001)`を実行します。</span><span class="sxs-lookup"><span data-stu-id="a7725-186">For example, at Subscriber A, you would execute `DBCC CHECKIDENT('<TableName>','reseed',10001)`.</span></span> <span data-ttu-id="a7725-187">サブスクライバー B では、 `CHECKIDENT('<TableName>','reseed',20001)`を実行します。</span><span class="sxs-lookup"><span data-stu-id="a7725-187">At Subscriber B, you would execute `CHECKIDENT('<TableName>','reseed',20001)`.</span></span>  
  
 <span data-ttu-id="a7725-188">新しい範囲をパブリッシャーまたはサブスクライバーに割り当てるには、DBCC CHECKIDENT を実行し、新しい値を指定してテーブルを再作成します。</span><span class="sxs-lookup"><span data-stu-id="a7725-188">To assign new ranges to the Publisher or Subscribers, execute DBCC CHECKIDENT and specify a new value to reseed the table.</span></span> <span data-ttu-id="a7725-189">新しい範囲を割り当てる必要がある時点を指定するには、いくつかの方法があります。</span><span class="sxs-lookup"><span data-stu-id="a7725-189">You should have some way to determine when a new range must be assigned.</span></span> <span data-ttu-id="a7725-190">たとえば、ノードがその範囲をすべて使用しそうになったことを検出するメカニズムをアプリケーションに用意し、DBCC CHECKIDENT を使用して新しい範囲を割り当てることができます。</span><span class="sxs-lookup"><span data-stu-id="a7725-190">For example, your application could have a mechanism that detects when a node is about to use up its range and assign a new range using DBCC CHECKIDENT.</span></span> <span data-ttu-id="a7725-191">また、CHECK 制約を追加して、使用される範囲 ID 値が不足しそうになると行を追加できなくなるようにすることもできます。</span><span class="sxs-lookup"><span data-stu-id="a7725-191">You can also add a check constraint to ensure that a row cannot be added if it would cause an out of range identity value to be used.</span></span>  
  
## <a name="handling-identity-ranges-after-a-database-restore"></a><span data-ttu-id="a7725-192">データベース復元後の ID 範囲の処理</span><span class="sxs-lookup"><span data-stu-id="a7725-192">Handling Identity Ranges after a Database Restore</span></span>  
 <span data-ttu-id="a7725-193">自動 ID 範囲の管理を使用している場合、サブスクライバーがバックアップから復元されたときに、新しい ID 値の範囲が自動的に要求されます。</span><span class="sxs-lookup"><span data-stu-id="a7725-193">If you are using automatic identity range management, when a Subscriber is restored from a backup, it automatically requests a new range of identity values.</span></span> <span data-ttu-id="a7725-194">パブリッシャーをバックアップから復元する場合は、パブリッシャーに適切な範囲を割り当てる必要があります。</span><span class="sxs-lookup"><span data-stu-id="a7725-194">If a Publisher is restored from a backup, you must ensure that the Publisher is assigned an appropriate range.</span></span> <span data-ttu-id="a7725-195">マージ レプリケーション用に、[sp_restoremergeidentityrange &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-restoremergeidentityrange-transact-sql) を使用して新しい範囲を割り当てます。</span><span class="sxs-lookup"><span data-stu-id="a7725-195">For merge replication, assign a new range using [sp_restoremergeidentityrange &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-restoremergeidentityrange-transact-sql).</span></span> <span data-ttu-id="a7725-196">トランザクション レプリケーションの場合は、使用されている最も高い値を特定してから、新しい範囲の開始位置を設定します。</span><span class="sxs-lookup"><span data-stu-id="a7725-196">For transactional replication, determine the highest value that has been used and then set the starting point for new ranges.</span></span> <span data-ttu-id="a7725-197">パブリケーション データベースが復元された後に次の手順を実行します。</span><span class="sxs-lookup"><span data-stu-id="a7725-197">Use the following procedure after the publication database has been restored:</span></span>  
  
1.  <span data-ttu-id="a7725-198">すべてのサブスクライバーのすべての操作を停止します。</span><span class="sxs-lookup"><span data-stu-id="a7725-198">Stop all activity on all Subscribers.</span></span>  
  
2.  <span data-ttu-id="a7725-199">ID 列を含むパブリッシュされたテーブルごとに、以下を実行します。</span><span class="sxs-lookup"><span data-stu-id="a7725-199">For each published table that includes an identity column:</span></span>  
  
    1.  <span data-ttu-id="a7725-200">各サブスクライバーのサブスクリプション データベースで `IDENT_CURRENT('<TableName>')`を実行します。</span><span class="sxs-lookup"><span data-stu-id="a7725-200">In the subscription database at each Subscriber, execute `IDENT_CURRENT('<TableName>')`.</span></span>  
  
    2.  <span data-ttu-id="a7725-201">すべてのサブスクライバーで検出された最も高い値を記録します。</span><span class="sxs-lookup"><span data-stu-id="a7725-201">Record the highest value found across all Subscribers.</span></span>  
  
    3.  <span data-ttu-id="a7725-202">パブリッシャーのパブリケーション データベースで、 `DBCC CHECKIDENT(<TableName>','reseed',<HighestValueFound+1>`) を実行します。</span><span class="sxs-lookup"><span data-stu-id="a7725-202">In the publication database at the Publisher, execute `DBCC CHECKIDENT(<TableName>','reseed',<HighestValueFound+1>`).</span></span>  
  
    4.  <span data-ttu-id="a7725-203">パブリッシャーのパブリケーション データベースで、 `sp_adjustpublisheridentityrange <PublicationName>, <TableName>`を実行します。</span><span class="sxs-lookup"><span data-stu-id="a7725-203">In the publication database at the Publisher, execute `sp_adjustpublisheridentityrange <PublicationName>, <TableName>`.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="a7725-204">ID 列の値が増分ではなく減分に設定されている場合は、検出された最も低い値を記録してから、その値から新しい範囲を設定します。</span><span class="sxs-lookup"><span data-stu-id="a7725-204">If the value in the identity column is set to decrement rather than increment, record the lowest value found, and then reseed with that value.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="a7725-205">参照</span><span class="sxs-lookup"><span data-stu-id="a7725-205">See Also</span></span>  
 <span data-ttu-id="a7725-206">[BACKUP &#40;Transact-SQL&#41;](/sql/t-sql/statements/backup-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="a7725-206">[BACKUP &#40;Transact-SQL&#41;](/sql/t-sql/statements/backup-transact-sql) </span></span>  
 <span data-ttu-id="a7725-207">[DBCC CHECKIDENT &#40;Transact-SQL&#41;](/sql/t-sql/database-console-commands/dbcc-checkident-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="a7725-207">[DBCC CHECKIDENT &#40;Transact-SQL&#41;](/sql/t-sql/database-console-commands/dbcc-checkident-transact-sql) </span></span>  
 <span data-ttu-id="a7725-208">[IDENT_CURRENT &#40;Transact-SQL&#41;](/sql/t-sql/functions/ident-current-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="a7725-208">[IDENT_CURRENT &#40;Transact-SQL&#41;](/sql/t-sql/functions/ident-current-transact-sql) </span></span>  
 <span data-ttu-id="a7725-209">[IDENTITY &#40;Property&#41; &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-table-transact-sql-identity-property) </span><span class="sxs-lookup"><span data-stu-id="a7725-209">[IDENTITY &#40;Property&#41; &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-table-transact-sql-identity-property) </span></span>  
 [<span data-ttu-id="a7725-210">sp_adjustpublisheridentityrange &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="a7725-210">sp_adjustpublisheridentityrange &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-stored-procedures/sp-adjustpublisheridentityrange-transact-sql)  
  
  
