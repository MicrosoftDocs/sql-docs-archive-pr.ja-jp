---
title: パブリケーションの作成 | Microsoft Docs
ms.custom: ''
ms.date: 06/30/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- publications [SQL Server replication], creating
- articles [SQL Server replication], defining
- adding articles
- articles [SQL Server replication], adding
ms.assetid: 52ee6de9-1d58-4cb9-8711-372bddbe7154
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 14d8b3f1a998b18ae0153c1771fa11afd925da9c
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87645524"
---
# <a name="create-a-publication"></a><span data-ttu-id="bd3dc-102">パブリケーションの作成</span><span class="sxs-lookup"><span data-stu-id="bd3dc-102">Create a Publication</span></span>
  <span data-ttu-id="bd3dc-103">このトピックでは、 [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] で [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)]、 [!INCLUDE[tsql](../../../includes/tsql-md.md)]、またはレプリケーション管理オブジェクト (RMO) を使用して、パブリケーションを作成する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-103">This topic describes how to create a publication in [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] by using [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../../includes/tsql-md.md)], or Replication Management Objects (RMO).</span></span>  
  
 <span data-ttu-id="bd3dc-104">**このトピックの内容**</span><span class="sxs-lookup"><span data-stu-id="bd3dc-104">**In This Topic**</span></span>  
  
-   <span data-ttu-id="bd3dc-105">**作業を開始する準備:**</span><span class="sxs-lookup"><span data-stu-id="bd3dc-105">**Before you begin:**</span></span>  
  
     [<span data-ttu-id="bd3dc-106">制限事項と制約事項</span><span class="sxs-lookup"><span data-stu-id="bd3dc-106">Limitations and Restrictions</span></span>](#Restrictions)  
  
     [<span data-ttu-id="bd3dc-107">Security</span><span class="sxs-lookup"><span data-stu-id="bd3dc-107">Security</span></span>](#Security)  
  
-   <span data-ttu-id="bd3dc-108">**パブリケーションを作成してアーティクルを定義するために使用するもの:**</span><span class="sxs-lookup"><span data-stu-id="bd3dc-108">**To create a publication and define articles, using:**</span></span>  
  
     [<span data-ttu-id="bd3dc-109">SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="bd3dc-109">SQL Server Management Studio</span></span>](#SSMSProcedure)  
  
     [<span data-ttu-id="bd3dc-110">Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="bd3dc-110">Transact-SQL</span></span>](#TsqlProcedure)  
  
     [<span data-ttu-id="bd3dc-111">レプリケーション管理オブジェクト (RMO)</span><span class="sxs-lookup"><span data-stu-id="bd3dc-111">Replication Management Objects (RMO)</span></span>](#RMOProcedure)  
  
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> <span data-ttu-id="bd3dc-112">はじめに</span><span class="sxs-lookup"><span data-stu-id="bd3dc-112">Before You Begin</span></span>  
  
###  <a name="limitations-and-restrictions"></a><a name="Restrictions"></a> <span data-ttu-id="bd3dc-113">制限事項と制約事項</span><span class="sxs-lookup"><span data-stu-id="bd3dc-113">Limitations and Restrictions</span></span>  
  
-   <span data-ttu-id="bd3dc-114">パブリケーション名およびアーティクル名には、% , \* , [ , ] , | , : , " , ? を使用できません。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-114">Publication and article names cannot include any of the following characters: % , \* , [ , ] , | , : , " , ?</span></span> <span data-ttu-id="bd3dc-115">, ' , \ , / , \< , >.</span><span class="sxs-lookup"><span data-stu-id="bd3dc-115">, ' , \ , / , \< , >.</span></span> <span data-ttu-id="bd3dc-116">データベースのオブジェクトにこれらの文字が含まれており、これらをレプリケートする場合は、 **[アーティクルのプロパティ - \<Article>]** ダイアログ ボックスで、オブジェクト名とは異なるアーティクル名を指定する必要があります。このダイアログ ボックスは、ウィザードの **[アーティクル]** ページから開くことができます。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-116">If objects in the database include any of these characters and you want to replicate them, you must specify an article name that is different from the object name in the **Article Properties - \<Article>** dialog box, which is available from the **Articles** page in the wizard.</span></span>  
  
###  <a name="security"></a><a name="Security"></a> <span data-ttu-id="bd3dc-117">セキュリティ</span><span class="sxs-lookup"><span data-stu-id="bd3dc-117">Security</span></span>  
 <span data-ttu-id="bd3dc-118">可能であれば、実行時、ユーザーに対してセキュリティ資格情報の入力を要求します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-118">When possible, prompt users to enter security credentials at runtime.</span></span> <span data-ttu-id="bd3dc-119">資格情報を保存する必要がある場合は、 [Windows .NET&#xA0;Framework に用意されている](https://go.microsoft.com/fwlink/?LinkId=34733) 暗号化サービス [!INCLUDE[msCoName](../../../includes/msconame-md.md)] を使用します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-119">If you must store credentials, use the [cryptographic services](https://go.microsoft.com/fwlink/?LinkId=34733) provided by the [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Windows .NET Framework.</span></span>  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> <span data-ttu-id="bd3dc-120">SQL Server Management Studio の使用</span><span class="sxs-lookup"><span data-stu-id="bd3dc-120">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="bd3dc-121">パブリケーションの新規作成ウィザードにより、パブリケーションを作成し、アーティクルを定義します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-121">Create publications and define articles with the New Publication Wizard.</span></span> <span data-ttu-id="bd3dc-122">パブリケーションを作成したら、 **[パブリケーションのプロパティ - \<Publication>]** ダイアログ ボックスでパブリケーションのプロパティを表示および変更します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-122">After a publication is created, view and modify publication properties in the **Publication Properties - \<Publication>** dialog box.</span></span> <span data-ttu-id="bd3dc-123">Oracle データベースからパブリケーションを作成する方法については、「[Create a Publication from an Oracle Database](create-a-publication-from-an-oracle-database.md)」(Oracle データベースからパブリケーションを作成する) をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-123">For information about creating a publication from an Oracle database, see [Create a Publication from an Oracle Database](create-a-publication-from-an-oracle-database.md).</span></span>  
  
#### <a name="to-create-a-publication-and-define-articles"></a><span data-ttu-id="bd3dc-124">パブリケーションを作成し、アーティクルを定義するには</span><span class="sxs-lookup"><span data-stu-id="bd3dc-124">To create a publication and define articles</span></span>  
  
1.  <span data-ttu-id="bd3dc-125">[!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] でパブリッシャーに接続し、サーバー ノードを展開します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-125">Connect to the Publisher in [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)], and then expand the server node.</span></span>  
  
2.  <span data-ttu-id="bd3dc-126">**[レプリケーション]** フォルダーを展開し、 **[ローカル パブリケーション]** フォルダーを右クリックします。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-126">Expand the **Replication** folder, and then right-click the **Local Publications** folder.</span></span>  
  
3.  <span data-ttu-id="bd3dc-127">**[新しいパブリケーション]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-127">Click **New Publication**.</span></span>  
  
4.  <span data-ttu-id="bd3dc-128">パブリケーションの新規作成ウィザードのページに従い、以下の操作を実行します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-128">Follow the pages in the New Publication Wizard to:</span></span>  
  
    -   <span data-ttu-id="bd3dc-129">サーバーでディストリビューションが構成されていない場合は、ディストリビューターを指定します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-129">Specify a Distributor if distribution has not been configured on the server.</span></span> <span data-ttu-id="bd3dc-130">ディストリビューションの構成の詳細については、「[Configure Publishing and Distribution](../configure-publishing-and-distribution.md)」(パブリッシュとディストリビューションの構成) をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-130">For more information about configuring distribution, see [Configure Publishing and Distribution](../configure-publishing-and-distribution.md).</span></span>  
  
         <span data-ttu-id="bd3dc-131">**[ディストリビューター]** ページで、パブリッシャー サーバーが独自のディストリビューター (ローカル ディストリビューター) として機能するように指定した場合、このサーバーはディストリビューターとして構成されていないため、パブリケーションの新規作成ウィザードでサーバーを構成します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-131">If you specify on the **Distributor** page that the Publisher server will act as its own Distributor (a local Distributor), and the server is not configured as a Distributor, the New Publication Wizard will configure the server.</span></span> <span data-ttu-id="bd3dc-132">**[スナップショット フォルダー]** ページで、ディストリビューターの既定のスナップショット フォルダーを指定します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-132">You will specify a default snapshot folder for the Distributor on the **Snapshot Folder** page.</span></span> <span data-ttu-id="bd3dc-133">スナップショット フォルダーは、共有として指定したディレクトリです。このフォルダーの読み取りと書き込みをするエージェントには、このフォルダーへのアクセスを可能にする十分な権限が必要です。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-133">The snapshot folder is simply a directory that you have designated as a share; agents that read from and write to this folder must have sufficient permissions to access it.</span></span> <span data-ttu-id="bd3dc-134">フォルダーの適切なセキュリティ保護の詳細については、「[Secure the Snapshot Folder](../security/secure-the-snapshot-folder.md)」(スナップショット フォルダーのセキュリティ保護) をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-134">For more information about securing the folder appropriately, see [Secure the Snapshot Folder](../security/secure-the-snapshot-folder.md).</span></span>  
  
         <span data-ttu-id="bd3dc-135">別のサーバーがディストリビューターとして機能するように指定する場合は、パブリッシャーからディストリビューターへの接続のため、 **[管理パスワード]** ページでパスワードを入力する必要があります。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-135">If you specify that another server should act as the Distributor, you must enter a password on the **Administrative Password** page for connections made from the Publisher to the Distributor.</span></span> <span data-ttu-id="bd3dc-136">このパスワードは、リモート ディストリビューターでパブリッシャーを有効にしたときに指定したパスワードと一致する必要があります。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-136">This password must match the password specified when the Publisher was enabled at the remote Distributor.</span></span>  
  
         <span data-ttu-id="bd3dc-137">詳しくは、「 [Configure Distribution](../configure-distribution.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-137">For more information, see [Configure Distribution](../configure-distribution.md).</span></span>  
  
    -   <span data-ttu-id="bd3dc-138">パブリケーション データベースを選択します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-138">Choose a publication database.</span></span>  
  
    -   <span data-ttu-id="bd3dc-139">パブリケーションの種類を選択します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-139">Select a publication type.</span></span> <span data-ttu-id="bd3dc-140">詳細については、「[Types of Replication](../types-of-replication.md)」(レプリケーションの種類) をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-140">For more information, see [Types of Replication](../types-of-replication.md).</span></span>  
  
    -   <span data-ttu-id="bd3dc-141">パブリッシュするデータおよびデータベース オブジェクトを指定します。必要に応じて、テーブル アーティクルから列をフィルター選択し、アーティクルのプロパティを設定します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-141">Specify data and database objects to publish; optionally filter columns from table articles, and set article properties.</span></span>  
  
    -   <span data-ttu-id="bd3dc-142">必要に応じて、テーブル アーティクルから行をフィルター選択します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-142">Optionally filter rows from table articles.</span></span> <span data-ttu-id="bd3dc-143">詳細については、「[パブリッシュされたデータのフィルター選択](filter-published-data.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-143">For more information, see [Filter Published Data](filter-published-data.md).</span></span>  
  
    -   <span data-ttu-id="bd3dc-144">スナップショット エージェントのスケジュールを設定します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-144">Set the Snapshot Agent schedule.</span></span>  
  
    -   <span data-ttu-id="bd3dc-145">以下のレプリケーション エージェントの実行および接続に使用される資格情報を指定します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-145">Specify the credentials under which the following replication agents run and make connections:</span></span>  
  
         <span data-ttu-id="bd3dc-146">\-すべてのパブリケーション用のスナップショット エージェント。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-146">\- Snapshot Agent for all publications.</span></span>  
  
         <span data-ttu-id="bd3dc-147">\-すべてのトランザクション パブリケーション用のログ リーダー エージェント。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-147">\- Log Reader Agent for all transactional publications.</span></span>  
  
         <span data-ttu-id="bd3dc-148">\-更新サブスクリプションを許可するトランザクション パブリケーションのキュー リーダー エージェント。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-148">\- Queue Reader Agent for transactional publications that allow updating subscriptions.</span></span>  
  
         <span data-ttu-id="bd3dc-149">詳細については、「 [Replication Agent Security Model](../security/replication-agent-security-model.md) 」および「 [Replication Security Best Practices](../security/replication-security-best-practices.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-149">For more information, see [Replication Agent Security Model](../security/replication-agent-security-model.md) and [Replication Security Best Practices](../security/replication-security-best-practices.md).</span></span>  
  
    -   <span data-ttu-id="bd3dc-150">必要に応じて、パブリケーションのスクリプトを作成します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-150">Optionally script the publication.</span></span> <span data-ttu-id="bd3dc-151">詳細については、「[レプリケーションのスクリプト作成](../scripting-replication.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-151">For more information, see [Scripting Replication](../scripting-replication.md).</span></span>  
  
    -   <span data-ttu-id="bd3dc-152">パブリケーションの名前を指定します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-152">Specify a name for the publication.</span></span>  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="bd3dc-153">Transact-SQL の使用</span><span class="sxs-lookup"><span data-stu-id="bd3dc-153">Using Transact-SQL</span></span>  
 <span data-ttu-id="bd3dc-154">パブリケーションは、レプリケーションのストアド プロシージャを使用してプログラムから作成できます。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-154">Publications can be created programmatically using replication stored procedures.</span></span> <span data-ttu-id="bd3dc-155">どのストアド プロシージャを使用するかは、作成するパブリケーションの種類によって異なります。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-155">The stored procedures that are used will depend on the type of publication being created.</span></span>  
  
#### <a name="to-create-a-snapshot-or-transactional-publication"></a><span data-ttu-id="bd3dc-156">スナップショット パブリケーションまたはトランザクション パブリケーションを作成するには</span><span class="sxs-lookup"><span data-stu-id="bd3dc-156">To create a snapshot or transactional publication</span></span>  
  
1.  <span data-ttu-id="bd3dc-157">パブリッシャーのパブリケーション データベースで [sp_replicationdboption &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-replicationdboption-transact-sql) を実行し、スナップショット レプリケーションまたはトランザクション レプリケーションを使用して現在のデータベースのパブリケーションを有効にします。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-157">At the Publisher on the publication database, execute [sp_replicationdboption &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-replicationdboption-transact-sql) to enable publication of the current database using snapshot or transactional replication.</span></span>  
  
2.  <span data-ttu-id="bd3dc-158">トランザクション パブリケーションの場合は、パブリケーション データベースのログ リーダー エージェント ジョブが存在するかどうかを確認します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-158">For a transactional publication, determine whether a Log Reader Agent job exists for the publication database.</span></span> <span data-ttu-id="bd3dc-159">スナップショット パブリケーションの場合、この手順は不要です。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-159">(This step is not required for snapshot publications.)</span></span>  
  
    -   <span data-ttu-id="bd3dc-160">パブリケーション データベースのログ リーダー エージェント ジョブが存在する場合は、手順 3. に進みます。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-160">If a Log Reader Agent job exists for the publication database, proceed to step 3.</span></span>  
  
    -   <span data-ttu-id="bd3dc-161">パブリッシュされたデータベース用のログ リーダー エージェント ジョブが存在するかどうかわからない場合は、パブリッシャー側のパブリケーション データベースに対して [sp_helplogreader_agent &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helplogreader-agent-transact-sql) を実行します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-161">If you are unsure whether a Log Reader Agent job exists for a published database, execute [sp_helplogreader_agent &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helplogreader-agent-transact-sql) at the Publisher on the publication database.</span></span>  
  
    -   <span data-ttu-id="bd3dc-162">結果セットが空の場合は、ログ リーダー エージェント ジョブを作成します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-162">If the result set is empty, create a Log Reader Agent job.</span></span> <span data-ttu-id="bd3dc-163">パブリッシャーで、[sp_addlogreader_agent &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addlogreader-agent-transact-sql) を実行します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-163">At the Publisher, execute [sp_addlogreader_agent &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addlogreader-agent-transact-sql).</span></span> <span data-ttu-id="bd3dc-164">エージェントの実行に使用される [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Windows 資格情報を **\@job_name** と **\@password** に指定します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-164">Specify the [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Windows credentials under which the agent runs for **\@job_name** and **\@password**.</span></span> <span data-ttu-id="bd3dc-165">エージェントがパブリッシャーに接続する際に SQL Server 認証を使用する場合は、 **\@publisher_security_mode** に **0** を指定し、 **\@publisher_login** と **\@publisher_password** に [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] ログイン情報を指定する必要もあります。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-165">If the agent will use SQL Server Authentication when connecting to the Publisher, you must also specify a value of **0** for **\@publisher_security_mode** and the [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] login information for **\@publisher_login** and **\@publisher_password**.</span></span> <span data-ttu-id="bd3dc-166">手順 3. に進みます。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-166">Proceed to step 3.</span></span>  
  
3.  <span data-ttu-id="bd3dc-167">パブリッシャーで、[sp_addpublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-transact-sql) を実行します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-167">At the Publisher, execute [sp_addpublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-transact-sql).</span></span> <span data-ttu-id="bd3dc-168">\*\* \@ パブリケーション**のパブリケーション名を指定し、 \*\* \@ repl_freq**パラメーターには、スナップショットパブリケーションの場合はの値を、 `snapshot` トランザクションパブリケーションの場合は値を指定し `continuous` ます。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-168">Specify a publication name for **\@publication**, and, for the **\@repl_freq** parameter, specify a value of `snapshot` for a snapshot publication or a value of `continuous` for a transactional publication.</span></span> <span data-ttu-id="bd3dc-169">必要に応じて、その他のパブリケーション オプションを指定してください。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-169">Specify any other publication options.</span></span> <span data-ttu-id="bd3dc-170">これにより、パブリケーションが定義されます。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-170">This defines the publication.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="bd3dc-171">パブリケーション名に、次の文字を含めることはできません。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-171">Publication names cannot include the following characters:</span></span>  
    >   
    >  <span data-ttu-id="bd3dc-172">% \* [ ] | : " ?</span><span class="sxs-lookup"><span data-stu-id="bd3dc-172">% \* [ ] | : " ?</span></span> <span data-ttu-id="bd3dc-173">\ / \< ></span><span class="sxs-lookup"><span data-stu-id="bd3dc-173">\ / \< ></span></span>  
  
4.  <span data-ttu-id="bd3dc-174">パブリッシャーで [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql) を実行します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-174">At the Publisher, execute [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span></span> <span data-ttu-id="bd3dc-175">手順 3 で使用したパブリケーション名を **\@publication** に指定し、スナップショット エージェントを実行するときに使用される Windows 資格情報を **\@snapshot_job_name** と **\@password** に指定します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-175">Specify the publication name used in step 3 for **\@publication** and the Windows credentials under which the Snapshot Agent runs for **\@snapshot_job_name** and **\@password**.</span></span> <span data-ttu-id="bd3dc-176">エージェントがパブリッシャーに接続する際に SQL Server 認証を使用する場合、さらに **\@publisher_security_mode** に **0** を指定し、 **\@publisher_login** と **\@publisher_password** に [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] ログイン情報を指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-176">If the agent will use SQL Server Authentication when connecting to the Publisher, you must also specify a value of **0** for **\@publisher_security_mode** and the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] login information for **\@publisher_login** and **\@publisher_password**.</span></span> <span data-ttu-id="bd3dc-177">これにより、パブリケーション用のスナップショット エージェント ジョブが作成されます。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-177">This creates a Snapshot Agent job for the publication.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="bd3dc-178">リモート ディストリビューターを使用するパブリッシャーを構成する場合は、 *job_login* および *job_password*を含むすべてのパラメーターに指定された値がディストリビューターにプレーン テキストとして送信されます。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-178">When configuring a Publisher with a remote Distributor, the values supplied for all parameters, including *job_login* and *job_password*, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="bd3dc-179">このストアド プロシージャを実行する前に、パブリッシャーとリモート ディストリビューターの間の接続を暗号化する必要があります。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-179">You should encrypt the connection between the Publisher and its remote Distributor before executing this stored procedure.</span></span> <span data-ttu-id="bd3dc-180">詳細については、「[データベース エンジンへの暗号化接続の有効化 &#40;SQL Server 構成マネージャー&#41;](../../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-180">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
5.  <span data-ttu-id="bd3dc-181">パブリケーションにアーティクルを追加します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-181">Add articles to the publication.</span></span> <span data-ttu-id="bd3dc-182">詳しくは、「 [アーティクルを定義](define-an-article.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-182">For more information, see [Define an Article](define-an-article.md).</span></span>  
  
6.  <span data-ttu-id="bd3dc-183">スナップショット エージェント ジョブを起動して、このパブリケーションの初期スナップショットを生成します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-183">Start the Snapshot Agent job to generate the initial snapshot for this publication.</span></span> <span data-ttu-id="bd3dc-184">詳しくは、「 [初期スナップショットの作成および適用](../create-and-apply-the-initial-snapshot.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-184">For more information, see [Create and Apply the Initial Snapshot](../create-and-apply-the-initial-snapshot.md).</span></span>  
  
#### <a name="to-create-a-merge-publication"></a><span data-ttu-id="bd3dc-185">マージ パブリケーションを作成するには</span><span class="sxs-lookup"><span data-stu-id="bd3dc-185">To create a merge publication</span></span>  
  
1.  <span data-ttu-id="bd3dc-186">パブリッシャーで [sp_replicationdboption &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-replicationdboption-transact-sql) を実行し、マージ レプリケーションを使用して現在のデータベースのパブリケーションを有効にします。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-186">At the Publisher, execute [sp_replicationdboption &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-replicationdboption-transact-sql) to enable publication of the current database using merge replication.</span></span>  
  
2.  <span data-ttu-id="bd3dc-187">パブリッシャー側のパブリケーション データベースに対して、[sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql) を実行します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-187">At the Publisher on the publication database, execute [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql).</span></span> <span data-ttu-id="bd3dc-188">**\@publication** にパブリケーションの名前を指定し、必要に応じて他のパブリケーション オプションを指定します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-188">Specify a name for the publication for **\@publication** and any other publication options.</span></span> <span data-ttu-id="bd3dc-189">これにより、パブリケーションが定義されます。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-189">This defines the publication.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="bd3dc-190">パブリケーション名に、次の文字を含めることはできません。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-190">Publication names cannot include the following characters:</span></span>  
    >   
    >  <span data-ttu-id="bd3dc-191">% \* [ ] | : " ?</span><span class="sxs-lookup"><span data-stu-id="bd3dc-191">% \* [ ] | : " ?</span></span> <span data-ttu-id="bd3dc-192">\ / \< ></span><span class="sxs-lookup"><span data-stu-id="bd3dc-192">\ / \< ></span></span>  
  
3.  <span data-ttu-id="bd3dc-193">パブリッシャーで [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql) を実行します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-193">At the Publisher, execute [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span></span> <span data-ttu-id="bd3dc-194">手順 2 で使用したパブリケーション名を **\@publication** に指定し、スナップショット エージェントを実行するときに使用される Windows 資格情報を **\@snapshot_job_name** と **\@password** に指定します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-194">Specify the publication name used in step 2 for **\@publication** and the Windows credentials under which the Snapshot Agent runs for **\@snapshot_job_name** and **\@password**.</span></span> <span data-ttu-id="bd3dc-195">エージェントがパブリッシャーに接続する際に SQL Server 認証を使用する場合、さらに **\@publisher_security_mode** に **0** を指定し、 **\@publisher_login** と **\@publisher_password** に [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] ログイン情報を指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-195">If the agent will use SQL Server Authentication when connecting to the Publisher, you must also specify a value of **0** for **\@publisher_security_mode** and the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] login information for **\@publisher_login** and **\@publisher_password**.</span></span> <span data-ttu-id="bd3dc-196">これにより、パブリケーション用のスナップショット エージェント ジョブが作成されます。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-196">This creates a Snapshot Agent job for the publication.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="bd3dc-197">リモート ディストリビューターを使用するパブリッシャーを構成する場合は、 *job_login* および *job_password*を含むすべてのパラメーターに指定された値がディストリビューターにプレーン テキストとして送信されます。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-197">When configuring a Publisher with a remote Distributor, the values supplied for all parameters, including *job_login* and *job_password*, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="bd3dc-198">このストアド プロシージャを実行する前に、パブリッシャーとリモート ディストリビューターの間の接続を暗号化する必要があります。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-198">You should encrypt the connection between the Publisher and its remote Distributor before executing this stored procedure.</span></span> <span data-ttu-id="bd3dc-199">詳細については、「[データベース エンジンへの暗号化接続の有効化 &#40;SQL Server 構成マネージャー&#41;](../../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-199">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
4.  <span data-ttu-id="bd3dc-200">パブリケーションにアーティクルを追加します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-200">Add articles to the publication.</span></span> <span data-ttu-id="bd3dc-201">詳しくは、「 [アーティクルを定義](define-an-article.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-201">For more information, see [Define an Article](define-an-article.md).</span></span>  
  
5.  <span data-ttu-id="bd3dc-202">スナップショット エージェント ジョブを起動して、このパブリケーションの初期スナップショットを生成します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-202">Start the Snapshot Agent job to generate the initial snapshot for this publication.</span></span> <span data-ttu-id="bd3dc-203">詳しくは、「 [初期スナップショットの作成および適用](../create-and-apply-the-initial-snapshot.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-203">For more information, see [Create and Apply the Initial Snapshot](../create-and-apply-the-initial-snapshot.md).</span></span>  
  
###  <a name="example-transact-sql"></a><a name="TsqlExample"></a> <span data-ttu-id="bd3dc-204">例 (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="bd3dc-204">Example (Transact-SQL)</span></span>  
 <span data-ttu-id="bd3dc-205">この例では、トランザクション パブリケーションを作成します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-205">This example creates a transactional publication.</span></span> <span data-ttu-id="bd3dc-206">スナップショット エージェント ジョブおよびログ リーダー エージェント ジョブの作成に必要な Windows 資格情報は、スクリプト変数を使用して渡しています。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-206">Scripting variables are used to pass Windows credentials that are needed to create jobs for the Snapshot Agent and Log Reader Agent.</span></span>  
  
 [!code-sql[HowTo#sp_AddTranPub](../../../snippets/tsql/SQL15/replication/howto/tsql/createtranpub.sql#sp_addtranpub)]  
  
 <span data-ttu-id="bd3dc-207">この例では、マージ パブリケーションを作成します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-207">This example creates a merge publication.</span></span> <span data-ttu-id="bd3dc-208">スナップショット エージェント ジョブの作成に必要な Windows 資格情報は、スクリプト変数を使用して渡しています。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-208">Scripting variables are used to pass Windows credentials that are needed to create the job for the Snapshot Agent.</span></span>  
  
 [!code-sql[HowTo#sp_AddMergePub](../../../snippets/tsql/SQL15/replication/howto/tsql/createmergepub.sql#sp_addmergepub)]  
  
##  <a name="using-replication-management-objects-rmo"></a><a name="RMOProcedure"></a> <span data-ttu-id="bd3dc-209">レプリケーション管理オブジェクト (RMO) の使用</span><span class="sxs-lookup"><span data-stu-id="bd3dc-209">Using Replication Management Objects (RMO)</span></span>  
 <span data-ttu-id="bd3dc-210">レプリケーション管理オブジェクト (RMO) を使用することで、プログラムによってパブリケーションを作成できます。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-210">You can create publications programmatically by using Replication Management Objects (RMO).</span></span> <span data-ttu-id="bd3dc-211">パブリケーションの作成に使用する RMO クラスは、作成するパブリケーションの種類によって異なります。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-211">The RMO classes that you use to create a publication depend on the type of publication you create.</span></span>  
  
#### <a name="to-create-a-snapshot-or-transactional-publication"></a><span data-ttu-id="bd3dc-212">スナップショット パブリケーションまたはトランザクション パブリケーションを作成するには</span><span class="sxs-lookup"><span data-stu-id="bd3dc-212">To create a snapshot or transactional publication</span></span>  
  
1.  <span data-ttu-id="bd3dc-213"><xref:Microsoft.SqlServer.Management.Common.ServerConnection> クラスを使用して、パブリッシャーへの接続を作成します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-213">Create a connection to the Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="bd3dc-214">パブリケーション データベースに <xref:Microsoft.SqlServer.Replication.ReplicationDatabase> クラスのインスタンスを作成するには、 <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> プロパティに手順 1. の <xref:Microsoft.SqlServer.Management.Common.ServerConnection> インスタンスを設定し、 <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-214">Create an instance of the <xref:Microsoft.SqlServer.Replication.ReplicationDatabase> class for the publication database, set the <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> property to the instance of <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 1, and call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method.</span></span> <span data-ttu-id="bd3dc-215"><xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> が `false` を返す場合、データベースが存在するかどうか確認してください。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-215">If <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> returns `false`, verify that the database exists.</span></span>  
  
3.  <span data-ttu-id="bd3dc-216"><xref:Microsoft.SqlServer.Replication.ReplicationDatabase.EnabledTransPublishing%2A> プロパティが `false` の場合、これを `true` に設定します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-216">If the <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.EnabledTransPublishing%2A> property is `false`, set it to `true`.</span></span>  
  
4.  <span data-ttu-id="bd3dc-217">トランザクション パブリケーションの場合は、<xref:Microsoft.SqlServer.Replication.ReplicationDatabase.LogReaderAgentExists%2A> プロパティの値を確認します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-217">For a transactional publication, check the value of the <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.LogReaderAgentExists%2A> property.</span></span> <span data-ttu-id="bd3dc-218">このプロパティが `true` の場合、このデータベースに対するログ リーダー エージェント ジョブが既に存在しています。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-218">If this property is `true`, a Log Read Agent job already exists for this database.</span></span> <span data-ttu-id="bd3dc-219">このプロパティが `false` の場合、次の操作を実行してください。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-219">If this property is `false`, do the following:</span></span>  
  
    -   <span data-ttu-id="bd3dc-220"><xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> の <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> フィールドおよび <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.SecurePassword%2A> (または <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.LogReaderAgentProcessSecurity%2A>) フィールドを設定して、ログ リーダー エージェントを実行するときに使用される [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Windows アカウントの資格情報を指定します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-220">Set the <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> and <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> or <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.SecurePassword%2A> fields of <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.LogReaderAgentProcessSecurity%2A> to provide the credentials for the [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Windows account under which the Log Reader Agent runs.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="bd3dc-221">パブリケーションが `sysadmin` 固定サーバー ロールのメンバーにより作成される場合、<xref:Microsoft.SqlServer.Replication.ReplicationDatabase.LogReaderAgentProcessSecurity%2A> の設定は不要です。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-221">Setting <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.LogReaderAgentProcessSecurity%2A> is not required when the publication is created by a member of the `sysadmin` fixed server role.</span></span> <span data-ttu-id="bd3dc-222">この場合、エージェントは SQL Server エージェントのアカウントを借用します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-222">In this case, the agent will impersonate the SQL Server Agent account.</span></span> <span data-ttu-id="bd3dc-223">詳細については、「 [レプリケーション エージェント セキュリティ モデル](../security/replication-agent-security-model.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-223">For more information, see [Replication Agent Security Model](../security/replication-agent-security-model.md).</span></span>  
  
    -   <span data-ttu-id="bd3dc-224">(省略可) SQL Server 認証を使用してパブリッシャーに接続する場合、 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> の <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> フィールドおよび <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> (または <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.LogReaderAgentPublisherSecurity%2A> ) フィールドを設定します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-224">(Optional) Set the <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> and <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> or <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> fields of <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.LogReaderAgentPublisherSecurity%2A> when using SQL Server Authentication to connect to the Publisher.</span></span>  
  
    -   <span data-ttu-id="bd3dc-225"><xref:Microsoft.SqlServer.Replication.ReplicationDatabase.CreateLogReaderAgent%2A> メソッドを呼び出して、データベースに対するログ リーダー エージェント ジョブを作成します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-225">Call the <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.CreateLogReaderAgent%2A> method to create the Log Reader Agent job for the database.</span></span>  
  
5.  <span data-ttu-id="bd3dc-226"><xref:Microsoft.SqlServer.Replication.TransPublication> クラスのインスタンスを作成し、このオブジェクトに次のプロパティを設定します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-226">Create an instance of the <xref:Microsoft.SqlServer.Replication.TransPublication> class, and set the following properties for this object:</span></span>  
  
    -   <span data-ttu-id="bd3dc-227">手順 1. の <xref:Microsoft.SqlServer.Management.Common.ServerConnection> を <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>に指定します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-227">The <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 1 for <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span></span>  
  
    -   <span data-ttu-id="bd3dc-228">パブリッシュするデータベースの名前を <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>に指定します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-228">The name of the published database for <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>.</span></span>  
  
    -   <span data-ttu-id="bd3dc-229"><xref:Microsoft.SqlServer.Replication.Publication.Name%2A>にパブリケーションの名前を指定します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-229">A name for the publication for <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>.</span></span>  
  
    -   <span data-ttu-id="bd3dc-230"><xref:Microsoft.SqlServer.Replication.PublicationType> または <xref:Microsoft.SqlServer.Replication.PublicationType.Transactional> の <xref:Microsoft.SqlServer.Replication.PublicationType.Snapshot>を指定します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-230">A <xref:Microsoft.SqlServer.Replication.PublicationType> of either <xref:Microsoft.SqlServer.Replication.PublicationType.Transactional> or <xref:Microsoft.SqlServer.Replication.PublicationType.Snapshot>.</span></span>  
  
    -   <span data-ttu-id="bd3dc-231"><xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> の <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> フィールドおよび <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> フィールドに、スナップショット エージェントの実行に使用する Windows アカウントの資格情報を指定します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-231">The <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> and <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> fields of <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> to provide the credentials for the Windows account under which the Snapshot Agent runs.</span></span> <span data-ttu-id="bd3dc-232">このアカウントは、Windows 認証を使用している場合に、スナップショット エージェントがローカル ディストリビューターへの接続や任意のリモート接続を行うときにも使用されます。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-232">This account is also used when the Snapshot Agent makes connections to the local Distributor and for any remote connections when using Windows Authentication.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="bd3dc-233">パブリケーションが `sysadmin` 固定サーバー ロールのメンバーにより作成される場合、<xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> の設定は不要です。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-233">Setting <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> is not required when the publication is created by a member of the `sysadmin` fixed server role.</span></span> <span data-ttu-id="bd3dc-234">この場合、エージェントは SQL Server エージェントのアカウントを借用します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-234">In this case, the agent will impersonate the SQL Server Agent account.</span></span> <span data-ttu-id="bd3dc-235">詳細については、「 [レプリケーション エージェント セキュリティ モデル](../security/replication-agent-security-model.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-235">For more information, see [Replication Agent Security Model](../security/replication-agent-security-model.md).</span></span>  
  
    -   <span data-ttu-id="bd3dc-236">(省略可) SQL Server 認証を使用してパブリッシャーに接続する場合、 <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> の <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> フィールドおよび <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> (または <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentPublisherSecurity%2A> ) フィールドを設定します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-236">(Optional) The <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> and <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> or <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> fields of <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentPublisherSecurity%2A> when using SQL Server Authentication to connect to the Publisher.</span></span>  
  
    -   <span data-ttu-id="bd3dc-237">(省略可) 包括的論理和演算子 (Visual C# では `|`、Visual Basic では `Or`) および排他的論理和演算子 (Visual C# では `^`、Visual Basic では `Xor`) を使用して、<xref:Microsoft.SqlServer.Replication.PublicationAttributes> プロパティに <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> の値を設定します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-237">(Optional) Use the inclusive logical OR operator (`|` in Visual C# and `Or` in Visual Basic) and the exclusive logical OR operator (`^` in Visual C# and `Xor` in Visual Basic) to set the <xref:Microsoft.SqlServer.Replication.PublicationAttributes> values for the <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> property.</span></span>  
  
    -   <span data-ttu-id="bd3dc-238">(省略可) パブリッシャーが SQL Server パブリッシャーでない場合、パブリッシャーの名前を <xref:Microsoft.SqlServer.Replication.TransPublication.PublisherName%2A> に指定します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-238">(Optional) The name of the Publisher for <xref:Microsoft.SqlServer.Replication.TransPublication.PublisherName%2A> when the Publisher is a non-SQL Server Publisher.</span></span>  
  
6.  <span data-ttu-id="bd3dc-239"><xref:Microsoft.SqlServer.Replication.Publication.Create%2A> メソッドを呼び出して、パブリケーションを作成します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-239">Call the <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> method to create the publication.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="bd3dc-240">リモート ディストリビューターを使用するパブリッシャーを構成する場合は、 <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A>を含むすべてのプロパティに指定された値がディストリビューターにプレーンテキストとして送信されます。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-240">When configuring a Publisher with a remote Distributor, the values supplied for all properties, including <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A>, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="bd3dc-241"><xref:Microsoft.SqlServer.Replication.Publication.Create%2A> メソッドを呼び出す前に、パブリッシャーとリモート ディストリビューター間の接続を暗号化する必要があります。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-241">You should encrypt the connection between the Publisher and its remote Distributor before calling the <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> method.</span></span> <span data-ttu-id="bd3dc-242">詳細については、「[データベース エンジンへの暗号化接続の有効化 &#40;SQL Server 構成マネージャー&#41;](../../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-242">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
7.  <span data-ttu-id="bd3dc-243"><xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> メソッドを呼び出して、パブリケーションに対するスナップショット エージェント ジョブを作成します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-243">Call the <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> method to create the Snapshot Agent job for the publication.</span></span>  
  
#### <a name="to-create-a-merge-publication"></a><span data-ttu-id="bd3dc-244">マージ パブリケーションを作成するには</span><span class="sxs-lookup"><span data-stu-id="bd3dc-244">To create a merge publication</span></span>  
  
1.  <span data-ttu-id="bd3dc-245"><xref:Microsoft.SqlServer.Management.Common.ServerConnection> クラスを使用して、パブリッシャーへの接続を作成します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-245">Create a connection to the Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="bd3dc-246">パブリケーション データベースに <xref:Microsoft.SqlServer.Replication.ReplicationDatabase> クラスのインスタンスを作成するには、 <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> プロパティに手順 1. の <xref:Microsoft.SqlServer.Management.Common.ServerConnection> インスタンスを設定し、 <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-246">Create an instance of the <xref:Microsoft.SqlServer.Replication.ReplicationDatabase> class for the publication database, set the <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> property to the instance of <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 1, and call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method.</span></span> <span data-ttu-id="bd3dc-247"><xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> が `false` を返す場合、データベースが存在するかどうか確認してください。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-247">If <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> returns `false`, verify that the database exists.</span></span>  
  
3.  <span data-ttu-id="bd3dc-248"><xref:Microsoft.SqlServer.Replication.ReplicationDatabase.EnabledMergePublishing%2A> プロパティが `false` の場合、このプロパティを `true` に設定し、<xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A> を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-248">If <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.EnabledMergePublishing%2A> Property is `false`, set it to `true`, and call <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A>.</span></span>  
  
4.  <span data-ttu-id="bd3dc-249"><xref:Microsoft.SqlServer.Replication.MergePublication> クラスのインスタンスを作成し、このオブジェクトに次のプロパティを設定します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-249">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class, and set the following properties for this object:</span></span>  
  
    -   <span data-ttu-id="bd3dc-250">手順 1. の <xref:Microsoft.SqlServer.Management.Common.ServerConnection> を <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>に指定します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-250">The <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 1 for <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span></span>  
  
    -   <span data-ttu-id="bd3dc-251">パブリッシュするデータベースの名前を <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>に指定します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-251">The name of the published database for <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>.</span></span>  
  
    -   <span data-ttu-id="bd3dc-252"><xref:Microsoft.SqlServer.Replication.Publication.Name%2A>にパブリケーションの名前を指定します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-252">A name for the publication for <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>.</span></span>  
  
    -   <span data-ttu-id="bd3dc-253"><xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> の <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> フィールドおよび <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> フィールドに、スナップショット エージェントの実行に使用する Windows アカウントの資格情報を指定します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-253">The <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> and <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> fields of <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> to provide the credentials for the Windows account under which the Snapshot Agent runs.</span></span> <span data-ttu-id="bd3dc-254">このアカウントは、Windows 認証を使用している場合に、スナップショット エージェントがローカル ディストリビューターへの接続や任意のリモート接続を行うときにも使用されます。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-254">This account is also used when the Snapshot Agent makes connections to the local Distributor and for any remote connections when using Windows Authentication.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="bd3dc-255">パブリケーションが `sysadmin` 固定サーバー ロールのメンバーにより作成される場合、<xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> の設定は不要です。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-255">Setting <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> is not required when the publication is created by a member of the `sysadmin` fixed server role.</span></span> <span data-ttu-id="bd3dc-256">詳細については、「 [レプリケーション エージェント セキュリティ モデル](../security/replication-agent-security-model.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-256">For more information, see [Replication Agent Security Model](../security/replication-agent-security-model.md).</span></span>  
  
    -   <span data-ttu-id="bd3dc-257">(省略可) 包括的論理和演算子 (Visual C# では `|`、Visual Basic では `Or`) および排他的論理和演算子 (Visual C# では `^`、Visual Basic では `Xor`) を使用して、<xref:Microsoft.SqlServer.Replication.PublicationAttributes> プロパティに <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> の値を設定します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-257">(Optional) Use the inclusive logical OR operator (`|` in Visual C# and `Or` in Visual Basic) and the exclusive logical OR operator (`^` in Visual C# and `Xor` in Visual Basic) to set the <xref:Microsoft.SqlServer.Replication.PublicationAttributes> values for the <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> property.</span></span>  
  
5.  <span data-ttu-id="bd3dc-258"><xref:Microsoft.SqlServer.Replication.Publication.Create%2A> メソッドを呼び出して、パブリケーションを作成します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-258">Call the <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> method to create the publication.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="bd3dc-259">リモート ディストリビューターを使用するパブリッシャーを構成する場合は、 <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A>を含むすべてのプロパティに指定された値がディストリビューターにプレーンテキストとして送信されます。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-259">When configuring a Publisher with a remote Distributor, the values supplied for all properties, including <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A>, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="bd3dc-260"><xref:Microsoft.SqlServer.Replication.Publication.Create%2A> メソッドを呼び出す前に、パブリッシャーとリモート ディストリビューター間の接続を暗号化する必要があります。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-260">You should encrypt the connection between the Publisher and its remote Distributor before calling the <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> method.</span></span> <span data-ttu-id="bd3dc-261">詳細については、「[データベース エンジンへの暗号化接続の有効化 &#40;SQL Server 構成マネージャー&#41;](../../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-261">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
6.  <span data-ttu-id="bd3dc-262"><xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> メソッドを呼び出して、パブリケーションに対するスナップショット エージェント ジョブを作成します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-262">Call the <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> method to create the Snapshot Agent job for the publication.</span></span>  
  
###  <a name="examples-rmo"></a><a name="PShellExample"></a> <span data-ttu-id="bd3dc-263">例 (RMO)</span><span class="sxs-lookup"><span data-stu-id="bd3dc-263">Examples (RMO)</span></span>  
 <span data-ttu-id="bd3dc-264">次の例では、AdventureWorks データベースでトランザクション パブリッシュを有効にして、ログ リーダー エージェント ジョブを定義し、AdvWorksProductTran パブリケーションを作成します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-264">This example enables the AdventureWorks database for transactional publishing, defines a Log Reader Agent job, and creates the AdvWorksProductTran publication.</span></span> <span data-ttu-id="bd3dc-265">このパブリケーションには、アーティクルを定義する必要があります。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-265">An article must be defined for this publication.</span></span> <span data-ttu-id="bd3dc-266">ログ リーダー エージェント ジョブとスナップショット エージェント ジョブの作成に必要な Windows アカウントの資格情報は、実行時に渡されます。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-266">The Windows account credentials that are needed to create the Log Reader Agent job and the Snapshot Agent job are passed at runtime.</span></span> <span data-ttu-id="bd3dc-267">RMO を使用してスナップショット アーティクルとトランザクション アーティクルを定義する方法については、「 [Define an Article](define-an-article.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-267">To learn how to use RMO to define snapshot and transactional articles, see [Define an Article](define-an-article.md).</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateTranPub](../../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createtranpub)]  
  
 [!code-vb[HowTo#rmo_vb_CreateTranPub](../../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createtranpub)]  
  
 <span data-ttu-id="bd3dc-268">次の例では、AdventureWorks データベースでマージ パブリッシュを有効にし、AdvWorksSalesOrdersMerge パブリケーションを作成します。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-268">This example enables the AdventureWorks database for merge publishing and creates the AdvWorksSalesOrdersMerge publication.</span></span> <span data-ttu-id="bd3dc-269">このパブリケーションには、アーティクルを定義する必要があります。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-269">Articles must still be defined for this publication.</span></span> <span data-ttu-id="bd3dc-270">スナップショット エージェント ジョブの作成に必要な Windows アカウントの資格情報は、実行時に渡されます。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-270">The Windows account credentials that are needed to create the Snapshot Agent job are passed at runtime.</span></span> <span data-ttu-id="bd3dc-271">RMO を使用してマージ アーティクルを定義する方法については、「 [Define an Article](define-an-article.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="bd3dc-271">To learn how to use RMO to define merge articles, see [Define an Article](define-an-article.md).</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateMergePub](../../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createmergepub)]  
  
 [!code-vb[HowTo#rmo_vb_CreateMergePub](../../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createmergepub)]  
  
## <a name="see-also"></a><span data-ttu-id="bd3dc-272">参照</span><span class="sxs-lookup"><span data-stu-id="bd3dc-272">See Also</span></span>  
 <span data-ttu-id="bd3dc-273">[sqlcmd でのスクリプト変数の使用](../../scripting/sqlcmd-use-with-scripting-variables.md) </span><span class="sxs-lookup"><span data-stu-id="bd3dc-273">[Use sqlcmd with Scripting Variables](../../scripting/sqlcmd-use-with-scripting-variables.md) </span></span>  
 <span data-ttu-id="bd3dc-274">[データとデータベース オブジェクトのパブリッシュ](publish-data-and-database-objects.md) </span><span class="sxs-lookup"><span data-stu-id="bd3dc-274">[Publish Data and Database Objects](publish-data-and-database-objects.md) </span></span>  
 <span data-ttu-id="bd3dc-275">[Replication Management Objects Concepts](../concepts/replication-management-objects-concepts.md) </span><span class="sxs-lookup"><span data-stu-id="bd3dc-275">[Replication Management Objects Concepts](../concepts/replication-management-objects-concepts.md) </span></span>  
 <span data-ttu-id="bd3dc-276">[Define an Article](define-an-article.md) </span><span class="sxs-lookup"><span data-stu-id="bd3dc-276">[Define an Article](define-an-article.md) </span></span>  
 <span data-ttu-id="bd3dc-277">[パブリケーション プロパティの表示および変更](view-and-modify-publication-properties.md) </span><span class="sxs-lookup"><span data-stu-id="bd3dc-277">[View and Modify Publication Properties](view-and-modify-publication-properties.md) </span></span>  
 <span data-ttu-id="bd3dc-278">[[ディストリビューションの構成]](../configure-distribution.md) </span><span class="sxs-lookup"><span data-stu-id="bd3dc-278">[Configure Distribution](../configure-distribution.md) </span></span>  
 <span data-ttu-id="bd3dc-279">[ディストリビューターのセキュリティ保護](../security/secure-the-distributor.md) </span><span class="sxs-lookup"><span data-stu-id="bd3dc-279">[Secure the Distributor](../security/secure-the-distributor.md) </span></span>  
 [<span data-ttu-id="bd3dc-280">パブリッシャーのセキュリティ保護</span><span class="sxs-lookup"><span data-stu-id="bd3dc-280">Secure the Publisher</span></span>](../security/secure-the-publisher.md)  
  
  
