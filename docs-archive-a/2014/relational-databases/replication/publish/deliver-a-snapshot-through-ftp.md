---
title: FTP でのスナップショットの配信 | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- snapshots [SQL Server replication], FTP snapshots
- FTP snapshots [SQL Server replication]
- snapshot replication [SQL Server], FTP
ms.assetid: 99872c4f-40ce-4405-8fd4-44052d3bd827
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 2e6700e6989a5a7e32202a0710bc663978a136cf
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87633073"
---
# <a name="deliver-a-snapshot-through-ftp"></a><span data-ttu-id="47fd1-102">FTP でのスナップショットの配信</span><span class="sxs-lookup"><span data-stu-id="47fd1-102">Deliver a Snapshot Through FTP</span></span>
  <span data-ttu-id="47fd1-103">このトピックでは、 [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] で [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] または [!INCLUDE[tsql](../../../includes/tsql-md.md)]を使用して、FTP でスナップショットを配信する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="47fd1-103">This topic describes how to deliver a snapshot through FTP in [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] by using [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] or [!INCLUDE[tsql](../../../includes/tsql-md.md)].</span></span>  
  
##  <a name="limitations-and-restrictions"></a><a name="Restrictions"></a> <span data-ttu-id="47fd1-104">制限事項と制約事項</span><span class="sxs-lookup"><span data-stu-id="47fd1-104">Limitations and Restrictions</span></span>  
  
-   <span data-ttu-id="47fd1-105">スナップショット エージェントには、指定したディレクトリに対する書き込み権限が必要です。また、ディストリビューション エージェントまたはマージ エージェントには、読み取り権限が必要です。</span><span class="sxs-lookup"><span data-stu-id="47fd1-105">The Snapshot Agent must have write permissions for the directory you specify, and the Distribution Agent or Merge Agent must have read permissions.</span></span> <span data-ttu-id="47fd1-106">プル サブスクリプションを使用する場合は、共有ディレクトリを UNC (汎用名前付け規則) パス (\\\ftpserver\home\snapshots など) として指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="47fd1-106">If pull subscriptions are used, you must specify a shared directory as a universal naming convention (UNC) path, such as \\\ftpserver\home\snapshots.</span></span> <span data-ttu-id="47fd1-107">詳細については、「[Secure the Snapshot Folder](../security/secure-the-snapshot-folder.md)」(スナップショット フォルダーのセキュリティ保護) をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="47fd1-107">For more information, see [Secure the Snapshot Folder](../security/secure-the-snapshot-folder.md).</span></span>  
  
###  <a name="prerequisites"></a><a name="Prerequisites"></a> <span data-ttu-id="47fd1-108">前提条件</span><span class="sxs-lookup"><span data-stu-id="47fd1-108">Prerequisites</span></span>  
  
-   <span data-ttu-id="47fd1-109">ファイル転送プロトコル (FTP) を使用してスナップショット ファイルを転送するには、まず、FTP サーバーを構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="47fd1-109">To transfer snapshot files using File Transfer Protocol (FTP), you must first configure an FTP server.</span></span> <span data-ttu-id="47fd1-110">詳細については、 [!INCLUDE[msCoName](../../../includes/msconame-md.md)] インターネット インフォメーション サービス (IIS) のマニュアルを参照してください。</span><span class="sxs-lookup"><span data-stu-id="47fd1-110">For more information, see the [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Internet Information Services (IIS) documentation.</span></span>  
  
###  <a name="security"></a><a name="Security"></a> <span data-ttu-id="47fd1-111">セキュリティ</span><span class="sxs-lookup"><span data-stu-id="47fd1-111">Security</span></span>  
 <span data-ttu-id="47fd1-112">セキュリティを強化するため、インターネット経由の FTP スナップショット配信を使用する際には仮想プライベート ネットワーク (VPN) を実装することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="47fd1-112">To help improve security, we recommend that you implement a virtual private network (VPN) when using FTP snapshot delivery over the Internet.</span></span> <span data-ttu-id="47fd1-113">詳細については、「[Publish Data over the Internet Using VPN](../publish-data-over-the-internet-using-vpn.md)」 (VPN を使用したインターネット経由のデータのパブリッシュ) を参照してください。</span><span class="sxs-lookup"><span data-stu-id="47fd1-113">For more information, see [Publish Data over the Internet Using VPN](../publish-data-over-the-internet-using-vpn.md).</span></span>  
  
 <span data-ttu-id="47fd1-114">セキュリティの推奨方法としては、FTP サーバーに対する匿名ログインを許可しないことをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="47fd1-114">As a security best practice, do not allow anonymous logins to the FTP server.</span></span> <span data-ttu-id="47fd1-115">スナップショット エージェントには、指定したディレクトリに対する書き込み権限が必要です。また、ディストリビューション エージェントまたはマージ エージェントには、読み取り権限が必要です。</span><span class="sxs-lookup"><span data-stu-id="47fd1-115">The Snapshot Agent must have write permissions for the directory you specify, and the Distribution Agent or Merge Agent must have read permissions.</span></span> <span data-ttu-id="47fd1-116">プル サブスクリプションを使用する場合は、共有ディレクトリを UNC (汎用名前付け規則) パス (\\\ftpserver\home\snapshots など) として指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="47fd1-116">If pull subscriptions are used, you must specify a shared directory as a universal naming convention (UNC) path, such as \\\ftpserver\home\snapshots.</span></span> <span data-ttu-id="47fd1-117">詳細については、「[Secure the Snapshot Folder](../security/secure-the-snapshot-folder.md)」(スナップショット フォルダーのセキュリティ保護) をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="47fd1-117">For more information, see [Secure the Snapshot Folder](../security/secure-the-snapshot-folder.md).</span></span>  
  
 <span data-ttu-id="47fd1-118">可能であれば、実行時に資格情報の入力を求めるメッセージを表示します。</span><span class="sxs-lookup"><span data-stu-id="47fd1-118">When possible, prompt users to enter their credentials at runtime.</span></span> <span data-ttu-id="47fd1-119">資格情報をスクリプト ファイルに保存する場合、ファイルをセキュリティ保護する必要があります。</span><span class="sxs-lookup"><span data-stu-id="47fd1-119">If you store credentials in a script file, you must secure the file.</span></span>  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> <span data-ttu-id="47fd1-120">SQL Server Management Studio の使用</span><span class="sxs-lookup"><span data-stu-id="47fd1-120">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="47fd1-121">FTP サーバーの構成が完了したら、 **[パブリケーションのプロパティ \<Publication>]** ダイアログ ボックスで、そのサーバーのディレクトリとセキュリティの情報を指定します。</span><span class="sxs-lookup"><span data-stu-id="47fd1-121">After the FTP server is configured, specify directory and security information for this server in the **Publication Properties \<Publication>** dialog box.</span></span> <span data-ttu-id="47fd1-122">このダイアログ ボックスへのアクセス方法の詳細については、「[パブリケーション プロパティの表示および変更](view-and-modify-publication-properties.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="47fd1-122">For more information about accessing this dialog box, see [View and Modify Publication Properties](view-and-modify-publication-properties.md).</span></span>  
  
#### <a name="to-specify-ftp-information"></a><span data-ttu-id="47fd1-123">FTP 情報を指定するには</span><span class="sxs-lookup"><span data-stu-id="47fd1-123">To specify FTP information</span></span>  
  
1.  <span data-ttu-id="47fd1-124">**[パブリケーションのプロパティ - \<Publication>]** ダイアログ ボックスで、次のいずれかのページから **[ファイル転送プロトコル (FTP) を使用したスナップショット ファイルのダウンロードをサブスクライバーに許可する]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="47fd1-124">In the **Publication Properties - \<Publication>** dialog box, select **Allow Subscribers to download snapshot files using FTP** from one of the following pages:</span></span>   
    -   <span data-ttu-id="47fd1-125">**[FTP スナップショット]** ページ。スナップショット パブリケーション、トランザクション パブリケーション、[!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] より前のバージョンを実行しているパブリッシャーのマージ パブリケーションの場合。</span><span class="sxs-lookup"><span data-stu-id="47fd1-125">The **FTP Snapshot** page, for snapshot and transactional publications, and merge publications for Publishers running versions prior to [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)].</span></span>    
    -   <span data-ttu-id="47fd1-126">**[FTP スナップショットとインターネット]** ページ。 [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] 以降を実行しているパブリッシャーからのマージ パブリケーションの場合。</span><span class="sxs-lookup"><span data-stu-id="47fd1-126">The **FTP Snapshot and Internet** page, for merge publications from Publishers running [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or later.</span></span>    
2.  <span data-ttu-id="47fd1-127">**[FTP サーバー名]** 、 **[ポート番号]** 、 **[FTP ルート フォルダーからのパス]** 、 **[ログイン]** 、および **[パスワード]** の値を指定します。</span><span class="sxs-lookup"><span data-stu-id="47fd1-127">Specify values for **FTP server name**, **Port number**, **Path from the FTP root folder**, **Login**, and **Password**.</span></span>    
     <span data-ttu-id="47fd1-128">たとえば、FTP サーバーのルートが \\\ftpserver\home で、スナップショットを \\\ftpserver\home\snapshots に格納する場合は、 **[FTP ルート フォルダーからのパス]** には「\snapshots\ftp」と指定します (レプリケーションでは、スナップショット ファイルが作成されるときにスナップショット フォルダーのパスに "ftp" が追加されます)。</span><span class="sxs-lookup"><span data-stu-id="47fd1-128">For example, if the FTP server root is \\\ftpserver\home and you want snapshots to be stored at \\\ftpserver\home\snapshots, specify \snapshots\ftp for the property **Path from the FTP root folder** (replication appends 'ftp' to the snapshot folder path when it creates snapshot files).</span></span>    
3.  <span data-ttu-id="47fd1-129">スナップショット エージェントが、手順 2. で指定したディレクトリにスナップショット ファイルを書き込むように指定します。</span><span class="sxs-lookup"><span data-stu-id="47fd1-129">Specify that the Snapshot Agent should write the snapshot files to the directory specified in step 2.</span></span> <span data-ttu-id="47fd1-130">たとえば、スナップショット エージェントがスナップショット ファイルを \\\ftpserver\home\snapshots\ftp に書き込むようにするには、次のいずれかの場所に \\\ftpserver\home\snapshots というパスを指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="47fd1-130">For example, to have the Snapshot Agent write the snapshot files to \\\ftpserver\home\snapshots\ftp, you must specify the path \\\ftpserver\home\snapshots in one of two places:</span></span>    
    -   <span data-ttu-id="47fd1-131">このパブリケーションに関連付けられているディストリビューターの既定のスナップショットの場所。</span><span class="sxs-lookup"><span data-stu-id="47fd1-131">The default snapshot location for the Distributor associated with this publication.</span></span>    
         <span data-ttu-id="47fd1-132">既定のスナップショットの場所を指定する方法の詳細については、「[既定のスナップショットの場所の指定](../snapshot-options.md#snapshot-folder-locations)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="47fd1-132">For more information about specifying the default snapshot location, see [Specify the Default Snapshot Location](../snapshot-options.md#snapshot-folder-locations).</span></span>    
    -   <span data-ttu-id="47fd1-133">このパブリケーションの代替スナップショット フォルダーの場所。</span><span class="sxs-lookup"><span data-stu-id="47fd1-133">An alternate snapshot folder location for this publication.</span></span> <span data-ttu-id="47fd1-134">スナップショットが圧縮されている場合、別の場所が必要です。</span><span class="sxs-lookup"><span data-stu-id="47fd1-134">An alternate location is required if the snapshot is compressed.</span></span>    
         <span data-ttu-id="47fd1-135">[**パブリケーションのプロパティ- \<Publication> \*\* ] ダイアログボックスの [スナップショット] ページで、[ファイルを次の**フォルダーに配置\*\*する] ボックスにパスを入力します。</span><span class="sxs-lookup"><span data-stu-id="47fd1-135">Enter the path in the **Put files in the following folder** textbox on the Snapshot page of the **Publication Properties - \<Publication>** dialog box.</span></span>   
4.  [!INCLUDE[clickOK](../../../includes/clickok-md.md)]  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="47fd1-136">Transact-SQL の使用</span><span class="sxs-lookup"><span data-stu-id="47fd1-136">Using Transact-SQL</span></span>  
 <span data-ttu-id="47fd1-137">FTP サーバーでスナップショット ファイルを使用するためのオプションを設定できます。この FTP 設定は、レプリケーション ストアド プロシージャを使用してプログラムから変更できます。</span><span class="sxs-lookup"><span data-stu-id="47fd1-137">The option to make snapshot files available on an FTP server can be set and these FTP settings can be modified programmatically using replication stored procedures.</span></span> <span data-ttu-id="47fd1-138">使用されるプロシージャは、パブリケーションの種類によって異なります。</span><span class="sxs-lookup"><span data-stu-id="47fd1-138">The procedure used depends on the type of publication.</span></span> <span data-ttu-id="47fd1-139">FTP によるスナップショット配信は、プル サブスクリプションでのみ使用できます。</span><span class="sxs-lookup"><span data-stu-id="47fd1-139">FTP snapshot delivery is only used with pull subscriptions.</span></span>  
  
#### <a name="to-enable-ftp-snapshot-delivery-for-a-snapshot-or-transactional-publication"></a><span data-ttu-id="47fd1-140">スナップショット パブリケーションまたはトランザクション パブリケーションで FTP スナップショット配信を有効にするには</span><span class="sxs-lookup"><span data-stu-id="47fd1-140">To enable FTP snapshot delivery for a snapshot or transactional publication</span></span>  
  
1.  <span data-ttu-id="47fd1-141">パブリッシャーのパブリケーション データベースに対して、 [sp_addpublication](/sql/relational-databases/system-stored-procedures/sp-addpublication-transact-sql)を実行します。</span><span class="sxs-lookup"><span data-stu-id="47fd1-141">At the Publisher on the publication database, execute [sp_addpublication](/sql/relational-databases/system-stored-procedures/sp-addpublication-transact-sql).</span></span> <span data-ttu-id="47fd1-142">を指定し、 **@publication** に値を、 `true` 次の **@enabled_for_internet** パラメーターに適切な値を指定します。</span><span class="sxs-lookup"><span data-stu-id="47fd1-142">Specify **@publication**, a value of `true` for **@enabled_for_internet**, and appropriate values for the following parameters:</span></span>    
    -   <span data-ttu-id="47fd1-143">**@ftp_address**-スナップショットの配信に使用する FTP サーバーのアドレス。</span><span class="sxs-lookup"><span data-stu-id="47fd1-143">**@ftp_address** - the address of the FTP server used to deliver the snapshot.</span></span>    
    -   <span data-ttu-id="47fd1-144">(省略可能) **@ftp_port**-FTP サーバーによって使用されるポート。</span><span class="sxs-lookup"><span data-stu-id="47fd1-144">(Optional) **@ftp_port** - the port used by the FTP server.</span></span>    
    -   <span data-ttu-id="47fd1-145">(省略可能) **@ftp_subdirectory**-FTP ログインに割り当てられている既定の FTP ディレクトリのサブディレクトリ。</span><span class="sxs-lookup"><span data-stu-id="47fd1-145">(Optional) **@ftp_subdirectory** - the subdirectory of the default FTP directory assigned to an FTP login.</span></span> <span data-ttu-id="47fd1-146">たとえば、FTP サーバールートが \\ \ ftp_s ホームで、スナップショットを \snapshots\ftp に保存する場合は、 \\ に対して [] を指定し**\snapshots\ftp** **@ftp_subdirectory** ます (スナップショットファイルを作成するときに、レプリケーションによって "FTP" がスナップショットフォルダーパスに追加されます)。</span><span class="sxs-lookup"><span data-stu-id="47fd1-146">For example, if the FTP server root is \\\ftpserver\home and you want snapshots to be stored at \\\ftpserver\home\snapshots, specify **\snapshots\ftp** for **@ftp_subdirectory** (replication appends 'ftp' to the snapshot folder path when it creates snapshot files).</span></span>    
    -   <span data-ttu-id="47fd1-147">(省略可能) **@ftp_login**-FTP サーバーに接続するときに使用されるログインアカウント。</span><span class="sxs-lookup"><span data-stu-id="47fd1-147">(Optional) **@ftp_login** - a login account used when connecting to the FTP server.</span></span>    
    -   <span data-ttu-id="47fd1-148">(省略可能) **@ftp_password**-FTP ログインのパスワード。</span><span class="sxs-lookup"><span data-stu-id="47fd1-148">(Optional) **@ftp_password** - the password for the FTP login.</span></span>  
  
     <span data-ttu-id="47fd1-149">これにより、FTP を使用するパブリケーションが作成されます。</span><span class="sxs-lookup"><span data-stu-id="47fd1-149">This creates a publication that uses FTP.</span></span> <span data-ttu-id="47fd1-150">詳しくは、「 [パブリケーションを作成](create-a-publication.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="47fd1-150">For more information, see [Create a Publication](create-a-publication.md).</span></span>  
  
#### <a name="to-enable-ftp-snapshot-delivery-for-a-merge-publication"></a><span data-ttu-id="47fd1-151">マージ パブリケーションで FTP スナップショット配信を有効にするには</span><span class="sxs-lookup"><span data-stu-id="47fd1-151">To enable FTP snapshot delivery for a merge publication</span></span>  
  
1.  <span data-ttu-id="47fd1-152">パブリッシャー側のパブリケーション データベースに対して、 [sp_addmergepublication](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql)を実行します。</span><span class="sxs-lookup"><span data-stu-id="47fd1-152">At the Publisher on the publication database, execute [sp_addmergepublication](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql).</span></span> <span data-ttu-id="47fd1-153">を指定し **@publication** 、に値を指定して、 `true` 次の **@enabled_for_internet** パラメーターに適切な値を指定します。</span><span class="sxs-lookup"><span data-stu-id="47fd1-153">Specify **@publication**, a value of `true` for **@enabled_for_internet** and appropriate values for the following parameters:</span></span>  
  
    -   <span data-ttu-id="47fd1-154">**@ftp_address**-スナップショットの配信に使用する FTP サーバーのアドレス。</span><span class="sxs-lookup"><span data-stu-id="47fd1-154">**@ftp_address** - the address of the FTP server used to deliver the snapshot.</span></span>    
    -   <span data-ttu-id="47fd1-155">(省略可能) **@ftp_port**-FTP サーバーによって使用されるポート。</span><span class="sxs-lookup"><span data-stu-id="47fd1-155">(Optional) **@ftp_port** - the port used by the FTP server.</span></span>    
    -   <span data-ttu-id="47fd1-156">(省略可能) **@ftp_subdirectory**-FTP ログインに割り当てられている既定の FTP ディレクトリのサブディレクトリ。</span><span class="sxs-lookup"><span data-stu-id="47fd1-156">(Optional) **@ftp_subdirectory** - the subdirectory of the default FTP directory assigned to an FTP login.</span></span> <span data-ttu-id="47fd1-157">たとえば、FTP サーバールートが \\ \ ftp_s ホームで、スナップショットを \snapshots\ftp に保存する場合は、 \\ に対して [] を指定し**\snapshots\ftp** **@ftp_subdirectory** ます (スナップショットファイルを作成するときに、レプリケーションによって "FTP" がスナップショットフォルダーパスに追加されます)。</span><span class="sxs-lookup"><span data-stu-id="47fd1-157">For example, if the FTP server root is \\\ftpserver\home and you want snapshots to be stored at \\\ftpserver\home\snapshots, specify **\snapshots\ftp** for **@ftp_subdirectory** (replication appends 'ftp' to the snapshot folder path when it creates snapshot files).</span></span>    
    -   <span data-ttu-id="47fd1-158">(省略可能) **@ftp_login**-FTP サーバーに接続するときに使用されるログインアカウント。</span><span class="sxs-lookup"><span data-stu-id="47fd1-158">(Optional) **@ftp_login** - a login account used when connecting to the FTP server.</span></span>    
    -   <span data-ttu-id="47fd1-159">(省略可能) **@ftp_password**-FTP ログインのパスワード。</span><span class="sxs-lookup"><span data-stu-id="47fd1-159">(Optional) **@ftp_password** - the password for the FTP login.</span></span>  
  
     <span data-ttu-id="47fd1-160">これにより、FTP を使用するパブリケーションが作成されます。</span><span class="sxs-lookup"><span data-stu-id="47fd1-160">This creates a publication that uses FTP.</span></span> <span data-ttu-id="47fd1-161">詳しくは、「 [パブリケーションを作成](create-a-publication.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="47fd1-161">For more information, see [Create a Publication](create-a-publication.md).</span></span>  
  
#### <a name="to-create-a-pull-subscription-to-a-snapshot-or-transactional-publication-that-uses-ftp-snapshot-delivery"></a><span data-ttu-id="47fd1-162">FTP スナップショット配信を使用するスナップショット パブリケーションまたはトランザクション パブリケーションへのプル サブスクリプションを作成するには</span><span class="sxs-lookup"><span data-stu-id="47fd1-162">To create a pull subscription to a snapshot or transactional publication that uses FTP snapshot delivery</span></span>  
  
1.  <span data-ttu-id="47fd1-163">サブスクライバー側のサブスクリプション データベースに対して、 [sp_addpullsubscription](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-transact-sql)を実行します。</span><span class="sxs-lookup"><span data-stu-id="47fd1-163">At the Subscriber on the subscription database, execute [sp_addpullsubscription](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-transact-sql).</span></span> <span data-ttu-id="47fd1-164">およびを指定し **@publisher** **@publication** ます。</span><span class="sxs-lookup"><span data-stu-id="47fd1-164">Specify **@publisher** and **@publication**.</span></span>  
  
    -   <span data-ttu-id="47fd1-165">サブスクライバー側のサブスクリプション データベースに対して、 [sp_addpullsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-agent-transact-sql)を実行します。</span><span class="sxs-lookup"><span data-stu-id="47fd1-165">At the Subscriber on the subscription database, execute [sp_addpullsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-agent-transact-sql).</span></span> <span data-ttu-id="47fd1-166">、、を指定し、 **@publisher** **@publisher_db** **@publication** [!INCLUDE[msCoName](../../../includes/msconame-md.md)] サブスクライバーでディストリビューションエージェントが実行されるときに使用する Windows 資格情報をとに指定し、の値をに指定し **@job_login** **@job_password** `true` **@use_ftp** ます。</span><span class="sxs-lookup"><span data-stu-id="47fd1-166">Specify **@publisher**, **@publisher_db**, **@publication**, the [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Windows credentials under which the Distribution Agent at the Subscriber runs for **@job_login** and **@job_password**, and a value of `true` for **@use_ftp**.</span></span>  
  
2.  <span data-ttu-id="47fd1-167">パブリッシャー側のパブリケーション データベースに対して [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql) を実行し、プル サブスクリプションを登録します。</span><span class="sxs-lookup"><span data-stu-id="47fd1-167">At the Publisher on the publication database, execute [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql) to register the pull subscription.</span></span> <span data-ttu-id="47fd1-168">詳細については、「 [プル サブスクリプションの作成](../create-a-pull-subscription.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="47fd1-168">For more information, see [Create a Pull Subscription](../create-a-pull-subscription.md).</span></span>  
  
#### <a name="to-create-a-pull-subscription-to-a-merge-publication-that-uses-ftp-snapshot-delivery"></a><span data-ttu-id="47fd1-169">FTP スナップショット配信を使用するマージ パブリケーションへのプル サブスクリプションを作成するには</span><span class="sxs-lookup"><span data-stu-id="47fd1-169">To create a pull subscription to a merge publication that uses FTP snapshot delivery</span></span>  
  
1.  <span data-ttu-id="47fd1-170">サブスクライバー側のサブスクリプション データベースに対して、 [sp_addmergepullsubscription](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-transact-sql)を実行します。</span><span class="sxs-lookup"><span data-stu-id="47fd1-170">At the Subscriber on the subscription database, execute [sp_addmergepullsubscription](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-transact-sql).</span></span> <span data-ttu-id="47fd1-171">およびを指定し **@publisher** **@publication** ます。</span><span class="sxs-lookup"><span data-stu-id="47fd1-171">Specify **@publisher** and **@publication**.</span></span>   
2.  <span data-ttu-id="47fd1-172">サブスクライバー側のサブスクリプション データベースに対して、 [sp_addmergepullsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-agent-transact-sql)を実行します。</span><span class="sxs-lookup"><span data-stu-id="47fd1-172">At the Subscriber on the subscription database, execute [sp_addmergepullsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-agent-transact-sql).</span></span> <span data-ttu-id="47fd1-173">、、を指定し、 **@publisher** **@publisher_db** **@publication** サブスクライバーでディストリビューションエージェントが実行されるときに使用する Windows 資格情報をとに指定し、の値をに指定し **@job_login** **@job_password** `true` **@use_ftp** ます。</span><span class="sxs-lookup"><span data-stu-id="47fd1-173">Specify **@publisher**, **@publisher_db**, **@publication**, the Windows credentials under which the Distribution Agent at the Subscriber runs for **@job_login** and **@job_password**, and a value of `true` for **@use_ftp**.</span></span>    
3.  <span data-ttu-id="47fd1-174">パブリッシャー側のパブリケーション データベースに対して [sp_addmergesubscription](/sql/relational-databases/system-stored-procedures/sp-addmergesubscription-transact-sql) を実行し、プル サブスクリプションを登録します。</span><span class="sxs-lookup"><span data-stu-id="47fd1-174">At the Publisher on the publication database, execute [sp_addmergesubscription](/sql/relational-databases/system-stored-procedures/sp-addmergesubscription-transact-sql) to register the pull subscription.</span></span> <span data-ttu-id="47fd1-175">詳細については、「 [プル サブスクリプションの作成](../create-a-pull-subscription.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="47fd1-175">For more information, see [Create a Pull Subscription](../create-a-pull-subscription.md).</span></span>  
  
#### <a name="to-change-one-or-more-ftp-snapshot-delivery-settings-for-a-snapshot-or-transactional-publication"></a><span data-ttu-id="47fd1-176">スナップショット パブリケーションまたはトランザクション パブリケーションの FTP スナップショット配信の設定を変更するには</span><span class="sxs-lookup"><span data-stu-id="47fd1-176">To change one or more FTP snapshot delivery settings for a snapshot or transactional publication</span></span>  
  
1.  <span data-ttu-id="47fd1-177">パブリッシャー側のパブリケーション データベースに対して [sp_changepublication](/sql/relational-databases/system-stored-procedures/sp-changepublication-transact-sql)を実行します。</span><span class="sxs-lookup"><span data-stu-id="47fd1-177">At the Publisher on the publication database, execute [sp_changepublication](/sql/relational-databases/system-stored-procedures/sp-changepublication-transact-sql).</span></span> <span data-ttu-id="47fd1-178">に次のいずれかの値を指定 **@property** し、にこの設定の新しい値を指定し **@value** ます。</span><span class="sxs-lookup"><span data-stu-id="47fd1-178">Specify one of the following values for **@property** and a new value of this setting for **@value**:</span></span>    
    -   <span data-ttu-id="47fd1-179">`ftp_address` - スナップショットの配信に使用する FTP サーバーのアドレス。</span><span class="sxs-lookup"><span data-stu-id="47fd1-179">`ftp_address` - the address of the FTP server used to deliver the snapshot.</span></span>    
    -   <span data-ttu-id="47fd1-180">`ftp_port` - FTP サーバーで使用されるポート。</span><span class="sxs-lookup"><span data-stu-id="47fd1-180">`ftp_port` - the port used by the FTP server.</span></span>    
    -   <span data-ttu-id="47fd1-181">`ftp_subdirectory` - FTP スナップショットに使用する既定の FTP ディレクトリのサブディレクトリ。</span><span class="sxs-lookup"><span data-stu-id="47fd1-181">`ftp_subdirectory` - the subdirectory of the default FTP directory used for the FTP snapshot.</span></span>    
    -   <span data-ttu-id="47fd1-182">`ftp_login` - FTP サーバーへの接続に使用されるログイン。</span><span class="sxs-lookup"><span data-stu-id="47fd1-182">`ftp_login` - a login used to connect to the FTP server.</span></span>    
    -   <span data-ttu-id="47fd1-183">`ftp_password` - FTP ログイン用のパスワード。</span><span class="sxs-lookup"><span data-stu-id="47fd1-183">`ftp_password` - the password for the FTP login.</span></span>  
  
2.  <span data-ttu-id="47fd1-184">(省略可) 変更する各 FTP 設定について手順 1. を実行します。</span><span class="sxs-lookup"><span data-stu-id="47fd1-184">(Optional) Repeat step 1 for each FTP setting being changed.</span></span>    
3.  <span data-ttu-id="47fd1-185">(省略可) FTP スナップショット配信を無効にするには、パブリッシャー側のパブリケーション データベースに対して [sp_changepublication](/sql/relational-databases/system-stored-procedures/sp-changepublication-transact-sql) を実行します。</span><span class="sxs-lookup"><span data-stu-id="47fd1-185">(Optional) To disable FTP snapshot delivery, execute [sp_changepublication](/sql/relational-databases/system-stored-procedures/sp-changepublication-transact-sql) at the Publisher on the publication database.</span></span> <span data-ttu-id="47fd1-186">にを指定し `enabled_for_internet` 、 **@property** に値を指定 `false` し **@value** ます。</span><span class="sxs-lookup"><span data-stu-id="47fd1-186">Specify a value of `enabled_for_internet` for **@property** and a value of `false` for **@value**.</span></span>  
  
#### <a name="to-change-ftp-snapshot-delivery-settings-for-a-merge-publication"></a><span data-ttu-id="47fd1-187">マージ パブリケーションの FTP スナップショット配信の設定を変更するには</span><span class="sxs-lookup"><span data-stu-id="47fd1-187">To change FTP snapshot delivery settings for a merge publication</span></span>  
  
1.  <span data-ttu-id="47fd1-188">パブリッシャー側のパブリケーション データベースに対して [sp_changemergepublication](/sql/relational-databases/system-stored-procedures/sp-changemergepublication-transact-sql)を実行します。</span><span class="sxs-lookup"><span data-stu-id="47fd1-188">At the Publisher on the publication database, execute [sp_changemergepublication](/sql/relational-databases/system-stored-procedures/sp-changemergepublication-transact-sql).</span></span> <span data-ttu-id="47fd1-189">に次のいずれかの値を指定 **@property** し、にこの設定の新しい値を指定し **@value** ます。</span><span class="sxs-lookup"><span data-stu-id="47fd1-189">Specify one of the following values for **@property** and a new value of this setting for **@value**:</span></span>  
  
    -   <span data-ttu-id="47fd1-190">`ftp_address` - スナップショットの配信に使用する FTP サーバーのアドレス。</span><span class="sxs-lookup"><span data-stu-id="47fd1-190">`ftp_address` - the address of the FTP server used to deliver the snapshot.</span></span>    
    -   <span data-ttu-id="47fd1-191">`ftp_port` - FTP サーバーで使用されるポート。</span><span class="sxs-lookup"><span data-stu-id="47fd1-191">`ftp_port` - the port used by the FTP server.</span></span>    
    -   <span data-ttu-id="47fd1-192">`ftp_subdirectory` - FTP スナップショットに使用する既定の FTP ディレクトリのサブディレクトリ。</span><span class="sxs-lookup"><span data-stu-id="47fd1-192">`ftp_subdirectory` - the subdirectory of the default FTP directory used for the FTP snapshot.</span></span>   
    -   <span data-ttu-id="47fd1-193">`ftp_login` - FTP サーバーへの接続に使用されるログイン。</span><span class="sxs-lookup"><span data-stu-id="47fd1-193">`ftp_login` - a login used to connect to the FTP server.</span></span>    
    -   <span data-ttu-id="47fd1-194">`ftp_password` - FTP ログイン用のパスワード。</span><span class="sxs-lookup"><span data-stu-id="47fd1-194">`ftp_password` - the password for the FTP login.</span></span>    
2.  <span data-ttu-id="47fd1-195">(省略可) 変更する各 FTP 設定について手順 1. を実行します。</span><span class="sxs-lookup"><span data-stu-id="47fd1-195">(Optional) Repeat step 1 for each FTP setting being changed.</span></span>    
3.  <span data-ttu-id="47fd1-196">(省略可) FTP スナップショット配信を無効にするには、パブリッシャー側のパブリケーション データベースに対して [sp_changemergepublication](/sql/relational-databases/system-stored-procedures/sp-changemergepublication-transact-sql) を実行します。</span><span class="sxs-lookup"><span data-stu-id="47fd1-196">(Optional) To disable FTP snapshot delivery, execute [sp_changemergepublication](/sql/relational-databases/system-stored-procedures/sp-changemergepublication-transact-sql) at the Publisher on the publication database.</span></span> <span data-ttu-id="47fd1-197">にを指定し `enabled_for_internet` 、 **@property** に値を指定 `false` し **@value** ます。</span><span class="sxs-lookup"><span data-stu-id="47fd1-197">Specify a value of `enabled_for_internet` for **@property** and a value of `false` for **@value**.</span></span>  
  
###  <a name="examples-transact-sql"></a><a name="TsqlExample"></a> <span data-ttu-id="47fd1-198">例 (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="47fd1-198">Examples (Transact-SQL)</span></span>  
 <span data-ttu-id="47fd1-199">次の例では、サブスクライバーが FTP を使用してスナップショット データにアクセスできるマージ パブリケーションを作成します。</span><span class="sxs-lookup"><span data-stu-id="47fd1-199">The following example creates a merge publication that allows Subscribers to access the snapshot data using FTP.</span></span> <span data-ttu-id="47fd1-200">サブスクライバーは、FTP 共有にアクセスするときにセキュリティで保護された VPN 接続を使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="47fd1-200">The Subscriber should use a secure VPN connection when accessing the FTP share.</span></span> <span data-ttu-id="47fd1-201">**sqlcmd** スクリプト変数を使用して、ログインとパスワードの値が入力されます。</span><span class="sxs-lookup"><span data-stu-id="47fd1-201">**sqlcmd** scripting variables are used to supply login and password values.</span></span> <span data-ttu-id="47fd1-202">詳細については、「[Use sqlcmd with Scripting Variables](../../scripting/sqlcmd-use-with-scripting-variables.md)」(sqlcmd でのスクリプト変数の使用) をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="47fd1-202">For more information, see [Use sqlcmd with Scripting Variables](../../scripting/sqlcmd-use-with-scripting-variables.md).</span></span>  
  
 [!code-sql[HowTo#sp_createmergepub_ftp](../../../snippets/tsql/SQL15/replication/howto/tsql/createmergepubftp.sql#sp_createmergepub_ftp)]  
  
 <span data-ttu-id="47fd1-203">次の例では、マージ パブリケーションに対するサブスクリプションを作成します。ここでは、サブスクライバーが FTP を使用してスナップショットを取得します。</span><span class="sxs-lookup"><span data-stu-id="47fd1-203">The following example creates a subscription to a merge publication, where the Subscriber obtains the snapshot using FTP.</span></span> <span data-ttu-id="47fd1-204">サブスクライバーは、FTP 共有にアクセスするときにセキュリティで保護された VPN 接続を使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="47fd1-204">The Subscriber should use a secure VPN connection when accessing the FTP share.</span></span> <span data-ttu-id="47fd1-205">**sqlcmd** スクリプト変数を使用して、ログインとパスワードの値が入力されます。</span><span class="sxs-lookup"><span data-stu-id="47fd1-205">**sqlcmd** scripting variables are used to supply login and password values.</span></span> <span data-ttu-id="47fd1-206">詳細については、「[Use sqlcmd with Scripting Variables](../../scripting/sqlcmd-use-with-scripting-variables.md)」(sqlcmd でのスクリプト変数の使用) をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="47fd1-206">For more information, see [Use sqlcmd with Scripting Variables](../../scripting/sqlcmd-use-with-scripting-variables.md).</span></span>  
  
 [!code-sql[HowTo#sp_createmergepullsub_ftp](../../../snippets/tsql/SQL15/replication/howto/tsql/createmergepullsubftp.sql#sp_createmergepullsub_ftp)]  
  
 [!code-sql[HowTo#sp_createmergepullsubagent_ftp](../../../snippets/tsql/SQL15/replication/howto/tsql/createmergepullsubftp.sql#sp_createmergepullsubagent_ftp)]  
  
## <a name="see-also"></a><span data-ttu-id="47fd1-207">参照</span><span class="sxs-lookup"><span data-stu-id="47fd1-207">See Also</span></span>  
 <span data-ttu-id="47fd1-208">[Replication System Stored Procedures Concepts](../concepts/replication-system-stored-procedures-concepts.md) </span><span class="sxs-lookup"><span data-stu-id="47fd1-208">[Replication System Stored Procedures Concepts](../concepts/replication-system-stored-procedures-concepts.md) </span></span>  
 <span data-ttu-id="47fd1-209">[FTP 経由でスナップショットを転送する](../transfer-snapshots-through-ftp.md) </span><span class="sxs-lookup"><span data-stu-id="47fd1-209">[Transfer Snapshots Through FTP](../transfer-snapshots-through-ftp.md) </span></span>  
 <span data-ttu-id="47fd1-210">[パブリケーションとアーティクルのプロパティの変更](change-publication-and-article-properties.md) </span><span class="sxs-lookup"><span data-stu-id="47fd1-210">[Change Publication and Article Properties](change-publication-and-article-properties.md) </span></span>  
 [<span data-ttu-id="47fd1-211">スナップショットを使用したサブスクリプションの初期化</span><span class="sxs-lookup"><span data-stu-id="47fd1-211">Initialize a Subscription with a Snapshot</span></span>](../initialize-a-subscription-with-a-snapshot.md)  
  
  
