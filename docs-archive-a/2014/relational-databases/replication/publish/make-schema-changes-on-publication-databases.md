---
title: パブリケーション データベースでのスキーマの変更 | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- replication [SQL Server], schema changes
- snapshot replication [SQL Server], replicating schema changes
- merge replication [SQL Server replication], replicating schema changes
- transactional replication, replicating schema changes
- schemas [SQL Server replication], replicating changes
- publishing [SQL Server replication], schema changes
ms.assetid: 926c88d7-a844-402f-bcb9-db49e5013b69
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: e26d3e89fcba41d474ca56637f9e465f17127348
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87631798"
---
# <a name="make-schema-changes-on-publication-databases"></a><span data-ttu-id="45b52-102">パブリケーション データベースでのスキーマの変更</span><span class="sxs-lookup"><span data-stu-id="45b52-102">Make Schema Changes on Publication Databases</span></span>
  <span data-ttu-id="45b52-103">レプリケーションは、パブリッシュされたオブジェクトに対するさまざまなスキーマ変更をサポートしています。</span><span class="sxs-lookup"><span data-stu-id="45b52-103">Replication supports a wide range of schema changes to published objects.</span></span> <span data-ttu-id="45b52-104">パブリッシュされた適切なオブジェクトに対して、以下に示すスキーマ変更を [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] パブリッシャーで行った場合、既定ではすべての [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] サブスクライバーにその変更が反映されます。</span><span class="sxs-lookup"><span data-stu-id="45b52-104">When you make any of the following schema changes on the appropriate published object at a [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Publisher, that change is propagated by default to all [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Subscribers:</span></span>  
  
-   <span data-ttu-id="45b52-105">ALTER TABLE</span><span class="sxs-lookup"><span data-stu-id="45b52-105">ALTER TABLE</span></span>  
  
-   <span data-ttu-id="45b52-106">ALTER TABLE SET LOCK ESCALATION (スキーマ変更レプリケーションが有効で、トポロジに [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] または [!INCLUDE[ssEWnoversion](../../../includes/ssewnoversion-md.md)] サブスクライバーが含まれている場合は使用しないでください) ALTER VIEW</span><span class="sxs-lookup"><span data-stu-id="45b52-106">ALTER TABLE SET LOCK ESCALATION should not be used if schema change replication is enabled and a topology includes [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or [!INCLUDE[ssEWnoversion](../../../includes/ssewnoversion-md.md)] Subscribers.ALTER VIEW</span></span>  
  
-   <span data-ttu-id="45b52-107">ALTER PROCEDURE</span><span class="sxs-lookup"><span data-stu-id="45b52-107">ALTER PROCEDURE</span></span>  
  
-   <span data-ttu-id="45b52-108">ALTER FUNCTION</span><span class="sxs-lookup"><span data-stu-id="45b52-108">ALTER FUNCTION</span></span>  
  
-   <span data-ttu-id="45b52-109">ALTER TRIGGER</span><span class="sxs-lookup"><span data-stu-id="45b52-109">ALTER TRIGGER</span></span>  
  
     <span data-ttu-id="45b52-110">データ定義言語 (DDL) トリガーはレプリケートできないため、ALTER TRIGGER を使用できるのは、データ操作言語 (DML) トリガーに対してのみです。</span><span class="sxs-lookup"><span data-stu-id="45b52-110">ALTER TRIGGER can be used only for data manipulation language [DML] triggers because data definition language [DDL] triggers cannot be replicated.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="45b52-111">テーブルに対するスキーマ変更は、 [!INCLUDE[tsql](../../../includes/tsql-md.md)] または [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 管理オブジェクト (SMO) を使用して行う必要があります。</span><span class="sxs-lookup"><span data-stu-id="45b52-111">Schema changes to tables must be made by using [!INCLUDE[tsql](../../../includes/tsql-md.md)] or [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Management Objects (SMO).</span></span> <span data-ttu-id="45b52-112">[!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)]でスキーマ変更を行うと、 [!INCLUDE[ssManStudio](../../../includes/ssmanstudio-md.md)] は、テーブルを削除して再作成しようとします。</span><span class="sxs-lookup"><span data-stu-id="45b52-112">When schema changes are made in [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)], [!INCLUDE[ssManStudio](../../../includes/ssmanstudio-md.md)] attempts to drop and re-create the table.</span></span> <span data-ttu-id="45b52-113">パブリッシュされたオブジェクトは削除できないため、スキーマ変更は失敗します。</span><span class="sxs-lookup"><span data-stu-id="45b52-113">You cannot drop published objects, therefore the schema change fails.</span></span>  
  
 <span data-ttu-id="45b52-114">トランザクション レプリケーションおよびマージ レプリケーションの場合、スキーマ変更はディストリビューション エージェントまたはマージ エージェントが実行されたときに、その増分が反映されます。</span><span class="sxs-lookup"><span data-stu-id="45b52-114">For transactional replication and merge replication, schema changes are propagated incrementally when the Distribution Agent or Merge Agent runs.</span></span> <span data-ttu-id="45b52-115">スナップショット レプリケーションの場合、スキーマ変更は新しいスナップショットがサブスクライバーで適用されるときに反映されます。</span><span class="sxs-lookup"><span data-stu-id="45b52-115">For snapshot replication, schema changes are propagated when a new snapshot is applied at the Subscriber.</span></span> <span data-ttu-id="45b52-116">スナップショット レプリケーションでは、同期が行われるたびにスキーマの新しいコピーがサブスクライバーに送信されます。</span><span class="sxs-lookup"><span data-stu-id="45b52-116">In snapshot replication, a new copy of the schema is sent to the Subscriber each time synchronization occurs.</span></span> <span data-ttu-id="45b52-117">したがって、以前にパブリッシュされたオブジェクトに対するすべてのスキーマ変更 (上に列挙したもの以外も含む) は、同期のたびに自動的に反映されます。</span><span class="sxs-lookup"><span data-stu-id="45b52-117">Therefore, all schema changes (not just those listed above) to previously published objects are automatically propagated with each synchronization.</span></span>  
  
 <span data-ttu-id="45b52-118">パブリケーションでのアーティクルの追加と削除については、「[既存のパブリケーションでのアーティクルの追加および削除](add-articles-to-and-drop-articles-from-existing-publications.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="45b52-118">For information about adding and removing articles from publications, see [Add Articles to and Drop Articles from Existing Publications](add-articles-to-and-drop-articles-from-existing-publications.md).</span></span>  
  
 <span data-ttu-id="45b52-119">**スキーマの変更をレプリケートするには**</span><span class="sxs-lookup"><span data-stu-id="45b52-119">**To replicate schema changes**</span></span>  
  
 <span data-ttu-id="45b52-120">上に列挙したスキーマ変更は既定でレプリケートされます。</span><span class="sxs-lookup"><span data-stu-id="45b52-120">The schema changes listed above are replicated by default.</span></span> <span data-ttu-id="45b52-121">スキーマ変更のレプリケートを無効にする方法については、「 [Replicate Schema Changes](replicate-schema-changes.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="45b52-121">For information about disabling the replication of schema changes, see [Replicate Schema Changes](replicate-schema-changes.md).</span></span>  
  
## <a name="considerations-for-schema-changes"></a><span data-ttu-id="45b52-122">スキーマ変更に関する注意点</span><span class="sxs-lookup"><span data-stu-id="45b52-122">Considerations for Schema Changes</span></span>  
 <span data-ttu-id="45b52-123">スキーマ変更をレプリケートする際には、以下の点に注意してください。</span><span class="sxs-lookup"><span data-stu-id="45b52-123">Keep the following considerations in mind when replicating schema changes.</span></span>  
  
### <a name="general-considerations"></a><span data-ttu-id="45b52-124">一般的な考慮事項</span><span class="sxs-lookup"><span data-stu-id="45b52-124">General Considerations</span></span>  
  
-   <span data-ttu-id="45b52-125">スキーマ変更は、 [!INCLUDE[tsql](../../../includes/tsql-md.md)]の制限の対象となります。</span><span class="sxs-lookup"><span data-stu-id="45b52-125">Schema changes are subject to any restrictions imposed by [!INCLUDE[tsql](../../../includes/tsql-md.md)].</span></span> <span data-ttu-id="45b52-126">たとえば、ALTER TABLE で主キー列を変更することはできません。</span><span class="sxs-lookup"><span data-stu-id="45b52-126">For example, ALTER TABLE does not allow you to ALTER primary key columns.</span></span>  
  
-   <span data-ttu-id="45b52-127">データ型マッピングは、初期スナップショットに対してのみ実行されます。</span><span class="sxs-lookup"><span data-stu-id="45b52-127">Data type mapping is performed only for the initial snapshot.</span></span> <span data-ttu-id="45b52-128">スキーマ変更で、以前のバージョンのデータ型へのマッピングは行われません。</span><span class="sxs-lookup"><span data-stu-id="45b52-128">Schema changes are not mapped to previous versions of data types.</span></span> <span data-ttu-id="45b52-129">たとえば、`ALTER TABLE ADD datetime2 column` というステートメントを [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)] で使用している場合、[!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] サブスクライバーでは、データ型が `nvarchar` に変換されません。</span><span class="sxs-lookup"><span data-stu-id="45b52-129">For example, if the statement `ALTER TABLE ADD datetime2 column` is used in [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)], the data type is not translated to `nvarchar` for [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] Subscribers.</span></span> <span data-ttu-id="45b52-130">場合によっては、スキーマ変更がパブリッシャーでブロックされます。</span><span class="sxs-lookup"><span data-stu-id="45b52-130">In some cases, schema changes are blocked on the Publisher.</span></span>  
  
-   <span data-ttu-id="45b52-131">スキーマ変更の反映を許可するようにパブリケーションが設定されている場合は、関連するスキーマ オプションがパブリケーションのアーティクルに対してどのように設定されているかに関係なく、スキーマ変更が反映されます。</span><span class="sxs-lookup"><span data-stu-id="45b52-131">If a publication is set to allow the propagation of schema changes, schema changes are propagated regardless of how the related schema option is set for an article in the publication.</span></span> <span data-ttu-id="45b52-132">たとえば、外部キー制約をレプリケートしないようにテーブル アーティクルに対して指定している場合に、外部キーをテーブルに追加する ALTER TABLE コマンドをパブリッシャーで実行すると、サブスクライバーで外部キーがテーブルに追加されます。</span><span class="sxs-lookup"><span data-stu-id="45b52-132">For example, if you select not to replicate foreign key constraints for a table article, but then issue an ALTER TABLE command that adds a foreign key to the table at the Publisher, the foreign key is added to the table at the Subscriber.</span></span> <span data-ttu-id="45b52-133">これを回避するには、ALTER TABLE コマンドを実行する前にスキーマ変更の反映を無効にします。</span><span class="sxs-lookup"><span data-stu-id="45b52-133">To prevent this, disable the propagation of schema changes before issuing the ALTER TABLE command.</span></span>  
  
-   <span data-ttu-id="45b52-134">スキーマ変更は、サブスクライバー (再パブリッシュ サブスクライバーを含む) では行わず、パブリッシャーでのみ行います。</span><span class="sxs-lookup"><span data-stu-id="45b52-134">Schema changes should be made only at the Publisher, not at Subscribers (including republishing Subscribers).</span></span> <span data-ttu-id="45b52-135">マージ レプリケーションについては、サブスクライバーでスキーマを変更できないようになっています。</span><span class="sxs-lookup"><span data-stu-id="45b52-135">Merge replication prevents schema changes at the Subscriber.</span></span> <span data-ttu-id="45b52-136">トランザクション レプリケーションでは変更できますが、変更するとレプリケーションが失敗する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="45b52-136">Transactional replication does not prevent the changes, but the changes can cause replication to fail.</span></span>  
  
-   <span data-ttu-id="45b52-137">再パブリッシュ サブスクライバーに反映された変更は、既定でそのサブスクライバーに反映されます。</span><span class="sxs-lookup"><span data-stu-id="45b52-137">Changes propagated to a republishing Subscriber are by default propagated to its Subscribers.</span></span>  
  
-   <span data-ttu-id="45b52-138">パブリッシャーには存在するがサブスクライバーには存在しないオブジェクトや制約を参照しているスキーマ変更は、パブリッシャーでは成功しますが、サブスクライバーでは失敗します。</span><span class="sxs-lookup"><span data-stu-id="45b52-138">If the schema change references objects or constraints existing on the Publisher but not on the Subscriber, the schema change will succeed on the Publisher but will fail on the Subscriber.</span></span>  
  
-   <span data-ttu-id="45b52-139">外部キーを追加するときに参照されるサブスクライバーのすべてのオブジェクトは、パブリッシャーの対応するオブジェクトと名前と所有者が同じである必要があります。</span><span class="sxs-lookup"><span data-stu-id="45b52-139">All objects on the Subscriber that are referenced when adding a foreign key must have the same name and owner as the corresponding object on the Publisher.</span></span>  
  
-   <span data-ttu-id="45b52-140">インデックスの明示的な追加、削除、および変更はサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="45b52-140">Explicitly adding, dropping, or altering indexes is not supported.</span></span> <span data-ttu-id="45b52-141">制約 (主キー制約など) に対して暗黙的に作成されたインデックスはサポートされます。</span><span class="sxs-lookup"><span data-stu-id="45b52-141">Indexes created implicitly for constraints (such as a primary key constraint) are supported.</span></span>  
  
-   <span data-ttu-id="45b52-142">レプリケーションによって管理されている ID 列の変更や削除はサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="45b52-142">Altering or dropping identity columns that are managed by replication is not supported.</span></span> <span data-ttu-id="45b52-143">ID 列の自動管理の詳細については、「[ID 列のレプリケート](replicate-identity-columns.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="45b52-143">For more information about automatic management of identity columns, see [Replicate Identity Columns](replicate-identity-columns.md).</span></span>  
  
-   <span data-ttu-id="45b52-144">非決定的関数を含むスキーマ変更はサポートされていません。これは、パブリッシャーとサブスクライバーのデータが異なる結果になる可能性があるためです (この状態を "未集約" と言います)。</span><span class="sxs-lookup"><span data-stu-id="45b52-144">Schema changes that include nondeterministic functions are not supported because they can result in data at the Publisher and Subscriber being different (referred to as non-convergence).</span></span> <span data-ttu-id="45b52-145">たとえば、 `ALTER TABLE SalesOrderDetail ADD OrderDate DATETIME DEFAULT GETDATE()`というコマンドをパブリッシャーで実行した場合、このコマンドがサブスクライバーにレプリケートされて実行されると異なる値になります。</span><span class="sxs-lookup"><span data-stu-id="45b52-145">For example, if you issue the following command at the Publisher: `ALTER TABLE SalesOrderDetail ADD OrderDate DATETIME DEFAULT GETDATE()`, the values are different when the command is replicated to the Subscriber and executed.</span></span> <span data-ttu-id="45b52-146">非決定的関数の詳細については、「 [Deterministic and Nondeterministic Functions](../../user-defined-functions/deterministic-and-nondeterministic-functions.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="45b52-146">For more information about nondeterministic functions, see [Deterministic and Nondeterministic Functions](../../user-defined-functions/deterministic-and-nondeterministic-functions.md).</span></span>  
  
-   <span data-ttu-id="45b52-147">制約には明示的に名前を付けることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="45b52-147">It is recommended that constraints be explicitly named.</span></span> <span data-ttu-id="45b52-148">明示的に制約に名前を付けない場合、 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] が制約の名前を生成するので、これらの名前がパブリッシャーと各サブスクライバーで異なります。</span><span class="sxs-lookup"><span data-stu-id="45b52-148">If a constraint is not explicitly named, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] generates a name for the constraint, and these names will be different on the Publisher and each Subscriber.</span></span> <span data-ttu-id="45b52-149">このことが原因で、スキーマ変更のレプリケーション中に問題が発生することがあります。</span><span class="sxs-lookup"><span data-stu-id="45b52-149">This can cause issues during the replication of schema changes.</span></span> <span data-ttu-id="45b52-150">たとえば、パブリッシャー側で列を削除することにより依存制約が削除されると、レプリケーションは、サブスクライバー側でこの制約を削除しようとします。</span><span class="sxs-lookup"><span data-stu-id="45b52-150">For example, if you drop a column at the Publisher and a dependent constraint is dropped, replication will attempt to drop the constraint at the Subscriber.</span></span> <span data-ttu-id="45b52-151">制約の名前が異なるので、サブスクライバーでの削除は失敗します。</span><span class="sxs-lookup"><span data-stu-id="45b52-151">The drop at the Subscriber will fail because the name of the constraint is different.</span></span> <span data-ttu-id="45b52-152">制約の名前付けの問題によって同期に失敗する場合、サブスクライバー側で制約を手動で削除して、マージ エージェントを再実行してください。</span><span class="sxs-lookup"><span data-stu-id="45b52-152">If synchronization fails because of a constraint naming issue, manually drop the constraint at the Subscriber and then rerun the Merge Agent.</span></span>  
  
-   <span data-ttu-id="45b52-153">テーブルをレプリケーション用にパブリッシュする場合、パブリケーション スナップショットが既に生成されている場合は、そのテーブルの列を XML のデータ型に変更することはできません。列を変更するには、まずレプリケーションを削除する必要があります。</span><span class="sxs-lookup"><span data-stu-id="45b52-153">If a table is published for replication, it is not possible to alter a column in that table to a data type of XML if a publication snapshot has already been generated To alter the column, you must first remove replication.</span></span>  
  
-   <span data-ttu-id="45b52-154">パブリッシュされたテーブルで DDL を実行する場合、Read uncommitted はサポートされる分離レベルでありません。</span><span class="sxs-lookup"><span data-stu-id="45b52-154">Read uncommitted is not a supported isolation level when doing DDL on a published table.</span></span>  
  
-   <span data-ttu-id="45b52-155">`SET CONTEXT_INFO` を使用して、パブリッシュされたオブジェクトに対してスキーマの変更が実行されるトランザクションのコンテキストを変更しないでください。</span><span class="sxs-lookup"><span data-stu-id="45b52-155">`SET CONTEXT_INFO` should not be used to modify the context of transactions where schema changes are performed against published objects.</span></span>  
  
#### <a name="adding-columns"></a><span data-ttu-id="45b52-156">列の追加</span><span class="sxs-lookup"><span data-stu-id="45b52-156">Adding Columns</span></span>  
  
-   <span data-ttu-id="45b52-157">テーブルに新しい列を追加し、その列を既存のパブリケーションに含めるには、ALTER TABLE \<Table> ADD \<Column> を実行します。</span><span class="sxs-lookup"><span data-stu-id="45b52-157">To add a new column to a table and include that column in an existing publication, execute ALTER TABLE \<Table> ADD \<Column>.</span></span> <span data-ttu-id="45b52-158">この列は、既定ですべてのサブスクライバーにレプリケートされます。</span><span class="sxs-lookup"><span data-stu-id="45b52-158">By default, the column is then replicated to all Subscribers.</span></span> <span data-ttu-id="45b52-159">この列では、NULL 値を許容するか既定の制約を含める必要があります。</span><span class="sxs-lookup"><span data-stu-id="45b52-159">The column must allow NULL values or include a default constraint.</span></span> <span data-ttu-id="45b52-160">列の追加の詳細については、このトピックの「マージ レプリケーション」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="45b52-160">For more information about adding columns, see the "Merge Replication" section in this topic.</span></span>  
  
-   <span data-ttu-id="45b52-161">テーブルに新しい列を追加し、その列を既存のパブリケーションに含めない場合は、スキーマ変更のレプリケーションを無効にしてから、ALTER TABLE \<Table> ADD \<Column> を実行します。</span><span class="sxs-lookup"><span data-stu-id="45b52-161">To add a new column to a table and not include that column in an existing publication, disable the replication of schema changes, and then execute ALTER TABLE \<Table> ADD \<Column>.</span></span>  
  
-   <span data-ttu-id="45b52-162">既存のパブリケーションに既存の列を含めるには、[sp_articlecolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-articlecolumn-transact-sql)、[sp_mergearticlecolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-mergearticlecolumn-transact-sql)、または **[パブリケーションのプロパティ - \<Publication>]** ダイアログ ボックスを使用します。</span><span class="sxs-lookup"><span data-stu-id="45b52-162">To include an existing column in an existing publication, use [sp_articlecolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-articlecolumn-transact-sql), [sp_mergearticlecolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-mergearticlecolumn-transact-sql), or the **Publication Properties - \<Publication>** dialog box.</span></span>  
  
     <span data-ttu-id="45b52-163">詳しくは、「 [Define and Modify a Column Filter](define-and-modify-a-column-filter.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="45b52-163">For more information, see [Define and Modify a Column Filter](define-and-modify-a-column-filter.md).</span></span> <span data-ttu-id="45b52-164">この場合は、サブスクリプションの再初期化が必要になります。</span><span class="sxs-lookup"><span data-stu-id="45b52-164">This will require subscriptions to be reinitialized.</span></span>  
  
-   <span data-ttu-id="45b52-165">パブリッシュされたテーブルに ID 列を追加することはサポートされていません。これは、列がサブスクライバーにレプリケートされると集約されなくなる可能性があるからです。</span><span class="sxs-lookup"><span data-stu-id="45b52-165">Adding an identity column to a published table is not supported, because it can result in non-convergence when the column is replicated to the Subscriber.</span></span> <span data-ttu-id="45b52-166">パブリッシャーの ID 列の値は、影響を受けるテーブルの行が物理的に格納されている順序に依存します。</span><span class="sxs-lookup"><span data-stu-id="45b52-166">The values in the identity column at the Publisher depend on the order in which the rows for the affected table are physically stored.</span></span> <span data-ttu-id="45b52-167">サブスクライバーで行が同じように格納されているとは限らないため、同じ行で ID 列の値が異なる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="45b52-167">The rows might be stored differently at the Subscriber; therefore the value for the identity column can be different for the same rows.</span></span>  
  
#### <a name="dropping-columns"></a><span data-ttu-id="45b52-168">列の削除</span><span class="sxs-lookup"><span data-stu-id="45b52-168">Dropping Columns</span></span>  
  
-   <span data-ttu-id="45b52-169">既存のパブリケーションから列を削除し、その列をパブリッシャーのテーブルから削除するには、ALTER TABLE \<Table> DROP \<Column> を実行します。</span><span class="sxs-lookup"><span data-stu-id="45b52-169">To drop a column from an existing publication and drop the column from the table at the Publisher, execute ALTER TABLE \<Table> DROP \<Column>.</span></span> <span data-ttu-id="45b52-170">この列は、既定ですべてのサブスクライバーのテーブルから削除されます。</span><span class="sxs-lookup"><span data-stu-id="45b52-170">By default, the column is then dropped from the table at all Subscribers.</span></span>  
  
-   <span data-ttu-id="45b52-171">既存のパブリケーションから列を削除し、その列をパブリッシャーのテーブルで保持しておくには、[sp_articlecolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-articlecolumn-transact-sql)、[sp_mergearticlecolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-mergearticlecolumn-transact-sql)、または **[パブリケーションのプロパティ - \<Publication>]** ダイアログ ボックスを使用します。</span><span class="sxs-lookup"><span data-stu-id="45b52-171">To drop a column from an existing publication but retain the column in the table at the Publisher, use [sp_articlecolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-articlecolumn-transact-sql), [sp_mergearticlecolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-mergearticlecolumn-transact-sql), or the **Publication Properties - \<Publication>** dialog box.</span></span>  
  
     <span data-ttu-id="45b52-172">詳しくは、「 [Define and Modify a Column Filter](define-and-modify-a-column-filter.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="45b52-172">For more information, see [Define and Modify a Column Filter](define-and-modify-a-column-filter.md).</span></span> <span data-ttu-id="45b52-173">この場合は、新しいスナップショットの生成が必要になります。</span><span class="sxs-lookup"><span data-stu-id="45b52-173">This will require a new snapshot to be generated.</span></span>  
  
-   <span data-ttu-id="45b52-174">削除する列は、データベースのどのパブリケーションのどのアーティクルのフィルター句でも使用できません。</span><span class="sxs-lookup"><span data-stu-id="45b52-174">The column to be dropped cannot be used in the filter clauses of any article of any publication in the database.</span></span>  
  
-   <span data-ttu-id="45b52-175">パブリッシュされたアーティクルから列を削除するときには、データベースに影響する可能性のある列の制約、インデックスまたはプロパティについて考慮する必要があります。</span><span class="sxs-lookup"><span data-stu-id="45b52-175">When dropping a column from a published article, take into consideration any constraints, indexes, or properties of the column that could affect the database.</span></span> <span data-ttu-id="45b52-176">次に例を示します。</span><span class="sxs-lookup"><span data-stu-id="45b52-176">For example:</span></span>  
  
    -   <span data-ttu-id="45b52-177">主キーで使用されている列をトランザクション パブリケーションのアーティクルから削除することはできません。それらの列は、レプリケーションによって使用されます。</span><span class="sxs-lookup"><span data-stu-id="45b52-177">You cannot drop columns used in a primary key from articles in transactional publications, because they are used by replication.</span></span>  
  
    -   <span data-ttu-id="45b52-178">マージ パブリケーションのアーティクルから rowguid 列を削除したり、更新サブスクリプションをサポートしているトランザクション パブリケーションのアーティクルから mstran_repl_version 列を削除することはできません。それらの列は、レプリケーションによって使用されます。</span><span class="sxs-lookup"><span data-stu-id="45b52-178">You cannot drop the rowguid column from articles in merge publications or the mstran_repl_version column from articles in transactional publications that support updating subscriptions, because they are used by replication.</span></span>  
  
    -   <span data-ttu-id="45b52-179">インデックスの変更は、サブスクライバーに反映されません。パブリッシャー側で列を削除することにより依存インデックスが削除されても、インデックスの削除はレプリケートされません。</span><span class="sxs-lookup"><span data-stu-id="45b52-179">Index changes are not propagated to Subscribers: if you drop a column at the Publisher and a dependent index is dropped, the index drop is not replicated.</span></span> <span data-ttu-id="45b52-180">パブリッシャー側で列を削除する前に、サブスクライバー側でインデックスを削除する必要があります。この操作を行っておくと、列をパブリッシャーからサブスクライバーにレプリケートするときに列の削除に成功します。</span><span class="sxs-lookup"><span data-stu-id="45b52-180">You should drop the index at the Subscriber before dropping the column at the Publisher, so that the column drop succeeds when it is replicated from the Publisher to the Subscriber.</span></span> <span data-ttu-id="45b52-181">サブスクライバー側のインデックスが原因で同期に失敗する場合、手動でインデックスを削除して、マージ エージェントを再実行してください。</span><span class="sxs-lookup"><span data-stu-id="45b52-181">If synchronization fails because of an index at the Subscriber, manually drop the index and then rerun the Merge Agent.</span></span>  
  
    -   <span data-ttu-id="45b52-182">制約は、削除が可能になるように明示的に名前を付ける必要があります。</span><span class="sxs-lookup"><span data-stu-id="45b52-182">Constraints should be explicitly named to allow for dropping.</span></span> <span data-ttu-id="45b52-183">詳細については、このトピックの「全般的な注意点」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="45b52-183">For more information, see the "General Considerations" section earlier in this topic.</span></span>  
  
### <a name="transactional-replication"></a><span data-ttu-id="45b52-184">トランザクション レプリケーション</span><span class="sxs-lookup"><span data-stu-id="45b52-184">Transactional Replication</span></span>  
  
-   <span data-ttu-id="45b52-185">スキーマ変更は、以前のバージョンの [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]を実行しているサブスクライバーにも反映されますが、DDL ステートメントに含まれているすべての構文が、サブスクライバーで実行されているバージョンでサポートされている必要があります。</span><span class="sxs-lookup"><span data-stu-id="45b52-185">Schema changes are propagated to Subscribers running previous versions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], but the DDL statement should only include syntax supported by the version at the Subscriber.</span></span>  
  
     <span data-ttu-id="45b52-186">サブスクライバーがデータを再パブリッシュする場合にサポートされるスキーマ変更は、列の追加と削除のみです。</span><span class="sxs-lookup"><span data-stu-id="45b52-186">If the Subscriber republishes data, the only supported schema changes are adding and dropping a column.</span></span> <span data-ttu-id="45b52-187">これらの変更は、ALTER TABLE DDL 構文ではなく、[sp_repladdcolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-repladdcolumn-transact-sql) と [sp_repldropcolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-repldropcolumn-transact-sql) を使用して、パブリッシャーで行う必要があります。</span><span class="sxs-lookup"><span data-stu-id="45b52-187">These changes should be made on the Publisher using [sp_repladdcolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-repladdcolumn-transact-sql) and [sp_repldropcolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-repldropcolumn-transact-sql) rather than ALTER TABLE DDL syntax.</span></span>  
  
-   <span data-ttu-id="45b52-188">スキーマ変更は、SQL Server 以外のサブスクライバーにはレプリケートされません。</span><span class="sxs-lookup"><span data-stu-id="45b52-188">Schema changes are not replicated to non-SQL Server Subscribers.</span></span>  
  
-   <span data-ttu-id="45b52-189">スキーマ変更は、[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 以外のパブリッシャーからは反映されません。</span><span class="sxs-lookup"><span data-stu-id="45b52-189">Schema changes are not propagated from non-[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Publishers.</span></span>  
  
-   <span data-ttu-id="45b52-190">テーブルとしてレプリケートされたインデックス付きビューを変更することはできません。</span><span class="sxs-lookup"><span data-stu-id="45b52-190">You cannot alter indexed views that are replicated as tables.</span></span> <span data-ttu-id="45b52-191">インデックス付きビューとしてレプリケートされたインデックス付きビューは変更できますが、変更すると、インデックス付きビューではなく通常のビューになります。</span><span class="sxs-lookup"><span data-stu-id="45b52-191">Indexed views that are replicated as indexed views can be altered, but altering them will cause them to become regular views, rather than indexed views.</span></span>  
  
-   <span data-ttu-id="45b52-192">パブリケーションが即時更新サブスクリプションやキュー更新サブスクリプションをサポートしている場合は、スキーマ変更を行う前にシステムを停止する (パブリッシュされたテーブルのすべての操作をパブリッシャーとサブスクライバーで停止して、保留中のデータ変更をすべてのノードに反映する) 必要があります。</span><span class="sxs-lookup"><span data-stu-id="45b52-192">If the publication supports immediate updating or queued updating subscriptions, the system must be quiesced before making schema changes: all activity on the published table must be stopped at the Publisher and Subscribers, and pending data changes must be propagated to all nodes.</span></span> <span data-ttu-id="45b52-193">スキーマ変更がすべてのノードに反映されたら、パブリッシュされたテーブルの操作を再開できます。</span><span class="sxs-lookup"><span data-stu-id="45b52-193">After the schema changes have propagated to all nodes, activity can resume on the published tables.</span></span>  
  
-   <span data-ttu-id="45b52-194">パブリケーションがピア ツー ピア トポロジにある場合は、スキーマ変更を行う前にシステムを停止する必要があります。</span><span class="sxs-lookup"><span data-stu-id="45b52-194">If the publication is in a peer-to-peer topology, the system must be quiesced before making schema changes.</span></span> <span data-ttu-id="45b52-195">詳細については、「[レプリケーション トポロジの停止 &#40;レプリケーション Transact-SQL プログラミング&#41;](../administration/quiesce-a-replication-topology-replication-transact-sql-programming.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="45b52-195">For more information, see [Quiesce a Replication Topology &#40;Replication Transact-SQL Programming&#41;](../administration/quiesce-a-replication-topology-replication-transact-sql-programming.md).</span></span>  
  
-   <span data-ttu-id="45b52-196">テーブルに timestamp 列を追加して、timestamp を binary(8) にマップすると、すべてのアクティブなサブスクリプションでアーティクルが再初期化されます。</span><span class="sxs-lookup"><span data-stu-id="45b52-196">Adding a timestamp column to a table and mapping the timestamp to binary(8) causes the article to be reinitialized for all active subscriptions.</span></span>  
  
### <a name="merge-replication"></a><span data-ttu-id="45b52-197">マージ レプリケーション</span><span class="sxs-lookup"><span data-stu-id="45b52-197">Merge Replication</span></span>  
  
-   <span data-ttu-id="45b52-198">マージ レプリケーションでスキーマ変更がどのように処理されるかは、パブリケーションの互換性レベルと、スナップショットがネイティブ モード (既定) とキャラクター モードのどちらに設定されているかによって決まります。</span><span class="sxs-lookup"><span data-stu-id="45b52-198">How merge replication handles schema changes is determined by the publication compatibility level, and whether the snapshot is set to native mode (default) or character mode:</span></span>  
  
    -   <span data-ttu-id="45b52-199">スキーマ変更をレプリケートするには、パブリケーションの互換性レベルが少なくとも 90RTM である必要があります。</span><span class="sxs-lookup"><span data-stu-id="45b52-199">To replicate schema changes, the compatibility level of the publication must be at least 90RTM.</span></span> <span data-ttu-id="45b52-200">サブスクライバーが以前のバージョンの [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] を実行している場合や、互換性レベルが 90RTM 未満の場合でも、[sp_repladdcolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-repladdcolumn-transact-sql) や [sp_repldropcolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-repldropcolumn-transact-sql) を使用して列の追加や削除を行うことができます。</span><span class="sxs-lookup"><span data-stu-id="45b52-200">If Subscribers are running previous versions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] or the compatibility level is less than 90RTM you can use [sp_repladdcolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-repladdcolumn-transact-sql) and [sp_repldropcolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-repldropcolumn-transact-sql) to add and drop columns.</span></span> <span data-ttu-id="45b52-201">ただし、これらのプロシージャは非推奨です。</span><span class="sxs-lookup"><span data-stu-id="45b52-201">However, these procedures are deprecated.</span></span>  
  
    -   <span data-ttu-id="45b52-202">[!INCLUDE[ssKatmai](../../../includes/sskatmai-md.md)]で導入されたデータ型の列を既存のアーティクルに追加すると、 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] は次のように動作します。</span><span class="sxs-lookup"><span data-stu-id="45b52-202">If you try to add to an existing article a column with a data type that was introduced in [!INCLUDE[ssKatmai](../../../includes/sskatmai-md.md)], [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] has the following behavior:</span></span>  
  
        ||<span data-ttu-id="45b52-203">100RTM、ネイティブ モードのスナップショット</span><span class="sxs-lookup"><span data-stu-id="45b52-203">100RTM, native snapshot</span></span>|<span data-ttu-id="45b52-204">100RTM、キャラクター モードのスナップショット</span><span class="sxs-lookup"><span data-stu-id="45b52-204">100RTM, character snapshot</span></span>|<span data-ttu-id="45b52-205">その他すべての互換性レベル</span><span class="sxs-lookup"><span data-stu-id="45b52-205">All other compatibility levels</span></span>|  
        |-|-----------------------------|--------------------------------|------------------------------------|  
        |`hierarchyid`|<span data-ttu-id="45b52-206">変更を許可する</span><span class="sxs-lookup"><span data-stu-id="45b52-206">Allow change</span></span>|<span data-ttu-id="45b52-207">変更をブロックする</span><span class="sxs-lookup"><span data-stu-id="45b52-207">Block change</span></span>|<span data-ttu-id="45b52-208">変更をブロックする</span><span class="sxs-lookup"><span data-stu-id="45b52-208">Block change</span></span>|  
        |<span data-ttu-id="45b52-209">`geography` および `geometry`</span><span class="sxs-lookup"><span data-stu-id="45b52-209">`geography` and `geometry`</span></span>|<span data-ttu-id="45b52-210">変更を許可する</span><span class="sxs-lookup"><span data-stu-id="45b52-210">Allow change</span></span>|<span data-ttu-id="45b52-211">変更の許可<sup>1</sup></span><span class="sxs-lookup"><span data-stu-id="45b52-211">Allow change<sup>1</sup></span></span>|<span data-ttu-id="45b52-212">変更をブロックする</span><span class="sxs-lookup"><span data-stu-id="45b52-212">Block change</span></span>|  
        |`filestream`|<span data-ttu-id="45b52-213">変更を許可する</span><span class="sxs-lookup"><span data-stu-id="45b52-213">Allow change</span></span>|<span data-ttu-id="45b52-214">変更をブロックする</span><span class="sxs-lookup"><span data-stu-id="45b52-214">Block change</span></span>|<span data-ttu-id="45b52-215">変更をブロックする</span><span class="sxs-lookup"><span data-stu-id="45b52-215">Block change</span></span>|  
        |<span data-ttu-id="45b52-216">`date`、`time`、`datetime2`、および `datetimeoffset`</span><span class="sxs-lookup"><span data-stu-id="45b52-216">`date`, `time`, `datetime2`, and `datetimeoffset`</span></span>|<span data-ttu-id="45b52-217">変更を許可する</span><span class="sxs-lookup"><span data-stu-id="45b52-217">Allow change</span></span>|<span data-ttu-id="45b52-218">変更の許可<sup>1</sup></span><span class="sxs-lookup"><span data-stu-id="45b52-218">Allow change<sup>1</sup></span></span>|<span data-ttu-id="45b52-219">変更をブロックする</span><span class="sxs-lookup"><span data-stu-id="45b52-219">Block change</span></span>|  
  
         <span data-ttu-id="45b52-220"><sup>1</sup> SQL Server Compact サブスクライバーでこれらのデータ型を変換します。</span><span class="sxs-lookup"><span data-stu-id="45b52-220"><sup>1</sup> SQL Server Compact Subscribers convert these data types at the Subscriber.</span></span>  
  
-   <span data-ttu-id="45b52-221">スキーマ変更の適用時にエラー (サブスクライバーで利用できないテーブルを参照する外部キーを追加した結果のエラーなど) が発生すると、同期が失敗し、サブスクリプションを再初期化しなければならなくなります。</span><span class="sxs-lookup"><span data-stu-id="45b52-221">If an error occurs when applying a schema change (such as an error resulting from adding a foreign key that references a table not available at the Subscriber), synchronization fails and the subscription must be reinitialized.</span></span>  
  
-   <span data-ttu-id="45b52-222">結合フィルターやパラメーター化されたフィルターに含まれている列に対してスキーマ変更を行う場合は、すべてのサブスクリプションを再初期化し、スナップショットを再生成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="45b52-222">If a schema change is made on a column involved in a join filter or parameterized filter, you must reinitialize all subscriptions and regenerate the snapshot.</span></span>  
  
-   <span data-ttu-id="45b52-223">マージ レプリケーションには、トラブルシューティングの際にスキーマ変更をスキップするストアド プロシージャが用意されています。</span><span class="sxs-lookup"><span data-stu-id="45b52-223">Merge replication provides stored procedures to skip schema changes during troubleshooting.</span></span> <span data-ttu-id="45b52-224">詳細については、「[sp_markpendingschemachange &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-markpendingschemachange-transact-sql)」および「[sp_enumeratependingschemachanges &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-enumeratependingschemachanges-transact-sql)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="45b52-224">For more information, see [sp_markpendingschemachange &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-markpendingschemachange-transact-sql) and [sp_enumeratependingschemachanges &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-enumeratependingschemachanges-transact-sql).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="45b52-225">参照</span><span class="sxs-lookup"><span data-stu-id="45b52-225">See Also</span></span>  
 <span data-ttu-id="45b52-226">[ALTER TABLE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-table-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="45b52-226">[ALTER TABLE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-table-transact-sql) </span></span>  
 <span data-ttu-id="45b52-227">[ALTER VIEW &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-view-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="45b52-227">[ALTER VIEW &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-view-transact-sql) </span></span>  
 <span data-ttu-id="45b52-228">[ALTER PROCEDURE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-procedure-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="45b52-228">[ALTER PROCEDURE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-procedure-transact-sql) </span></span>  
 <span data-ttu-id="45b52-229">[ALTER FUNCTION &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-function-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="45b52-229">[ALTER FUNCTION &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-function-transact-sql) </span></span>  
 <span data-ttu-id="45b52-230">[ALTER TRIGGER &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-trigger-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="45b52-230">[ALTER TRIGGER &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-trigger-transact-sql) </span></span>  
 <span data-ttu-id="45b52-231">[データとデータベース オブジェクトのパブリッシュ](publish-data-and-database-objects.md) </span><span class="sxs-lookup"><span data-stu-id="45b52-231">[Publish Data and Database Objects](publish-data-and-database-objects.md) </span></span>  
 [<span data-ttu-id="45b52-232">カスタム トランザクション プロシージャの再生成によるスキーマ変更の反映</span><span class="sxs-lookup"><span data-stu-id="45b52-232">Regenerate Custom Transactional Procedures to Reflect Schema Changes</span></span>](../transactional/transactional-articles-regenerate-to-reflect-schema-changes.md)  
  
  
