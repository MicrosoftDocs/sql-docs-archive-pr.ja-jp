---
title: クライアント接続でのサービスプリンシパル名 (Spn) (ODBC) |Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
ms.assetid: 1d60cb30-4c46-49b2-89ab-701e77a330a2
author: rothja
ms.author: jroth
ms.openlocfilehash: 752cbdbf017fac6d086b9493c23ea7a490ac6ef7
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87718081"
---
# <a name="service-principal-names-spns-in-client-connections-odbc"></a><span data-ttu-id="7cd40-102">クライアント接続におけるサービス プリンシパル名 (SPN) (ODBC)</span><span class="sxs-lookup"><span data-stu-id="7cd40-102">Service Principal Names (SPNs) in Client Connections (ODBC)</span></span>
  <span data-ttu-id="7cd40-103">ここでは、クライアント アプリケーションのサービス プリンシパル名 (SPN) をサポートする ODBC 属性および関数について説明します。</span><span class="sxs-lookup"><span data-stu-id="7cd40-103">This topic describes ODBC attributes and functions that support service principal names (SPNs) in client applications.</span></span> <span data-ttu-id="7cd40-104">クライアントアプリケーションでの Spn の詳細については、「[サービスプリンシパル名 &#40;spn&#41; クライアント接続でのサポート](../features/service-principal-name-spn-support-in-client-connections.md)」および「[相互 Kerberos 認証の取得](../../native-client-odbc-how-to/get-mutual-kerberos-authentication.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="7cd40-104">For more information about SPNs in client applications, see [Service Principal Name &#40;SPN&#41; Support in Client Connections](../features/service-principal-name-spn-support-in-client-connections.md) and [Get Mutual Kerberos Authentication](../../native-client-odbc-how-to/get-mutual-kerberos-authentication.md).</span></span>  
  
## <a name="connection-string-keywords"></a><span data-ttu-id="7cd40-105">接続文字列キーワード</span><span class="sxs-lookup"><span data-stu-id="7cd40-105">Connection String Keywords</span></span>  
 <span data-ttu-id="7cd40-106">次の接続文字列キーワードを使用すると、クライアント アプリケーションは SPN を指定できます。</span><span class="sxs-lookup"><span data-stu-id="7cd40-106">The following connection string keywords enable client applications to specify an SPN.</span></span>  
  
|<span data-ttu-id="7cd40-107">キーワード</span><span class="sxs-lookup"><span data-stu-id="7cd40-107">Keyword</span></span>|<span data-ttu-id="7cd40-108">値</span><span class="sxs-lookup"><span data-stu-id="7cd40-108">Value</span></span>|  
|-------------|-----------|  
|`ServerSPN`|<span data-ttu-id="7cd40-109">サーバーの SPN。</span><span class="sxs-lookup"><span data-stu-id="7cd40-109">The SPN for the server.</span></span> <span data-ttu-id="7cd40-110">既定値は空文字です。この場合、[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client は、ドライバーが生成した SPN を既定値として使用します。</span><span class="sxs-lookup"><span data-stu-id="7cd40-110">The default value is an empty string, which causes [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client to use the default, driver-generated SPN.</span></span>|  
|`FailoverPartnerSPN`|<span data-ttu-id="7cd40-111">フェールオーバー パートナーの SPN。</span><span class="sxs-lookup"><span data-stu-id="7cd40-111">The SPN for the failover partner.</span></span> <span data-ttu-id="7cd40-112">既定値は空文字です。この場合、[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client は、ドライバーが生成した SPN を既定値として使用します。</span><span class="sxs-lookup"><span data-stu-id="7cd40-112">The default value is an empty string, which causes [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client to use the default, driver-generated SPN.</span></span>|  
  
## <a name="connection-attributes"></a><span data-ttu-id="7cd40-113">接続属性</span><span class="sxs-lookup"><span data-stu-id="7cd40-113">Connection Attributes</span></span>  
 <span data-ttu-id="7cd40-114">次の接続属性を使用すると、クライアント アプリケーションは、SPN を指定して認証方法を照会できます。</span><span class="sxs-lookup"><span data-stu-id="7cd40-114">The following connection attributes enable client applications to specify an SPN and query for the authentication method.</span></span>  
  
|<span data-ttu-id="7cd40-115">名前</span><span class="sxs-lookup"><span data-stu-id="7cd40-115">Name</span></span>|<span data-ttu-id="7cd40-116">Type</span><span class="sxs-lookup"><span data-stu-id="7cd40-116">Type</span></span>|<span data-ttu-id="7cd40-117">使用法</span><span class="sxs-lookup"><span data-stu-id="7cd40-117">Usage</span></span>|  
|----------|----------|-----------|  
|<span data-ttu-id="7cd40-118">SQL_COPT_SS_SERVER_SPN</span><span class="sxs-lookup"><span data-stu-id="7cd40-118">SQL_COPT_SS_SERVER_SPN</span></span><br /><br /> <span data-ttu-id="7cd40-119">SQL_COPT_SS_FAILOVER_PARTNER_SPN</span><span class="sxs-lookup"><span data-stu-id="7cd40-119">SQL_COPT_SS_FAILOVER_PARTNER_SPN</span></span>|<span data-ttu-id="7cd40-120">SQLTCHAR、読み取り/書き込み</span><span class="sxs-lookup"><span data-stu-id="7cd40-120">SQLTCHAR, read/write</span></span>|<span data-ttu-id="7cd40-121">サーバーの SPN を指定します。</span><span class="sxs-lookup"><span data-stu-id="7cd40-121">Specifies the SPN for the server.</span></span> <span data-ttu-id="7cd40-122">既定値は空文字です。この場合、[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client は、ドライバーが生成した SPN を既定値として使用します。</span><span class="sxs-lookup"><span data-stu-id="7cd40-122">The default value is an empty string, which causes [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client to use the default, driver-generated SPN.</span></span><br /><br /> <span data-ttu-id="7cd40-123">この属性を照会できるのは、属性がプログラムによって設定された後、または接続が開かれた後だけです。</span><span class="sxs-lookup"><span data-stu-id="7cd40-123">This attribute can be queried only after it has been set programmatically, or after a connection has been opened.</span></span> <span data-ttu-id="7cd40-124">接続が開いていない場合にこの属性を照会し、属性がプログラムによって設定されていない場合、SQL_ERROR が返され、"接続は開いていません" というメッセージで SQLState 08003 の診断レコードが記録されます。</span><span class="sxs-lookup"><span data-stu-id="7cd40-124">If an attempt is made to query this attribute on a connection that is not open and the attribute has not been set programmatically, SQL_ERROR is returned, and a diagnostic record is logged with SQLState 08003 and the message "Connection not open".</span></span><br /><br /> <span data-ttu-id="7cd40-125">接続が開いている場合にこの属性を設定すると、SQL_ERROR が返され、"この操作は、ここでは実行できません" というメッセージで SQLState HY011 の診断レコードが記録されます。</span><span class="sxs-lookup"><span data-stu-id="7cd40-125">If an attempt is made to set this attribute when a connection is open, SQL_ERROR is returned, and a diagnostic record is logged with SQLState HY011 and the message "Operation invalid at this time".</span></span>|  
|<span data-ttu-id="7cd40-126">SQL_COPT_SS_INTEGRATED_AUTHENTICATION_METHOD</span><span class="sxs-lookup"><span data-stu-id="7cd40-126">SQL_COPT_SS_INTEGRATED_AUTHENTICATION_METHOD</span></span>|<span data-ttu-id="7cd40-127">SQLTCHAR、読み取り専用</span><span class="sxs-lookup"><span data-stu-id="7cd40-127">SQLTCHAR, read-only</span></span>|<span data-ttu-id="7cd40-128">接続に使用された認証方法を返します。</span><span class="sxs-lookup"><span data-stu-id="7cd40-128">Returns the authentication method used for the connection.</span></span> <span data-ttu-id="7cd40-129">アプリケーションに返される値は、Windows が [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client に返す値です。</span><span class="sxs-lookup"><span data-stu-id="7cd40-129">The value returned to the application is the value that Windows returns to [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client.</span></span> <span data-ttu-id="7cd40-130">次のいずれかの値になります。</span><span class="sxs-lookup"><span data-stu-id="7cd40-130">Possible values are:</span></span><br /><br /> <span data-ttu-id="7cd40-131">-"NTLM" は、NTLM 認証を使用して接続を開いたときに返されます。</span><span class="sxs-lookup"><span data-stu-id="7cd40-131">-   "NTLM", which is returned when a connection is opened using NTLM authentication.</span></span><br /><span data-ttu-id="7cd40-132">-"Kerberos" は、Kerberos 認証を使用して接続が開かれたときに返されます。</span><span class="sxs-lookup"><span data-stu-id="7cd40-132">-   "Kerberos", which is returned when a connection is opened using Kerberos authentication.</span></span><br /><br /> <span data-ttu-id="7cd40-133">この属性は、Windows 認証を使用する、開いている接続でのみ読み取りが可能です。</span><span class="sxs-lookup"><span data-stu-id="7cd40-133">This attribute can only be read for an open connection that used Windows Authentication.</span></span> <span data-ttu-id="7cd40-134">接続が開かれる前にこの属性を読み取ると、SQL_ERROR が返され、"接続は開いていません" というメッセージで SQLState 08003 がエラーとして記録されます。</span><span class="sxs-lookup"><span data-stu-id="7cd40-134">If an attempt is made to read it before a connection has been opened, SQL_ERROR is returned, and an error is logged with SQLState 08003 and the message "Connection not open".</span></span><br /><br /> <span data-ttu-id="7cd40-135">この属性が Windows 認証を使用していない接続で照会されると、SQL_ERROR が返され、"属性またはオプション識別子が無効です (SQL_COPT_SS_INTEGRATED_AUTHENTICATION_METHOD は信頼関係接続でのみ使用できます)" というメッセージで SQLState HY092 がエラーとして記録されます。</span><span class="sxs-lookup"><span data-stu-id="7cd40-135">If this attribute is queried on a connection that did not use Windows Authentication, SQL_ERROR is returned, and an error is logged with SQLState HY092 and the message "Invalid attribute/option identifier (SQL_COPT_SS_INTEGRATED_AUTHENTICATION_METHOD is only available for Trusted Connections)".</span></span><br /><br /> <span data-ttu-id="7cd40-136">認証方法を特定できない場合は、SQL_ERROR が返され、"一般的なエラー" というメッセージで SQLState HY000 がエラーとして記録されます。</span><span class="sxs-lookup"><span data-stu-id="7cd40-136">If the authentication method cannot be determined, SQL_ERROR is returned, and an error is logged with SQLState HY000 and the message "General error".</span></span>|  
|<span data-ttu-id="7cd40-137">SQL_COPT_SS_MUTUALLY_AUTHENTICATED</span><span class="sxs-lookup"><span data-stu-id="7cd40-137">SQL_COPT_SS_MUTUALLY_AUTHENTICATED</span></span>|<span data-ttu-id="7cd40-138">SQLSMALLINT、読み取り専用</span><span class="sxs-lookup"><span data-stu-id="7cd40-138">SQLSMALLINT, read-only</span></span>|<span data-ttu-id="7cd40-139">接続されているサーバーが相互に認証された場合は SQL_TRUE を返します。それ以外の場合は SQL_FALSE を返します。</span><span class="sxs-lookup"><span data-stu-id="7cd40-139">Returns SQL_TRUE if the server in the connection was mutually authenticated; otherwise, returns SQL_FALSE.</span></span><br /><br /> <span data-ttu-id="7cd40-140">この属性は、開いている接続のみで読み取ることができます。</span><span class="sxs-lookup"><span data-stu-id="7cd40-140">This attribute can only be read for an open connection.</span></span> <span data-ttu-id="7cd40-141">接続が開かれる前にこの属性を読み取ると、SQL_ERROR が返され、"接続は開いていません" というメッセージで SQLState 08003 がエラーとして記録されます。</span><span class="sxs-lookup"><span data-stu-id="7cd40-141">If an attempt is made to read it before a connection has been opened, SQL_ERROR is returned, and an error is logged with SQLState 08003 and the message "Connection not open".</span></span><br /><br /> <span data-ttu-id="7cd40-142">Windows 認証を使用していない接続に対してこの属性が照会されると、SQL_FALSE が返されます。</span><span class="sxs-lookup"><span data-stu-id="7cd40-142">If this attribute is queried for a connection that did not use Windows Authentication, SQL_FALSE is returned.</span></span>|  
  
## <a name="odbc-function-support-for-specifying-spns"></a><span data-ttu-id="7cd40-143">ODBC 関数による SPN 指定のサポート</span><span class="sxs-lookup"><span data-stu-id="7cd40-143">ODBC Function Support for Specifying SPNs</span></span>  
 <span data-ttu-id="7cd40-144">次の ODBC 関数では、クライアント アプリケーションと SPN をサポートしています。</span><span class="sxs-lookup"><span data-stu-id="7cd40-144">The following ODBC functions support client applications and SPNs:</span></span>  
  
-   [<span data-ttu-id="7cd40-145">SQLBrowseConnect</span><span class="sxs-lookup"><span data-stu-id="7cd40-145">SQLBrowseConnect</span></span>](../../native-client-odbc-api/sqlbrowseconnect.md)  
  
-   [<span data-ttu-id="7cd40-146">SQLConnect</span><span class="sxs-lookup"><span data-stu-id="7cd40-146">SQLConnect</span></span>](../../native-client-odbc-api/sqlconnect.md)  
  
-   [<span data-ttu-id="7cd40-147">SQLDriverConnect</span><span class="sxs-lookup"><span data-stu-id="7cd40-147">SQLDriverConnect</span></span>](../../native-client-odbc-api/sqldriverconnect.md)  
  
-   [<span data-ttu-id="7cd40-148">SQLGetConnectAttr</span><span class="sxs-lookup"><span data-stu-id="7cd40-148">SQLGetConnectAttr</span></span>](../../native-client-odbc-api/sqlgetconnectattr.md)  
  
-   [<span data-ttu-id="7cd40-149">SQLSetConnectAttr</span><span class="sxs-lookup"><span data-stu-id="7cd40-149">SQLSetConnectAttr</span></span>](../../native-client-odbc-api/sqlsetconnectattr.md)  
  
## <a name="see-also"></a><span data-ttu-id="7cd40-150">参照</span><span class="sxs-lookup"><span data-stu-id="7cd40-150">See Also</span></span>  
 [<span data-ttu-id="7cd40-151">SQL Server Native Client &#40;ODBC&#41;</span><span class="sxs-lookup"><span data-stu-id="7cd40-151">SQL Server Native Client &#40;ODBC&#41;</span></span>](sql-server-native-client-odbc.md)  
  
  
