---
title: プログラムによるパスワードの変更 | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- data access [SQL Server Native Client], password expiration
- SQL Server Native Client ODBC driver, passwords
- SQL Server Native Client OLE DB provider, passwords
- passwords [SQL Server], expiration
- SQLNCLI, password expiration
- expiration [SQL Server Native Client]
- passwords [SQL Server], modifying
- expired passwords [SQL Server Native Client]
- SQL Server Native Client, password expiration
- modifying passwords
ms.assetid: 624ad949-5fed-4ce5-b319-878549f9487b
author: rothja
ms.author: jroth
ms.openlocfilehash: 86085f8ba7c54cfcab1a3c7f6e8ade30ecf9d0da
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87714290"
---
# <a name="changing-passwords-programmatically"></a><span data-ttu-id="84a15-102">プログラムによるパスワードの変更</span><span class="sxs-lookup"><span data-stu-id="84a15-102">Changing Passwords Programmatically</span></span>
  <span data-ttu-id="84a15-103">[!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] より前のリリースでは、ユーザーのパスワードの有効期限が切れたとき、そのパスワードをリセットできるのは管理者だけでした。</span><span class="sxs-lookup"><span data-stu-id="84a15-103">Before [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], when a user's password expired, only an administrator could reset it.</span></span> <span data-ttu-id="84a15-104">以降で [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] は、Native client は、 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] native client OLE DB プロバイダーと NATIVE client ODBC ドライバーの両方を介してプログラムによってパスワードの有効期限を処理 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] し、 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] **SQL Server のログイン**ダイアログボックスに変更を加えることができます。</span><span class="sxs-lookup"><span data-stu-id="84a15-104">Beginning with [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client supports handling password expiration programmatically through both the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider and the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver, and through changes to the **SQL Server Login** dialog boxes.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="84a15-105">可能であれば、実行時にユーザーの資格情報を入力し、それらの資格情報を永続的な形式で保存しないように求めるメッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="84a15-105">When possible, prompt users to enter their credentials at run time and avoid storing their credentials in a persisted format.</span></span> <span data-ttu-id="84a15-106">資格情報を保持する必要がある場合は、[Win32 Crypto API](https://go.microsoft.com/fwlink/?LinkId=64532) を使用して暗号化してください。</span><span class="sxs-lookup"><span data-stu-id="84a15-106">If you must persist their credentials, you should encrypt them using the [Win32 crypto API](https://go.microsoft.com/fwlink/?LinkId=64532).</span></span> <span data-ttu-id="84a15-107">パスワードの使用に関する詳細については、「[強力なパスワード](../../security/strong-passwords.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="84a15-107">For more information about the use of passwords, see [Strong Passwords](../../security/strong-passwords.md).</span></span>  
  
## <a name="sql-server-login-error-codes"></a><span data-ttu-id="84a15-108">SQL Server ログイン エラー コード</span><span class="sxs-lookup"><span data-stu-id="84a15-108">SQL Server Login Error Codes</span></span>  
 <span data-ttu-id="84a15-109">認証の問題により接続できない場合、アプリケーションでは次のいずれかの SQL Server エラー コードを使用して、診断と復旧に役立てることができます。</span><span class="sxs-lookup"><span data-stu-id="84a15-109">When a connection cannot be made because of authentication problems, one of the following SQL Server error codes will be available to the application to assist diagnosis and recovery.</span></span>  
  
|<span data-ttu-id="84a15-110">SQL Server エラー コード</span><span class="sxs-lookup"><span data-stu-id="84a15-110">SQL Server Error Code</span></span>|<span data-ttu-id="84a15-111">エラー メッセージ</span><span class="sxs-lookup"><span data-stu-id="84a15-111">Error Message</span></span>|  
|---------------------------|-------------------|  
|<span data-ttu-id="84a15-112">15113</span><span class="sxs-lookup"><span data-stu-id="84a15-112">15113</span></span>|<span data-ttu-id="84a15-113">ユーザー '%.\*ls' はログインできませんでした。理由: パスワードの検証に失敗しました。</span><span class="sxs-lookup"><span data-stu-id="84a15-113">Login failed for user '%.\*ls' Reason: Password validation failed.</span></span> <span data-ttu-id="84a15-114">アカウントはロックアウトされています。</span><span class="sxs-lookup"><span data-stu-id="84a15-114">The account is locked out.</span></span>|  
|<span data-ttu-id="84a15-115">18463</span><span class="sxs-lookup"><span data-stu-id="84a15-115">18463</span></span>|<span data-ttu-id="84a15-116">ユーザー '%.\*ls' はログインできませんでした。</span><span class="sxs-lookup"><span data-stu-id="84a15-116">Login failed for user '%.\*ls'.</span></span> <span data-ttu-id="84a15-117">理由: パスワードを変更できませんでした。</span><span class="sxs-lookup"><span data-stu-id="84a15-117">Reason: Password change failed.</span></span> <span data-ttu-id="84a15-118">この時点ではパスワードを使用できません。</span><span class="sxs-lookup"><span data-stu-id="84a15-118">The password cannot be used at this time.</span></span>|  
|<span data-ttu-id="84a15-119">18464</span><span class="sxs-lookup"><span data-stu-id="84a15-119">18464</span></span>|<span data-ttu-id="84a15-120">ユーザー '%.\*ls' はログインできませんでした。</span><span class="sxs-lookup"><span data-stu-id="84a15-120">Login failed for user '%.\*ls'.</span></span> <span data-ttu-id="84a15-121">理由: パスワードを変更できませんでした。</span><span class="sxs-lookup"><span data-stu-id="84a15-121">Reason: Password change failed.</span></span> <span data-ttu-id="84a15-122">このパスワードは短すぎるので、Windows ポリシーの要件を満たしません。</span><span class="sxs-lookup"><span data-stu-id="84a15-122">The password does not meet policy requirements because it is too short.</span></span>|  
|<span data-ttu-id="84a15-123">18465</span><span class="sxs-lookup"><span data-stu-id="84a15-123">18465</span></span>|<span data-ttu-id="84a15-124">ユーザー '%.\*ls' はログインできませんでした。</span><span class="sxs-lookup"><span data-stu-id="84a15-124">Login failed for user '%.\*ls'.</span></span> <span data-ttu-id="84a15-125">理由: パスワードを変更できませんでした。</span><span class="sxs-lookup"><span data-stu-id="84a15-125">Reason: Password change failed.</span></span> <span data-ttu-id="84a15-126">パスワードは長すぎるため、ポリシー要件を満たしません。</span><span class="sxs-lookup"><span data-stu-id="84a15-126">The password does not meet policy requirements because it is too long.</span></span>|  
|<span data-ttu-id="84a15-127">18466</span><span class="sxs-lookup"><span data-stu-id="84a15-127">18466</span></span>|<span data-ttu-id="84a15-128">ユーザー '%.\*ls' はログインできませんでした。</span><span class="sxs-lookup"><span data-stu-id="84a15-128">Login failed for user '%.\*ls'.</span></span> <span data-ttu-id="84a15-129">理由: パスワードを変更できませんでした。</span><span class="sxs-lookup"><span data-stu-id="84a15-129">Reason: Password change failed.</span></span> <span data-ttu-id="84a15-130">このパスワードはあまり複雑ではないので、Windows のポリシー要件を満たしません。</span><span class="sxs-lookup"><span data-stu-id="84a15-130">The password does not meet policy requirements because it is not complex enough.</span></span>|  
|<span data-ttu-id="84a15-131">18467</span><span class="sxs-lookup"><span data-stu-id="84a15-131">18467</span></span>|<span data-ttu-id="84a15-132">ユーザー '%.\*ls' はログインできませんでした。</span><span class="sxs-lookup"><span data-stu-id="84a15-132">Login failed for user '%.\*ls'.</span></span> <span data-ttu-id="84a15-133">理由: パスワードを変更できませんでした。</span><span class="sxs-lookup"><span data-stu-id="84a15-133">Reason: Password change failed.</span></span> <span data-ttu-id="84a15-134">パスワードがパスワード フィルター DLL の要件を満たしていません。</span><span class="sxs-lookup"><span data-stu-id="84a15-134">The password does not meet the requirements of the password filter DLL.</span></span>|  
|<span data-ttu-id="84a15-135">18468</span><span class="sxs-lookup"><span data-stu-id="84a15-135">18468</span></span>|<span data-ttu-id="84a15-136">ユーザー '%.\*ls' はログインできませんでした。</span><span class="sxs-lookup"><span data-stu-id="84a15-136">Login failed for user '%.\*ls'.</span></span> <span data-ttu-id="84a15-137">理由: パスワードを変更できませんでした。</span><span class="sxs-lookup"><span data-stu-id="84a15-137">Reason: Password change failed.</span></span> <span data-ttu-id="84a15-138">パスワードの検証で予期しないエラーが発生しました。</span><span class="sxs-lookup"><span data-stu-id="84a15-138">An unexpected error occurred during password validation.</span></span>|  
|<span data-ttu-id="84a15-139">18487</span><span class="sxs-lookup"><span data-stu-id="84a15-139">18487</span></span>|<span data-ttu-id="84a15-140">ユーザー '%.\*ls' はログインできませんでした。</span><span class="sxs-lookup"><span data-stu-id="84a15-140">Login failed for user '%.\*ls'.</span></span> <span data-ttu-id="84a15-141">理由: このアカウントのパスワードの有効期限が切れています。</span><span class="sxs-lookup"><span data-stu-id="84a15-141">Reason: The password of the account has expired.</span></span>|  
|<span data-ttu-id="84a15-142">18488</span><span class="sxs-lookup"><span data-stu-id="84a15-142">18488</span></span>|<span data-ttu-id="84a15-143">ユーザー '%.\*ls' はログインできませんでした。</span><span class="sxs-lookup"><span data-stu-id="84a15-143">Login failed for user '%.\*ls'.</span></span> <span data-ttu-id="84a15-144">理由: このアカウントのパスワードを変更する必要があります。</span><span class="sxs-lookup"><span data-stu-id="84a15-144">Reason: The password of the account must be changed.</span></span>|  
  
## <a name="sql-server-native-client-ole-db-provider"></a><span data-ttu-id="84a15-145">SQL Server Native Client OLE DB プロバイダー</span><span class="sxs-lookup"><span data-stu-id="84a15-145">SQL Server Native Client OLE DB Provider</span></span>  
 <span data-ttu-id="84a15-146">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]Native Client OLE DB プロバイダーは、ユーザーインターフェイスとプログラムを使ってパスワードの有効期限をサポートします。</span><span class="sxs-lookup"><span data-stu-id="84a15-146">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider supports password expiration though a user interface and programmatically.</span></span>  
  
### <a name="ole-db-user-interface-password-expiration"></a><span data-ttu-id="84a15-147">OLE DB ユーザー インターフェイスによるパスワード期限切れの処理</span><span class="sxs-lookup"><span data-stu-id="84a15-147">OLE DB User Interface Password Expiration</span></span>  
 <span data-ttu-id="84a15-148">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]Native Client OLE DB プロバイダーは、 **SQL Server ログイン**ダイアログボックスに対して行われた変更によって、パスワードの有効期限をサポートします。</span><span class="sxs-lookup"><span data-stu-id="84a15-148">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider supports password expiration through changes made to the **SQL Server Login** dialog boxes.</span></span> <span data-ttu-id="84a15-149">DBPROP_INIT_PROMPT の値を DBPROMPT_NOPROMPT に設定すると、パスワードの有効期限が切れている場合に、最初の接続試行が失敗します。</span><span class="sxs-lookup"><span data-stu-id="84a15-149">If the value of DBPROP_INIT_PROMPT is set to DBPROMPT_NOPROMPT, the initial connection attempt will fail if the password has expired.</span></span>  
  
 <span data-ttu-id="84a15-150">DBPROP_INIT_PROMPT を DBPROMPT_NOPROMPT 以外の値に設定している場合は、パスワードの有効期限が切れているかどうかに関係なく、**[SQL Server ログイン]** ダイアログ ボックスが表示されます。</span><span class="sxs-lookup"><span data-stu-id="84a15-150">If DBPROP_INIT_PROMPT has been set to any other value, the user sees the **SQL Server Login** dialog, regardless of whether or not the password has expired.</span></span> <span data-ttu-id="84a15-151">ユーザーは、**[オプション]** をクリックし、**[パスワードの変更]** チェック ボックスをオンにしてパスワードを変更できます。</span><span class="sxs-lookup"><span data-stu-id="84a15-151">The user can click on the **Options** button and check **Change Password** to change the password.</span></span>  
  
 <span data-ttu-id="84a15-152">パスワードの有効期限が切れている場合にユーザーが [OK] をクリックすると、[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] からユーザーに **[パスワードの変更]** ダイアログ ボックスを使用して新しいパスワードを入力し、確認することを要求されます。</span><span class="sxs-lookup"><span data-stu-id="84a15-152">If the user clicks OK and the password has expired, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] prompts the user to enter and confirm a new password using the **Change SQL Server Password** dialog.</span></span>  
  
#### <a name="ole-db-prompt-behavior-and-locked-accounts"></a><span data-ttu-id="84a15-153">OLE DB プロンプトの動作とロックされたアカウント</span><span class="sxs-lookup"><span data-stu-id="84a15-153">OLE DB Prompt Behavior and Locked Accounts</span></span>  
 <span data-ttu-id="84a15-154">アカウントがロックされていることにより、接続に失敗することがあります。</span><span class="sxs-lookup"><span data-stu-id="84a15-154">Connection attempts may fail due to the account being locked.</span></span> <span data-ttu-id="84a15-155">**[SQL Server ログイン]** ダイアログ ボックスが表示された後にこの現象が発生する場合は、サーバー エラー メッセージが表示され、接続試行が中止されます。</span><span class="sxs-lookup"><span data-stu-id="84a15-155">If this occurs following the display of the **SQL Server Login** dialog, the server error message is displayed to the user and the connection attempt is aborted.</span></span> <span data-ttu-id="84a15-156">また、**[パスワードの変更]** ダイアログ ボックスが表示された後にユーザーが古いパスワードに無効な値を入力すると、この現象が発生することもあります。</span><span class="sxs-lookup"><span data-stu-id="84a15-156">It may also occur following the display of the **Change SQL Server Password** dialog if the user enters a bad value for the old password.</span></span> <span data-ttu-id="84a15-157">この場合も同じエラー メッセージが表示され、接続試行が中止されます。</span><span class="sxs-lookup"><span data-stu-id="84a15-157">In this case the same error message is displayed, and the connection attempt is aborted.</span></span>  
  
#### <a name="ole-db-connection-pooling-password-expiration-and-locked-accounts"></a><span data-ttu-id="84a15-158">OLE DB 接続プーリング、パスワードの期限切れ、およびロックされたアカウント</span><span class="sxs-lookup"><span data-stu-id="84a15-158">OLE DB Connection Pooling, Password Expiration, and Locked Accounts</span></span>  
 <span data-ttu-id="84a15-159">接続プール内で接続がアクティブな状態になっている間に、アカウントがロックされたり、そのアカウントのパスワードの有効期限が切れたりすることがあります。</span><span class="sxs-lookup"><span data-stu-id="84a15-159">An account may be locked or its password may expire while the connection is still active in a connection pool.</span></span> <span data-ttu-id="84a15-160">サーバーでは、期限切れのパスワードとロックされたアカウントを 2 回チェックします。</span><span class="sxs-lookup"><span data-stu-id="84a15-160">The server checks for expired passwords and locked accounts on two occasions.</span></span> <span data-ttu-id="84a15-161">最初のチェックは、初回接続時に行われます。</span><span class="sxs-lookup"><span data-stu-id="84a15-161">The first is when a connection is first created.</span></span> <span data-ttu-id="84a15-162">2 回目のチェックは、接続のリセット時、接続がプールから取り除かれるときに行われます。</span><span class="sxs-lookup"><span data-stu-id="84a15-162">The second occasion is upon connection reset, when the connection is taken from the pool.</span></span>  
  
 <span data-ttu-id="84a15-163">リセットの試行が失敗すると、その接続はプールから削除され、エラーが返されます。</span><span class="sxs-lookup"><span data-stu-id="84a15-163">When the reset attempt fails, the connection is removed from the pool and an error is returned.</span></span>  
  
### <a name="ole-db-programmatic-password-expiration"></a><span data-ttu-id="84a15-164">OLE DB プログラムによるパスワード期限切れの処理</span><span class="sxs-lookup"><span data-stu-id="84a15-164">OLE DB Programmatic Password Expiration</span></span>  
 <span data-ttu-id="84a15-165">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]Native Client OLE DB プロバイダーは、DBPROPSET_SQLSERVERDBINIT のプロパティセットに追加された SSPROP_AUTH_OLD_PASSWORD (type VT_BSTR) プロパティを追加することによって、パスワードの有効期限をサポートします。</span><span class="sxs-lookup"><span data-stu-id="84a15-165">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider supports password expiration through the addition of the SSPROP_AUTH_OLD_PASSWORD (type VT_BSTR) property that has been added to the DBPROPSET_SQLSERVERDBINIT property set.</span></span>  
  
 <span data-ttu-id="84a15-166">既存の "Password" プロパティは DBPROP_AUTH_PASSWORD を参照し、新しいパスワードを保存する場合に使用されます。</span><span class="sxs-lookup"><span data-stu-id="84a15-166">The existing "Password" property refers to DBPROP_AUTH_PASSWORD and is used to store the new password.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="84a15-167">接続文字列の "Old Password" プロパティは SSPROP_AUTH_OLD_PASSWORD に設定され、現在の (または期限切れの) パスワードが設定されます。このパスワードをプロバイダー文字列のプロパティ経由で使用することはできません。</span><span class="sxs-lookup"><span data-stu-id="84a15-167">In the connection string, the "Old Password" property sets SSPROP_AUTH_OLD_PASSWORD, which is the current (possibly expired) password that is not available via a provider string property.</span></span>  
  
 <span data-ttu-id="84a15-168">プロバイダーでは、このプロパティの値が保存されません。</span><span class="sxs-lookup"><span data-stu-id="84a15-168">The provider does not persist the value of this property.</span></span> <span data-ttu-id="84a15-169">このプロパティを設定すると新しい接続が行われるので、プロバイダーでは最初の接続に接続プールが使用されません。</span><span class="sxs-lookup"><span data-stu-id="84a15-169">When this property is set, the provider does not use the connection pool for the first connection because a new connection will occur.</span></span> <span data-ttu-id="84a15-170">パスワード変更が正常に行われた場合でも、現在の接続にはまだ古いパスワードが含まれているので再利用できません。古いパスワードとは、変更後に無効になるパスワードのことです。</span><span class="sxs-lookup"><span data-stu-id="84a15-170">If the password change is successful, the current connection cannot be reused since it still contains the old password, which will be invalid after the password change.</span></span> <span data-ttu-id="84a15-171">また、ログインに成功すると、このプロパティはクリアされます。</span><span class="sxs-lookup"><span data-stu-id="84a15-171">Also, if the login succeeds, the provider clears this property.</span></span> <span data-ttu-id="84a15-172">クリア後に古いパスワードを取得しようとすると、VT_EMPTY が返されます。</span><span class="sxs-lookup"><span data-stu-id="84a15-172">Subsequent attempts to retrieve the old password return VT_EMPTY.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="84a15-173">SSPROP_AUTH_OLD_PASSWORD は、パスワードの有効期限が切れたときにしか使用されないので、保存しないでください。</span><span class="sxs-lookup"><span data-stu-id="84a15-173">SSPROP_AUTH_OLD_PASSWORD should never be persisted since it is only used when a password has expired.</span></span>  
  
 <span data-ttu-id="84a15-174">"Old Password" プロパティが設定されると、プロバイダーでは、パスワードの変更が試行されていることが想定されます。ただし、Windows 認証も指定されている場合は除きます。この場合は、常に Windows 認証が優先されるためです。</span><span class="sxs-lookup"><span data-stu-id="84a15-174">Note that whenever the "Old Password" property is set, the provider assumes that an attempt to change the password is being made, unless Windows Authentication is also specified, in which case it always takes precedence.</span></span>  
  
 <span data-ttu-id="84a15-175">Windows 認証を使用している場合、古いパスワードを REQUIRED と指定するか OPTIONAL と指定するかによって、それぞれ DB_E_ERRORSOCCURRED または DB_S_ERRORSOCCURRED のいずれかが返され、*dwStatus* に状態値として DBPROPSTATUS_CONFLICTINGBADVALUE が返されます。</span><span class="sxs-lookup"><span data-stu-id="84a15-175">If Windows Authentication is used, specifying the old password results in either DB_E_ERRORSOCCURRED or DB_S_ERRORSOCCURRED depending on whether the old password was specified as REQUIRED or OPTIONAL respectively, and the status value of DBPROPSTATUS_CONFLICTINGBADVALUE is returned in *dwStatus*.</span></span> <span data-ttu-id="84a15-176">これは、**IDBInitialize::Initialize** を呼び出したときに検出されます。</span><span class="sxs-lookup"><span data-stu-id="84a15-176">This is detected when **IDBInitialize::Initialize** is called.</span></span>  
  
 <span data-ttu-id="84a15-177">パスワード変更の試行が予期せず失敗すると、サーバーからエラー コード 18468 が返されます。</span><span class="sxs-lookup"><span data-stu-id="84a15-177">If an attempt to change the password fails unexpectedly, the server returns error code 18468.</span></span> <span data-ttu-id="84a15-178">接続試行からは標準の OLE DB エラーが返されます。</span><span class="sxs-lookup"><span data-stu-id="84a15-178">A standard OLEDB error is returned from the connection attempt.</span></span>  
  
 <span data-ttu-id="84a15-179">DBPROPSET_SQLSERVERDBINIT プロパティ セットの詳細については、「[初期化プロパティと承認プロパティ](../../native-client-ole-db-data-source-objects/initialization-and-authorization-properties.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="84a15-179">For more information about the DBPROPSET_SQLSERVERDBINIT property set, see [Initialization and Authorization Properties](../../native-client-ole-db-data-source-objects/initialization-and-authorization-properties.md).</span></span>  
  
## <a name="sql-server-native-client-odbc-driver"></a><span data-ttu-id="84a15-180">SQL Server Native Client ODBC ドライバー</span><span class="sxs-lookup"><span data-stu-id="84a15-180">SQL Server Native Client ODBC Driver</span></span>  
 <span data-ttu-id="84a15-181">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]Native Client OLE DB プロバイダーは、ユーザーインターフェイスとプログラムを使ってパスワードの有効期限をサポートします。</span><span class="sxs-lookup"><span data-stu-id="84a15-181">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider supports password expiration though a user interface and programmatically.</span></span>  
  
### <a name="odbc-user-interface-password-expiration"></a><span data-ttu-id="84a15-182">ODBC ユーザー インターフェイスによるパスワード期限切れの処理</span><span class="sxs-lookup"><span data-stu-id="84a15-182">ODBC User Interface Password Expiration</span></span>  
 <span data-ttu-id="84a15-183">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]Native CLIENT ODBC ドライバーでは、 **SQL Server ログイン**ダイアログボックスに対して行われた変更によって、パスワードの有効期限がサポートされます。</span><span class="sxs-lookup"><span data-stu-id="84a15-183">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver supports password expiration through changes made to the **SQL Server Login** dialog boxes.</span></span>  
  
 <span data-ttu-id="84a15-184">[SQLDriverConnect](../../native-client-odbc-api/sqldriverconnect.md)が呼び出され、 **drivercompletion**の値が SQL_DRIVER_NOPROMPT に設定されている場合、パスワードの有効期限が切れていると、最初の接続試行は失敗します。</span><span class="sxs-lookup"><span data-stu-id="84a15-184">If [SQLDriverConnect](../../native-client-odbc-api/sqldriverconnect.md) is called and the value of **DriverCompletion** is set to SQL_DRIVER_NOPROMPT, the initial connection attempt fails if the password has expired.</span></span> <span data-ttu-id="84a15-185">SQLSTATE 値28000とネイティブエラーコード値18487は、次の**SQLError**または**SQLGetDiagRec**への呼び出しによって返されます。</span><span class="sxs-lookup"><span data-stu-id="84a15-185">The SQLSTATE value 28000 and the native error code value 18487 are returned by subsequent calls to **SQLError** or **SQLGetDiagRec**.</span></span>  
  
 <span data-ttu-id="84a15-186">**Drivercompletion**がその他の値に設定されている場合、パスワードの有効期限が切れているかどうかにかかわらず、ユーザーには**SQL Server ログイン**ダイアログが表示されます。</span><span class="sxs-lookup"><span data-stu-id="84a15-186">If **DriverCompletion** has been set to any other value, the user sees the **SQL Server Login** dialog, regardless of whether or not the password has expired.</span></span> <span data-ttu-id="84a15-187">ユーザーは、**[オプション]** をクリックし、**[パスワードの変更]** チェック ボックスをオンにしてパスワードを変更できます。</span><span class="sxs-lookup"><span data-stu-id="84a15-187">The user can click on the **Options** button and check **Change Password** to change the password.</span></span>  
  
 <span data-ttu-id="84a15-188">ユーザーが [OK] をクリックし、パスワードの有効期限が切れている場合は、[ [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] **SQL Server パスワードの変更**] ダイアログボックスを使用して、新しいパスワードの入力と確認を求めるメッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="84a15-188">If the user clicks OK and the password has expired, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] prompts to enter and confirm a new password using the **Change SQL Server Password** dialog.</span></span>  
  
#### <a name="odbc-prompt-behavior-and-locked-accounts"></a><span data-ttu-id="84a15-189">ODBC プロンプトの動作とロックされたアカウント</span><span class="sxs-lookup"><span data-stu-id="84a15-189">ODBC Prompt Behavior and Locked Accounts</span></span>  
 <span data-ttu-id="84a15-190">アカウントがロックされていることにより、接続に失敗することがあります。</span><span class="sxs-lookup"><span data-stu-id="84a15-190">Connection attempts may fail due to the account being locked.</span></span> <span data-ttu-id="84a15-191">**[SQL Server ログイン]** ダイアログ ボックスが表示された後にこの現象が発生する場合は、サーバー エラー メッセージが表示され、接続試行が中止されます。</span><span class="sxs-lookup"><span data-stu-id="84a15-191">If this occurs following the display of the **SQL Server Login** dialog, the server error message is displayed to the user and the connection attempt is aborted.</span></span> <span data-ttu-id="84a15-192">また、**[パスワードの変更]** ダイアログ ボックスが表示された後にユーザーが古いパスワードに無効な値を入力すると、この現象が発生することもあります。</span><span class="sxs-lookup"><span data-stu-id="84a15-192">It may also occur following the display of the **Change SQL Server Password** dialog if the user enters a bad value for the old password.</span></span> <span data-ttu-id="84a15-193">この場合も同じエラー メッセージが表示され、接続試行が中止されます。</span><span class="sxs-lookup"><span data-stu-id="84a15-193">In this case the same error message is displayed, and the connection attempt is aborted.</span></span>  
  
#### <a name="odbc-connection-pooling-password-expiry-and-locked-accounts"></a><span data-ttu-id="84a15-194">ODBC 接続プーリング、パスワードの期限切れ、およびロックされたアカウント</span><span class="sxs-lookup"><span data-stu-id="84a15-194">ODBC Connection Pooling, Password Expiry, and Locked Accounts</span></span>  
 <span data-ttu-id="84a15-195">接続プール内で接続がアクティブな状態になっている間に、アカウントがロックされたり、そのアカウントのパスワードの有効期限が切れたりすることがあります。</span><span class="sxs-lookup"><span data-stu-id="84a15-195">An account may be locked or its password may expire while the connection is still active in a connection pool.</span></span> <span data-ttu-id="84a15-196">サーバーでは、期限切れのパスワードとロックされたアカウントを 2 回チェックします。</span><span class="sxs-lookup"><span data-stu-id="84a15-196">The server checks for expired passwords and locked accounts on two occasions.</span></span> <span data-ttu-id="84a15-197">最初のチェックは、初回接続時に行われます。</span><span class="sxs-lookup"><span data-stu-id="84a15-197">The first is when a connection is first created.</span></span> <span data-ttu-id="84a15-198">2 回目のチェックは、接続のリセット時、接続がプールから取り除かれるときに行われます。</span><span class="sxs-lookup"><span data-stu-id="84a15-198">The second occasion is upon connection reset, when the connection is taken from the pool.</span></span>  
  
 <span data-ttu-id="84a15-199">リセットの試行が失敗すると、その接続はプールから削除され、エラーが返されます。</span><span class="sxs-lookup"><span data-stu-id="84a15-199">When the reset attempt fails, the connection is removed from the pool and an error is returned.</span></span>  
  
### <a name="odbc-programmatic-password-expiration"></a><span data-ttu-id="84a15-200">ODBC プログラムによるパスワードの有効期限</span><span class="sxs-lookup"><span data-stu-id="84a15-200">ODBC Programmatic Password Expiration</span></span>  
 <span data-ttu-id="84a15-201">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]Native CLIENT ODBC ドライバーでは、 [SQLSetConnectAttr](../../native-client-odbc-api/sqlsetconnectattr.md)関数を使用してサーバーに接続する前に設定されている SQL_COPT_SS_OLDPWD 属性を追加することによって、パスワードの有効期限をサポートしています。</span><span class="sxs-lookup"><span data-stu-id="84a15-201">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver supports password expiration through the addition of the SQL_COPT_SS_OLDPWD attribute which is set before connecting to the server using the [SQLSetConnectAttr](../../native-client-odbc-api/sqlsetconnectattr.md) function.</span></span>  
  
 <span data-ttu-id="84a15-202">接続ハンドルの SQL_COPT_SS_OLDPWD 属性は、期限切れのパスワードを表します。</span><span class="sxs-lookup"><span data-stu-id="84a15-202">The SQL_COPT_SS_OLDPWD attribute of the connection handle refers to the expired password.</span></span> <span data-ttu-id="84a15-203">接続文字列の属性は接続プーリングに影響を与えることになるので、この属性に関する接続文字列属性はありません。</span><span class="sxs-lookup"><span data-stu-id="84a15-203">There is no connection string attribute for this attribute, as this would interfere with connection pooling.</span></span> <span data-ttu-id="84a15-204">ログインに成功すると、この属性はクリアされます。</span><span class="sxs-lookup"><span data-stu-id="84a15-204">If the login succeeds, the driver clears this attribute.</span></span>  
  
 <span data-ttu-id="84a15-205">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]Native CLIENT ODBC ドライバーは、パスワードの有効期限、パスワードポリシーの競合、アカウントのロックアウト、Windows 認証の使用時に古いパスワードプロパティが設定されている場合に、この機能の4つのケースで SQL_ERROR を返します。</span><span class="sxs-lookup"><span data-stu-id="84a15-205">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver returns SQL_ERROR in four cases for this feature: password expiration, password policy conflict, account lockout, and when the old password property is set while using Windows Authentication.</span></span> <span data-ttu-id="84a15-206">[SQLGetDiagField](../../native-client-odbc-api/sqlgetdiagfield.md)が呼び出されると、ドライバーはユーザーに適切なエラーメッセージを返します。</span><span class="sxs-lookup"><span data-stu-id="84a15-206">The driver returns the appropriate error messages to the user when [SQLGetDiagField](../../native-client-odbc-api/sqlgetdiagfield.md) is invoked.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="84a15-207">参照</span><span class="sxs-lookup"><span data-stu-id="84a15-207">See Also</span></span>  
 [<span data-ttu-id="84a15-208">SQL Server Native Client の機能</span><span class="sxs-lookup"><span data-stu-id="84a15-208">SQL Server Native Client Features</span></span>](sql-server-native-client-features.md)  
  
  
