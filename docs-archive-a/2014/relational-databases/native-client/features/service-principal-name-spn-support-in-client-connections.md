---
title: クライアント接続でのサービス プリンシパル名 (SPN) のサポート | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- SQL Server Native Client, SPNs
- ODBC, SPNs
- OLE DB, SPNs
- SPNs [SQL Server]
ms.assetid: 96598c69-ce9a-4090-aacb-d546591e8af7
author: rothja
ms.author: jroth
ms.openlocfilehash: 10a64baa17bd070d9354beaf6ff8c2e460682318
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87633122"
---
# <a name="service-principal-name-spn-support-in-client-connections"></a><span data-ttu-id="c7f3c-102">クライアント接続でのサービス プリンシパル名 (SPN) のサポート</span><span class="sxs-lookup"><span data-stu-id="c7f3c-102">Service Principal Name (SPN) Support in Client Connections</span></span>
  <span data-ttu-id="c7f3c-103">[!INCLUDE[ssKatmai](../../../includes/sskatmai-md.md)]以降では、サービス プリンシパル名 (SPN) のサポートが強化されて、あらゆるプロトコルでの相互認証が可能になりました。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-103">Beginning with [!INCLUDE[ssKatmai](../../../includes/sskatmai-md.md)], support for service principal names (SPNs) has been extended to enable mutual authentication across all protocols.</span></span> <span data-ttu-id="c7f3c-104">以前のバージョンの [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]では、[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] インスタンスの既定の SPN が Active Directory に登録されているときに、Kerberos over TCP に対してのみ SPN がサポートされていました。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-104">In previous versions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], SPNs were only supported for Kerberos over TCP when the default SPN for the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance was registered with Active Directory.</span></span>  
  
 <span data-ttu-id="c7f3c-105">SPN は、[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] インスタンスが実行されているアカウントを認証プロトコルで特定するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-105">SPNs are used by the authentication protocol to determine the account in which a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance runs.</span></span> <span data-ttu-id="c7f3c-106">インスタンスのアカウントが判明した場合は、Kerberos 認証を使用したクライアントとサーバーによる相互認証が可能となります。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-106">If the instance account is known, Kerberos authentication can be used to provide mutual authentication by the client and server.</span></span> <span data-ttu-id="c7f3c-107">インスタンスのアカウントが不明である場合は、NTLM 認証を使用して、サーバーによるクライアントの認証のみが行われます。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-107">If the instance account is not known, NTLM authentication, which only provides authentication of the client by the server, is used.</span></span> <span data-ttu-id="c7f3c-108">現時点では、 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client がこの認証を参照して、インスタンス名とネットワーク接続のプロパティから SPN を生成します。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-108">Currently, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client performs the authentication lookup, deriving the SPN from the instance name and network connection properties.</span></span> [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="c7f3c-109">インスタンスが起動時に行いますが、手動で登録することもできます。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-109">instances will attempt to register SPNs on startup, or they can be registered manually.</span></span> <span data-ttu-id="c7f3c-110">ただし、SPN を登録するアカウントのアクセス権が不十分である場合は、登録が失敗します。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-110">However, registration will fail if there are insufficient access rights for the account that attempts to register the SPNs.</span></span>  
  
 <span data-ttu-id="c7f3c-111">ドメインおよびコンピューター アカウントは、自動的に Active Directory に登録されます。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-111">Domain and computer accounts are registered automatically in Active Directory.</span></span> <span data-ttu-id="c7f3c-112">これらのアカウントを SPN として使用することも、管理者が独自に SPN を定義することもできます。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-112">These can be used as SPNs, or administators can define their own SPNs.</span></span> [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="c7f3c-113">では、使用する SPN をクライアントが直接指定できるようにすることで、セキュリティで保護された認証の管理性と信頼性を高めています。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-113">makes secure authentication more manageable and reliable by allowing clients to directly specify the SPN to use.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="c7f3c-114">クライアント アプリケーションで指定された SPN は、Windows 統合セキュリティを使用して接続されている場合にのみ使用されます。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-114">An SPN specified by a client application is only used when a connection is made with Windows integrated security.</span></span>  
  
> [!TIP]  
>  <span data-ttu-id="c7f3c-115">**[!INCLUDE[msCoName](../../../includes/msconame-md.md)] Kerberos Configuration Manager for [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]** は、 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]と Kerberos に関する接続性の問題のトラブルシューティングに役立つ診断ツールです。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-115">**[!INCLUDE[msCoName](../../../includes/msconame-md.md)] Kerberos Configuration Manager for [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]** is a diagnostic tool that helps troubleshoot Kerberos related connectivity issues with [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="c7f3c-116">Kerberos 認証の詳細については、「 [Microsoft® Kerberos Configuration Manager for SQL Server®](https://www.microsoft.com/download/details.aspx?id=39046)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-116">For more information, see [Microsoft Kerberos Configuration Manager for SQL Server](https://www.microsoft.com/download/details.aspx?id=39046).</span></span>  
  
> [!TIP]  
>  <span data-ttu-id="c7f3c-117">**[!INCLUDE[msCoName](../../../includes/msconame-md.md)] Kerberos Configuration Manager for [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]** は、 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]と Kerberos に関する接続性の問題のトラブルシューティングに役立つ診断ツールです。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-117">**[!INCLUDE[msCoName](../../../includes/msconame-md.md)] Kerberos Configuration Manager for [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]** is a diagnostic tool that helps troubleshoot Kerberos related connectivity issues with [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="c7f3c-118">Kerberos 認証の詳細については、「 [Microsoft® Kerberos Configuration Manager for SQL Server®](https://www.microsoft.com/download/details.aspx?id=39046)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-118">For more information, see [Microsoft Kerberos Configuration Manager for SQL Server](https://www.microsoft.com/download/details.aspx?id=39046).</span></span>  
  
 <span data-ttu-id="c7f3c-119">Kerberos の詳細については、次の記事を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-119">For more information about Kerberos, see the following articles:</span></span>  
  
-   [<span data-ttu-id="c7f3c-120">Windows を対象とした Kerberos に関する技術的補足</span><span class="sxs-lookup"><span data-stu-id="c7f3c-120">Kerberos Technical Supplement for Windows</span></span>](https://go.microsoft.com/fwlink/?LinkId=101449)  
  
-   [<span data-ttu-id="c7f3c-121">Microsoft Kerberos</span><span class="sxs-lookup"><span data-stu-id="c7f3c-121">Microsoft Kerberos</span></span>](https://go.microsoft.com/fwlink/?LinkID=100758)  
  
## <a name="usage"></a><span data-ttu-id="c7f3c-122">使用法</span><span class="sxs-lookup"><span data-stu-id="c7f3c-122">Usage</span></span>  
 <span data-ttu-id="c7f3c-123">次の表では、セキュリティで保護された認証をクライアント アプリケーションで使用するための、最も一般的なシナリオについて説明します。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-123">The following table describes the most common scenarios in which client applications can enable secure authentication.</span></span>  
  
|<span data-ttu-id="c7f3c-124">シナリオ</span><span class="sxs-lookup"><span data-stu-id="c7f3c-124">Scenario</span></span>|<span data-ttu-id="c7f3c-125">説明</span><span class="sxs-lookup"><span data-stu-id="c7f3c-125">Description</span></span>|  
|--------------|-----------------|  
|<span data-ttu-id="c7f3c-126">レガシ アプリケーションで SPN が指定されない。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-126">A legacy application does not specify an SPN.</span></span>|<span data-ttu-id="c7f3c-127">この互換性のシナリオでは、以前のバージョンの [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]で作成されたアプリケーションの動作が変更されないことが保証されます。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-127">This compatibility scenario guarantees that there will be no behavior change for applications developed for previous versions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="c7f3c-128">SPN が指定されていない場合、アプリケーションは生成された SPN を使用し、どの認証方法が使用されるかは認識しません。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-128">If no SPN is specified, the application relies on generated SPNs and has no knowledge of which authentication method is used.</span></span>|  
|<span data-ttu-id="c7f3c-129">現在のバージョンの [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client を使用するクライアント アプリケーションで、接続文字列に含まれる SPN が、ドメイン ユーザー アカウント、コンピューター アカウント、インスタンス固有の SPN、またはユーザー定義文字列として指定される。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-129">A client application using the current version of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client specifies an SPN in the connection string as a domain user or computer account, as an instance-specific SPN, or as a user-defined string.</span></span>|<span data-ttu-id="c7f3c-130">プロバイダー文字列、初期化文字列、または接続文字列で `ServerSPN` キーワードを使用することで、次の操作が可能になります。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-130">The `ServerSPN` keyword can be used in a provider, initialization, or connection string to do the following:</span></span><br /><br /> <span data-ttu-id="c7f3c-131">-インスタンスが接続に使用するアカウントを指定し [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] ます。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-131">-   Specify the account used by the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance for a connection.</span></span> <span data-ttu-id="c7f3c-132">これにより、Kerberos 認証へのアクセスが簡単になります。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-132">This simplifies access to Kerberos authentication.</span></span> <span data-ttu-id="c7f3c-133">Kerberos キー配布センター (KDC) が存在し、かつ正しいアカウントが指定された場合は、NTLM よりも Kerberos 認証が使用される可能性が高くなります。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-133">If a Kerberos Key Distribution Center (KDC) is present and the correct account is specified, Kerberos authentication is more likely to be used than NTLM.</span></span> <span data-ttu-id="c7f3c-134">KDC は通常、ドメイン コントローラーと同じコンピューターに存在します。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-134">The KDC usually resides on the same computer as the domain controller.</span></span><br /><span data-ttu-id="c7f3c-135">-インスタンスのサービスアカウントを参照する SPN を指定し [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] ます。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-135">-   Specify an SPN to look up the service account for the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance.</span></span> <span data-ttu-id="c7f3c-136">この目的で使用できる既定の SPN が、すべての [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] インスタンスに 2 つずつ生成されます。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-136">For every [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance, two default SPNs are generated that can be used for this purpose.</span></span> <span data-ttu-id="c7f3c-137">ただし、これらのキーが Active Directory に存在することは保証されないため、この状況では Kerberos 認証は保証されません。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-137">These keys are not guaranteed to be present in Active Directory, however, so in this situation Kerberos authentication is not guaranteed.</span></span><br /><span data-ttu-id="c7f3c-138">-インスタンスのサービスアカウントを検索するために使用される SPN を指定し [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] ます。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-138">-   Specify an SPN that will be used to look up the service account for the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance.</span></span> <span data-ttu-id="c7f3c-139">これは、サービス アカウントにマップされる任意のユーザー定義文字列でかまいません。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-139">This can be any user-defined string that maps to the service account.</span></span> <span data-ttu-id="c7f3c-140">この場合は、キーを手動で KDC に登録する必要があり、キーがユーザー定義 SPN の規則を満たしていることも必要です。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-140">In this case, the key must be registered manually in the KDC and must satisfy the rules for a user-defined SPN.</span></span><br /><br /> <span data-ttu-id="c7f3c-141">`FailoverPartnerSPN` キーワードを使用すると、フェールオーバー パートナー サーバーの SPN を指定できます。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-141">The `FailoverPartnerSPN` keyword can be used to specify the SPN for the failover partner server.</span></span> <span data-ttu-id="c7f3c-142">アカウントおよび Active Directory キーの値の範囲は、プリンシパル サーバーに指定できる値と同じです。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-142">The range of account and Active Directory key values is the same as the values you can specify for the principal server.</span></span>|  
|<span data-ttu-id="c7f3c-143">ODBC アプリケーションで、SPN がプリンシパル サーバーまたはフェールオーバー パートナー サーバーの接続属性として指定される。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-143">An ODBC application specifies an SPN as a connection attribute for the principal server or failover partner server.</span></span>|<span data-ttu-id="c7f3c-144">接続属性 `SQL_COPT_SS_SERVER_SPN` を使用して、プリンシパル サーバーへの接続用の SPN を指定できます。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-144">The connection attribute `SQL_COPT_SS_SERVER_SPN` can be used to specify the SPN for a connection to the principal server.</span></span><br /><br /> <span data-ttu-id="c7f3c-145">接続属性 `SQL_COPT_SS_FAILOVER_PARTNER_SPN` を使用して、フェールオーバー パートナー サーバーの SPN を指定できます。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-145">The connection attribute `SQL_COPT_SS_FAILOVER_PARTNER_SPN` can be used to specify the SPN for the failover partner server.</span></span>|  
|<span data-ttu-id="c7f3c-146">OLE DB アプリケーションで、SPN がプリンシパル サーバーまたはフェールオーバー パートナー サーバーのデータ ソース初期化プロパティとして指定される。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-146">An OLE DB application specifies an SPN as a data source initialization property for the principal server or for a failover partner server.</span></span>|<span data-ttu-id="c7f3c-147">`SSPROP_INIT_SERVER_SPN` プロパティ セット内の接続プロパティ `DBPROPSET_SQLSERVERDBINIT` を使用して、接続用の SPN を指定できます。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-147">The connection property `SSPROP_INIT_SERVER_SPN` in the `DBPROPSET_SQLSERVERDBINIT` property set can be used to specify the SPN for a connection.</span></span><br /><br /> <span data-ttu-id="c7f3c-148">`SSPROP_INIT_FAILOVER_PARTNER_SPN` 内の接続プロパティ `DBPROPSET_SQLSERVERDBINIT` を使用して、フェールオーバー パートナー サーバーの SPN を指定できます。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-148">The connection property `SSPROP_INIT_FAILOVER_PARTNER_SPN` in the `DBPROPSET_SQLSERVERDBINIT` can be used to specify the SPN for the failover partner server.</span></span>|  
|<span data-ttu-id="c7f3c-149">ユーザーが、サーバーまたはフェールオーバー パートナー サーバーの SPN を ODBC データ ソース名 (DSN) で指定する。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-149">A user specifies an SPN for a server or failover partner server in an ODBC data source name (DSN).</span></span>|<span data-ttu-id="c7f3c-150">SPN は、DSN を設定するダイアログ ボックスを使用して ODBC DSN に指定できます。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-150">The SPN can be specified in an ODBC DSN through the DSN setup dialog boxes.</span></span>|  
|<span data-ttu-id="c7f3c-151">ユーザーが、サーバーまたはフェールオーバー パートナー サーバーの SPN を、OLE DB の **[データ リンク]** または **[ログイン]** ダイアログ ボックスで指定する。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-151">The user specifies an SPN for a server or failover partner server in an OLE DB **Data Link** or **Login** dialog box.</span></span>|<span data-ttu-id="c7f3c-152">SPN は、 **[データ リンク]** または **[ログイン]** ダイアログ ボックスで指定できます。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-152">The SPN can be specified in a **Data Link** or **Login** dialog box.</span></span> <span data-ttu-id="c7f3c-153">**[ログイン]** ダイアログ ボックスは、ODBC または OLE DB で使用できます。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-153">The **Login** dialog box can be used with either ODBC or OLE DB.</span></span>|  
|<span data-ttu-id="c7f3c-154">ODBC アプリケーションで、接続の確立に使用された認証方法が特定される。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-154">An ODBC application determines the authentication method used to establish a connection.</span></span>|<span data-ttu-id="c7f3c-155">接続が正常に開いている場合、アプリケーションでは接続属性 `SQL_COPT_SS_INTEGRATED_AUTHENTICATION_METHOD` をクエリして、使用された認証方法を特定できます。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-155">When a connection has been opened successfully, an application can query the connection attribute `SQL_COPT_SS_INTEGRATED_AUTHENTICATION_METHOD` to determine which authentication method was used.</span></span> <span data-ttu-id="c7f3c-156">値にはが含まれますが、とに限定されません `NTLM` `Kerberos` 。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-156">The values will include, but are not limited to, `NTLM` and `Kerberos`.</span></span>|  
|<span data-ttu-id="c7f3c-157">OLE DB アプリケーションで、接続の確立に使用された認証方法が特定される。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-157">An OLE DB application determines the authentication method used to establish a connection.</span></span>|<span data-ttu-id="c7f3c-158">接続が正常に開いている場合、アプリケーションでは `SSPROP_AUTHENTICATION_METHOD` プロパティ セット内の接続プロパティ `DBPROPSET_SQLSERVERDATASOURCEINFO` をクエリして、使用された認証方法を特定できます。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-158">When a connection has been opened successfully, an application can query the connection property `SSPROP_AUTHENTICATION_METHOD` in the `DBPROPSET_SQLSERVERDATASOURCEINFO` property set to determine which authentication method was used.</span></span> <span data-ttu-id="c7f3c-159">値にはが含まれますが、とに限定されません `NTLM` `Kerberos` 。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-159">The values will include, but are not limited to, `NTLM` and `Kerberos`.</span></span>|  
  
## <a name="failover"></a><span data-ttu-id="c7f3c-160">[フェールオーバー]</span><span class="sxs-lookup"><span data-stu-id="c7f3c-160">Failover</span></span>  
 <span data-ttu-id="c7f3c-161">SPN はフェールオーバー キャッシュに保存されないため、接続間で受け渡すことができません。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-161">SPNs are not stored in the failover cache and therefore cannot be passed between connections.</span></span> <span data-ttu-id="c7f3c-162">接続文字列または接続属性に SPN が指定されると、プリンシパルおよびパートナーへの接続が試行されるたびに SPN が使用されます。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-162">SPNs will be used on all connection attempts to the principal and partner when specified in the connection string or connection attributes.</span></span>  
  
## <a name="connection-pooling"></a><span data-ttu-id="c7f3c-163">接続プール</span><span class="sxs-lookup"><span data-stu-id="c7f3c-163">Connection Pooling</span></span>  
 <span data-ttu-id="c7f3c-164">SPN をすべての文字列ではなく一部の接続文字列で指定すると、プールが断片化する原因となることがあるので、アプリケーションでは注意が必要です。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-164">Applications should be aware that specifying SPNs in some but not all connection strings can contribute to pool fragmentation.</span></span>  
  
 <span data-ttu-id="c7f3c-165">アプリケーションでは、接続文字列キーワードを指定する代わりに、プログラムによって SPN を接続属性として指定できます。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-165">Applications can programmatically specify SPNs as connection attributes, instead of specifying connection string keywords.</span></span> <span data-ttu-id="c7f3c-166">こうすると、接続プールの断片化を管理するうえで役立ちます。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-166">This can help manage connection pool fragmentation.</span></span>  
  
 <span data-ttu-id="c7f3c-167">接続文字列内の SPN は対応する接続属性を設定することでオーバーライドできますが、接続のプールで使用される接続文字列は、プールの目的で接続文字列値を使用するので、アプリケーションでは注意が必要です。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-167">Applications should be aware that SPNs in connection strings can be overridden by setting the corresponding connection attributes, but connection strings used by connection pooling will use the connection string values for pooling purposes.</span></span>  
  
## <a name="down-level-server-behavior"></a><span data-ttu-id="c7f3c-168">下位サーバーの動作</span><span class="sxs-lookup"><span data-stu-id="c7f3c-168">Down-Level Server Behavior</span></span>  
 <span data-ttu-id="c7f3c-169">新しい接続動作はクライアントで実装されるため、 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]のバージョンに固有ではありません。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-169">The new connection behavior is implemented by the client; therefore, it is not specific to a version of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span>  
  
## <a name="linked-servers-and-delegation"></a><span data-ttu-id="c7f3c-170">リンク サーバーと委任</span><span class="sxs-lookup"><span data-stu-id="c7f3c-170">Linked Servers and Delegation</span></span>  
 <span data-ttu-id="c7f3c-171">リンク サーバーを作成すると、[sp_addlinkedserver](/sql/relational-databases/system-stored-procedures/sp-addlinkedserver-transact-sql) の `@provstr` パラメーターを使用して、サーバーおよびフェールオーバー パートナーの SPN を指定できるようになります。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-171">When linked servers are created, the `@provstr` parameter of [sp_addlinkedserver](/sql/relational-databases/system-stored-procedures/sp-addlinkedserver-transact-sql) can be used to specify the server and failover partner SPNs.</span></span> <span data-ttu-id="c7f3c-172">これを実行するメリットは、クライアント接続文字列で SPN を指定する場合と同じです。つまり、Kerberos 認証を使う接続を確立する方が、より簡単でより信頼性が高くなります。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-172">The benefits of doing this are the same as specifying SPNs in client connection strings: It is simpler and more reliable to establish connections that use Kerberos authentication.</span></span>  
  
 <span data-ttu-id="c7f3c-173">リンク サーバーでの委任には、Kerberos 認証が必要です。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-173">Delegation with linked servers requires Kerberos authentication.</span></span>  
  
## <a name="management-aspects-of-spns-specified-by-applications"></a><span data-ttu-id="c7f3c-174">アプリケーションによって指定される SPN の管理上の考慮事項</span><span class="sxs-lookup"><span data-stu-id="c7f3c-174">Management Aspects of SPNs Specified by Applications</span></span>  
 <span data-ttu-id="c7f3c-175">SPN をアプリケーションで接続文字列を通じて指定するか、プログラムで接続プロパティを通じて指定するか (プロバイダーが生成した既定の SPN を使用しない) を選択する際には、次の事項を検討してください。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-175">When choosing whether to specify SPNs in an application (through connection strings) or programmatically through connection properties (rather than relying on the defalt provider generated SPNs), consider the following factors:</span></span>  
  
-   <span data-ttu-id="c7f3c-176">セキュリティ : 指定した SPN が保護されている情報を開示する可能性。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-176">Security: Does the specified SPN disclose information that is protected?</span></span>  
  
-   <span data-ttu-id="c7f3c-177">信頼性 : 既定の SPN を使用できるようにするには、[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] インスタンスを実行するサービス アカウントに、KDC 上の Active Directory を更新するための十分な権限が必要です。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-177">Reliability: To enable the use of default SPNs, the service account in which the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance runs must have sufficient privileges to update the Active Directory on the KDC.</span></span>  
  
-   <span data-ttu-id="c7f3c-178">利便性と場所の透過性 : アプリケーションのデータベースを別の [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] インスタンスに移した場合の、アプリケーションの SPN に対する影響。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-178">Convenience and location transparency: How will an application's SPNs be affected if its database moves to a different [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance?</span></span> <span data-ttu-id="c7f3c-179">データベース ミラーリングを使用する場合は、プリンシパル サーバーとそのフェールオーバー パートナーの両方について、この事項を検討する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-179">This applies to both the principal server and its failover partner if you use database mirroring.</span></span> <span data-ttu-id="c7f3c-180">また、サーバーの変更に伴って SPN を変更する場合のアプリケーションに対する影響や、</span><span class="sxs-lookup"><span data-stu-id="c7f3c-180">If a server change means that SPNs must be changed, how will this affect applications?</span></span> <span data-ttu-id="c7f3c-181">すべての変更に関する管理の有無についても検討してください。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-181">Will any changes be managed?</span></span>  
  
## <a name="specifying-the-spn"></a><span data-ttu-id="c7f3c-182">SPN の指定</span><span class="sxs-lookup"><span data-stu-id="c7f3c-182">Specifying the SPN</span></span>  
 <span data-ttu-id="c7f3c-183">SPN は、ダイアログ ボックスおよびコードで指定できます。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-183">You can specify an SPN in dialog boxes and in code.</span></span> <span data-ttu-id="c7f3c-184">ここでは、SPN を指定する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-184">This section discusses how you can specify an SPN.</span></span>  
  
 <span data-ttu-id="c7f3c-185">SPN の最大長は 260 文字です。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-185">The maximum length for an SPN is 260 characters.</span></span>  
  
 <span data-ttu-id="c7f3c-186">接続文字列または接続属性で SPN に使用される構文は次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-186">The syntax that SPNs use in connection string or connection attributes is as follows:</span></span>  
  
|<span data-ttu-id="c7f3c-187">構文</span><span class="sxs-lookup"><span data-stu-id="c7f3c-187">Syntax</span></span>|<span data-ttu-id="c7f3c-188">説明</span><span class="sxs-lookup"><span data-stu-id="c7f3c-188">Description</span></span>|  
|------------|-----------------|  
|<span data-ttu-id="c7f3c-189">MSSQLSvc/*fqdn*</span><span class="sxs-lookup"><span data-stu-id="c7f3c-189">MSSQLSvc/*fqdn*</span></span>|<span data-ttu-id="c7f3c-190">TCP 以外のプロトコルが使用される場合に、既定のインスタンスに対してプロバイダーが生成する既定の SPN。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-190">The provider-generated, default SPN for a default instance when a protocol other than TCP is used.</span></span><br /><br /> <span data-ttu-id="c7f3c-191">*fqdn*は完全修飾ドメイン名です。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-191">*fqdn* is a fully-qualified domain name.</span></span>|  
|<span data-ttu-id="c7f3c-192">MSSQLSvc/*fqdn*:*port*</span><span class="sxs-lookup"><span data-stu-id="c7f3c-192">MSSQLSvc/*fqdn*:*port*</span></span>|<span data-ttu-id="c7f3c-193">TCP が使用される場合にプロバイダーが生成する既定の SPN。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-193">The provider-generated, default SPN when TCP is used.</span></span><br /><br /> <span data-ttu-id="c7f3c-194">*port* は、TCP ポート番号です。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-194">*port* is a TCP port number.</span></span>|  
|<span data-ttu-id="c7f3c-195">MSSQLSvc/*fqdn*:*InstanceName*</span><span class="sxs-lookup"><span data-stu-id="c7f3c-195">MSSQLSvc/*fqdn*:*InstanceName*</span></span>|<span data-ttu-id="c7f3c-196">TCP 以外のプロトコルが使用される場合に、名前付きインスタンスに対してプロバイダーが生成する既定の SPN。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-196">The provider-generated, default SPN for a named instance when a protocol other than TCP is used.</span></span><br /><br /> <span data-ttu-id="c7f3c-197">*InstanceName* は、[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] インスタンスの名前です。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-197">*InstanceName* is a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance name.</span></span>|  
|<span data-ttu-id="c7f3c-198">HOST/*fqdn*</span><span class="sxs-lookup"><span data-stu-id="c7f3c-198">HOST/*fqdn*</span></span><br /><br /> <span data-ttu-id="c7f3c-199">HOST/*MachineName*</span><span class="sxs-lookup"><span data-stu-id="c7f3c-199">HOST/*MachineName*</span></span>|<span data-ttu-id="c7f3c-200">Windows で自動的に登録されるビルトイン コンピューター アカウントにマップされる SPN。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-200">The SPN that maps to built-in computer accounts that are automatically registered by Windows.</span></span>|  
|<span data-ttu-id="c7f3c-201">*ユーザー名* @*ドメイン*</span><span class="sxs-lookup"><span data-stu-id="c7f3c-201">*Username*@*Domain*</span></span>|<span data-ttu-id="c7f3c-202">ドメイン アカウントの直接指定。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-202">Direct specification of a domain account.</span></span><br /><br /> <span data-ttu-id="c7f3c-203">*Username* は、Windows ユーザー アカウントの名前です。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-203">*Username* is a Windows user account name.</span></span><br /><br /> <span data-ttu-id="c7f3c-204">*Domain* は、Windows ドメイン名または完全修飾ドメイン名です。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-204">*Domain* is a Windows domain name or fully-qualified domain name.</span></span>|  
|<span data-ttu-id="c7f3c-205">*MachineName* $@*ドメイン*</span><span class="sxs-lookup"><span data-stu-id="c7f3c-205">*MachineName*$@*Domain*</span></span>|<span data-ttu-id="c7f3c-206">コンピューター アカウントの直接指定。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-206">Direct specification of a computer account.</span></span><br /><br /> <span data-ttu-id="c7f3c-207">(接続先のサーバーがローカルシステムまたはネットワークサービスアカウントで実行されている場合、Kerberos 認証を使用するには、を `ServerSPN` *MachineName*ドメイン形式にすることができ $@ *Domain*ます)。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-207">(If the server you are connecting to is running under LOCAL SYSTEM or NETWORK SERVICE accounts, to get Kerberos authentication, `ServerSPN` can be in the *MachineName*$@*Domain* format.)</span></span>|  
|<span data-ttu-id="c7f3c-208">*Kdckey* /*MachineName*</span><span class="sxs-lookup"><span data-stu-id="c7f3c-208">*KDCKey*/*MachineName*</span></span>|<span data-ttu-id="c7f3c-209">ユーザー指定の SPN。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-209">A user-specified SPN.</span></span><br /><br /> <span data-ttu-id="c7f3c-210">*KDCKey* は、KDC キーの規則に従っている英数字の文字列です。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-210">*KDCKey* is an alphanumeric string that conforms to the rules for a KDC key.</span></span>|  
  
## <a name="odbc-and-ole-db-syntax-supporting-spns"></a><span data-ttu-id="c7f3c-211">SPN をサポートする ODBC および OLE DB の構文</span><span class="sxs-lookup"><span data-stu-id="c7f3c-211">ODBC and OLE DB Syntax Supporting SPNs</span></span>  
 <span data-ttu-id="c7f3c-212">各構文の情報については、次のトピックを参照してください。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-212">For syntax-specific information, see the following topics:</span></span>  
  
-   [<span data-ttu-id="c7f3c-213">クライアント接続 &#40;ODBC&#41; でのサービス プリンシパル名 &#40;SPNs&#41;</span><span class="sxs-lookup"><span data-stu-id="c7f3c-213">Service Principal Names &#40;SPNs&#41; in Client Connections &#40;ODBC&#41;</span></span>](../odbc/service-principal-names-spns-in-client-connections-odbc.md)  
  
-   [<span data-ttu-id="c7f3c-214">クライアント接続 &#40;OLE DB&#41; でのサービス プリンシパル名 &#40;SPNs&#41;</span><span class="sxs-lookup"><span data-stu-id="c7f3c-214">Service Principal Names &#40;SPNs&#41; in Client Connections &#40;OLE DB&#41;</span></span>](../ole-db/service-principal-names-spns-in-client-connections-ole-db.md)  
  
 <span data-ttu-id="c7f3c-215">この機能を説明するサンプル アプリケーションについては、「 [SQL Server データ プログラミング サンプル](https://msftdpprodsamples.codeplex.com/)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c7f3c-215">For information about sample applications that demonstrate this feature, see [SQL Server Data Programmability Samples](https://msftdpprodsamples.codeplex.com/).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="c7f3c-216">参照</span><span class="sxs-lookup"><span data-stu-id="c7f3c-216">See Also</span></span>  
 [<span data-ttu-id="c7f3c-217">SQL Server Native Client の機能</span><span class="sxs-lookup"><span data-stu-id="c7f3c-217">SQL Server Native Client Features</span></span>](sql-server-native-client-features.md)  
  
