---
title: 複数のアクティブな結果セット (MARS) の使用 | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- SQL Server Native Client OLE DB provider, MARS
- SQLNCLI, MARS
- data access [SQL Server Native Client], MARS
- Multiple Active Result Sets
- SQL Server Native Client, MARS
- MARS [SQL Server]
- SQL Server Native Client ODBC driver, MARS
ms.assetid: ecfd9c6b-7d29-41d8-af2e-89d7fb9a1d83
author: rothja
ms.author: jroth
ms.openlocfilehash: 7119048df3de23b1cfc5d6c8fb41672d82be14f9
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87643281"
---
# <a name="using-multiple-active-result-sets-mars"></a><span data-ttu-id="1c1ad-102">複数のアクティブな結果セット (MARS) の使用</span><span class="sxs-lookup"><span data-stu-id="1c1ad-102">Using Multiple Active Result Sets (MARS)</span></span>
  [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] <span data-ttu-id="1c1ad-103">では、[!INCLUDE[ssDE](../../../includes/ssde-md.md)] にアクセスするアプリケーションで複数のアクティブな結果セット (MARS) がサポートされるようになりました。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-103">introduced support for multiple active result sets (MARS) in applications accessing the [!INCLUDE[ssDE](../../../includes/ssde-md.md)].</span></span> <span data-ttu-id="1c1ad-104">以前のバージョンの [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] では、データベース アプリケーションは 1 つの接続で複数のアクティブなステートメントを保持できませんでした。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-104">In earlier versions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], database applications could not maintain multiple active statements on a connection.</span></span> <span data-ttu-id="1c1ad-105">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] の既定の結果セットを使用しているときは、アプリケーションはその接続で他のバッチを実行する前に、1 つのバッチのすべての結果セットを処理するか、取り消す必要がありました。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-105">When using [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] default result sets, the application had to process or cancel all result sets from one batch before it could execute any other batch on that connection.</span></span> [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] <span data-ttu-id="1c1ad-106">では新しい接続属性が導入され、アプリケーションは接続ごとに複数の要求を保留中にできるだけでなく、接続ごとに複数のアクティブな既定の結果セットを保持できるようになりました。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-106">introduced a new connection attribute that allows applications to have more than one pending request per connection, and in particular, to have more than one active default result set per connection.</span></span>  
  
 <span data-ttu-id="1c1ad-107">MARS によって、次の新しい機能を使用したアプリケーションのデザインが簡素化されます。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-107">MARS simplifies application design with the following new capabilities:</span></span>  
  
-   <span data-ttu-id="1c1ad-108">アプリケーションは、既定の結果セットを複数開くことができ、複数の既定の結果セットからの読み取りをインターリーブすることができます。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-108">Applications can have multiple default result sets open and can interleave reading from them.</span></span>  
  
-   <span data-ttu-id="1c1ad-109">アプリケーションは既定の結果セットを開いたまま、他のステートメント (INSERT、UPDATE、DELETE、ストアド プロシージャ呼び出しなど) を実行できます。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-109">Applications can execute other statements (for example, INSERT, UPDATE, DELETE, and stored procedure calls) while default result sets are open.</span></span>  
  
 <span data-ttu-id="1c1ad-110">MARS を使用するアプリケーションについては、次のガイドラインを参照してください。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-110">Applications using MARS will find the following guidelines beneficial:</span></span>  
  
-   <span data-ttu-id="1c1ad-111">1 つの SQL ステートメント (SELECT、OUTPUT を伴う DML、RECEIVE、READ TEXT など) で生成される結果セットが短期間しか有効でない場合や結果セットが小さい場合は、既定の結果セットを使用します。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-111">Default results sets should be used for short lived or short result sets generated by single SQL statements (SELECT, DML with OUTPUT, RECEIVE, READ TEXT, and so on).</span></span>  
  
-   <span data-ttu-id="1c1ad-112">1 つの SQL ステートメントで生成される結果セットが長期間有効な場合や結果セットが大きくなる場合は、サーバー カーソルを使用します。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-112">Server cursors should be used for longer lived or large result sets generated by single SQL statements.</span></span>  
  
-   <span data-ttu-id="1c1ad-113">結果を返すかどうかにかかわらず手続き型の要求の場合、および複数の結果を返すバッチの場合、常に、結果の最後まで読み取ります。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-113">Always read to the end of results for procedural requests regardless of whether they return results or not, and for batches that return multiple results.</span></span>  
  
-   <span data-ttu-id="1c1ad-114">接続プロパティの変更やトランザクションの管理には、できるだけ [!INCLUDE[tsql](../../../includes/tsql-md.md)] ステートメントではなく API 呼び出しを優先して使用します。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-114">Wherever possible, use API calls to change connection properties and manage transactions in preference to [!INCLUDE[tsql](../../../includes/tsql-md.md)] statements.</span></span>  
  
-   <span data-ttu-id="1c1ad-115">MARS では、複数のバッチが同時に実行されている間、セッション スコープの権限の借用が禁止されます。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-115">In MARS, session-scoped impersonation is prohibited while concurrent batches are running.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="1c1ad-116">既定では、MARS 機能は有効になっていません。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-116">By default, MARS functionality is not enabled.</span></span> <span data-ttu-id="1c1ad-117">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client で [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] に接続するときに MARS を使用するには、接続文字列で MARS を明示的に有効にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-117">To use MARS when connecting to [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] with [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client, you must specifically enable it within a connection string.</span></span> <span data-ttu-id="1c1ad-118">詳細については、この後の「[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB プロバイダー」と「[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC ドライバー」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-118">For more information, see the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider and [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver sections, later in this topic.</span></span>  
  
 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="1c1ad-119">Native Client では、接続でのアクティブなステートメントの数は制限されません。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-119">Native Client does not limit the number of active statements on a connection.</span></span>  
  
 <span data-ttu-id="1c1ad-120">複数のステートメントで構成される単一のバッチやストアド プロシージャを複数同時実行する必要のない一般的なアプリケーションでは、MARS の実装方法を理解しなくても、MARS の利点を得ることができます。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-120">Typical applications which do not need to have more than a single multistatement batch or stored procedure executing at the same time will benefit from MARS without having to understand how MARS is implemented.</span></span> <span data-ttu-id="1c1ad-121">ただし、より複雑な要件のアプリケーションでは、MARS の実装方法を考慮する必要があります。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-121">However, applications with more complex requirements do need to take account of this.</span></span>  
  
 <span data-ttu-id="1c1ad-122">MARS では、1 つの接続内で複数の要求の実行をインターリーブできます。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-122">MARS enables the interleaved execution of multiple requests within a single connection.</span></span> <span data-ttu-id="1c1ad-123">つまり、1 つのバッチを実行し、その実行内で他の要求を実行できます。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-123">That is, it allows a batch to run, and within its execution, it allows other requests to execute.</span></span> <span data-ttu-id="1c1ad-124">ただし、MARS では並列実行が行われるのではなく、複数の実行がインターリーブされることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-124">Note, however, that MARS is defined in terms of interleaving, not in terms of parallel execution.</span></span>  
  
 <span data-ttu-id="1c1ad-125">MARS のインフラストラクチャでは、複数のバッチがインターリーブ方式で実行されますが、実行の切り替えは明確に定義された時点でしか行われません。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-125">The MARS infrastructure allows multiple batches to execute in an interleaved fashion, though execution can only be switched at well defined points.</span></span> <span data-ttu-id="1c1ad-126">また、ほとんどのステートメントはバッチ内で自動的に実行される必要があります。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-126">In addition, most statements must run atomically within a batch.</span></span> <span data-ttu-id="1c1ad-127">クライアントに行を返すステートメント ( *yield ポイント*と呼ばれることもあります) は、次の例のように、行がクライアントに送信されている間、完了前に実行をインターリーブすることができます。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-127">Statements which return rows to the client, which are sometimes referred to as *yield points*, are allowed to interleave execution before completion while rows are being sent to the client, for example:</span></span>  
  
-   <span data-ttu-id="1c1ad-128">SELECT</span><span class="sxs-lookup"><span data-stu-id="1c1ad-128">SELECT</span></span>  
  
-   <span data-ttu-id="1c1ad-129">FETCH</span><span class="sxs-lookup"><span data-stu-id="1c1ad-129">FETCH</span></span>  
  
-   <span data-ttu-id="1c1ad-130">RECEIVE</span><span class="sxs-lookup"><span data-stu-id="1c1ad-130">RECEIVE</span></span>  
  
 <span data-ttu-id="1c1ad-131">ストアド プロシージャまたはバッチの一部として実行されるその他のステートメントはいずれも、他の MARS 要求に切り替えられる前に実行を完了する必要があります。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-131">Any other statements that are executed as part of a stored procedure or batch must run to completion before execution can be switched to other MARS requests.</span></span>  
  
 <span data-ttu-id="1c1ad-132">バッチがどのようにインターリーブ実行されるかは、さまざまな要因の影響を受けます。そのため、呼び出しポイントを含む複数のバッチからのコマンドが実行されるときに、正確なシーケンスを予測することは困難です。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-132">The exact manner in which batches interleave execution is influenced by a number of factors, and it is difficult to predict the exact sequence in which commands from multiple batches that contain yield points will be executed.</span></span> <span data-ttu-id="1c1ad-133">このような複雑なバッチをインターリーブ実行したときに、好ましくない影響が発生しないように注意してください。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-133">Be careful to avoid unwanted side effects due to interleaved execution of such complex batches.</span></span>  
  
 <span data-ttu-id="1c1ad-134">このような問題を回避するために、接続状態 (SET、USE) やトランザクション (BEGIN TRAN、COMMIT、ROLLBACK) を管理する場合は、[!INCLUDE[tsql](../../../includes/tsql-md.md)] ステートメントではなく API 呼び出しを使用します。このとき、複数のステートメントで構成されるバッチに呼び出しポイントも含まれている場合、接続状態やトランザクションを管理するステートメントを含めないようにします。さらに、このようなバッチでは、すべての結果を処理するか、残りを取り消すことによって、実行を順番に行います。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-134">Avoid problems by using API calls rather than [!INCLUDE[tsql](../../../includes/tsql-md.md)] statements to manage connection state (SET, USE) and transactions (BEGIN TRAN, COMMIT, ROLLBACK) by not including these statements in multi-statement batches that also contain yield points, and by serializing execution of such batches by consuming or canceling all results.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="1c1ad-135">MARS が有効なときにトランザクションを手動または暗黙に開始するバッチやストアド プロシージャでは、バッチが終了する前にトランザクションを完了する必要があります。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-135">A batch or stored procedure which starts a manual or implicit transaction when MARS is enabled must complete the transaction before the batch exits.</span></span> <span data-ttu-id="1c1ad-136">トランザクションを完了しないと、[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] はバッチの終了時にトランザクションによって行われたすべての変更をロールバックします。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-136">If it does not, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] rolls back all changes made by the transaction when the batch finishes.</span></span> <span data-ttu-id="1c1ad-137">このようなトランザクションは、[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] によってバッチスコープのトランザクションとして管理されます。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-137">Such a transaction is managed by [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] as a batch-scoped transaction.</span></span> <span data-ttu-id="1c1ad-138">これは [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] で導入された新しい形式のトランザクションで、MARS が有効なときに、既存の適切に動作するストアド プロシージャを使用できるようになります。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-138">This is a new type of transaction introduced in [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] to enable existing well-behaved stored procedures to be used when MARS is enabled.</span></span> <span data-ttu-id="1c1ad-139">バッチスコープのトランザクションの詳細については、[トランザクション ステートメント &#40;Transact-SQL&#41;](/sql/t-sql/language-elements/transactions-transact-sql) に関する記事を参照してください。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-139">For more information about batch-scoped transactions, see [Transaction Statements &#40;Transact-SQL&#41;](/sql/t-sql/language-elements/transactions-transact-sql).</span></span>  
  
 <span data-ttu-id="1c1ad-140">ADO から MARS を使用する例については、「 [USING ado with SQL Server Native Client](../applications/using-ado-with-sql-server-native-client.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-140">For an example of using MARS from ADO, see [Using ADO with SQL Server Native Client](../applications/using-ado-with-sql-server-native-client.md).</span></span>  
  
## <a name="sql-server-native-client-ole-db-provider"></a><span data-ttu-id="1c1ad-141">SQL Server Native Client OLE DB プロバイダー</span><span class="sxs-lookup"><span data-stu-id="1c1ad-141">SQL Server Native Client OLE DB Provider</span></span>  
 <span data-ttu-id="1c1ad-142">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]Native Client OLE DB プロバイダーは、DBPROPSET_SQLSERVERDBINIT プロパティセットに実装されている SSPROP_INIT_MARSCONNECTION データソース初期化プロパティを追加することによって、MARS をサポートしています。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-142">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider supports MARS through the addition of the SSPROP_INIT_MARSCONNECTION data source initialization property, which is implemented in the DBPROPSET_SQLSERVERDBINIT property set.</span></span> <span data-ttu-id="1c1ad-143">また、新しい接続文字列のキーワードとして `MarsConn` が追加されました。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-143">In addition, a new connection string keyword, `MarsConn`, as been added.</span></span> <span data-ttu-id="1c1ad-144">このキーワードは、`true` または `false` を値として受け取ります。既定値は `false` です。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-144">It accepts `true` or `false` values; `false` is the default.</span></span>  
  
 <span data-ttu-id="1c1ad-145">データ ソース プロパティ DBPROP_MULTIPLECONNECTIONS の既定値は VARIANT_TRUE です。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-145">The data source property DBPROP_MULTIPLECONNECTIONS defaults to VARIANT_TRUE.</span></span> <span data-ttu-id="1c1ad-146">これは、複数の同時実行コマンドや行セット オブジェクトをサポートするために、プロバイダーが複数の接続を起動することを意味しています。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-146">This means the provider will spawn multiple connections in order to support multiple concurrent command and rowset objects.</span></span> <span data-ttu-id="1c1ad-147">MARS が有効になっている場合、 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client は1つの接続で複数のコマンドと行セットオブジェクトをサポートできるため、MULTIPLE_CONNECTIONS は既定で VARIANT_FALSE に設定されます。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-147">When MARS is enabled, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client can support multiple command and rowset objects on a single connection, so MULTIPLE_CONNECTIONS is set to VARIANT_FALSE by default.</span></span>  
  
 <span data-ttu-id="1c1ad-148">DBPROPSET_SQLSERVERDBINIT プロパティ セットに行われた機能強化の詳細については、「[初期化プロパティと承認プロパティ](../../native-client-ole-db-data-source-objects/initialization-and-authorization-properties.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-148">For more information about enhancements made to the DBPROPSET_SQLSERVERDBINIT property set, see [Initialization and Authorization Properties](../../native-client-ole-db-data-source-objects/initialization-and-authorization-properties.md).</span></span>  
  
### <a name="sql-server-native-client-ole-db-provider-example"></a><span data-ttu-id="1c1ad-149">SQL Server Native Client OLE DB プロバイダーの例</span><span class="sxs-lookup"><span data-stu-id="1c1ad-149">SQL Server Native Client OLE DB Provider Example</span></span>  
 <span data-ttu-id="1c1ad-150">この例では、ネイティブ OLE DB プロバイダーを使用してデータソースオブジェクトを作成 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] し、セッションオブジェクトを作成する前に、DBPROPSET_SQLSERVERDBINIT プロパティセットを使用して MARS を有効にします。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-150">In this example, a data source object is created using the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native OLE DB provider, and MARS is enabled using the DBPROPSET_SQLSERVERDBINIT property set before the session object is created.</span></span>  
  
```  
#include <sqlncli.h>  
  
IDBInitialize *pIDBInitialize = NULL;  
IDBCreateSession *pIDBCreateSession = NULL;  
IDBProperties *pIDBProperties = NULL;  
  
// Create the data source object.  
hr = CoCreateInstance(CLSID_SQLNCLI10, NULL,  
   CLSCTX_INPROC_SERVER,  
   IID_IDBInitialize,   
    (void**)&pIDBInitialize);  
  
hr = pIDBInitialize->QueryInterface(IID_IDBProperties, (void**)&pIDBProperties);  
  
// Set the MARS property.  
DBPROP rgPropMARS;  
  
// The following is necessary since MARS is off by default.  
rgPropMARS.dwPropertyID = SSPROP_INIT_MARSCONNECTION;  
rgPropMARS.dwOptions = DBPROPOPTIONS_REQUIRED;  
rgPropMARS.dwStatus = DBPROPSTATUS_OK;  
rgPropMARS.colid = DB_NULLID;  
V_VT(&(rgPropMARS.vValue)) = VT_BOOL;  
V_BOOL(&(rgPropMARS.vValue)) = VARIANT_TRUE;  
  
// Create the structure containing the properties.  
DBPROPSET PropSet;  
PropSet.rgProperties = &rgPropMARS;  
PropSet.cProperties = 1;  
PropSet.guidPropertySet = DBPROPSET_SQLSERVERDBINIT;  
  
// Get an IDBProperties pointer and set the initialization properties.  
pIDBProperties->SetProperties(1, &PropSet);  
pIDBProperties->Release();  
  
// Initialize the data source object.  
hr = pIDBInitialize->Initialize();  
  
//Create a session object from a data source object.  
IOpenRowset * pIOpenRowset = NULL;  
hr = IDBInitialize->QueryInterface(IID_IDBCreateSession, (void**)&pIDBCreateSession));  
hr = pIDBCreateSession->CreateSession(  
   NULL,             // pUnkOuter  
   IID_IOpenRowset,  // riid  
  &pIOpenRowset ));  // ppSession  
  
// Create a rowset with a firehose mode cursor.  
IRowset *pIRowset = NULL;  
DBPROP rgRowsetProperties[2];  
  
// To get a firehose mode cursor request a   
// forward only read only rowset.  
rgRowsetProperties[0].dwPropertyID = DBPROP_IRowsetLocate;  
rgRowsetProperties[0].dwOptions = DBPROPOPTIONS_REQUIRED;  
rgRowsetProperties[0].dwStatus = DBPROPSTATUS_OK;  
rgRowsetProperties[0].colid = DB_NULLID;  
VariantInit(&(rgRowsetProperties[0].vValue));  
rgRowsetProperties[0].vValue.vt = VARIANT_BOOL;  
rgRowsetProperties[0].vValue.boolVal = VARIANT_FALSE;  
  
rgRowsetProperties[1].dwPropertyID = DBPROP_IRowsetChange;  
rgRowsetProperties[1].dwOptions = DBPROPOPTIONS_REQUIRED;  
rgRowsetProperties[1].dwStatus = DBPROPSTATUS_OK;  
rgRowsetProperties[1].colid = DB_NULLID;  
VariantInit(&(rgRowsetProperties[1].vValue));  
rgRowsetProperties[1].vValue.vt = VARIANT_BOOL;  
rgRowsetProperties[1].vValue.boolVal = VARIANT_FALSE;  
  
DBPROPSET rgRowsetPropSet[1];  
rgRowsetPropSet[0].rgProperties = rgRowsetProperties  
rgRowsetPropSet[0].cProperties = 2  
rgRowsetPropSet[0].guidPropertySet = DBPROPSET_ROWSET;  
  
hr = pIOpenRowset->OpenRowset (NULL,  
   &TableID,  
   NULL,  
   IID_IRowset,  
   1,  
   rgRowsetPropSet  
   (IUnknown**)&pIRowset);  
```  
  
## <a name="sql-server-native-client-odbc-driver"></a><span data-ttu-id="1c1ad-151">SQL Server Native Client ODBC ドライバー</span><span class="sxs-lookup"><span data-stu-id="1c1ad-151">SQL Server Native Client ODBC Driver</span></span>  
 <span data-ttu-id="1c1ad-152">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]Native CLIENT ODBC ドライバーでは、 [SQLSetConnectAttr](../../native-client-odbc-api/sqlsetconnectattr.md)および[sqlgetconnectattr](../../native-client-odbc-api/sqlgetconnectattr.md)関数への追加によって MARS がサポートされています。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-152">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver supports MARS through additions to the [SQLSetConnectAttr](../../native-client-odbc-api/sqlsetconnectattr.md) and [SQLGetConnectAttr](../../native-client-odbc-api/sqlgetconnectattr.md) functions.</span></span> <span data-ttu-id="1c1ad-153">SQL_COPT_SS_MARS_ENABLED が追加され、SQL_MARS_ENABLED_YES または SQL_MARS_ENABLED_NO を受け取ります。既定値は SQL_MARS_ENABLED_NO です。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-153">SQL_COPT_SS_MARS_ENABLED has been added to accept either SQL_MARS_ENABLED_YES or SQL_MARS_ENABLED_NO, with SQL_MARS_ENABLED_NO being the default.</span></span> <span data-ttu-id="1c1ad-154">また、新しい接続文字列のキーワードとして `Mars_Connection` が追加されました。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-154">In addition, a new connection string keyword, `Mars_Connection`, as been added.</span></span> <span data-ttu-id="1c1ad-155">このキーワードは、"yes" と "no" を値として受け取ります。既定値は "no" です。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-155">It accepts "yes" or "no" values; "no" is the default.</span></span>  
  
### <a name="sql-server-native-client-odbc-driver-example"></a><span data-ttu-id="1c1ad-156">SQL Server Native Client ODBC ドライバーの例</span><span class="sxs-lookup"><span data-stu-id="1c1ad-156">SQL Server Native Client ODBC Driver Example</span></span>  
 <span data-ttu-id="1c1ad-157">この例では、 **SQLSetConnectAttr**関数を使用して、 **SQLDriverConnect**関数を呼び出してデータベースに接続する前に、MARS を有効にします。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-157">In this example, the **SQLSetConnectAttr** function is used to enable MARS before calling the **SQLDriverConnect** function to connect the database.</span></span> <span data-ttu-id="1c1ad-158">接続が確立されると、2つの**SQLExecDirect**関数が呼び出され、同じ接続に2つの異なる結果セットが作成されます。</span><span class="sxs-lookup"><span data-stu-id="1c1ad-158">Once the connection is made, two **SQLExecDirect** functions are called to create two separate result sets on the same connection.</span></span>  
  
```  
#include <sqlncli.h>  
  
SQLSetConnectAttr(hdbc, SQL_COPT_SS_MARS_ENABLED, SQL_MARS_ENABLED_YES, SQL_IS_UINTEGER);  
SQLDriverConnect(hdbc, hwnd,   
   "DRIVER=SQL Server Native Client 10.0;  
   SERVER=(local);trusted_connection=yes;", SQL_NTS, szOutConn,   
   MAX_CONN_OUT, &cbOutConn, SQL_DRIVER_COMPLETE);  
  
SQLAllocHandle(SQL_HANDLE_STMT, hdbc, &hstmt1);  
SQLAllocHandle(SQL_HANDLE_STMT, hdbc, &hstmt2);  
  
// The 2nd execute would have failed with connection busy error if  
// MARS were not enabled.  
SQLExecDirect(hstmt1, L"SELECT * FROM Authors", SQL_NTS);  
SQLExecDirect(hstmt2, L"SELECT * FROM Titles", SQL_NTS);  
  
// Result set processing can interleave.  
SQLFetch(hstmt1);  
SQLFetch(hstmt2);  
```  
  
## <a name="see-also"></a><span data-ttu-id="1c1ad-159">参照</span><span class="sxs-lookup"><span data-stu-id="1c1ad-159">See Also</span></span>  
 <span data-ttu-id="1c1ad-160">[SQL Server Native Client の機能](sql-server-native-client-features.md) </span><span class="sxs-lookup"><span data-stu-id="1c1ad-160">[SQL Server Native Client Features](sql-server-native-client-features.md) </span></span>  
 [<span data-ttu-id="1c1ad-161">SQL Server の既定の結果セットの使用</span><span class="sxs-lookup"><span data-stu-id="1c1ad-161">Using SQL Server Default Result Sets</span></span>](../../native-client-odbc-cursors/implementation/using-sql-server-default-result-sets.md)  
  
  
