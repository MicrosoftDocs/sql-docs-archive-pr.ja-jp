---
title: 一括エクスポートまたは一括インポートのデータの準備 (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: data-movement
ms.topic: conceptual
helpviewer_keywords:
- bulk importing [SQL Server], planning
- bulk importing [SQL Server], from a CSV file
- data formats [SQL Server], planning operations
- CSV files [SQL Server]
- quoted fields in CSV files [SQL Server]
ms.assetid: 783fd581-2e5f-496b-b79c-d4de1e09ea30
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 4f2780a4eadfc27ed2db15881d676965fca81e35
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87738436"
---
# <a name="prepare-data-for-bulk-export-or-import-sql-server"></a><span data-ttu-id="097a6-102">一括エクスポートまたは一括インポートのデータの準備 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="097a6-102">Prepare Data for Bulk Export or Import (SQL Server)</span></span>
  <span data-ttu-id="097a6-103">ここでは、一括エクスポート操作の計画に関する考慮事項と一括インポート操作の要件について説明します。</span><span class="sxs-lookup"><span data-stu-id="097a6-103">This section discusses the considerations involved in planning for bulk-export operations and the requirements for bulk-import operations.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="097a6-104">一括インポート用にデータ ファイルの書式を設定する方法が不明確な場合は、 **bcp** ユーティリティを使用して、データをテーブルからデータ ファイルにエクスポートできます。</span><span class="sxs-lookup"><span data-stu-id="097a6-104">If you are uncertain about how to format a data file for bulk importing, you can use the **bcp** utility to export data from the table into a data file.</span></span> <span data-ttu-id="097a6-105">このファイル内の各データ フィールドの書式設定では、データを対応するテーブル列に一括インポートする際に必要な書式設定が示されています。</span><span class="sxs-lookup"><span data-stu-id="097a6-105">The formatting of each data field in this file shows the formatting required to bulk import data into the corresponding table column.</span></span> <span data-ttu-id="097a6-106">データ ファイルのフィールドに同じデータの書式設定を使用してください。</span><span class="sxs-lookup"><span data-stu-id="097a6-106">Use the same data formatting for fields of your data file.</span></span>  
  
## <a name="data-file-format-considerations-for-bulk-export"></a><span data-ttu-id="097a6-107">一括エクスポートのデータ ファイル形式に関する注意点</span><span class="sxs-lookup"><span data-stu-id="097a6-107">Data-File Format Considerations for Bulk Export</span></span>  
 <span data-ttu-id="097a6-108">**bcp** コマンドを使用して一括エクスポート操作を実行する前に、次のことを考慮してください:</span><span class="sxs-lookup"><span data-stu-id="097a6-108">Before you perform a bulk-export operation by using the **bcp** command, consider the following:</span></span>  
  
-   <span data-ttu-id="097a6-109">データをファイルにエクスポートする際、 **bcp** コマンドにより、指定したファイル名のデータ ファイルが自動的に作成されます。</span><span class="sxs-lookup"><span data-stu-id="097a6-109">When data is exported to a file, the **bcp** command creates the data file automatically by using the specified file name.</span></span> <span data-ttu-id="097a6-110">指定の名前が既に使用されている場合、そのファイルの既存のコンテンツは、そのデータ ファイルに一括コピーするデータで上書きされます。</span><span class="sxs-lookup"><span data-stu-id="097a6-110">If that file name is already in use, the data that is being bulk copied to the data file overwrites the existing contents of the file.</span></span>  
  
-   <span data-ttu-id="097a6-111">テーブルまたはビューからデータを一括エクスポートする場合、一括コピーするテーブルまたはビューに SELECT 権限が必要になります。</span><span class="sxs-lookup"><span data-stu-id="097a6-111">Bulk export from a table or view to a data file requires SELECT permission on the table or view that is being bulk copied.</span></span>  
  
-   [!INCLUDE[msCoName](../../includes/msconame-md.md)] <span data-ttu-id="097a6-112">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] では、データの取得に並列スキャンを使用できます。</span><span class="sxs-lookup"><span data-stu-id="097a6-112">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] can use parallel scans to retrieve data.</span></span> <span data-ttu-id="097a6-113">そのため、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] インスタンスから一括エクスポートされるテーブル行は、通常、エクスポート先のデータ ファイルで特定の順序で表示されるとは保証されません。</span><span class="sxs-lookup"><span data-stu-id="097a6-113">Therefore, the table rows that are bulk exported in from an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] are not ordinarily guaranteed to be in any specific order in the data file.</span></span> <span data-ttu-id="097a6-114">一括エクスポートされたテーブル行がデータ ファイル内に特定の順序で表示されるようにするには、 **queryout** オプションを使用してクエリから一括エクスポートを行い、ORDER BY 句を指定します。</span><span class="sxs-lookup"><span data-stu-id="097a6-114">To make sure that bulk-exported table rows appear in a specific order in the data file, use the **queryout** option to bulk export from a query, and specify an ORDER BY clause.</span></span>  
  
## <a name="data-file-format-requirements-for-bulk-import"></a><span data-ttu-id="097a6-115">一括インポートのデータ ファイル形式の要件</span><span class="sxs-lookup"><span data-stu-id="097a6-115">Data-File Format Requirements for Bulk Import</span></span>  
 <span data-ttu-id="097a6-116">データ ファイルからデータをインポートするには、データ ファイルは以下の基本要件を満たしている必要があります。</span><span class="sxs-lookup"><span data-stu-id="097a6-116">To import data from a data file, the file must meet the following basic requirements:</span></span>  
  
-   <span data-ttu-id="097a6-117">データは、行と列の形式になっている必要があります。</span><span class="sxs-lookup"><span data-stu-id="097a6-117">The data must be in row and column format.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="097a6-118">一括インポート処理では、列がスキップされたり順番が再変更されることがあるため、データ ファイルの構造は、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] テーブルの構造と同一である必要はありません。</span><span class="sxs-lookup"><span data-stu-id="097a6-118">The structure of the data file does not need to be identical to the structure of the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] table because columns can be skipped or reordered during the bulk-import process.</span></span>  
  
-   <span data-ttu-id="097a6-119">データ ファイルのデータは、文字列形式やネイティブ形式など、サポートされている形式である必要があります。</span><span class="sxs-lookup"><span data-stu-id="097a6-119">The data in the data file must be in a supported format such as character or native format.</span></span>  
  
-   <span data-ttu-id="097a6-120">データは、Unicode を含む文字列形式またはネイティブ バイナリ形式にすることができます。</span><span class="sxs-lookup"><span data-stu-id="097a6-120">The data can be in character or native binary format including Unicode.</span></span>  
  
-   <span data-ttu-id="097a6-121">**bcp** コマンド、BULK INSERT ステートメント、または INSERT ...SELECT \* FROM OPENROWSET(BULK...) ステートメントを使用してデータをインポートするには、インポート先のテーブルが既に存在している必要があります。</span><span class="sxs-lookup"><span data-stu-id="097a6-121">To import data by using a **bcp** command, BULK INSERT statement, or INSERT ... SELECT \* FROM OPENROWSET(BULK...) statement, the destination table must already exist.</span></span>  
  
-   <span data-ttu-id="097a6-122">データ ファイルの各フィールドは、インポート先テーブルの対応する列と互換性がある必要があります。</span><span class="sxs-lookup"><span data-stu-id="097a6-122">Each field in the data file must be compatible with the corresponding column in the target table.</span></span> <span data-ttu-id="097a6-123">たとえば、`int` フィールドを `datetime` 列に読み込むことはできません。</span><span class="sxs-lookup"><span data-stu-id="097a6-123">For example, an `int` field cannot be loaded into a `datetime` column.</span></span> <span data-ttu-id="097a6-124">詳細については、「[一括インポートまたは一括エクスポートのデータ形式 &#40;SQL Server&#41;](data-formats-for-bulk-import-or-bulk-export-sql-server.md)」および「[bcp を使用した互換性のためのデータ形式の指定 &#40;SQL Server&#41;](specify-data-formats-for-compatibility-when-using-bcp-sql-server.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="097a6-124">For more information, see [Data Formats for Bulk Import or Bulk Export &#40;SQL Server&#41;](data-formats-for-bulk-import-or-bulk-export-sql-server.md) and [Specify Data Formats for Compatibility when Using bcp &#40;SQL Server&#41;](specify-data-formats-for-compatibility-when-using-bcp-sql-server.md).</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="097a6-125">ファイル全体をインポートするのではなく、データ ファイルからインポートする行のサブセットを指定するには、**bcp** コマンドと、 **-F** *first_row* スイッチ、 **-L** *last_row* スイッチ、またはその両方のスイッチを組み合わせて使用します。</span><span class="sxs-lookup"><span data-stu-id="097a6-125">To specify a subset of rows to import from a data file rather than the entire file, you can use a **bcp** command with the **-F** *first_row* switch and/or **-L** *last_row* switch.</span></span> <span data-ttu-id="097a6-126">詳細については、「 [bcp Utility](../../tools/bcp-utility.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="097a6-126">For more information, see [bcp Utility](../../tools/bcp-utility.md).</span></span>  
  
-   <span data-ttu-id="097a6-127">固定長フィールドまたは固定幅フィールドを含むデータ ファイルからデータをインポートするには、フォーマット ファイルを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="097a6-127">To import data from data files with fixed-length or fixed-width fields, you must use a format file.</span></span> <span data-ttu-id="097a6-128">詳細については、「 [XML フォーマット ファイル &#40;SQL Server&#41;](xml-format-files-sql-server.md)です。</span><span class="sxs-lookup"><span data-stu-id="097a6-128">For more information, see [XML Format Files &#40;SQL Server&#41;](xml-format-files-sql-server.md).</span></span>  
  
-   <span data-ttu-id="097a6-129">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] の一括インポート操作では、コンマ区切り (CSV) ファイルがサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="097a6-129">Comma-separated value (CSV) files are not supported by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] bulk-import operations.</span></span> <span data-ttu-id="097a6-130">ただし、場合によっては、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]に対してデータを一括インポートする際、CSV ファイルをデータ ファイルとして使用できます。</span><span class="sxs-lookup"><span data-stu-id="097a6-130">However, in some cases, a CSV file can be used as the data file for a bulk import of data into [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="097a6-131">CSV ファイルのフィールド ターミネータは必ずしもコンマである必要はありません。</span><span class="sxs-lookup"><span data-stu-id="097a6-131">Note that the field terminator of a CSV file does not have to be a comma.</span></span> <span data-ttu-id="097a6-132">一括インポートのデータ ファイルとして利用できるようにするには、CSV ファイルが次の条件を満たしている必要があります。</span><span class="sxs-lookup"><span data-stu-id="097a6-132">To be usable as a data file for bulk import, a CSV file must comply with the following restrictions:</span></span>  
  
    -   <span data-ttu-id="097a6-133">データ フィールドにフィールド ターミネータが含まれていないこと。</span><span class="sxs-lookup"><span data-stu-id="097a6-133">Data fields never contain the field terminator.</span></span>  
  
    -   <span data-ttu-id="097a6-134">データ フィールドの値を囲む引用符 ("") の有無がすべての値で統一されていること。</span><span class="sxs-lookup"><span data-stu-id="097a6-134">Either none or all of the values in a data field are enclosed in quotation marks ("").</span></span>  
  
     <span data-ttu-id="097a6-135">データを [!INCLUDE[msCoName](../../includes/msconame-md.md)] FoxPro や Visual FoxPro テーブル (.dbf) ファイル、または [!INCLUDE[ofprexcel](../../includes/ofprexcel-md.md)] ワークシート (.xls) ファイルから一括インポートするには、前述の制限に準拠した CSV ファイルにデータを変換する必要があります。</span><span class="sxs-lookup"><span data-stu-id="097a6-135">To bulk import data from a [!INCLUDE[msCoName](../../includes/msconame-md.md)] FoxPro or Visual FoxPro table (.dbf) file or a [!INCLUDE[ofprexcel](../../includes/ofprexcel-md.md)] worksheet (.xls) file, you would need to convert the data into a CSV file that complies to the preceding restrictions.</span></span> <span data-ttu-id="097a6-136">通常、ファイル拡張子は .csv です。</span><span class="sxs-lookup"><span data-stu-id="097a6-136">The file extension will typically be .csv.</span></span> <span data-ttu-id="097a6-137">そうすると、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 一括インポート操作で .csv ファイルをデータ ファイルとして使用できます。</span><span class="sxs-lookup"><span data-stu-id="097a6-137">You can then use the .csv file as a data file in a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] bulk-import operation.</span></span>  
  
     <span data-ttu-id="097a6-138">32 ビット システムでは、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] OPENROWSET [を OLE DB Provider for Jet と共に使用することにより、一括インポートの最適化を使用せずに CSV データを](/sql/t-sql/functions/openrowset-transact-sql) テーブルにインポートできます。</span><span class="sxs-lookup"><span data-stu-id="097a6-138">On 32-bit systems, it is possible to import CSV data into a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] table without bulk-import optimizations by using [OPENROWSET](/sql/t-sql/functions/openrowset-transact-sql) with the OLE DB Provider for Jet.</span></span> <span data-ttu-id="097a6-139">Jet は、データ ソースと同じディレクトリ内にある schema.ini ファイルで定義されたスキーマを使用して、テキスト ファイルをテーブルとして扱います。</span><span class="sxs-lookup"><span data-stu-id="097a6-139">Jet treats text files as tables, with the schema defined by a schema.ini file that is located in the same directory as the data source.</span></span>  <span data-ttu-id="097a6-140">CSV データの場合、schema.ini ファイル内のパラメーターの 1 つが "FORMAT=CSVDelimited" となります。</span><span class="sxs-lookup"><span data-stu-id="097a6-140">For a CSV data, one of the parameters in the schema.ini file would be "FORMAT=CSVDelimited".</span></span> <span data-ttu-id="097a6-141">この解決方法を使用するには、Jet Test IISAMm 操作、その接続文字列の構文、schema.ini の使用法、レジストリ設定オプションなどについて理解する必要があります。</span><span class="sxs-lookup"><span data-stu-id="097a6-141">To use this solution, you would need to understand how the Jet Test IISAMm operations-its connection string syntax, schema.ini usage, registry setting options, and so on).</span></span>  <span data-ttu-id="097a6-142">この情報については、Microsoft Access ヘルプとサポート技術情報 (KB) の資料を参照することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="097a6-142">The best sources of this information are Microsoft Access Help and Knowledge Base (KB) articles.</span></span> <span data-ttu-id="097a6-143">詳細については、「[Initializing the Text Data Source Driver](https://docs.microsoft.com/office/client-developer/access/desktop-database-reference/initializing-the-text-data-source-driver)」 (テキスト データ ソースのドライバーを初期化する)、「[How To Use a SQL Server 7.0 Distributed Query with a Linked Server to Secured Access Databases](https://go.microsoft.com/fwlink/?LinkId=128504)」 (セキュリティ設定された Access データベースにリンクされたサーバーで SQL Server 7.0 分散クエリを使用する方法)、「[HOW TO:Use Jet OLE DB Provider 4.0 to Connect to ISAM Databases](https://go.microsoft.com/fwlink/?LinkId=128505)」 (ISAM データベースへの接続に Jet OLE DB プロバイダー 4.0 を使用する方法)、「[How To Open Delimited Text Files Using the Jet Provider's Text IIsam](https://go.microsoft.com/fwlink/?LinkId=128501)」 (Jet プロバイダーの Text IIsam を使用して区切り記号付きテキスト ファイルを開く方法) を参照してください。</span><span class="sxs-lookup"><span data-stu-id="097a6-143">For more information, see [Initializing the Text Data Source Driver](https://docs.microsoft.com/office/client-developer/access/desktop-database-reference/initializing-the-text-data-source-driver), [How To Use a SQL Server 7.0 Distributed Query with a Linked Server to Secured Access Databases](https://go.microsoft.com/fwlink/?LinkId=128504), [HOW TO: Use Jet OLE DB Provider 4.0 to Connect to ISAM Databases](https://go.microsoft.com/fwlink/?LinkId=128505), and [How To Open Delimited Text Files Using the Jet Provider's Text IIsam](https://go.microsoft.com/fwlink/?LinkId=128501).</span></span>  
  
 <span data-ttu-id="097a6-144">また、データ ファイルのデータをテーブルに一括インポートするには、以下の要件も満たしている必要があります。</span><span class="sxs-lookup"><span data-stu-id="097a6-144">In addition, the bulk import of data from a data file into a table requires the following:</span></span>  
  
-   <span data-ttu-id="097a6-145">ユーザーは、インポート先のテーブルに対する INSERT 権限および SELECT 権限を持っている必要があります。</span><span class="sxs-lookup"><span data-stu-id="097a6-145">Users must have INSERT and SELECT permissions on the table.</span></span> <span data-ttu-id="097a6-146">また、制約を無効にするなどデータ定義言語 (DDL) 操作が必要なオプションを使用する場合は、ALTER TABLE 権限も必要になります。</span><span class="sxs-lookup"><span data-stu-id="097a6-146">Users also need ALTER TABLE permission when they use options that require data definition language (DDL) operations, such as disabling constraints.</span></span>  
  
-   <span data-ttu-id="097a6-147">BULK INSERT または INSERT ...SELECT \* FROM OPENROWSET(BULK...) を使用してデータを一括インポートする際は、[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] プロセスのセキュリティ プロファイル (ユーザーが [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] で提供されたログインを使用してログインしている場合) またはデリゲートされたセキュリティに基づいて使用されている [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows ログインから、このデータ ファイルにアクセスし、読み取り操作ができる状態でなければなりません。</span><span class="sxs-lookup"><span data-stu-id="097a6-147">When you bulk import data by using BULK INSERT or INSERT ... SELECT \* FROM OPENROWSET(BULK...), the data file must be accessible for read operations by either the security profile of the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] process (if the user logs in using [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] provided login) or by the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows login that is used under delegated security.</span></span> <span data-ttu-id="097a6-148">また、ファイルを読み取るには、ユーザーに ADMINISTER BULK OPERATIONS 権限が必要です。</span><span class="sxs-lookup"><span data-stu-id="097a6-148">Additionally, the user must have ADMINISTER BULK OPERATIONS permission to read the file.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="097a6-149">パーティション ビューへのデータの一括インポートはサポートされません。パーティション ビューにデータを一括インポートするとエラーになります。</span><span class="sxs-lookup"><span data-stu-id="097a6-149">Bulk importing into a partitioned view is unsupported, and attempts to bulk import data into a partitioned view fail.</span></span>  
  
## <a name="external-resources"></a><span data-ttu-id="097a6-150">外部リソース</span><span class="sxs-lookup"><span data-stu-id="097a6-150">External Resources</span></span>  
 <span data-ttu-id="097a6-151">[[HOWTO] DTS: Excel から SQL Server にデータをインポートする方法](https://support.microsoft.com/kb/321686)</span><span class="sxs-lookup"><span data-stu-id="097a6-151">[How to import data from Excel to SQL Server](https://support.microsoft.com/kb/321686)</span></span>  
  
## <a name="change-history"></a><span data-ttu-id="097a6-152">変更履歴</span><span class="sxs-lookup"><span data-stu-id="097a6-152">Change History</span></span>  
  
|<span data-ttu-id="097a6-153">変更内容</span><span class="sxs-lookup"><span data-stu-id="097a6-153">Updated content</span></span>|  
|---------------------|  
|<span data-ttu-id="097a6-154">OLE DB Provider for Jet を使用した CSV データのインポートについての情報を追加しました。</span><span class="sxs-lookup"><span data-stu-id="097a6-154">Added information about using the OLE DB Provider for Jet to import CSV data.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="097a6-155">参照</span><span class="sxs-lookup"><span data-stu-id="097a6-155">See Also</span></span>  
 <span data-ttu-id="097a6-156">[bcp ユーティリティ](../../tools/bcp-utility.md) </span><span class="sxs-lookup"><span data-stu-id="097a6-156">[bcp Utility](../../tools/bcp-utility.md) </span></span>  
 <span data-ttu-id="097a6-157">[BULK INSERT &#40;Transact-SQL&#41;](/sql/t-sql/statements/bulk-insert-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="097a6-157">[BULK INSERT &#40;Transact-SQL&#41;](/sql/t-sql/statements/bulk-insert-transact-sql) </span></span>  
 <span data-ttu-id="097a6-158">[データ型 &#40;Transact-SQL&#41;](/sql/t-sql/data-types/data-types-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="097a6-158">[Data Types &#40;Transact-SQL&#41;](/sql/t-sql/data-types/data-types-transact-sql) </span></span>  
 <span data-ttu-id="097a6-159">[文字形式を使用したデータのインポートまたはエクスポート &#40;SQL Server&#41;](use-character-format-to-import-or-export-data-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="097a6-159">[Use Character Format to Import or Export Data &#40;SQL Server&#41;](use-character-format-to-import-or-export-data-sql-server.md) </span></span>  
 [<span data-ttu-id="097a6-160">ネイティブ形式を使用したデータのインポートまたはエクスポート &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="097a6-160">Use Native Format to Import or Export Data &#40;SQL Server&#41;</span></span>](use-native-format-to-import-or-export-data-sql-server.md)  
  
  
