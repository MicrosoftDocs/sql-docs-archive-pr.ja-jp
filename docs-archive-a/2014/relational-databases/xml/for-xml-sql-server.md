---
title: FOR XML (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: xml
ms.topic: conceptual
helpviewer_keywords:
- FOR XML clause, about FOR XML clause
- PATH FOR XML mode, construction
- EXPLICIT FOR XML mode
- RAW FOR XML mode
- retrieving XML data
- XML [SQL Server], FOR XML clause
- AUTO FOR XML mode
- XML [SQL Server], construction
ms.assetid: 2b6b5c61-c5bd-49d2-8c0c-b7cf15857906
author: rothja
ms.author: jroth
ms.openlocfilehash: 6fe55186e89020f57ae1eb078625d1cdce262864
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87743098"
---
# <a name="for-xml-sql-server"></a><span data-ttu-id="d1b63-102">FOR XML (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="d1b63-102">FOR XML (SQL Server)</span></span>
  <span data-ttu-id="d1b63-103">SELECT クエリは、結果を行セットとして返します。</span><span class="sxs-lookup"><span data-stu-id="d1b63-103">A SELECT query returns results as a rowset.</span></span> <span data-ttu-id="d1b63-104">必要に応じて、SQL クエリに FOR XML 句を指定することで、SQL クエリの結果を XML 形式で取得することができます。</span><span class="sxs-lookup"><span data-stu-id="d1b63-104">You can optionally retrieve formal results of a SQL query as XML by specifying the FOR XML clause in the query.</span></span> <span data-ttu-id="d1b63-105">FOR XML 句は、最上位レベルのクエリとサブクエリのいずれでも使用できます。</span><span class="sxs-lookup"><span data-stu-id="d1b63-105">The FOR XML clause can be used in top-level queries and in sub queries.</span></span> <span data-ttu-id="d1b63-106">最上位レベルの FOR XML 句は、SELECT ステートメント内でのみ使用できます。</span><span class="sxs-lookup"><span data-stu-id="d1b63-106">The top-level FOR XML clause can be used only in the SELECT statement.</span></span> <span data-ttu-id="d1b63-107">サブ クエリでは、FOR XML 句を INSERT、UPDATE、DELETE ステートメント内で使用できます。</span><span class="sxs-lookup"><span data-stu-id="d1b63-107">In sub queries, FOR XML can be used in the INSERT, UPDATE, and DELETE statements.</span></span> <span data-ttu-id="d1b63-108">また、代入ステートメントでも使用できます。</span><span class="sxs-lookup"><span data-stu-id="d1b63-108">It can also be used in assignment statements.</span></span>  
  
 <span data-ttu-id="d1b63-109">FOR XML 句には、次のモードのうち 1 つを指定します。</span><span class="sxs-lookup"><span data-stu-id="d1b63-109">In a FOR XML clause, you specify one of these modes:</span></span>  
  
-   <span data-ttu-id="d1b63-110">RAW</span><span class="sxs-lookup"><span data-stu-id="d1b63-110">RAW</span></span>  
  
-   <span data-ttu-id="d1b63-111">AUTO</span><span class="sxs-lookup"><span data-stu-id="d1b63-111">AUTO</span></span>  
  
-   <span data-ttu-id="d1b63-112">EXPLICIT</span><span class="sxs-lookup"><span data-stu-id="d1b63-112">EXPLICIT</span></span>  
  
-   <span data-ttu-id="d1b63-113">PATH</span><span class="sxs-lookup"><span data-stu-id="d1b63-113">PATH</span></span>  
  
 <span data-ttu-id="d1b63-114">RAW モードでは、SELECT ステートメントによって返された行セットの行 1 つにつき 1 つの \<row> 要素を生成します。</span><span class="sxs-lookup"><span data-stu-id="d1b63-114">The RAW mode generates a single \<row> element per row in the rowset that is returned by the SELECT statement.</span></span> <span data-ttu-id="d1b63-115">入れ子にした FOR XML クエリを作成することで、XML 階層を生成できます。</span><span class="sxs-lookup"><span data-stu-id="d1b63-115">You can generate XML hierarchy by writing nested FOR XML queries.</span></span>  
  
 <span data-ttu-id="d1b63-116">AUTO モードは、SELECT ステートメントがどのように指定されているかに基づき、帰納的な方法で入れ子になった結果の XML を生成します。</span><span class="sxs-lookup"><span data-stu-id="d1b63-116">The AUTO mode generates nesting in the resulting XML by using heuristics based on the way the SELECT statement is specified.</span></span> <span data-ttu-id="d1b63-117">生成される XML の構造については最小限の制御しか行えません。</span><span class="sxs-lookup"><span data-stu-id="d1b63-117">You have minimal control over the shape of the XML generated.</span></span> <span data-ttu-id="d1b63-118">AUTO モードで帰納的に生成された XML 構造に対して、入れ子になった FOR XML クエリを作成し、XML 階層を生成することができます。</span><span class="sxs-lookup"><span data-stu-id="d1b63-118">The nested FOR XML queries can be written to generate XML hierarchy beyond the XML shape that is generated by AUTO mode heuristics.</span></span>  
  
 <span data-ttu-id="d1b63-119">EXPLICIT モードでは、XML の構造をより厳密に制御することができます。</span><span class="sxs-lookup"><span data-stu-id="d1b63-119">The EXPLICIT mode allows more control over the shape of the XML.</span></span> <span data-ttu-id="d1b63-120">属性や要素を自由に組み合わせて、XML の構造を決めることができます。</span><span class="sxs-lookup"><span data-stu-id="d1b63-120">You can mix attributes and elements at will in deciding the shape of the XML.</span></span> <span data-ttu-id="d1b63-121">このモードでは、クエリを実行した結果として生成される行セットに特定の形式を指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="d1b63-121">It requires a specific format for the resulting rowset that is generated because of query execution.</span></span> <span data-ttu-id="d1b63-122">その後、この行セットの形式が、XML の構造にマップされます。</span><span class="sxs-lookup"><span data-stu-id="d1b63-122">This rowset format is then mapped into XML shape.</span></span> <span data-ttu-id="d1b63-123">EXPLICIT モードの利点は、属性と要素を自由に組み合わせることができる点です。また、ラッパーや入れ子にした複雑なプロパティを作成したり、スペースで区切られた値を作成したり (OrderID 属性に注文 ID 値の一覧を渡すなど)、混合コンテンツを作成することもできます。</span><span class="sxs-lookup"><span data-stu-id="d1b63-123">The power of EXPLICIT mode is to mix attributes and elements at will, create wrappers and nested complex properties, create space-separated values (for example, OrderID attribute may have a list of order ID values), and mixed contents.</span></span>  
  
 <span data-ttu-id="d1b63-124">ただし、EXPLICIT モードのクエリを記述する作業は複雑になることがあります。</span><span class="sxs-lookup"><span data-stu-id="d1b63-124">However, writing EXPLICIT mode queries can be cumbersome.</span></span> <span data-ttu-id="d1b63-125">EXPLICIT モードを使用して階層を生成する代わりに、RAW、AUTO、または PATH モードの入れ子にした FOR XML クエリと TYPE ディレクティブを作成するなど、FOR XML の新しい機能を使用できます。</span><span class="sxs-lookup"><span data-stu-id="d1b63-125">You can use some of the new FOR XML capabilities, such as writing nested FOR XML RAW/AUTO/PATH mode queries and the TYPE directive, instead of using EXPLICIT mode to generate the hierarchies.</span></span> <span data-ttu-id="d1b63-126">このような入れ子にした FOR XML クエリでも、EXPLICIT モードで生成できる XML を作成することができます。</span><span class="sxs-lookup"><span data-stu-id="d1b63-126">The nested FOR XML queries can produce any XML that you can generate by using the EXPLICIT mode.</span></span> <span data-ttu-id="d1b63-127">詳細については、 [入れ子になった FOR XML クエリの使用](use-nested-for-xml-queries.md) および [FOR XML クエリの TYPE ディレクティブ](type-directive-in-for-xml-queries.md)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="d1b63-127">For more information, see [Use Nested FOR XML Queries](use-nested-for-xml-queries.md) and [TYPE Directive in FOR XML Queries](type-directive-in-for-xml-queries.md).</span></span>  
  
 <span data-ttu-id="d1b63-128">PATH モードと FOR XML クエリの入れ子機能を組み合わせると、EXPLICIT モードと同等の柔軟性が得られます。</span><span class="sxs-lookup"><span data-stu-id="d1b63-128">The PATH mode together with the nested FOR XML query capability provides the flexibility of the EXPLICIT mode in a simpler manner.</span></span>  
  
 <span data-ttu-id="d1b63-129">これらのモードは、モードが設定されたクエリの実行に限って有効です。</span><span class="sxs-lookup"><span data-stu-id="d1b63-129">These modes are in effect only for the execution of the query for which they are set.</span></span> <span data-ttu-id="d1b63-130">後続のクエリの結果に影響は与えません。</span><span class="sxs-lookup"><span data-stu-id="d1b63-130">They do not affect the results of any subsequent queries.</span></span>  
  
 <span data-ttu-id="d1b63-131">FOR BROWSE 句で使用されるどのような選択に対しても FOR XML は無効です。</span><span class="sxs-lookup"><span data-stu-id="d1b63-131">FOR XML is not valid for any selection that is used with a FOR BROWSE clause.</span></span>  
  
## <a name="example"></a><span data-ttu-id="d1b63-132">例</span><span class="sxs-lookup"><span data-stu-id="d1b63-132">Example</span></span>  
 <span data-ttu-id="d1b63-133">次の `SELECT` ステートメントは、 `Sales.Customer` データベースの `Sales.SalesOrderHeader` テーブルおよび `AdventureWorks2012` テーブルの情報を取得します。</span><span class="sxs-lookup"><span data-stu-id="d1b63-133">The following `SELECT` statement retrieves information from the `Sales.Customer` and `Sales.SalesOrderHeader` tables in the `AdventureWorks2012` database.</span></span> <span data-ttu-id="d1b63-134">このクエリでは、 `AUTO` 句に `FOR XML` モードを指定しています。</span><span class="sxs-lookup"><span data-stu-id="d1b63-134">This query specifies the `AUTO` mode in the `FOR XML` clause:</span></span>  
  
```  
USE AdventureWorks2012  
GO  
SELECT Cust.CustomerID,   
       OrderHeader.CustomerID,  
       OrderHeader.SalesOrderID,   
       OrderHeader.Status  
FROM Sales.Customer Cust   
INNER JOIN Sales.SalesOrderHeader OrderHeader  
ON Cust.CustomerID = OrderHeader.CustomerID  
FOR XML AUTO  
```  
  
## <a name="the-for-xml-clause-and-server-names"></a><span data-ttu-id="d1b63-135">FOR XML 句とサーバー名</span><span class="sxs-lookup"><span data-stu-id="d1b63-135">The FOR XML Clause and Server Names</span></span>  
 <span data-ttu-id="d1b63-136">FOR XML 句を伴う SELECT ステートメントが、クエリの中で 4 つの部分から構成される名前を指定している場合、クエリがローカル コンピューター上で実行されると、結果の XML ドキュメントにサーバー名は返されません。</span><span class="sxs-lookup"><span data-stu-id="d1b63-136">When a SELECT statement with a FOR XML clause specifies a four-part name in the query, the server name is not returned in the resulting XML document when the query is executed on the local computer.</span></span> <span data-ttu-id="d1b63-137">しかし、クエリがネットワーク サーバー上で実行されると、4 つの部分から構成される名前でサーバー名が返されます。</span><span class="sxs-lookup"><span data-stu-id="d1b63-137">However, the server name is returned as the four-part name when the query is executed on a network server.</span></span>  
  
 <span data-ttu-id="d1b63-138">たとえば、次のクエリについて考えてみます。</span><span class="sxs-lookup"><span data-stu-id="d1b63-138">For example, consider this query:</span></span>  
  
```  
SELECT TOP 1 LastName  
FROM ServerName.AdventureWorks2012.Person.Person  
FOR XML AUTO  
```  
  
 <span data-ttu-id="d1b63-139">`ServerName` がローカル サーバーの場合、クエリは次の値を返します。</span><span class="sxs-lookup"><span data-stu-id="d1b63-139">When `ServerName` is a local server, the query returns the following:</span></span>  
  
```  
<AdventureWorks2012.Person.Person LastName="Achong" />  
```  
  
 <span data-ttu-id="d1b63-140">`ServerName` がネットワーク サーバーの場合、クエリは次の値を返します。</span><span class="sxs-lookup"><span data-stu-id="d1b63-140">When `ServerName` is a network server, the query returns the following:</span></span>  
  
```  
<ServerName.AdventureWorks2012.Person.Person LastName="Achong" />  
```  
  
 <span data-ttu-id="d1b63-141">次の別名を指定することによって、このような違いが生じないようにできます。</span><span class="sxs-lookup"><span data-stu-id="d1b63-141">This potential ambiguity can be avoided by specifying this alias:</span></span>  
  
```  
SELECT TOP 1 LastName  
FROM ServerName.AdventureWorks2012.Person.Person x  
FOR XML AUTO   
```  
  
 <span data-ttu-id="d1b63-142">このクエリの結果は次のようになります。</span><span class="sxs-lookup"><span data-stu-id="d1b63-142">This query returns the following:</span></span>  
  
```  
<x LastName="Achong"/>  
```  
  
## <a name="see-also"></a><span data-ttu-id="d1b63-143">参照</span><span class="sxs-lookup"><span data-stu-id="d1b63-143">See Also</span></span>  
 <span data-ttu-id="d1b63-144">[FOR XML 句の基本構文](basic-syntax-of-the-for-xml-clause.md) </span><span class="sxs-lookup"><span data-stu-id="d1b63-144">[Basic Syntax of the FOR XML Clause](basic-syntax-of-the-for-xml-clause.md) </span></span>  
 <span data-ttu-id="d1b63-145">[FOR XML での RAW モードの使用](use-raw-mode-with-for-xml.md) </span><span class="sxs-lookup"><span data-stu-id="d1b63-145">[Use RAW Mode with FOR XML](use-raw-mode-with-for-xml.md) </span></span>  
 <span data-ttu-id="d1b63-146">[FOR XML での AUTO モードの使用](use-auto-mode-with-for-xml.md) </span><span class="sxs-lookup"><span data-stu-id="d1b63-146">[Use AUTO Mode with FOR XML](use-auto-mode-with-for-xml.md) </span></span>  
 <span data-ttu-id="d1b63-147">[FOR XML での EXPLICIT モードの使用](use-explicit-mode-with-for-xml.md) </span><span class="sxs-lookup"><span data-stu-id="d1b63-147">[Use EXPLICIT Mode with FOR XML](use-explicit-mode-with-for-xml.md) </span></span>  
 <span data-ttu-id="d1b63-148">[FOR XML での PATH モードの使用](use-path-mode-with-for-xml.md) </span><span class="sxs-lookup"><span data-stu-id="d1b63-148">[Use PATH Mode with FOR XML](use-path-mode-with-for-xml.md) </span></span>  
 <span data-ttu-id="d1b63-149">[OPENXML &#40;SQL Server&#41;](openxml-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="d1b63-149">[OPENXML &#40;SQL Server&#41;](openxml-sql-server.md) </span></span>  
 [<span data-ttu-id="d1b63-150">WITH XMLNAMESPACES を使用したクエリへの名前空間の追加</span><span class="sxs-lookup"><span data-stu-id="d1b63-150">Add Namespaces to Queries with WITH XMLNAMESPACES</span></span>](add-namespaces-to-queries-with-with-xmlnamespaces.md)  
  
  
