---
title: OPENXML 内でのメタプロパティの指定 | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: xml
ms.topic: conceptual
helpviewer_keywords:
- overflow in XML document [SQL Server]
- metaproperties [XML in SQL Server]
- unconsumed data
- extracting information of XML nodes [SQL Server]
- OPENXML statement, metaproperties
ms.assetid: 29bfd1c6-3f9a-43c4-924a-53d438e442f4
author: rothja
ms.author: jroth
ms.openlocfilehash: c52d1162aa495deff8a0fde314fdcde0735d9c2f
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87719749"
---
# <a name="specify-metaproperties-in-openxml"></a><span data-ttu-id="96a3a-102">OPENXML 内でのメタプロパティの指定</span><span class="sxs-lookup"><span data-stu-id="96a3a-102">Specify Metaproperties in OPENXML</span></span>
  <span data-ttu-id="96a3a-103">XML ドキュメントに含まれるメタプロパティ属性は、XML アイテム (要素、属性、その他の DOM ノードなど) のプロパティを示す属性です。</span><span class="sxs-lookup"><span data-stu-id="96a3a-103">Metaproperty attributes in an XML document are attributes that describe the properties of an XML item, such as element, attribute, or any other DOM node.</span></span> <span data-ttu-id="96a3a-104">これらの属性は、物理的に XML ドキュメントのテキスト内に存在するものではありません。</span><span class="sxs-lookup"><span data-stu-id="96a3a-104">These attributes do not physically exist in the XML document text.</span></span> <span data-ttu-id="96a3a-105">ただし、OPENXML では、すべての XML アイテムに、これらのメタプロパティが提供されます。</span><span class="sxs-lookup"><span data-stu-id="96a3a-105">However, OPENXML provides these metaproperties for all the XML items.</span></span> <span data-ttu-id="96a3a-106">これらのメタプロパティを使用すると、XML ノードの情報 (ローカルの位置や名前空間の情報など) を抽出できます。</span><span class="sxs-lookup"><span data-stu-id="96a3a-106">These metaproperties allow you to extract information, such as local positioning and namespace information, of XML nodes.</span></span> <span data-ttu-id="96a3a-107">これらの情報からは、テキストで表現されている情報よりも詳細な情報を得られます。</span><span class="sxs-lookup"><span data-stu-id="96a3a-107">This information provides you with more details than are apparent in the textual representation.</span></span>  
  
 <span data-ttu-id="96a3a-108">これらのメタプロパティは、 *ColPattern* パラメーターを使用して OPENXML ステートメント内の行セットの列にマップできます。</span><span class="sxs-lookup"><span data-stu-id="96a3a-108">You can map these metaproperties to the rowset columns in an OPENXML statement by using the *ColPattern* parameter.</span></span> <span data-ttu-id="96a3a-109">これらの列には、その列がマップされたメタプロパティの値が含まれます。</span><span class="sxs-lookup"><span data-stu-id="96a3a-109">The columns will contain the values of the metaproperties to which they are mapped.</span></span> <span data-ttu-id="96a3a-110">OPENXML の構文の詳細については、 [OPENXML &#40;Transact-SQL&#41;](/sql/t-sql/functions/openxml-transact-sql)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="96a3a-110">For more information about the syntax of OPENXML, see [OPENXML &#40;Transact-SQL&#41;](/sql/t-sql/functions/openxml-transact-sql).</span></span>  
  
 <span data-ttu-id="96a3a-111">これらのメタプロパティ属性にアクセスするために、SQL Server 固有の名前空間が提供されています。</span><span class="sxs-lookup"><span data-stu-id="96a3a-111">To access the metaproperty attributes, a namespace that is specific to SQL Server is provided.</span></span> <span data-ttu-id="96a3a-112">ユーザーは、この名前空間 **urn:schemas-microsoft-com:xml-metaprop** を使用して、メタプロパティ属性にアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="96a3a-112">This namespace, **urn:schemas-microsoft-com:xml-metaprop** allows the user to access the metaproperty attributes.</span></span> <span data-ttu-id="96a3a-113">OPENXML クエリの結果がエッジ テーブル形式で返される場合、そのエッジ テーブルには、 **xmltext** メタプロパティ以外のメタプロパティ属性ごとに 1 つの列が含まれます。</span><span class="sxs-lookup"><span data-stu-id="96a3a-113">If the result of an OPENXML query is returned in an edge table format, the edge table contains one column for each metaproperty attribute, except the **xmltext** metaproperty.</span></span>  
  
 <span data-ttu-id="96a3a-114">一部のメタプロパティ属性は、処理の目的で使用されます。</span><span class="sxs-lookup"><span data-stu-id="96a3a-114">Some of the metaproperty attributes are used for processing purposes.</span></span> <span data-ttu-id="96a3a-115">たとえば **xmltext** メタプロパティ属性は、オーバーフロー処理のために使用されます。</span><span class="sxs-lookup"><span data-stu-id="96a3a-115">For example, the **xmltext** metaproperty attribute is used for overflow handling.</span></span> <span data-ttu-id="96a3a-116">オーバーフロー処理では、ドキュメントに含まれる未使用および未処理データを参照します。</span><span class="sxs-lookup"><span data-stu-id="96a3a-116">Overflow handling refers to the unconsumed, unprocessed data in the document.</span></span> <span data-ttu-id="96a3a-117">OPENXML によって生成された行セット内の列の 1 つは、オーバーフロー列として識別されるようにすることができます。</span><span class="sxs-lookup"><span data-stu-id="96a3a-117">One of the columns in the rowset that is generated by OPENXML can be identified as the overflow column.</span></span> <span data-ttu-id="96a3a-118">ある列がオーバーフロー列として識別されるようにするには、 **ColPattern** パラメーターを使用して、この列を *xmltext* メタプロパティにマップします。</span><span class="sxs-lookup"><span data-stu-id="96a3a-118">You do this by mapping it to the **xmltext** metaproperty by using the *ColPattern* parameter.</span></span> <span data-ttu-id="96a3a-119">このマッピングを行うと、列はオーバーフロー データを受け取ります。</span><span class="sxs-lookup"><span data-stu-id="96a3a-119">The column then receives the overflow data.</span></span> <span data-ttu-id="96a3a-120">列に含まれるのが未使用データだけなのかすべてのデータなのかは *flags* パラメーターによって判断します。</span><span class="sxs-lookup"><span data-stu-id="96a3a-120">The *flags* parameter determines whether the column contains everything or only the unconsumed data.</span></span>  
  
 <span data-ttu-id="96a3a-121">次の表に、解析されたそれぞれの XML 要素が所有するメタプロパティ属性を示します。</span><span class="sxs-lookup"><span data-stu-id="96a3a-121">The following table lists the metaproperty attributes that each parsed XML element possesses.</span></span> <span data-ttu-id="96a3a-122">これらのメタプロパティ属性には、名前空間 **urn:schemas-microsoft-com:xml-metaprop**を使用してアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="96a3a-122">These metaproperty attributes can be accessed by using the namespace **urn:schemas-microsoft-com:xml-metaprop**.</span></span> <span data-ttu-id="96a3a-123">ただし、ユーザーがこれらのメタプロパティを使用して XML ドキュメントに直接設定した値は無視されます。</span><span class="sxs-lookup"><span data-stu-id="96a3a-123">Any value that the user sets directly in the XML document by using these metaproperties is ignored.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="96a3a-124">これらのメタプロパティは、XPath による位置指定では参照できません。</span><span class="sxs-lookup"><span data-stu-id="96a3a-124">You cannot reference these metaproperties in any XPath navigation.</span></span>  
  
|<span data-ttu-id="96a3a-125">メタプロパティ属性</span><span class="sxs-lookup"><span data-stu-id="96a3a-125">Metaproperty attribute</span></span>|<span data-ttu-id="96a3a-126">説明</span><span class="sxs-lookup"><span data-stu-id="96a3a-126">Description</span></span>|  
|----------------------------|-----------------|  
|<span data-ttu-id="96a3a-127">**\@mp:id**</span><span class="sxs-lookup"><span data-stu-id="96a3a-127">**\@mp:id**</span></span>|<span data-ttu-id="96a3a-128">DOM ノードに対して、システムによって生成されたドキュメント レベルの識別子を提供します。</span><span class="sxs-lookup"><span data-stu-id="96a3a-128">Provides a system-generated, document-wide identifier of the DOM node.</span></span> <span data-ttu-id="96a3a-129">この ID は、ドキュメントが再解析されない限り、同じ XML ノードを参照します。</span><span class="sxs-lookup"><span data-stu-id="96a3a-129">As long as the document is not reparsed, this ID refers to the same XML node.</span></span><br /><br /> <span data-ttu-id="96a3a-130">XML ID が **0** の場合、その要素はルート要素です。</span><span class="sxs-lookup"><span data-stu-id="96a3a-130">An XML ID of **0** indicates that the element is a root element.</span></span> <span data-ttu-id="96a3a-131">その親要素の XML ID は NULL になります。</span><span class="sxs-lookup"><span data-stu-id="96a3a-131">Its parent XML ID is NULL.</span></span>|  
|<span data-ttu-id="96a3a-132">**\@mp:localname**</span><span class="sxs-lookup"><span data-stu-id="96a3a-132">**\@mp:localname**</span></span>|<span data-ttu-id="96a3a-133">ノードの名前のローカル部分を格納します。</span><span class="sxs-lookup"><span data-stu-id="96a3a-133">Stores the local part of the name of the node.</span></span> <span data-ttu-id="96a3a-134">要素ノードや属性ノードの名前付けの際に、プレフィックスおよび名前空間 URI と共に使用します。</span><span class="sxs-lookup"><span data-stu-id="96a3a-134">It is used with a prefix and a namespace URI to name element or attribute nodes.</span></span>|  
|<span data-ttu-id="96a3a-135">**\@mp:namespaceuri**</span><span class="sxs-lookup"><span data-stu-id="96a3a-135">**\@mp:namespaceuri**</span></span>|<span data-ttu-id="96a3a-136">現在の要素の名前空間 URI を指定します。</span><span class="sxs-lookup"><span data-stu-id="96a3a-136">Provides the namespace URI of the current element.</span></span> <span data-ttu-id="96a3a-137">この属性の値が NULL の場合は、名前空間がありません。</span><span class="sxs-lookup"><span data-stu-id="96a3a-137">If the value of this attribute is NULL, no namespace is present</span></span>|  
|<span data-ttu-id="96a3a-138">**\@mp:prefix**</span><span class="sxs-lookup"><span data-stu-id="96a3a-138">**\@mp:prefix**</span></span>|<span data-ttu-id="96a3a-139">現在の要素名の名前空間プレフィックスを格納します。</span><span class="sxs-lookup"><span data-stu-id="96a3a-139">Stores the namespace prefix of the current element name.</span></span><br /><br /> <span data-ttu-id="96a3a-140">プレフィックスがなくて (NULL) URI が指定されている場合は、指定された名前空間が既定の名前空間であることを示します。</span><span class="sxs-lookup"><span data-stu-id="96a3a-140">If no prefix is present (NULL) and a URI is given, it indicates that the specified namespace is the default namespace.</span></span> <span data-ttu-id="96a3a-141">URI が指定されていない場合は、名前空間が関連付けられていません。</span><span class="sxs-lookup"><span data-stu-id="96a3a-141">If no URI is given, no namespace is attached.</span></span>|  
|<span data-ttu-id="96a3a-142">**\@mp:prev**</span><span class="sxs-lookup"><span data-stu-id="96a3a-142">**\@mp:prev**</span></span>|<span data-ttu-id="96a3a-143">ノードよりも前の兄弟を格納します。</span><span class="sxs-lookup"><span data-stu-id="96a3a-143">Stores the previous sibling relative to a node.</span></span> <span data-ttu-id="96a3a-144">これにより、ドキュメント内の要素の順序に関する情報が得られます。</span><span class="sxs-lookup"><span data-stu-id="96a3a-144">This provides information about the ordering of elements in the document.</span></span><br /><br /> <span data-ttu-id="96a3a-145">**\@mp:prev** には、同じ親要素を持つ前の兄弟要素の XML ID が含まれます。</span><span class="sxs-lookup"><span data-stu-id="96a3a-145">**\@mp:prev** contains the XML ID of the previous sibling that has the same parent element.</span></span> <span data-ttu-id="96a3a-146">要素が兄弟リストの先頭にある場合、 **\@mp:prev** は NULL になります。</span><span class="sxs-lookup"><span data-stu-id="96a3a-146">If an element is at the front of the sibling list, **\@mp:prev** is NULL.</span></span>|  
|<span data-ttu-id="96a3a-147">**\@mp:xmltext**</span><span class="sxs-lookup"><span data-stu-id="96a3a-147">**\@mp:xmltext**</span></span>|<span data-ttu-id="96a3a-148">処理の目的で使用します。</span><span class="sxs-lookup"><span data-stu-id="96a3a-148">Used for processing purposes.</span></span> <span data-ttu-id="96a3a-149">OPENXML のオーバーフロー処理で使用したように、要素とその属性とサブ要素のテキストをシリアル化したものです。</span><span class="sxs-lookup"><span data-stu-id="96a3a-149">It is the textual serialization of the element and its attributes, and also the subelements, as used in the overflow handling of OPENXML.</span></span>|  
  
 <span data-ttu-id="96a3a-150">次の表には、用意されている追加の親プロパティを示します。これらのプロパティを使用すると、階層情報を取得できます。</span><span class="sxs-lookup"><span data-stu-id="96a3a-150">This table shows the additional parent properties that are provided and which allow you to retrieve information about the hierarchy.</span></span>  
  
|<span data-ttu-id="96a3a-151">親メタプロパティ属性</span><span class="sxs-lookup"><span data-stu-id="96a3a-151">Parent metaproperty attribute</span></span>|<span data-ttu-id="96a3a-152">説明</span><span class="sxs-lookup"><span data-stu-id="96a3a-152">Description</span></span>|  
|-----------------------------------|-----------------|  
|<span data-ttu-id="96a3a-153">**\@mp:parentid**</span><span class="sxs-lookup"><span data-stu-id="96a3a-153">**\@mp:parentid**</span></span>|<span data-ttu-id="96a3a-154">**../\@mp:id** と対応します。</span><span class="sxs-lookup"><span data-stu-id="96a3a-154">Corresponds to **../\@mp:id**</span></span>|  
|<span data-ttu-id="96a3a-155">**\@mp:parentlocalname**</span><span class="sxs-lookup"><span data-stu-id="96a3a-155">**\@mp:parentlocalname**</span></span>|<span data-ttu-id="96a3a-156">**../\@mp:localname** と対応します。</span><span class="sxs-lookup"><span data-stu-id="96a3a-156">Corresponds to **../\@mp:localname**</span></span>|  
|<span data-ttu-id="96a3a-157">**\@mp:parentnamespacerui**</span><span class="sxs-lookup"><span data-stu-id="96a3a-157">**\@mp:parentnamespacerui**</span></span>|<span data-ttu-id="96a3a-158">**../\@mp:namespaceuri** と対応します。</span><span class="sxs-lookup"><span data-stu-id="96a3a-158">Corresponds to **../\@mp:namespaceuri**</span></span>|  
|<span data-ttu-id="96a3a-159">**\@mp:parentprefix**</span><span class="sxs-lookup"><span data-stu-id="96a3a-159">**\@mp:parentprefix**</span></span>|<span data-ttu-id="96a3a-160">**../\@mp:prefix** と対応します。</span><span class="sxs-lookup"><span data-stu-id="96a3a-160">Corresponds to **../\@mp:prefix**</span></span>|  
  
## <a name="examples"></a><span data-ttu-id="96a3a-161">例</span><span class="sxs-lookup"><span data-stu-id="96a3a-161">Examples</span></span>  
 <span data-ttu-id="96a3a-162">次に、OPENXML を使用してさまざまな行セット ビューを作成する方法の例を示します。</span><span class="sxs-lookup"><span data-stu-id="96a3a-162">The following examples illustrate how OPENXML is used to create different rowset views.</span></span>  
  
### <a name="a-mapping-the-openxml-rowset-columns-to-the-metaproperties"></a><span data-ttu-id="96a3a-163">A.</span><span class="sxs-lookup"><span data-stu-id="96a3a-163">A.</span></span> <span data-ttu-id="96a3a-164">OPENXML 行セット列のメタプロパティへのマップ</span><span class="sxs-lookup"><span data-stu-id="96a3a-164">Mapping the OPENXML rowset columns to the metaproperties</span></span>  
 <span data-ttu-id="96a3a-165">この例では、OPENXML を使用して、サンプルの XML ドキュメントの行セット ビューを作成します。</span><span class="sxs-lookup"><span data-stu-id="96a3a-165">This example uses OPENXML to create a rowset view of the sample XML document.</span></span> <span data-ttu-id="96a3a-166">具体的には、 *ColPattern* パラメーターを使用して、OPENXML ステートメントで各種のメタプロパティ属性を行セットの列にマップする方法を示します。</span><span class="sxs-lookup"><span data-stu-id="96a3a-166">Specifically, it shows how the various metaproperty attributes can be mapped to rowset columns in an OPENXML statement by using the *ColPattern* parameter.</span></span>  
  
 <span data-ttu-id="96a3a-167">この OPENXML ステートメントは、次のことを表します。</span><span class="sxs-lookup"><span data-stu-id="96a3a-167">The OPENXML statement illustrates the following:</span></span>  
  
-   <span data-ttu-id="96a3a-168">**id** 列が **\@mp:id** メタプロパティ属性にマップされます。また、システムによって生成された要素の一意な XML ID がこの列に含まれることを示しています。</span><span class="sxs-lookup"><span data-stu-id="96a3a-168">The **id** column is mapped to the **\@mp:id** metaproperty attribute and indicates that the column contains the system-generated unique XML ID of the element.</span></span>  
  
-   <span data-ttu-id="96a3a-169">**parent** 列が **\@mp:parentid** にマップされます。また、要素の親要素の XML ID がこの列に含まれることを示しています。</span><span class="sxs-lookup"><span data-stu-id="96a3a-169">The **parent** column is mapped to **\@mp:parentid** and indicates that the column contains the XML ID of the parent of the element.</span></span>  
  
-   <span data-ttu-id="96a3a-170">**parentLocalName** 列が **\@mp:parentlocalname** にマップされます。また、親のローカル名がこの列に含まれることを示しています。</span><span class="sxs-lookup"><span data-stu-id="96a3a-170">The **parentLocalName** column is mapped to **\@mp:parentlocalname** and indicates that the column contains the local name of the parent.</span></span>  
  
 <span data-ttu-id="96a3a-171">SELECT ステートメントは OPENXML で提供された行セットを返します。</span><span class="sxs-lookup"><span data-stu-id="96a3a-171">The SELECT statement then returns the rowset that is provided by OPENXML:</span></span>  
  
```  
DECLARE @idoc int  
DECLARE @doc nvarchar(1000)  
-- Sample XML document  
SET @doc = N'<root>  
  <Customer cid= "C1" name="Janine" city="Issaquah">  
      <Order oid="O1" date="1/20/1996" amount="3.5" />  
      <Order oid="O2" date="4/30/1997" amount="13.4">Customer was very satisfied</Order>  
   </Customer>  
   <Customer cid="C2" name="Ursula" city="Oelde" >  
      <Order oid="O3" date="7/14/1999" amount="100" note="Wrap it blue white red">  
          <Urgency>Important</Urgency>  
      </Order>  
      <Order oid="O4" date="1/20/1996" amount="10000"/>  
   </Customer>  
</root>'  
-- Create an internal representation of the XML document.  
EXEC sp_xml_preparedocument @idoc OUTPUT, @doc  
  
-- Execute a SELECT statement using OPENXML rowset provider.  
SELECT *  
FROM OPENXML (@idoc, '/root/Customer/Order', 9)  
      WITH (id int '@mp:id',   
            oid char(5),   
            date datetime,   
            amount real,   
            parentIDNo int '@mp:parentid',   
            parentLocalName varchar(40) '@mp:parentlocalname')  
EXEC sp_xml_removedocument @idoc  
```  
  
 <span data-ttu-id="96a3a-172">結果を次に示します。</span><span class="sxs-lookup"><span data-stu-id="96a3a-172">This is the result:</span></span>  
  
```  
id   oid         date                amount    parentIDNo  parentLocalName    
--- ------- ---------------------- ---------- ------------ ---------------  
6    O1    1996-01-20 00:00:00.000     3.5         2        Customer  
10   O2    1997-04-30 00:00:00.000     13.4        2        Customer  
19   O3    1999-07-14 00:00:00.000     100.0       15       Customer  
25   O4    1996-01-20 00:00:00.000     10000.0     15       Customer  
```  
  
### <a name="b-retrieving-the-whole-xml-document"></a><span data-ttu-id="96a3a-173">B.</span><span class="sxs-lookup"><span data-stu-id="96a3a-173">B.</span></span> <span data-ttu-id="96a3a-174">XML ドキュメント全体の取得</span><span class="sxs-lookup"><span data-stu-id="96a3a-174">Retrieving the whole XML document</span></span>  
 <span data-ttu-id="96a3a-175">この例では、OPENXML を使用して、サンプルの XML ドキュメントの 1 列の行セット ビューが作成されます。</span><span class="sxs-lookup"><span data-stu-id="96a3a-175">In this example, OPENXML is used to create a one-column rowset view of the sample XML document.</span></span> <span data-ttu-id="96a3a-176">この列 ( **Col1**) は **xmltext** メタプロパティにマップされ、オーバーフロー列になります。</span><span class="sxs-lookup"><span data-stu-id="96a3a-176">This column, **Col1**, is mapped to the **xmltext** metaproperty and becomes an overflow column.</span></span> <span data-ttu-id="96a3a-177">そのため、この列は未使用データを受け取ります。</span><span class="sxs-lookup"><span data-stu-id="96a3a-177">As a result, the column receives the unconsumed data.</span></span> <span data-ttu-id="96a3a-178">この例の場合、この列には、ドキュメント全体が格納されます。</span><span class="sxs-lookup"><span data-stu-id="96a3a-178">In this case, it is the whole document.</span></span>  
  
 <span data-ttu-id="96a3a-179">SELECT ステートメントは行セット全体を返します。</span><span class="sxs-lookup"><span data-stu-id="96a3a-179">The SELECT statement then returns the complete rowset.</span></span>  
  
```  
DECLARE @idoc int  
DECLARE @doc nvarchar(1000)  
SET @doc = N'<?xml version="1.0"?>  
<root>  
  <Customer cid= "C1" name="Janine" city="Issaquah">  
      <Order oid="O1" date="1/20/1996" amount="3.5" />  
      <Order oid="O2" date="4/30/1997" amount="13.4">Customer was very   
             satisfied</Order>  
   </Customer>  
   <Customer cid="C2" name="Ursula" city="Oelde" >  
      <Order oid="O3" date="7/14/1999" amount="100" note="Wrap it blue   
             white red">  
     <MyTag>Testing to see if all the subelements are returned</MyTag>  
          <Urgency>Important</Urgency>  
      </Order>  
      <Order oid="O4" date="1/20/1996" amount="10000"/>  
   </Customer>  
</root>'  
-- Create an internal representation of the XML document.  
EXEC sp_xml_preparedocument @idoc OUTPUT, @doc  
  
-- Execute a SELECT statement using OPENXML rowset provider.  
SELECT *  
FROM OPENXML (@idoc, '/')  
   WITH (Col1 ntext '@mp:xmltext')  
```  
  
 <span data-ttu-id="96a3a-180">XML 宣言を使用しないでドキュメント全体を取得するには、クエリを次のように指定します。</span><span class="sxs-lookup"><span data-stu-id="96a3a-180">To retrieve the whole document without the XML declaration, the query can be specified as shown in the following:</span></span>  
  
```  
SELECT *  
FROM OPENXML (@idoc, '/root')  
   WITH (Col1 ntext '@mp:xmltext')  
EXEC sp_xml_removedocument @idoc  
```  
  
 <span data-ttu-id="96a3a-181">クエリはルート要素を返し、これには名前のルートおよびルート要素に含まれるデータが含まれます。</span><span class="sxs-lookup"><span data-stu-id="96a3a-181">The query returns the root element that has the name root and the data that is contained by the root element</span></span>  
  
### <a name="c-specifying-the-xmltext-metaproperty-to-retrieve-the-unconsumed-data-in-a-column"></a><span data-ttu-id="96a3a-182">C.</span><span class="sxs-lookup"><span data-stu-id="96a3a-182">C.</span></span> <span data-ttu-id="96a3a-183">xmltext メタプロパティの指定による列内の未使用データの取得</span><span class="sxs-lookup"><span data-stu-id="96a3a-183">Specifying the xmltext metaproperty to retrieve the unconsumed data in a column</span></span>  
 <span data-ttu-id="96a3a-184">この例では、OPENXML を使用して、サンプルの XML ドキュメントの行セット ビューを作成します。</span><span class="sxs-lookup"><span data-stu-id="96a3a-184">This example uses OPENXML to create a rowset view of the sample XML document.</span></span> <span data-ttu-id="96a3a-185">この例では、OPENXML 内の行セットの列に **xmltext** メタプロパティ属性をマップすることによって、未使用の XML データを取得する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="96a3a-185">The example shows how to retrieve unconsumed XML data by mapping the **xmltext** metaproperty attribute to a rowset column in OPENXML.</span></span>  
  
 <span data-ttu-id="96a3a-186">**comment** 列は、 **\@mp:xmltext** メタプロパティにマップすることによって、オーバーフロー列として識別されます。</span><span class="sxs-lookup"><span data-stu-id="96a3a-186">The **comment** column is identified as the overflow column by mapping it to the **\@mp:xmltext** metaproperty.</span></span> <span data-ttu-id="96a3a-187">*flags* パラメーターは **9** (XML_ATTRIBUTE and XML_NOCOPY) に設定されています。</span><span class="sxs-lookup"><span data-stu-id="96a3a-187">The *flags* parameter is set to **9** (XML_ATTRIBUTE and XML_NOCOPY).</span></span> <span data-ttu-id="96a3a-188">この設定は、 **属性中心** のマッピングであり、未使用データのみがオーバーフロー列にコピーされることを示しています。</span><span class="sxs-lookup"><span data-stu-id="96a3a-188">This indicates **attribute-centric** mapping and indicates that only the unconsumed data should be copied to the overflow column.</span></span>  
  
 <span data-ttu-id="96a3a-189">SELECT ステートメントは OPENXML で提供される行セットを返します。</span><span class="sxs-lookup"><span data-stu-id="96a3a-189">The SELECT statement then returns the rowset provided by OPENXML.</span></span>  
  
 <span data-ttu-id="96a3a-190">この例では、OPENXML によって生成された行セット内の列 (**ParentLocalName**) に対して **\@mp:parentlocalname** メタプロパティが設定されます。</span><span class="sxs-lookup"><span data-stu-id="96a3a-190">In this example, the **\@mp:parentlocalname** metaproperty is set for a column, **ParentLocalName**, in the rowset generated by OPENXML.</span></span> <span data-ttu-id="96a3a-191">その結果、この列には親要素のローカル名が含まれます。</span><span class="sxs-lookup"><span data-stu-id="96a3a-191">As a result, this column contains the local name of the parent element.</span></span>  
  
 <span data-ttu-id="96a3a-192">行セットには他に 2 つの列 ( **parent** と **comment**) が指定されています。</span><span class="sxs-lookup"><span data-stu-id="96a3a-192">Two additional columns are specified in the rowset, **parent** and **comment**.</span></span> <span data-ttu-id="96a3a-193">**parent** 列は **\@mp:parentid** にマップされ、この列に、要素の親要素の XML ID が含まれることを示します。</span><span class="sxs-lookup"><span data-stu-id="96a3a-193">The **parent** column is mapped to **\@mp:parentid** and indicates that the column contains the XML ID of the parent element of the element.</span></span> <span data-ttu-id="96a3a-194">comment 列は、 **\@mp:xmltext** メタプロパティにマップすることによって、オーバーフロー列として識別されます。</span><span class="sxs-lookup"><span data-stu-id="96a3a-194">The comment column is identified as the overflow column by mapping it to the **\@mp:xmltext** metaproperty.</span></span>  
  
```  
DECLARE @idoc int  
DECLARE @doc nvarchar(1000)  
-- sample XML document  
SET @doc = N'<root>  
  <Customer cid= "C1" name="Janine" city="Issaquah">  
      <Order oid="O1" date="1/20/1996" amount="3.5" />  
      <Order oid="O2" date="4/30/1997" amount="13.4">Customer was very satisfied</Order>  
   </Customer>  
   <Customer cid="C2" name="Ursula" city="Oelde" >  
      <Order oid="O3" date="7/14/1999" amount="100" note="Wrap it blue white red">  
          <Urgency>Important</Urgency>  
      </Order>  
      <Order oid="O4" date="1/20/1996" amount="10000"/>  
   </Customer>  
</root>  
'  
-- Create an internal representation of the XML document.  
EXEC sp_xml_preparedocument @idoc OUTPUT, @doc  
  
-- Execute a SELECT statement using OPENXML rowset provider.  
SELECT *  
FROM OPENXML (@idoc, '/root/Customer/Order', 9)  
      WITH (oid char(5),   
            date datetime,  
            comment ntext '@mp:xmltext')  
EXEC sp_xml_removedocument @idoc  
```  
  
 <span data-ttu-id="96a3a-195">結果は次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="96a3a-195">This is the result.</span></span> <span data-ttu-id="96a3a-196">oid 列と date 列は既に使用されているので、それらはオーバーフロー列には表示されません。</span><span class="sxs-lookup"><span data-stu-id="96a3a-196">Because the oid columns and date columns are already consumed, they do not appear in the overflow column.</span></span>  
  
```  
oid   date                        comment                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
----- --------------------------- ----------------------------------------  
O1    1996-01-20 00:00:00.000     <Order amount="3.5"/>  
O2    1997-04-30 00:00:00.000     <Order amount="13.4">Customer was very   
                                   satisfied</Order>  
O3    1999-07-14 00:00:00.000     <Order amount="100" note="Wrap it blue   
                                   white red"><Urgency>   
                                   Important</Urgency></Order>  
O4    1996-01-20 00:00:00.000     <Order amount="10000"/>  
```  
  
## <a name="see-also"></a><span data-ttu-id="96a3a-197">参照</span><span class="sxs-lookup"><span data-stu-id="96a3a-197">See Also</span></span>  
 <span data-ttu-id="96a3a-198">[OPENXML &#40;Transact-SQL&#41;](/sql/t-sql/functions/openxml-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="96a3a-198">[OPENXML &#40;Transact-SQL&#41;](/sql/t-sql/functions/openxml-transact-sql) </span></span>  
 [<span data-ttu-id="96a3a-199">OPENXML &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="96a3a-199">OPENXML &#40;SQL Server&#41;</span></span>](../xml/openxml-sql-server.md)  
  
  
