---
title: '例 : AUTO モードの使用 | Microsoft Docs'
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: xml
ms.topic: conceptual
helpviewer_keywords:
- AUTO FOR XML mode, examples
ms.assetid: 11e8d0e4-df8a-46f8-aa21-9602d4f26cad
author: rothja
ms.author: jroth
ms.openlocfilehash: b457bca6b7c25b9822e3dab2eba5f5cdb04b83e6
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87631682"
---
# <a name="examples-using-auto-mode"></a><span data-ttu-id="11a10-102">例 :AUTO モードの使用</span><span class="sxs-lookup"><span data-stu-id="11a10-102">Examples: Using AUTO Mode</span></span>
  <span data-ttu-id="11a10-103">次の例では、AUTO モードの使用方法を示します。</span><span class="sxs-lookup"><span data-stu-id="11a10-103">The following examples illustrate the use of AUTO mode.</span></span> <span data-ttu-id="11a10-104">クエリの多くは、 [!INCLUDE[ssSampleDBnormal](../../includes/sssampledbnormal-md.md)] サンプル データベースの ProductModel テーブルの Instructions 列に格納されている、自転車の製造手順の XML ドキュメントに対して指定されています。</span><span class="sxs-lookup"><span data-stu-id="11a10-104">Many of these queries are specified against bicycle manufacturing instructions XML documents that are stored in the Instructions column of the ProductModel table in the [!INCLUDE[ssSampleDBnormal](../../includes/sssampledbnormal-md.md)] sample database.</span></span>  
  
## <a name="example-retrieving-customer-order-and-order-detail-information"></a><span data-ttu-id="11a10-105">例: 顧客情報、注文情報、および注文明細情報の取得</span><span class="sxs-lookup"><span data-stu-id="11a10-105">Example: Retrieving customer, order, and order detail information</span></span>  
 <span data-ttu-id="11a10-106">このクエリでは、特定の顧客の顧客情報、注文情報、および注文明細情報を取得しています。</span><span class="sxs-lookup"><span data-stu-id="11a10-106">This query retrieves customer, order, and order detail information for a specific customer.</span></span>  
  
```  
USE AdventureWorks2012;  
GO  
SELECT Cust.CustomerID,   
       OrderHeader.CustomerID,  
       OrderHeader.SalesOrderID,   
       Detail.SalesOrderID, Detail.LineTotal, Detail.ProductID,   
       Product.Name,  
       Detail.OrderQty  
FROM Sales.Customer AS Cust  
INNER JOIN Sales.SalesOrderHeader AS OrderHeader   
    ON Cust.CustomerID = OrderHeader.CustomerID  
INNER JOIN Sales.SalesOrderDetail AS Detail  
    ON OrderHeader.SalesOrderID = Detail.SalesOrderID  
INNER JOIN Production.Product AS Product  
    ON Product.ProductID = Detail.ProductID  
WHERE Cust.CustomerID IN (29672, 29734)  
ORDER BY OrderHeader.CustomerID,  
         OrderHeader.SalesOrderID  
FOR XML AUTO;  
```  
  
 <span data-ttu-id="11a10-107">クエリでは `Cust`テーブル、 `OrderHeader`テーブル、 `Detail`テーブル、および `Product` テーブルの別名が識別されるので、 `AUTO` モードにより対応する要素が生成されます。</span><span class="sxs-lookup"><span data-stu-id="11a10-107">Because the query identifies, `Cust`, `OrderHeader`, `Detail`, and `Product` table aliases, corresponding elements are generated by the `AUTO` mode.</span></span> <span data-ttu-id="11a10-108">さらに、 `SELECT` 句で指定した列でテーブルが識別される順序に基づいて、これらの要素の階層が決定されます。</span><span class="sxs-lookup"><span data-stu-id="11a10-108">Again, the order in which tables are identified by the columns specified in the `SELECT` clause determine the hierarchy of these elements.</span></span>  
  
 <span data-ttu-id="11a10-109">次に結果の一部を示します。</span><span class="sxs-lookup"><span data-stu-id="11a10-109">This is the partial result.</span></span>  
  
 `<Cust CustomerID="29672">`  
  
 `<OrderHeader CustomerID="29672" SalesOrderID="43660">`  
  
 `<Detail SalesOrderID="43660" LineTotal="874.794000" ProductID="758" OrderQty="1">`  
  
 `<Product Name="Road-450 Red, 52" />`  
  
 `</Detail>`  
  
 `<Detail SalesOrderID="43660" LineTotal="419.458900" ProductID="762" OrderQty="1">`  
  
 `<Product Name="Road-650 Red, 44" />`  
  
 `</Detail>`  
  
 `</OrderHeader>`  
  
 `<OrderHeader CustomerID="29672" SalesOrderID="47660">`  
  
 `<Detail SalesOrderID="47660" LineTotal="469.794000" ProductID="765" OrderQty="1">`  
  
 `<Product Name="Road-650 Black, 58" />`  
  
 `</Detail>`  
  
 `</OrderHeader>`  
  
 `<OrderHeader CustomerID="29672" SalesOrderID="49857">`  
  
 `<Detail SalesOrderID="49857" LineTotal="44.994000" ProductID="852" OrderQty="1">`  
  
 `<Product Name="Women's Tights, S" />`  
  
 `</Detail>`  
  
 `</OrderHeader>`  
  
 `...`  
  
 `</Cust>`  
  
## <a name="example-specifying-group-by-and-aggregate-functions"></a><span data-ttu-id="11a10-110">例: GROUP BY と集計関数の指定</span><span class="sxs-lookup"><span data-stu-id="11a10-110">Example: Specifying GROUP BY and aggregate functions</span></span>  
 <span data-ttu-id="11a10-111">次のクエリにより、各顧客の ID と顧客が要求した注文数が返されます。</span><span class="sxs-lookup"><span data-stu-id="11a10-111">The following query returns individual customer IDs and the number of orders that the customer has requested.</span></span>  
  
```  
USE AdventureWorks2012;  
GO  
SELECT C.CustomerID, COUNT(*) AS NoOfOrders  
FROM Sales.Customer AS C  
INNER JOIN Sales.SalesOrderHeader AS SOH  
On C.CustomerID = SOH.CustomerID  
GROUP BY C.CustomerID  
FOR XML AUTO;This is the partial result:  
```  
  
 `<I CustomerID="11000" NoOfOrders="3" />`  
  
 `<I CustomerID="11001" NoOfOrders="3" />`  
  
 `...`  
  
## <a name="example-specifying-computed-columns-in-auto-mode"></a><span data-ttu-id="11a10-112">例: AUTO モードでの計算列の指定</span><span class="sxs-lookup"><span data-stu-id="11a10-112">Example: Specifying computed columns in AUTO mode</span></span>  
 <span data-ttu-id="11a10-113">このクエリでは、各顧客の連結された名前と注文情報が返されます。</span><span class="sxs-lookup"><span data-stu-id="11a10-113">This query returns concatenated individual customer names and the order information.</span></span> <span data-ttu-id="11a10-114">計算列はその時点で見つかった最も内側のレベルに割り当てられるので、この例では <`SOH`> 要素に割り当てられます。</span><span class="sxs-lookup"><span data-stu-id="11a10-114">Because the computed column is assigned to the innermost level encountered at that point, the <`SOH`> element in this example.</span></span> <span data-ttu-id="11a10-115">連結された顧客名は、<`SOH`> 要素の属性として結果に追加されます。</span><span class="sxs-lookup"><span data-stu-id="11a10-115">The concatenated customer names are added as attributes of the <`SOH`> element in the result.</span></span>  
  
```  
USE AdventureWorks2012;  
GO  
SELECT P.FirstName + ' ' + P.LastName AS Name,  
       SOH.SalesOrderID  
FROM Sales.Customer AS C  
INNER JOIN Sales.SalesOrderHeader AS SOH  
    ON  C.CustomerID = SOH.CustomerID  
INNER JOIN Person.Person AS P  
    ON P.BusinessEntityID = C.PersonID  
FOR XML AUTO;  
```  
  
 <span data-ttu-id="11a10-116">結果の一部を次に示します。</span><span class="sxs-lookup"><span data-stu-id="11a10-116">This is the partial result:</span></span>  
  
```  
<SOH Name="Jon Yang" SalesOrderID="43793" />  
<SOH Name="Eugene Huang" SalesOrderID="43767" />  
```  
  
 <span data-ttu-id="11a10-117">サブ要素としてそれぞれの販売注文ヘッダー情報を含む `Name` 属性を持つ <`IndividualCustomer`> 要素を取得するには、サブ選択を使用してクエリを書き直します。</span><span class="sxs-lookup"><span data-stu-id="11a10-117">To retrieve the <`IndividualCustomer`> elements having the `Name` attribute that contains each sales order header information as a subelement, the query is rewritten using a sub select.</span></span> <span data-ttu-id="11a10-118">内部選択により、 `IndividualCustomer` 一時テーブルが作成されます。このテーブルには、各顧客の名前を含む計算列があります。</span><span class="sxs-lookup"><span data-stu-id="11a10-118">The inner select creates a temporary `IndividualCustomer` table with the computed column that contains the names of the individual customers.</span></span> <span data-ttu-id="11a10-119">次に、このテーブルを `SalesOrderHeader` テーブルに結合して、結果を取得します。</span><span class="sxs-lookup"><span data-stu-id="11a10-119">This table is then joined to the `SalesOrderHeader` table to obtain the result.</span></span>  
  
 <span data-ttu-id="11a10-120">`Sales.Customer` テーブルには、顧客の `PersonID` 値など、各顧客の情報が格納されていることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="11a10-120">Note that the `Sales.Customer` table stores individual customer information, including the `PersonID` value for that customer.</span></span> <span data-ttu-id="11a10-121">次に、 `PersonID` を使用して `Person.Person` テーブルから連絡担当者名を見つけます。</span><span class="sxs-lookup"><span data-stu-id="11a10-121">This `PersonID` is then used to find the contact name from the `Person.Person` table.</span></span>  
  
```  
SELECT IndividualCustomer.Name, SOH.SalesOrderID  
FROM (SELECT FirstName+ ' '+LastName AS Name, C.PersonID, C.CustomerID  
      FROM Sales.Customer AS C, Person.Person AS P  
      WHERE C.PersonID = P.BusinessEntityID) AS IndividualCustomer  
LEFT OUTER JOIN  Sales.SalesOrderHeader AS SOH  
   ON IndividualCustomer.CustomerID = SOH.CustomerID  
ORDER BY IndividualCustomer.CustomerID, SOH.CustomerIDFOR XML AUTO;  
```  
  
 <span data-ttu-id="11a10-122">結果の一部を次に示します。</span><span class="sxs-lookup"><span data-stu-id="11a10-122">This is the partial result:</span></span>  
  
 `<IndividualCustomer Name="Jon Yang">`  
  
 `<SOH SalesOrderID="43793" />`  
  
 `<SOH SalesOrderID="51522" />`  
  
 `<SOH SalesOrderID="57418" />`  
  
 `</IndividualCustomer>`  
  
 `...`  
  
 `...`  
  
## <a name="example-returning-binary-data"></a><span data-ttu-id="11a10-123">例: バイナリ データを返す</span><span class="sxs-lookup"><span data-stu-id="11a10-123">Example: Returning binary data</span></span>  
 <span data-ttu-id="11a10-124">次のクエリでは、 `ProductPhoto` テーブルから製品の写真が返されます。</span><span class="sxs-lookup"><span data-stu-id="11a10-124">This query returns a product photo from the `ProductPhoto` table.</span></span> <span data-ttu-id="11a10-125">`ThumbNailPhoto` は、`ProductPhoto` テーブルの `varbinary(max)` 列です。</span><span class="sxs-lookup"><span data-stu-id="11a10-125">`ThumbNailPhoto` is an `varbinary(max)` column in the `ProductPhoto` table.</span></span> <span data-ttu-id="11a10-126">既定では、 `AUTO` モードにより、バイナリ データへの参照、つまりクエリが実行されるデータベースの仮想ルートからの相対 URL が返されます。</span><span class="sxs-lookup"><span data-stu-id="11a10-126">By default, `AUTO` mode returns to the binary data a reference that is a relative URL to the virtual root of the database where the query is executed.</span></span> <span data-ttu-id="11a10-127">画像を識別するには、 `ProductPhotoID` キー属性を指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="11a10-127">The `ProductPhotoID` key attribute must be specified to identify the image.</span></span> <span data-ttu-id="11a10-128">この例で示すように、画像の参照を取得する場合、 `SELECT` 句でテーブルの主キーを指定して行を一意に識別する必要もあります。</span><span class="sxs-lookup"><span data-stu-id="11a10-128">In retrieving an image reference as illustrated in this example, the primary key of the table must also be specified in the `SELECT` clause to uniquely identify a row.</span></span>  
  
```  
SELECT ProductPhotoID, ThumbNailPhoto  
FROM   Production.ProductPhoto   
WHERE ProductPhotoID=70  
FOR XML AUTO;  
```  
  
 <span data-ttu-id="11a10-129">結果を次に示します。</span><span class="sxs-lookup"><span data-stu-id="11a10-129">This is the result:</span></span>  
  
 `-- result`  
  
 `<Production.ProductPhoto`  
  
 `ProductPhotoID="70"`  
  
 `ThumbNailPhoto= "dbobject/Production.ProductPhoto[@ProductPhotoID='70']/@ThumbNailPhoto" />`  
  
 <span data-ttu-id="11a10-130">`BINARY BASE64` オプションを使用して、同じクエリを実行します。</span><span class="sxs-lookup"><span data-stu-id="11a10-130">The same query is executed with the `BINARY BASE64` option.</span></span> <span data-ttu-id="11a10-131">このクエリでは、バイナリ データが base64 エンコード形式で返されます。</span><span class="sxs-lookup"><span data-stu-id="11a10-131">The query returns the binary data in base64-encoded format.</span></span>  
  
```  
SELECT ProductPhotoID, ThumbNailPhoto  
FROM   Production.ProductPhoto   
WHERE ProductPhotoID=70  
FOR XML AUTO, BINARY BASE64;  
```  
  
 <span data-ttu-id="11a10-132">結果を次に示します。</span><span class="sxs-lookup"><span data-stu-id="11a10-132">This is the result:</span></span>  
  
 `-- result`  
  
 `<Production.ProductPhoto ProductPhotoID="70" ThumbNailPhoto="Base64 encoded photo" />`  
  
 <span data-ttu-id="11a10-133">既定では、AUTO モードを使用してバイナリ データを取得すると、バイナリ データではなく、クエリが実行されたデータベースの仮想ルートからの相対 URL への参照が返されます。</span><span class="sxs-lookup"><span data-stu-id="11a10-133">By default, when you use AUTO mode to retrieve binary data, a reference to a relative URL to the virtual root of the database where the query was executed will be returned instead of the binary data.</span></span> <span data-ttu-id="11a10-134">BINARY BASE64 オプションを指定しないと、相対 URL への参照が返されます。</span><span class="sxs-lookup"><span data-stu-id="11a10-134">This will occur if the BINARY BASE64 option is not specified.</span></span>  
  
 <span data-ttu-id="11a10-135">大文字と小文字が区別されないデータベースでは、クエリで指定したテーブル名や列名がデータベース内のテーブル名や列名と一致しない場合でも、AUTO モードによりバイナリ データへの URL 参照が返されると、クエリが実行されます。</span><span class="sxs-lookup"><span data-stu-id="11a10-135">When AUTO mode returns a URL reference to the binary data in case-insensitive databases where a table or column name specified in the query does not match the table or column name in the database, the query executes.</span></span> <span data-ttu-id="11a10-136">ただし、参照として返される文字列が大文字であるか小文字であるかは一貫性がありません。</span><span class="sxs-lookup"><span data-stu-id="11a10-136">However, the case returned in the reference will not be consistent.</span></span> <span data-ttu-id="11a10-137">次に例を示します。</span><span class="sxs-lookup"><span data-stu-id="11a10-137">For example:</span></span>  
  
```  
SELECT ProductPhotoID, ThumbnailPhoto  
FROM   Production.ProductPhoto   
WHERE  ProductPhotoID=70  
FOR XML AUTO;  
```  
  
 <span data-ttu-id="11a10-138">結果を次に示します。</span><span class="sxs-lookup"><span data-stu-id="11a10-138">This is the result:</span></span>  
  
 `<Production.PRODUCTPHOTO`  
  
 `PRODUCTPHOTOID="70"`  
  
 `THUMBNAILPHOTO= "dbobject/Production.PRODUCTPHOTO[@ProductPhotoID='70']/@ThumbNailPhoto" />`  
  
 <span data-ttu-id="11a10-139">このことは、特に、大文字と小文字が区別されるデータベースに対して dbobject クエリが実行されるときに問題になる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="11a10-139">This can be a problem particularly when dbobject queries are executed against a case sensitive database.</span></span> <span data-ttu-id="11a10-140">この問題を回避するには、クエリで指定するテーブル名や列名での大文字と小文字の区別の方法が、データベース内のテーブル名や列名での大文字と小文字の区別の方法と一致している必要があります。</span><span class="sxs-lookup"><span data-stu-id="11a10-140">To avoid this, the case of the table or column name that is specified in the queries should match the case of the table or column name in the database.</span></span>  
  
## <a name="example-understanding-the-encoding"></a><span data-ttu-id="11a10-141">例: エンコードについて</span><span class="sxs-lookup"><span data-stu-id="11a10-141">Example: Understanding the encoding</span></span>  
 <span data-ttu-id="11a10-142">この例では、結果に表示されるさまざまなエンコードを示します。</span><span class="sxs-lookup"><span data-stu-id="11a10-142">This example shows the various encoding that occurs in the result.</span></span>  
  
 <span data-ttu-id="11a10-143">次のテーブルを作成します。</span><span class="sxs-lookup"><span data-stu-id="11a10-143">Create this table:</span></span>  
  
```  
CREATE TABLE [Special Chars] (Col1 char(1) primary key, [Col#&2] varbinary(50));  
```  
  
 <span data-ttu-id="11a10-144">テーブルに次のデータを追加します。</span><span class="sxs-lookup"><span data-stu-id="11a10-144">Add the following data to the table:</span></span>  
  
```  
INSERT INTO [Special Chars] VALUES ('&', 0x20), ('#', 0x20);  
```  
  
 <span data-ttu-id="11a10-145">次のクエリを実行すると、テーブルのデータが返されます。</span><span class="sxs-lookup"><span data-stu-id="11a10-145">This query returns the data from the table.</span></span> <span data-ttu-id="11a10-146">このクエリでは、FOR XML AUTO モードを指定しています。</span><span class="sxs-lookup"><span data-stu-id="11a10-146">The FOR XML AUTO mode is specified.</span></span> <span data-ttu-id="11a10-147">このため、バイナリ データは参照として返されます。</span><span class="sxs-lookup"><span data-stu-id="11a10-147">Binary data is returned as a reference.</span></span>  
  
```  
SELECT * FROM [Special Chars] FOR XML AUTO;  
```  
  
 <span data-ttu-id="11a10-148">結果を次に示します。</span><span class="sxs-lookup"><span data-stu-id="11a10-148">This is the result:</span></span>  
  
 `<Special_x0020_Chars`  
  
 `Col1="#"`  
  
 `Col_x0023__x0026_2="dbobject/Special_x0020_Chars[@Col1='#']/@Col_x0023__x0026_2"`  
  
 `/>`  
  
 `<Special_x0020_Chars`  
  
 `Col1="&"`  
  
 `Col_x0023__x0026_2="dbobject/Special_x0020_Chars[@Col1='&']/@Col_x0023__x0026_2"`  
  
 `/>`  
  
 <span data-ttu-id="11a10-149">次に、結果の特殊文字がエンコードされる処理を示します。</span><span class="sxs-lookup"><span data-stu-id="11a10-149">This is the process for encoding special characters in the result:</span></span>  
  
-   <span data-ttu-id="11a10-150">クエリ結果で、返された要素名と属性名に特殊な XML 文字や URL 文字が含まれている場合、それらの文字は対応する Unicode 文字の 16 進数値を使用してエンコードされます。</span><span class="sxs-lookup"><span data-stu-id="11a10-150">In the query result, the special XML and URL characters in the element and attribute names that are returned are encoded by using the hexadecimal value of the corresponding Unicode character.</span></span> <span data-ttu-id="11a10-151">上記の結果では、要素名 <`Special Chars`> が <`Special_x0020_Chars`> として返されています。</span><span class="sxs-lookup"><span data-stu-id="11a10-151">In the previous result, the element name <`Special Chars`> is returned as <`Special_x0020_Chars`>.</span></span> <span data-ttu-id="11a10-152">属性名 <`Col#&2`> は <`Col_x0023__x0026_2`> として返されています。</span><span class="sxs-lookup"><span data-stu-id="11a10-152">The attribute name <`Col#&2`> is returned as <`Col_x0023__x0026_2`>.</span></span> <span data-ttu-id="11a10-153">XML と URL の両方の特殊文字がエンコードされます。</span><span class="sxs-lookup"><span data-stu-id="11a10-153">Both XML and URL special characters are encoded.</span></span>  
  
-   <span data-ttu-id="11a10-154">要素や属性の値に 5 つの標準 XML 文字エンティティ ('、""、\<, >、および &) のいずれかが含まれている場合、これらの特殊な XML 文字は必ず XML 文字エンコードを使用してエンコードされます。</span><span class="sxs-lookup"><span data-stu-id="11a10-154">If the values of the elements or attribute contain any of the five standard XML character entities (', "", \<, >, and &), these special XML characters are always encoded using XML character encoding.</span></span> <span data-ttu-id="11a10-155">上記の結果では、属性 <`Col1`> の値の `&` という値は `&` とエンコードされています。</span><span class="sxs-lookup"><span data-stu-id="11a10-155">In the previous result, the value `&` in the value of attribute <`Col1`> is encoded as `&`.</span></span> <span data-ttu-id="11a10-156">ただし、# 文字は特殊な XML 文字ではなく有効な XML 文字なので、# のままです。</span><span class="sxs-lookup"><span data-stu-id="11a10-156">However, the # character remains #, because it is a valid XML character and not a special XML character.</span></span>  
  
-   <span data-ttu-id="11a10-157">要素や属性の値に URL で特別な意味を持つ任意の特殊な URL 文字が含まれている場合、それらの文字は、DBOBJECT URL 値であるとき、および特殊文字がテーブル名や列名の一部であるときにのみエンコードされます。</span><span class="sxs-lookup"><span data-stu-id="11a10-157">If the values of the elements or attributes contain any special URL characters that have special meaning in the URL, they are encoded only in the DBOBJECT URL value and are encoded only when the special character is part of a table or column name.</span></span> <span data-ttu-id="11a10-158">この結果、テーブル名 `#` の一部である文字 `Col#&2` は、 `_x0023_ in the DBOJBECT URL`としてエンコードされます。</span><span class="sxs-lookup"><span data-stu-id="11a10-158">In the result, the character `#` that is part of table name `Col#&2` is encoded as `_x0023_ in the DBOJBECT URL`.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="11a10-159">参照</span><span class="sxs-lookup"><span data-stu-id="11a10-159">See Also</span></span>  
 [<span data-ttu-id="11a10-160">FOR XML での AUTO モードの使用</span><span class="sxs-lookup"><span data-stu-id="11a10-160">Use AUTO Mode with FOR XML</span></span>](use-auto-mode-with-for-xml.md)  
  
  
