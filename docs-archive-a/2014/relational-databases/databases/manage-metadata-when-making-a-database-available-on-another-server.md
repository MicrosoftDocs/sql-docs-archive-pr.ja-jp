---
title: データベースを別のサーバーインスタンスで使用できるようにするときにメタデータを管理する (SQL Server) |Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ''
ms.topic: conceptual
helpviewer_keywords:
- cross-database queries [SQL Server]
- logins [SQL Server], recreating on another server instance
- triggers [SQL Server], DLL
- user-defined error messages [SQL Server]
- permissions [SQL Server], metadata access
- Full-Text Engine [SQL Server]
- metadata [SQL Server], databases available to other instances
- jobs [SQL Server Agent], recreating on another server instance
- failover [SQL Server], managing metadata
- event notifications [SQL Server], metadata
- database mirroring [SQL Server], metadata
- startup options [SQL Server]
- restoring [SQL Server], onto another server instance
- linked servers [SQL Server], metadata
- WMI Provider for Server Events, metadata
- attaching databases [SQL Server]
- log shipping [SQL Server], metadata
- encryption [SQL Server], metadata
- server configuration [SQL Server]
- distributed queries [SQL Server], metadata
- extended stored procedures [SQL Server], metadata
- credentials [SQL Server], metadata
- copying databases
ms.assetid: 5d98cf2a-9fc2-4610-be72-b422b8682681
author: stevestein
ms.author: sstein
ms.openlocfilehash: 5087a925ac163281f4326a5f952c11ce2953c6dd
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87742170"
---
# <a name="manage-metadata-when-making-a-database-available-on-another-server-instance-sql-server"></a><span data-ttu-id="04702-102">データベースを別のサーバー インスタンスで使用できるようにするときのメタデータの管理 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="04702-102">Manage Metadata When Making a Database Available on Another Server Instance (SQL Server)</span></span>
  <span data-ttu-id="04702-103">このトピックは、次の状況に関連しています。</span><span class="sxs-lookup"><span data-stu-id="04702-103">This topic is relevant in the following situations:</span></span>  
  
-   <span data-ttu-id="04702-104">[!INCLUDE[ssHADR](../../includes/sshadr-md.md)] 可用性グループの可用性レプリカを構成する場合。</span><span class="sxs-lookup"><span data-stu-id="04702-104">Configuring the availability replicas of an [!INCLUDE[ssHADR](../../includes/sshadr-md.md)] availability group.</span></span>  
  
-   <span data-ttu-id="04702-105">データベースのデータベース ミラーリングを設定する場合。</span><span class="sxs-lookup"><span data-stu-id="04702-105">Setting up database mirroring for a database.</span></span>  
  
-   <span data-ttu-id="04702-106">ログ配布構成内のプライマリ サーバーとセカンダリ サーバー間でロールの変更を準備する場合。</span><span class="sxs-lookup"><span data-stu-id="04702-106">When preparing to change roles between primary and secondary servers in a log shipping configuration.</span></span>  
  
-   <span data-ttu-id="04702-107">別のサーバー インスタンスにデータベースを復元する場合。</span><span class="sxs-lookup"><span data-stu-id="04702-107">Restoring a database to another server instance.</span></span>  
  
-   <span data-ttu-id="04702-108">別のサーバー インスタンスにデータベースのコピーをアタッチする場合。</span><span class="sxs-lookup"><span data-stu-id="04702-108">Attaching a copy of a database on another server instance.</span></span>  
  
 <span data-ttu-id="04702-109">アプリケーションによっては、シングル ユーザー データベースのスコープの外部にある情報、エンティティ、オブジェクトに依存することがあります。</span><span class="sxs-lookup"><span data-stu-id="04702-109">Some applications depend on information, entities, and/or objects that are outside of the scope of a single user database.</span></span> <span data-ttu-id="04702-110">通常、アプリケーションには、 **master** データベースと **msdb** データベースに対する依存関係があります。また、ユーザー データベースにも依存関係があります。</span><span class="sxs-lookup"><span data-stu-id="04702-110">Typically, an application has dependencies on the **master** and **msdb** databases, and also on the user database.</span></span> <span data-ttu-id="04702-111">ユーザー データベースの外部に格納される (ユーザー データベースを正しく機能させるために必要な) すべてのデータは、対象のサーバー インスタンスで使用できるようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="04702-111">Anything stored outside of a user database that is required for the correct functioning of that database must be made available on the destination server instance.</span></span> <span data-ttu-id="04702-112">たとえば、アプリケーションのログインが、 **master** データベースにメタデータとして格納されているため、それらを移行先サーバーで再作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="04702-112">For example, the logins for an application are stored as metadata in the **master** database, and they must be re-created on the destination server.</span></span> <span data-ttu-id="04702-113">アプリケーションまたはデータベースのメンテナンス プランが、メタデータが [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] msdb **データベースに格納される** エージェント ジョブに依存する場合、対象のサーバー インスタンスでこれらのジョブを再作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="04702-113">If an application or database maintenance plan depends on [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent jobs, whose metadata is stored in the **msdb** database, you must re-create those jobs on the destination server instance.</span></span> <span data-ttu-id="04702-114">同様に、サーバーレベルのトリガーのメタデータは **master**に格納されます。</span><span class="sxs-lookup"><span data-stu-id="04702-114">Similarly, the metadata for a server-level trigger is stored in **master**.</span></span>  
  
 <span data-ttu-id="04702-115">アプリケーションのデータベースを別のサーバー インスタンスに移動するときは、移行先サーバー インスタンス上の**マスター**および **msdb** に、依存しているエンティティとオブジェクトのすべてのメタデータを再作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="04702-115">When you move the database for an application to another server instance, you must re-create all the metadata of the dependent entities and objects in **master** and **msdb** on the destination server instance.</span></span> <span data-ttu-id="04702-116">たとえば、データベース アプリケーションでサーバーレベルのトリガーを使用している場合、そのデータベースを新しいシステムでアタッチまたは復元するだけでは不十分です。</span><span class="sxs-lookup"><span data-stu-id="04702-116">For example, if a database application uses server-level triggers, just attaching or restoring the database on the new system is not enough.</span></span> <span data-ttu-id="04702-117">このデータベースは、 **master** データベース内にこれらのトリガーのメタデータを手動で再作成しない限り、正常に動作しません。</span><span class="sxs-lookup"><span data-stu-id="04702-117">The database will not work as expected unless you manually re-create the metadata for those triggers in the **master** database.</span></span>  
  
##  <a name="information-entities-and-objects-that-are-stored-outside-of-user-databases"></a><a name="information_entities_and_objects"></a> <span data-ttu-id="04702-118">ユーザー データベースの外部に格納される情報、エンティティ、およびオブジェクト</span><span class="sxs-lookup"><span data-stu-id="04702-118">Information, Entities, and Objects That Are Stored Outside of User Databases</span></span>  
 <span data-ttu-id="04702-119">ここからは、別のサーバー インスタンスで使用できるようにしたデータベースに影響を及ぼすことが考えられる問題の概要を説明します。</span><span class="sxs-lookup"><span data-stu-id="04702-119">The remainder of this topic summarizes the potential issues that might affect a database that is being made available on another server instance.</span></span> <span data-ttu-id="04702-120">次の一覧に示す情報、エンティティ、またはオブジェクトのうち、1 種類以上の項目を再作成する必要が生じる場合があります。</span><span class="sxs-lookup"><span data-stu-id="04702-120">You might have to re-create one or more of the types of information, entities, or objects listed in the following list.</span></span> <span data-ttu-id="04702-121">概要を参照するには、該当する項目のリンクをクリックしてください。</span><span class="sxs-lookup"><span data-stu-id="04702-121">To see a summary, click the link for the item.</span></span>  
  
-   [<span data-ttu-id="04702-122">サーバーの構成設定</span><span class="sxs-lookup"><span data-stu-id="04702-122">Server configuration settings</span></span>](#server_configuration_settings)  
  
-   [<span data-ttu-id="04702-123">資格情報</span><span class="sxs-lookup"><span data-stu-id="04702-123">Credentials</span></span>](#credentials)  
  
-   [<span data-ttu-id="04702-124">複数データベース間のクエリ</span><span class="sxs-lookup"><span data-stu-id="04702-124">Cross-database queries</span></span>](#cross_database_queries)  
  
-   [<span data-ttu-id="04702-125">データベースの所有権</span><span class="sxs-lookup"><span data-stu-id="04702-125">Database ownership</span></span>](#database_ownership)  
  
-   [<span data-ttu-id="04702-126">分散クエリおよびリンク サーバー</span><span class="sxs-lookup"><span data-stu-id="04702-126">Distributed queries/linked servers</span></span>](#distributed_queries_and_linked_servers)  
  
-   [<span data-ttu-id="04702-127">暗号化データ</span><span class="sxs-lookup"><span data-stu-id="04702-127">Encrypted data</span></span>](#encrypted_data)  
  
-   <span data-ttu-id="04702-128">[[ユーザー定義エラー メッセージ]](#user_defined_error_messages)</span><span class="sxs-lookup"><span data-stu-id="04702-128">[User-defined error messages](#user_defined_error_messages)</span></span>  
  
-   [<span data-ttu-id="04702-129">イベント通知と Windows Management Instrumentation (WMI) イベント (サーバー レベル)</span><span class="sxs-lookup"><span data-stu-id="04702-129">Event notifications and Windows Management Instrumentation (WMI) events (at server level)</span></span>](#event_notif_and_wmi_events)  
  
-   [<span data-ttu-id="04702-130">拡張ストアド プロシージャ</span><span class="sxs-lookup"><span data-stu-id="04702-130">Extended stored procedures</span></span>](#extended_stored_procedures)  
  
-   [<span data-ttu-id="04702-131">Full-Text Engine for SQL Server プロパティ</span><span class="sxs-lookup"><span data-stu-id="04702-131">Full-text engine for SQL Server properties</span></span>](#ifts_service_properties)  
  
-   [<span data-ttu-id="04702-132">ジョブ</span><span class="sxs-lookup"><span data-stu-id="04702-132">Jobs</span></span>](#jobs)  
  
-   [<span data-ttu-id="04702-133">ログイン</span><span class="sxs-lookup"><span data-stu-id="04702-133">Logins</span></span>](#logins)  
  
-   [<span data-ttu-id="04702-134">アクセス許可</span><span class="sxs-lookup"><span data-stu-id="04702-134">Permissions</span></span>](#permissions)  
  
-   [<span data-ttu-id="04702-135">レプリケーションの設定</span><span class="sxs-lookup"><span data-stu-id="04702-135">Replication settings</span></span>](#replication_settings)  
  
-   [<span data-ttu-id="04702-136">Service Broker アプリケーション</span><span class="sxs-lookup"><span data-stu-id="04702-136">Service Broker applications</span></span>](#sb_applications)  
  
-   [<span data-ttu-id="04702-137">スタートアップ プロシージャ</span><span class="sxs-lookup"><span data-stu-id="04702-137">Startup procedures</span></span>](#startup_procedures)  
  
-   [<span data-ttu-id="04702-138">トリガー (サーバー レベル)</span><span class="sxs-lookup"><span data-stu-id="04702-138">Triggers (at server level)</span></span>](#triggers)  
  
##  <a name="server-configuration-settings"></a><a name="server_configuration_settings"></a> <span data-ttu-id="04702-139">Server Configuration Settings</span><span class="sxs-lookup"><span data-stu-id="04702-139">Server Configuration Settings</span></span>  
 [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] <span data-ttu-id="04702-140">以降のバージョンでは、主要なサービスや機能のインストールと開始を選択的に行います。</span><span class="sxs-lookup"><span data-stu-id="04702-140">and later versions selectively install and starts key services and features.</span></span> <span data-ttu-id="04702-141">これにより、外部からのアクセスを制限し、攻撃を防ぐことができます。</span><span class="sxs-lookup"><span data-stu-id="04702-141">This helps reduce the attackable surface area of a system.</span></span> <span data-ttu-id="04702-142">新規インストール時の既定の構成では、多くの機能が有効化されていません。</span><span class="sxs-lookup"><span data-stu-id="04702-142">In the default configuration of new installations, many features are not enabled.</span></span> <span data-ttu-id="04702-143">データベースが、既定で無効になっているサービスまたは機能に依存している場合、対象のサーバー インスタンスでそのサービスまたは機能を有効にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="04702-143">If the database relies on any service or feature that is off by default, this service or feature must be enabled on the destination server instance.</span></span>  
  
 <span data-ttu-id="04702-144">これらの設定、およびその有効化と無効化に関する詳細については、「[サーバー構成オプション &#40;SQL Server&#41;](../../database-engine/configure-windows/server-configuration-options-sql-server.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="04702-144">For more information about these settings and enabling or disabling them, see [Server Configuration Options &#40;SQL Server&#41;](../../database-engine/configure-windows/server-configuration-options-sql-server.md).</span></span>  
  
 [<span data-ttu-id="04702-145">&#91;先頭に戻る&#93;</span><span class="sxs-lookup"><span data-stu-id="04702-145">&#91;Top&#93;</span></span>](#information_entities_and_objects)  
  
##  <a name="credentials"></a><a name="credentials"></a><span data-ttu-id="04702-146">認証</span><span class="sxs-lookup"><span data-stu-id="04702-146">Credentials</span></span>  
 <span data-ttu-id="04702-147">資格情報は、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]外部のリソースへの接続に必要な認証情報を含むレコードです。</span><span class="sxs-lookup"><span data-stu-id="04702-147">A credential is a record that contains the authentication information that is required to connect to a resource outside [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="04702-148">多くの資格情報は、Windows ログインとパスワードで構成されています。</span><span class="sxs-lookup"><span data-stu-id="04702-148">Most credentials consist of a Windows login and password.</span></span>  
  
 <span data-ttu-id="04702-149">この機能の詳細については、「[資格情報 &#40;データベース エンジン&#41;](../security/authentication-access/credentials-database-engine.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="04702-149">For more information about this feature, see [Credentials &#40;Database Engine&#41;](../security/authentication-access/credentials-database-engine.md).</span></span>  
  
> [!NOTE]  
>  [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="04702-150">エージェント プロキシ アカウントでは資格情報を使用します。</span><span class="sxs-lookup"><span data-stu-id="04702-150">Agent Proxy accounts use credentials.</span></span> <span data-ttu-id="04702-151">プロキシ アカウントの資格情報 ID については、 [sysproxies](/sql/relational-databases/system-tables/dbo-sysproxies-transact-sql) システム テーブルを使用してください。</span><span class="sxs-lookup"><span data-stu-id="04702-151">To learn the credential ID of a proxy account, use the [sysproxies](/sql/relational-databases/system-tables/dbo-sysproxies-transact-sql) system table.</span></span>  
  
 [<span data-ttu-id="04702-152">&#91;先頭に戻る&#93;</span><span class="sxs-lookup"><span data-stu-id="04702-152">&#91;Top&#93;</span></span>](#information_entities_and_objects)  
  
##  <a name="cross-database-queries"></a><a name="cross_database_queries"></a><span data-ttu-id="04702-153">複数データベースにまたがるクエリ</span><span class="sxs-lookup"><span data-stu-id="04702-153">Cross-Database Queries</span></span>  
 <span data-ttu-id="04702-154">DB_CHAINING データベース オプションと TRUSTWORTHY データベース オプションは、既定では OFF になっています。</span><span class="sxs-lookup"><span data-stu-id="04702-154">The DB_CHAINING and TRUSTWORTHY database options are OFF by default.</span></span> <span data-ttu-id="04702-155">これらのオプションのいずれかが元のデータベースで ON に設定されていると、対象のサーバー インスタンスのデータベースで、これらの設定を有効にする必要がある場合があります。</span><span class="sxs-lookup"><span data-stu-id="04702-155">If either of these is set to ON for the original database, you may have to enable them on the database on the destination server instance.</span></span> <span data-ttu-id="04702-156">詳細については、「[ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="04702-156">For more information, see [ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql).</span></span>  
  
 <span data-ttu-id="04702-157">アタッチおよびデタッチ操作により、複数データベースにまたがる組み合わせ所有権が無効になります。</span><span class="sxs-lookup"><span data-stu-id="04702-157">Attach-and-detach operations disable cross-database ownership chaining for the database.</span></span> <span data-ttu-id="04702-158">チェーンを有効にする方法については、「 [cross db ownership chaining サーバー構成オプション](../../database-engine/configure-windows/cross-db-ownership-chaining-server-configuration-option.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="04702-158">For information about how to enable chaining, see [cross db ownership chaining Server Configuration Option](../../database-engine/configure-windows/cross-db-ownership-chaining-server-configuration-option.md).</span></span>  
  
 <span data-ttu-id="04702-159">詳細については、「[TRUSTWORTHY プロパティを使用するようにミラー データベースを設定する方法 &#40;Transact-SQL&#41;](../../database-engine/database-mirroring/set-up-a-mirror-database-to-use-the-trustworthy-property-transact-sql.md)」も参照してください</span><span class="sxs-lookup"><span data-stu-id="04702-159">For more information, see also [Set Up a Mirror Database to Use the Trustworthy Property &#40;Transact-SQL&#41;](../../database-engine/database-mirroring/set-up-a-mirror-database-to-use-the-trustworthy-property-transact-sql.md)</span></span>  
  
 [<span data-ttu-id="04702-160">&#91;先頭に戻る&#93;</span><span class="sxs-lookup"><span data-stu-id="04702-160">&#91;Top&#93;</span></span>](#information_entities_and_objects)  
  
##  <a name="database-ownership"></a><a name="database_ownership"></a><span data-ttu-id="04702-161">データベースの所有権</span><span class="sxs-lookup"><span data-stu-id="04702-161">Database Ownership</span></span>  
 <span data-ttu-id="04702-162">データベースを別のコンピューターに復元すると、復元操作を開始した [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ログイン ユーザーまたは Windows ユーザーが自動的に新しいデータベースの所有者になります。</span><span class="sxs-lookup"><span data-stu-id="04702-162">When a database is restored on another computer, the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login or Windows user who initiated the restore operation becomes the owner of the new database automatically.</span></span> <span data-ttu-id="04702-163">復元されたデータベースのシステム管理者または新しいデータベース所有者は、そのデータベースの所有権を変更できます。</span><span class="sxs-lookup"><span data-stu-id="04702-163">When the database is restored, the system administrator or the new database owner can change database ownership.</span></span>  
  
##  <a name="distributed-queries-and-linked-servers"></a><a name="distributed_queries_and_linked_servers"></a> <span data-ttu-id="04702-164">分散クエリおよびリンク サーバー</span><span class="sxs-lookup"><span data-stu-id="04702-164">Distributed Queries and Linked Servers</span></span>  
 <span data-ttu-id="04702-165">分散クエリおよびリンク サーバーは OLE DB アプリケーションでサポートされます。</span><span class="sxs-lookup"><span data-stu-id="04702-165">Distributed queries and linked servers are supported for OLE DB applications.</span></span> <span data-ttu-id="04702-166">分散クエリは、同一コンピューター上または異なるコンピューター上の複数の異種データ ソースのデータにアクセスします。</span><span class="sxs-lookup"><span data-stu-id="04702-166">Distributed queries access data from multiple heterogeneous data sources on either the same or different computers.</span></span> <span data-ttu-id="04702-167">リンク サーバーを構成すると、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] はリモート サーバー上の OLE DB データ ソースに対してコマンドを実行できます。</span><span class="sxs-lookup"><span data-stu-id="04702-167">A linked server configuration enables [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] to execute commands against OLE DB data sources on remote servers.</span></span> <span data-ttu-id="04702-168">詳しくは、「[リンク サーバー &#40;データベース エンジン&#41;](../linked-servers/linked-servers-database-engine.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="04702-168">For more information about these features, see [Linked Servers &#40;Database Engine&#41;](../linked-servers/linked-servers-database-engine.md).</span></span>  
  
 [<span data-ttu-id="04702-169">&#91;先頭に戻る&#93;</span><span class="sxs-lookup"><span data-stu-id="04702-169">&#91;Top&#93;</span></span>](#information_entities_and_objects)  
  
##  <a name="encrypted-data"></a><a name="encrypted_data"></a><span data-ttu-id="04702-170">暗号化されたデータ</span><span class="sxs-lookup"><span data-stu-id="04702-170">Encrypted Data</span></span>  
 <span data-ttu-id="04702-171">別のサーバー インスタンスで使用できるようにするデータベースに暗号化データが含まれていて、データベース マスター キーが、元のサーバーのサービス マスター キーによって保護されている場合、そのサービス マスター キーを再度暗号化することが必要になる場合があります。</span><span class="sxs-lookup"><span data-stu-id="04702-171">If the database you are making available on another server instance contains encrypted data and if the database master key is protected by the service master key on the original server, it might be necessary to re-create the service master key encryption.</span></span> <span data-ttu-id="04702-172">*データベース マスター キー* は対称キーで、証明書の秘密キーや暗号化されたデータベース内の非対称キーを保護するときに使用します。</span><span class="sxs-lookup"><span data-stu-id="04702-172">The *database master key* is a symmetric key that is used to protect the private keys of certificates and asymmetric keys in an encrypted database.</span></span> <span data-ttu-id="04702-173">データベース マスター キーを作成するときには、トリプル DES アルゴリズムとユーザー指定のパスワードを使用してデータベース マスター キーを暗号化します。</span><span class="sxs-lookup"><span data-stu-id="04702-173">When created, the database master key is encrypted by using the Triple DES algorithm and a user-supplied password.</span></span>  
  
 <span data-ttu-id="04702-174">サーバー インスタンスでデータベース マスター キーの暗号化を自動的に解除できるようにするには、サービス マスター キーを使用してデータベース マスター キーのコピーを暗号化します。</span><span class="sxs-lookup"><span data-stu-id="04702-174">To enable the automatic decryption of the database master key on a server instance, a copy of this key is encrypted by using the service master key.</span></span> <span data-ttu-id="04702-175">この暗号化されたコピーをデータベースと **master**データベースの両方に格納します。</span><span class="sxs-lookup"><span data-stu-id="04702-175">This encrypted copy is stored in both the database and in **master**.</span></span> <span data-ttu-id="04702-176">通常、master に格納されているコピーは、マスターキーが変更されるたびに暗黙的に**更新され**ます。</span><span class="sxs-lookup"><span data-stu-id="04702-176">Typically, the copy stored in **master** is silently updated whenever the master key is changed.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="04702-177">により、インスタンスのサービス マスター キーを使用して、データベース マスター キーの暗号化解除が最初に試行されます。</span><span class="sxs-lookup"><span data-stu-id="04702-177">first tries to decrypt the database master key with the service master key of the instance.</span></span> <span data-ttu-id="04702-178">暗号化解除が失敗した場合、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] では資格情報ストア内で、マスター キーが必要なデータベースと同じファミリ GUID のマスター キー資格情報が検索されます。</span><span class="sxs-lookup"><span data-stu-id="04702-178">If that decryption fails, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] searches the credential store for master key credentials that have the same family GUID as the database for which it requires the master key.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="04702-179">では、次に、一致した資格情報を順に使用してデータベースのマスター キーの暗号化解除が試行されます。これは暗号化解除が成功するか、資格情報がなくなった時点で終了します。</span><span class="sxs-lookup"><span data-stu-id="04702-179">then tries to decrypt the database master key with each matching credential until the decryption succeeds or there are no more credentials.</span></span> <span data-ttu-id="04702-180">サービス マスター キーによって暗号化されていないマスター キーは、OPEN MASTER KEY ステートメントとパスワードを使用して開かれている必要があります。</span><span class="sxs-lookup"><span data-stu-id="04702-180">A master key that is not encrypted by the service master key must be opened by using the OPEN MASTER KEY statement and a password.</span></span>  
  
 <span data-ttu-id="04702-181">暗号化されたデータベースがコピー、復元、または [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]の新しいインスタンスにアタッチされた場合、サービス マスター キーによって暗号化されたデータベース マスター キーのコピーは、対象のサーバー インスタンスの **master** データベースに格納されません。</span><span class="sxs-lookup"><span data-stu-id="04702-181">When an encrypted database is copied, restored, or attached to a new instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], a copy of the database master key encrypted by the service master key is not stored in **master** on the destination server instance.</span></span> <span data-ttu-id="04702-182">対象のサーバー インスタンスで、データベースのマスター キーを開く必要があります。</span><span class="sxs-lookup"><span data-stu-id="04702-182">On the destination server instance, you must open the master key of the database.</span></span> <span data-ttu-id="04702-183">マスター キーを開くには、OPEN MASTER KEY DECRYPTION BY PASSWORD **='***password***'** ステートメントを実行します。</span><span class="sxs-lookup"><span data-stu-id="04702-183">To open the master key, execute the following statement: OPEN MASTER KEY DECRYPTION BY PASSWORD **='***password***'**.</span></span> <span data-ttu-id="04702-184">次に、ALTER MASTER KEY ADD ENCRYPTION BY SERVICE MASTER KEY ステートメントを実行して、データベース マスター キーの自動暗号化解除を有効にすることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="04702-184">We recommend that you then enable automatic decryption of the database master key by executing the following statement: ALTER MASTER KEY ADD ENCRYPTION BY SERVICE MASTER KEY.</span></span> <span data-ttu-id="04702-185">この ALTER MASTER KEY ステートメントにより、サービス マスター キーを使用して暗号化されたデータベース マスター キーのコピーが対象のサーバー インスタンスに提供されます。</span><span class="sxs-lookup"><span data-stu-id="04702-185">This ALTER MASTER KEY statement provisions the server instance with a copy of the database master key that is encrypted with the service master key.</span></span> <span data-ttu-id="04702-186">詳細については、「[OPEN MASTER KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/open-master-key-transact-sql)」と「[ALTER MASTER KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-master-key-transact-sql)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="04702-186">For more information, see [OPEN MASTER KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/open-master-key-transact-sql) and [ALTER MASTER KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-master-key-transact-sql).</span></span>  
  
 <span data-ttu-id="04702-187">ミラー データベースのデータベース マスター キーの自動暗号化解除を有効にする方法については、「 [暗号化されたミラー データベースの設定](../../database-engine/database-mirroring/set-up-an-encrypted-mirror-database.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="04702-187">For information about how to enable automatic decryption of the database master key of a mirror database, see [Set Up an Encrypted Mirror Database](../../database-engine/database-mirroring/set-up-an-encrypted-mirror-database.md).</span></span>  
  
 <span data-ttu-id="04702-188">詳細については、次のトピックも参照してください。</span><span class="sxs-lookup"><span data-stu-id="04702-188">For more information, see also:</span></span>  
  
-   [<span data-ttu-id="04702-189">暗号化階層</span><span class="sxs-lookup"><span data-stu-id="04702-189">Encryption Hierarchy</span></span>](../security/encryption/encryption-hierarchy.md)  
  
-   [<span data-ttu-id="04702-190">暗号化されたミラー データベースの設定</span><span class="sxs-lookup"><span data-stu-id="04702-190">Set Up an Encrypted Mirror Database</span></span>](../../database-engine/database-mirroring/set-up-an-encrypted-mirror-database.md)  
  
-   [<span data-ttu-id="04702-191">2 台のサーバーでの同じ対称キーの作成</span><span class="sxs-lookup"><span data-stu-id="04702-191">Create Identical Symmetric Keys on Two Servers</span></span>](../security/encryption/create-identical-symmetric-keys-on-two-servers.md)  
  
 [<span data-ttu-id="04702-192">&#91;先頭に戻る&#93;</span><span class="sxs-lookup"><span data-stu-id="04702-192">&#91;Top&#93;</span></span>](#information_entities_and_objects)  
  
##  <a name="user-defined-error-messages"></a><a name="user_defined_error_messages"></a> <span data-ttu-id="04702-193">User-defined Error Messages</span><span class="sxs-lookup"><span data-stu-id="04702-193">User-defined Error Messages</span></span>  
 <span data-ttu-id="04702-194">ユーザー定義エラー メッセージは、 [sys.messages](/sql/relational-databases/system-catalog-views/messages-for-errors-catalog-views-sys-messages) カタログ ビューに存在します。</span><span class="sxs-lookup"><span data-stu-id="04702-194">User-defined error messages reside in the [sys.messages](/sql/relational-databases/system-catalog-views/messages-for-errors-catalog-views-sys-messages) catalog view.</span></span> <span data-ttu-id="04702-195">このカタログ ビューは、 **master**データベースに格納されています。</span><span class="sxs-lookup"><span data-stu-id="04702-195">This catalog view is stored in **master**.</span></span> <span data-ttu-id="04702-196">データベース アプリケーションがユーザー定義エラー メッセージに依存していて、データベースを別のサーバー インスタンスで使用できる場合は、 [sp_addmessage](/sql/relational-databases/system-stored-procedures/sp-addmessage-transact-sql) を使用してユーザー定義エラー メッセージを対象のサーバー インスタンスに追加できます。</span><span class="sxs-lookup"><span data-stu-id="04702-196">If a database application depends on user-defined error messages and the database is made available on another server instance, use [sp_addmessage](/sql/relational-databases/system-stored-procedures/sp-addmessage-transact-sql) to add those user-defined messages on the destination server instance.</span></span>  
  
 [<span data-ttu-id="04702-197">&#91;先頭に戻る&#93;</span><span class="sxs-lookup"><span data-stu-id="04702-197">&#91;Top&#93;</span></span>](#information_entities_and_objects)  
  
##  <a name="event-notifications-and-windows-management-instrumentation-wmi-events-at-server-level"></a><a name="event_notif_and_wmi_events"></a><span data-ttu-id="04702-198">イベント通知と Windows Management Instrumentation (WMI) イベント (サーバーレベル)</span><span class="sxs-lookup"><span data-stu-id="04702-198">Event Notifications and Windows Management Instrumentation (WMI) Events (at Server Level)</span></span>  
  
### <a name="server-level-event-notifications"></a><span data-ttu-id="04702-199">サーバーレベルのイベント通知</span><span class="sxs-lookup"><span data-stu-id="04702-199">Server-Level Event Notifications</span></span>  
 <span data-ttu-id="04702-200">サーバーレベルのイベント通知は **msdb**に格納されます。</span><span class="sxs-lookup"><span data-stu-id="04702-200">Server-level event notifications are stored in **msdb**.</span></span> <span data-ttu-id="04702-201">したがって、データベース アプリケーションがサーバーレベルのイベント通知に依存している場合、そのイベント通知を対象のサーバー インスタンスで再作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="04702-201">Therefore, if a database application relies on a server-level event notifications, that event notification must be re-created on the destination server instance.</span></span> <span data-ttu-id="04702-202">サーバー インスタンスでイベント通知を表示するには、 [sys.server_event_notifications](/sql/relational-databases/system-catalog-views/sys-server-event-notifications-transact-sql) カタログ ビューを使用します。</span><span class="sxs-lookup"><span data-stu-id="04702-202">To view the event notifications on a server instance, use the [sys.server_event_notifications](/sql/relational-databases/system-catalog-views/sys-server-event-notifications-transact-sql) catalog view.</span></span> <span data-ttu-id="04702-203">詳しくは、「 [Event Notifications](../service-broker/event-notifications.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="04702-203">For more information, see [Event Notifications](../service-broker/event-notifications.md).</span></span>  
  
 <span data-ttu-id="04702-204">また、イベント通知は [!INCLUDE[ssSB](../../includes/sssb-md.md)]を使用して配信されます。</span><span class="sxs-lookup"><span data-stu-id="04702-204">Additionally, event notifications are delivered by using [!INCLUDE[ssSB](../../includes/sssb-md.md)].</span></span> <span data-ttu-id="04702-205">着信メッセージのルートは、サービスを格納したデータベースには含まれていません。</span><span class="sxs-lookup"><span data-stu-id="04702-205">Routes for incoming messages are not included in the database that contains a service.</span></span> <span data-ttu-id="04702-206">代わりに、明示的なルートが **msdb**に格納されます。</span><span class="sxs-lookup"><span data-stu-id="04702-206">Instead, explicit routes are stored in **msdb**.</span></span> <span data-ttu-id="04702-207">サービスが、サービス宛ての着信メッセージをルーティングするために **msdb** データベース内の明示的なルートを使用する場合、別のインスタンスにデータベースをアタッチするには、このルートを再作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="04702-207">If your service uses an explicit route in the **msdb** database to route incoming messages to the service, when you attach a database in a different instance, you must re-create this route.</span></span>  
  
### <a name="windows-management-instrumentation-wmi-events"></a><span data-ttu-id="04702-208">Windows Management Instrumentation (WMI) イベント</span><span class="sxs-lookup"><span data-stu-id="04702-208">Windows Management Instrumentation (WMI) Events</span></span>  
 <span data-ttu-id="04702-209">WMI Provider for Server Events を使用すれば、Windows Management Instrumentation (WMI) を使用して [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]のイベントを監視できます。</span><span class="sxs-lookup"><span data-stu-id="04702-209">The WMI Provider for Server Events lets you use the Windows Management Instrumentation (WMI) to monitor events in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="04702-210">データベースが依存する WMI プロバイダーによって公開されているサーバーレベルのイベントに依存するすべてのアプリケーションは、対象のサーバー インスタンスのコンピューターで定義されている必要があります。</span><span class="sxs-lookup"><span data-stu-id="04702-210">Any application that relies on server-level events exposed through the WMI provider on which a database relies must be defined the computer of the destination server instance.</span></span> <span data-ttu-id="04702-211">WMI イベント プロバイダーは、 **msdb**で定義されている対象サービスでイベント通知を作成します。</span><span class="sxs-lookup"><span data-stu-id="04702-211">WMI Event provider creates event notifications with a target service that is defined in **msdb**.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="04702-212">詳細については、「 [WMI Provider for Server Events の概念](../wmi-provider-server-events/wmi-provider-for-server-events-concepts.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="04702-212">For more information, see [WMI Provider for Server Events Concepts](../wmi-provider-server-events/wmi-provider-for-server-events-concepts.md).</span></span>  
  
 <span data-ttu-id="04702-213">**SQL Server Management Studio を使用して WMI 警告を作成するには**</span><span class="sxs-lookup"><span data-stu-id="04702-213">**To create a WMI alert using SQL Server Management Studio**</span></span>  
  
-   [<span data-ttu-id="04702-214">Create a WMI Event Alert</span><span class="sxs-lookup"><span data-stu-id="04702-214">Create a WMI Event Alert</span></span>](../../ssms/agent/create-a-wmi-event-alert.md)  
  
### <a name="how-event-notifications-work-for-a-mirrored-database"></a><span data-ttu-id="04702-215">ミラー化されたデータベースに対するイベント通知の動作のしくみ</span><span class="sxs-lookup"><span data-stu-id="04702-215">How Event Notifications Work for a Mirrored Database</span></span>  
 <span data-ttu-id="04702-216">ミラー化されたデータベースはフェールオーバーできるため、ミラー化されたデータベースに関するイベント通知の複数データベースにまたがる配信は、定義上はリモートで行われます。</span><span class="sxs-lookup"><span data-stu-id="04702-216">Cross-database delivery of event notifications that involves a mirrored database is remote, by definition, because the mirrored database can fail over.</span></span> [!INCLUDE[ssSB](../../includes/sssb-md.md)]<span data-ttu-id="04702-217">では、ミラー化されたデータベースに対する特別なサポートが、*ミラー化*されたルートの形式で提供されます。</span><span class="sxs-lookup"><span data-stu-id="04702-217">provides special support for mirrored databases, in the form of *mirrored routes*.</span></span> <span data-ttu-id="04702-218">ミラー化されたルートには、プリンシパル サーバー インスタンス用とミラー サーバー インスタンス用の 2 つのアドレスがあります。</span><span class="sxs-lookup"><span data-stu-id="04702-218">A mirrored route has two addresses: one for the principal server instance and one for the mirror server instance.</span></span>  
  
 <span data-ttu-id="04702-219">ミラー化されたルートをセットアップすることにより、 [!INCLUDE[ssSB](../../includes/sssb-md.md)] のルーティングでデータベース ミラーリングが認識されるようにします。</span><span class="sxs-lookup"><span data-stu-id="04702-219">By setting up mirrored routes, you make [!INCLUDE[ssSB](../../includes/sssb-md.md)] routing aware of database mirroring.</span></span> <span data-ttu-id="04702-220">ミラー化されたルートを使用すると、 [!INCLUDE[ssSB](../../includes/sssb-md.md)] で現在のプリンシパル サーバー インスタンスに透過的にメッセージ交換をリダイレクトできます。</span><span class="sxs-lookup"><span data-stu-id="04702-220">The mirrored routes enable [!INCLUDE[ssSB](../../includes/sssb-md.md)] to transparently redirect conversations to the current principal server instance.</span></span> <span data-ttu-id="04702-221">たとえば、ミラー化されたデータベース Database_A によってホストされているサービス Service_A について考えてみます。</span><span class="sxs-lookup"><span data-stu-id="04702-221">For example, consider a service, Service_A, which is hosted by a mirrored database, Database_A.</span></span> <span data-ttu-id="04702-222">Database_B によってホストされているもう 1 つのサービス Service_B には Service_A との対話が必要であるとします。</span><span class="sxs-lookup"><span data-stu-id="04702-222">Assume that you need another service, Service_B, which is hosted by Database_B, to have a dialog with Service_A.</span></span> <span data-ttu-id="04702-223">この対話を可能にするには、Database_B に Service_A 用のミラー化されたルートを含める必要があります。</span><span class="sxs-lookup"><span data-stu-id="04702-223">For this dialog to be possible, Database_B must contain a mirrored route for Service_A.</span></span> <span data-ttu-id="04702-224">さらに、Database_A には Service_B へのミラー化されていない TCP 転送ルートを含める必要があります。このルートはローカル ルートとは異なり、フェールオーバー後も有効なままです。</span><span class="sxs-lookup"><span data-stu-id="04702-224">In addition, Database_A must contain a nonmirrored TCP transport route to Service_B, which, unlike a local route, remains valid after failover.</span></span> <span data-ttu-id="04702-225">これらのルートによって、フェールオーバー後に ACK が返されるようになります。</span><span class="sxs-lookup"><span data-stu-id="04702-225">These routes enable ACKs to come back after a failover.</span></span> <span data-ttu-id="04702-226">送信側のサービスは常に同じ形式で名前指定されるので、ルートではブローカー インスタンスを指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="04702-226">Because the service of the sender is always named in the same manner, the route must specify the broker instance.</span></span>  
  
 <span data-ttu-id="04702-227">ミラー化されたルートには、ミラー化されたデータベースのサービスが発信側サービスか発信先サービスかにかかわらず、次の要件が適用されます。</span><span class="sxs-lookup"><span data-stu-id="04702-227">The requirement for mirrored routes applies for regardless of whether the service in the mirrored database is the initiator service or the target service:</span></span>  
  
-   <span data-ttu-id="04702-228">発信先サービスがミラー化されたデータベースにある場合、発信側サービスに、発信先に戻るためのミラー化されたルートがあること。</span><span class="sxs-lookup"><span data-stu-id="04702-228">If target service is in the mirrored database, the initiator service must have a mirrored route back to the target.</span></span> <span data-ttu-id="04702-229">ただし、発信先は通常のルートで発信側に戻れること。</span><span class="sxs-lookup"><span data-stu-id="04702-229">However, the target can have a regular route back to initiator.</span></span>  
  
-   <span data-ttu-id="04702-230">発信側サービスがミラー化されたデータベースにある場合、発信先に、受信確認や応答の配信のために発信側サービスに戻るミラー化されたルートがあること。</span><span class="sxs-lookup"><span data-stu-id="04702-230">If initiator service is in the mirrored database, the target service must have a mirrored route back to initiator to deliver acknowledgements and replies.</span></span> <span data-ttu-id="04702-231">ただし、発信側は通常のルートで発信先に戻れること。</span><span class="sxs-lookup"><span data-stu-id="04702-231">However, the initiator can have a regular route to the target.</span></span>  
  
 [<span data-ttu-id="04702-232">&#91;先頭に戻る&#93;</span><span class="sxs-lookup"><span data-stu-id="04702-232">&#91;Top&#93;</span></span>](#information_entities_and_objects)  
  
##  <a name="extended-stored-procedures"></a><a name="extended_stored_procedures"></a><span data-ttu-id="04702-233">拡張ストアドプロシージャ</span><span class="sxs-lookup"><span data-stu-id="04702-233">Extended Stored Procedures</span></span>  
  
> [!IMPORTANT]  
>  [!INCLUDE[ssNoteDepFutureAvoid](../../includes/ssnotedepfutureavoid-md.md)]<span data-ttu-id="04702-234">代わりに[CLR 統合](../clr-integration/common-language-runtime-integration-overview.md)を使用してください。</span><span class="sxs-lookup"><span data-stu-id="04702-234">Use [CLR Integration](../clr-integration/common-language-runtime-integration-overview.md) instead.</span></span>  
  
 <span data-ttu-id="04702-235">拡張ストアド プロシージャは [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 拡張ストアド プロシージャ API を使用してプログラミングされます。</span><span class="sxs-lookup"><span data-stu-id="04702-235">Extended stored procedures are programmed by using the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Extended Stored Procedure API.</span></span> <span data-ttu-id="04702-236">**sysadmin** 固定サーバー ロールのメンバーは、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] のインスタンスを使用して拡張ストアド プロシージャを登録し、ユーザーにその拡張ストアド プロシージャを実行する権限を与えることができます。</span><span class="sxs-lookup"><span data-stu-id="04702-236">A member of the **sysadmin** fixed server role can register an extended stored procedure with an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] and grant permission to users to execute the procedure.</span></span> <span data-ttu-id="04702-237">拡張ストアド プロシージャは、 **master** データベースにのみ追加できます。</span><span class="sxs-lookup"><span data-stu-id="04702-237">Extended stored procedures can be added only to the **master** database.</span></span>  
  
 <span data-ttu-id="04702-238">拡張ストアド プロシージャは [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]のインスタンスのアドレス空間で直接実行されるので、メモリ リークや、サーバーのパフォーマンスと信頼性を低下させるその他の問題が発生する原因になる場合があります。</span><span class="sxs-lookup"><span data-stu-id="04702-238">Extended stored procedures run directly in the address space of an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], and they may produce memory leaks or other problems that reduce the performance and reliability of the server.</span></span> <span data-ttu-id="04702-239">参照データを含んでいる [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] のインスタンスとは別のインスタンスに拡張ストアド プロシージャを格納することを検討してください。</span><span class="sxs-lookup"><span data-stu-id="04702-239">You should consider storing extended stored procedures in an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] that is separate from the instance that contains the referenced data.</span></span> <span data-ttu-id="04702-240">また、データベースへのアクセスには分散クエリを使用することも検討してください。</span><span class="sxs-lookup"><span data-stu-id="04702-240">You should also consider using distributed queries to access the database.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="04702-241">システム管理者は、拡張ストアド プロシージャをサーバーに追加して他のユーザーに Execute 権限を許可する前に、各拡張ストアド プロシージャに有害なコードや悪意のあるコードが含まれていないことを十分に確認する必要があります。</span><span class="sxs-lookup"><span data-stu-id="04702-241">Before adding extended stored procedures to the server and granting EXECUTE permissions to other users, the system administrator should thoroughly review each extended stored procedure to make sure that it does not contain harmful or malicious code.</span></span>  
  
 <span data-ttu-id="04702-242">詳細については、「[GRANT (オブジェクトの権限の許可) &#40;Transact-SQL&#41;](/sql/t-sql/statements/grant-object-permissions-transact-sql)」、「[DENY (オブジェクトの権限の拒否) &#40;Transact-SQL&#41;](/sql/t-sql/statements/deny-object-permissions-transact-sql)」、および「[REVOKE (オブジェクトの権限の取り消し) &#40;Transact-SQL&#41;](/sql/t-sql/statements/revoke-object-permissions-transact-sql)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="04702-242">For more information, see [GRANT Object Permissions &#40;Transact-SQL&#41;](/sql/t-sql/statements/grant-object-permissions-transact-sql), [DENY Object Permissions &#40;Transact-SQL&#41;](/sql/t-sql/statements/deny-object-permissions-transact-sql), and [REVOKE Object Permissions &#40;Transact-SQL&#41;](/sql/t-sql/statements/revoke-object-permissions-transact-sql).</span></span>  
  
 [<span data-ttu-id="04702-243">&#91;先頭に戻る&#93;</span><span class="sxs-lookup"><span data-stu-id="04702-243">&#91;Top&#93;</span></span>](#information_entities_and_objects)  
  
##  <a name="full-text-engine-for-sql-server-properties"></a><a name="ifts_service_properties"></a><span data-ttu-id="04702-244">SQL Server プロパティ用のフルテキストエンジン</span><span class="sxs-lookup"><span data-stu-id="04702-244">Full-Text Engine for SQL Server Properties</span></span>  
 <span data-ttu-id="04702-245">Full-Text Engine のプロパティは、 [sp_fulltext_service](/sql/relational-databases/system-stored-procedures/sp-fulltext-service-transact-sql)によって設定されます。</span><span class="sxs-lookup"><span data-stu-id="04702-245">Properties are set on the Full-Text Engine by [sp_fulltext_service](/sql/relational-databases/system-stored-procedures/sp-fulltext-service-transact-sql).</span></span> <span data-ttu-id="04702-246">対象のサーバー インスタンスで、これらのプロパティに必要な設定が行われていることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="04702-246">Make sure that the destination server instance has the required settings for these properties.</span></span> <span data-ttu-id="04702-247">これらのプロパティの詳細については、「[FULLTEXTSERVICEPROPERTY &#40;Transact-SQL&#41;](/sql/t-sql/functions/fulltextserviceproperty-transact-sql)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="04702-247">For more information about these properties, see [FULLTEXTSERVICEPROPERTY &#40;Transact-SQL&#41;](/sql/t-sql/functions/fulltextserviceproperty-transact-sql).</span></span>  
  
 <span data-ttu-id="04702-248">さらに、 [ワード ブレーカーとステマー](../search/configure-and-manage-word-breakers-and-stemmers-for-search.md) のコンポーネント、または [フルテキスト検索フィルター](../search/configure-and-manage-filters-for-search.md) コンポーネントのバージョンが、元のサーバー インスタンスと対象のサーバー インスタンスで異なると、フルテキスト インデックスおよびクエリの動作が異なる場合があります。</span><span class="sxs-lookup"><span data-stu-id="04702-248">Additionally, if the [word breakers and stemmers](../search/configure-and-manage-word-breakers-and-stemmers-for-search.md) component or [full-text search filters](../search/configure-and-manage-filters-for-search.md) component have different versions on the original and destination server instances, full-text index and queries may behave differently.</span></span> <span data-ttu-id="04702-249">また、 [類義語辞典](../search/full-text-search.md) はインスタンス固有のファイルに格納されています。</span><span class="sxs-lookup"><span data-stu-id="04702-249">Also, the [thesaurus](../search/full-text-search.md) is stored in instance-specific files.</span></span> <span data-ttu-id="04702-250">それらのファイルのコピーを対象のサーバー インスタンスの該当する場所にコピーするか、新しいインスタンス上でこれらのファイルを再作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="04702-250">You must either transfer a copy of those files to an equivalent location on the destination server instance or re-create them on new instance.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="04702-251">フルテキスト カタログ ファイルを含む [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] データベースを [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] サーバー インスタンスにアタッチする場合、カタログ ファイルは [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)]と同様に他のデータベース ファイルと一緒に以前の場所からアタッチされます。</span><span class="sxs-lookup"><span data-stu-id="04702-251">When you attach a [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] database that contains full-text catalog files onto a [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] server instance, the catalog files are attached from their previous location along with the other database files, the same as in [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)].</span></span> <span data-ttu-id="04702-252">詳細については、「 [フルテキスト検索のアップグレード](../search/upgrade-full-text-search.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="04702-252">For more information, see [Upgrade Full-Text Search](../search/upgrade-full-text-search.md).</span></span>  
  
 <span data-ttu-id="04702-253">詳細については、次のトピックも参照してください。</span><span class="sxs-lookup"><span data-stu-id="04702-253">For more information, see also:</span></span>  
  
-   [<span data-ttu-id="04702-254">フルテキスト カタログとフルテキスト インデックスのバックアップおよび復元</span><span class="sxs-lookup"><span data-stu-id="04702-254">Back Up and Restore Full-Text Catalogs and Indexes</span></span>](../search/back-up-and-restore-full-text-catalogs-and-indexes.md)  
  
-   [<span data-ttu-id="04702-255">データベース ミラーリングとフルテキスト カタログ &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="04702-255">Database Mirroring and Full-Text Catalogs &#40;SQL Server&#41;</span></span>](../../database-engine/database-mirroring/database-mirroring-and-full-text-catalogs-sql-server.md)  
  
 [<span data-ttu-id="04702-256">&#91;先頭に戻る&#93;</span><span class="sxs-lookup"><span data-stu-id="04702-256">&#91;Top&#93;</span></span>](#information_entities_and_objects)  
  
##  <a name="jobs"></a><a name="jobs"></a><span data-ttu-id="04702-257">職務</span><span class="sxs-lookup"><span data-stu-id="04702-257">Jobs</span></span>  
 <span data-ttu-id="04702-258">データベースが [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] エージェント ジョブに依存する場合、対象のサーバー インスタンス上でそれらの SQL Server エージェント ジョブを再作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="04702-258">If the database relies on [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent jobs, you will have to re-create them on the destination server instance.</span></span> <span data-ttu-id="04702-259">ジョブは環境に依存します。</span><span class="sxs-lookup"><span data-stu-id="04702-259">Jobs depend on their environments.</span></span> <span data-ttu-id="04702-260">対象のサーバー インスタンス上で既存のジョブを再作成する場合、元のサーバー インスタンス上のジョブの環境に一致するように対象のサーバー インスタンスを変更することが必要になる場合があります。</span><span class="sxs-lookup"><span data-stu-id="04702-260">If you plan to re-create an existing job on the destination server instance, the destination server instance might have to be modified to match the environment of that job on the original server instance.</span></span> <span data-ttu-id="04702-261">次の環境的要因は重要です。</span><span class="sxs-lookup"><span data-stu-id="04702-261">The following environmental factors are significant:</span></span>  
  
-   <span data-ttu-id="04702-262">ジョブによって使用されるログイン</span><span class="sxs-lookup"><span data-stu-id="04702-262">The login used by the job</span></span>  
  
     <span data-ttu-id="04702-263">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] エージェント ジョブを作成または実行するには、まず、ジョブに必要なすべての [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ログインを対象のサーバー インスタンスに追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="04702-263">To create or execute [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent jobs, you must first add any [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] logins required by the job to the destination server instance.</span></span> <span data-ttu-id="04702-264">詳細については、「 [SQL Server エージェント ジョブ ステップを作成および管理するユーザーの構成](../../ssms/agent/configure-a-user-to-create-and-manage-sql-server-agent-jobs.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="04702-264">For more information, see [Configure a User to Create and Manage SQL Server Agent Jobs](../../ssms/agent/configure-a-user-to-create-and-manage-sql-server-agent-jobs.md).</span></span>  
  
-   [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="04702-265">エージェントのサービス開始アカウント</span><span class="sxs-lookup"><span data-stu-id="04702-265">Agent service startup account</span></span>  
  
     <span data-ttu-id="04702-266">サービス開始アカウントにより、 [!INCLUDE[msCoName](../../includes/msconame-md.md)] エージェントを実行する [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Windows アカウントとそのネットワーク権限が定義されます。</span><span class="sxs-lookup"><span data-stu-id="04702-266">The service startup account defines the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows account in which [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent runs and its network permissions.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="04702-267">エージェントは、指定されたユーザー アカウントで実行されます。</span><span class="sxs-lookup"><span data-stu-id="04702-267">Agent runs as a specified user account.</span></span> <span data-ttu-id="04702-268">SQL Server エージェント サービスのコンテキストは、ジョブとその実行環境の設定に影響します。</span><span class="sxs-lookup"><span data-stu-id="04702-268">The context of the Agent service affects the settings for the job and its run environment.</span></span> <span data-ttu-id="04702-269">アカウントは、ジョブで必要とされるネットワーク共有などのリソースにアクセスできる必要があります。</span><span class="sxs-lookup"><span data-stu-id="04702-269">The account must have access to the resources, such as network shares, required by the job.</span></span> <span data-ttu-id="04702-270">サービス開始アカウントの選択方法と変更方法の詳細については、「 [SQL Server エージェント サービスのアカウントの選択](../../ssms/agent/select-an-account-for-the-sql-server-agent-service.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="04702-270">For information about how to select and modify the service startup account, see [Select an Account for the SQL Server Agent Service](../../ssms/agent/select-an-account-for-the-sql-server-agent-service.md).</span></span>  
  
     <span data-ttu-id="04702-271">正しく稼働するには、適切なドメイン、ファイル システム、およびレジストリの権限を持つようにサービス開始アカウントを構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="04702-271">To operate correctly, the service startup account must be configured to have the correct domain, file system, and registry permissions.</span></span> <span data-ttu-id="04702-272">また、サービス アカウント用に構成する必要がある共有ネットワーク リソースがジョブで必要になる場合があります。</span><span class="sxs-lookup"><span data-stu-id="04702-272">Also, a job might require a shared network resource that must be configured for the service account.</span></span> <span data-ttu-id="04702-273">詳細については、「 [Windows サービス アカウントと権限の構成](../../database-engine/configure-windows/configure-windows-service-accounts-and-permissions.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="04702-273">For information, see [Configure Windows Service Accounts and Permissions](../../database-engine/configure-windows/configure-windows-service-accounts-and-permissions.md).</span></span>  
  
-   [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="04702-274">の特定のインスタンスに関連付けられている [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]エージェント サービスには独自のレジストリ ハイブが設定されているので、SQL Server エージェント サービスのジョブは、通常、このレジストリ ハイブの 1 つ以上の設定に依存します。</span><span class="sxs-lookup"><span data-stu-id="04702-274">Agent service, which is associated with a specific instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], has its own registry hive, and its jobs typically have dependencies on one or more of the settings in this registry hive.</span></span> <span data-ttu-id="04702-275">ジョブが適切に動作するには、それらのレジストリ設定が必要です。</span><span class="sxs-lookup"><span data-stu-id="04702-275">To behave as intended, a job requires those registry settings.</span></span> <span data-ttu-id="04702-276">スクリプトを使用して別の [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] エージェント サービスにジョブを再作成した場合、その SQL Server エージェント サービスのレジストリには、再作成されたジョブに適したレジストリ設定が行われない場合があります。</span><span class="sxs-lookup"><span data-stu-id="04702-276">If you use a script to re-create a job in another [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent service, its registry might not have the correct settings for that job.</span></span> <span data-ttu-id="04702-277">再作成したジョブを対象のサーバー インスタンスで適切に動作させるには、元の [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] エージェント サービスと対象の SQL Server エージェント サービスのレジストリ設定が同じである必要があります。</span><span class="sxs-lookup"><span data-stu-id="04702-277">For re-created jobs to behave correctly on a destination server instance, the original and destination [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent services should have the same registry settings.</span></span>  
  
    > [!CAUTION]  
    >  <span data-ttu-id="04702-278">現在のレジストリ設定が他のジョブで必要な場合、ジョブの再作成を処理するために対象の [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] エージェント サービスのレジストリ設定を変更すると、問題が発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="04702-278">Changing registry settings on the destination [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent service to handle a re-created job could be problematic if the current settings are required by other jobs.</span></span> <span data-ttu-id="04702-279">さらに、レジストリを誤って編集すると、システムに重大な障害が発生する場合があります。</span><span class="sxs-lookup"><span data-stu-id="04702-279">Furthermore, incorrectly editing the registry can severely damage your system.</span></span> <span data-ttu-id="04702-280">レジストリを変更する前に、コンピューター上の重要なすべてのデータをバックアップすることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="04702-280">Before you make changes to the registry, we recommend that you back up any valued data on the computer.</span></span>  
  
-   [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="04702-281">エージェント プロキシ</span><span class="sxs-lookup"><span data-stu-id="04702-281">Agent Proxies</span></span>  
  
     <span data-ttu-id="04702-282">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] エージェント プロキシでは、指定されたジョブ ステップのセキュリティ コンテキストを定義します。</span><span class="sxs-lookup"><span data-stu-id="04702-282">A [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent proxy defines the security context for a specified job step.</span></span> <span data-ttu-id="04702-283">ジョブを対象のサーバー インスタンス上で実行する場合、そのジョブに必要なすべてのプロキシをそのインスタンス上で手動で再作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="04702-283">For a job to run on the destination server instance, all the proxies it requires must be manually re-created on that instance.</span></span> <span data-ttu-id="04702-284">詳細については、「 [SQL Server エージェント プロキシの作成](../../ssms/agent/create-a-sql-server-agent-proxy.md) 」および「 [プロキシを使用するマルチサーバー ジョブのトラブルシューティング](../../ssms/agent/troubleshoot-multiserver-jobs-that-use-proxies.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="04702-284">For more information, see [Create a SQL Server Agent Proxy](../../ssms/agent/create-a-sql-server-agent-proxy.md) and [Troubleshoot Multiserver Jobs That Use Proxies](../../ssms/agent/troubleshoot-multiserver-jobs-that-use-proxies.md).</span></span>  
  
 <span data-ttu-id="04702-285">詳細については、次のトピックも参照してください。</span><span class="sxs-lookup"><span data-stu-id="04702-285">For more information, see also:</span></span>  
  
-   [<span data-ttu-id="04702-286">ジョブの実装</span><span class="sxs-lookup"><span data-stu-id="04702-286">Implement Jobs</span></span>](../../ssms/agent/implement-jobs.md)  
  
-   <span data-ttu-id="04702-287">[役割の交代後のログインとジョブの管理 &#40;SQL Server&#41;](../../sql-server/failover-clusters/management-of-logins-and-jobs-after-role-switching-sql-server.md) (データベース ミラーリングの場合)</span><span class="sxs-lookup"><span data-stu-id="04702-287">[Management of Logins and Jobs After Role Switching &#40;SQL Server&#41;](../../sql-server/failover-clusters/management-of-logins-and-jobs-after-role-switching-sql-server.md) (for database mirroring)</span></span>  
  
-   <span data-ttu-id="04702-288">[Windows サービス アカウントと権限の構成](../../database-engine/configure-windows/configure-windows-service-accounts-and-permissions.md) ( [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]のインスタンスをインストールする場合)</span><span class="sxs-lookup"><span data-stu-id="04702-288">[Configure Windows Service Accounts and Permissions](../../database-engine/configure-windows/configure-windows-service-accounts-and-permissions.md) (when you install an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)])</span></span>  
  
-   <span data-ttu-id="04702-289">[SQL Server エージェントの構成](../../ssms/agent/sql-server-agent.md) ( [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]のインスタンスをインストールする場合)</span><span class="sxs-lookup"><span data-stu-id="04702-289">[Configure SQL Server Agent](../../ssms/agent/sql-server-agent.md) (when you install an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)])</span></span>  
  
-   [<span data-ttu-id="04702-290">SQL Server エージェントのセキュリティの実装</span><span class="sxs-lookup"><span data-stu-id="04702-290">Implement SQL Server Agent Security</span></span>](../../ssms/agent/implement-sql-server-agent-security.md)  
  
 <span data-ttu-id="04702-291">**既存のジョブと各ジョブのプロパティを表示するには**</span><span class="sxs-lookup"><span data-stu-id="04702-291">**To view existing jobs and their properties**</span></span>  
  
-   [<span data-ttu-id="04702-292">ジョブの利用状況の監視</span><span class="sxs-lookup"><span data-stu-id="04702-292">Monitor Job Activity</span></span>](../../ssms/agent/monitor-job-activity.md)  
  
-   [<span data-ttu-id="04702-293">sp_help_job &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="04702-293">sp_help_job &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-stored-procedures/sp-help-job-transact-sql)  
  
-   [<span data-ttu-id="04702-294">View Job Step Information</span><span class="sxs-lookup"><span data-stu-id="04702-294">View Job Step Information</span></span>](../../ssms/agent/view-job-step-information.md)  
  
-   [<span data-ttu-id="04702-295">dbo.sysjobs &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="04702-295">dbo.sysjobs &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-tables/dbo-sysjobs-transact-sql)  
  
 <span data-ttu-id="04702-296">**ジョブを作成するには**</span><span class="sxs-lookup"><span data-stu-id="04702-296">**To create a job**</span></span>  
  
-   [<span data-ttu-id="04702-297">ジョブの作成</span><span class="sxs-lookup"><span data-stu-id="04702-297">Create a Job</span></span>](../../ssms/agent/create-a-job.md)  
  
-   [<span data-ttu-id="04702-298">ジョブの作成</span><span class="sxs-lookup"><span data-stu-id="04702-298">Create a Job</span></span>](../../ssms/agent/create-a-job.md)  
  
#### <a name="best-practices-for-using-a-script-to-re-create-a-job"></a><span data-ttu-id="04702-299">ジョブを再作成するスクリプトを使用する場合の推奨事項</span><span class="sxs-lookup"><span data-stu-id="04702-299">Best Practices for Using a Script to Re-create a Job</span></span>  
 <span data-ttu-id="04702-300">まず、簡単なジョブのスクリプトを作成し、別の [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] エージェント サービスでジョブを再作成し、そのジョブを実行して適切に動作するかどうかを確認することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="04702-300">We recommend that you start by scripting a simple job, re-creating the job on the other [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent service, and running the job to see whether it works as intended.</span></span> <span data-ttu-id="04702-301">これにより、互換性のない部分を確認し、それらの解決に取り組むことができます。</span><span class="sxs-lookup"><span data-stu-id="04702-301">This will let you to identify incompatibilities and try to resolve them.</span></span> <span data-ttu-id="04702-302">スクリプト化したジョブが新しい環境で正常に動作しない場合、新しい環境で正常に動作する同等のジョブを作成することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="04702-302">If a scripted job does not work as intended in its new environment, we recommend that you create an equivalent job that works correctly in that environment.</span></span>  
  
 [<span data-ttu-id="04702-303">&#91;先頭に戻る&#93;</span><span class="sxs-lookup"><span data-stu-id="04702-303">&#91;Top&#93;</span></span>](#information_entities_and_objects)  
  
##  <a name="logins"></a><a name="logins"></a><span data-ttu-id="04702-304">ログイン</span><span class="sxs-lookup"><span data-stu-id="04702-304">Logins</span></span>  
 <span data-ttu-id="04702-305">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] のインスタンスにログインするには、有効な [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ログインが必要です。</span><span class="sxs-lookup"><span data-stu-id="04702-305">Logging into an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] requires a valid [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login.</span></span> <span data-ttu-id="04702-306">このログインは、プリンシパルが [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]のインスタンスに接続できるかどうかを確認する認証プロセスで使用されます。</span><span class="sxs-lookup"><span data-stu-id="04702-306">This login is used in the authentication process that verifies whether the principal can connect to the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="04702-307">対応する [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ログインが未定義のデータベース ユーザー、またはサーバー インスタンスで適切に定義されていないデータベース ユーザーは、インスタンスにログインできません。</span><span class="sxs-lookup"><span data-stu-id="04702-307">A database user for which the corresponding [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login is undefined or is incorrectly defined on a server instance cannot log in to the instance.</span></span> <span data-ttu-id="04702-308">このようなユーザーは、そのサーバー インスタンスのデータベースの *孤立ユーザー* と呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="04702-308">Such a user is said to be an *orphaned user* of the database on that server instance.</span></span> <span data-ttu-id="04702-309">データベースを [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]の別のインスタンスに復元、アタッチ、またはコピーした後、データベース ユーザーが孤立する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="04702-309">A database user can become orphaned if after a database is restored, attached, or copied to a different instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>  
  
 <span data-ttu-id="04702-310">元のデータベースのコピーに含まれている一部またはすべてのオブジェクトに対するスクリプトは、SQL Server スクリプト生成ウィザードを使用して、 **[スクリプト オプションの選択]** ページで **[スクリプト ログイン]** オプションを **[True]** に設定することで作成できます。</span><span class="sxs-lookup"><span data-stu-id="04702-310">To generate a script for some or all the objects in the original copy of the database, you can use the Generate Scripts Wizard, and in the **Choose Script Options** dialog box, set the **Script Logins** option to **True**.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="04702-311">ミラー化されたデータベースのログインを設定する方法については、「[データベース ミラーリングまたは AlwaysOn 可用性グループのログイン アカウントの設定 &#40;SQL Server&#41;](../../database-engine/database-mirroring/set-up-login-accounts-database-mirroring-always-on-availability.md)」および「[役割の交代後のログインとジョブの管理 &#40;SQL Server&#41;](../../sql-server/failover-clusters/management-of-logins-and-jobs-after-role-switching-sql-server.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="04702-311">For information about how to set up logins for a mirrored database, see [Set Up Login Accounts for Database Mirroring or AlwaysOn Availability Groups &#40;SQL Server&#41;](../../database-engine/database-mirroring/set-up-login-accounts-database-mirroring-always-on-availability.md) and [Management of Logins and Jobs After Role Switching &#40;SQL Server&#41;](../../sql-server/failover-clusters/management-of-logins-and-jobs-after-role-switching-sql-server.md).</span></span>  
  
 [<span data-ttu-id="04702-312">&#91;先頭に戻る&#93;</span><span class="sxs-lookup"><span data-stu-id="04702-312">&#91;Top&#93;</span></span>](#information_entities_and_objects)  
  
##  <a name="permissions"></a><a name="permissions"></a> <span data-ttu-id="04702-313">Permissions</span><span class="sxs-lookup"><span data-stu-id="04702-313">Permissions</span></span>  
 <span data-ttu-id="04702-314">次の種類の権限は、データベースが別のサーバー インスタンスで使用できるようになったときに影響を受ける場合があります。</span><span class="sxs-lookup"><span data-stu-id="04702-314">The following types of permissions might be affected when a database is made available on another server instance.</span></span>  
  
-   <span data-ttu-id="04702-315">システム オブジェクトに対する GRANT 権限、REVOKE 権限、または DENY 権限</span><span class="sxs-lookup"><span data-stu-id="04702-315">GRANT, REVOKE, or DENY permissions on system objects</span></span>  
  
-   <span data-ttu-id="04702-316">サーバー インスタンスに対する GRANT 権限、REVOKE 権限、または DENY 権限 (*サーバーレベルの権限*)</span><span class="sxs-lookup"><span data-stu-id="04702-316">GRANT, REVOKE, or DENY permissions on server instance (*server-level permissions*)</span></span>  
  
### <a name="grant-revoke-and-deny-permissions-on-system-objects"></a><span data-ttu-id="04702-317">システム オブジェクトに対する GRANT 権限、REVOKE 権限、または DENY 権限</span><span class="sxs-lookup"><span data-stu-id="04702-317">GRANT, REVOKE, and DENY Permissions on System Objects</span></span>  
 <span data-ttu-id="04702-318">ストアド プロシージャ、拡張ストアド プロシージャ、関数、ビューなどのシステム オブジェクトに対する権限は、 **master** データベースに格納されるので、対象のサーバー インスタンスで構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="04702-318">Permissions on system objects such as stored procedures, extended stored procedures, functions, and views, are stored in the **master** database and must be configured on the destination server instance.</span></span>  
  
 <span data-ttu-id="04702-319">元のデータベースのコピーに含まれている一部またはすべてのオブジェクトに対するスクリプトは、スクリプト生成ウィザードを使用して、 **[スクリプト オプションの選択]** ページで **[オブジェクトレベル権限のスクリプトを作成]** オプションを **[True]** に設定することで作成できます。</span><span class="sxs-lookup"><span data-stu-id="04702-319">To generate a script for some or all the objects in the original copy of the database, you can use the Generate Scripts Wizard, and in the **Choose Script Options** dialog box, set the **Script Object-Level Permissions** option to **True**.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="04702-320">ログインのスクリプトを作成する場合、パスワードはスクリプトに含まれません。</span><span class="sxs-lookup"><span data-stu-id="04702-320">If you script logins, the passwords are not scripted.</span></span> <span data-ttu-id="04702-321">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 認証を使用するログインがある場合、対象のサーバー インスタンスでスクリプトを変更する必要があります。</span><span class="sxs-lookup"><span data-stu-id="04702-321">If you have logins that use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication, you have to modify the script on the destination.</span></span>  
  
 <span data-ttu-id="04702-322">システム オブジェクトは、 [sys.system_objects](/sql/relational-databases/system-catalog-views/sys-system-objects-transact-sql) カタログ ビューで確認できます。</span><span class="sxs-lookup"><span data-stu-id="04702-322">System objects are visible in the [sys.system_objects](/sql/relational-databases/system-catalog-views/sys-system-objects-transact-sql) catalog view.</span></span> <span data-ttu-id="04702-323">システム オブジェクトの権限は、 [master](/sql/relational-databases/system-catalog-views/sys-database-permissions-transact-sql) データベースの **sys.database_permissions** カタログ ビューで確認できます。</span><span class="sxs-lookup"><span data-stu-id="04702-323">The permissions on system objects are visible in the [sys.database_permissions](/sql/relational-databases/system-catalog-views/sys-database-permissions-transact-sql) catalog view in the **master** database.</span></span> <span data-ttu-id="04702-324">これらのカタログ ビューに対するクエリの実行およびシステム オブジェクト権限の付与に関する詳細については、「[GRANT (システム オブジェクトの権限の許可) &#40;Transact-SQL&#41;](/sql/t-sql/statements/grant-system-object-permissions-transact-sql)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="04702-324">For information about querying these catalog views and granting system-object permissions, see [GRANT System Object Permissions &#40;Transact-SQL&#41;](/sql/t-sql/statements/grant-system-object-permissions-transact-sql).</span></span> <span data-ttu-id="04702-325">詳細については、「[REVOKE (サーバーの権限の取り消し) &#40;Transact-SQL&#41;](/sql/t-sql/statements/revoke-system-object-permissions-transact-sql)」および「[DENY (サーバーの権限の拒否) &#40;Transact-SQL&#41;](/sql/t-sql/statements/deny-system-object-permissions-transact-sql)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="04702-325">For more information, see [REVOKE System Object Permissions &#40;Transact-SQL&#41;](/sql/t-sql/statements/revoke-system-object-permissions-transact-sql) and [DENY System Object Permissions &#40;Transact-SQL&#41;](/sql/t-sql/statements/deny-system-object-permissions-transact-sql).</span></span>  
  
### <a name="grant-revoke-and-deny-permissions-on-a-server-instance"></a><span data-ttu-id="04702-326">サーバー インスタンスに対する GRANT 権限、REVOKE 権限、および DENY 権限</span><span class="sxs-lookup"><span data-stu-id="04702-326">GRANT, REVOKE, and DENY Permissions on a Server Instance</span></span>  
 <span data-ttu-id="04702-327">サーバー スコープの権限は **master** データベースに格納されるので、対象のサーバー インスタンスで構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="04702-327">Permissions at the server scope are stored in the **master** database and must be configured on the destination server instance.</span></span> <span data-ttu-id="04702-328">サーバー インスタンスのサーバー権限の詳細については [sys.server_permissions](/sql/relational-databases/system-catalog-views/sys-server-permissions-transact-sql) カタログ ビュー、サーバー プリンシパルの詳細については [sys.server_principals](/sql/relational-databases/system-catalog-views/sys-server-principals-transact-sql)カタログ ビュー、サーバー ロールのメンバーシップの詳細については [sys.server_role_members](/sql/relational-databases/system-catalog-views/sys-server-role-members-transact-sql) カタログ ビューに対してクエリを実行してください。</span><span class="sxs-lookup"><span data-stu-id="04702-328">For information about the server permissions of a server instance, query the [sys.server_permissions](/sql/relational-databases/system-catalog-views/sys-server-permissions-transact-sql) catalog view, for information about server principals query the [sys.server_principals](/sql/relational-databases/system-catalog-views/sys-server-principals-transact-sql)s catalog view, and for information about membership of server roles query the [sys.server_role_members](/sql/relational-databases/system-catalog-views/sys-server-role-members-transact-sql) catalog view.</span></span>  
  
 <span data-ttu-id="04702-329">詳細については、「[GRANT (サーバーの権限の許可) &#40;Transact-SQL&#41;](/sql/t-sql/statements/grant-server-permissions-transact-sql)」、「[REVOKE (サーバーの権限の取り消し) &#40;Transact-SQL&#41;](/sql/t-sql/statements/revoke-server-permissions-transact-sql)」、および「[DENY (サーバーの権限の拒否) &#40;Transact-SQL&#41;](/sql/t-sql/statements/deny-server-permissions-transact-sql)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="04702-329">For more information, see [GRANT Server Permissions &#40;Transact-SQL&#41;](/sql/t-sql/statements/grant-server-permissions-transact-sql), [REVOKE Server Permissions &#40;Transact-SQL&#41;](/sql/t-sql/statements/revoke-server-permissions-transact-sql), and [DENY Server Permissions &#40;Transact-SQL&#41;](/sql/t-sql/statements/deny-server-permissions-transact-sql).</span></span>  
  
#### <a name="server-level-permissions-for-a-certificate-or-asymmetric-key"></a><span data-ttu-id="04702-330">証明書または非対称キーのサーバー レベルの権限</span><span class="sxs-lookup"><span data-stu-id="04702-330">Server-Level Permissions for a Certificate or Asymmetric Key</span></span>  
 <span data-ttu-id="04702-331">サーバー レベルの権限を証明書または非対称キーに直接与えることはできません。</span><span class="sxs-lookup"><span data-stu-id="04702-331">Server-level permissions cannot be granted directly to a certificate or asymmetric key.</span></span> <span data-ttu-id="04702-332">代わりに、特定の証明書または非対称キー用に排他的に作成された、マップされたログインにサーバー レベルの権限を与えます。</span><span class="sxs-lookup"><span data-stu-id="04702-332">Instead, server-level permissions are granted to a mapped login that is created exclusively for a specific certificate or asymmetric key.</span></span> <span data-ttu-id="04702-333">したがって、サーバー レベルの権限が必要な証明書または非対称キーには、独自の *証明書にマップされたログイン* または *非対称キーにマップされたログイン*が個別に必要です。</span><span class="sxs-lookup"><span data-stu-id="04702-333">Therefore, each certificate or asymmetric key that requires server-level permissions, requires its own *certificate-mapped login* or *asymmetric key-mapped login*.</span></span> <span data-ttu-id="04702-334">証明書または非対称キーにサーバー レベルの権限を与えるには、それぞれのマップされるログインに権限を与えます。</span><span class="sxs-lookup"><span data-stu-id="04702-334">To grant server-level permissions for a certificate or asymmetric key, grant the permissions to its mapped login.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="04702-335">マップされたログインは、対応する証明書または非対称キーを使用して署名されたコードの承認にのみ使用されます。</span><span class="sxs-lookup"><span data-stu-id="04702-335">A mapped login is used only for authorization of code signed with the corresponding certificate or asymmetric key.</span></span> <span data-ttu-id="04702-336">マップされたログインを認証に使用することはできません。</span><span class="sxs-lookup"><span data-stu-id="04702-336">Mapped logins cannot be used for authentication.</span></span>  
  
 <span data-ttu-id="04702-337">マップされたログインとその権限は、どちらも **master**データベースに存在します。</span><span class="sxs-lookup"><span data-stu-id="04702-337">The mapped login and its permissions both reside in **master**.</span></span> <span data-ttu-id="04702-338">証明書または非対称キーが **master**以外のデータベースに存在する場合は、 **master** データベースで証明書または非対称キーを再作成して任意のログインにマップする必要があります。</span><span class="sxs-lookup"><span data-stu-id="04702-338">If a certificate or asymmetric key resides in a database other than **master**, you must re-create it in **master** and map it to a login.</span></span> <span data-ttu-id="04702-339">そのデータベースを別のサーバー インスタンスに移動、コピー、または復元する場合は、対象のサーバー インスタンスの **master** データベースに存在する証明書または非対称キーを再作成してログインにマップし、必要なサーバー レベルの権限をそのログインに与える必要があります。</span><span class="sxs-lookup"><span data-stu-id="04702-339">If you move, copy, or restore the database to another server instance, you must re-create its certificate or asymmetric key in the **master** database of the destination server instance, map to a login, and grant the required server-level permissions to the login.</span></span>  
  
 <span data-ttu-id="04702-340">**証明書または非対称キーを作成するには**</span><span class="sxs-lookup"><span data-stu-id="04702-340">**To create a certificate or asymmetric key**</span></span>  
  
-   [<span data-ttu-id="04702-341">CREATE CERTIFICATE &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="04702-341">CREATE CERTIFICATE &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/create-certificate-transact-sql)  
  
-   [<span data-ttu-id="04702-342">CREATE ASYMMETRIC KEY &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="04702-342">CREATE ASYMMETRIC KEY &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/create-asymmetric-key-transact-sql)  
  
 <span data-ttu-id="04702-343">**ログインに証明書または非対称キーをマップするには**</span><span class="sxs-lookup"><span data-stu-id="04702-343">**To map a certificate or asymmetric key to a login**</span></span>  
  
-   [<span data-ttu-id="04702-344">CREATE LOGIN &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="04702-344">CREATE LOGIN &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/create-login-transact-sql)  
  
 <span data-ttu-id="04702-345">**マップされたログインに権限を割り当てるには**</span><span class="sxs-lookup"><span data-stu-id="04702-345">**To assign permissions to the mapped login**</span></span>  
  
-   [<span data-ttu-id="04702-346">GRANT (サーバーの権限の許可) &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="04702-346">GRANT Server Permissions &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/grant-server-permissions-transact-sql)  
  
 <span data-ttu-id="04702-347">証明書および非対称キーの詳細については、「 [Encryption Hierarchy](../security/encryption/encryption-hierarchy.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="04702-347">For more information about certificates and asymmetric keys, see [Encryption Hierarchy](../security/encryption/encryption-hierarchy.md).</span></span>  
  
 [<span data-ttu-id="04702-348">&#91;先頭に戻る&#93;</span><span class="sxs-lookup"><span data-stu-id="04702-348">&#91;Top&#93;</span></span>](#information_entities_and_objects)  
  
##  <a name="replication-settings"></a><a name="replication_settings"></a><span data-ttu-id="04702-349">レプリケーションの設定</span><span class="sxs-lookup"><span data-stu-id="04702-349">Replication Settings</span></span>  
 <span data-ttu-id="04702-350">レプリケートされたデータベースのバックアップを別のサーバーまたはデータベースに復元する場合は、レプリケーションの設定は保存できません。</span><span class="sxs-lookup"><span data-stu-id="04702-350">If you restore a backup of a replicated database to another server or database, replication settings cannot be preserved.</span></span> <span data-ttu-id="04702-351">この場合、バックアップの復元後にすべてのパブリケーションおよびサブスクリプションを再作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="04702-351">In this case, you must re-create all publications and subscriptions after backups are restored.</span></span> <span data-ttu-id="04702-352">この処理を簡単にするには、現在のレプリケーションの設定を行うスクリプトと、レプリケーションの有効化および無効化を行うスクリプトを作成します。</span><span class="sxs-lookup"><span data-stu-id="04702-352">To make this process easier, create scripts for your current replication settings and, also, for the enabling and disabling of replication.</span></span> <span data-ttu-id="04702-353">レプリケーションの設定の再作成を容易にするには、これらのスクリプトをコピーし、対象のサーバー インスタンスで動作するようにサーバー名の参照を変更します。</span><span class="sxs-lookup"><span data-stu-id="04702-353">To help re-create your replication settings, copy these scripts and change the server name references to work for the destination server instance.</span></span>  
  
 <span data-ttu-id="04702-354">詳細については、「[レプリケートされたデータベースのバックアップと復元](../replication/administration/back-up-and-restore-replicated-databases.md)」、「[データベース ミラーリングとレプリケーション &#40;SQL Server&#41;](../../database-engine/database-mirroring/database-mirroring-and-replication-sql-server.md)」、および「[ログ配布とレプリケーション &#40;SQL Server&#41;](../../database-engine/log-shipping/log-shipping-and-replication-sql-server.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="04702-354">For more information, see [Back Up and Restore Replicated Databases](../replication/administration/back-up-and-restore-replicated-databases.md), [Database Mirroring and Replication &#40;SQL Server&#41;](../../database-engine/database-mirroring/database-mirroring-and-replication-sql-server.md), and [Log Shipping and Replication &#40;SQL Server&#41;](../../database-engine/log-shipping/log-shipping-and-replication-sql-server.md).</span></span>  
  
 [<span data-ttu-id="04702-355">&#91;先頭に戻る&#93;</span><span class="sxs-lookup"><span data-stu-id="04702-355">&#91;Top&#93;</span></span>](#information_entities_and_objects)  
  
##  <a name="service-broker-applications"></a><a name="sb_applications"></a><span data-ttu-id="04702-356">Service Broker アプリケーション</span><span class="sxs-lookup"><span data-stu-id="04702-356">Service Broker Applications</span></span>  
 <span data-ttu-id="04702-357">[!INCLUDE[ssSB](../../includes/sssb-md.md)] アプリケーションに関連する多くの要素は、データベースに伴って使用できます。</span><span class="sxs-lookup"><span data-stu-id="04702-357">Many aspects of a [!INCLUDE[ssSB](../../includes/sssb-md.md)] application move with the database.</span></span> <span data-ttu-id="04702-358">ただし、アプリケーションの一部の要素は、新しい場所で再作成または再構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="04702-358">However, some aspects of the application must be re-created or reconfigured in the new location.</span></span>  
  
 [<span data-ttu-id="04702-359">&#91;先頭に戻る&#93;</span><span class="sxs-lookup"><span data-stu-id="04702-359">&#91;Top&#93;</span></span>](#information_entities_and_objects)  
  
##  <a name="startup-procedures"></a><a name="startup_procedures"></a><span data-ttu-id="04702-360">スタートアッププロシージャ</span><span class="sxs-lookup"><span data-stu-id="04702-360">Startup Procedures</span></span>  
 <span data-ttu-id="04702-361">スタートアップ プロシージャは、自動的に実行するように設定され、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] を起動するたびに実行されるストアド プロシージャです。</span><span class="sxs-lookup"><span data-stu-id="04702-361">A startup procedure is a stored procedure that is marked for automatic execution and is executed every time [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] starts.</span></span> <span data-ttu-id="04702-362">データベースがスタートアップ プロシージャに依存している場合、それらのスタートアップ プロシージャを対象のサーバー インスタンスで定義し、スタートアップ時に自動的に実行されるように構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="04702-362">If the database depends on any startup procedures, they must be defined on the destination server instance and be configured to be automatically executed at startup.</span></span>  
  
 [<span data-ttu-id="04702-363">&#91;先頭に戻る&#93;</span><span class="sxs-lookup"><span data-stu-id="04702-363">&#91;Top&#93;</span></span>](#information_entities_and_objects)  
  
##  <a name="triggers-at-server-level"></a><a name="triggers"></a><span data-ttu-id="04702-364">トリガー (サーバーレベル)</span><span class="sxs-lookup"><span data-stu-id="04702-364">Triggers (at Server Level)</span></span>  
 <span data-ttu-id="04702-365">DDL トリガーにより、さまざまなデータ定義言語 (DDL) イベントに応答してストアド プロシージャが起動されます。</span><span class="sxs-lookup"><span data-stu-id="04702-365">DDL triggers fire stored procedures in response to a variety of Data Definition Language (DDL) events.</span></span> <span data-ttu-id="04702-366">これらのイベントは、主にキーワード CREATE、ALTER、および DROP で始まる [!INCLUDE[tsql](../../includes/tsql-md.md)] ステートメントに対応します。</span><span class="sxs-lookup"><span data-stu-id="04702-366">These events primarily correspond to [!INCLUDE[tsql](../../includes/tsql-md.md)] statements that start with the keywords CREATE, ALTER, and DROP.</span></span> <span data-ttu-id="04702-367">DDL と同様の操作を実行する特定のシステム ストアド プロシージャも DDL トリガーを起動できます。</span><span class="sxs-lookup"><span data-stu-id="04702-367">Certain system stored procedures that perform DDL-like operations can also fire DDL triggers.</span></span>  
  
 <span data-ttu-id="04702-368">この機能の詳細については、「 [DDL Triggers](../triggers/ddl-triggers.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="04702-368">For more information about this feature, see [DDL Triggers](../triggers/ddl-triggers.md).</span></span>  
  
 [<span data-ttu-id="04702-369">&#91;先頭に戻る&#93;</span><span class="sxs-lookup"><span data-stu-id="04702-369">&#91;Top&#93;</span></span>](#information_entities_and_objects)  
  
## <a name="see-also"></a><span data-ttu-id="04702-370">参照</span><span class="sxs-lookup"><span data-stu-id="04702-370">See Also</span></span>  
 <span data-ttu-id="04702-371">[包含データベース](contained-databases.md) </span><span class="sxs-lookup"><span data-stu-id="04702-371">[Contained Databases](contained-databases.md) </span></span>  
 <span data-ttu-id="04702-372">[他のサーバーへのデータベースのコピー](copy-databases-to-other-servers.md) </span><span class="sxs-lookup"><span data-stu-id="04702-372">[Copy Databases to Other Servers](copy-databases-to-other-servers.md) </span></span>  
 <span data-ttu-id="04702-373">[データベースのデタッチとアタッチ &#40;SQL Server&#41;](database-detach-and-attach-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="04702-373">[Database Detach and Attach &#40;SQL Server&#41;](database-detach-and-attach-sql-server.md) </span></span>  
 <span data-ttu-id="04702-374">[ログ配布のセカンダリ &#40;SQL Server にフェールオーバーする&#41;](../../database-engine/log-shipping/fail-over-to-a-log-shipping-secondary-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="04702-374">[Fail Over to a Log Shipping Secondary &#40;SQL Server&#41;](../../database-engine/log-shipping/fail-over-to-a-log-shipping-secondary-sql-server.md) </span></span>  
 <span data-ttu-id="04702-375">[データベース ミラーリング セッション中の役割の交代 &#40;SQL Server&#41;](../../database-engine/database-mirroring/role-switching-during-a-database-mirroring-session-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="04702-375">[Role Switching During a Database Mirroring Session &#40;SQL Server&#41;](../../database-engine/database-mirroring/role-switching-during-a-database-mirroring-session-sql-server.md) </span></span>  
 <span data-ttu-id="04702-376">[暗号化されたミラーデータベースを設定する](../../database-engine/database-mirroring/set-up-an-encrypted-mirror-database.md) </span><span class="sxs-lookup"><span data-stu-id="04702-376">[Set Up an Encrypted Mirror Database](../../database-engine/database-mirroring/set-up-an-encrypted-mirror-database.md) </span></span>  
 <span data-ttu-id="04702-377">[SQL Server 構成マネージャー](../sql-server-configuration-manager.md) </span><span class="sxs-lookup"><span data-stu-id="04702-377">[SQL Server Configuration Manager](../sql-server-configuration-manager.md) </span></span>  
 [<span data-ttu-id="04702-378">孤立ユーザーのトラブルシューティング &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="04702-378">Troubleshoot Orphaned Users &#40;SQL Server&#41;</span></span>](../../sql-server/failover-clusters/troubleshoot-orphaned-users-sql-server.md)  
  
  
