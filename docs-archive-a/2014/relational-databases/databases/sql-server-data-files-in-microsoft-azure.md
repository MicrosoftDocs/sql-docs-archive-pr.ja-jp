---
title: Azure でのデータファイルの SQL Server |Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: supportability
ms.topic: conceptual
ms.assetid: 38ffd9c2-18a5-43d2-b674-e425addec4e4
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 21f960a50ed48ff2b146d96b73a1609d73b35c32
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87712002"
---
# <a name="sql-server-data-files-in-azure"></a><span data-ttu-id="ab824-102">Azure 内の SQL Server データ ファイル</span><span class="sxs-lookup"><span data-stu-id="ab824-102">SQL Server Data Files in Azure</span></span>
  <span data-ttu-id="ab824-103">Azure のデータファイルを SQL Server すると、Azure Blob として格納されている SQL Server データベースファイルのネイティブサポートが有効になります。</span><span class="sxs-lookup"><span data-stu-id="ab824-103">SQL Server Data Files in Azure enables native support for SQL Server database files stored as Azure Blobs.</span></span> <span data-ttu-id="ab824-104">これを使用すると、オンプレミスまたは Azure の仮想マシンで実行されている SQL Server で、Azure Blob Storage のデータ専用のストレージの場所を使用してデータベースを作成できます。</span><span class="sxs-lookup"><span data-stu-id="ab824-104">It allows you to create a database in SQL Server running in on-premises or in a virtual machine in Azure with a dedicated storage location for your data in Azure Blob Storage.</span></span> <span data-ttu-id="ab824-105">この機能強化では特に、デタッチとアタッチの操作を使用することにより、コンピューター間でのデータベース移動が容易になります。</span><span class="sxs-lookup"><span data-stu-id="ab824-105">This enhancement especially simplifies to move databases between machines by using detach and attach operations.</span></span> <span data-ttu-id="ab824-106">また、Azure Storage から復元できるようにすることで、データベースバックアップファイル用の別の保存場所を提供します。</span><span class="sxs-lookup"><span data-stu-id="ab824-106">In addition, it provides an alternative storage location for your database backup files by allowing you to restore from or to Azure Storage.</span></span> <span data-ttu-id="ab824-107">このため、データの仮想化、移動、セキュリティ、および可用性の面での利点と、低コストと容易なメンテナンスで実現できる高可用性と柔軟なスケーリングにより、いくつかのハイブリッド ソリューションが有効になります。</span><span class="sxs-lookup"><span data-stu-id="ab824-107">Therefore, it enables several hybrid solutions by providing several benefits for data virtualization, data movement, security and availability, and any easy low costs and maintenance for high-availability and elastic scaling.</span></span>  
  
 <span data-ttu-id="ab824-108">このトピックでは、Azure Storage サービスに SQL Server データファイルを格納する際の中心となる概念と考慮事項について説明します。</span><span class="sxs-lookup"><span data-stu-id="ab824-108">This topic introduces concepts and considerations that are central to storing SQL Server data files in Azure Storage Service.</span></span>  
  
 <span data-ttu-id="ab824-109">この新機能を実際に使用する方法については、「[チュートリアル: Azure Storage サービスでのデータファイルの SQL Server](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ab824-109">For a practical hands-on experience on how to use this new feature, see [Tutorial: SQL Server Data Files in Azure Storage service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span></span>  
  
 <span data-ttu-id="ab824-110">次の図は、この拡張機能により、サーバーが存在する場所に関係なく、SQL Server データベースファイルを Azure blob として Azure Storage 格納できることを示しています。</span><span class="sxs-lookup"><span data-stu-id="ab824-110">The following diagram demonstrates that this enhancement enables you to store SQL Server database files as Azure blobs in Azure Storage regardless of where your server resides.</span></span>  
  
 <span data-ttu-id="ab824-111">![SQL Server Azure Storage との統合](../../database-engine/media/sql-server-dbfiles-stored-as-blobs.gif "SQL Server Azure Storage との統合")</span><span class="sxs-lookup"><span data-stu-id="ab824-111">![SQL Server Integration with Azure Storage](../../database-engine/media/sql-server-dbfiles-stored-as-blobs.gif "SQL Server Integration with Azure Storage")</span></span>  
  
## <a name="benefits-of-using-sql-server-data-files-in-azure"></a><span data-ttu-id="ab824-112">Azure で SQL Server データファイルを使用する利点</span><span class="sxs-lookup"><span data-stu-id="ab824-112">Benefits of using SQL Server Data Files in Azure</span></span>  
  
-   <span data-ttu-id="ab824-113">**容易で迅速な移行の利点:** この機能を使うと、オンプレミスのコンピューターの間でも、またオンプレミス環境とクラウド環境の間でも、アプリケーションを変更することなくデータベースを 1 つずつ移動するため、移行プロセスが容易になります。</span><span class="sxs-lookup"><span data-stu-id="ab824-113">**Easy and fast migration benefits:** This feature simplifies the migration process by moving one database at a time between machines in on-premises as well as between on-premises and cloud environments without any application changes.</span></span> <span data-ttu-id="ab824-114">このため、既存の内部設置型のインフラストラクチャを維持しつつ、インクリメンタルな移行を行うことができます。</span><span class="sxs-lookup"><span data-stu-id="ab824-114">Therefore, it supports an incremental migration while maintaining your existing on-premises infrastructure in place.</span></span> <span data-ttu-id="ab824-115">さらに、内部設置型の環境の複数拠点でアプリケーションを実行する必要がある場合も、集中管理されたデータ ストレージにアクセスできることで、アプリケーション ロジックが簡素化されます。</span><span class="sxs-lookup"><span data-stu-id="ab824-115">In addition, having access to a centralized data storage simplifies the application logic when an application needs to run in multiple locations in an on-premises environment.</span></span> <span data-ttu-id="ab824-116">場合によっては、地理的に分散している各地にコンピューター センターを短期間でセットアップし、多種多様なソースからデータを収集することもできます。</span><span class="sxs-lookup"><span data-stu-id="ab824-116">In some cases, you may need to rapidly setup computer centers in geographically dispersed locations, which gather data from many different sources.</span></span> <span data-ttu-id="ab824-117">この新しい機能強化を使用して、データを1つの場所から別の場所に移動する代わりに、多数のデータベースを Azure blob として格納し、Transact-sql スクリプトを実行してローカルコンピューターまたは仮想マシンにデータベースを作成することができます。</span><span class="sxs-lookup"><span data-stu-id="ab824-117">By using this new enhancement, instead of moving data from one location to another, you can store many databases as Azure blobs, and then run Transact-SQL scripts to create databases on the local machines or virtual machines.</span></span>  
  
-   <span data-ttu-id="ab824-118">**コストと無制限のストレージの利点:** この機能により、オンプレミスのコンピューティングリソースを活用しながら、Azure に無制限のオフサイトストレージを使用できます。</span><span class="sxs-lookup"><span data-stu-id="ab824-118">**Cost and limitless storage benefits:** This feature enables you to have limitless off-site storage in Azure while leveraging on-premises compute resources.</span></span> <span data-ttu-id="ab824-119">Azure をストレージの場所として使用すると、ハードウェア管理のオーバーヘッドを発生させることなく、アプリケーションロジックに簡単に集中できます。</span><span class="sxs-lookup"><span data-stu-id="ab824-119">When you use Azure as a storage location, you can easily focus on the application logic without the overhead of hardware management.</span></span> <span data-ttu-id="ab824-120">内部設置型のコンピューティング ノードが失われた場合は、データを移動することなく新しいノードをセットアップできます。</span><span class="sxs-lookup"><span data-stu-id="ab824-120">If you lose a computation node on-premises, you can set up a new one without any data movement.</span></span>  
  
-   <span data-ttu-id="ab824-121">**高可用性とディザスターリカバリーの利点:** Azure 機能で SQL Server データファイルを使用すると、高可用性とディザスターリカバリーのソリューションが簡略化されます。</span><span class="sxs-lookup"><span data-stu-id="ab824-121">**High availability and disaster recovery benefits:** Using SQL Server Data Files in Azure feature might simplify the high availability and disaster recovery solutions.</span></span> <span data-ttu-id="ab824-122">たとえば、Azure 内の仮想マシンまたは SQL Server のインスタンスがクラッシュした場合、Azure Blob へのリンクを再確立するだけで、新しいコンピューターでデータベースを再作成できます。</span><span class="sxs-lookup"><span data-stu-id="ab824-122">For example, if a virtual machine in Azure or an instance of SQL Server crashes, you can re-create your databases in a new machine by just re-establishing links to Azure Blobs.</span></span>  
  
-   <span data-ttu-id="ab824-123">**セキュリティの利点:** この新しい機能強化では、コンピューティング インスタンスをストレージ インスタンスから分離できます。</span><span class="sxs-lookup"><span data-stu-id="ab824-123">**Security benefits:** This new enhancement allows you to separate a compute instance from a storage instance.</span></span> <span data-ttu-id="ab824-124">データベースをフルに暗号化し、暗号化解除をストレージ インスタンスではなくコンピューティング インスタンスのみで行うことができます。</span><span class="sxs-lookup"><span data-stu-id="ab824-124">You can have a fully encrypted database with decryption only occurring on compute instance but not in a storage instance.</span></span> <span data-ttu-id="ab824-125">つまり、この新しい機能強化では、データとは物理的に分離された TDE (Transparent Data Encryption: 透過的なデータ暗号化) 証明書を使用して、パブリック クラウドに置くすべてのデータを暗号化できます。</span><span class="sxs-lookup"><span data-stu-id="ab824-125">In other words, using this new enhancement, you can encrypt all data in public cloud using Transparent Data Encryption (TDE)  certificates, which are physically separated from the data.</span></span> <span data-ttu-id="ab824-126">TDE キーは、物理的に安全な内部設置型のコンピューターに格納されローカルでバックアップされている master データベースに保存できます。</span><span class="sxs-lookup"><span data-stu-id="ab824-126">The TDE keys can be stored in the master database, which is stored locally in your physically secure on-premises machine and backed up locally.</span></span> <span data-ttu-id="ab824-127">これらのローカルキーを使用して、Azure Storage に存在するデータを暗号化できます。</span><span class="sxs-lookup"><span data-stu-id="ab824-127">You can use these local keys to encrypt the data, which resides in Azure Storage.</span></span> <span data-ttu-id="ab824-128">クラウド内のストレージ アカウントの資格情報が盗用されても、TDE 証明書は常に内部設置型の環境にあるため、データの安全性が維持されます。</span><span class="sxs-lookup"><span data-stu-id="ab824-128">If your cloud storage account credentials are stolen, your data still stays secure as the TDE certificates always reside in on-premises.</span></span>  
  
## <a name="concepts-and-requirements"></a><span data-ttu-id="ab824-129">概念と要件</span><span class="sxs-lookup"><span data-stu-id="ab824-129">Concepts and Requirements</span></span>  
  
### <a name="azure-storage-concepts"></a><span data-ttu-id="ab824-130">Azure Storage の概念</span><span class="sxs-lookup"><span data-stu-id="ab824-130">Azure Storage Concepts</span></span>  
 <span data-ttu-id="ab824-131">Azure の機能で SQL Server データ ファイルを使用する場合は、Azure 内でストレージ アカウントとコンテナーを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ab824-131">When using SQL Server Data Files in Azure feature, you need to create a storage account and a container in Azure.</span></span> <span data-ttu-id="ab824-132">次に、SQL Server 資格情報を作成する必要があります。これには、コンテナーのポリシーに関する情報と、コンテナーにアクセスするために必要な Shared Access Signature が含まれます。</span><span class="sxs-lookup"><span data-stu-id="ab824-132">Then, you need to create a SQL Server credential, which includes information on the policy of the container as well as a shared access signature that is necessary to access the container.</span></span>  
  
 <span data-ttu-id="ab824-133">Azure では、ストレージアカウントは、Blob にアクセスするための最も高いレベルの名前空間を表します。</span><span class="sxs-lookup"><span data-stu-id="ab824-133">In Azure, a storage account represents the highest level of the namespace for accessing Blobs.</span></span> <span data-ttu-id="ab824-134">ストレージ アカウントには、合計サイズが 500 TB までであれば、無制限の数のコンテナーを含めることができます。</span><span class="sxs-lookup"><span data-stu-id="ab824-134">A storage account can contain an unlimited number of containers, as long as their total size is under 500 TB.</span></span> <span data-ttu-id="ab824-135">ストレージの制限に関する最新情報については、「 [Azure のサブスクリプションとサービスの制限、クォータ、および制約](https://azure.microsoft.com/documentation/articles/azure-subscription-service-limits/)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ab824-135">For the latest information on storage limits, see [Azure Subscription and Service Limits, Quotas, and Constraints](https://azure.microsoft.com/documentation/articles/azure-subscription-service-limits/).</span></span> <span data-ttu-id="ab824-136">コンテナーでは、一連の BLOB をグループ化することができます。</span><span class="sxs-lookup"><span data-stu-id="ab824-136">A container provides a grouping of a set of Blobs.</span></span> <span data-ttu-id="ab824-137">BLOB はすべて、コンテナー内に存在する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ab824-137">All Blobs must be in a container.</span></span> <span data-ttu-id="ab824-138">アカウントには、無制限の数のコンテナーを含めることができます。</span><span class="sxs-lookup"><span data-stu-id="ab824-138">An account can contain an unlimited number of containers.</span></span> <span data-ttu-id="ab824-139">同様に、コンテナーには、無制限の数の BLOB を格納できます。</span><span class="sxs-lookup"><span data-stu-id="ab824-139">Similarly, a container can store an unlimited number of Blobs as well.</span></span> <span data-ttu-id="ab824-140">Azure Storage に格納できる BLOB には、ブロック BLOB とページ BLOB の 2 種類があります。</span><span class="sxs-lookup"><span data-stu-id="ab824-140">There are two types of blobs that can be stored in Azure Storage: block and page blobs.</span></span> <span data-ttu-id="ab824-141">この新しい機能ではページ BLOB が使用されます。ページ BLOB では 1 TB までのサイズがサポートされ、ファイル内のバイト範囲が頻繁に変更される場合はこちらの方が効率的です。</span><span class="sxs-lookup"><span data-stu-id="ab824-141">This new feature uses Page blobs, which can be up to 1TB in size, and are more efficient when ranges of bytes in a file are modified frequently.</span></span> <span data-ttu-id="ab824-142">BLOB には、 `http://storageaccount.blob.core.windows.net/<container>/<blob>`という URL 形式を使用してアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="ab824-142">You can access Blobs using the following URL format: `http://storageaccount.blob.core.windows.net/<container>/<blob>`.</span></span>  
  
### <a name="azure-billing-considerations"></a><span data-ttu-id="ab824-143">Azure の課金に関する注意点</span><span class="sxs-lookup"><span data-stu-id="ab824-143">Azure Billing Considerations</span></span>  
 <span data-ttu-id="ab824-144">Azure サービスの使用コストを見積もることは、意思決定および計画のプロセスにおいて重要です。</span><span class="sxs-lookup"><span data-stu-id="ab824-144">Estimating the cost of using Azure Services is an important matter in the decision making and planning process.</span></span> <span data-ttu-id="ab824-145">Azure Storage に SQL Server データ ファイルを格納する場合は、ストレージとトランザクションに関連するコストを支払う必要があります。</span><span class="sxs-lookup"><span data-stu-id="ab824-145">When storing SQL Server data files in Azure Storage, you need to pay costs associated with storage and transactions.</span></span> <span data-ttu-id="ab824-146">さらに、Azure Storage の機能への SQL Server データ ファイルの格納を実装する場合は、45 ～ 60 秒ごとに BLOB のリースの暗黙的な更新が必要になります。</span><span class="sxs-lookup"><span data-stu-id="ab824-146">In addition, the implementation of SQL Server Data Files in Azure Storage feature requires a renewal of Blob lease every 45 to 60 seconds implicitly.</span></span> <span data-ttu-id="ab824-147">その結果、.mdf、.ldf などのデータベース ファイルごとのトランザクション コストも必要になります。</span><span class="sxs-lookup"><span data-stu-id="ab824-147">This also results in transaction costs per database file, such as .mdf or .ldf.</span></span> <span data-ttu-id="ab824-148">予測では、2 個のデータベース ファイル (.mdf と .ldf) のリースを更新するコストは、現在の価格のモデルで 1 か月につき約 2 セントになります。</span><span class="sxs-lookup"><span data-stu-id="ab824-148">Based on our estimations, the cost of renewing leases for two database files (.mdf and .ldf) would be about 2 cents per month according to the current pricing model.</span></span> <span data-ttu-id="ab824-149">Azure Storage と Azure Virtual Machines の使用に関する月額コストを見積もるには、「 [Azure 料金](https://azure.microsoft.com/pricing/) 」の情報をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ab824-149">We recommend that you use the information on the [Azure Pricing](https://azure.microsoft.com/pricing/) page to help estimate the monthly costs associated with the use of Azure Storage and Azure Virtual Machines.</span></span>  
  
### <a name="sql-server-concepts"></a><span data-ttu-id="ab824-150">SQL サーバーの概念</span><span class="sxs-lookup"><span data-stu-id="ab824-150">SQL Server Concepts</span></span>  
 <span data-ttu-id="ab824-151">この新しい機能強化を使用する場合は、次のことを行う必要があります。</span><span class="sxs-lookup"><span data-stu-id="ab824-151">When using this new enhancement, you are required to do the followings:</span></span>  
  
-   <span data-ttu-id="ab824-152">コンテナーのポリシーを作成し、Shared Access Signature (SAS) キーを生成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ab824-152">You must create a policy on a container and also generate a shared access signature (SAS) key.</span></span>  
  
-   <span data-ttu-id="ab824-153">データ ファイルまたはログ ファイルによって使用されるコンテナーごとに、名前がコンテナーのパスに一致する SQL Server 資格情報を作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ab824-153">For each container used by a data or a log file, you must create a SQL Server Credential whose name matches the container path.</span></span>  
  
-   <span data-ttu-id="ab824-154">Azure Storage コンテナー、関連するポリシー名、および SAS キーに関する情報を SQL Server 資格情報ストアに格納する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ab824-154">You must store the information regarding Azure Storage container, its associated policy name, and SAS key in the SQL Server credential store.</span></span>  
  
 <span data-ttu-id="ab824-155">次の例では、Azure Storage コンテナーが作成されており、読み取り、書き込み、リスト、権限を使用してポリシーが作成されていることを前提としています。</span><span class="sxs-lookup"><span data-stu-id="ab824-155">The following example assumes that an Azure Storage container has been created, and a policy has been created with read, write, list, rights.</span></span> <span data-ttu-id="ab824-156">コンテナーのポリシーを作成すると、SAS キーが生成されます。SAS キーは暗号化せずに安全にメモリ内に保持でき、SQL Server がコンテナー内の BLOB ファイルにアクセスする際に必要になります。</span><span class="sxs-lookup"><span data-stu-id="ab824-156">Creating a policy on a container generates a SAS key which is safe to keep unencrypted in memory and needed by SQL Server to access the blob files in the container.</span></span> <span data-ttu-id="ab824-157">次のコード スニペットでは、 `'your SAS key'` を `'sr=c&si=<MYPOLICYNAME>&sig=<THESHAREDACCESSSIGNATURE>'`のようなエントリと置き換えます。</span><span class="sxs-lookup"><span data-stu-id="ab824-157">In the following code snippet, replace `'your SAS key'` with an entry similar to the following: `'sr=c&si=<MYPOLICYNAME>&sig=<THESHAREDACCESSSIGNATURE>'`.</span></span> <span data-ttu-id="ab824-158">詳細については、「 [Shared Access Signature の作成と使用](https://msdn.microsoft.com/library/azure/jj721951.aspx)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ab824-158">For more information, see [Create and Use a Shared Access Signature](https://msdn.microsoft.com/library/azure/jj721951.aspx)</span></span>  
  
```sql
-- Create a credential  
CREATE CREDENTIAL [https://testdb.blob.core.windows.net/data]  
WITH IDENTITY='SHARED ACCESS SIGNATURE',  
SECRET = 'your SAS key'  
  
-- Create database with data and log files in Azure container.  
CREATE DATABASE testdb   
ON  
( NAME = testdb_dat,  
    FILENAME = 'https://testdb.blob.core.windows.net/data/TestData.mdf' )  
 LOG ON  
( NAME = testdb_log,  
    FILENAME =  'https://testdb.blob.core.windows.net/data/TestLog.ldf')
```  
  
> [!IMPORTANT]
> <span data-ttu-id="ab824-159">コンテナーのデータ ファイルに対するアクティブな参照が存在する場合、対応する SQL Server 資格情報を削除しようとすると失敗します。</span><span class="sxs-lookup"><span data-stu-id="ab824-159">If there are any active references to data files in a container, attempts to delete the corresponding SQL Server credential fails.</span></span>  
  
### <a name="security"></a><span data-ttu-id="ab824-160">セキュリティ</span><span class="sxs-lookup"><span data-stu-id="ab824-160">Security</span></span>  
 <span data-ttu-id="ab824-161">Azure Storage に SQL Server データ ファイルを格納する場合のセキュリティに関する考慮事項と要件は次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="ab824-161">The following are security considerations and requirements when storing SQL Server Data Files in Azure Storage.</span></span>  
  
-   <span data-ttu-id="ab824-162">Azure BLOB ストレージ サービスのコンテナーを作成する際は、アクセス権を private に設定することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="ab824-162">When creating a container for the Azure Blob storage service, we recommend that you set the access to private.</span></span> <span data-ttu-id="ab824-163">アクセス権を private に設定すると、コンテナーと BLOB データを読み取ることができるのは Azure アカウントの所有者だけになります。</span><span class="sxs-lookup"><span data-stu-id="ab824-163">When you set the access to private, container and blob data can be read by the Azure account owner only.</span></span>  
  
-   <span data-ttu-id="ab824-164">SQL Server データベース ファイルを Azure Storage に格納する際には、Shared Access Signature (コンテナー、BLOB、キュー、およびテーブルへの制限付きアクセス権を付与する URI) を使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ab824-164">When storing SQL Server database files in Azure Storage, you need to use a shared access signature, a URI that grants restricted access rights to containers, blobs, queues, and tables.</span></span> <span data-ttu-id="ab824-165">Shared Access Signature を使用することで、Azure Storage アカウント キーを共有せずに、SQL Server からストレージ アカウント内のリソースへのアクセスを可能にすることができます。</span><span class="sxs-lookup"><span data-stu-id="ab824-165">By using a shared access signature, you can enable SQL Server to access resources in your storage account without sharing your Azure storage account key.</span></span>  
  
-   <span data-ttu-id="ab824-166">これに加えて、従来型の内部設置環境でのセキュリティ対策もデータベースに適用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="ab824-166">In addition, we recommend that you continue implementing the traditional on-premises security practices for your databases.</span></span>  
  
### <a name="installation-prerequisites"></a><span data-ttu-id="ab824-167">インストールの前提条件</span><span class="sxs-lookup"><span data-stu-id="ab824-167">Installation Prerequisites</span></span>  
 <span data-ttu-id="ab824-168">SQL Server データファイルを Azuree に格納する場合のインストールの前提条件は次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="ab824-168">The followings are installation prerequisites when storing SQL Server Data Files in Azuree.</span></span>  
  
-   <span data-ttu-id="ab824-169">**オンプレミスの SQL Server:** この機能は、SQL Server 2014 バージョンに含まれています。</span><span class="sxs-lookup"><span data-stu-id="ab824-169">**SQL Server on-premises:** SQL Server 2014 version includes this feature.</span></span> <span data-ttu-id="ab824-170">SQL Server 2014 のダウンロード方法については、「 [SQL Server 2014](https://www.microsoft.com/sqlserver/sql-server-2014.aspx)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ab824-170">To learn how to download SQL Server 2014, see [SQL Server 2014](https://www.microsoft.com/sqlserver/sql-server-2014.aspx).</span></span>  
  
-   <span data-ttu-id="ab824-171">Azure 仮想マシンで実行されている SQL Server: Azure 仮想マシンに SQL Server をインストールする場合は、SQL Server 2014 をインストールするか、既存のインスタンスを更新します。</span><span class="sxs-lookup"><span data-stu-id="ab824-171">SQL Server running in an Azure virtual machine: If you are installing SQL Server on an Azure Virtual Machine, install SQL Server 2014, or update your existing instance.</span></span> <span data-ttu-id="ab824-172">同様に、SQL Server 2014 プラットフォームイメージを使用して Azure に新しい仮想マシンを作成することもできます。</span><span class="sxs-lookup"><span data-stu-id="ab824-172">Similarly, you can also create a new virtual machine in Azure using SQL Server 2014 platform image.</span></span> <span data-ttu-id="ab824-173">SQL Server 2014 のダウンロード方法については、「 [SQL Server 2014](https://www.microsoft.com/sqlserver/sql-server-2014.aspx)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ab824-173">To learn how to download SQL Server 2014, see [SQL Server 2014](https://www.microsoft.com/sqlserver/sql-server-2014.aspx).</span></span>  
  
###  <a name="limitations"></a><a name="bkmk_Limitations"></a> <span data-ttu-id="ab824-174">制限事項</span><span class="sxs-lookup"><span data-stu-id="ab824-174">Limitations</span></span>  
  
-   <span data-ttu-id="ab824-175">この機能の現在のリリースでは、Azure Storage へのデータの格納 `FileStream` はサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="ab824-175">In the current release of this feature, storing `FileStream` data in Azure Storage is not supported.</span></span> <span data-ttu-id="ab824-176">Azure Storage 統合されたローカルデータベースにデータを格納することはでき `Filestream` ますが、Azure Storage を使用してコンピューター間で Filestream データを移動することはできません。</span><span class="sxs-lookup"><span data-stu-id="ab824-176">You can store `Filestream` data in an Azure Storage integrated local database but you cannot move Filestream data between machines using Azure Storage.</span></span> <span data-ttu-id="ab824-177">`FileStream` データについては、従来の手法を使用して、Filestream に関連付けられたファイル (.mdf、.ldf) を異なるコンピューター間で移動することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="ab824-177">For `FileStream` data, we recommend that you continue using the traditional techniques to move the files (.mdf, .ldf) associated with Filestream between different machines.</span></span>  
  
-   <span data-ttu-id="ab824-178">現在、この新しい機能強化では、Azure Storage 内の同じデータベース ファイルに複数の SQL Server インスタンスで同時にアクセスすることはできません。</span><span class="sxs-lookup"><span data-stu-id="ab824-178">Currently, this new enhancement does not support more than one SQL Server instance accessing the same database files in Azure Storage at the same time.</span></span> <span data-ttu-id="ab824-179">ServerA がアクティブなデータベース ファイルとオンライン接続されているときに、誤って起動された ServerB に同じデータ ファイルを指すデータベースがある場合、2 番目のサーバーでは、次のエラーでデータベースの起動に失敗します。エラー コード **5120 物理ファイル "%.\*ls" を開けません。オペレーティング システム エラー %d: "%ls"** 。</span><span class="sxs-lookup"><span data-stu-id="ab824-179">If ServerA is online with an active database file and if ServerB is accidentally started, and it also has a database which points to the same data file, the second server will fail to start the database with an error code **5120 Unable to open the physical file "%.\*ls". Operating system error %d: "%ls"**.</span></span>  
  
-   <span data-ttu-id="ab824-180">Azure 機能で SQL Server データ ファイルを使用して Azure Storage 内に格納できるのは、.mdf、.ldf、.ndf ファイルのみです。</span><span class="sxs-lookup"><span data-stu-id="ab824-180">Only .mdf, .ldf, and .ndf files can be stored in Azure Storage by using the SQL Server Data Files in Azure feature.</span></span>  
  
-   <span data-ttu-id="ab824-181">Azure 機能で SQL Server データ ファイルを使用する場合は、ストレージ アカウントに対する地理的レプリケーションはサポートされません。</span><span class="sxs-lookup"><span data-stu-id="ab824-181">When using the SQL Server Data Files in Azure feature, geo-replication for your storage account is not supported.</span></span> <span data-ttu-id="ab824-182">ストレージ アカウントで地理的レプリケーションが実行されている場合に、地理的フェールオーバーが発生すると、データの破損が発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="ab824-182">If a storage account is geo-replicated and a geo-failover happened, database corruption could occur.</span></span>  
  
-   <span data-ttu-id="ab824-183">各 BLOB のサイズは、最大 1 TB にすることができます。</span><span class="sxs-lookup"><span data-stu-id="ab824-183">Each Blob can be up to maximum 1 TB in size.</span></span> <span data-ttu-id="ab824-184">この値により、Azure Storage に格納できる個々のデータベース データとログ ファイルの上限が決定されます。</span><span class="sxs-lookup"><span data-stu-id="ab824-184">This creates an upper limit on individual database data and log files that can be stored in Azure Storage.</span></span>  
  
-   <span data-ttu-id="ab824-185">Azure Storage 機能で SQL Server データ ファイルを使用する場合は、インメモリ OLTP データを Azure BLOB ストレージ内に格納することはできません。</span><span class="sxs-lookup"><span data-stu-id="ab824-185">It is not possible to store In-Memory OLTP data in Azure Blob using the SQL Server Data Files in Azure Storage feature.</span></span> <span data-ttu-id="ab824-186">これは、インメモリ OLTP はとに依存して `FileStream` おり、この機能の現在のリリースでは `FileStream` Azure Storage にデータを格納することがサポートされていないためです。</span><span class="sxs-lookup"><span data-stu-id="ab824-186">This is because In-Memory OLTP has a dependency on `FileStream` and, in the current release of this feature, storing `FileStream` data in Azure Storage is not supported.</span></span>  
  
-   <span data-ttu-id="ab824-187">Azure 機能で SQL Server データファイルを使用する場合、SQL Server では、データベースで設定された照合順序を使用して、すべての URL またはファイルパスの比較が実行さ `master` れます。</span><span class="sxs-lookup"><span data-stu-id="ab824-187">When using SQL Server Data Files in Azure feature, SQL Server performs all URL or file path comparisons using the Collation set in the `master` database.</span></span>  
  
-   <span data-ttu-id="ab824-188">`AlwaysOn Availability Groups`は、プライマリ データベースに新しいデータベース ファイルを追加しない限りサポートされます。</span><span class="sxs-lookup"><span data-stu-id="ab824-188">`AlwaysOn Availability Groups` are supported as long as you do not add new database files to the primary database.</span></span> <span data-ttu-id="ab824-189">データベース操作により、プライマリ データベースに新しいファイルを作成する必要がある場合は、まずセカンダリ ノードで AlwaysOn 可用性グループを無効にします。</span><span class="sxs-lookup"><span data-stu-id="ab824-189">If a database operation requires a new file to be created in the primary database, first disable AlwaysOn Availability Groups in the secondary node.</span></span> <span data-ttu-id="ab824-190">次に、プライマリ データベースに対してデータベース操作を実行し、プライマリ ノードでデータベースをバックアップします。</span><span class="sxs-lookup"><span data-stu-id="ab824-190">Then, perform the database operation on the primary database and backup the database in the primary node.</span></span> <span data-ttu-id="ab824-191">さらに、データベースをセカンダリ ノードに復元し、セカンダリ ノードで AlwaysOn 可用性グループを有効にします。</span><span class="sxs-lookup"><span data-stu-id="ab824-191">Next, restore the database to the secondary node, and enable AlwaysOn Availability Groups in the secondary node.</span></span> <span data-ttu-id="ab824-192">Azure 機能で SQL Server データファイルを使用する場合は、AlwaysOn フェールオーバークラスターインスタンスがサポートされていないことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="ab824-192">Note that AlwaysOn Failover Cluster Instances is not supported when using the SQL Server Data Files in Azure feature.</span></span>  
  
-   <span data-ttu-id="ab824-193">通常の運用中、SQL Server では一時リースを使用して BLOB をストレージ用に予約し、各 BLOB リースを 45 ～ 60 秒ごとに更新します。</span><span class="sxs-lookup"><span data-stu-id="ab824-193">During normal operation, SQL Server uses temporary leases to reserve Blobs for storage with a renewal of each Blob lease every 45 to 60 seconds.</span></span> <span data-ttu-id="ab824-194">サーバーがクラッシュし、同じ BLOB を使用するように構成された別の SQL Server インスタンスが起動された場合、新しいインスタンスは、BLOB の既存リース期限が切れるまで最大 60 秒間待機します。</span><span class="sxs-lookup"><span data-stu-id="ab824-194">If a server crashes and another instance of SQL Server configured to use the same blobs is started, the new instance will wait up to 60 seconds for the existing lease on the Blob to expire.</span></span> <span data-ttu-id="ab824-195">リース期限が 60 秒以内に切れるのを待機できない場合にデータベースを別のインスタンスにアタッチするには、BLOB のリースを明示的に終了してアタッチ操作でのエラーを回避することができます。</span><span class="sxs-lookup"><span data-stu-id="ab824-195">If you want to attach the database to another instance and you cannot wait for the lease to expire within 60 seconds, you can explicitly break the lease on the Blob to avoid any failures in attach operations.</span></span>  
  
## <a name="tools-and-programming-reference-support"></a><span data-ttu-id="ab824-196">ツールおよびプログラミング リファレンスのサポート</span><span class="sxs-lookup"><span data-stu-id="ab824-196">Tools and programming reference support</span></span>  
 <span data-ttu-id="ab824-197">ここでは、Azure 機能で SQL Server データ ファイルを使用する場合に使用可能なツールとプログラミング リファレンス ライブラリについて説明します。</span><span class="sxs-lookup"><span data-stu-id="ab824-197">This section describes which tools and programming reference libraries can be used when storing SQL Server data files in Azure Storage.</span></span>  
  
### <a name="powershell-support"></a><span data-ttu-id="ab824-198">PowerShell のサポート</span><span class="sxs-lookup"><span data-stu-id="ab824-198">PowerShell support</span></span>  
 <span data-ttu-id="ab824-199">SQL Server 2014 では、ファイルパスの代わりに Blob Storage URL パスを参照することにより、PowerShell コマンドレットを使用して SQL Server データファイルを Azure Blob Storage サービスに格納できます。</span><span class="sxs-lookup"><span data-stu-id="ab824-199">In SQL Server 2014, you can use PowerShell cmdlets to store SQL Server data files in Azure Blob Storage service by referencing a Blob Storage URL path instead of a file path.</span></span> <span data-ttu-id="ab824-200">BLOB には、`: http://storageaccount.blob.core.windows.net/<container>/<blob>` という URL 形式を使用してアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="ab824-200">You can access Blobs using the following URL format`: http://storageaccount.blob.core.windows.net/<container>/<blob>` .</span></span>  
  
### <a name="sql-server-object-and-performance-counters-support"></a><span data-ttu-id="ab824-201">SQL Server オブジェクトとパフォーマンス カウンターのサポート</span><span class="sxs-lookup"><span data-stu-id="ab824-201">SQL Server Object and performance counters support</span></span>  
 <span data-ttu-id="ab824-202">SQL Server 2014 以降では、Azure Storage 機能内の SQL Server データ ファイルと組み合わせて使用する目的で、1 つの新しい SQL Server オブジェクトが追加されました。</span><span class="sxs-lookup"><span data-stu-id="ab824-202">Starting with SQL Server 2014, a new SQL Server object has been added to be used with SQL Server Data Files in Azure Storage feature.</span></span> <span data-ttu-id="ab824-203">新しい SQL Server オブジェクトは [SQL Server, HTTP_STORAGE_OBJECT](../performance-monitor/sql-server-http-storage-object.md) という名前です。これをシステム モニターで使用すると、SQL Server を Azure Storage と共に使用する場合のアクティビティを監視できます。</span><span class="sxs-lookup"><span data-stu-id="ab824-203">The new SQL Server object is called as [SQL Server, HTTP_STORAGE_OBJECT](../performance-monitor/sql-server-http-storage-object.md) and it can be used by System Monitor to monitor activity when running SQL Server with Azure Storage.</span></span>  
  
### <a name="sql-server-management-studio-support"></a><span data-ttu-id="ab824-204">SQL Server Management Studio のサポート</span><span class="sxs-lookup"><span data-stu-id="ab824-204">SQL Server Management Studio support</span></span>  
 <span data-ttu-id="ab824-205">SQL Server Management Studio では、複数のダイアログ ウィンドウでこの機能を使用することができます。</span><span class="sxs-lookup"><span data-stu-id="ab824-205">SQL Server Management Studio allows you to use this feature via several dialog windows.</span></span> <span data-ttu-id="ab824-206">たとえば、 `https://teststorageaccnt.blob.core.windows.net/testcontainer/` [新しいデータベース] **、** [データベースのアタッチ] **、**[データベースの復元] **など複数のダイアログ ウィンドウの**[パス] **として、ストレージ コンテナーの URL パス (** など) を入力できます。</span><span class="sxs-lookup"><span data-stu-id="ab824-206">For example, you can type the URL path of the storage container, such as `https://teststorageaccnt.blob.core.windows.net/testcontainer/` as a **Path** in several dialog windows, such as **New Database**, **Attach Database**, and **Restore Database**.</span></span> <span data-ttu-id="ab824-207">詳細については、「[チュートリアル: Azure Storage サービスでのデータファイルの SQL Server](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ab824-207">For more information, see [Tutorial: SQL Server Data Files in Azure Storage service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span></span>  
  
### <a name="sql-server-management-objects-support"></a><span data-ttu-id="ab824-208">SQL Server 管理オブジェクトのサポート</span><span class="sxs-lookup"><span data-stu-id="ab824-208">SQL Server Management Objects support</span></span>  
 <span data-ttu-id="ab824-209">Azure 機能で SQL Server データ ファイルを使用する場合は、すべての SQL Server 管理オブジェクト (SMO) がサポートされます。</span><span class="sxs-lookup"><span data-stu-id="ab824-209">When using the SQL Server Data Files in Azure feature, all SQL Server Management Objects (SMO) are supported.</span></span> <span data-ttu-id="ab824-210">SMO オブジェクトにファイル パスが必要であれば、ローカル ファイル パスの代わりに BLOB の URL 形式 ( `https://teststorageaccnt.blob.core.windows.net/testcontainer/`など) を使用します。</span><span class="sxs-lookup"><span data-stu-id="ab824-210">If an SMO object requires a file path, use the BLOB URL format instead of a local file path, such as `https://teststorageaccnt.blob.core.windows.net/testcontainer/`.</span></span> <span data-ttu-id="ab824-211">SQL Server 管理オブジェクト (SMO) の詳細については、SQL Server オンライン ブックの「[SQL Server 管理オブジェクト &#40;SMO&#41; プログラミング ガイド](../server-management-objects-smo/sql-server-management-objects-smo-programming-guide.md) 」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ab824-211">For more information about SQL Server Management Objects (SMO), see [SQL Server Management Objects &#40;SMO&#41; Programming Guide](../server-management-objects-smo/sql-server-management-objects-smo-programming-guide.md) in SQL Server Books Online.</span></span>  
  
### <a name="transact-sql-support"></a><span data-ttu-id="ab824-212">Transact-SQL のサポート</span><span class="sxs-lookup"><span data-stu-id="ab824-212">Transact-SQL support</span></span>  
 <span data-ttu-id="ab824-213">この新しい機能により、Transact-SQL の表層のセキュリティ構成が次のように変更されました。</span><span class="sxs-lookup"><span data-stu-id="ab824-213">This new feature has introduced the following change in the Transact-SQL surface area:</span></span>  
  
-   <span data-ttu-id="ab824-214">**sys.master_files** システム ビューに、新しい **int**列 **credential_id** が追加されました。</span><span class="sxs-lookup"><span data-stu-id="ab824-214">A new **int** column, **credential_id**, in the **sys.master_files** system view.</span></span> <span data-ttu-id="ab824-215">**credential_id** 列は、Azure Storage 対応データ ファイルが自身の資格状態を使用するために sys.credentials への相互参照を有効にする目的で使用されます。</span><span class="sxs-lookup"><span data-stu-id="ab824-215">The **credential_id** column is used to enable Azure Storage enabled data files to be cross-referenced back to sys.credentials for the credentials created for them.</span></span> <span data-ttu-id="ab824-216">資格情報を使用するデータベース ファイルが存在する場合に、この資格情報を削除できないなどのトラブルシューティングに使用できます。</span><span class="sxs-lookup"><span data-stu-id="ab824-216">You can use it for troubleshooting, such as a credential cannot be deleted when there is a database file which uses it.</span></span>  
  
##  <a name="troubleshooting-for-sql-server-data-files-in-azure"></a><a name="bkmk_Troubleshooting"></a><span data-ttu-id="ab824-217">Azure での SQL Server データファイルのトラブルシューティング</span><span class="sxs-lookup"><span data-stu-id="ab824-217">Troubleshooting for SQL Server Data Files in Azure</span></span>  
 <span data-ttu-id="ab824-218">サポートされていない機能または制限事項によるエラーを回避するために、まず「 [Limitations](sql-server-data-files-in-microsoft-azure.md#bkmk_Limitations)」をご確認ください。</span><span class="sxs-lookup"><span data-stu-id="ab824-218">To avoid errors due to unsupported features or limitations, first review [Limitations](sql-server-data-files-in-microsoft-azure.md#bkmk_Limitations).</span></span>  
  
 <span data-ttu-id="ab824-219">Azure Storage 機能で SQL Server データ ファイルを使用する場合に発生する可能性のあるエラーの一覧は、次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="ab824-219">The list of errors that you might get when using the SQL Server Data Files in Azure Storage feature are as follows.</span></span>  
  
 <span data-ttu-id="ab824-220">**認証エラー**</span><span class="sxs-lookup"><span data-stu-id="ab824-220">**Authentication errors**</span></span>  
  
-   <span data-ttu-id="ab824-221">*資格情報 '%.\*ls' を削除できません。この資格情報は、アクティブなデータベース ファイルで使用されています。*  </span><span class="sxs-lookup"><span data-stu-id="ab824-221">*Cannot drop the credential '%.\*ls' because it is used by an active database file.* </span></span>  
    <span data-ttu-id="ab824-222">解決策:Azure Storage にあるアクティブなデータベース ファイルで使用中の資格情報を削除しようとすると、このエラーが発生することがあります。</span><span class="sxs-lookup"><span data-stu-id="ab824-222">Resolution: You may see this error when you try to drop a credential that is still being used by an active database file in Azure Storage.</span></span> <span data-ttu-id="ab824-223">資格情報を削除するには、まずこのデータベース ファイルのある関連 BLOB を削除する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ab824-223">To drop the credential, first you must delete the associated blob that has this database file.</span></span> <span data-ttu-id="ab824-224">アクティブなリースを保持している BLOB を削除するには、先にリースを終了する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ab824-224">To delete a blob that has an active lease, you must first break the lease.</span></span>  
  
-   <span data-ttu-id="ab824-225">*コンテナーに対して Shared Access Signature が正しく作成されていません。*  </span><span class="sxs-lookup"><span data-stu-id="ab824-225">*Shared Access Signature has not been created on the container correctly.* </span></span>  
     <span data-ttu-id="ab824-226">解決策:コンテナーに対して Shared Access Signature が正しく作成されていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="ab824-226">Resolution: Make sure that you have created a Shared Access Signature on the container correctly.</span></span> <span data-ttu-id="ab824-227">[「チュートリアル: Azure Storage サービスでのデータファイルの SQL Server](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md)」のレッスン2で示されている手順を確認します。</span><span class="sxs-lookup"><span data-stu-id="ab824-227">Review the instructions given in Lesson 2 in [Tutorial: SQL Server Data Files in Azure Storage service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span></span>  
  
-   <span data-ttu-id="ab824-228">*SQL Server 資格情報が正しく作成されていません。*  </span><span class="sxs-lookup"><span data-stu-id="ab824-228">*SQL Server credential has not been not created correctly.* </span></span>  
    <span data-ttu-id="ab824-229">解決策: **[ID]** フィールドに 'Shared Access Signature' を使用して、シークレットが正しく作成されたことを確認します。</span><span class="sxs-lookup"><span data-stu-id="ab824-229">Resolution: Make sure that you have used 'Shared Access Signature' for the **Identity** field and created a secret correctly.</span></span> <span data-ttu-id="ab824-230">[「チュートリアル: Azure Storage サービスでのデータファイルの SQL Server](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md)」のレッスン3で説明されている手順を確認します。</span><span class="sxs-lookup"><span data-stu-id="ab824-230">Review the instructions given in Lesson 3 in [Tutorial: SQL Server Data Files in Azure Storage service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span></span>  
  
 <span data-ttu-id="ab824-231">**BLOB リース エラー**</span><span class="sxs-lookup"><span data-stu-id="ab824-231">**Lease blob errors:**</span></span>  
  
-   <span data-ttu-id="ab824-232">同じ BLOB ファイルを使用する別のインスタンスの後に起動しようとして SQL Server がクラッシュしました。</span><span class="sxs-lookup"><span data-stu-id="ab824-232">Error when trying to start SQL Server after another instance using the same blob files has crashed.</span></span> <span data-ttu-id="ab824-233">解決方法: 通常の運用中、SQL Server では一時リースを使用して BLOB をストレージ用に予約し、各 BLOB リースを 45 ～ 60 秒ごとに更新します。</span><span class="sxs-lookup"><span data-stu-id="ab824-233">Resolution: During normal operation, SQL Server uses temporary leases to reserve Blobs for storage with a renewal of each Blob lease every 45 to 60 seconds.</span></span> <span data-ttu-id="ab824-234">サーバーがクラッシュし、同じ BLOB を使用するように構成された別の SQL Server インスタンスが起動された場合、新しいインスタンスは、BLOB の既存リース期限が切れるまで最大 60 秒間待機します。</span><span class="sxs-lookup"><span data-stu-id="ab824-234">If a server crashes and another instance of SQL Server configured to use the same blobs is started, the new instance will wait up to 60 seconds for the existing lease on the Blob to expire.</span></span> <span data-ttu-id="ab824-235">リース期限が 60 秒以内に切れるのを待機できない場合にデータベースを別のインスタンスにアタッチするには、BLOB のリースを明示的に終了してアタッチ操作でのエラーを回避することができます。</span><span class="sxs-lookup"><span data-stu-id="ab824-235">If you want to attach the database to another instance and you cannot wait for the lease to expire within 60 seconds, you can explicitly break the lease on the Blob to avoid any failures in attach operations.</span></span>  
  
 <span data-ttu-id="ab824-236">**データベース エラー**</span><span class="sxs-lookup"><span data-stu-id="ab824-236">**Database errors**</span></span>  
  
1.  <span data-ttu-id="ab824-237">*データベースの作成中にエラーが発生しました* </span><span class="sxs-lookup"><span data-stu-id="ab824-237">*Errors when creating a database* </span></span>  
    <span data-ttu-id="ab824-238">解決策: 「[チュートリアル: Azure Storage サービスでのデータファイルの SQL Server](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md)」のレッスン4で説明されている手順を確認します。</span><span class="sxs-lookup"><span data-stu-id="ab824-238">Resolution: Review the instructions given in Lesson 4 in [Tutorial: SQL Server Data Files in Azure Storage service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span></span>  
  
2.  <span data-ttu-id="ab824-239">*ALTER ステートメントの実行中にエラーが発生しました* </span><span class="sxs-lookup"><span data-stu-id="ab824-239">*Errors when running the Alter statement* </span></span>  
    <span data-ttu-id="ab824-240">解決策:ALTER DATABASE ステートメントは、必ずデータベースがオンライン状態のときに実行してください。</span><span class="sxs-lookup"><span data-stu-id="ab824-240">Resolution: Make sure to execute the Alter Database statement when the database is online.</span></span> <span data-ttu-id="ab824-241">データ ファイルを Azure Storage にコピーするときは常に、ブロック BLOB ではなくページ BLOB を作成します。</span><span class="sxs-lookup"><span data-stu-id="ab824-241">When copying the data files to Azure Storage, always create a page blob not a block blob.</span></span> <span data-ttu-id="ab824-242">そうしないと、ALTER DATABASE は失敗します。</span><span class="sxs-lookup"><span data-stu-id="ab824-242">Otherwise, ALTER Database will fail.</span></span> <span data-ttu-id="ab824-243">[「チュートリアル: Azure Storage サービスでのデータファイルの SQL Server](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md)」のレッスン7で説明されている手順を確認します。</span><span class="sxs-lookup"><span data-stu-id="ab824-243">Review the instructions given in Lesson 7 in [Tutorial: SQL Server Data Files in Azure Storage service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span></span>  
  
3.  <span data-ttu-id="ab824-244">*エラーコード5120は、物理ファイル "% を開くことができません。 \*ls "。オペレーティングシステムエラー% d: "% ls"* </span><span class="sxs-lookup"><span data-stu-id="ab824-244">*Error code 5120 Unable to open the physical file "%.\*ls". Operating system error %d: "%ls"* </span></span>  
    <span data-ttu-id="ab824-245">解決策:現在、この新しい機能強化では、Azure Storage 内の同じデータベース ファイルに複数の SQL Server インスタンスで同時にアクセスすることはできません。</span><span class="sxs-lookup"><span data-stu-id="ab824-245">Resolution: Currently, this new enhancement does not support more than one SQL Server instance accessing the same database files in Azure Storage at the same time.</span></span> <span data-ttu-id="ab824-246">ServerA がアクティブなデータベース ファイルとオンライン接続されているときに、誤って起動された ServerB に同じデータ ファイルを指すデータベースがある場合、2 番目のサーバーでは、次のエラーでデータベースの起動に失敗します。エラー "*コード 5120 物理ファイル "%.\*" ls" を開けません。オペレーティング システム エラー %d: "%ls"* 。</span><span class="sxs-lookup"><span data-stu-id="ab824-246">If ServerA is online with an active database file and if ServerB is accidentally started, and it also has a database which points to the same data file, the second server will fail to start the database with an error *code 5120 Unable to open the physical file "%.\*ls". Operating system error %d: "%ls"*.</span></span>  
  
     <span data-ttu-id="ab824-247">この問題を解決するには、まず、Azure Storage 内のデータベース ファイルに ServerA からアクセスする必要があるかどうかを決定します。</span><span class="sxs-lookup"><span data-stu-id="ab824-247">To resolve this issue, first determine if you need ServerA to access the database file in Azure Storage or not.</span></span> <span data-ttu-id="ab824-248">必要ない場合は、Azure Storage 内のデータベース ファイルと ServerA との間の接続を削除します。</span><span class="sxs-lookup"><span data-stu-id="ab824-248">If not, simply remove any connection between ServerA and the database files in Azure Storage.</span></span> <span data-ttu-id="ab824-249">そのためには、次の手順に従います。</span><span class="sxs-lookup"><span data-stu-id="ab824-249">To do this, follow these steps:</span></span>  
  
    1.  <span data-ttu-id="ab824-250">ALTER DATABASE ステートメントを使用して、ServerA のファイル パスをローカル フォルダーに設定します。</span><span class="sxs-lookup"><span data-stu-id="ab824-250">Set the file path of Server A to a local folder by using the ALTER Database statement.</span></span>  
  
    2.  <span data-ttu-id="ab824-251">ServerA でデータベースをオフラインに設定します。</span><span class="sxs-lookup"><span data-stu-id="ab824-251">Set the database offline in Server A.</span></span>  
  
    3.  <span data-ttu-id="ab824-252">次に、Azure Storage から ServerA のローカル フォルダーにデータベース ファイルをコピーします。これにより、ServerA でデータベースのローカル コピーを確保できます。</span><span class="sxs-lookup"><span data-stu-id="ab824-252">Then, copy database files from Azure Storage to the local folder in Server A. This ensures that ServerA still has a copy of the database locally.</span></span>  
  
    4.  <span data-ttu-id="ab824-253">データベースをオンラインに設定します。</span><span class="sxs-lookup"><span data-stu-id="ab824-253">Set the database online.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="ab824-254">参照</span><span class="sxs-lookup"><span data-stu-id="ab824-254">See Also</span></span>  
 [<span data-ttu-id="ab824-255">チュートリアル:Azure Storage サービス内の SQL Server データ ファイル</span><span class="sxs-lookup"><span data-stu-id="ab824-255">Tutorial: SQL Server Data Files in Azure Storage service</span></span>](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md)  
