---
title: 包含データベース | Microsoft Docs
ms.custom: ''
ms.date: 07/17/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: configuration
ms.topic: conceptual
helpviewer_keywords:
- contained database
- database_uncontained_usage event
- partially contained database
- contained database, understanding
ms.assetid: 36af59d7-ce96-4a02-8598-ffdd78cdc948
author: stevestein
ms.author: sstein
ms.openlocfilehash: 3efd231a1aa4d2b348bcfe887bd05825fcd40c90
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87718248"
---
# <a name="contained-databases"></a><span data-ttu-id="ddfb9-102">包含データベース</span><span class="sxs-lookup"><span data-stu-id="ddfb9-102">Contained Databases</span></span>
  <span data-ttu-id="ddfb9-103">*包含データベース* は、他のデータベース、およびデータベースをホストする [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] のインスタンスから分離されたデータベースです。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-103">A*contained database* is a database that is isolated from other databases and from the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] that hosts the database.</span></span>  [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] <span data-ttu-id="ddfb9-104">では、ユーザーは 4 つの方法でインスタンスからデータベースを分離できます。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-104">helps user to isolate their database from the instance in 4 ways.</span></span>  
  
-   <span data-ttu-id="ddfb9-105">データベースを表すメタデータの多くはデータベースに保持されます</span><span class="sxs-lookup"><span data-stu-id="ddfb9-105">Much of the metadata that describes a database is maintained in the database.</span></span> <span data-ttu-id="ddfb9-106">(master データベースのメタデータを保持する代わりに、またはそれに加えて保持されます)。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-106">(In addition to, or instead of, maintaining metadata in the master database.)</span></span>  
  
-   <span data-ttu-id="ddfb9-107">すべてのメタデータは、同じ照合順序を使用して定義されます。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-107">All metadata are defined using the same collation.</span></span>  
  
-   <span data-ttu-id="ddfb9-108">ユーザー認証をデータベースで実行して、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]のインスタンスのログインに対するデータベースの依存を軽減できます。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-108">User authentication can be performed by the database, reducing the databases dependency on the logins of the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>  
  
-   <span data-ttu-id="ddfb9-109">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 環境 (DMV の XEvents など) は、包含情報をレポートおよび操作できます。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-109">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] environment (DMV's, XEvents, etc.) reports and can act upon containment information.</span></span>  
  
 <span data-ttu-id="ddfb9-110">データベースへのメタデータの格納など、部分的包含データベースの一部の機能はすべての [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] データベースに適用されます。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-110">Some features of partially contained databases, such as storing metadata in the database, apply to all [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] databases.</span></span> <span data-ttu-id="ddfb9-111">データベース レベル認証やカタログ照合順序など、部分的包含データベースの一部の利点を使用可能にするには、あらかじめこれらを有効にしておく必要があります。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-111">Some benefits of partially contained databases, such as database level authentication and catalog collation, must be enabled before they are available.</span></span> <span data-ttu-id="ddfb9-112">部分的包含は、`CREATE DATABASE` ステートメントと `ALTER DATABASE` ステートメントを使用するか、[!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] を使用して有効にします。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-112">Partial containment is enabled using the `CREATE DATABASE` and `ALTER DATABASE` statements or by using [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)].</span></span> <span data-ttu-id="ddfb9-113">部分的データベース包含を有効にする方法の詳細については、「 [Migrate to a Partially Contained Database](migrate-to-a-partially-contained-database.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-113">For more information about how to enable partial database containment, see [Migrate to a Partially Contained Database](migrate-to-a-partially-contained-database.md).</span></span>  
  
 <span data-ttu-id="ddfb9-114">このトピックは、次のセクションで構成されています。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-114">This topic contains the following sections.</span></span>  
  
-   [<span data-ttu-id="ddfb9-115">部分的包含データベースの概念</span><span class="sxs-lookup"><span data-stu-id="ddfb9-115">Partially Contained Database Concepts</span></span>](#Concepts)  
  
-   [<span data-ttu-id="ddfb9-116">封じ込める</span><span class="sxs-lookup"><span data-stu-id="ddfb9-116">Containment</span></span>](#containment)  
  
-   [<span data-ttu-id="ddfb9-117">部分的包含データベースを使用する利点</span><span class="sxs-lookup"><span data-stu-id="ddfb9-117">Benefits of using Partially Contained Databases</span></span>](#benefits)  
  
-   [<span data-ttu-id="ddfb9-118">制限事項</span><span class="sxs-lookup"><span data-stu-id="ddfb9-118">Limitations</span></span>](#Limitations)  
  
-   [<span data-ttu-id="ddfb9-119">データベースの包含の識別</span><span class="sxs-lookup"><span data-stu-id="ddfb9-119">Identifying Database Containment</span></span>](#Identifying)  
  
##  <a name="partially-contained-database-concepts"></a><a name="Concepts"></a> <span data-ttu-id="ddfb9-120">部分的包含データベースの概念</span><span class="sxs-lookup"><span data-stu-id="ddfb9-120">Partially Contained Database Concepts</span></span>  
 <span data-ttu-id="ddfb9-121">完全包含データベースには、すべての設定と、データベースを定義するために必要なメタデータが含まれており、データベースがインストールされている [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] のインスタンスに対する構成上の依存関係がありません。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-121">A fully contained database includes all the settings and metadata required to define the database and has no configuration dependencies on the instance of the [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] where the database is installed.</span></span> <span data-ttu-id="ddfb9-122">以前のバージョンの [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]では、データベースを [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] のインスタンスから分離するのには時間がかかる場合があり、データベースと [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]のインスタンス間の関係に関する詳細な知識が必要でした。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-122">In previous versions of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], separating a database from the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] could be time consuming and required detailed knowledge of the relationship between the database and the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="ddfb9-123">部分的包含データベースを使用すると、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] のインスタンスと他のデータベースからデータベースを簡単に分離できるようになります。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-123">Partially contained databases make it easier to separate a database from the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] and other databases.</span></span>  
  
 <span data-ttu-id="ddfb9-124">包含データベースでは、機能を包含という観点から考えます。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-124">The contained database considers features with regard to containment.</span></span> <span data-ttu-id="ddfb9-125">データベース内の機能だけに依存しているすべてのユーザー定義エンティティは、完全に包含されていると見なされます。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-125">Any user-defined entity that relies only on functions that reside in the database is considered fully contained.</span></span> <span data-ttu-id="ddfb9-126">データベースの外部の機能に依存しているすべてのユーザー定義エンティティは、包含されていないと見なされます</span><span class="sxs-lookup"><span data-stu-id="ddfb9-126">Any user-defined entity that relies on functions that reside outside the database is considered uncontained.</span></span> <span data-ttu-id="ddfb9-127">(詳細については、後の「 [包含](#containment) 」を参照してください)。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-127">(For more information, see the [Containment](#containment) section later in this topic.)</span></span>  
  
 <span data-ttu-id="ddfb9-128">以下の用語は、包含データベース モデルに適用されます。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-128">The following terms apply to the contained database model.</span></span>  
  
 <span data-ttu-id="ddfb9-129">データベース境界</span><span class="sxs-lookup"><span data-stu-id="ddfb9-129">Database boundary</span></span>  
 <span data-ttu-id="ddfb9-130">データベースと [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]のインスタンスとの境界。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-130">The boundary between a database and the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="ddfb9-131">データベースと他のデータベースとの境界。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-131">The boundary between a database and other databases.</span></span>  
  
 <span data-ttu-id="ddfb9-132">包含</span><span class="sxs-lookup"><span data-stu-id="ddfb9-132">Contained</span></span>  
 <span data-ttu-id="ddfb9-133">完全にデータベース境界内に存在する要素。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-133">An element that exists entirely in the database boundary.</span></span>  
  
 <span data-ttu-id="ddfb9-134">非包含</span><span class="sxs-lookup"><span data-stu-id="ddfb9-134">Uncontained</span></span>  
 <span data-ttu-id="ddfb9-135">データベース境界を越える要素。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-135">An element that crosses the database boundary.</span></span>  
  
 <span data-ttu-id="ddfb9-136">非包含データベース</span><span class="sxs-lookup"><span data-stu-id="ddfb9-136">Non-contained database</span></span>  
 <span data-ttu-id="ddfb9-137">包含が **NONE**に設定されているデータベース。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-137">A database that has containment set to **NONE**.</span></span> <span data-ttu-id="ddfb9-138">[!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] より前のバージョンのすべてのデータベースは、非包含です。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-138">All databases in versions earlier than [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] are non-contained.</span></span> <span data-ttu-id="ddfb9-139">既定では、 [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] 以降のすべてのデータベースの包含は **NONE**に設定されています。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-139">By default, all [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] and later databases have a containment set to **NONE**.</span></span>  
  
 <span data-ttu-id="ddfb9-140">部分的包含データベース</span><span class="sxs-lookup"><span data-stu-id="ddfb9-140">Partially contained database</span></span>  
 <span data-ttu-id="ddfb9-141">部分的包含データベースは、データベース境界を越えることが許可される包含データベースです。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-141">A partially contained database is a contained database that can allow some features that cross the database boundary.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="ddfb9-142">には、包含の境界をいつ超えるかを判断する機能が含まれています。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-142">includes the ability to determine when the containment boundary is crossed.</span></span>  
  
 <span data-ttu-id="ddfb9-143">包含ユーザー</span><span class="sxs-lookup"><span data-stu-id="ddfb9-143">Contained user</span></span>  
 <span data-ttu-id="ddfb9-144">包含データベースには、2 種類のユーザーがあります。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-144">There are two types of users for contained databases.</span></span>  
  
-   <span data-ttu-id="ddfb9-145">**パスワードを持つ包含データベース ユーザー**</span><span class="sxs-lookup"><span data-stu-id="ddfb9-145">**Contained database user with password**</span></span>  
  
     <span data-ttu-id="ddfb9-146">パスワードを持つ包含データベース ユーザーは、データベースによって認証されます。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-146">Contained database users with passwords are authenticated by the database.</span></span>  
  
-   <span data-ttu-id="ddfb9-147">**Windows プリンシパル**</span><span class="sxs-lookup"><span data-stu-id="ddfb9-147">**Windows principals**</span></span>  
  
     <span data-ttu-id="ddfb9-148">承認済みの Windows ユーザーと、承認済みの Windows グループのメンバーは、データベースに直接接続でき、 **master** データベース内のログインを必要としません。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-148">Authorized Windows users and members of authorized Windows groups can connect directly to the database and do not need logins in the **master** database.</span></span> <span data-ttu-id="ddfb9-149">データベースは、Windows による認証を信頼します。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-149">The database trusts the authentication by Windows.</span></span>  
  
 <span data-ttu-id="ddfb9-150">**master** データベースへのログインに基づくユーザーには、包含データベースに対するアクセス許可を付与できますが、それによって [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] インスタンスとの依存関係が生成されます。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-150">Users based on logins in the **master** database can be granted access to a contained database, but that would create a dependency on the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance.</span></span> <span data-ttu-id="ddfb9-151">したがって、ログインに基づくユーザーの作成では、部分的包含データベースのコメントを参照します。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-151">Therefore, creating users based on logins see comment for partially contained databases.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="ddfb9-152">部分的包含データベースを有効にすると、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] のインスタンスへのアクセス制御がデータベースの所有者にデリゲートされます。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-152">Enabling partially contained databases delegates control over access to the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] to the owners of the database.</span></span> <span data-ttu-id="ddfb9-153">詳細については、「 [Security Best Practices with Contained Databases](security-best-practices-with-contained-databases.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-153">For more information, see [Security Best Practices with Contained Databases](security-best-practices-with-contained-databases.md).</span></span>  
  
 <span data-ttu-id="ddfb9-154">データベース境界</span><span class="sxs-lookup"><span data-stu-id="ddfb9-154">Database Boundary</span></span>  
 <span data-ttu-id="ddfb9-155">部分的包含データベースはデータベースの機能をインスタンスの機能から分離するので、これらの 2 つの要素間には " *データベース境界*" と呼ばれる、明確に定義された区分線があります。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-155">Because partially contained databases separate the database functionality from those of the instance, there is a clearly defined line between these two elements called the *database boundary*.</span></span>  
  
 <span data-ttu-id="ddfb9-156">データベース境界の内側は *データベース モデル*で、ここではデータベースが開発および管理されます。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-156">Inside of the database boundary is the *database model*, where the databases are developed and managed.</span></span> <span data-ttu-id="ddfb9-157">データベース内にあるエンティティの例としては、 **sys.tables**のようなシステム テーブル、パスワードを持つ包含データベース ユーザー、2 部構成の名前で参照されている現在のデータベース内のユーザー テーブルなどがあります。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-157">Examples of entities located inside of the database include, system tables like **sys.tables**, contained database users with passwords, and user tables in the current database referenced by a two-part name.</span></span>  
  
 <span data-ttu-id="ddfb9-158">データベース境界の外側は " *管理モデル*" で、ここではインスタンスレベルの機能と管理が扱われます。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-158">Outside of the database boundary is the *management model*, which pertains to instance-level functions and management.</span></span> <span data-ttu-id="ddfb9-159">データベース境界の外にあるエンティティの例としては、 **sys.endpoints**のようなシステム テーブル、ログインにマップされているユーザー、3 部構成の名前で参照されている他のデータベース内のユーザー テーブルなどがあります。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-159">Examples of entities located outside of the database boundary include, system tables like **sys.endpoints**, users mapped to logins, and user tables in another database referenced by a three-part-name.</span></span>  
  
##  <a name="containment"></a><a name="containment"></a> <span data-ttu-id="ddfb9-160">包含</span><span class="sxs-lookup"><span data-stu-id="ddfb9-160">Containment</span></span>  
 <span data-ttu-id="ddfb9-161">全体がデータベース内に存在しているユーザー エンティティは、 *包含*であると見なされます。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-161">User entities that reside entirely within the database are considered *contained*.</span></span> <span data-ttu-id="ddfb9-162">データベースの外部に存在していたり、データベースの外部の機能とのやり取りに依存しているすべてのエンティティは、 *非包含*と見なされます。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-162">Any entities that reside outside of the database, or rely on interaction with functions outside of the database, are considered *uncontained*.</span></span>  
  
 <span data-ttu-id="ddfb9-163">一般に、ユーザー エンティティは、以下の包含のカテゴリのいずれかに分類されます。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-163">In general, user entities fall into the following categories of containment:</span></span>  
  
-   <span data-ttu-id="ddfb9-164">完全包含ユーザー エンティティ (データベース境界を越えることがないもの)。たとえば、sys.indexes。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-164">Fully contained user entities (those that never cross the database boundary), for example sys.indexes.</span></span> <span data-ttu-id="ddfb9-165">これらの機能を使用するコードや、これらのエンティティのみを参照するオブジェクトも完全包含です。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-165">Any code that uses these features or any object that references only these entities is also fully contained.</span></span>  
  
-   <span data-ttu-id="ddfb9-166">非包含ユーザー エンティティ (データベース境界を越えるもの)。たとえば、sys.server_principals やサーバー プリンシパル (ログイン) 自体。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-166">Uncontained user entities (those that cross the database boundary), for example sys.server_principals or a server principal (login) itself.</span></span> <span data-ttu-id="ddfb9-167">これらのエンティティを使用するコードや、これらのエンティティを参照する機能は包含ではありません。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-167">Any code that uses these entities or any functions that references these entities are uncontained.</span></span>  
  
###  <a name="partially-contained-database"></a><a name="partial"></a> <span data-ttu-id="ddfb9-168">Partially Contained Database</span><span class="sxs-lookup"><span data-stu-id="ddfb9-168">Partially Contained Database</span></span>  
 <span data-ttu-id="ddfb9-169">包含データベースの機能は、現在、部分的包含状態のみで利用可能です。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-169">The contained database feature is currently available only in a partially contained state.</span></span> <span data-ttu-id="ddfb9-170">部分的包含データベースは、非包含機能の使用が許される包含データベースです。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-170">A partially contained database is a contained database that allows the use of uncontained features.</span></span>  
  
 <span data-ttu-id="ddfb9-171">非包含オブジェクトまたは機能に関する情報を取得するには、[sys.dm_db_uncontained_entities](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-uncontained-entities-transact-sql) ビューおよび [sys.sql_modules &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-sql-modules-transact-sql) ビューを使用します。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-171">Use the [sys.dm_db_uncontained_entities](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-uncontained-entities-transact-sql) and [sys.sql_modules &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-sql-modules-transact-sql) view to return information about uncontained objects or features.</span></span> <span data-ttu-id="ddfb9-172">データベースの要素の包含状態を確認することにより、包含を昇格させるためにどのオブジェクトまたは機能を置き換えたり変更したりする必要があるかを判断できます。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-172">By determining the containment status of the elements of your database, you can discover what objects or features must be replaced or altered to promote containment.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="ddfb9-173">一部のオブジェクトでは、既定の包含設定が **NONE**であるため、このビューは偽陽性の結果を返す場合があります。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-173">Because certain objects have a default containment setting of **NONE**, this view can return false positives.</span></span>  
  
 <span data-ttu-id="ddfb9-174">部分的包含データベースの動作と非包含データベースの動作の違いが最も明らかなのが、照合順序の場合です。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-174">The behavior of partially contained databases differs most distinctly from that of non-contained databases with regard to collation.</span></span> <span data-ttu-id="ddfb9-175">照合順序の問題の詳細については、「 [Contained Database Collations](contained-database-collations.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-175">For more information about collation issues, see [Contained Database Collations](contained-database-collations.md).</span></span>  
  
##  <a name="benefits-of-using-partially-contained-databases"></a><a name="benefits"></a> <span data-ttu-id="ddfb9-176">部分的包含データベースを使用する利点</span><span class="sxs-lookup"><span data-stu-id="ddfb9-176">Benefits of using Partially Contained Databases</span></span>  
 <span data-ttu-id="ddfb9-177">非包含データベースに関連している問題や複雑さの一部は、部分的包含データベースを使用することで解決できます。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-177">There are issues and complications associated with the non-contained databases that can be resolved by using a partially contained database.</span></span>  
  
### <a name="database-movement"></a><span data-ttu-id="ddfb9-178">データベースの移動</span><span class="sxs-lookup"><span data-stu-id="ddfb9-178">Database Movement</span></span>  
 <span data-ttu-id="ddfb9-179">データベースの移動時に発生する問題の 1 つは、データベースがあるインスタンスから別のインスタンスに移動されたときに、一部の重要情報が使用不能になる場合があることです。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-179">One of the problems that occurs when moving databases, is that some important information can be unavailable when a database is moved from one instance to another.</span></span> <span data-ttu-id="ddfb9-180">たとえば、ログイン情報がデータベースではなくインスタンスに保存されます。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-180">For example, login information is stored within the instance instead of in the database.</span></span> <span data-ttu-id="ddfb9-181">非包含データベースを [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]のインスタンスから別のインスタンスに移動すると、この情報は後に残されます。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-181">When you move a non-contained database from one instance to another instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], this information is left behind.</span></span> <span data-ttu-id="ddfb9-182">欠落情報を特定し、データベースと一緒に [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]の新しいインスタンスに移動する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-182">You must identify the missing information and move it with your database to the new instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="ddfb9-183">この処理は、困難で時間がかかる場合があります。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-183">This process can be difficult and time-consuming.</span></span>  
  
 <span data-ttu-id="ddfb9-184">部分包含データベースには、データベース内の重要情報を格納できるため、移動後もデータベースには情報が含まれます。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-184">The partially contained database can store important information in the database so the database still has the information after it is moved.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="ddfb9-185">部分包含データベースでは、インスタンスから分離できないデータベースで使用される機能を記述するドキュメントを提供できます。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-185">A partially contained database can provide documentation describing those features that are used by a database that cannot be separated from the instance.</span></span> <span data-ttu-id="ddfb9-186">これには、他の相互関連データベースの一覧や、データベースに必要だが含めることのできないシステム設定などが含まれます。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-186">This includes a list of other interrelated databases, system settings that the database requires but cannot be contained, and so on.</span></span>  
  
### <a name="benefit-of-contained-database-users-with-alwayson"></a><span data-ttu-id="ddfb9-187">AlwaysOn の包含データベース ユーザーの利点</span><span class="sxs-lookup"><span data-stu-id="ddfb9-187">Benefit of Contained Database Users with AlwaysOn</span></span>  
 <span data-ttu-id="ddfb9-188">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]のインスタンスとの結び付きを低減することで、部分的包含データベースは [!INCLUDE[ssHADR](../../includes/sshadr-md.md)]を使用する場合のフェールオーバー時に役立つことがあります。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-188">By reducing the ties to the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], partially contained databases can be useful during failover when you use [!INCLUDE[ssHADR](../../includes/sshadr-md.md)].</span></span>  
  
 <span data-ttu-id="ddfb9-189">包含ユーザーを作成すると、そのユーザーは包含データベースに直接接続できます。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-189">Creating contained users enables the user to connect directly to the contained database.</span></span> <span data-ttu-id="ddfb9-190">これは、AlwaysOn ソリューションなどの高可用性およびディザスター リカバリーのシナリオにおいて非常に重要な機能です。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-190">This is a very significant feature in high availability and disaster recovery scenarios such as in an AlwaysOn solution.</span></span> <span data-ttu-id="ddfb9-191">ユーザーが包含ユーザーである場合は、フェールオーバーが発生したときに、セカンダリ データベースをホストするインスタンスのログインを作成せずに、セカンダリ データベースに接続できます。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-191">If the users are contained users, in case of failover, people would be able to connect to the secondary without creating logins on the instance hosting the secondary.</span></span> <span data-ttu-id="ddfb9-192">これは直接的な利益をもたらします。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-192">This provides an immediate benefit.</span></span> <span data-ttu-id="ddfb9-193">詳細については、「[AlwaysOn 可用性グループの概要 &#40;SQL Server&#41;](../../database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server.md)」と「[AlwaysOn 可用性グループの前提条件、制限事項、および推奨事項 &#40;SQL Server&#41;](../../database-engine/availability-groups/windows/prereqs-restrictions-recommendations-always-on-availability.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-193">For more information, see [Overview of AlwaysOn Availability Groups &#40;SQL Server&#41;](../../database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server.md) and [Prerequisites, Restrictions, and Recommendations for AlwaysOn Availability Groups &#40;SQL Server&#41;](../../database-engine/availability-groups/windows/prereqs-restrictions-recommendations-always-on-availability.md).</span></span>  
  
### <a name="initial-database-development"></a><span data-ttu-id="ddfb9-194">初期のデータベース開発</span><span class="sxs-lookup"><span data-stu-id="ddfb9-194">Initial Database Development</span></span>  
 <span data-ttu-id="ddfb9-195">開発者は新しいデータベースが配置される場所を把握していない場合があるため、配置先の環境がデータベースに及ぼす影響を少なくすることで、開発者の作業や懸案事項が軽減されます。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-195">Because a developer may not know where a new database will be deployed, limiting the deployed environmental impacts on the database lessens the work and concern for the developer.</span></span> <span data-ttu-id="ddfb9-196">非包含モデルでは、開発者は新しいデータベースが環境から受ける影響の可能性を考慮して、それに応じたプログラミングをする必要があります。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-196">In the non-contained model, the developer must consider possible environmental impacts on the new database and program accordingly.</span></span> <span data-ttu-id="ddfb9-197">しかし、部分的包含データベースを使用することによって、開発者はデータベースに対するインスタンス レベルの影響と、開発者のインスタンス レベルの懸案事項を検出できます。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-197">However, by using partially contained databases, developers can detect instance-level impacts on the database and instance-level concerns for the developer.</span></span>  
  
### <a name="database-administration"></a><span data-ttu-id="ddfb9-198">データベースの管理</span><span class="sxs-lookup"><span data-stu-id="ddfb9-198">Database Administration</span></span>  
 <span data-ttu-id="ddfb9-199">データベース設定を master データベースではなくデータベースに保持すると、データベース所有者に **sysadmin** 権限を付与しなくても、各データベース所有者は自身のデータベースをより高度に管理できます。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-199">Maintaining database settings in the database, instead of in the master database, lets each database owner have more control over their database, without giving the database owner **sysadmin** permission.</span></span>  
  
##  <a name="limitations"></a><a name="Limitations"></a> <span data-ttu-id="ddfb9-200">制限事項</span><span class="sxs-lookup"><span data-stu-id="ddfb9-200">Limitations</span></span>  
 <span data-ttu-id="ddfb9-201">部分的包含データベースでは、以下の機能は許可されません。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-201">Partially contained databases do not allow the following features.</span></span>  
  
-   <span data-ttu-id="ddfb9-202">部分的包含データベースは、レプリケーション、変更データ キャプチャ、または変更の追跡を使用できません。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-202">Partially contained databases cannot use replication, change data capture, or change tracking.</span></span>  
  
-   <span data-ttu-id="ddfb9-203">番号付きプロシージャ</span><span class="sxs-lookup"><span data-stu-id="ddfb9-203">Numbered procedures</span></span>  
  
-   <span data-ttu-id="ddfb9-204">照合順序の変更を伴う、組み込み関数に依存するスキーマ バインド オブジェクト。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-204">Schema-bound objects that depend on built-in functions with collation changes</span></span>  
  
-   <span data-ttu-id="ddfb9-205">オブジェクト、列、記号、または型への参照など、照合順序の変更によるバインドの変更。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-205">Binding change resulting from collation changes, including references to objects, columns, symbols, or types.</span></span>  
  
-   <span data-ttu-id="ddfb9-206">レプリケーション、変更データ キャプチャ、および変更の追跡。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-206">Replication, change data capture, and change tracking.</span></span>  
  
> [!WARNING]  
>  <span data-ttu-id="ddfb9-207">一時ストアド プロシージャは、現在許可されています。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-207">Temporary stored procedures are currently permitted.</span></span> <span data-ttu-id="ddfb9-208">一時ストアド プロシージャは包含関係に違反するので、将来のバージョンの包含データベースではサポートされない予定です。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-208">Because temporary stored procedures breach containment, they are not expected to be supported in future versions of contained database.</span></span>  
  
##  <a name="identifying-database-containment"></a><a name="Identifying"></a> <span data-ttu-id="ddfb9-209">データベースの包含状態の識別</span><span class="sxs-lookup"><span data-stu-id="ddfb9-209">Identifying Database Containment</span></span>  
 <span data-ttu-id="ddfb9-210">データベースの包含状態を識別するのに役立つ 2 つのツールがあります。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-210">There are two tools to help identify the containment status of the database.</span></span> <span data-ttu-id="ddfb9-211">[sys.dm_db_uncontained_entities &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-uncontained-entities-transact-sql) は、データベース内には含まれていない可能性があるすべてのエンティティを示すビューです。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-211">The [sys.dm_db_uncontained_entities &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-uncontained-entities-transact-sql) is a view that shows all the potentially uncontained entities in the database.</span></span> <span data-ttu-id="ddfb9-212">実行時に、実際に含まれていないエンティティが識別されると、database_uncontained_usage イベントが発生します。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-212">The database_uncontained_usage event occurs when any actual uncontained entity is identified at run time.</span></span>  
  
### <a name="sysdm_db_uncontained_entities"></a><span data-ttu-id="ddfb9-213">sys.dm_db_uncontained_entities</span><span class="sxs-lookup"><span data-stu-id="ddfb9-213">sys.dm_db_uncontained_entities</span></span>  
 <span data-ttu-id="ddfb9-214">このビューには、データベース内には含まれていない可能性があるエンティティ (データベース境界を越えるエンティティなど) が表示されます。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-214">This view shows any entities in the database that have the potential to be uncontained, such as those that cross-the database boundary.</span></span> <span data-ttu-id="ddfb9-215">こうしたエンティティには、データベース モデル外部のオブジェクトを使用するユーザー エンティティが含まれます。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-215">This includes those user entities that may use objects outside the database model.</span></span> <span data-ttu-id="ddfb9-216">ただし、一部のエンティティ (たとえば、動的 SQL を使用するエンティティ) の包含は実行時まで識別できないため、このビューでは、実際に含まれていないエンティティ以外のエンティティが表示される場合があります。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-216">However, because the containment of some entities (for example, those using dynamic SQL) cannot be determined until run time, the view may show some entities that are not actually uncontained.</span></span> <span data-ttu-id="ddfb9-217">詳細については、「[sys.dm_db_uncontained_entities &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-uncontained-entities-transact-sql)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-217">For more information, see [sys.dm_db_uncontained_entities &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-uncontained-entities-transact-sql).</span></span>  
  
### <a name="database_uncontained_usage-event"></a><span data-ttu-id="ddfb9-218">database_uncontained_usage イベント</span><span class="sxs-lookup"><span data-stu-id="ddfb9-218">database_uncontained_usage event</span></span>  
 <span data-ttu-id="ddfb9-219">この XEvent は、実行時に、含まれていないエンティティが識別されると発生します。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-219">This XEvent occurs whenever an uncontained entity is identified at run time.</span></span> <span data-ttu-id="ddfb9-220">これには、クライアント コードで生成されたエンティティが含まれます。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-220">This includes entities originated in client code.</span></span> <span data-ttu-id="ddfb9-221">この Xevent は、実際に含まれていないエンティティに対してのみ発生します。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-221">This XEvent will occur only for actual uncontained entities.</span></span> <span data-ttu-id="ddfb9-222">ただし、このイベントが発生するのは実行時のみです。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-222">However, the event only occurs at run time.</span></span> <span data-ttu-id="ddfb9-223">したがって、まだ実行されていない場合、含まれていないユーザー エンティティはこの XEvent で識別されません。</span><span class="sxs-lookup"><span data-stu-id="ddfb9-223">Therefore, any uncontained user entities you have not run will not be identified by this XEvent</span></span>  
  
## <a name="related-content"></a><span data-ttu-id="ddfb9-224">関連コンテンツ</span><span class="sxs-lookup"><span data-stu-id="ddfb9-224">Related Content</span></span>  
 [<span data-ttu-id="ddfb9-225">変更された機能 &#40;包含データベース&#41;</span><span class="sxs-lookup"><span data-stu-id="ddfb9-225">Modified Features &#40;Contained Database&#41;</span></span>](modified-features-contained-database.md)  
  
 [<span data-ttu-id="ddfb9-226">包含データベースの照合順序</span><span class="sxs-lookup"><span data-stu-id="ddfb9-226">Contained Database Collations</span></span>](contained-database-collations.md)  
  
 [<span data-ttu-id="ddfb9-227">包含データベースでのセキュリティのベスト プラクティス</span><span class="sxs-lookup"><span data-stu-id="ddfb9-227">Security Best Practices with Contained Databases</span></span>](security-best-practices-with-contained-databases.md)  
  
 [<span data-ttu-id="ddfb9-228">部分的包含データベースへの移行</span><span class="sxs-lookup"><span data-stu-id="ddfb9-228">Migrate to a Partially Contained Database</span></span>](migrate-to-a-partially-contained-database.md)  
  
  
