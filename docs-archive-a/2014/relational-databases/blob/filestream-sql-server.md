---
title: FILESTREAM (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/14/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: filestream
ms.topic: conceptual
helpviewer_keywords:
- FILESTREAM [SQL Server]
- FILESTREAM [SQL Server], about
- FILESTREAM [SQL Server], overview
ms.assetid: 9a5a8166-bcbe-4680-916c-26276253eafa
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 971f45fd69f381a8997bb2f8f08444f4d9c107c4
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87740069"
---
# <a name="filestream-sql-server"></a><span data-ttu-id="dfc41-102">FILESTREAM (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="dfc41-102">FILESTREAM (SQL Server)</span></span>
  <span data-ttu-id="dfc41-103">FILESTREAM を使用すると、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]ベースのアプリケーションで非構造化データ (ドキュメントやイメージなど) をファイル システムに格納できます。</span><span class="sxs-lookup"><span data-stu-id="dfc41-103">FILESTREAM enables [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]-based applications to store unstructured data, such as documents and images, on the file system.</span></span> <span data-ttu-id="dfc41-104">これにより、ファイル システムの豊富なストリーミング API と高いパフォーマンスをアプリケーションで活用できるほか、非構造化データとそれに対応する構造化データの間でトランザクションの一貫性も維持されます。</span><span class="sxs-lookup"><span data-stu-id="dfc41-104">Applications can leverage the rich streaming APIs and performance of the file system and at the same time maintain transactional consistency between the unstructured data and corresponding structured data.</span></span>  
  
 <span data-ttu-id="dfc41-105">FILESTREAM は、 [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] `varbinary(max)` バイナリラージオブジェクト (BLOB) データをファイルシステム上のファイルとして格納することにより、と NTFS ファイルシステムを統合します。</span><span class="sxs-lookup"><span data-stu-id="dfc41-105">FILESTREAM integrates the [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] with an NTFS file system by storing `varbinary(max)` binary large object (BLOB) data as files on the file system.</span></span> [!INCLUDE[tsql](../../includes/tsql-md.md)] <span data-ttu-id="dfc41-106">ステートメントでは、FILESTREAM データの挿入、更新、クエリ、検索、およびバックアップを行うことができます。</span><span class="sxs-lookup"><span data-stu-id="dfc41-106">statements can insert, update, query, search, and back up FILESTREAM data.</span></span> <span data-ttu-id="dfc41-107">Win32 ファイル システム インターフェイスによるデータへのストリーミング アクセスが可能になります。</span><span class="sxs-lookup"><span data-stu-id="dfc41-107">Win32 file system interfaces provide streaming access to the data.</span></span>  
  
 <span data-ttu-id="dfc41-108">FILESTREAM では、NT システム キャッシュを使用してファイル データをキャッシュします。</span><span class="sxs-lookup"><span data-stu-id="dfc41-108">FILESTREAM uses the NT system cache for caching file data.</span></span> <span data-ttu-id="dfc41-109">これにより、FILESTREAM データが [!INCLUDE[ssDE](../../includes/ssde-md.md)] のパフォーマンスに与える影響を軽減できます。</span><span class="sxs-lookup"><span data-stu-id="dfc41-109">This helps reduce any effect that FILESTREAM data might have on [!INCLUDE[ssDE](../../includes/ssde-md.md)] performance.</span></span> <span data-ttu-id="dfc41-110">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] のバッファー プールは使用されないため、そのメモリはクエリの処理に使用できます。</span><span class="sxs-lookup"><span data-stu-id="dfc41-110">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] buffer pool is not used; therefore, this memory is available for query processing.</span></span>  
  
 <span data-ttu-id="dfc41-111">FILESTREAM は、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]をインストールまたはアップグレードしたときに自動的には有効になりません。</span><span class="sxs-lookup"><span data-stu-id="dfc41-111">FILESTREAM is not automatically enabled when you install or upgrade [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="dfc41-112">FILESTREAM は、SQL Server 構成マネージャーと [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]を使用して有効にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="dfc41-112">You must enable FILESTREAM by using SQL Server Configuration Manager and [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)].</span></span> <span data-ttu-id="dfc41-113">FILESTREAM を使用するには、特殊なファイル グループを格納するためにデータベースを作成または変更する必要があります。</span><span class="sxs-lookup"><span data-stu-id="dfc41-113">To use FILESTREAM, you must create or modify a database to contain a special type of filegroup.</span></span> <span data-ttu-id="dfc41-114">次に、テーブルを作成または変更して、FILESTREAM 属性を格納する `varbinary(max)` 列を含めます。</span><span class="sxs-lookup"><span data-stu-id="dfc41-114">Then, create or modify a table so that it contains a `varbinary(max)` column with the FILESTREAM attribute.</span></span> <span data-ttu-id="dfc41-115">これらの手順を完了すると、 [!INCLUDE[tsql](../../includes/tsql-md.md)] および Win32 を使用して FILESTREAM データを管理できるようになります。</span><span class="sxs-lookup"><span data-stu-id="dfc41-115">After you complete these tasks, you can use [!INCLUDE[tsql](../../includes/tsql-md.md)] and Win32 to manage the FILESTREAM data.</span></span>  
  
 <span data-ttu-id="dfc41-116">FILESTREAM のインストールと使用の詳細については、[関連するタスク](#reltasks)の一覧を参照してください。</span><span class="sxs-lookup"><span data-stu-id="dfc41-116">For more information about installing and using FILESTREAM, see the list of [Related Tasks](#reltasks).</span></span>  
  
##  <a name="when-to-use-filestream"></a><a name="whentouse"></a><span data-ttu-id="dfc41-117">FILESTREAM を使用する場合</span><span class="sxs-lookup"><span data-stu-id="dfc41-117">When to Use FILESTREAM</span></span>  
 <span data-ttu-id="dfc41-118">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] では BLOB を、データをテーブルに格納する標準の `varbinary(max)` データとして使用することも、データをファイル システムに格納する FILESTREAM `varbinary(max)` オブジェクトとして使用することもできます。</span><span class="sxs-lookup"><span data-stu-id="dfc41-118">In [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], BLOBs can be standard `varbinary(max)` data that stores the data in tables, or FILESTREAM `varbinary(max)` objects that store the data in the file system.</span></span> <span data-ttu-id="dfc41-119">データベース ストレージとファイル システム ストレージのどちらを使用するかは、データのサイズと用途によって決まります。</span><span class="sxs-lookup"><span data-stu-id="dfc41-119">The size and use of the data determines whether you should use database storage or file system storage.</span></span> <span data-ttu-id="dfc41-120">次の条件が true の場合は、FILESTREAM を使用することを検討する必要があります。</span><span class="sxs-lookup"><span data-stu-id="dfc41-120">If the following conditions are true, you should consider using FILESTREAM:</span></span>  
  
-   <span data-ttu-id="dfc41-121">格納するオブジェクトの平均的なサイズが 1 MB より大きい。</span><span class="sxs-lookup"><span data-stu-id="dfc41-121">Objects that are being stored are, on average, larger than 1 MB.</span></span>  
  
-   <span data-ttu-id="dfc41-122">高速な読み取りアクセスが重要とされる。</span><span class="sxs-lookup"><span data-stu-id="dfc41-122">Fast read access is important.</span></span>  
  
-   <span data-ttu-id="dfc41-123">アプリケーション ロジックに中間層を使用するアプリケーションを開発している。</span><span class="sxs-lookup"><span data-stu-id="dfc41-123">You are developing applications that use a middle tier for application logic.</span></span>  
  
 <span data-ttu-id="dfc41-124">比較的小さなオブジェクトの場合は、`varbinary(max)` BLOB をデータベースに格納する方が一般に高いストリーミング パフォーマンスが得られます。</span><span class="sxs-lookup"><span data-stu-id="dfc41-124">For smaller objects, storing `varbinary(max)` BLOBs in the database often provides better streaming performance.</span></span>  
  
  
##  <a name="filestream-storage"></a><a name="storage"></a><span data-ttu-id="dfc41-125">FILESTREAM ストレージ</span><span class="sxs-lookup"><span data-stu-id="dfc41-125">FILESTREAM Storage</span></span>  
 <span data-ttu-id="dfc41-126">FILESTREAM ストレージは、データを BLOB としてファイル システムに格納する `varbinary(max)` 列として実装されます。</span><span class="sxs-lookup"><span data-stu-id="dfc41-126">FILESTREAM storage is implemented as a `varbinary(max)` column in which the data is stored as BLOBs in the file system.</span></span> <span data-ttu-id="dfc41-127">BLOB のサイズはファイル システムのボリューム サイズによってのみ制限されます。</span><span class="sxs-lookup"><span data-stu-id="dfc41-127">The sizes of the BLOBs are limited only by the volume size of the file system.</span></span> <span data-ttu-id="dfc41-128">ファイル システムに格納される BLOB には、標準の `varbinary(max)` の制限 (ファイル サイズ 2 GB) は適用されません。</span><span class="sxs-lookup"><span data-stu-id="dfc41-128">The standard `varbinary(max)` limitation of 2-GB file sizes does not apply to BLOBs that are stored in the file system.</span></span>  
  
 <span data-ttu-id="dfc41-129">列のデータをファイル システムに格納するように指定するには、`varbinary(max)` 列で FILESTREAM 属性を指定します。</span><span class="sxs-lookup"><span data-stu-id="dfc41-129">To specify that a column should store data on the file system, specify the FILESTREAM attribute on a `varbinary(max)` column.</span></span> <span data-ttu-id="dfc41-130">[!INCLUDE[ssDE](../../includes/ssde-md.md)] では、これにより、その列のすべてのデータがファイル システム (データベース ファイル以外の場所) に格納されるようになります。</span><span class="sxs-lookup"><span data-stu-id="dfc41-130">This causes the [!INCLUDE[ssDE](../../includes/ssde-md.md)] to store all data for that column on the file system, but not in the database file.</span></span>  
  
 <span data-ttu-id="dfc41-131">FILESTREAM データは FILESTREAM ファイル グループに格納する必要があります。</span><span class="sxs-lookup"><span data-stu-id="dfc41-131">FILESTREAM data must be stored in FILESTREAM filegroups.</span></span> <span data-ttu-id="dfc41-132">FILESTREAM ファイル グループは特殊なファイル グループで、ファイルそのものではなくファイル システム ディレクトリが含まれます。</span><span class="sxs-lookup"><span data-stu-id="dfc41-132">A FILESTREAM filegroup is a special filegroup that contains file system directories instead of the files themselves.</span></span> <span data-ttu-id="dfc41-133">これらのファイル システム ディレクトリは、 *データ コンテナー*と呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="dfc41-133">These file system directories are called *data containers*.</span></span> <span data-ttu-id="dfc41-134">データ コンテナーは、 [!INCLUDE[ssDE](../../includes/ssde-md.md)] ストレージとファイル システム ストレージの間のインターフェイスです。</span><span class="sxs-lookup"><span data-stu-id="dfc41-134">Data containers are the interface between [!INCLUDE[ssDE](../../includes/ssde-md.md)] storage and file system storage.</span></span>  
  
 <span data-ttu-id="dfc41-135">FILESTREAM ストレージを使用する際は、以下の点を考慮してください。</span><span class="sxs-lookup"><span data-stu-id="dfc41-135">When you use FILESTREAM storage, consider the following:</span></span>  
  
-   <span data-ttu-id="dfc41-136">テーブルに FILESTREAM 列が含まれている場合には、各行に NULL でない一意の行 ID が必要です。</span><span class="sxs-lookup"><span data-stu-id="dfc41-136">When a table contains a FILESTREAM column, each row must have a nonnull unique row ID.</span></span>  
  
-   <span data-ttu-id="dfc41-137">FILESTREAM ファイル グループには、複数のデータ コンテナーを追加できます。</span><span class="sxs-lookup"><span data-stu-id="dfc41-137">Multiple data containers can be added to a FILESTREAM filegroup.</span></span>  
  
-   <span data-ttu-id="dfc41-138">FILESTREAM データ コンテナーを入れ子にすることはできません。</span><span class="sxs-lookup"><span data-stu-id="dfc41-138">FILESTREAM data containers cannot be nested.</span></span>  
  
-   <span data-ttu-id="dfc41-139">フェールオーバー クラスタリングを使用している場合は、FILESTREAM ファイル グループが共有ディスク リソース上に存在する必要があります。</span><span class="sxs-lookup"><span data-stu-id="dfc41-139">When you are using failover clustering, the FILESTREAM filegroups must be on shared disk resources.</span></span>  
  
-   <span data-ttu-id="dfc41-140">FILESTREAM ファイル グループは、圧縮されたボリューム上にあってもかまいません。</span><span class="sxs-lookup"><span data-stu-id="dfc41-140">FILESTREAM filegroups can be on compressed volumes.</span></span>  
  
### <a name="integrated-management"></a><span data-ttu-id="dfc41-141">管理の統合</span><span class="sxs-lookup"><span data-stu-id="dfc41-141">Integrated Management</span></span>  
 <span data-ttu-id="dfc41-142">FILESTREAM は `varbinary(max)` 列として実装され、直接[!INCLUDE[ssDE](../../includes/ssde-md.md)]に統合されているため、[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] の管理ツールや関数のほとんどを FILESTREAM データで使用できます。FILESTREAM データに変更を加える必要もありません。</span><span class="sxs-lookup"><span data-stu-id="dfc41-142">Because FILESTREAM is implemented as a `varbinary(max)` column and integrated directly into the [!INCLUDE[ssDE](../../includes/ssde-md.md)], most [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] management tools and functions work without modification for FILESTREAM data.</span></span> <span data-ttu-id="dfc41-143">たとえば、すべてのバックアップ モデルと復旧モデルを FILESTREAM データで使用できるため、FILESTREAM データをデータベースの構造化データと共にバックアップできます。</span><span class="sxs-lookup"><span data-stu-id="dfc41-143">For example, you can use all backup and recovery models with FILESTREAM data, and the FILESTREAM data is backed up with the structured data in the database.</span></span> <span data-ttu-id="dfc41-144">FILESTREAM データをリレーショナル データと共にバックアップしない場合は、部分バックアップを使用して FILESTREAM ファイル グループを除外できます。</span><span class="sxs-lookup"><span data-stu-id="dfc41-144">If you do not want to back up FILESTREAM data with relational data, you can use a partial backup to exclude FILESTREAM filegroups.</span></span>  

  
### <a name="integrated-security"></a><span data-ttu-id="dfc41-145">Integrated Security</span><span class="sxs-lookup"><span data-stu-id="dfc41-145">Integrated Security</span></span>  
 <span data-ttu-id="dfc41-146">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]の FILESTREAM データは、その他のデータと同じように、テーブルまたは列のレベルで権限を与えることによってセキュリティで保護されます。</span><span class="sxs-lookup"><span data-stu-id="dfc41-146">In [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], FILESTREAM data is secured just like other data is secured: by granting permissions at the table or column levels.</span></span> <span data-ttu-id="dfc41-147">テーブルの FILESTREAM 列に対する権限を持つユーザーは、関連付けられているファイルを開くことができます。</span><span class="sxs-lookup"><span data-stu-id="dfc41-147">If a user has permission to the FILESTREAM column in a table, the user can open the associated files.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="dfc41-148">FILESTREAM データでは暗号化はサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="dfc41-148">Encryption is not supported on FILESTREAM data.</span></span>  
  
 <span data-ttu-id="dfc41-149">FILESTREAM コンテナーへの NTFS アクセス許可が与えられるのは、[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] サービス アカウントが実行されているアカウントだけです。</span><span class="sxs-lookup"><span data-stu-id="dfc41-149">Only the account under which the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] service account runs is granted NTFS permissions to the FILESTREAM container.</span></span> <span data-ttu-id="dfc41-150">その他のアカウントにはデータ コンテナーに対するアクセス許可を与えないようにすることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="dfc41-150">We recommend that no other account be granted permissions on the data container.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="dfc41-151">SQL ログインは、FILESTREAM コンテナーで使用できません。</span><span class="sxs-lookup"><span data-stu-id="dfc41-151">SQL logins will not work with FILESTREAM containers.</span></span> <span data-ttu-id="dfc41-152">FILESTREAM コンテナーでは NTFS 認証のみを使用できます。</span><span class="sxs-lookup"><span data-stu-id="dfc41-152">Only NTFS authentication will work with FILESTREAM containers.</span></span>  
  
##  <a name="accessing-blob-data-with-transact-sql-and-file-system-streaming-access"></a><a name="dual"></a> <span data-ttu-id="dfc41-153">Transact-SQL およびファイル システム ストリーミング アクセスによる BLOB データへのアクセス</span><span class="sxs-lookup"><span data-stu-id="dfc41-153">Accessing BLOB Data with Transact-SQL and File System Streaming Access</span></span>  
 <span data-ttu-id="dfc41-154">FILESTREAM 列にデータを格納した後、それらのファイルにアクセスするには、 [!INCLUDE[tsql](../../includes/tsql-md.md)] トランザクションか Win32 API を使用します。</span><span class="sxs-lookup"><span data-stu-id="dfc41-154">After you store data in a FILESTREAM column, you can access the files by using [!INCLUDE[tsql](../../includes/tsql-md.md)] transactions or by using Win32 APIs.</span></span>  
  
### <a name="transact-sql-access"></a><span data-ttu-id="dfc41-155">Transact-SQL アクセス</span><span class="sxs-lookup"><span data-stu-id="dfc41-155">Transact-SQL Access</span></span>  
 <span data-ttu-id="dfc41-156">[!INCLUDE[tsql](../../includes/tsql-md.md)]を使用して、FILESTREAM データの挿入、更新、および削除を行うことができます。</span><span class="sxs-lookup"><span data-stu-id="dfc41-156">By using [!INCLUDE[tsql](../../includes/tsql-md.md)], you can insert, update, and delete FILESTREAM data:</span></span>  
  
-   <span data-ttu-id="dfc41-157">挿入操作を使用すると、null 値、空の値、または比較的短いインライン データを FILESTREAM フィールドに事前設定することができます。</span><span class="sxs-lookup"><span data-stu-id="dfc41-157">You can use an insert operation to prepopulate a FILESTREAM field with a null value, empty value, or relatively short inline data.</span></span> <span data-ttu-id="dfc41-158">ただし、大量のデータをファイルにストリーミングする場合は、Win32 インターフェイスを使用する方が効率的です。</span><span class="sxs-lookup"><span data-stu-id="dfc41-158">However, a large amount of data is more efficiently streamed into a file that uses Win32 interfaces.</span></span>  
  
-   <span data-ttu-id="dfc41-159">FILESTREAM フィールドを更新すると、その基となるファイル システムの BLOB データが変更されます。</span><span class="sxs-lookup"><span data-stu-id="dfc41-159">When you update a FILESTREAM field, you modify the underlying BLOB data in the file system.</span></span> <span data-ttu-id="dfc41-160">FILESTREAM フィールドを NULL に設定すると、フィールドに関連付けられている BLOB データが削除されます。</span><span class="sxs-lookup"><span data-stu-id="dfc41-160">When a FILESTREAM field is set to NULL, the BLOB data associated with the field is deleted.</span></span> <span data-ttu-id="dfc41-161">UPDATE [!INCLUDE[tsql](../../includes/tsql-md.md)] .**Write() として実装されている**の大量の更新を使用してデータの部分更新を実行することはできません。</span><span class="sxs-lookup"><span data-stu-id="dfc41-161">You cannot use a [!INCLUDE[tsql](../../includes/tsql-md.md)] chunked update, implemented as UPDATE **.** Write(), to perform partial updates to the data.</span></span>  
  
-   <span data-ttu-id="dfc41-162">FILESTREAM データを含む行を削除したり、FILESTREAM データを含むテーブルを削除したり切り捨てたりすると、その基となるファイル システムの BLOB データが削除されます。</span><span class="sxs-lookup"><span data-stu-id="dfc41-162">When you delete a row or delete or truncate a table that contains FILESTREAM data, you delete the underlying BLOB data in the file system.</span></span>  
  
### <a name="file-system-streaming-access"></a><span data-ttu-id="dfc41-163">ファイル システム ストリーミング アクセス</span><span class="sxs-lookup"><span data-stu-id="dfc41-163">File System Streaming Access</span></span>  
 <span data-ttu-id="dfc41-164">Win32 のストリーミング サポートを [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] トランザクションのコンテキストで使用できます。</span><span class="sxs-lookup"><span data-stu-id="dfc41-164">The Win32 streaming support works in the context of a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] transaction.</span></span> <span data-ttu-id="dfc41-165">トランザクション内で、まず、FILESTREAM 関数を使用してファイルの論理 UNC ファイル システム パスを取得します。</span><span class="sxs-lookup"><span data-stu-id="dfc41-165">Within a transaction, you can use FILESTREAM functions to obtain a logical UNC file system path of a file.</span></span> <span data-ttu-id="dfc41-166">次に、OpenSqlFilestream API を使用してファイル ハンドルを取得します。</span><span class="sxs-lookup"><span data-stu-id="dfc41-166">You then use the OpenSqlFilestream API to obtain a file handle.</span></span> <span data-ttu-id="dfc41-167">そのハンドルを Win32 ファイル ストリーミング インターフェイス (ReadFile() や WriteFile() など) で使用することにより、ファイル システム経由でファイルにアクセスしてファイルを更新できます。</span><span class="sxs-lookup"><span data-stu-id="dfc41-167">This handle can then be used by Win32 file streaming interfaces, such as ReadFile() and WriteFile(), to access and update the file by way of the file system.</span></span>  
  
 <span data-ttu-id="dfc41-168">ファイル操作はトランザクション処理なので、ファイル システムを通じて FILESTREAM ファイルを削除したりその名前を変更したりすることはできません。</span><span class="sxs-lookup"><span data-stu-id="dfc41-168">Because file operations are transactional, you cannot delete or rename FILESTREAM files through the file system.</span></span>  
  
 <span data-ttu-id="dfc41-169">**ステートメント モデル**</span><span class="sxs-lookup"><span data-stu-id="dfc41-169">**Statement Model**</span></span>  
  
 <span data-ttu-id="dfc41-170">FILESTREAM のファイル システム アクセスは、ファイルのオープンとクローズを使用して [!INCLUDE[tsql](../../includes/tsql-md.md)] ステートメントを実現しています。</span><span class="sxs-lookup"><span data-stu-id="dfc41-170">The FILESTREAM file system access models a [!INCLUDE[tsql](../../includes/tsql-md.md)] statement by using file open and close.</span></span> <span data-ttu-id="dfc41-171">ファイル ハンドルを開くとステートメントが開始され、ハンドルを閉じると終了します。</span><span class="sxs-lookup"><span data-stu-id="dfc41-171">The statement starts when a file handle is opened and ends when the handle is closed.</span></span> <span data-ttu-id="dfc41-172">たとえば、書き込みハンドルを閉じると、UPDATE ステートメントが完了したときのように、テーブルに登録されている AFTER トリガーが起動します。</span><span class="sxs-lookup"><span data-stu-id="dfc41-172">For example, when a write handle is closed, any possible AFTER trigger that is registered on the table fires as if an UPDATE statement is completed.</span></span>  
  
 <span data-ttu-id="dfc41-173">**ストレージの名前空間**</span><span class="sxs-lookup"><span data-stu-id="dfc41-173">**Storage Namespace**</span></span>  
  
 <span data-ttu-id="dfc41-174">FILESTREAM では、 [!INCLUDE[ssDE](../../includes/ssde-md.md)] が BLOB の物理ファイル システムの名前空間を制御します。</span><span class="sxs-lookup"><span data-stu-id="dfc41-174">In FILESTREAM, the [!INCLUDE[ssDE](../../includes/ssde-md.md)] controls the BLOB physical file system namespace.</span></span> <span data-ttu-id="dfc41-175">新しい組み込み関数の [PathName](/sql/relational-databases/system-functions/pathname-transact-sql)を使用すると、テーブルの各 FILESTREAM セルに対応する BLOB の論理 UNC パスを取得できます。</span><span class="sxs-lookup"><span data-stu-id="dfc41-175">A new intrinsic function, [PathName](/sql/relational-databases/system-functions/pathname-transact-sql), provides the logical UNC path of the BLOB that corresponds to each FILESTREAM cell in the table.</span></span> <span data-ttu-id="dfc41-176">アプリケーションでは、この論理パスを使用して Win32 ハンドルを取得し、標準の Win32 ファイル システム インターフェイスを使用して BLOB データを操作します。</span><span class="sxs-lookup"><span data-stu-id="dfc41-176">The application uses this logical path to obtain the Win32 handle and operate on the BLOB data by using regular Win32 file system interfaces.</span></span> <span data-ttu-id="dfc41-177">この関数は、FILESTREAM 列の値が NULL の場合は NULL を返します。</span><span class="sxs-lookup"><span data-stu-id="dfc41-177">The function returns NULL if the value of the FILESTREAM column is NULL.</span></span>  
  
 <span data-ttu-id="dfc41-178">**ファイル システム アクセスのトランザクション処理**</span><span class="sxs-lookup"><span data-stu-id="dfc41-178">**Transacted File System Access**</span></span>  
  
 <span data-ttu-id="dfc41-179">新しい組み込み関数の [GET_FILESTREAM_TRANSACTION_CONTEXT()](/sql/t-sql/functions/get-filestream-transaction-context-transact-sql)を使用すると、セッションが関連付けられている現在のトランザクションを表すトークンを取得できます。</span><span class="sxs-lookup"><span data-stu-id="dfc41-179">A new intrinsic function, [GET_FILESTREAM_TRANSACTION_CONTEXT()](/sql/t-sql/functions/get-filestream-transaction-context-transact-sql), provides the token that represents the current transaction that the session is associated with.</span></span> <span data-ttu-id="dfc41-180">このトランザクションは、既に開始され、まだ中止もコミットもされていないトランザクションである必要があります。</span><span class="sxs-lookup"><span data-stu-id="dfc41-180">The transaction must have been started and not yet aborted or committed.</span></span> <span data-ttu-id="dfc41-181">アプリケーションでは、トークンを取得することにより、FILESTREAM のファイル システム ストリーミング操作を、既に開始されているトランザクションにバインドできます。</span><span class="sxs-lookup"><span data-stu-id="dfc41-181">By obtaining a token, the application binds the FILESTREAM file system streaming operations with a started transaction.</span></span> <span data-ttu-id="dfc41-182">この関数は、明示的に開始されたトランザクションがない場合は NULL を返します。</span><span class="sxs-lookup"><span data-stu-id="dfc41-182">The function returns NULL in case of no explicitly started transaction.</span></span>  
  
 <span data-ttu-id="dfc41-183">トランザクションをコミットしたり中止したりする前にすべてのファイル ハンドルを閉じる必要があります。</span><span class="sxs-lookup"><span data-stu-id="dfc41-183">All file handles must be closed before the transaction commits or aborts.</span></span> <span data-ttu-id="dfc41-184">トランザクションのスコープを超えてもハンドルが開いたままになっていると、そのハンドルに対するその後の読み取りが失敗します。そのハンドルに対するその後の書き込みは成功しますが、ディスクに実際のデータが書き込まれません。</span><span class="sxs-lookup"><span data-stu-id="dfc41-184">If a handle is left open beyond the transaction scope, additional reads against the handle will cause a failure; additional writes against the handle will succeed, but the actual data will not be written to disk.</span></span> <span data-ttu-id="dfc41-185">同様に、 [!INCLUDE[ssDE](../../includes/ssde-md.md)] のデータベースやインスタンスがシャットダウンすると、開いているハンドルはすべて無効になります。</span><span class="sxs-lookup"><span data-stu-id="dfc41-185">Similarly, if the database or instance of the [!INCLUDE[ssDE](../../includes/ssde-md.md)] shuts down, all open handles are invalidated.</span></span>  
  
 <span data-ttu-id="dfc41-186">**トランザクションの持続性**</span><span class="sxs-lookup"><span data-stu-id="dfc41-186">**Transactional Durability**</span></span>  
  
 <span data-ttu-id="dfc41-187">FILESTREAM では、トランザクションのコミット時に、ファイル システム ストリーミング アクセスから変更された FILESTREAM BLOB データのトランザクションの持続性が [!INCLUDE[ssDE](../../includes/ssde-md.md)] によって確保されます。</span><span class="sxs-lookup"><span data-stu-id="dfc41-187">With FILESTREAM, upon transaction commit, the [!INCLUDE[ssDE](../../includes/ssde-md.md)] ensures transaction durability for FILESTREAM BLOB data that is modified from the file system streaming access.</span></span>  
  
 <span data-ttu-id="dfc41-188">**分離のセマンティクス**</span><span class="sxs-lookup"><span data-stu-id="dfc41-188">**Isolation Semantics**</span></span>  
  
 <span data-ttu-id="dfc41-189">分離のセマンティクスは、 [!INCLUDE[ssDE](../../includes/ssde-md.md)] のトランザクション分離レベルに従います。</span><span class="sxs-lookup"><span data-stu-id="dfc41-189">The isolation semantics are governed by [!INCLUDE[ssDE](../../includes/ssde-md.md)] transaction isolation levels.</span></span> <span data-ttu-id="dfc41-190">[!INCLUDE[tsql](../../includes/tsql-md.md)] およびファイル システム アクセスでは、Read Committed 分離レベルがサポートされます。</span><span class="sxs-lookup"><span data-stu-id="dfc41-190">Read-committed isolation level is supported for [!INCLUDE[tsql](../../includes/tsql-md.md)] and file system access.</span></span> <span data-ttu-id="dfc41-191">Repeatable Read 操作、およびシリアル化可能な分離やスナップショット分離もサポートされます。</span><span class="sxs-lookup"><span data-stu-id="dfc41-191">Repeatable read operations, and also serializable and snapshot isolations, are supported.</span></span> <span data-ttu-id="dfc41-192">ダーティ リードはサポートされません。</span><span class="sxs-lookup"><span data-stu-id="dfc41-192">Dirty read is not supported.</span></span>  
  
 <span data-ttu-id="dfc41-193">ファイル システム アクセスのオープン操作はロックを待機しません。</span><span class="sxs-lookup"><span data-stu-id="dfc41-193">The file system access open operations do not wait for any locks.</span></span> <span data-ttu-id="dfc41-194">トランザクション分離のためにデータにアクセスできない場合、オープン操作はすぐに失敗します。</span><span class="sxs-lookup"><span data-stu-id="dfc41-194">Instead, the open operations fail immediately if they cannot access the data because of transaction isolation.</span></span> <span data-ttu-id="dfc41-195">分離違反のためにオープン操作を続行できない場合は、ストリーミング API 呼び出しが ERROR_SHARING_VIOLATION で失敗します。</span><span class="sxs-lookup"><span data-stu-id="dfc41-195">The streaming API calls fail with ERROR_SHARING_VIOLATION if the open operation cannot continue because of isolation violation.</span></span>  
  
 <span data-ttu-id="dfc41-196">アプリケーションでは、部分更新を実行できるようにするために、デバイス FS 制御 (FSCTL_SQL_FILESTREAM_FETCH_OLD_CONTENT) を発行して、開いているハンドルが参照しているファイルに古い内容をフェッチすることができます。</span><span class="sxs-lookup"><span data-stu-id="dfc41-196">To allow for partial updates to be made, the application can issue a device FS control (FSCTL_SQL_FILESTREAM_FETCH_OLD_CONTENT) to fetch the old content into the file that the opened handle references.</span></span> <span data-ttu-id="dfc41-197">これにより、サーバー側の古い内容がコピーされます。</span><span class="sxs-lookup"><span data-stu-id="dfc41-197">This will trigger a server-side old content copy.</span></span> <span data-ttu-id="dfc41-198">アプリケーションのパフォーマンスが低下したり、非常に大きなファイルを操作する際にタイムアウトになったりしないように、非同期 I/O を使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="dfc41-198">For better application performance and to avoid running into potential time-outs when you are working with very large files, we recommend that you use asynchronous I/O.</span></span>  
  
 <span data-ttu-id="dfc41-199">ハンドルへの書き込みが行われた後に FSCTL を発行すると、最後の書き込み操作は維持され、それより前の書き込みは失われます。</span><span class="sxs-lookup"><span data-stu-id="dfc41-199">If the FSCTL is issued after the handle has been written to, the last write operation will persist, and prior writes that were made to the handle are lost.</span></span>  
  
 <span data-ttu-id="dfc41-200">**ファイル システム API とサポートされる分離レベル**</span><span class="sxs-lookup"><span data-stu-id="dfc41-200">**File System APIs and Supported Isolation Levels**</span></span>  
  
 <span data-ttu-id="dfc41-201">分離違反が原因でファイル システム API がファイルを開くことができない場合、ERROR_SHARING_VIOLATION 例外が返されます。</span><span class="sxs-lookup"><span data-stu-id="dfc41-201">When a file system API cannot open a file because of an isolation violation, an ERROR_SHARING_VIOLATION exception is returned.</span></span> <span data-ttu-id="dfc41-202">この分離違反は、2 つのトランザクションが同じファイルにアクセスしようとしたときに発生します。</span><span class="sxs-lookup"><span data-stu-id="dfc41-202">This isolation violation occurs when two transactions try to access the same file.</span></span> <span data-ttu-id="dfc41-203">アクセス操作の結果は、ファイルが開かれたモードと、トランザクションが実行されている [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] のバージョンに依存します。</span><span class="sxs-lookup"><span data-stu-id="dfc41-203">The outcome of the access operation depends on the mode the file was opened in and the version of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] that the transaction is running on.</span></span> <span data-ttu-id="dfc41-204">次の表に、同じファイルにアクセスする 2 つのトランザクションで得られる可能性のある結果を示します。</span><span class="sxs-lookup"><span data-stu-id="dfc41-204">The following table outlines the possibly outcomes for two transactions that are accessing the same file.</span></span>  
  
|<span data-ttu-id="dfc41-205">トランザクション 1</span><span class="sxs-lookup"><span data-stu-id="dfc41-205">Transaction 1</span></span>|<span data-ttu-id="dfc41-206">トランザクション 2</span><span class="sxs-lookup"><span data-stu-id="dfc41-206">Transaction 2</span></span>|<span data-ttu-id="dfc41-207">SQL Server 2008 での結果</span><span class="sxs-lookup"><span data-stu-id="dfc41-207">Outcome on SQL Server 2008</span></span>|<span data-ttu-id="dfc41-208">SQL Server 2008 R2 以降のバージョンでの結果</span><span class="sxs-lookup"><span data-stu-id="dfc41-208">Outcome on SQL Server 2008 R2 and later versions</span></span>|  
|-------------------|-------------------|--------------------------------|------------------------------------------------------|  
|<span data-ttu-id="dfc41-209">読み取り用に開く。</span><span class="sxs-lookup"><span data-stu-id="dfc41-209">Open for read.</span></span>|<span data-ttu-id="dfc41-210">読み取り用に開く。</span><span class="sxs-lookup"><span data-stu-id="dfc41-210">Open for read.</span></span>|<span data-ttu-id="dfc41-211">どちらも成功します。</span><span class="sxs-lookup"><span data-stu-id="dfc41-211">Both succeed.</span></span>|<span data-ttu-id="dfc41-212">どちらも成功します。</span><span class="sxs-lookup"><span data-stu-id="dfc41-212">Both succeed.</span></span>|  
|<span data-ttu-id="dfc41-213">読み取り用に開く。</span><span class="sxs-lookup"><span data-stu-id="dfc41-213">Open for read.</span></span>|<span data-ttu-id="dfc41-214">書き込み用に開く。</span><span class="sxs-lookup"><span data-stu-id="dfc41-214">Open for write.</span></span>|<span data-ttu-id="dfc41-215">どちらも成功します。</span><span class="sxs-lookup"><span data-stu-id="dfc41-215">Both succeed.</span></span> <span data-ttu-id="dfc41-216">トランザクション 2 の書き込み操作は、トランザクション 1 で実行される読み取り操作に影響しません。</span><span class="sxs-lookup"><span data-stu-id="dfc41-216">Write operations under transaction 2 do not affect read operations performed in transaction 1.</span></span>|<span data-ttu-id="dfc41-217">どちらも成功します。</span><span class="sxs-lookup"><span data-stu-id="dfc41-217">Both succeed.</span></span> <span data-ttu-id="dfc41-218">トランザクション 2 の書き込み操作は、トランザクション 1 で実行される読み取り操作に影響しません。</span><span class="sxs-lookup"><span data-stu-id="dfc41-218">Write operations under transaction 2 do not affect read operations performed in transaction 1.</span></span>|  
|<span data-ttu-id="dfc41-219">書き込み用に開く。</span><span class="sxs-lookup"><span data-stu-id="dfc41-219">Open for write.</span></span>|<span data-ttu-id="dfc41-220">読み取り用に開く。</span><span class="sxs-lookup"><span data-stu-id="dfc41-220">Open for read.</span></span>|<span data-ttu-id="dfc41-221">トランザクション 2 の開く操作は、ERROR_SHARING_VIOLATION 例外で失敗します。</span><span class="sxs-lookup"><span data-stu-id="dfc41-221">Open for transaction 2 fails with an ERROR_SHARING_VIOLATION exception.</span></span>|<span data-ttu-id="dfc41-222">どちらも成功します。</span><span class="sxs-lookup"><span data-stu-id="dfc41-222">Both succeed.</span></span>|  
|<span data-ttu-id="dfc41-223">書き込み用に開く。</span><span class="sxs-lookup"><span data-stu-id="dfc41-223">Open for write.</span></span>|<span data-ttu-id="dfc41-224">書き込み用に開く。</span><span class="sxs-lookup"><span data-stu-id="dfc41-224">Open for write.</span></span>|<span data-ttu-id="dfc41-225">トランザクション 2 の開く操作は、ERROR_SHARING_VIOLATION 例外で失敗します。</span><span class="sxs-lookup"><span data-stu-id="dfc41-225">Open for transaction 2 fails with an ERROR_SHARING_VIOLATION exception.</span></span>|<span data-ttu-id="dfc41-226">トランザクション 2 の開く操作は、ERROR_SHARING_VIOLATION 例外で失敗します。</span><span class="sxs-lookup"><span data-stu-id="dfc41-226">Open for transaction 2 fails with an ERROR_SHARING_VIOLATION exception.</span></span>|  
|<span data-ttu-id="dfc41-227">読み取り用に開く。</span><span class="sxs-lookup"><span data-stu-id="dfc41-227">Open for read.</span></span>|<span data-ttu-id="dfc41-228">SELECT 用に開く。</span><span class="sxs-lookup"><span data-stu-id="dfc41-228">Open for SELECT.</span></span>|<span data-ttu-id="dfc41-229">どちらも成功します。</span><span class="sxs-lookup"><span data-stu-id="dfc41-229">Both succeed.</span></span>|<span data-ttu-id="dfc41-230">どちらも成功します。</span><span class="sxs-lookup"><span data-stu-id="dfc41-230">Both succeed.</span></span>|  
|<span data-ttu-id="dfc41-231">読み取り用に開く。</span><span class="sxs-lookup"><span data-stu-id="dfc41-231">Open for read.</span></span>|<span data-ttu-id="dfc41-232">UPDATE または DELETE 用に開く。</span><span class="sxs-lookup"><span data-stu-id="dfc41-232">Open for UPDATE or DELETE.</span></span>|<span data-ttu-id="dfc41-233">どちらも成功します。</span><span class="sxs-lookup"><span data-stu-id="dfc41-233">Both succeed.</span></span> <span data-ttu-id="dfc41-234">トランザクション 2 の書き込み操作は、トランザクション 1 で実行される読み取り操作に影響しません。</span><span class="sxs-lookup"><span data-stu-id="dfc41-234">Write operations under transaction 2 do not affect read operations performed in transaction 1.</span></span>|<span data-ttu-id="dfc41-235">どちらも成功します。</span><span class="sxs-lookup"><span data-stu-id="dfc41-235">Both succeed.</span></span> <span data-ttu-id="dfc41-236">トランザクション 2 の書き込み操作は、トランザクション 1 で実行される読み取り操作に影響しません。</span><span class="sxs-lookup"><span data-stu-id="dfc41-236">Write operations under transaction 2 do not affect read operations performed in transaction 1.</span></span>|  
|<span data-ttu-id="dfc41-237">書き込み用に開く。</span><span class="sxs-lookup"><span data-stu-id="dfc41-237">Open for write.</span></span>|<span data-ttu-id="dfc41-238">SELECT 用に開く。</span><span class="sxs-lookup"><span data-stu-id="dfc41-238">open for SELECT.</span></span>|<span data-ttu-id="dfc41-239">トランザクション 2 は、トランザクション 1 がコミットまたは終了するか、トランザクション ロックがタイムアウトするまで、ブロックされます。</span><span class="sxs-lookup"><span data-stu-id="dfc41-239">Transaction 2 blocks until transaction 1 commits or ends the transaction, or the transaction lock times out.</span></span>|<span data-ttu-id="dfc41-240">どちらも成功します。</span><span class="sxs-lookup"><span data-stu-id="dfc41-240">Both succeed.</span></span>|  
|<span data-ttu-id="dfc41-241">書き込み用に開く。</span><span class="sxs-lookup"><span data-stu-id="dfc41-241">Open for write.</span></span>|<span data-ttu-id="dfc41-242">UPDATE または DELETE 用に開く。</span><span class="sxs-lookup"><span data-stu-id="dfc41-242">Open for UPDATE or DELETE.</span></span>|<span data-ttu-id="dfc41-243">トランザクション 2 は、トランザクション 1 がコミットまたは終了するか、トランザクション ロックがタイムアウトするまで、ブロックされます。</span><span class="sxs-lookup"><span data-stu-id="dfc41-243">Transaction 2 blocks until transaction 1 commits or ends the transaction, or the transaction lock times out.</span></span>|<span data-ttu-id="dfc41-244">トランザクション 2 は、トランザクション 1 がコミットまたは終了するか、トランザクション ロックがタイムアウトするまで、ブロックされます。</span><span class="sxs-lookup"><span data-stu-id="dfc41-244">Transaction 2 blocks until transaction 1 commits or ends the transaction, or the transaction lock times out.</span></span>|  
|<span data-ttu-id="dfc41-245">SELECT 用に開く。</span><span class="sxs-lookup"><span data-stu-id="dfc41-245">Open for SELECT.</span></span>|<span data-ttu-id="dfc41-246">読み取り用に開く。</span><span class="sxs-lookup"><span data-stu-id="dfc41-246">Open for read.</span></span>|<span data-ttu-id="dfc41-247">どちらも成功します。</span><span class="sxs-lookup"><span data-stu-id="dfc41-247">Both succeed.</span></span>|<span data-ttu-id="dfc41-248">どちらも成功します。</span><span class="sxs-lookup"><span data-stu-id="dfc41-248">Both succeed.</span></span>|  
|<span data-ttu-id="dfc41-249">SELECT 用に開く。</span><span class="sxs-lookup"><span data-stu-id="dfc41-249">Open for SELECT.</span></span>|<span data-ttu-id="dfc41-250">書き込み用に開く。</span><span class="sxs-lookup"><span data-stu-id="dfc41-250">Open for write.</span></span>|<span data-ttu-id="dfc41-251">どちらも成功します。</span><span class="sxs-lookup"><span data-stu-id="dfc41-251">Both succeed.</span></span> <span data-ttu-id="dfc41-252">トランザクション 2 の書き込み操作は、トランザクション 1 に影響しません。</span><span class="sxs-lookup"><span data-stu-id="dfc41-252">Write operations under transaction 2 do not affect transaction 1.</span></span>|<span data-ttu-id="dfc41-253">どちらも成功します。</span><span class="sxs-lookup"><span data-stu-id="dfc41-253">Both succeed.</span></span> <span data-ttu-id="dfc41-254">トランザクション 2 の書き込み操作は、トランザクション 1 に影響しません。</span><span class="sxs-lookup"><span data-stu-id="dfc41-254">Write operations under transaction 2 do not affect transaction 1.</span></span>|  
|<span data-ttu-id="dfc41-255">UPDATE または DELETE 用に開く。</span><span class="sxs-lookup"><span data-stu-id="dfc41-255">Open for UPDATE or DELETE.</span></span>|<span data-ttu-id="dfc41-256">読み取り用に開く。</span><span class="sxs-lookup"><span data-stu-id="dfc41-256">Open for read.</span></span>|<span data-ttu-id="dfc41-257">トランザクション 2 の開く操作は、ERROR_SHARING_VIOLATION 例外で失敗します。</span><span class="sxs-lookup"><span data-stu-id="dfc41-257">The open operation on transaction 2 fails with an ERROR_SHARING_VIOLATION exception.</span></span>|<span data-ttu-id="dfc41-258">どちらも成功します。</span><span class="sxs-lookup"><span data-stu-id="dfc41-258">Both succeed.</span></span>|  
|<span data-ttu-id="dfc41-259">UPDATE または DELETE 用に開く。</span><span class="sxs-lookup"><span data-stu-id="dfc41-259">Open for UPDATE or DELETE.</span></span>|<span data-ttu-id="dfc41-260">書き込み用に開く。</span><span class="sxs-lookup"><span data-stu-id="dfc41-260">Open for write.</span></span>|<span data-ttu-id="dfc41-261">トランザクション 2 の開く操作は、ERROR_SHARING_VIOLATION 例外で失敗します。</span><span class="sxs-lookup"><span data-stu-id="dfc41-261">The open operation on transaction 2 fails with an ERROR_SHARING_VIOLATION exception.</span></span>|<span data-ttu-id="dfc41-262">トランザクション 2 の開く操作は、ERROR_SHARING_VIOLATION 例外で失敗します。</span><span class="sxs-lookup"><span data-stu-id="dfc41-262">The open operation on transaction 2 fails with an ERROR_SHARING_VIOLATION exception.</span></span>|  
|<span data-ttu-id="dfc41-263">Repeatable Read の SELECT 用に開く。</span><span class="sxs-lookup"><span data-stu-id="dfc41-263">Open for SELECT with repeatable read.</span></span>|<span data-ttu-id="dfc41-264">読み取り用に開く。</span><span class="sxs-lookup"><span data-stu-id="dfc41-264">Open for read.</span></span>|<span data-ttu-id="dfc41-265">どちらも成功します。</span><span class="sxs-lookup"><span data-stu-id="dfc41-265">Both succeed.</span></span>|<span data-ttu-id="dfc41-266">どちらも成功します。</span><span class="sxs-lookup"><span data-stu-id="dfc41-266">Both succeed.</span></span>|  
|<span data-ttu-id="dfc41-267">Repeatable Read の SELECT 用に開く。</span><span class="sxs-lookup"><span data-stu-id="dfc41-267">Open for SELECT with repeatable read.</span></span>|<span data-ttu-id="dfc41-268">書き込み用に開く。</span><span class="sxs-lookup"><span data-stu-id="dfc41-268">Open for write.</span></span>|<span data-ttu-id="dfc41-269">トランザクション 2 の開く操作は、ERROR_SHARING_VIOLATION 例外で失敗します。</span><span class="sxs-lookup"><span data-stu-id="dfc41-269">The open operation on transaction 2 fails with an ERROR_SHARING_VIOLATION exception.</span></span>|<span data-ttu-id="dfc41-270">トランザクション 2 の開く操作は、ERROR_SHARING_VIOLATION 例外で失敗します。</span><span class="sxs-lookup"><span data-stu-id="dfc41-270">The open operation on transaction 2 fails with an ERROR_SHARING_VIOLATION exception.</span></span>|  
  
 <span data-ttu-id="dfc41-271">**リモート クライアントからのライトスルー**</span><span class="sxs-lookup"><span data-stu-id="dfc41-271">**Write-Through from Remote Clients**</span></span>  
  
 <span data-ttu-id="dfc41-272">FILESTREAM データへのリモート ファイル システム アクセスは、サーバー メッセージ ブロック (SMB) プロトコルによって実現されます。</span><span class="sxs-lookup"><span data-stu-id="dfc41-272">Remote file system access to FILESTREAM data is enabled over the Server Message Block (SMB) protocol.</span></span> <span data-ttu-id="dfc41-273">クライアントがリモート クライアントの場合は、書き込み操作がクライアント側でキャッシュされず、</span><span class="sxs-lookup"><span data-stu-id="dfc41-273">If the client is remote, no write operations are cached by the client side.</span></span> <span data-ttu-id="dfc41-274">常にサーバーに送信されます。</span><span class="sxs-lookup"><span data-stu-id="dfc41-274">The write operations will always be sent to the server.</span></span> <span data-ttu-id="dfc41-275">サーバー側でデータをキャッシュできます。</span><span class="sxs-lookup"><span data-stu-id="dfc41-275">The data can be cached on the server side.</span></span> <span data-ttu-id="dfc41-276">リモート クライアントで実行されるアプリケーションでは、小さな書き込み操作を統合して、大きなデータ サイズを使用して書き込み操作を減らすことをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="dfc41-276">We recommend that applications that are running on remote clients consolidate small write operations to make fewer write operations using larger data size.</span></span>  
  
 <span data-ttu-id="dfc41-277">FILESTREAM ハンドルを使用してメモリ マップ表示 (メモリ マップ I/O) を作成することはできません。</span><span class="sxs-lookup"><span data-stu-id="dfc41-277">Creating memory mapped views (memory mapped I/O) by using a FILESTREAM handle is not supported.</span></span> <span data-ttu-id="dfc41-278">FILESTREAM データに対してメモリ マッピングを使用すると、 [!INCLUDE[ssDE](../../includes/ssde-md.md)] でデータの一貫性および持続性やデータベースの整合性を保証できなくなります。</span><span class="sxs-lookup"><span data-stu-id="dfc41-278">If memory mapping is used for FILESTREAM data, the [!INCLUDE[ssDE](../../includes/ssde-md.md)] cannot guarantee consistency and durability of the data or the integrity of the database.</span></span>  
  
##  <a name="related-tasks"></a><a name="reltasks"></a> <span data-ttu-id="dfc41-279">関連タスク</span><span class="sxs-lookup"><span data-stu-id="dfc41-279">Related Tasks</span></span>  
 [<span data-ttu-id="dfc41-280">FILESTREAM の有効化と構成</span><span class="sxs-lookup"><span data-stu-id="dfc41-280">Enable and Configure FILESTREAM</span></span>](enable-and-configure-filestream.md)  
  [<span data-ttu-id="dfc41-281">FILESTREAM が有効なデータベースを作成する方法</span><span class="sxs-lookup"><span data-stu-id="dfc41-281">Create a FILESTREAM-Enabled Database</span></span>](create-a-filestream-enabled-database.md)  
  [<span data-ttu-id="dfc41-282">FILESTREAM データを格納するテーブルを作成する方法</span><span class="sxs-lookup"><span data-stu-id="dfc41-282">Create a Table for Storing FILESTREAM Data</span></span>](create-a-table-for-storing-filestream-data.md)  
  [<span data-ttu-id="dfc41-283">Transact-SQL による FILESTREAM データへのアクセス</span><span class="sxs-lookup"><span data-stu-id="dfc41-283">Access FILESTREAM Data with Transact-SQL</span></span>](access-filestream-data-with-transact-sql.md)  
  [<span data-ttu-id="dfc41-284">FILESTREAM データ用のクライアント アプリケーションの作成</span><span class="sxs-lookup"><span data-stu-id="dfc41-284">Create Client Applications for FILESTREAM Data</span></span>](create-client-applications-for-filestream-data.md)  
  [<span data-ttu-id="dfc41-285">OpenSqlFilestream による FILESTREAM データへのアクセス</span><span class="sxs-lookup"><span data-stu-id="dfc41-285">Access FILESTREAM Data with OpenSqlFilestream</span></span>](access-filestream-data-with-opensqlfilestream.md)  
  [<span data-ttu-id="dfc41-286">FILESTREAM データの部分的な更新</span><span class="sxs-lookup"><span data-stu-id="dfc41-286">Make Partial Updates to FILESTREAM Data</span></span>](make-partial-updates-to-filestream-data.md)  
  [<span data-ttu-id="dfc41-287">FILESTREAM アプリケーションでのデータベース操作との競合の回避</span><span class="sxs-lookup"><span data-stu-id="dfc41-287">Avoid Conflicts with Database Operations in FILESTREAM Applications</span></span>](avoid-conflicts-with-database-operations-in-filestream-applications.md)  
  [<span data-ttu-id="dfc41-288">FILESTREAM が有効なデータベースの移動</span><span class="sxs-lookup"><span data-stu-id="dfc41-288">Move a FILESTREAM-Enabled Database</span></span>](move-a-filestream-enabled-database.md)  
  [<span data-ttu-id="dfc41-289">フェールオーバー クラスターでの FILESTREAM の設定</span><span class="sxs-lookup"><span data-stu-id="dfc41-289">Set Up FILESTREAM on a Failover Cluster</span></span>](set-up-filestream-on-a-failover-cluster.md)  
  [<span data-ttu-id="dfc41-290">FILESTREAM アクセスのためのファイアウォールの構成</span><span class="sxs-lookup"><span data-stu-id="dfc41-290">Configure a Firewall for FILESTREAM Access</span></span>](configure-a-firewall-for-filestream-access.md)  
  
##  <a name="related-content"></a><a name="relcontent"></a> <span data-ttu-id="dfc41-291">関連コンテンツ</span><span class="sxs-lookup"><span data-stu-id="dfc41-291">Related Content</span></span>  
 [<span data-ttu-id="dfc41-292">FILESTREAM と SQL Server のその他の機能との互換性</span><span class="sxs-lookup"><span data-stu-id="dfc41-292">FILESTREAM Compatibility with Other SQL Server Features</span></span>](filestream-compatibility-with-other-sql-server-features.md)  
  
