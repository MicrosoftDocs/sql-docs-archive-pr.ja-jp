---
title: SQL Server とデータベースの暗号化キー (データベース エンジン) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: security
ms.topic: conceptual
helpviewer_keywords:
- keys [SQL Server], database encryption
ms.assetid: 15c0a5e8-9177-484c-ae75-8c552dc0dac0
author: jaszymas
ms.author: jaszymas
ms.openlocfilehash: f846e74e0afd89c6bb10a4aa9a23a6420b6a613a
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87743154"
---
# <a name="sql-server-and-database-encryption-keys-database-engine"></a><span data-ttu-id="0116e-102">SQL Server とデータベースの暗号化キー (データベース エンジン)</span><span class="sxs-lookup"><span data-stu-id="0116e-102">SQL Server and Database Encryption Keys (Database Engine)</span></span>
  [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="0116e-103">では、暗号化キーを使用して、サーバー データベースに格納されているデータ、資格情報、および接続情報のセキュリティを保護します。</span><span class="sxs-lookup"><span data-stu-id="0116e-103">uses encryption keys to help secure data, credentials, and connection information that is stored in a server database.</span></span> [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="0116e-104">には、 *対称* と *非対称*の 2 種類のキーがあります。</span><span class="sxs-lookup"><span data-stu-id="0116e-104">has two kinds of keys: *symmetric* and *asymmetric*.</span></span> <span data-ttu-id="0116e-105">対称キーでは、データの暗号化と暗号化解除に同じパスワードが使用されます。</span><span class="sxs-lookup"><span data-stu-id="0116e-105">Symmetric keys use the same password to encrypt and decrypt data.</span></span> <span data-ttu-id="0116e-106">非対称キーでは、データを暗号化するパスワード ( *公開* キー) とデータの暗号化を解除するパスワード ( *秘密* キー) が使い分けられます。</span><span class="sxs-lookup"><span data-stu-id="0116e-106">Asymmetric keys use one password to encrypt data (called the *public* key) and another to decrypt data (called the *private* key).</span></span>  
  
 <span data-ttu-id="0116e-107">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]の暗号化キーでは、公開キー、秘密キー、対称キーを組み合わせて機密データの保護に使用します。</span><span class="sxs-lookup"><span data-stu-id="0116e-107">In [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], encryption keys include a combination of public, private, and symmetric keys that are used to protect sensitive data.</span></span> <span data-ttu-id="0116e-108">対称キーは、 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] インスタンスを最初に起動するときの [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 初期化時に作成されます。</span><span class="sxs-lookup"><span data-stu-id="0116e-108">The symmetric key is created during [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] initialization when you first start the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance.</span></span> <span data-ttu-id="0116e-109">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] は、このキーを使用して [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]に格納されている機密データを暗号化します。</span><span class="sxs-lookup"><span data-stu-id="0116e-109">The key is used by [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] to encrypt sensitive data that is stored in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="0116e-110">公開キーと秘密キーはオペレーティング システムによって作成され、これらのキーを使用して対称キーが保護されます。</span><span class="sxs-lookup"><span data-stu-id="0116e-110">Public and private keys are created by the operating system and they are used to protect the symmetric key.</span></span> <span data-ttu-id="0116e-111">公開キーと秘密キーのペアは、データベースに機密データを格納する [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] インスタンスごとに作成されます。</span><span class="sxs-lookup"><span data-stu-id="0116e-111">A public and private key pair is created for each [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance that stores sensitive data in a database.</span></span>  
  
## <a name="applications-for-sql-server-and-database-keys"></a><span data-ttu-id="0116e-112">SQL Server およびデータベース キーの用途</span><span class="sxs-lookup"><span data-stu-id="0116e-112">Applications for SQL Server and Database Keys</span></span>  
 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="0116e-113">では、キーに 2 つの主要な用途があります。1 つは *インスタンスに対して生成される* サービス マスター キー [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] (SMK)、もう 1 つはデータベースに使用される *データベース マスター キー* (DMK) です。</span><span class="sxs-lookup"><span data-stu-id="0116e-113">has two primary applications for keys: a *service master key* (SMK) generated on and for a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance, and a *database master key* (DMK) used for a database.</span></span>  
  
 <span data-ttu-id="0116e-114">SMK は、 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] インスタンスの初回起動時に自動的に生成され、リンク サーバーのパスワード、資格情報、およびデータベース マスター キーの暗号化に使用されます。</span><span class="sxs-lookup"><span data-stu-id="0116e-114">The SMK is automatically generated the first time the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance is started and is used to encrypt a linked server password, credentials, and the database master key.</span></span> <span data-ttu-id="0116e-115">SMK は、Windows データ保護 API (DPAPI) を使用するローカル コンピューター キーを使用して暗号化されます。</span><span class="sxs-lookup"><span data-stu-id="0116e-115">The SMK is encrypted by using the local computer key using the Windows Data Protection API (DPAPI).</span></span> <span data-ttu-id="0116e-116">DPAPI では、 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] サービス アカウントの Windows 資格情報およびコンピューターの資格情報から派生するキーが使用されます。</span><span class="sxs-lookup"><span data-stu-id="0116e-116">The DPAPI uses a key that is derived from the Windows credentials of the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] service account and the computer's credentials.</span></span> <span data-ttu-id="0116e-117">サービス マスター キーの暗号化を解除できるのは、作成元のサービス アカウント、またはコンピューターの資格情報にアクセスできるプリンシパルに限られています。</span><span class="sxs-lookup"><span data-stu-id="0116e-117">The service master key can only be decrypted by the service account under which it was created or by a principal that has access to the machine's credentials.</span></span>  
  
 <span data-ttu-id="0116e-118">データベース マスター キーは対称キーで、証明書の秘密キーやデータベース内にある非対称キーを保護するときに使用されます。</span><span class="sxs-lookup"><span data-stu-id="0116e-118">The database master key is a symmetric key that is used to protect the private keys of certificates and asymmetric keys that are present in the database.</span></span> <span data-ttu-id="0116e-119">このキーはデータの暗号化にも使用できますが、長さに制限があるため、対称キーに比べるとデータに対する実用性は低くなります。</span><span class="sxs-lookup"><span data-stu-id="0116e-119">It can also be used to encrypt data, but it has length limitations that make it less practical for data than using a symmetric key.</span></span>  
  
 <span data-ttu-id="0116e-120">このマスター キーは、その作成時に、トリプル DES アルゴリズムとユーザー指定のパスワードを使用して暗号化されます。</span><span class="sxs-lookup"><span data-stu-id="0116e-120">When it is created, the master key is encrypted by using the Triple DES algorithm and a user-supplied password.</span></span> <span data-ttu-id="0116e-121">マスター キーの暗号化を自動的に解除できるように、SMK を使用してこのキーのコピーが暗号化されます。</span><span class="sxs-lookup"><span data-stu-id="0116e-121">To enable the automatic decryption of the master key, a copy of the key is encrypted by using the SMK.</span></span> <span data-ttu-id="0116e-122">暗号化されたコピーは、使用先のデータベースおよび `master` システム データベースの両方に格納されます。</span><span class="sxs-lookup"><span data-stu-id="0116e-122">It is stored in both the database where it is used and in the `master` system database.</span></span>  
  
 <span data-ttu-id="0116e-123">`master` システム データベースに格納された DMK のコピーは、DMK が変更されるたびに自動的に更新されます。</span><span class="sxs-lookup"><span data-stu-id="0116e-123">The copy of the DMK stored in the `master` system database is silently updated whenever the DMK is changed.</span></span> <span data-ttu-id="0116e-124">ただし、この既定の動作は `DROP ENCRYPTION BY SERVICE MASTER KEY` ステートメントの `ALTER MASTER KEY` オプションを使用して変更できます。</span><span class="sxs-lookup"><span data-stu-id="0116e-124">However, this default can be changed by using the `DROP ENCRYPTION BY SERVICE MASTER KEY` option of the `ALTER MASTER KEY` statement.</span></span> <span data-ttu-id="0116e-125">サービス マスター キーで暗号化されていない DMK を開くには、`OPEN MASTER KEY` ステートメントとパスワードを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="0116e-125">A DMK that is not encrypted by the service master key must be opened by using the `OPEN MASTER KEY` statement and a password.</span></span>  
  
## <a name="managing-sql-server-and-database-keys"></a><span data-ttu-id="0116e-126">SQL Server およびデータベースのキーの管理</span><span class="sxs-lookup"><span data-stu-id="0116e-126">Managing SQL Server and Database Keys</span></span>  
 <span data-ttu-id="0116e-127">暗号化キーの管理は、新しいデータベース キーの作成、サーバーおよびデータベースのキーのバックアップ作成、およびキーの復元、削除、変更のタイミングと方法を把握することによって行われます。</span><span class="sxs-lookup"><span data-stu-id="0116e-127">Managing encryption keys consists of creating new database keys, creating a backup of the server and database keys, and knowing when and how to restore, delete, or change the keys.</span></span>  
  
 <span data-ttu-id="0116e-128">対称キーを管理するには、 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 付属のツールを使用して以下の作業を行います。</span><span class="sxs-lookup"><span data-stu-id="0116e-128">To manage symmetric keys, you can use the tools included in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] to do the following:</span></span>  
  
-   <span data-ttu-id="0116e-129">サーバーを復旧させるため、または計画的な移行の一環として使用できるように、サーバーおよびデータベースのキーのコピーをバックアップします。</span><span class="sxs-lookup"><span data-stu-id="0116e-129">Back up a copy of the server and database keys so that you can use them to recover a server installation, or as part of a planned migration.</span></span>  
  
-   <span data-ttu-id="0116e-130">以前に保存したキーをデータベースに復元します。</span><span class="sxs-lookup"><span data-stu-id="0116e-130">Restore a previously saved key to a database.</span></span> <span data-ttu-id="0116e-131">これにより、新しいサーバー インスタンスは、そのインスタンスで暗号化していない既存のデータにアクセスできるようになります。</span><span class="sxs-lookup"><span data-stu-id="0116e-131">This enables a new server instance to access existing data that it did not originally encrypt.</span></span>  
  
-   <span data-ttu-id="0116e-132">暗号化されたデータにアクセスできなくなった場合は、データベース内の暗号化されたデータを削除します。</span><span class="sxs-lookup"><span data-stu-id="0116e-132">Delete the encrypted data in a database in the unlikely event that you can no longer access encrypted data.</span></span>  
  
-   <span data-ttu-id="0116e-133">キーに障害が起きた場合は、そのキーを再作成し、データを再暗号化します。</span><span class="sxs-lookup"><span data-stu-id="0116e-133">Re-create keys and re-encrypt data in the unlikely event that the key is compromised.</span></span> <span data-ttu-id="0116e-134">セキュリティを高めるには、キーを定期的 (たとえば数か月ごと) に再作成して、キーを解読しようとする攻撃からサーバーを保護する必要があります。</span><span class="sxs-lookup"><span data-stu-id="0116e-134">As a security best practice, you should re-create the keys periodically (for example, every few months) to protect the server from attacks that try to decipher the keys.</span></span>  
  
-   <span data-ttu-id="0116e-135">複数のサーバーが 1 つのデータベースとそのデータベースの暗号化を解除するキーの両方を共有する場合は、サーバー スケールアウト配置に対してサーバー インスタンスを追加または削除します。</span><span class="sxs-lookup"><span data-stu-id="0116e-135">Add or remove a server instance from a server scale-out deployment where multiple servers share both a single database and the key that provides reversible encryption for that database.</span></span>  
  
## <a name="important-security-information"></a><span data-ttu-id="0116e-136">重要なセキュリティ情報</span><span class="sxs-lookup"><span data-stu-id="0116e-136">Important Security Information</span></span>  
 <span data-ttu-id="0116e-137">サービス マスター キーで保護されているオブジェクトにアクセスするには、そのキーの作成に使用された [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] サービス アカウント、またはコンピューター アカウントのいずれかが必要です。</span><span class="sxs-lookup"><span data-stu-id="0116e-137">Accessing objects secured by the service master key requires either the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Service account that was used to create the key or the computer (machine) account.</span></span> <span data-ttu-id="0116e-138">つまり、コンピューターはキーが作成されたシステムに関連付けられています。</span><span class="sxs-lookup"><span data-stu-id="0116e-138">That is, the computer is tied to the system where the key was created.</span></span> <span data-ttu-id="0116e-139">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] サービス アカウント *または* コンピューター アカウントを変更しても、キーにアクセスできなくなることはありません。</span><span class="sxs-lookup"><span data-stu-id="0116e-139">You can change the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Service account *or* the computer account without losing access to the key.</span></span> <span data-ttu-id="0116e-140">ただし、両方を変更するとサービス マスター キーにはアクセスできなくなります。</span><span class="sxs-lookup"><span data-stu-id="0116e-140">However, if you change both, you will lose access to the service master key.</span></span> <span data-ttu-id="0116e-141">この 2 つのアカウントが一方しかない状態でサービス マスター キーにアクセスできなくなると、元のキーで暗号化されたデータとオブジェクトは暗号化解除できなくなります。</span><span class="sxs-lookup"><span data-stu-id="0116e-141">If you lose access to the service master key without one of these two elements, you be unable to decrypt data and objects encrypted by using the original key.</span></span>  
  
 <span data-ttu-id="0116e-142">サービス マスター キーで保護されている接続は、サービス マスター キーがないと復元できません。</span><span class="sxs-lookup"><span data-stu-id="0116e-142">Connections secured with the service master key cannot be restored without the service master key.</span></span>  
  
 <span data-ttu-id="0116e-143">データベース マスター キーで保護されたオブジェクトとデータにアクセスする場合は、そのキーを保護する際に使用されたパスワードのみが必要です。</span><span class="sxs-lookup"><span data-stu-id="0116e-143">Access to objects and data secured with the database master key require only the password that is used to help secure the key.</span></span>  
  
> [!CAUTION]  
>  <span data-ttu-id="0116e-144">上記のキーすべてにアクセスできなくなると、それらのキーで保護されているオブジェクト、接続、およびデータにもアクセスできなくなります。</span><span class="sxs-lookup"><span data-stu-id="0116e-144">If you lose all access to the keys described earlier, you will lose access to the objects, connections, and data secured by those keys.</span></span> <span data-ttu-id="0116e-145">ここで示したリンクの説明に従ってサービス マスター キーを復元するか、または元の暗号化システムに戻ってアクセスを復旧します。</span><span class="sxs-lookup"><span data-stu-id="0116e-145">You can restore the service master key, as described in the links that are shown here, or you can go back to the original encrypting system to recover the access.</span></span> <span data-ttu-id="0116e-146">アクセスを復旧するための "抜け道" はありません。</span><span class="sxs-lookup"><span data-stu-id="0116e-146">There is no "back-door" to recover the access.</span></span>  
  
## <a name="in-this-section"></a><span data-ttu-id="0116e-147">このセクションの内容</span><span class="sxs-lookup"><span data-stu-id="0116e-147">In This Section</span></span>  
 [<span data-ttu-id="0116e-148">サービス マスター キー</span><span class="sxs-lookup"><span data-stu-id="0116e-148">Service Master Key</span></span>](service-master-key.md)  
 <span data-ttu-id="0116e-149">サービス マスター キーとその推奨事項について簡単に説明します。</span><span class="sxs-lookup"><span data-stu-id="0116e-149">Provides a brief explanation for the service master key and its best practices.</span></span>  
  
 [<span data-ttu-id="0116e-150">拡張キー管理 &#40;EKM&#41;</span><span class="sxs-lookup"><span data-stu-id="0116e-150">Extensible Key Management &#40;EKM&#41;</span></span>](extensible-key-management-ekm.md)  
 <span data-ttu-id="0116e-151">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]でサード パーティのキー管理システムを使用する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="0116e-151">Explains how to use third-party key management systems with [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span>  
  
## <a name="related-tasks"></a><span data-ttu-id="0116e-152">Related Tasks</span><span class="sxs-lookup"><span data-stu-id="0116e-152">Related Tasks</span></span>  
 [<span data-ttu-id="0116e-153">サービス マスター キーのバックアップ</span><span class="sxs-lookup"><span data-stu-id="0116e-153">Back Up the Service Master Key</span></span>](back-up-the-service-master-key.md)  
  
 [<span data-ttu-id="0116e-154">サービス マスター キーの復元</span><span class="sxs-lookup"><span data-stu-id="0116e-154">Restore the Service Master Key</span></span>](restore-the-service-master-key.md)  
  
 [<span data-ttu-id="0116e-155">データベース マスター キーの作成</span><span class="sxs-lookup"><span data-stu-id="0116e-155">Create a Database Master Key</span></span>](create-a-database-master-key.md)  
  
 [<span data-ttu-id="0116e-156">データベース マスター キーのバックアップ</span><span class="sxs-lookup"><span data-stu-id="0116e-156">Back Up a Database Master Key</span></span>](back-up-a-database-master-key.md)  
  
 [<span data-ttu-id="0116e-157">データベース マスター キーの復元</span><span class="sxs-lookup"><span data-stu-id="0116e-157">Restore a Database Master Key</span></span>](restore-a-database-master-key.md)  
  
 [<span data-ttu-id="0116e-158">2 台のサーバーでの同じ対称キーの作成</span><span class="sxs-lookup"><span data-stu-id="0116e-158">Create Identical Symmetric Keys on Two Servers</span></span>](create-identical-symmetric-keys-on-two-servers.md)  
  
 [<span data-ttu-id="0116e-159">Azure Key Vault を使用する拡張キー管理 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="0116e-159">Extensible Key Management Using Azure Key Vault &#40;SQL Server&#41;</span></span>](extensible-key-management-using-azure-key-vault-sql-server.md)  
  
 [<span data-ttu-id="0116e-160">EKM を使用して TDE を有効にする</span><span class="sxs-lookup"><span data-stu-id="0116e-160">Enable TDE Using EKM</span></span>](enable-tde-on-sql-server-using-ekm.md)  
  
## <a name="related-content"></a><span data-ttu-id="0116e-161">関連コンテンツ</span><span class="sxs-lookup"><span data-stu-id="0116e-161">Related Content</span></span>  
 [<span data-ttu-id="0116e-162">CREATE MASTER KEY &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="0116e-162">CREATE MASTER KEY &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/create-master-key-transact-sql)  
  
 [<span data-ttu-id="0116e-163">ALTER SERVICE MASTER KEY &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="0116e-163">ALTER SERVICE MASTER KEY &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/alter-service-master-key-transact-sql)  
  
 [<span data-ttu-id="0116e-164">データベース マスター キーの復元</span><span class="sxs-lookup"><span data-stu-id="0116e-164">Restore a Database Master Key</span></span>](restore-a-database-master-key.md)  
  
## <a name="see-also"></a><span data-ttu-id="0116e-165">参照</span><span class="sxs-lookup"><span data-stu-id="0116e-165">See Also</span></span>  
 <span data-ttu-id="0116e-166">[Reporting Services の暗号化キーのバックアップと復元](../../../reporting-services/install-windows/ssrs-encryption-keys-back-up-and-restore-encryption-keys.md) </span><span class="sxs-lookup"><span data-stu-id="0116e-166">[Back Up and Restore Reporting Services Encryption Keys](../../../reporting-services/install-windows/ssrs-encryption-keys-back-up-and-restore-encryption-keys.md) </span></span>  
 <span data-ttu-id="0116e-167">[暗号化キーの削除と再作成  &#40;SSRS 構成マネージャー&#41;](../../../reporting-services/install-windows/ssrs-encryption-keys-delete-and-re-create-encryption-keys.md) </span><span class="sxs-lookup"><span data-stu-id="0116e-167">[Delete and Re-create Encryption Keys  &#40;SSRS Configuration Manager&#41;](../../../reporting-services/install-windows/ssrs-encryption-keys-delete-and-re-create-encryption-keys.md) </span></span>  
 <span data-ttu-id="0116e-168">[スケールアウト配置に関する暗号化キーの追加と削除 &#40;SSRS 構成マネージャー&#41;](../../../reporting-services/install-windows/add-and-remove-encryption-keys-for-scale-out-deployment.md) </span><span class="sxs-lookup"><span data-stu-id="0116e-168">[Add and Remove Encryption Keys for Scale-Out Deployment &#40;SSRS Configuration Manager&#41;](../../../reporting-services/install-windows/add-and-remove-encryption-keys-for-scale-out-deployment.md) </span></span>  
 [<span data-ttu-id="0116e-169">透過的なデータ暗号化 &#40;TDE&#41;</span><span class="sxs-lookup"><span data-stu-id="0116e-169">Transparent Data Encryption &#40;TDE&#41;</span></span>](transparent-data-encryption.md)  
  
  
