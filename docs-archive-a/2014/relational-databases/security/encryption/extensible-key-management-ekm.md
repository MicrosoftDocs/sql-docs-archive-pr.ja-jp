---
title: 拡張キー管理 (EKM) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: security
ms.topic: conceptual
helpviewer_keywords:
- Key Management
- Extensible Key Management
- EKM, described
ms.assetid: 9bfaf500-2d1e-4c02-b041-b8761a9e695b
author: jaszymas
ms.author: jaszymas
ms.openlocfilehash: 4fc9b002b57f8118494709f8fe27a8b19ce28d8e
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87716178"
---
# <a name="extensible-key-management-ekm"></a><span data-ttu-id="c537f-102">拡張キー管理 (EKM)</span><span class="sxs-lookup"><span data-stu-id="c537f-102">Extensible Key Management (EKM)</span></span>
  [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="c537f-103">には、 *拡張キー管理* (EKM) を含むデータ暗号化機能が用意されています。暗号化とキーの生成には *Microsoft Cryptographic API* (MSCAPI) が使用されます。</span><span class="sxs-lookup"><span data-stu-id="c537f-103">provides data encryption capabilities together with *Extensible Key Management* (EKM), using the *Microsoft Cryptographic API* (MSCAPI) provider for encryption and key generation.</span></span> <span data-ttu-id="c537f-104">データとキーの暗号化のための暗号化キーは一時的なキー コンテナーに作成され、それらをデータベースに格納するには、まずプロバイダーからエクスポートする必要があります。</span><span class="sxs-lookup"><span data-stu-id="c537f-104">Encryption keys for data and key encryption are created in transient key containers, and they must be exported from a provider before they are stored in the database.</span></span> <span data-ttu-id="c537f-105">この方法により、暗号化キー階層とキーのバックアップを含むキー管理を [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]で処理できるようになります。</span><span class="sxs-lookup"><span data-stu-id="c537f-105">This approach enables key management that includes an encryption key hierarchy and key backup, to be handled by [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span>  
  
 <span data-ttu-id="c537f-106">法規制遵守の必要性やデータ プライバシーに対する関心の高まりを受けて、組織では、"多層防御" のソリューションを実現するための手段として暗号化が活用されるようになっています。</span><span class="sxs-lookup"><span data-stu-id="c537f-106">With the growing demand for regulatory compliance and concern for data privacy, organizations are taking advantage of encryption as a way to provide a "defense in depth" solution.</span></span> <span data-ttu-id="c537f-107">このアプローチは多くの場合、データベースの暗号化管理ツールを使用するだけで実現できるものではありません。</span><span class="sxs-lookup"><span data-stu-id="c537f-107">This approach is often impractical using only database encryption management tools.</span></span> <span data-ttu-id="c537f-108">各ハードウェア ベンダーからは、 *ハードウェア セキュリティ モジュール* (HSM) を使用して企業のキー管理の問題に対処する製品が提供されています。</span><span class="sxs-lookup"><span data-stu-id="c537f-108">Hardware vendors provide products that address enterprise key management by using *Hardware Security Modules* (HSM).</span></span> <span data-ttu-id="c537f-109">HSM デバイスでは、暗号化キーがハードウェア モジュールまたはソフトウェア モジュールに格納されます。</span><span class="sxs-lookup"><span data-stu-id="c537f-109">HSM devices store encryption keys on hardware or software modules.</span></span> <span data-ttu-id="c537f-110">この場合、暗号化キーが暗号化データと一緒に保管されないため、より安全なソリューションが実現されます。</span><span class="sxs-lookup"><span data-stu-id="c537f-110">This is a more secure solution because the encryption keys do not reside with encryption data.</span></span>  
  
 <span data-ttu-id="c537f-111">多くのベンダーにより、キー管理と暗号化アクセラレーションの両方に対応する HSM が提供されています。</span><span class="sxs-lookup"><span data-stu-id="c537f-111">A number of vendors offer HSM for both key management and encryption acceleration.</span></span> <span data-ttu-id="c537f-112">HSM デバイスでは、アプリケーションと HSM の仲介として、サーバー プロセスとのハードウェア インターフェイスが使用されます。</span><span class="sxs-lookup"><span data-stu-id="c537f-112">HSM devices use hardware interfaces with a server process as an intermediary between an application and an HSM.</span></span> <span data-ttu-id="c537f-113">また、モジュール上に MSCAPI プロバイダー (ハードウェアの場合もあればソフトウェアの場合もあります) が実装されています。</span><span class="sxs-lookup"><span data-stu-id="c537f-113">Vendors also implement MSCAPI providers over their modules, which might be hardware or software.</span></span> <span data-ttu-id="c537f-114">MSCAPI では、多くの場合、HSM でサポートされている機能の一部しかサポートされません。</span><span class="sxs-lookup"><span data-stu-id="c537f-114">MSCAPI often offers only a subset of the functionality that is offered by an HSM.</span></span> <span data-ttu-id="c537f-115">その他、HSM、キーの構成、およびキーへのアクセスのための管理ソフトウェアが用意されている場合もあります。</span><span class="sxs-lookup"><span data-stu-id="c537f-115">Vendors can also provide management software for HSM, key configuration, and key access.</span></span>  
  
 <span data-ttu-id="c537f-116">HSM の実装はベンダーによってさまざまです。したがって、 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] でそれらを使用するには、共通のインターフェイスが必要です。</span><span class="sxs-lookup"><span data-stu-id="c537f-116">HSM implementations vary from vendor to vendor, and to use them with [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] requires a common interface.</span></span> <span data-ttu-id="c537f-117">このインターフェイスを提供するのが MSCAPI ですが、HSM の機能の一部しかサポートされません。</span><span class="sxs-lookup"><span data-stu-id="c537f-117">Although the MSCAPI provides this interface, it supports only a subset of the HSM features.</span></span> <span data-ttu-id="c537f-118">MSCAPI には、これ以外にも、対称キーをネイティブのまま永続化できない、セッション指向の通信がサポートされていないなどの制限があります。</span><span class="sxs-lookup"><span data-stu-id="c537f-118">It also has other limitations, such as the inability to natively persist symmetric keys, and a lack of session-oriented support.</span></span>  
  
 <span data-ttu-id="c537f-119">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] の拡張キー管理では、サードパーティの EKM/HSM ベンダーがそれぞれのモジュールを [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]に登録できます。</span><span class="sxs-lookup"><span data-stu-id="c537f-119">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Extensible Key Management enables third-party EKM/HSM vendors to register their modules in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="c537f-120">登録すると、その EKM モジュールに格納されている暗号化キーを [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] ユーザーが使用できるようになります。</span><span class="sxs-lookup"><span data-stu-id="c537f-120">When registered, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] users can use the encryption keys stored on EKM modules.</span></span> <span data-ttu-id="c537f-121">これにより、それらのモジュールでサポートされている一括暗号化/暗号化解除などの高度な暗号化機能や、キー エージングやキー ローテーションなどのキー管理機能を [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] から利用できます。</span><span class="sxs-lookup"><span data-stu-id="c537f-121">This enables [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] to access the advanced encryption features these modules support such as bulk encryption and decryption, and key management functions such as key aging and key rotation.</span></span>  
  
 <span data-ttu-id="c537f-122">Azure 仮想マシンで [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] を実行している場合、 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] は、 [Azure Key Vault](https://go.microsoft.com/fwlink/?LinkId=521401)に格納されたキーを使用できます。</span><span class="sxs-lookup"><span data-stu-id="c537f-122">When running [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] in an Azure VM, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] can use keys stored in the [Azure Key Vault](https://go.microsoft.com/fwlink/?LinkId=521401).</span></span> <span data-ttu-id="c537f-123">詳細については、「 [Azure Key Vault を使用する拡張キー管理 &#40;SQL Server&#41;](extensible-key-management-using-azure-key-vault-sql-server.md)で処理できるようになります。</span><span class="sxs-lookup"><span data-stu-id="c537f-123">For more information, see [Extensible Key Management Using Azure Key Vault &#40;SQL Server&#41;](extensible-key-management-using-azure-key-vault-sql-server.md).</span></span>  
  
## <a name="ekm-configuration"></a><span data-ttu-id="c537f-124">EKM の構成</span><span class="sxs-lookup"><span data-stu-id="c537f-124">EKM Configuration</span></span>  
 <span data-ttu-id="c537f-125">拡張キー管理は [!INCLUDE[msCoName](../../../includes/msconame-md.md)][!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]のすべてのエディションでサポートされているわけではありません。</span><span class="sxs-lookup"><span data-stu-id="c537f-125">Extensible Key Management is not available in every edition of [!INCLUDE[msCoName](../../../includes/msconame-md.md)][!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="c537f-126">の各エディションでサポートされる機能の一覧につい [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] ては、「 [SQL Server 2014 の各エディションがサポートする機能](../../../getting-started/features-supported-by-the-editions-of-sql-server-2014.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c537f-126">For a list of features that are supported by the editions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], see [Features Supported by the Editions of SQL Server 2014](../../../getting-started/features-supported-by-the-editions-of-sql-server-2014.md).</span></span>  
  
 <span data-ttu-id="c537f-127">既定では、拡張キー管理は無効です。</span><span class="sxs-lookup"><span data-stu-id="c537f-127">By default, Extensible Key Management is off.</span></span> <span data-ttu-id="c537f-128">この機能を有効にするには、次のオプションと値を使用して sp_configure コマンドを実行します。</span><span class="sxs-lookup"><span data-stu-id="c537f-128">To enable this feature, use the sp_configure command that has the following option and value, as in the following example:</span></span>  
  
```  
sp_configure 'show advanced', 1  
GO  
RECONFIGURE  
GO  
sp_configure 'EKM provider enabled', 1  
GO  
RECONFIGURE  
GO  
```  
  
> [!NOTE]  
>  <span data-ttu-id="c537f-129">EKM をサポートしていないエディションの [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] でこのオプションを使用して sp_configure コマンドを実行すると、エラーが表示されます。</span><span class="sxs-lookup"><span data-stu-id="c537f-129">If you use the sp_configure command for this option on editions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] that do not support EKM, you will receive an error.</span></span>  
  
 <span data-ttu-id="c537f-130">この機能を無効にするには、値を **0** に設定します。</span><span class="sxs-lookup"><span data-stu-id="c537f-130">To disable the feature, set the value to **0**.</span></span> <span data-ttu-id="c537f-131">サーバー オプションの設定方法については、「[sp_configure &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-configure-transact-sql)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c537f-131">For more information about how to set server options, see [sp_configure &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-configure-transact-sql).</span></span>  
  
## <a name="how-to-use-ekm"></a><span data-ttu-id="c537f-132">EKM を使用する方法</span><span class="sxs-lookup"><span data-stu-id="c537f-132">How to Use EKM</span></span>  
 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="c537f-133">拡張キー管理を使用すると、データベース ファイルを保護する暗号化キーを外部デバイス (スマート カード、USB デバイス、EKM/HSM モジュールなど) に格納できます。</span><span class="sxs-lookup"><span data-stu-id="c537f-133">Extensible Key Management enables the encryption keys that protect the database files to be stored in an off-box device such as a smartcard, USB device, or EKM/HSM module.</span></span> <span data-ttu-id="c537f-134">これにより、データベース管理者 (sysadmin グループのメンバーを除く) からのデータの保護も実現され、</span><span class="sxs-lookup"><span data-stu-id="c537f-134">This also enables data protection from database administrators (except members of the sysadmin group).</span></span> <span data-ttu-id="c537f-135">そのデータベース ユーザー以外はアクセスできない外部 EKM/HSM モジュール上の暗号化キーを使用してデータを暗号化できます。</span><span class="sxs-lookup"><span data-stu-id="c537f-135">Data can be encrypted by using encryption keys that only the database user has access to on the external EKM/HSM module.</span></span>  
  
 <span data-ttu-id="c537f-136">拡張キー管理にはその他、次のような利点があります。</span><span class="sxs-lookup"><span data-stu-id="c537f-136">Extensible Key Management also provides the following benefits:</span></span>  
  
-   <span data-ttu-id="c537f-137">追加の承認チェック (職務の分離の実現)。</span><span class="sxs-lookup"><span data-stu-id="c537f-137">Additional authorization check (enabling separation of duties).</span></span>  
  
-   <span data-ttu-id="c537f-138">ハードウェア ベースの暗号化/暗号化解除のパフォーマンスの向上。</span><span class="sxs-lookup"><span data-stu-id="c537f-138">Higher performance for hardware-based encryption/decryption.</span></span>  
  
-   <span data-ttu-id="c537f-139">外部での暗号化キーの生成。</span><span class="sxs-lookup"><span data-stu-id="c537f-139">External encryption key generation.</span></span>  
  
-   <span data-ttu-id="c537f-140">外部での暗号化キーの格納 (データとキーの物理的な分離)。</span><span class="sxs-lookup"><span data-stu-id="c537f-140">External encryption key storage (physical separation of data and keys).</span></span>  
  
-   <span data-ttu-id="c537f-141">暗号化キーの取得。</span><span class="sxs-lookup"><span data-stu-id="c537f-141">Encryption key retrieval.</span></span>  
  
-   <span data-ttu-id="c537f-142">外部での暗号化キーの保持 (暗号化キーのローテーションの実現)。</span><span class="sxs-lookup"><span data-stu-id="c537f-142">External encryption key retention (enables encryption key rotation).</span></span>  
  
-   <span data-ttu-id="c537f-143">暗号化キーのより簡単な復元。</span><span class="sxs-lookup"><span data-stu-id="c537f-143">Easier encryption key recovery.</span></span>  
  
-   <span data-ttu-id="c537f-144">暗号化キーの管理可能な配布。</span><span class="sxs-lookup"><span data-stu-id="c537f-144">Manageable encryption key distribution.</span></span>  
  
-   <span data-ttu-id="c537f-145">暗号化キーの安全な破棄。</span><span class="sxs-lookup"><span data-stu-id="c537f-145">Secure encryption key disposal.</span></span>  
  
 <span data-ttu-id="c537f-146">拡張キー管理は、ユーザー名とパスワードの組み合わせに対して使用することも、EKM ドライバーで定義されたその他の方法に対して使用することもできます。</span><span class="sxs-lookup"><span data-stu-id="c537f-146">You can use Extensible Key Management for a username and password combination or other methods defined by the EKM driver.</span></span>  
  
> [!CAUTION]  
>  <span data-ttu-id="c537f-147">トラブルシューティングの際には、EKM プロバイダーから取得した暗号化キーを [!INCLUDE[msCoName](../../../includes/msconame-md.md)] テクニカル サポートに提供する必要性や、</span><span class="sxs-lookup"><span data-stu-id="c537f-147">For troubleshooting, [!INCLUDE[msCoName](../../../includes/msconame-md.md)] technical support might require the encryption key from the EKM provider.</span></span> <span data-ttu-id="c537f-148">問題を解決するためにベンダーのツールやプロセスにアクセスする必要性が生じる場合もあります。</span><span class="sxs-lookup"><span data-stu-id="c537f-148">You might also need to access vendor tools or processes to help resolve an issue.</span></span>  
  
### <a name="authentication-with-an-ekm-device"></a><span data-ttu-id="c537f-149">EKM デバイスによる認証</span><span class="sxs-lookup"><span data-stu-id="c537f-149">Authentication with an EKM Device</span></span>  
 <span data-ttu-id="c537f-150">EKM モジュールでは複数の種類の認証をサポートできますが、</span><span class="sxs-lookup"><span data-stu-id="c537f-150">An EKM module can support more than one type of authentication.</span></span> <span data-ttu-id="c537f-151">各プロバイダーが [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]に公開する認証の種類は 1 つだけです。したがって、モジュールで基本認証とその他の認証方法がサポートされている場合、公開されるのはいずれか一方だけで、両方は公開されません。</span><span class="sxs-lookup"><span data-stu-id="c537f-151">Each provider exposes only one type of authentication to [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], that is if the module supports Basic or Other authentication types, it exposes one or the other, but not both.</span></span>  
  
#### <a name="ekm-device-specific-basic-authentication-using-usernamepassword"></a><span data-ttu-id="c537f-152">ユーザー名/パスワードを使用する EKM デバイス固有の基本認証</span><span class="sxs-lookup"><span data-stu-id="c537f-152">EKM Device-Specific Basic Authentication Using username/password</span></span>  
 <span data-ttu-id="c537f-153">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] では、*ユーザー名/パスワード*のペアを使用する基本認証をサポートしている EKM モジュールで、資格情報による透過的な認証を利用できます。</span><span class="sxs-lookup"><span data-stu-id="c537f-153">For those EKM modules that support Basic authentication using a *username/password* pair, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] provides transparent authentication using credentials.</span></span> <span data-ttu-id="c537f-154">資格情報の詳細については、「[資格情報 &#40;データベース エンジン&#41;](../authentication-access/credentials-database-engine.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c537f-154">For more information about credentials, see [Credentials &#40;Database Engine&#41;](../authentication-access/credentials-database-engine.md).</span></span>  
  
 <span data-ttu-id="c537f-155">EKM プロバイダーに対して資格情報を作成し、それをログイン (Windows アカウントと [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] アカウントの両方) にマップすることにより、ログインごとに EKM モジュールにアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="c537f-155">A credential can be created for an EKM provider and mapped to a login (both Windows and [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] accounts) to access an EKM module on per-login basis.</span></span> <span data-ttu-id="c537f-156">資格情報の *[識別]* フィールドにユーザー名を含め、 *[シークレット]* フィールドに EKM モジュールに接続するためのパスワードを含めます。</span><span class="sxs-lookup"><span data-stu-id="c537f-156">The *Identify* field of the credential contains the username; the *secret* field contains a password to connect to an EKM module.</span></span>  
  
 <span data-ttu-id="c537f-157">ログインにマップされた EKM プロバイダーの資格情報がない場合は、 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] サービス アカウントにマップされた資格情報が使用されます。</span><span class="sxs-lookup"><span data-stu-id="c537f-157">If there is no login mapped credential for the EKM provider, the credential mapped to the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] service account is used.</span></span>  
  
 <span data-ttu-id="c537f-158">それぞれが異なる EKM プロバイダーに対して使用される資格情報であれば、1 つのログインに複数の資格情報をマップできます。</span><span class="sxs-lookup"><span data-stu-id="c537f-158">A login can have multiple credentials mapped to it, as long as they are used for distinctive EKM providers.</span></span> <span data-ttu-id="c537f-159">マップされた資格情報は、各ログインで各 EKM プロバイダーにつき 1 つだけ存在する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c537f-159">There must be only one mapped credential per EKM provider per login.</span></span> <span data-ttu-id="c537f-160">同じ資格情報を他のログインにマップすることはできます。</span><span class="sxs-lookup"><span data-stu-id="c537f-160">The same credential can be mapped to other logins.</span></span>  
  
#### <a name="other-types-of-ekm-device-specific-authentication"></a><span data-ttu-id="c537f-161">その他の種類の EKM デバイス固有の認証</span><span class="sxs-lookup"><span data-stu-id="c537f-161">Other Types of EKM Device-Specific Authentication</span></span>  
 <span data-ttu-id="c537f-162">Windows 認証や *ユーザー/パスワード* の組み合わせの認証以外を使用する EKM モジュールに対しては、 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]とは別に認証を行う必要があります。</span><span class="sxs-lookup"><span data-stu-id="c537f-162">For EKM modules that have authentication other than Windows or *user/password* combinations, authentication must be performed independently from [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span>  
  
### <a name="encryption-and-decryption-by-an-ekm-device"></a><span data-ttu-id="c537f-163">EKM デバイスによる暗号化および暗号化解除</span><span class="sxs-lookup"><span data-stu-id="c537f-163">Encryption and Decryption by an EKM Device</span></span>  
 <span data-ttu-id="c537f-164">対称キーと非対称キーを使用してデータを暗号化および暗号化解除するには、以下の関数と機能を使用できます。</span><span class="sxs-lookup"><span data-stu-id="c537f-164">You can use the following functions and features to encrypt and decrypt data by using symmetric and asymmetric keys:</span></span>  
  
|<span data-ttu-id="c537f-165">関数または機能</span><span class="sxs-lookup"><span data-stu-id="c537f-165">Function or feature</span></span>|<span data-ttu-id="c537f-166">リファレンス</span><span class="sxs-lookup"><span data-stu-id="c537f-166">Reference</span></span>|  
|-------------------------|---------------|  
|<span data-ttu-id="c537f-167">対称キー暗号化</span><span class="sxs-lookup"><span data-stu-id="c537f-167">Symmetric key encryption</span></span>|[<span data-ttu-id="c537f-168">CREATE SYMMETRIC KEY &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="c537f-168">CREATE SYMMETRIC KEY &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/create-symmetric-key-transact-sql)|  
|<span data-ttu-id="c537f-169">非対称キー暗号化</span><span class="sxs-lookup"><span data-stu-id="c537f-169">Asymmetric Key encryption</span></span>|[<span data-ttu-id="c537f-170">CREATE ASYMMETRIC KEY &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="c537f-170">CREATE ASYMMETRIC KEY &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/create-asymmetric-key-transact-sql)|  
|<span data-ttu-id="c537f-171">EncryptByKey(key_guid, 'cleartext', ...)</span><span class="sxs-lookup"><span data-stu-id="c537f-171">EncryptByKey(key_guid, 'cleartext', ...)</span></span>|[<span data-ttu-id="c537f-172">ENCRYPTBYKEY &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="c537f-172">ENCRYPTBYKEY &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/functions/encryptbykey-transact-sql)|  
|<span data-ttu-id="c537f-173">DecryptByKey(ciphertext, ...)</span><span class="sxs-lookup"><span data-stu-id="c537f-173">DecryptByKey(ciphertext, ...)</span></span>|[<span data-ttu-id="c537f-174">DECRYPTBYKEY &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="c537f-174">DECRYPTBYKEY &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/functions/decryptbykey-transact-sql)|  
|<span data-ttu-id="c537f-175">EncryptByAsmKey(key_guid, 'cleartext')</span><span class="sxs-lookup"><span data-stu-id="c537f-175">EncryptByAsmKey(key_guid, 'cleartext')</span></span>|[<span data-ttu-id="c537f-176">ENCRYPTBYASYMKEY &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="c537f-176">ENCRYPTBYASYMKEY &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/functions/encryptbyasymkey-transact-sql)|  
|<span data-ttu-id="c537f-177">DecryptByAsmKey(ciphertext)</span><span class="sxs-lookup"><span data-stu-id="c537f-177">DecryptByAsmKey(ciphertext)</span></span>|[<span data-ttu-id="c537f-178">DECRYPTBYASYMKEY &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="c537f-178">DECRYPTBYASYMKEY &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/functions/decryptbyasymkey-transact-sql)|  
  
#### <a name="database-keys-encryption-by-ekm-keys"></a><span data-ttu-id="c537f-179">EKM キーによるデータベース キーの暗号化</span><span class="sxs-lookup"><span data-stu-id="c537f-179">Database Keys Encryption by EKM Keys</span></span>  
 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="c537f-180">では、EKM キーを使用してデータベースのその他のキーを暗号化できます。</span><span class="sxs-lookup"><span data-stu-id="c537f-180">can use EKM keys to encrypt other keys in a database.</span></span> <span data-ttu-id="c537f-181">EKM デバイスで対称キーと非対称キーの両方を作成および使用できます。</span><span class="sxs-lookup"><span data-stu-id="c537f-181">You can create and use both symmetric and asymmetric keys on an EKM device.</span></span> <span data-ttu-id="c537f-182">EKM 非対称キーを使用してネイティブ (EKM 以外) の対称キーを暗号化することができます。</span><span class="sxs-lookup"><span data-stu-id="c537f-182">You can encrypt native (non-EKM) symmetric keys with EKM asymmetric keys.</span></span>  
  
 <span data-ttu-id="c537f-183">次の例では、データベースの対称キーを作成し、それを EKM モジュールのキーを使用して暗号化しています。</span><span class="sxs-lookup"><span data-stu-id="c537f-183">The following example creates a database symmetric key and encrypts it using a key on an EKM module.</span></span>  
  
```  
CREATE SYMMETRIC KEY Key1  
WITH ALGORITHM = AES_256  
ENCRYPTION BY EKM_AKey1;  
GO  
--Open database key  
OPEN SYMMETRIC KEY Key1  
DECRYPTION BY EKM_AKey1  
```  
  
 <span data-ttu-id="c537f-184">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] のデータベースとサーバー キーの詳細については、「[SQL Server とデータベースの暗号化キー &#40;データベース エンジン&#41;](sql-server-and-database-encryption-keys-database-engine.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c537f-184">For more information about Database and Server Keys in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], see [SQL Server and Database Encryption Keys &#40;Database Engine&#41;](sql-server-and-database-encryption-keys-database-engine.md).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="c537f-185">別の EKM キーを使用して EKM キーを暗号化することはできません。</span><span class="sxs-lookup"><span data-stu-id="c537f-185">You cannot encrypt one EKM key with another EKM key.</span></span>  
>   
>  [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="c537f-186">では、EKM プロバイダーから生成された非対称キーを使用してモジュールに署名することをサポートしていません。</span><span class="sxs-lookup"><span data-stu-id="c537f-186">does not support signing modules with asymmetric keys generated from EKM provider.</span></span>  
  
## <a name="related-tasks"></a><span data-ttu-id="c537f-187">Related Tasks</span><span class="sxs-lookup"><span data-stu-id="c537f-187">Related Tasks</span></span>  
 [<span data-ttu-id="c537f-188">EKM provider enabled サーバー構成オプション</span><span class="sxs-lookup"><span data-stu-id="c537f-188">EKM provider enabled Server Configuration Option</span></span>](../../../database-engine/configure-windows/ekm-provider-enabled-server-configuration-option.md)  
  
 [<span data-ttu-id="c537f-189">EKM を使用して TDE を有効にする</span><span class="sxs-lookup"><span data-stu-id="c537f-189">Enable TDE Using EKM</span></span>](enable-tde-on-sql-server-using-ekm.md)  
  
 [<span data-ttu-id="c537f-190">Azure Key Vault を使用する拡張キー管理 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="c537f-190">Extensible Key Management Using Azure Key Vault &#40;SQL Server&#41;</span></span>](extensible-key-management-using-azure-key-vault-sql-server.md)  
  
## <a name="see-also"></a><span data-ttu-id="c537f-191">参照</span><span class="sxs-lookup"><span data-stu-id="c537f-191">See Also</span></span>  
 <span data-ttu-id="c537f-192">[CREATE CRYPTOGRAPHIC PROVIDER &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-cryptographic-provider-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="c537f-192">[CREATE CRYPTOGRAPHIC PROVIDER &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-cryptographic-provider-transact-sql) </span></span>  
 <span data-ttu-id="c537f-193">[DROP CRYPTOGRAPHIC PROVIDER &#40;Transact-SQL&#41;](/sql/t-sql/statements/drop-cryptographic-provider-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="c537f-193">[DROP CRYPTOGRAPHIC PROVIDER &#40;Transact-SQL&#41;](/sql/t-sql/statements/drop-cryptographic-provider-transact-sql) </span></span>  
 <span data-ttu-id="c537f-194">[ALTER CRYPTOGRAPHIC PROVIDER &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-cryptographic-provider-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="c537f-194">[ALTER CRYPTOGRAPHIC PROVIDER &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-cryptographic-provider-transact-sql) </span></span>  
 <span data-ttu-id="c537f-195">[sys.cryptographic_providers &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-cryptographic-providers-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="c537f-195">[sys.cryptographic_providers &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-cryptographic-providers-transact-sql) </span></span>  
 <span data-ttu-id="c537f-196">[sys.dm_cryptographic_provider_sessions &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-cryptographic-provider-sessions-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="c537f-196">[sys.dm_cryptographic_provider_sessions &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-cryptographic-provider-sessions-transact-sql) </span></span>  
 <span data-ttu-id="c537f-197">[sys.dm_cryptographic_provider_properties &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-cryptographic-provider-properties-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="c537f-197">[sys.dm_cryptographic_provider_properties &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-cryptographic-provider-properties-transact-sql) </span></span>  
 <span data-ttu-id="c537f-198">[sys.dm_cryptographic_provider_algorithms &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-cryptographic-provider-algorithms-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="c537f-198">[sys.dm_cryptographic_provider_algorithms &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-cryptographic-provider-algorithms-transact-sql) </span></span>  
 <span data-ttu-id="c537f-199">[sys.dm_cryptographic_provider_keys &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-cryptographic-provider-keys-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="c537f-199">[sys.dm_cryptographic_provider_keys &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-cryptographic-provider-keys-transact-sql) </span></span>  
 <span data-ttu-id="c537f-200">[sys.credentials &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-credentials-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="c537f-200">[sys.credentials &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-credentials-transact-sql) </span></span>  
 <span data-ttu-id="c537f-201">[CREATE CREDENTIAL &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-credential-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="c537f-201">[CREATE CREDENTIAL &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-credential-transact-sql) </span></span>  
 <span data-ttu-id="c537f-202">[ALTER LOGIN &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-login-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="c537f-202">[ALTER LOGIN &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-login-transact-sql) </span></span>  
 <span data-ttu-id="c537f-203">[CREATE ASYMMETRIC KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-asymmetric-key-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="c537f-203">[CREATE ASYMMETRIC KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-asymmetric-key-transact-sql) </span></span>  
 <span data-ttu-id="c537f-204">[ALTER ASYMMETRIC KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-asymmetric-key-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="c537f-204">[ALTER ASYMMETRIC KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-asymmetric-key-transact-sql) </span></span>  
 <span data-ttu-id="c537f-205">[DROP ASYMMETRIC KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/drop-asymmetric-key-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="c537f-205">[DROP ASYMMETRIC KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/drop-asymmetric-key-transact-sql) </span></span>  
 <span data-ttu-id="c537f-206">[CREATE SYMMETRIC KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-symmetric-key-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="c537f-206">[CREATE SYMMETRIC KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-symmetric-key-transact-sql) </span></span>  
 <span data-ttu-id="c537f-207">[ALTER SYMMETRIC KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-symmetric-key-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="c537f-207">[ALTER SYMMETRIC KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-symmetric-key-transact-sql) </span></span>  
 <span data-ttu-id="c537f-208">[DROP SYMMETRIC KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/drop-symmetric-key-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="c537f-208">[DROP SYMMETRIC KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/drop-symmetric-key-transact-sql) </span></span>  
 <span data-ttu-id="c537f-209">[OPEN SYMMETRIC KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/open-symmetric-key-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="c537f-209">[OPEN SYMMETRIC KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/open-symmetric-key-transact-sql) </span></span>  
 <span data-ttu-id="c537f-210">[Reporting Services の暗号化キーのバックアップと復元](../../../reporting-services/install-windows/ssrs-encryption-keys-back-up-and-restore-encryption-keys.md) </span><span class="sxs-lookup"><span data-stu-id="c537f-210">[Back Up and Restore Reporting Services Encryption Keys](../../../reporting-services/install-windows/ssrs-encryption-keys-back-up-and-restore-encryption-keys.md) </span></span>  
 <span data-ttu-id="c537f-211">[暗号化キーの削除と再作成  &#40;SSRS 構成マネージャー&#41;](../../../reporting-services/install-windows/ssrs-encryption-keys-delete-and-re-create-encryption-keys.md) </span><span class="sxs-lookup"><span data-stu-id="c537f-211">[Delete and Re-create Encryption Keys  &#40;SSRS Configuration Manager&#41;](../../../reporting-services/install-windows/ssrs-encryption-keys-delete-and-re-create-encryption-keys.md) </span></span>  
 <span data-ttu-id="c537f-212">[スケールアウト配置に関する暗号化キーの追加と削除 &#40;SSRS 構成マネージャー&#41;](../../../reporting-services/install-windows/add-and-remove-encryption-keys-for-scale-out-deployment.md) </span><span class="sxs-lookup"><span data-stu-id="c537f-212">[Add and Remove Encryption Keys for Scale-Out Deployment &#40;SSRS Configuration Manager&#41;](../../../reporting-services/install-windows/add-and-remove-encryption-keys-for-scale-out-deployment.md) </span></span>  
 <span data-ttu-id="c537f-213">[サービス マスター キーのバックアップ](service-master-key.md) </span><span class="sxs-lookup"><span data-stu-id="c537f-213">[Back Up the Service Master Key](service-master-key.md) </span></span>  
 <span data-ttu-id="c537f-214">[サービス マスター キーの復元](restore-the-service-master-key.md) </span><span class="sxs-lookup"><span data-stu-id="c537f-214">[Restore the Service Master Key](restore-the-service-master-key.md) </span></span>  
 <span data-ttu-id="c537f-215">[データベース マスター キーの作成](create-a-database-master-key.md) </span><span class="sxs-lookup"><span data-stu-id="c537f-215">[Create a Database Master Key](create-a-database-master-key.md) </span></span>  
 <span data-ttu-id="c537f-216">[データベース マスター キーのバックアップ](back-up-a-database-master-key.md) </span><span class="sxs-lookup"><span data-stu-id="c537f-216">[Back Up a Database Master Key](back-up-a-database-master-key.md) </span></span>  
 <span data-ttu-id="c537f-217">[データベース マスター キーの復元](restore-a-database-master-key.md) </span><span class="sxs-lookup"><span data-stu-id="c537f-217">[Restore a Database Master Key](restore-a-database-master-key.md) </span></span>  
 [<span data-ttu-id="c537f-218">2 台のサーバーでの同じ対称キーの作成</span><span class="sxs-lookup"><span data-stu-id="c537f-218">Create Identical Symmetric Keys on Two Servers</span></span>](create-identical-symmetric-keys-on-two-servers.md)  
  
  
