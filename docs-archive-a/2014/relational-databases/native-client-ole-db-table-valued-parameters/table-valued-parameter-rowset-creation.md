---
title: テーブル値パラメーターの行セットの作成 | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- table-valued parameters, rowset creation
ms.assetid: ffe213ca-cc0e-465e-b31c-a8272324c4fe
author: rothja
ms.author: jroth
ms.openlocfilehash: a22ccbd583d95c41daa0a113363985828cf1e9d6
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87634480"
---
# <a name="table-valued-parameter-rowset-creation"></a><span data-ttu-id="d9f13-102">テーブル値パラメーターの行セットの作成</span><span class="sxs-lookup"><span data-stu-id="d9f13-102">Table-Valued Parameter Rowset Creation</span></span>
  <span data-ttu-id="d9f13-103">コンシューマーはテーブル値パラメーターに任意の行セット オブジェクトを使用できますが、通常の行セット オブジェクトはバックエンドのデータ ストアに対して実装されるため、パフォーマンスが制限されます。</span><span class="sxs-lookup"><span data-stu-id="d9f13-103">Although consumers can provide any rowset object for table-valued parameters, typical rowset objects are implemented against back-end data stores, and therefore provide limited performance.</span></span> <span data-ttu-id="d9f13-104">このため、[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB プロバイダーでは、コンシューマーがメモリ内データの上位に特殊な行セット オブジェクトを作成できます。</span><span class="sxs-lookup"><span data-stu-id="d9f13-104">For this reason, the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB Provider enables consumers to create a specialized rowset object on top of in-memory data.</span></span> <span data-ttu-id="d9f13-105">この特別なメモリ内の行セットオブジェクトは、テーブル値パラメーターの行セットと呼ばれる新しい COM オブジェクトです。</span><span class="sxs-lookup"><span data-stu-id="d9f13-105">This special, in-memory rowset object is a new COM object called a table-valued parameter rowset .</span></span> <span data-ttu-id="d9f13-106">このオブジェクトには、パラメーター セットと同様の機能が用意されています。</span><span class="sxs-lookup"><span data-stu-id="d9f13-106">It provides functionality similar to parameter sets.</span></span>  
  
 <span data-ttu-id="d9f13-107">テーブル値パラメーターの行セット オブジェクトは、コンシューマーが、複数のセッション レベルのインターフェイスを使用して、入力パラメーターに対して明示的に作成します。</span><span class="sxs-lookup"><span data-stu-id="d9f13-107">Table-valued parameter rowset objects are created explicitly by the consumer for input parameters through multiple session-level interfaces.</span></span> <span data-ttu-id="d9f13-108">テーブル値パラメーターの行セット オブジェクトは、テーブル値パラメーターごとに 1 つのインスタンスがあります。</span><span class="sxs-lookup"><span data-stu-id="d9f13-108">There is one instance of a table-valued parameter rowset object per table-valued parameter.</span></span> <span data-ttu-id="d9f13-109">コンシューマーは、既知のメタデータ情報を指定するか (静的なシナリオ)、プロバイダー インターフェイスを使用してメタデータ情報を検出する (動的なシナリオ) ことにより、テーブル値パラメーターの行セット オブジェクトを作成できます。</span><span class="sxs-lookup"><span data-stu-id="d9f13-109">The consumer can create the table-valued parameter rowset objects either by providing metadata information that is already known (static scenario), or by discovering it through provider interfaces (dynamic scenario).</span></span> <span data-ttu-id="d9f13-110">この後の各セクションで、これらの 2 つのシナリオについて説明します。</span><span class="sxs-lookup"><span data-stu-id="d9f13-110">The following sections describe these two scenarios.</span></span>  
  
## <a name="static-scenario"></a><span data-ttu-id="d9f13-111">静的なシナリオ</span><span class="sxs-lookup"><span data-stu-id="d9f13-111">Static Scenario</span></span>  
 <span data-ttu-id="d9f13-112">型情報がわかっている場合、コンシューマーは ITableDefinitionWithConstraints::CreateTableWithConstraints を使用し、テーブル値パラメーターに対応するテーブル値パラメーターの行セット オブジェクトのインスタンスを作成します。</span><span class="sxs-lookup"><span data-stu-id="d9f13-112">When the type information is known, the consumer uses ITableDefinitionWithConstraints::CreateTableWithConstraints to instantiate a table-valued parameter rowset object that corresponds to a table-valued parameter.</span></span>  
  
 <span data-ttu-id="d9f13-113">*guid* フィールド (*pTableID* パラメーター) には、特殊な GUID (CLSID_ROWSET_TVP) を含めます。</span><span class="sxs-lookup"><span data-stu-id="d9f13-113">The *guid* field (*pTableID* parameter) contains the special GUID (CLSID_ROWSET_TVP).</span></span> <span data-ttu-id="d9f13-114">*pwszName* メンバーには、コンシューマーがインスタンスを作成するテーブル値パラメーターの型の名前を含めます。</span><span class="sxs-lookup"><span data-stu-id="d9f13-114">The *pwszName* member contains the name of the table-valued parameter type that the consumer wants to instantiate.</span></span> <span data-ttu-id="d9f13-115">*eKind* フィールドは、DBKIND_GUID_NAME に設定されます。</span><span class="sxs-lookup"><span data-stu-id="d9f13-115">The *eKind* field will be set to DBKIND_GUID_NAME.</span></span> <span data-ttu-id="d9f13-116">この名前は、ステートメントがアドホック SQL の場合に必要です。プロシージャ呼び出しの場合、名前は省略可能です。</span><span class="sxs-lookup"><span data-stu-id="d9f13-116">This name is required when the statement is ad hoc SQL; the name is optional if it is a procedure call.</span></span>  
  
 <span data-ttu-id="d9f13-117">コンシューマーは集計の場合、制御している IUnknown と共に *pUnkOuter* パラメーターを渡します。</span><span class="sxs-lookup"><span data-stu-id="d9f13-117">For aggregation, the consumer passes the *pUnkOuter* parameter with the controlling IUnknown.</span></span>  
  
 <span data-ttu-id="d9f13-118">テーブル値パラメーターの行セットオブジェクトのプロパティは読み取り専用であるため、コンシューマーは*rgPropertySets*のプロパティを設定する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="d9f13-118">The table-valued parameter rowset object properties are read only, so the consumer is not expected to set any properties in *rgPropertySets*.</span></span>  
  
 <span data-ttu-id="d9f13-119">各 DBCOLUMNDESC 構造体の *rgPropertySets* メンバーの場合、コンシューマーは列ごとに追加のプロパティを指定できます。</span><span class="sxs-lookup"><span data-stu-id="d9f13-119">For the *rgPropertySets* member of each DBCOLUMNDESC structure, the consumer can specify additional properties for each column.</span></span> <span data-ttu-id="d9f13-120">これらのプロパティは、DBPROPSET_SQLSERVERCOLUMN プロパティ セットに属しています。</span><span class="sxs-lookup"><span data-stu-id="d9f13-120">These properties belong to the DBPROPSET_SQLSERVERCOLUMN property set.</span></span> <span data-ttu-id="d9f13-121">これらのプロパティによって、列ごとに計算の設定と既定の設定を指定できます。</span><span class="sxs-lookup"><span data-stu-id="d9f13-121">They enable you to specify computed and default settings for each column.</span></span> <span data-ttu-id="d9f13-122">また、NULL 値の許容や ID など、列の既存のプロパティもサポートされます。</span><span class="sxs-lookup"><span data-stu-id="d9f13-122">They also support existing column properties, such as nullability and identity.</span></span>  
  
 <span data-ttu-id="d9f13-123">コンシューマーでは、テーブル値パラメーターの行セット オブジェクトから対応する情報を取得するために、IRowsetInfo::GetProperties を使用します。</span><span class="sxs-lookup"><span data-stu-id="d9f13-123">To retrieve corresponding information from a table-valued parameter rowset object, the consumer uses IRowsetInfo::GetProperties.</span></span>  
  
 <span data-ttu-id="d9f13-124">各列の null、一意、計算、および更新の各状態に関する情報を取得するには、コンシューマーが IColumnsRowset:: GetColumnsRowset または IColumnsInfo:: GetColumnInfo を使用します。</span><span class="sxs-lookup"><span data-stu-id="d9f13-124">To retrieve information about the null, unique, computed, and update status of each column, the consumer use IColumnsRowset::GetColumnsRowset or IColumnsInfo::GetColumnInfo.</span></span> <span data-ttu-id="d9f13-125">これらのメソッドでは、各テーブル値パラメーターの行セットの列に関する詳細情報が取得できます。</span><span class="sxs-lookup"><span data-stu-id="d9f13-125">These methods provide detailed information about each table-valued parameter rowset column.</span></span>  
  
 <span data-ttu-id="d9f13-126">コンシューマーは、テーブル値パラメーターの列ごとに型を指定します。</span><span class="sxs-lookup"><span data-stu-id="d9f13-126">The consumer specifies the type of each column of the table-valued parameter.</span></span> <span data-ttu-id="d9f13-127">この方法は、[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] でテーブルを作成する際に列を指定する方法と似ています。</span><span class="sxs-lookup"><span data-stu-id="d9f13-127">This is similar to how columns are specified when a table is created in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="d9f13-128">コンシューマーは、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] *ppRowset* output パラメーターを使用して、Native Client OLE DB プロバイダーからテーブル値パラメーターの行セットオブジェクトを取得します。</span><span class="sxs-lookup"><span data-stu-id="d9f13-128">The consumer obtains a table-valued parameter rowset object from the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB Provider through the *ppRowset* output parameter.</span></span>  
  
## <a name="dynamic-scenario"></a><span data-ttu-id="d9f13-129">動的なシナリオ</span><span class="sxs-lookup"><span data-stu-id="d9f13-129">Dynamic Scenario</span></span>  
 <span data-ttu-id="d9f13-130">コンシューマーが型情報を持っていない場合は、IOpenRowset:: OpenRowset を使用してテーブル値パラメーターの行セットオブジェクトをインスタンス化する必要があります。</span><span class="sxs-lookup"><span data-stu-id="d9f13-130">When the consumer does not have type information, it should use IOpenRowset::OpenRowset to instantiate table-valued parameter rowset objects.</span></span> <span data-ttu-id="d9f13-131">すべてのコンシューマーは、プロバイダーに型名を知らせる必要があります。</span><span class="sxs-lookup"><span data-stu-id="d9f13-131">All the consumer has to provide to the provider is the type name.</span></span>  
  
 <span data-ttu-id="d9f13-132">このシナリオでは、プロバイダーがコンシューマーに代わって、テーブル値パラメーターの行セット オブジェクトに関する型情報をサーバーから取得します。</span><span class="sxs-lookup"><span data-stu-id="d9f13-132">In this scenario, the provider obtains type information about a table-valued parameter rowset object from the server on behalf of the consumer.</span></span>  
  
 <span data-ttu-id="d9f13-133">*pTableID* パラメーターおよび *pUnkOuter* パラメーターは、静的なシナリオと同様に設定します。</span><span class="sxs-lookup"><span data-stu-id="d9f13-133">The *pTableID* and *pUnkOuter* parameters should be set as in the static scenario.</span></span> <span data-ttu-id="d9f13-134">次に、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB プロバイダーは、サーバーから型情報 (列の情報と制約) を取得し、 *ppRowset*パラメーターを使用してテーブル値パラメーターの行セットオブジェクトを返します。</span><span class="sxs-lookup"><span data-stu-id="d9f13-134">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB Provider then obtains the type information (column information and constraints) from the server, and return a table-valued parameter rowset object through the *ppRowset* parameter.</span></span> <span data-ttu-id="d9f13-135">この操作にはサーバーとの通信が必要になるため、静的なシナリオよりもパフォーマンスが低くなります。</span><span class="sxs-lookup"><span data-stu-id="d9f13-135">This operation requires communication with the server, and therefore does not perform as well as the static scenario.</span></span> <span data-ttu-id="d9f13-136">動的なシナリオは、パラメーター化されたプロシージャ呼び出しでのみ動作します。</span><span class="sxs-lookup"><span data-stu-id="d9f13-136">The dynamic scenario works only with parameterized procedure calls.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="d9f13-137">参照</span><span class="sxs-lookup"><span data-stu-id="d9f13-137">See Also</span></span>  
 <span data-ttu-id="d9f13-138">[テーブル値パラメーター &#40;OLE DB&#41;](table-valued-parameters-ole-db.md) </span><span class="sxs-lookup"><span data-stu-id="d9f13-138">[Table-Valued Parameters &#40;OLE DB&#41;](table-valued-parameters-ole-db.md) </span></span>  
 [<span data-ttu-id="d9f13-139">テーブル値パラメーターの使用 &#40;OLE DB&#41;</span><span class="sxs-lookup"><span data-stu-id="d9f13-139">Use Table-Valued Parameters &#40;OLE DB&#41;</span></span>](../native-client-ole-db-how-to/use-table-valued-parameters-ole-db.md)  
  
  
