---
title: 行フィルターを使用した動的なセキュリティの実装 |Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: analysis-services
ms.topic: conceptual
ms.assetid: 8bf03c45-caf5-4eda-9314-e4f8f24a159f
author: minewiskan
ms.author: owend
manager: kfile
ms.openlocfilehash: 09a15f818f57d7a9d808c89ced41b285536a7883
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87632230"
---
# <a name="implement-dynamic-security-by-using-row-filters"></a><span data-ttu-id="74db7-102">行フィルターを使用した動的なセキュリティの実装</span><span class="sxs-lookup"><span data-stu-id="74db7-102">Implement Dynamic Security by Using Row Filters</span></span>
  <span data-ttu-id="74db7-103">この補足のレッスンでは、動的なセキュリティを実装する追加のロールを作成します。</span><span class="sxs-lookup"><span data-stu-id="74db7-103">In this supplemental lesson, you will create an additional role that implements dynamic security.</span></span> <span data-ttu-id="74db7-104">動的なセキュリティは、現在ログオンしているユーザーのユーザー名またはログイン ID に基づく行レベルのセキュリティを提供します。</span><span class="sxs-lookup"><span data-stu-id="74db7-104">Dynamic security provides row-level security based on the user name or login id of the user currently logged on.</span></span> <span data-ttu-id="74db7-105">詳細については、「[ロール (SSAS テーブル)](https://docs.microsoft.com/analysis-services/tabular-models/roles-ssas-tabular)」 を参照してください。</span><span class="sxs-lookup"><span data-stu-id="74db7-105">To learn more, see [Roles &#40;SSAS Tabular&#41;](https://docs.microsoft.com/analysis-services/tabular-models/roles-ssas-tabular).</span></span>  
  
 <span data-ttu-id="74db7-106">動的なセキュリティを実装するには、データ ソースとしてのモデルへの接続を作成し、モデル オブジェクトとデータを参照できるユーザーの Windows ユーザー名を含むテーブルを、モデルに追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="74db7-106">To implement dynamic security, you must add a table to your model containing the Windows user names of those users that can create a connection to the model as a data source and browse model objects and data.</span></span> <span data-ttu-id="74db7-107">このチュートリアルで作成するモデルは Adventure Works Corp. のコンテキスト内にありますが、このレッスンを完了するには、自分のドメインのユーザーが含まれているテーブルを追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="74db7-107">The model you create using this tutorial is in the context of Adventure Works Corp.; however, in order to complete this lesson, you must add a table containing users from your own domain.</span></span> <span data-ttu-id="74db7-108">追加するユーザー名のパスワードは必要ありません。</span><span class="sxs-lookup"><span data-stu-id="74db7-108">You will not need the passwords for the user names that will be added.</span></span> <span data-ttu-id="74db7-109">自分のドメインの小人数のサンプル ユーザーを使用して Employee Security テーブルを作成するには、貼り付け機能を使用して、Excel スプレッドシートから従業員データを貼り付けます。</span><span class="sxs-lookup"><span data-stu-id="74db7-109">To create an Employee Security table, with a small sample of users from your own domain, you will use the Paste feature, pasting employee data from an Excel spreadsheet.</span></span> <span data-ttu-id="74db7-110">実際のシナリオでは、モデルに追加するユーザー名が含まれたテーブルは通常、実際のデータベースのテーブル (たとえば、実際の dimEmployee テーブルなど) をデータ ソースとして使用します。</span><span class="sxs-lookup"><span data-stu-id="74db7-110">In a real-world scenario, the table containing user names you add to a model would typically use a table from an actual database as a data source; for example, a real dimEmployee table.</span></span>  
  
 <span data-ttu-id="74db7-111">動的なセキュリティを実装するには、2つの新しい DAX 関数を使用します。[ユーザー名関数 &#40;dax&#41;](/dax/username-function-dax)と[lookupvalue 関数 &#40;dax&#41;](/dax/lookupvalue-function-dax)です。</span><span class="sxs-lookup"><span data-stu-id="74db7-111">In order to implement dynamic security, you will use two new DAX functions: [USERNAME Function &#40;DAX&#41;](/dax/username-function-dax) and [LOOKUPVALUE Function &#40;DAX&#41;](/dax/lookupvalue-function-dax).</span></span> <span data-ttu-id="74db7-112">行フィルター式に適用されるこれらの関数は、新しいロールで定義されています。</span><span class="sxs-lookup"><span data-stu-id="74db7-112">These functions, applied in a row filter formula, are defined in a new role.</span></span> <span data-ttu-id="74db7-113">数式では LOOKUPVALUE 関数を使用して Employee Security テーブルの値を指定し、その値を USERNAME 関数に渡します。この関数は、ログオンしているユーザーのユーザー名がこのロールに属することを指定します。</span><span class="sxs-lookup"><span data-stu-id="74db7-113">Using the LOOKUPVALUE function, the formula specifies a value from the Employee Security table and then passes that value to the USERNAME function, which specifies the user name of the user logged on belongs to this role.</span></span> <span data-ttu-id="74db7-114">ユーザーは、ロールの行フィルターによって指定されたデータのみを参照できます。</span><span class="sxs-lookup"><span data-stu-id="74db7-114">The user can then browse only data specified by the role's row filters.</span></span> <span data-ttu-id="74db7-115">このシナリオでは、販売担当者がインターネット上で自分の販売区域の売上データのみを参照できるように指定します。</span><span class="sxs-lookup"><span data-stu-id="74db7-115">In this scenario, you will specify that sales employees can only browse internet sales data for the sales territories in which they are a member.</span></span>  
  
 <span data-ttu-id="74db7-116">この補足のレッスンを完了するには、一連の作業を行います。</span><span class="sxs-lookup"><span data-stu-id="74db7-116">In order to complete this supplemental lesson, you will complete a series of tasks.</span></span> <span data-ttu-id="74db7-117">この Adventure Works 表形式モデルのシナリオに固有の作業で、実際のシナリオに必ずしも適用されないものは、そのように記載されています。</span><span class="sxs-lookup"><span data-stu-id="74db7-117">Those tasks that are unique to this Adventure Works tabular model scenario, but would not necessarily apply to a real-world scenario are identified as such.</span></span> <span data-ttu-id="74db7-118">各作業には、作業の目的を説明する追加情報が含まれています。</span><span class="sxs-lookup"><span data-stu-id="74db7-118">Each task includes additional information describing the purpose of the task.</span></span>  
  
 <span data-ttu-id="74db7-119">このレッスンの推定所要時間: **30 分**</span><span class="sxs-lookup"><span data-stu-id="74db7-119">Estimated time to complete this lesson: **30 minutes**</span></span>  
  
## <a name="prerequisites"></a><span data-ttu-id="74db7-120">前提条件</span><span class="sxs-lookup"><span data-stu-id="74db7-120">Prerequisites</span></span>  
 <span data-ttu-id="74db7-121">この補足のレッスンのトピックは表形式モデルのチュートリアルの一部であり、順番に従って実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="74db7-121">This supplemental lesson topic is part of a tabular modeling tutorial, which should be completed in order.</span></span> <span data-ttu-id="74db7-122">この補足のレッスンの作業を実行する前に、前のレッスンをすべて完了している必要があります。</span><span class="sxs-lookup"><span data-stu-id="74db7-122">Before performing the tasks in this supplemental lesson, you should have completed all previous lessons.</span></span>  
  
## <a name="add-the-dimsalesterritory-table-to-the-aw-internet-sales-tabular-model-project"></a><span data-ttu-id="74db7-123">AW Internet Sales Tabular Model プロジェクトへの dimSalesTerritory テーブルの追加</span><span class="sxs-lookup"><span data-stu-id="74db7-123">Add the dimSalesTerritory table to the AW Internet Sales Tabular Model Project</span></span>  
 <span data-ttu-id="74db7-124">この Adventure Works のシナリオの動的セキュリティを実装するには、2 つの追加テーブルをモデルに追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="74db7-124">In order to implement dynamic security for this Adventure Works scenario, you must add two additional tables to your model.</span></span> <span data-ttu-id="74db7-125">最初に追加するテーブルは、同じ AdventureWorksDW データベースの (販売区域としての) dimSalesTerritory です。</span><span class="sxs-lookup"><span data-stu-id="74db7-125">The first table you will add is dimSalesTerritory (as Sales Territory) from the same AdventureWorksDW database.</span></span> <span data-ttu-id="74db7-126">後から、ログオンしているユーザーが参照できる特定のデータを定義する行フィルターを Sales Territory テーブルに適用します。</span><span class="sxs-lookup"><span data-stu-id="74db7-126">You will later apply a row filter to the Sales Territory table that defines the particular data the logged on user can browse.</span></span>  
  
#### <a name="to-add-the-dimsalesterritory-table"></a><span data-ttu-id="74db7-127">dimSalesTerritory テーブルを追加するには</span><span class="sxs-lookup"><span data-stu-id="74db7-127">To add the dimSalesTerritory table</span></span>  
  
1.  <span data-ttu-id="74db7-128">[!INCLUDE[ssBIDevStudio](../includes/ssbidevstudio-md.md)]で **[モデル]** メニューをクリックし、 **[既存の接続]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="74db7-128">In [!INCLUDE[ssBIDevStudio](../includes/ssbidevstudio-md.md)], click on the **Model** menu, and then click **Existing Connections**.</span></span>  
  
2.  <span data-ttu-id="74db7-129">**[既存の接続]** ダイアログ ボックスで **[Adventure Works DB from SQL]** データ ソース接続が選択されていることを確認し、 **[開く]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="74db7-129">In the **Existing Connections** dialog box, verify the **Adventure Works DB from SQL** data source connection is selected, and then click **Open**.</span></span>  
  
     <span data-ttu-id="74db7-130">[権限借用の資格情報] ダイアログ ボックスが表示された場合は、「レッスン 2: データの追加」で使用した権限借用の資格情報を入力します。</span><span class="sxs-lookup"><span data-stu-id="74db7-130">If the Impersonation Credentials dialog box appears, type the impersonation credentials you used in Lesson 2: Add Data.</span></span>  
  
3.  <span data-ttu-id="74db7-131">**[データのインポート方法の選択]** ページで、 **[インポートするデータをテーブルとビューの一覧から選択する]** が選択されていることを確認し、 **[次へ]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="74db7-131">On the **Choose How to Import the Data** page, leave **Select from a list of tables and views to choose the data to import** selected, and then click **Next**.</span></span>  
  
4.  <span data-ttu-id="74db7-132">**[テーブルとビューの選択]** ページで、 **DimSalesTerritory** テーブルをクリックします。</span><span class="sxs-lookup"><span data-stu-id="74db7-132">On the **Select Tables and Views** page, select the **DimSalesTerritory** table.</span></span>  
  
5.  <span data-ttu-id="74db7-133">[表示名] 列に「 **Sales Territory**」と入力します。</span><span class="sxs-lookup"><span data-stu-id="74db7-133">In the Friendly Name column, type **Sales Territory**.</span></span>  
  
6.  <span data-ttu-id="74db7-134">**[プレビューとフィルター]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="74db7-134">Click **Preview and Filter**.</span></span>  
  
7.  <span data-ttu-id="74db7-135">**SalesTerritoryAlternateKey** 列を選択解除して、 **[OK]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="74db7-135">Deselect the **SalesTerritoryAlternateKey** column, and then click **Ok**.</span></span>  
  
8.  <span data-ttu-id="74db7-136">**[テーブルとビューの選択]** ページで、 **[完了]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="74db7-136">On the **Select Tables and Views** page, click **Finish**.</span></span>  
  
     <span data-ttu-id="74db7-137">新しいテーブルがモデル ワークスペースに追加されます。</span><span class="sxs-lookup"><span data-stu-id="74db7-137">The new table will be added to the model workspace.</span></span> <span data-ttu-id="74db7-138">ソースの dimSalesTerritory テーブルのオブジェクトおよびデータが AW Internet Sales Tabular Model の新しい Sales Territory テーブルにインポートされます。</span><span class="sxs-lookup"><span data-stu-id="74db7-138">Objects and data from the source dimSalesTerritory table are then imported into the new Sales Territory table in your AW Internet Sales Tabular Model.</span></span>  
  
9. <span data-ttu-id="74db7-139">テーブルのインポートが完了したら、 **[閉じる]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="74db7-139">After the table has been imported, click **Close**.</span></span>  
  
## <a name="give-the-columns-friendly-names"></a><span data-ttu-id="74db7-140">列の表示名の指定</span><span class="sxs-lookup"><span data-stu-id="74db7-140">Give the Columns Friendly Names</span></span>  
 <span data-ttu-id="74db7-141">この作業では表示名を指定して、Sales Territory テーブルの列の名前を変更します。</span><span class="sxs-lookup"><span data-stu-id="74db7-141">In this task, you will rename the columns in the Sales Territory table, giving them friendly names.</span></span> <span data-ttu-id="74db7-142">テーブルや列の表示名の指定は必ずしも必要ではありません。ただし、名前を変更することで、モデル デザイナー内のモデル プロジェクトでも、またクライアント アプリケーションのフィールド リストでユーザーがモデル オブジェクトやデータを参照する際にも、移動が行いやすくなります。</span><span class="sxs-lookup"><span data-stu-id="74db7-142">It is not always necessary to give tables and/or columns friendly names; however, it does make your model project easier to navigate in the model designer as well as for users browsing model objects and data in a client application field list.</span></span>  
  
#### <a name="to-rename-columns-in-the-sales-territory-table"></a><span data-ttu-id="74db7-143">Sales Territory テーブル内の列の名前を変更するには</span><span class="sxs-lookup"><span data-stu-id="74db7-143">To rename Columns in the Sales Territory Table</span></span>  
  
-   <span data-ttu-id="74db7-144">モデル デザイナーで、 **Sales Territory** テーブル内の列の名前を次のように変更します。</span><span class="sxs-lookup"><span data-stu-id="74db7-144">In the model designer, rename the columns in the **Sales Territory** table:</span></span>  
  
     <span data-ttu-id="74db7-145">**Sales Territory**</span><span class="sxs-lookup"><span data-stu-id="74db7-145">**Sales Territory**</span></span>  
  
    |<span data-ttu-id="74db7-146">ソース名</span><span class="sxs-lookup"><span data-stu-id="74db7-146">Source Name</span></span>|<span data-ttu-id="74db7-147">フレンドリ名</span><span class="sxs-lookup"><span data-stu-id="74db7-147">Friendly Name</span></span>|  
    |-----------------|-------------------|  
    |<span data-ttu-id="74db7-148">SalesTerritoryKey</span><span class="sxs-lookup"><span data-stu-id="74db7-148">SalesTerritoryKey</span></span>|<span data-ttu-id="74db7-149">Sales Territory Id</span><span class="sxs-lookup"><span data-stu-id="74db7-149">Sales Territory Id</span></span>|  
    |<span data-ttu-id="74db7-150">SalesTerritoryRegion</span><span class="sxs-lookup"><span data-stu-id="74db7-150">SalesTerritoryRegion</span></span>|<span data-ttu-id="74db7-151">Sales Territory Region</span><span class="sxs-lookup"><span data-stu-id="74db7-151">Sales Territory Region</span></span>|  
    |<span data-ttu-id="74db7-152">SalesTerritoryCountry</span><span class="sxs-lookup"><span data-stu-id="74db7-152">SalesTerritoryCountry</span></span>|<span data-ttu-id="74db7-153">Sales Territory Country</span><span class="sxs-lookup"><span data-stu-id="74db7-153">Sales Territory Country</span></span>|  
    |<span data-ttu-id="74db7-154">SalesTerritoryGroup</span><span class="sxs-lookup"><span data-stu-id="74db7-154">SalesTerritoryGroup</span></span>|<span data-ttu-id="74db7-155">Sales Territory Group</span><span class="sxs-lookup"><span data-stu-id="74db7-155">Sales Territory Group</span></span>|  
  
## <a name="add-a-table-with-user-name-data"></a><span data-ttu-id="74db7-156">ユーザー名データを含むテーブルの追加</span><span class="sxs-lookup"><span data-stu-id="74db7-156">Add a table with user name data</span></span>  
 <span data-ttu-id="74db7-157">AdventureWorksDW サンプル データベース内の dimEmployee テーブルには AdventureWorks ドメインのユーザーが含まれており、それらのユーザー名はご使用の環境に存在しないため、組織の実際のユーザーの小人数 (3 人) のサンプルが含まれたテーブルをモデルに作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="74db7-157">Because the dimEmployee table in the AdventureWorksDW sample database contains users from the AdventureWorks domain, and those user names do not exist in your own environment, you must create a table in your model that contains a small sample (three) of actual users from your organization.</span></span> <span data-ttu-id="74db7-158">その後、これらのユーザーを新しいロールにメンバーとして追加します。</span><span class="sxs-lookup"><span data-stu-id="74db7-158">You will then add these users as members to the new role.</span></span> <span data-ttu-id="74db7-159">サンプルのユーザー名のパスワードは不要ですが、自分のドメインの実際の Windows ユーザー名が必要になります。</span><span class="sxs-lookup"><span data-stu-id="74db7-159">You do not need the passwords for the sample user names, but you will need actual Windows user names from your own domain.</span></span>  
  
#### <a name="to-add-an-employee-security-table"></a><span data-ttu-id="74db7-160">Employee Security テーブルを追加するには</span><span class="sxs-lookup"><span data-stu-id="74db7-160">To add an Employee Security table</span></span>  
  
1.  <span data-ttu-id="74db7-161">Microsoft Excel を開き、新しいワークシートを作成します。</span><span class="sxs-lookup"><span data-stu-id="74db7-161">Open Microsoft Excel, creating a new worksheet.</span></span>  
  
2.  <span data-ttu-id="74db7-162">ヘッダー行を含む次のテーブルをコピーし、ワークシートに貼り付けます。</span><span class="sxs-lookup"><span data-stu-id="74db7-162">Copy the following table, including the header row, and then paste it into the worksheet.</span></span>  
  
    |<span data-ttu-id="74db7-163">Employee Id</span><span class="sxs-lookup"><span data-stu-id="74db7-163">Employee Id</span></span>|<span data-ttu-id="74db7-164">Sales Territory Id</span><span class="sxs-lookup"><span data-stu-id="74db7-164">Sales Territory Id</span></span>|<span data-ttu-id="74db7-165">名</span><span class="sxs-lookup"><span data-stu-id="74db7-165">First Name</span></span>|<span data-ttu-id="74db7-166">姓</span><span class="sxs-lookup"><span data-stu-id="74db7-166">Last Name</span></span>|<span data-ttu-id="74db7-167">ログイン ID</span><span class="sxs-lookup"><span data-stu-id="74db7-167">Login Id</span></span>|  
    |-----------------|------------------------|----------------|---------------|--------------|  
    |<span data-ttu-id="74db7-168">1</span><span class="sxs-lookup"><span data-stu-id="74db7-168">1</span></span>|<span data-ttu-id="74db7-169">2</span><span class="sxs-lookup"><span data-stu-id="74db7-169">2</span></span>|\<user first name>|\<user last name>|\<domain\username>|  
    |<span data-ttu-id="74db7-170">1</span><span class="sxs-lookup"><span data-stu-id="74db7-170">1</span></span>|<span data-ttu-id="74db7-171">3</span><span class="sxs-lookup"><span data-stu-id="74db7-171">3</span></span>|\<user first name>|\<user last name>|\<domain\username>|  
    |<span data-ttu-id="74db7-172">2</span><span class="sxs-lookup"><span data-stu-id="74db7-172">2</span></span>|<span data-ttu-id="74db7-173">4</span><span class="sxs-lookup"><span data-stu-id="74db7-173">4</span></span>|\<user first name>|\<user last name>|\<domain\username>|  
    |<span data-ttu-id="74db7-174">3</span><span class="sxs-lookup"><span data-stu-id="74db7-174">3</span></span>|<span data-ttu-id="74db7-175">5</span><span class="sxs-lookup"><span data-stu-id="74db7-175">5</span></span>|\<user first name>|\<user last name>|\<domain\username>|  
  
3.  <span data-ttu-id="74db7-176">新しいワークシートで、名、姓、および domain\username を組織の 3 人のユーザーの名前とログイン ID に置き換えます。</span><span class="sxs-lookup"><span data-stu-id="74db7-176">In the new worksheet, replace the first name, last name, and domain\username with the names and login ids of three users in your organization.</span></span> <span data-ttu-id="74db7-177">先頭の 2 つの行に、Employee Id 1 の同じユーザーを配置します。</span><span class="sxs-lookup"><span data-stu-id="74db7-177">Put the same user on the first two rows, for Employee Id 1.</span></span> <span data-ttu-id="74db7-178">これは、このユーザーが 1 つ以上の販売区域に属していることを示します。</span><span class="sxs-lookup"><span data-stu-id="74db7-178">This will show this user belongs to more than one sales territory.</span></span> <span data-ttu-id="74db7-179">Employee Id フィールドと Sales Territory Id フィールドはそのままにします。</span><span class="sxs-lookup"><span data-stu-id="74db7-179">Leave the Employee Id and Sales Territory Id fields as they are.</span></span>  
  
4.  <span data-ttu-id="74db7-180">ワークシートをとして保存 `Sample Employee` します。</span><span class="sxs-lookup"><span data-stu-id="74db7-180">Save the worksheet as `Sample Employee`.</span></span>  
  
5.  <span data-ttu-id="74db7-181">ワークシートで、従業員データを含むすべてのセルをヘッダーと共に選択し、選択したデータを右クリックし、 **[コピー]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="74db7-181">In the worksheet, select all of the cells with employee data, including the headers, then right click the selected data, and then click **Copy**.</span></span>  
  
6.  <span data-ttu-id="74db7-182">[!INCLUDE[ssBIDevStudio](../includes/ssbidevstudio-md.md)]で **[編集]** メニューをクリックし、 **[貼り付け]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="74db7-182">In [!INCLUDE[ssBIDevStudio](../includes/ssbidevstudio-md.md)], click the **Edit** menu, and then click **Paste**.</span></span>  
  
     <span data-ttu-id="74db7-183">[貼り付け] がグレー表示されている場合は、モデル デザイナー ウィンドウの任意のテーブルの任意の列をクリックし、 **[編集]** メニューの **[貼り付け]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="74db7-183">If Paste is greyed out, click any column in any table in the model designer window, and then click the **Edit** menu, and then click **Paste**.</span></span>  
  
7.  <span data-ttu-id="74db7-184">[**貼り付けプレビュー** ] ダイアログボックスの [**テーブル名**] に「」と入力 `Employee Security` します。</span><span class="sxs-lookup"><span data-stu-id="74db7-184">In the **Paste Preview** dialog box, in **Table Name**, type `Employee Security`.</span></span>  
  
8.  <span data-ttu-id="74db7-185">**[貼り付けるデータ]** で、Sample Employee ワークシートのすべてのユーザー データとヘッダーが含まれていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="74db7-185">In **Data to be pasted**, verify the data includes all of the user data and headers from the Sample Employee worksheet.</span></span>  
  
9. <span data-ttu-id="74db7-186">**[先頭の行を列見出しとして使用する]** がオンであることを確認し、**[OK]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="74db7-186">Verify **Use first row as column headers** is checked, and then click **Ok**.</span></span>  
  
     <span data-ttu-id="74db7-187">Sample Employee ワークシートからコピーした従業員データを含む、Employee Security という名前の新しいテーブルが作成されます。</span><span class="sxs-lookup"><span data-stu-id="74db7-187">A new table named Employee Security with employee data copied from the Sample Employee worksheet is created.</span></span>  
  
## <a name="create-relationships-between-internet-sales-geography-and-sales-territory-table"></a><span data-ttu-id="74db7-188">Internet Sales、Geography、および Sales Territory テーブル間のリレーションシップの作成</span><span class="sxs-lookup"><span data-stu-id="74db7-188">Create Relationships Between Internet Sales, Geography, and Sales Territory table</span></span>  
 <span data-ttu-id="74db7-189">Internet Sales、Geography、および Sales 区域の各テーブルには、共通の列である販売区域 Id が含まれています。販売区域のテーブルの販売区域 Id 列には、販売区域ごとに異なる Id の値が含まれています。</span><span class="sxs-lookup"><span data-stu-id="74db7-189">The Internet Sales, Geography, and Sales Territory table all contain a common column, Sales Territory Id. The Sales Territory Id column in the Sales Territory table contains values with a different Id for each sales territory.</span></span>  
  
#### <a name="to-create-relationships-between-the-internet-sales-geography-and-the-sales-territory-table"></a><span data-ttu-id="74db7-190">Internet Sales、Geography、および Sales Territory テーブル間のリレーションシップを作成するには</span><span class="sxs-lookup"><span data-stu-id="74db7-190">To create relationships between the Internet Sales, Geography, and the Sales Territory table</span></span>  
  
1.  <span data-ttu-id="74db7-191">モデル デザイナーのダイアグラム ビューの **Geography** テーブルで、 **[Sales Territory Id]** 列をクリックし、そのままカーソルを **Sales Territory** テーブル内の **Sales Territory Id** 列にドラッグして離します。</span><span class="sxs-lookup"><span data-stu-id="74db7-191">In the model designer, in Diagram View, in the **Geography** table, click and hold on the **Sales Territory Id** column, then drag the cursor to the **Sales Territory Id** column in the **Sales Territory** table, and then release.</span></span>  
  
2.  <span data-ttu-id="74db7-192">**Internet Sales** テーブルで、 **[Sales Territory Id]** 列をクリックし、そのままカーソルを **Sales Territory** テーブル内の **Sales Territory Id** 列にドラッグして離します。</span><span class="sxs-lookup"><span data-stu-id="74db7-192">In the **Internet Sales** table, click and hold on the **Sales Territory Id** column, then drag the cursor to the **Sales Territory Id** column in the **Sales Territory** table, and then release.</span></span>  
  
     <span data-ttu-id="74db7-193">このリレーションシップの Active プロパティは False であり、非アクティブであることを意味します。</span><span class="sxs-lookup"><span data-stu-id="74db7-193">Notice the Active property for this relationship is False, meaning it is inactive.</span></span> <span data-ttu-id="74db7-194">これは、Internet Sales テーブルにはメジャーで使用されている別のアクティブなリレーションシップが既にあるためです。</span><span class="sxs-lookup"><span data-stu-id="74db7-194">This is because the Internet Sales table already has another active relationship that is used in measures.</span></span>  
  
## <a name="hide-the-employee-security-table-from-client-applications"></a><span data-ttu-id="74db7-195">クライアント アプリケーションで Employee Security テーブルを非表示にする</span><span class="sxs-lookup"><span data-stu-id="74db7-195">Hide the Employee Security Table from Client Applications</span></span>  
 <span data-ttu-id="74db7-196">このタスクでは、クライアントアプリケーションのフィールドリストに表示されないように、Employee Security テーブルを非表示にします。</span><span class="sxs-lookup"><span data-stu-id="74db7-196">In this task, you will hide the Employee Security table, keeping it from appearing in a client application's field list.</span></span> <span data-ttu-id="74db7-197">テーブルを非表示にしても、セキュリティで保護されるわけではないことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="74db7-197">Keep in-mind that hiding a table does not secure it.</span></span> <span data-ttu-id="74db7-198">方法を知っていれば、ユーザーは引き続き Employee Security テーブル データのクエリを実行できます。</span><span class="sxs-lookup"><span data-stu-id="74db7-198">Users can still query Employee Security table data if they know how.</span></span> <span data-ttu-id="74db7-199">Employee Security テーブルのデータをセキュリティで保護し、ユーザーがデータに対してクエリを実行できないようにするには、この後の作業でフィルターを適用します。</span><span class="sxs-lookup"><span data-stu-id="74db7-199">In order to secure the Employee Security table data, preventing users from being able to query any of its data, you will apply a filter in a later task.</span></span>  
  
#### <a name="to-hide-the-employee-table-from-client-applications"></a><span data-ttu-id="74db7-200">クライアント アプリケーションで Employee テーブルを非表示にするには</span><span class="sxs-lookup"><span data-stu-id="74db7-200">To hide the Employee Table from client applications</span></span>  
  
-   <span data-ttu-id="74db7-201">モデル デザイナーのダイアグラム ビューで、**Employee** テーブルの見出しを右クリックし、**[クライアント ツールに非表示]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="74db7-201">In the model designer, in Diagram View, right-click the **Employee** table heading, and then click **Hide from Client Tools**.</span></span>  
  
## <a name="create-a-sales-employees-by-territory-user-role"></a><span data-ttu-id="74db7-202">Sales Employees by Territory ユーザー ロールの作成</span><span class="sxs-lookup"><span data-stu-id="74db7-202">Create a Sales Employees by Territory user role</span></span>  
 <span data-ttu-id="74db7-203">この作業では、新しいユーザー ロールを作成します。</span><span class="sxs-lookup"><span data-stu-id="74db7-203">In this task, you will create a new user role.</span></span> <span data-ttu-id="74db7-204">このロールには、Sales Territory テーブル内のどの行がユーザーに表示されるかを定義する行フィルターが含まれます。</span><span class="sxs-lookup"><span data-stu-id="74db7-204">This role will include a row filter defining which rows of the Sales Territory table are visible to users.</span></span> <span data-ttu-id="74db7-205">このフィルターは、一対多のリレーションシップの方向で、Sales Territory に関連する他のすべてのテーブルに適用されます。</span><span class="sxs-lookup"><span data-stu-id="74db7-205">The filter is then applied in the one-to many relationship direction to all other tables related to Sales Territory.</span></span> <span data-ttu-id="74db7-206">また、ロールのメンバーであるユーザーがクエリを実行できないように Employee Security テーブル全体を保護する簡単なフィルターも追加します。</span><span class="sxs-lookup"><span data-stu-id="74db7-206">You will also apply a simple filter that secures the entire Employee Security table from being queryable by any user that is a member of the role.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="74db7-207">このレッスンで作成する Sales Employees by Territory ロールによって、メンバーが参照 (またはクエリを実行) できるデータは、自分が属する販売区域の売上データのみに制限されます。</span><span class="sxs-lookup"><span data-stu-id="74db7-207">The Sales Employees by Territory role you create in this lesson restricts members to browse (or query) only sales data for the sales territory to which they belong.</span></span> <span data-ttu-id="74db7-208">Sales Employees by Territory ロールにメンバーとして追加したユーザーが、「 [レッスン 12: ロールの作成](../analysis-services/lesson-11-create-roles.md)」で作成したロールのメンバーでもある場合、権限は組み合わせとなります。</span><span class="sxs-lookup"><span data-stu-id="74db7-208">If you add a user as a member to the Sales Employees by Territory role that also exists as a member in a role created in [Lesson 12: Create Roles](../analysis-services/lesson-11-create-roles.md), you will get a combination of permissions.</span></span> <span data-ttu-id="74db7-209">あるユーザーが複数のロールのメンバーである場合、各ロールに対して定義された権限と行フィルターは累積されます。</span><span class="sxs-lookup"><span data-stu-id="74db7-209">When a user is a member of multiple roles, the permissions, and row filters defined for each role are cumulative.</span></span> <span data-ttu-id="74db7-210">つまり、ロールを組み合わせることでユーザーの権限は引き上げられます。</span><span class="sxs-lookup"><span data-stu-id="74db7-210">That is, the user will have the greater permissions determined by the combination of roles.</span></span>  
  
#### <a name="to-create-a-sales-employees-by-territory-user-role"></a><span data-ttu-id="74db7-211">Sales Employees by Territory ユーザー ロールを作成するには</span><span class="sxs-lookup"><span data-stu-id="74db7-211">To create a Sales Employees by Territory user role</span></span>  
  
1.  <span data-ttu-id="74db7-212">[!INCLUDE[ssBIDevStudio](../includes/ssbidevstudio-md.md)]で **[モデル]** メニューをクリックし、 **[ロール]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="74db7-212">In [!INCLUDE[ssBIDevStudio](../includes/ssbidevstudio-md.md)], click the **Model** menu, and then click **Roles**.</span></span>  
  
2.  <span data-ttu-id="74db7-213">**[ロール マネージャー]** ダイアログ ボックスで **[新規]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="74db7-213">In the **Role Manager** dialog box, click **New**.</span></span>  
  
     <span data-ttu-id="74db7-214">"なし" 権限を設定された新しいロールがリストに追加されます。</span><span class="sxs-lookup"><span data-stu-id="74db7-214">A new role with the None permission is added to the list.</span></span>  
  
3.  <span data-ttu-id="74db7-215">新しいロールをクリックし、[**名前**] 列でロールの名前をに変更し `Sales Employees by Territory` ます。</span><span class="sxs-lookup"><span data-stu-id="74db7-215">Click on the new role, and then in the **Name** column, rename the role to `Sales Employees by Territory`.</span></span>  
  
4.  <span data-ttu-id="74db7-216">**[権限]** 列で、ドロップダウン リストをクリックし、**[読み取り]** 権限を選択します。</span><span class="sxs-lookup"><span data-stu-id="74db7-216">In the **Permissions** column, click the dropdown list, and then select the **Read** permission.</span></span>  
  
5.  <span data-ttu-id="74db7-217">**[メンバー]** タブをクリックし、 **[追加]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="74db7-217">Click on the **Members** tab, and then click **Add**.</span></span>  
  
6.  <span data-ttu-id="74db7-218">**[ユーザーまたはグループの選択]** ダイアログ ボックスの **[選択するオブジェクト名を入力してください]** に、Employee Security テーブルの作成で使用した最初のサンプル ユーザー名を入力します。</span><span class="sxs-lookup"><span data-stu-id="74db7-218">In the **Select User or Group** dialog box, in **Enter the object named to select**, type the first sample user name you used when creating the Employee Security table.</span></span> <span data-ttu-id="74db7-219">**[名前の確認]** をクリックしてユーザー名が有効であることを確認し、**[OK]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="74db7-219">Click **Check Names** to verify the user name is valid, and then click **Ok**.</span></span>  
  
     <span data-ttu-id="74db7-220">この手順を繰り返して、Employee Security テーブルの作成で使用した他のサンプル ユーザー名を追加します。</span><span class="sxs-lookup"><span data-stu-id="74db7-220">Repeat this step, adding the other sample user names you used when creating the Employee Security table.</span></span>  
  
7.  <span data-ttu-id="74db7-221">**[行フィルター]** タブをクリックします。</span><span class="sxs-lookup"><span data-stu-id="74db7-221">Click on the **Row Filters** tab.</span></span>  
  
8.  <span data-ttu-id="74db7-222">テーブルの [ `Employee Security` **DAX フィルター** ] 列に、次の式を入力します。</span><span class="sxs-lookup"><span data-stu-id="74db7-222">For the `Employee Security` table, in the **DAX Filter** column, type the following formula.</span></span>  
  
     `=FALSE()`  
  
     <span data-ttu-id="74db7-223">数式の入力が終了したら、Enter キーを押します。</span><span class="sxs-lookup"><span data-stu-id="74db7-223">When you have finished building the formula, press ENTER.</span></span>  
  
     <span data-ttu-id="74db7-224">この数式は、すべての列がブール条件 false に解決されることを指定します。このため、Employee Security テーブルで Sales Employees by Territory ユーザー ロールのメンバーがクエリを実行できる列はありません。</span><span class="sxs-lookup"><span data-stu-id="74db7-224">This formula specifies that all columns resolve to the false Boolean condition; therefore, no columns for the Employee Security table can be queried by a member of the Sales Employees by Territory user role.</span></span>  
  
9. <span data-ttu-id="74db7-225">**Sales Territory** テーブルには、次の数式を入力します。</span><span class="sxs-lookup"><span data-stu-id="74db7-225">For the **Sales Territory** table, type the following formula.</span></span>  
  
     `='Sales Territory'[Sales Territory Id]=LOOKUPVALUE('Employee Security'[Sales Territory Id], 'Employee Security'[Login Id], USERNAME(), 'Employee Security'[Sales Territory Id], 'Sales Territory'[Sales Territory Id])`  
  
     <span data-ttu-id="74db7-226">数式の入力が終了したら、Enter キーを押します。</span><span class="sxs-lookup"><span data-stu-id="74db7-226">When you have finished building the formula, press ENTER.</span></span>  
  
     <span data-ttu-id="74db7-227">この数式では、LOOKUPVALUE 関数によって、現在ログオンしている Windows ユーザー名と同じ Employee Security[Login Id] を持つ Employee Security[Sales Territory Id] 列のすべての値が返されます。Employee Security[Sales Territory Id] は Sales Territory[Sales Territory Id] と同じです。</span><span class="sxs-lookup"><span data-stu-id="74db7-227">In this formula, the LOOKUPVALUE function returns all values for the Employee Security[Sales Territory Id] column, where the Employee Security[Login Id] is the same as the current logged on Windows user name, and Employee Security[Sales Territory Id] is the same as the Sales Territory[Sales Territory Id].</span></span>  
  
     <span data-ttu-id="74db7-228">LOOKUPVALUE によって返された一連の Sales Territory ID を使用して、Sales Territory テーブルに表示される行が制限されます。</span><span class="sxs-lookup"><span data-stu-id="74db7-228">The set of Sales Territory IDs returned by LOOKUPVALUE is then used to restrict the rows shown in the Sales Territory table.</span></span> <span data-ttu-id="74db7-229">LOOKUPVALUE 関数で返された一連の ID と Sales Territory ID が一致する行のみが表示されます。</span><span class="sxs-lookup"><span data-stu-id="74db7-229">Only rows where the Sales Territory ID for the row is in the set of IDs returned by the LOOKUPVALUE function are displayed.</span></span>  
  
10. <span data-ttu-id="74db7-230">[ロール マネージャー] ダイアログ ボックスで、 **[OK]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="74db7-230">In the Role Manager dialog box, click **Ok**.</span></span>  
  
## <a name="test-the-sales-employees-by-territory-user-role"></a><span data-ttu-id="74db7-231">Sales Employees by Territory ユーザー ロールのテスト</span><span class="sxs-lookup"><span data-stu-id="74db7-231">Test the Sales Employees by Territory User Role</span></span>  
 <span data-ttu-id="74db7-232">この作業では、 [!INCLUDE[ssBIDevStudio](../includes/ssbidevstudio-md.md)] の [Excel で分析] 機能を使用して、Sales Employees by Territory ユーザー ロールの有効性をテストできます。</span><span class="sxs-lookup"><span data-stu-id="74db7-232">In this task, you will use the Analyze in Excel feature in [!INCLUDE[ssBIDevStudio](../includes/ssbidevstudio-md.md)] to test the efficacy of the Sales Employees by Territory user role.</span></span> <span data-ttu-id="74db7-233">Employee Security テーブルに追加したロールのメンバーのうちの、いずれかのユーザー名を指定します。</span><span class="sxs-lookup"><span data-stu-id="74db7-233">You will specify one of the user names you added to the Employee Security table and as a member of the role.</span></span> <span data-ttu-id="74db7-234">このユーザー名は、Excel とモデルの間に作成された接続で有効なユーザー名として使用されます。</span><span class="sxs-lookup"><span data-stu-id="74db7-234">This user name will then be used as the effective user name in the connection created between Excel and the model.</span></span>  
  
#### <a name="to-test-the-sales-employees-by-territory-user-role"></a><span data-ttu-id="74db7-235">Sales Employees by Territory ユーザー ロールをテストするには</span><span class="sxs-lookup"><span data-stu-id="74db7-235">To test the Sales Employees by Territory user role</span></span>  
  
1.  <span data-ttu-id="74db7-236">[!INCLUDE[ssBIDevStudio](../includes/ssbidevstudio-md.md)]で、 **[モデル]** メニューの **[Excel で分析]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="74db7-236">In [!INCLUDE[ssBIDevStudio](../includes/ssbidevstudio-md.md)], click the **Model** menu, and then click **Analyze in Excel**.</span></span>  
  
2.  <span data-ttu-id="74db7-237">**[Excel で分析]** ダイアログ ボックスの **[モデルへの接続に使用するユーザー名またはロールを指定します]** で、**[その他の Windows ユーザー]** をクリックし、**[参照]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="74db7-237">In the **Analyze in Excel** dialog box, in **Specify the user name or role to use to connect to the model**, select **Other Windows User**, and then click **Browse**.</span></span>  
  
3.  <span data-ttu-id="74db7-238">**[ユーザーまたはグループの選択]** ダイアログ ボックスの **[選択するオブジェクト名を入力してください]** に、Employee テーブルに追加したいずれかのユーザー名を入力し、 **[名前の確認]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="74db7-238">In the **Select User or Group** dialog box, in **Enter the object name to select**, type one of the user names you included in the Employee table, and then click **Check Names**.</span></span>  
  
4.  <span data-ttu-id="74db7-239">**[OK]** をクリックして **[ユーザーまたはグループの選択]** ダイアログ ボックスを閉じ、**[OK]** をクリックして **[Excel で分析]** ダイアログ ボックスを閉じます。</span><span class="sxs-lookup"><span data-stu-id="74db7-239">Click **Ok** to close the **Select User or Group** dialog box, and then click **Ok** to close the **Analyze in Excel** dialog box.</span></span>  
  
     <span data-ttu-id="74db7-240">新しいノートブックで Excel が開きます｡</span><span class="sxs-lookup"><span data-stu-id="74db7-240">Excel will open with a new workbook.</span></span> <span data-ttu-id="74db7-241">ピボット テーブルが自動的に作成されます。</span><span class="sxs-lookup"><span data-stu-id="74db7-241">A Pivot table is automatically created.</span></span> <span data-ttu-id="74db7-242">[ピボットテーブルのフィールド リスト] には、新しいモデルで使用できるほとんどのデータ フィールドが表示されます。</span><span class="sxs-lookup"><span data-stu-id="74db7-242">The Pivot Table Field List includes most of the data fields available in your new model.</span></span>  
  
     <span data-ttu-id="74db7-243">Employee Security テーブルはピボットテーブルのフィールド リストに表示されないことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="74db7-243">Notice the Employee Security table is not visible in the Pivot Table Field List.</span></span> <span data-ttu-id="74db7-244">これは、前の作業でクライアント ツールからこのテーブルを非表示にすることを選択したためです。</span><span class="sxs-lookup"><span data-stu-id="74db7-244">This is because you chose to hide this table from client tools in a previous task.</span></span>  
  
5.  <span data-ttu-id="74db7-245">**[ピボットテーブル フィールド]** の一覧の **∑ Internet Sales** (メジャー) で、 **Internet Total Sales** メジャーを選択します。</span><span class="sxs-lookup"><span data-stu-id="74db7-245">In the **Pivot Table Field** list, in **∑ Internet Sales** (measures), select the **Internet Total Sales** measure.</span></span> <span data-ttu-id="74db7-246">メジャーは **値** フィールドに入力されます。</span><span class="sxs-lookup"><span data-stu-id="74db7-246">The measure will be entered into the **Values** fields.</span></span>  
  
6.  <span data-ttu-id="74db7-247">**[ピボットテーブル フィールド]** の一覧で、 **Sales Territory** テーブルの **Sales Territory Id** 列を選択します。</span><span class="sxs-lookup"><span data-stu-id="74db7-247">In the **Pivot Table Field** list, select the **Sales Territory Id** column from the **Sales Territory** table.</span></span> <span data-ttu-id="74db7-248">列は **行ラベル** フィールドに入力されます。</span><span class="sxs-lookup"><span data-stu-id="74db7-248">The column will be entered into the **Row Labels** fields.</span></span>  
  
     <span data-ttu-id="74db7-249">使用した有効なユーザー名が属している 1 つのリージョンのインターネット販売成績のみが表示されていることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="74db7-249">Notice Internet sales figures appear only for the one region to which the effective user name you used belongs.</span></span> <span data-ttu-id="74db7-250">たとえば Geography テーブルの City など、別の列を行ラベル フィールドとして選択すると、有効なユーザーが属する販売区域の都市のみが表示されます。</span><span class="sxs-lookup"><span data-stu-id="74db7-250">If you select another column; for example, City, from the Geography table as Row Label field, only cities in the sales territory to which the effective user belongs are displayed.</span></span>  
  
     <span data-ttu-id="74db7-251">このユーザーは、自分が属する区域以外の区域のインターネット販売データを参照したり、クエリを実行することはできません。これは、Sales Employees by Territory ユーザー ロールで Sales Territory テーブルに定義された行フィルターによって、他の販売区域に関連するすべてのデータが効果的に保護されているためです。</span><span class="sxs-lookup"><span data-stu-id="74db7-251">This user cannot browse or query any Internet sales data for territories other than the one they belong because the row filter defined for the Sales Territory table in the Sales Employees by Territory user role effectively secures data for all data related to other sales territories.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="74db7-252">参照</span><span class="sxs-lookup"><span data-stu-id="74db7-252">See Also</span></span>  
 <span data-ttu-id="74db7-253">[ユーザー名関数 &#40;DAX&#41;](/dax/username-function-dax) </span><span class="sxs-lookup"><span data-stu-id="74db7-253">[USERNAME Function &#40;DAX&#41;](/dax/username-function-dax) </span></span>  
 <span data-ttu-id="74db7-254">[LOOKUPVALUE 関数 &#40;DAX&#41;](/dax/lookupvalue-function-dax) </span><span class="sxs-lookup"><span data-stu-id="74db7-254">[LOOKUPVALUE Function &#40;DAX&#41;](/dax/lookupvalue-function-dax) </span></span>  
 [<span data-ttu-id="74db7-255">CUSTOMDATA 関数 &#40;DAX&#41;</span><span class="sxs-lookup"><span data-stu-id="74db7-255">CUSTOMDATA Function &#40;DAX&#41;</span></span>](/dax/customdata-function-dax)  
  
  
