---
title: カスタム ワークフローの作成 (Master Data Services) | Microsoft Docs
ms.custom: ''
ms.date: 03/08/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ''
ms.topic: reference
ms.assetid: 8e4403e9-595c-4b6b-9d0c-f6ae1b2bc99d
author: lrtoyou1223
ms.author: lle
ms.openlocfilehash: cac53946d83eda178328b153875a86440517a560
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87646190"
---
# <a name="create-a-custom-workflow-master-data-services"></a><span data-ttu-id="cfa38-102">カスタム ワークフローの作成 (Master Data Services)</span><span class="sxs-lookup"><span data-stu-id="cfa38-102">Create a Custom Workflow (Master Data Services)</span></span>
  [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] <span data-ttu-id="cfa38-103">は、ビジネス ルールを使用して基本的なワークフロー ソリューションを作成します (たとえば、指定した条件に基づいてデータを自動的に更新および検証し、電子メール通知を送信するなど)。</span><span class="sxs-lookup"><span data-stu-id="cfa38-103">uses business rules to create basic workflow solutions, such as to automatically update and validate data and have e-mail notifications sent, based on conditions you specify.</span></span> <span data-ttu-id="cfa38-104">組み込みのワークフロー アクションよりも複雑な処理が必要な場合は、カスタム ワークフローを使用します。</span><span class="sxs-lookup"><span data-stu-id="cfa38-104">When you require processing that is more complex than what the built-in workflow actions provide, use a custom workflow.</span></span> <span data-ttu-id="cfa38-105">カスタム ワークフローは、ユーザーが作成する .NET アセンブリです。</span><span class="sxs-lookup"><span data-stu-id="cfa38-105">A custom workflow is a .NET assembly that you create.</span></span> <span data-ttu-id="cfa38-106">作成したワークフロー アセンブリが呼び出された際には、記述したコードを通じて、状況に応じた任意のアクションを実行できます。</span><span class="sxs-lookup"><span data-stu-id="cfa38-106">When your workflow assembly is called, your code can take whatever action your situation requires.</span></span> <span data-ttu-id="cfa38-107">たとえば、複数階層の承認や複雑な意思決定ツリーなど、複雑なイベント処理を必要とするワークフローの場合は、[!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] を構成することで、データを分析し、データの承認のための送信先を決定するカスタム ワークフローを開始できます。</span><span class="sxs-lookup"><span data-stu-id="cfa38-107">For example, if your workflow requires complex event processing, such as multi-tiered approvals or complicated decision trees, you can configure [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] to start a custom workflow that analyzes the data and determines where to send it for approval.</span></span>  
  
## <a name="how-custom-workflows-are-processed"></a><span data-ttu-id="cfa38-108">カスタム ワークフローの処理方法</span><span class="sxs-lookup"><span data-stu-id="cfa38-108">How Custom Workflows Are Processed</span></span>  
 <span data-ttu-id="cfa38-109">カスタム ワークフローの処理には、[!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] Web アプリケーション、SQL Server MDS Workflow Integration Service、およびワークフロー ハンドラー アセンブリの 3 つの主要コンポーネントが関与します。</span><span class="sxs-lookup"><span data-stu-id="cfa38-109">There are three main components involved to process custom workflows: the [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] web application, SQL Server MDS Workflow Integration Service, and the workflow handler assembly.</span></span> <span data-ttu-id="cfa38-110">これらのコンポーネントは、カスタム ワークフローを次のように処理します。</span><span class="sxs-lookup"><span data-stu-id="cfa38-110">These components process a custom workflow as follows:</span></span>  
  
1.  <span data-ttu-id="cfa38-111">ユーザーが [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] を使用して、ワークフローを開始するエンティティを検証します。</span><span class="sxs-lookup"><span data-stu-id="cfa38-111">You use [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] to validate an entity that starts a workflow.</span></span>  
  
2.  [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] <span data-ttu-id="cfa38-112">は、ビジネス ルール条件を満たすメンバーを [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] データベース内の Service Broker キューに送ります。</span><span class="sxs-lookup"><span data-stu-id="cfa38-112">sends members that meet the business rule conditions to a Service Broker queue in the [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] database.</span></span>  
  
3.  <span data-ttu-id="cfa38-113">SQL Server MDS Workflow Integration Service は、一定の間隔で [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] データベース内のストアド プロシージャを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="cfa38-113">At regular intervals, SQL Server MDS Workflow Integration Service calls a stored procedure in the [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] database.</span></span>  
  
4.  <span data-ttu-id="cfa38-114">このストアド プロシージャは、Service Broker キュー内にレコードを見つけると、それらを SQL Server MDS Workflow Integration Service に返します。</span><span class="sxs-lookup"><span data-stu-id="cfa38-114">When this stored procedure finds records in the Service Broker queue, it returns them to SQL Server MDS Workflow Integration Service.</span></span>  
  
5.  <span data-ttu-id="cfa38-115">SQL Server MDS Workflow Integration Services は、それらのデータをワークフロー ハンドラー アセンブリにルーティングします。</span><span class="sxs-lookup"><span data-stu-id="cfa38-115">SQL Server MDS Workflow Integration Services routes the data to your workflow handler assembly.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="cfa38-116">注: SQL Server MDS Workflow Integration Service は単純な処理をトリガーするためのものです。</span><span class="sxs-lookup"><span data-stu-id="cfa38-116">Note: SQL Server MDS Workflow Integration Service is meant to trigger simple processes.</span></span> <span data-ttu-id="cfa38-117">カスタム コードで複雑な処理を行う必要がある場合は、個別のスレッド内か、またはワークフロー プロセスの外部で処理を完了してください。</span><span class="sxs-lookup"><span data-stu-id="cfa38-117">If your custom code requires complex processing, complete your processing either in a separate thread or outside of the workflow process.</span></span>  
  
## <a name="configure-master-data-services-for-custom-workflows"></a><span data-ttu-id="cfa38-118">カスタム ワークフロー向けの Master Data Services の構成</span><span class="sxs-lookup"><span data-stu-id="cfa38-118">Configure Master Data Services for Custom Workflows</span></span>  
 <span data-ttu-id="cfa38-119">カスタム ワークフローを作成するには、カスタム コードの記述と [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] の構成を行って、ワークフロー データをワークフロー ハンドラーに渡す必要があります。</span><span class="sxs-lookup"><span data-stu-id="cfa38-119">Creating a custom workflow requires writing some custom code and configuring [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] to pass workflow data to your workflow handler.</span></span> <span data-ttu-id="cfa38-120">カスタム ワークフロー処理を有効にするには、次の手順を実行します。</span><span class="sxs-lookup"><span data-stu-id="cfa38-120">Follow these steps to enable custom workflow processing:</span></span>  
  
1.  <span data-ttu-id="cfa38-121">MasterDataServices を実装する .NET アセンブリを作成します。 [IWorkflowTypeExtender](/previous-versions/sql/sql-server-2016/hh758785(v=sql.130)).</span><span class="sxs-lookup"><span data-stu-id="cfa38-121">Create a .NET assembly that implements [Microsoft.MasterDataServices.WorkflowTypeExtender.IWorkflowTypeExtender](/previous-versions/sql/sql-server-2016/hh758785(v=sql.130)).</span></span>  
  
2.  <span data-ttu-id="cfa38-122">[!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] データベースに接続してワークフロー ハンドラーにタグを関連付けるよう、SQL Server MDS Workflow Integration Services を構成します。</span><span class="sxs-lookup"><span data-stu-id="cfa38-122">Configure SQL Server MDS Workflow Integration Service to connect to your [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] database and to associate a tag with your workflow handler.</span></span>  
  
3.  <span data-ttu-id="cfa38-123">SQL Server MDS Workflow Integration Service を開始します。</span><span class="sxs-lookup"><span data-stu-id="cfa38-123">Start SQL Server MDS Workflow Integration Service.</span></span>  
  
4.  <span data-ttu-id="cfa38-124">ワークフロー ハンドラーの名前でタグ付けされたワークフローを開始する [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] 内で、ビジネス ルールを作成します。</span><span class="sxs-lookup"><span data-stu-id="cfa38-124">Create a business rule in [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] that starts a workflow that is tagged with the name of your workflow handler.</span></span>  
  
5.  <span data-ttu-id="cfa38-125">そのビジネス ルールを、カスタム ワークフローをトリガーするメンバーに適用します。</span><span class="sxs-lookup"><span data-stu-id="cfa38-125">Apply the business rule to a member that triggers your custom workflow.</span></span>  
  
### <a name="create-the-workflow-handler-assembly"></a><span data-ttu-id="cfa38-126">ワークフロー ハンドラー アセンブリの作成</span><span class="sxs-lookup"><span data-stu-id="cfa38-126">Create the Workflow Handler Assembly</span></span>  
 <span data-ttu-id="cfa38-127">カスタムワークフローは、 [MasterDataServices のエクステンダー](/previous-versions/sql/sql-server-2016/hh758785(v=sql.130))インターフェイスを実装する .net クラスライブラリのアセンブリの1つです。</span><span class="sxs-lookup"><span data-stu-id="cfa38-127">A custom workflow is a .NET class library assembly that implements the [Microsoft.MasterDataServices.WorkflowTypeExtender.IWorkflowTypeExtender](/previous-versions/sql/sql-server-2016/hh758785(v=sql.130)) interface.</span></span> <span data-ttu-id="cfa38-128">SQL Server MDS Workflow Integration Service は、コードを実行するために[MasterDataServices](/previous-versions/sql/sql-server-2016/hh759009(v=sql.130))メソッドを呼び出します。このメソッドは、コードを実行します。</span><span class="sxs-lookup"><span data-stu-id="cfa38-128">SQL Server MDS Workflow Integration Service calls the [Microsoft.MasterDataServices.WorkflowTypeExtender.IWorkflowTypeExtender.StartWorkflow\*](/previous-versions/sql/sql-server-2016/hh759009(v=sql.130)) method to run your code.</span></span> <span data-ttu-id="cfa38-129">[MasterDataServices](/previous-versions/sql/sql-server-2016/hh759009(v=sql.130))を実装するコード例については、「[マスターデータサービス&#41;&#40;カスタムワークフローの例](create-a-custom-workflow-example.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="cfa38-129">For example code that implements [Microsoft.MasterDataServices.WorkflowTypeExtender.IWorkflowTypeExtender.StartWorkflow\*](/previous-versions/sql/sql-server-2016/hh759009(v=sql.130)), see [Custom Workflow Example &#40;Master Data Services&#41;](create-a-custom-workflow-example.md).</span></span>  
  
 <span data-ttu-id="cfa38-130">カスタム ワークフローを処理するために SQL Server MDS Workflow Integration Service から呼び出すことができるアセンブリを、Visual Studio 2010 を使用して作成するには、次の手順を実行します。</span><span class="sxs-lookup"><span data-stu-id="cfa38-130">Follow these steps to use Visual Studio 2010 to create an assembly that SQL Server MDS Workflow Integration Service can call to handle a custom workflow:</span></span>  
  
1.  <span data-ttu-id="cfa38-131">Visual Studio 2010 で、任意の言語を使用する新しい **[クラス ライブラリ]** プロジェクトを作成します。</span><span class="sxs-lookup"><span data-stu-id="cfa38-131">In Visual Studio 2010, create a new **Class Library** project that uses the language of your choice.</span></span> <span data-ttu-id="cfa38-132">C# クラス ライブラリを作成するには、**[Visual C#\Windows]** プロジェクト タイプを選択し、**[クラス ライブラリ]** テンプレートを選択します。</span><span class="sxs-lookup"><span data-stu-id="cfa38-132">To create a C# Class Library, select the **Visual C#\Windows** project types and select the **Class Library** template.</span></span> <span data-ttu-id="cfa38-133">プロジェクトの名前 (**MDSWorkflowTest** など) を入力し、**[OK]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="cfa38-133">Enter a name for your project, such as **MDSWorkflowTest**, and click **OK**.</span></span>  
  
2.  <span data-ttu-id="cfa38-134">Microsoft.MasterDataServices.WorkflowTypeExtender.dll への参照を追加します。</span><span class="sxs-lookup"><span data-stu-id="cfa38-134">Add a reference to Microsoft.MasterDataServices.WorkflowTypeExtender.dll.</span></span> <span data-ttu-id="cfa38-135">このアセンブリは、 \<Your installation folder> マスターデータ services\webapplication\bin にあります。</span><span class="sxs-lookup"><span data-stu-id="cfa38-135">This assembly can be found in \<Your installation folder>\Master Data Services\WebApplication\bin.</span></span>  
  
3.  <span data-ttu-id="cfa38-136">C# コード ファイルに、'using Microsoft.MasterDataServices.Core.Workflow;' を追加します。</span><span class="sxs-lookup"><span data-stu-id="cfa38-136">Add 'using Microsoft.MasterDataServices.Core.Workflow;' to your C# code file.</span></span>  
  
4.  <span data-ttu-id="cfa38-137">クラス宣言で MasterDataServices を継承します。 [IWorkflowTypeExtender](/previous-versions/sql/sql-server-2016/hh758785(v=sql.130))を継承します。</span><span class="sxs-lookup"><span data-stu-id="cfa38-137">Inherit from [Microsoft.MasterDataServices.WorkflowTypeExtender.IWorkflowTypeExtender](/previous-versions/sql/sql-server-2016/hh758785(v=sql.130)) in your class declaration.</span></span> <span data-ttu-id="cfa38-138">クラス宣言は次のようになります: 'public class WorkflowTester : IWorkflowTypeExtender'</span><span class="sxs-lookup"><span data-stu-id="cfa38-138">The class declaration should be similar to: 'public class WorkflowTester : IWorkflowTypeExtender'.</span></span>  
  
5.  <span data-ttu-id="cfa38-139">MasterDataServices の[拡張](/previous-versions/sql/sql-server-2016/hh758785(v=sql.130))インターフェイスを実装しています。</span><span class="sxs-lookup"><span data-stu-id="cfa38-139">Implement the [Microsoft.MasterDataServices.WorkflowTypeExtender.IWorkflowTypeExtender](/previous-versions/sql/sql-server-2016/hh758785(v=sql.130)) interface.</span></span> <span data-ttu-id="cfa38-140">MasterDataServices は、ワークフローを開始するために SQL Server MDS Workflow Integration Service によって呼び出されます。これは、 [Microsoft.MasterDataServices.WorkflowTypeExtender.IWorkflowTypeExtender.StartWorkflow\*](/previous-versions/sql/sql-server-2016/hh759009(v=sql.130))メソッドです。</span><span class="sxs-lookup"><span data-stu-id="cfa38-140">The [Microsoft.MasterDataServices.WorkflowTypeExtender.IWorkflowTypeExtender.StartWorkflow\*](/previous-versions/sql/sql-server-2016/hh759009(v=sql.130)) method is called by SQL Server MDS Workflow Integration Service to start your workflow.</span></span>  
  
6.  <span data-ttu-id="cfa38-141">アセンブリを SQL Server MDS Workflow Integration Service 実行可能ファイルの場所にコピーします。これは、Microsoft.MasterDataServices.Workflow.exe という名前で、 \<Your installation folder> \ Master Data services\webapplication\bin にあります。</span><span class="sxs-lookup"><span data-stu-id="cfa38-141">Copy your assembly to the location of the SQL Server MDS Workflow Integration Service executable, named Microsoft.MasterDataServices.Workflow.exe, in \<Your installation folder>\Master Data Services\WebApplication\bin.</span></span>  
  
### <a name="configure-sql-server-mds-workflow-integration-service"></a><span data-ttu-id="cfa38-142">SQL Server MDS Workflow Integration Service の構成</span><span class="sxs-lookup"><span data-stu-id="cfa38-142">Configure SQL Server MDS Workflow Integration Service</span></span>  
 <span data-ttu-id="cfa38-143">[!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] 構成ファイルを編集して、[!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] データベース用の接続情報を含め、ワークフロー ハンドラー アセンブリにタグを関連付けるには、次の手順を実行します。</span><span class="sxs-lookup"><span data-stu-id="cfa38-143">Edit the [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] configuration file to include connection information for your [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] database and to associate a tag with your workflow handler assembly by following these steps:</span></span>  
  
1.  <span data-ttu-id="cfa38-144">\ Master Data Services\webapplication\bin での Microsoft.MasterDataServices.Workflow.exe.config の検索 \<Your installation folder></span><span class="sxs-lookup"><span data-stu-id="cfa38-144">Find Microsoft.MasterDataServices.Workflow.exe.config in \<Your installation folder>\Master Data Services\WebApplication\bin.</span></span>  
  
2.  <span data-ttu-id="cfa38-145">"ConnectionString" 設定に、[!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] データベース接続情報を追加します。</span><span class="sxs-lookup"><span data-stu-id="cfa38-145">Add the [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] database connection information to the "ConnectionString" setting.</span></span> <span data-ttu-id="cfa38-146">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] インストールで大文字と小文字を区別する照合順序が使用されている場合、データベースの名前は、データベース内と同様の大文字/小文字で入力する必要があります。</span><span class="sxs-lookup"><span data-stu-id="cfa38-146">If your [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] installation uses case-sensitive collation, the name of the database must be entered in the same case as in the database.</span></span> <span data-ttu-id="cfa38-147">たとえば、設定タグの全体は次のようになります。</span><span class="sxs-lookup"><span data-stu-id="cfa38-147">For example, the complete setting tag might look like this:</span></span>  
  
    ```xml  
    <setting name="ConnectionString" serializeAs="String">  
        <value>Server=myServer;Database=myDatabase;Integrated Security=True</value>  
    </setting>  
    ```  
  
3.  <span data-ttu-id="cfa38-148">"ConnectionString" 設定下で "WorkflowTypeExtenders" 設定を追加して、ワークフロー ハンドラー アセンブリにタグ名を関連付けます。</span><span class="sxs-lookup"><span data-stu-id="cfa38-148">Below the "ConnectionString" setting add a "WorkflowTypeExtenders" setting to associate a tag name with your workflow handler assembly.</span></span> <span data-ttu-id="cfa38-149">次に例を示します。</span><span class="sxs-lookup"><span data-stu-id="cfa38-149">For example:</span></span>  
  
    ```xml  
    <setting name="WorkflowTypeExtenders" serializeAs="String">  
        <value>TEST=MDSWorkflowTestLib.WorkflowTester, MDSWorkflowTestLib</value>  
    </setting>  
    ```  
  
     <span data-ttu-id="cfa38-150">タグの内部テキスト \<value> は、の形式になってい \<Workflow tag> = \<assembly-qualified workflow type name> ます。</span><span class="sxs-lookup"><span data-stu-id="cfa38-150">The inner text of the \<value> tag is in the form of \<Workflow tag>=\<assembly-qualified workflow type name>.</span></span> <span data-ttu-id="cfa38-151">\<Workflow tag>は、でビジネスルールを作成するときに、ワークフローハンドラーアセンブリを識別するために使用する名前です [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] 。</span><span class="sxs-lookup"><span data-stu-id="cfa38-151">\<Workflow tag> is a name you use to identify the workflow handler assembly when you create a business rule in [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)].</span></span> <span data-ttu-id="cfa38-152">\<assembly-qualified workflow type name>は、ワークフロークラスの名前空間で修飾された名前で、その後にコンマが続き、その後にアセンブリの表示名が続きます。</span><span class="sxs-lookup"><span data-stu-id="cfa38-152">\<assembly-qualified workflow type name> is the namespace-qualified name of your workflow class, followed by a comma, followed by the display name of the assembly.</span></span> <span data-ttu-id="cfa38-153">アセンブリに厳密な名前が指定されている場合は、バージョン情報と PublicKeyToken も含める必要があります。</span><span class="sxs-lookup"><span data-stu-id="cfa38-153">If your assembly is strongly named, you also have to include version information and its PublicKeyToken.</span></span> <span data-ttu-id="cfa38-154">\<setting>さまざまな種類のワークフローに対して複数のワークフローハンドラーを作成した場合は、複数のタグを含めることができます。</span><span class="sxs-lookup"><span data-stu-id="cfa38-154">You can include multiple \<setting> tags if you have created multiple workflow handlers for different kinds of workflows.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="cfa38-155">サーバーの構成によっては、Microsoft.MasterDataServices.Workflow.exe.config ファイルを保存する際に、"アクセスが拒否されました" というエラーが返されることがあります。</span><span class="sxs-lookup"><span data-stu-id="cfa38-155">Depending on the configuration of your server, you may see an "Access is denied" error when you try to save the Microsoft.MasterDataServices.Workflow.exe.config file.</span></span> <span data-ttu-id="cfa38-156">その場合は、サーバー上のユーザー アカウント制御 (UAC) を一時的に無効にしてください。</span><span class="sxs-lookup"><span data-stu-id="cfa38-156">If this occurs, temporarily disable User Account Control (UAC) on the server.</span></span> <span data-ttu-id="cfa38-157">これを行うには、コントロール パネルを開き、**[システムとセキュリティ]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="cfa38-157">To do this, open Control Panel, click **System and Security**.</span></span> <span data-ttu-id="cfa38-158">**[アクション センター]** で、**[ユーザー アカウント制御設定の変更]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="cfa38-158">Under **Action Center**, click **Change User Account Control Settings**.</span></span> <span data-ttu-id="cfa38-159">**[ユーザー アカウント制御の設定]** ダイアログで、スライダー バーを一番下まで下げ、通知が返されないようにします。</span><span class="sxs-lookup"><span data-stu-id="cfa38-159">In the **User Account Control Settings** dialog, slide the bar to the bottom so that you are never notified.</span></span> <span data-ttu-id="cfa38-160">コンピューターを再起動し、上記の手順を繰り返して、構成ファイルを編集します。</span><span class="sxs-lookup"><span data-stu-id="cfa38-160">Restart your computer and repeat the preceding steps to edit your configuration file.</span></span> <span data-ttu-id="cfa38-161">ファイルを保存したら、UAC 設定を既定のレベルにリセットしてください。</span><span class="sxs-lookup"><span data-stu-id="cfa38-161">After saving the file, reset your UAC settings to the default level.</span></span>  
  
### <a name="start-sql-server-mds-workflow-integration-service"></a><span data-ttu-id="cfa38-162">SQL Server MDS Workflow Integration Service の開始</span><span class="sxs-lookup"><span data-stu-id="cfa38-162">Start SQL Server MDS Workflow Integration Service</span></span>  
 <span data-ttu-id="cfa38-163">既定では、SQL Server MDS Workflow Integration Service はインストールされていません。</span><span class="sxs-lookup"><span data-stu-id="cfa38-163">By default, SQL Server MDS Workflow Integration Service is not installed.</span></span> <span data-ttu-id="cfa38-164">使用する前に、まずこのサービスをインストールする必要があります。</span><span class="sxs-lookup"><span data-stu-id="cfa38-164">You must install the service before it can be used.</span></span> <span data-ttu-id="cfa38-165">最大限のセキュリティを確保するため、このサービス用のローカル ユーザーを作成し、そのユーザーに対して、ワークフロー操作の実行に必要な権限のみを付与してください。</span><span class="sxs-lookup"><span data-stu-id="cfa38-165">For the greatest security, create a local user for the service and grant this user only the permissions needed to perform workflow operations.</span></span> <span data-ttu-id="cfa38-166">ユーザーを作成し、サービスをインストールして、サービスを開始するには、次の手順を実行します。</span><span class="sxs-lookup"><span data-stu-id="cfa38-166">To create a user, install the service, and start the service, follow these steps:</span></span>  
  
1.  <span data-ttu-id="cfa38-167">[ローカル ユーザーとグループ] マネージャーを使用して、ローカル ユーザー (この例では mds_workflow_service) を作成します。</span><span class="sxs-lookup"><span data-stu-id="cfa38-167">Use the Local Users and Groups manager to create a local user named, for example, mds_workflow_service.</span></span>  
  
2.  <span data-ttu-id="cfa38-168">SQL Server Management Studio を使用して、mds_workflow_service ユーザーに、[mdm].[udpExternalActionsGet] ストアド プロシージャを実行する権限を付与します。</span><span class="sxs-lookup"><span data-stu-id="cfa38-168">Use SQL Server Management Studio to grant the mds_workflow_service user permission to execute the [mdm].[udpExternalActionsGet] stored procedure.</span></span> <span data-ttu-id="cfa38-169">これを行うには、mds_workflow_service アカウント用の新規ログインを作成し、[!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] データベース内に新規ユーザーを作成して、そのユーザーを mds_workflow_service ログインにマップした後、そのユーザーに、[mdm].[udpExternalActionsGet] ストアド プロシージャに対する EXECUTE 権限を付与します。</span><span class="sxs-lookup"><span data-stu-id="cfa38-169">To do this, create a new login for the mds_workflow_service account, create a new user in the [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] database, map this user to the mds_workflow_service login, and grant the user EXECUTE permission to the [mdm].[udpExternalActionsGet] stored procedure.</span></span>  
  
3.  <span data-ttu-id="cfa38-170">mds_workflow_service ユーザーに、ワークフロー ハンドラー アセンブリを実行する権限を付与します。</span><span class="sxs-lookup"><span data-stu-id="cfa38-170">Grant the mds_workflow_service user permission to execute the workflow handler assembly.</span></span> <span data-ttu-id="cfa38-171">これを行うには、ワークフロー ハンドラー アセンブリの **[プロパティ]** の **[セキュリティ]** タブに mds_workflow_service ユーザーを追加し、その mds_workflow_service ユーザーに、READ および EXECUTE アクセス許可を付与します。</span><span class="sxs-lookup"><span data-stu-id="cfa38-171">To do this, add the mds_workflow_service user to the **Security** tab of the **Properties** of the workflow handler assembly and grant the mds_workflow_service user READ and EXECUTE permission.</span></span>  
  
4.  <span data-ttu-id="cfa38-172">mds_workflow_service ユーザーに、SQL Server MDS Workflow Integration Service 実行可能ファイルを実行する権限を付与します。</span><span class="sxs-lookup"><span data-stu-id="cfa38-172">Grant the mds_workflow_service user permission to execute the SQL Server MDS Workflow Integration Service executable.</span></span> <span data-ttu-id="cfa38-173">これを行うには、mds_workflow_service ユーザーを Microsoft.MasterDataServices.Workflow.exe の [**プロパティ**] の [**セキュリティ**] タブの [マスターデータ services\webapplication\bin 内)] に追加 \<Your installation folder> し、MDS_WORKFLOW_SERVICE ユーザーに読み取りと実行のアクセス許可を付与します。</span><span class="sxs-lookup"><span data-stu-id="cfa38-173">To do this, add the mds_workflow_service user to the **Security** tab of the **Properties** of Microsoft.MasterDataServices.Workflow.exe, in \<Your installation folder>\Master Data Services\WebApplication\bin and grant the mds_workflow_service user READ and EXECUTE permission.</span></span>  
  
5.  <span data-ttu-id="cfa38-174">.NET インストール ユーティリティ (InstallUtil.exe) を使用して、SQL Server MDS Workflow Integration Service をインストールします。</span><span class="sxs-lookup"><span data-stu-id="cfa38-174">Install SQL Server MDS Workflow Integration Service by using the .NET installation utility, named InstallUtil.exe.</span></span> <span data-ttu-id="cfa38-175">InstallUtil.exe は、.NET インストール フォルダー (C:\Windows\Microsoft.NET\Framework\v4.0.30319\\ など) にあります。</span><span class="sxs-lookup"><span data-stu-id="cfa38-175">InstallUtil.exe can be found in the .NET installation folder, such as C:\Windows\Microsoft.NET\Framework\v4.0.30319\\.</span></span> <span data-ttu-id="cfa38-176">SQL Server MDS Workflow Integration Service は、管理者特権のコマンド プロンプトで次のコマンドを入力してインストールします。</span><span class="sxs-lookup"><span data-stu-id="cfa38-176">Install SQL Server MDS Workflow Integration Service by entering the following in an elevated command prompt:</span></span>  
  
    ```  
    C:\Windows\Microsoft.NET\Framework\v4.0.30319\InstallUtil Microsoft.MasterDataServices.Workflow.exe  
    ```  
  
     <span data-ttu-id="cfa38-177">インストール中にユーザーの指定を求められたら、mds_workflow_service ユーザーを指定します。</span><span class="sxs-lookup"><span data-stu-id="cfa38-177">Specify the mds_workflow_service user when prompted during installation.</span></span>  
  
6.  <span data-ttu-id="cfa38-178">サービス スナップインを使用して、SQL Server MDS Workflow Integration Service を開始します。</span><span class="sxs-lookup"><span data-stu-id="cfa38-178">Start SQL Server MDS Workflow Integration Service by using the Services snap-in.</span></span> <span data-ttu-id="cfa38-179">これを行うには、サービス スナップインで SQL Server MDS Workflow Integration Service を見つけて選択し、**[開始]** リンクをクリックします。</span><span class="sxs-lookup"><span data-stu-id="cfa38-179">To do this, find SQL Server MDS Workflow Integration Service in the Services snap-in, select it, and click the  **Start** link.</span></span>  
  
### <a name="create-a-workflow-business-rule"></a><span data-ttu-id="cfa38-180">ワークフロー ビジネス ルールの作成</span><span class="sxs-lookup"><span data-stu-id="cfa38-180">Create a Workflow Business Rule</span></span>  
 <span data-ttu-id="cfa38-181">[!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] を使用して、適用時にワークフローを開始するビジネス ルールを作成およびパブリッシュします。</span><span class="sxs-lookup"><span data-stu-id="cfa38-181">Use [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] to create and publish a business rule that will start the workflow when applied.</span></span> <span data-ttu-id="cfa38-182">ビジネス ルールには、属性値を変更するアクションを必ず含めて、そのルールが一度適用された後、false と評価されるようにしてください。</span><span class="sxs-lookup"><span data-stu-id="cfa38-182">You should ensure that your business rule contains actions that change attribute values, so that the rule evaluates to false after it has been applied once.</span></span> <span data-ttu-id="cfa38-183">たとえば、Price 属性値が 500 より大きく、Approved 属性値が空白の場合に、true と評価されるビジネス ルールがあるとします。</span><span class="sxs-lookup"><span data-stu-id="cfa38-183">For example, your business rule might evaluate to true when a Price attribute value is greater than 500 and the Approved attribute value is blank.</span></span> <span data-ttu-id="cfa38-184">その場合、そのルールに次の 2 つのアクションを含めることができます。1 つは、Approved 属性値を Pending に設定するアクション。もう 1 つは、ワークフローを開始するアクションです。</span><span class="sxs-lookup"><span data-stu-id="cfa38-184">The rule can then include two actions: one to set the Approved attribute value to Pending and one to start the workflow.</span></span> <span data-ttu-id="cfa38-185">また、"が変更されている" 条件を使用するルールを作成し、追跡グループを変更するための属性を追加する方法もあります。</span><span class="sxs-lookup"><span data-stu-id="cfa38-185">Alternatively, you may want to create a rule that uses the "has changed" condition and add your attributes to change tracking groups.</span></span> <span data-ttu-id="cfa38-186">ビジネス ルールの詳細については、「[ビジネス ルール &#40;マスター データ サービス&#41;](../business-rules-master-data-services.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="cfa38-186">For more information about business rules, see [Business Rules &#40;Master Data Services&#41;](../business-rules-master-data-services.md).</span></span>  
  
 <span data-ttu-id="cfa38-187">カスタム ワークフローを開始するビジネス ルールを [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] で作成するには、次の手順を実行します。</span><span class="sxs-lookup"><span data-stu-id="cfa38-187">Create a business rule that starts a custom workflow in [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] by following these steps:</span></span>  
  
1.  <span data-ttu-id="cfa38-188">[!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] のビジネス ルール エディターで、ビジネス ルールの条件を指定した後に、**ワークフローの開始**アクションを **[外部アクション]** ボックスの一覧から **[THEN]** ペインの **[アクション]** ラベルにドラッグします。</span><span class="sxs-lookup"><span data-stu-id="cfa38-188">In the business rule editor of [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)], after you have specified the conditions of your business rule, drag the **Start Workflow** action from the **External actions** list to the **THEN** pane's **Action** label.</span></span>  
  
2.  <span data-ttu-id="cfa38-189">**[アクションの編集]** ペインの **[ワークフローの種類]** ボックスに、ワークフロー ハンドラー アセンブリを識別するタグを入力します。</span><span class="sxs-lookup"><span data-stu-id="cfa38-189">In the **Edit Action** pane, in the **Workflow type** box, type the tag that identifies your workflow handler assembly.</span></span> <span data-ttu-id="cfa38-190">これは、アセンブリの構成ファイルで指定したタグです (例: TEST)。</span><span class="sxs-lookup"><span data-stu-id="cfa38-190">This is the tag you specified in the configuration file for your assembly, for example, TEST.</span></span>  
  
3.  <span data-ttu-id="cfa38-191">必要に応じて、**[メッセージにメンバーのデータを含める]** チェック ボックスをオンにします。</span><span class="sxs-lookup"><span data-stu-id="cfa38-191">Optionally, select the **Include member data** check box.</span></span> <span data-ttu-id="cfa38-192">これをオンにすると、ワークフロー ハンドラーに渡される XML に、属性の名前と値が含められます。</span><span class="sxs-lookup"><span data-stu-id="cfa38-192">Choose this to include attribute names and values in the XML that is passed to the workflow handler.</span></span>  
  
4.  <span data-ttu-id="cfa38-193">**[ワークフロー サイト]** ボックスに、Web サイトの名前を入力します。</span><span class="sxs-lookup"><span data-stu-id="cfa38-193">In the **Workflow site** box, type the name of a website.</span></span> <span data-ttu-id="cfa38-194">これは、使用するカスタム ワークフローには該当しない場合がありますが、追加のコンテキスト用に使用できます。</span><span class="sxs-lookup"><span data-stu-id="cfa38-194">For your custom workflow this may not apply, but can be used for added context.</span></span>  
  
5.  <span data-ttu-id="cfa38-195">**[ワークフロー名]** ボックスに、Visual Studio からのワークフローの名前を入力します。</span><span class="sxs-lookup"><span data-stu-id="cfa38-195">In the **Workflow name** box, type the name of your workflow from Visual Studio.</span></span> <span data-ttu-id="cfa38-196">これは、使用するカスタム ワークフローには該当しない場合がありますが、追加のコンテキスト用に使用できます。</span><span class="sxs-lookup"><span data-stu-id="cfa38-196">For your custom workflow this may not apply, but can be used for added context.</span></span>  
  
6.  <span data-ttu-id="cfa38-197">ビジネス ルールを作成およびパブリッシュします。</span><span class="sxs-lookup"><span data-stu-id="cfa38-197">Save and publish the business rule.</span></span>  
  
### <a name="apply-business-rules-to-start-a-workflow"></a><span data-ttu-id="cfa38-198">ビジネス ルールを適用してワークフローを開始する</span><span class="sxs-lookup"><span data-stu-id="cfa38-198">Apply Business Rules to Start a Workflow</span></span>  
 <span data-ttu-id="cfa38-199">データにビジネス ルールを適用して、ワークフローを開始します。</span><span class="sxs-lookup"><span data-stu-id="cfa38-199">Apply the business rule to your data to start the workflow.</span></span> <span data-ttu-id="cfa38-200">これを行うには、[!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] を使用して、検証するメンバーを含んだエンティティを編集します。</span><span class="sxs-lookup"><span data-stu-id="cfa38-200">To do this, use [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] to edit the entity that contains the members you want to validate.</span></span> <span data-ttu-id="cfa38-201">**[ビジネス ルールの適用]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="cfa38-201">Click **Apply business rules**.</span></span> <span data-ttu-id="cfa38-202">ビジネス ルールへの応答として、[!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] は、[!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] データベースの Service Broker キューに値を設定します。</span><span class="sxs-lookup"><span data-stu-id="cfa38-202">In response to the business rule, [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] populates the Service Broker queue of the [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] database.</span></span> <span data-ttu-id="cfa38-203">SQL Server MDS Workflow Integration Service は、キューをチェックすると、指定されたワークフロー ハンドラー アセンブリにデータを送信し、キューをクリアします。</span><span class="sxs-lookup"><span data-stu-id="cfa38-203">When SQL Server MDS Workflow Integration Service checks the queue, it sends the data to the specified workflow handler assembly and clears the queue.</span></span> <span data-ttu-id="cfa38-204">ワークフロー ハンドラー アセンブリは、コードに記述された任意のアクションを実行します。</span><span class="sxs-lookup"><span data-stu-id="cfa38-204">The workflow handler assembly performs whatever actions you have coded into it.</span></span>  
  
## <a name="troubleshoot-custom-workflows"></a><span data-ttu-id="cfa38-205">カスタム ワークフローのトラブルシューティング</span><span class="sxs-lookup"><span data-stu-id="cfa38-205">Troubleshoot Custom Workflows</span></span>  
 <span data-ttu-id="cfa38-206">ワークフロー ハンドラー アセンブリがデータを受け取らなかった場合は、SQL Server MDS Workflow Integration Service をデバッグするか、または Service Broker キューを表示してみることができます。</span><span class="sxs-lookup"><span data-stu-id="cfa38-206">If your workflow handler assembly doesn't receive data, you can try debugging SQL Server MDS Workflow Integration Service or viewing the Service Broker queue.</span></span>  
  
### <a name="debug-sql-server-mds-workflow-integration-service"></a><span data-ttu-id="cfa38-207">SQL Server MDS Workflow Integration Service のデバッグ</span><span class="sxs-lookup"><span data-stu-id="cfa38-207">Debug SQL Server MDS Workflow Integration Service</span></span>  
 <span data-ttu-id="cfa38-208">SQL Server Workflow Integration Service をデバッグするには、次の手順に従います。</span><span class="sxs-lookup"><span data-stu-id="cfa38-208">To debug SQL Server Workflow Integration Service, take the following steps:</span></span>  
  
1.  <span data-ttu-id="cfa38-209">サービス スナップインを使用して、サービスを停止します。</span><span class="sxs-lookup"><span data-stu-id="cfa38-209">Use the Services snap-in to stop the service.</span></span>  
  
2.  <span data-ttu-id="cfa38-210">コマンド プロンプトを開き、サービスの場所に移動した後、コマンド Microsoft.MasterDataServices.Workflow.exe -console を入力してサービスをコンソール モードで実行します。</span><span class="sxs-lookup"><span data-stu-id="cfa38-210">Open a command prompt, navigate to the location of the service, and run the service in console mode by entering: Microsoft.MasterDataServices.Workflow.exe -console.</span></span>  
  
3.  <span data-ttu-id="cfa38-211">[!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] で、メンバーを更新し、ビジネス ルールを再度適用します。</span><span class="sxs-lookup"><span data-stu-id="cfa38-211">In [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)], update your member and apply business rules again.</span></span> <span data-ttu-id="cfa38-212">詳細なログがコンソール ウィンドウに表示されます。</span><span class="sxs-lookup"><span data-stu-id="cfa38-212">Detailed logs are displayed in the console window.</span></span>  
  
### <a name="view-the-service-broker-queue"></a><span data-ttu-id="cfa38-213">Service Broker キューの表示</span><span class="sxs-lookup"><span data-stu-id="cfa38-213">View the Service Broker Queue</span></span>  
 <span data-ttu-id="cfa38-214">ワークフローの一部として渡されるマスター データを含んだ Service Broker キューは、mdm.microsoft/mdm/queue/externalaction です。</span><span class="sxs-lookup"><span data-stu-id="cfa38-214">The Service Broker queue that contains the master data passed as part of the workflow is: mdm.microsoft/mdm/queue/externalaction.</span></span> <span data-ttu-id="cfa38-215">キューは、SQL Management Studio の **[オブジェクト エクスプローラー]** で、[!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] データベースの Service Broker ノードに表示されます。</span><span class="sxs-lookup"><span data-stu-id="cfa38-215">Queues can be found in the **Object Explorer** of SQL Management Studio under the Service Broker node of the [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] database.</span></span> <span data-ttu-id="cfa38-216">ただし、サービスがキューを適切にクリアした場合、このキューは空になります。</span><span class="sxs-lookup"><span data-stu-id="cfa38-216">Be aware that, if the service cleared the queue properly, this queue will be empty.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="cfa38-217">参照</span><span class="sxs-lookup"><span data-stu-id="cfa38-217">See Also</span></span>  
 <span data-ttu-id="cfa38-218">[カスタムワークフローの例 &#40;マスターデータサービス&#41;](create-a-custom-workflow-example.md) </span><span class="sxs-lookup"><span data-stu-id="cfa38-218">[Custom Workflow Example &#40;Master Data Services&#41;](create-a-custom-workflow-example.md) </span></span>  
 [<span data-ttu-id="cfa38-219">カスタム ワークフロー XML の説明 &#40;Master Data Services&#41;</span><span class="sxs-lookup"><span data-stu-id="cfa38-219">Custom Workflow XML Description &#40;Master Data Services&#41;</span></span>](create-a-custom-workflow-xml-description.md)  
  
  
