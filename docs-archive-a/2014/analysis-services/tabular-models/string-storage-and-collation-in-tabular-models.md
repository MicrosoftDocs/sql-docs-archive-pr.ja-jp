---
title: テーブルモデルの文字列ストレージと照合順序 |Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: analysis-services
ms.topic: conceptual
ms.assetid: 8516f0ad-32ee-4688-a304-e705143642ca
author: minewiskan
ms.author: owend
ms.openlocfilehash: 3aad4cf16c39897bc0796f4fb161eaf39abdb5fd
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87738820"
---
# <a name="string-storage-and-collation-in-tabular-models"></a><span data-ttu-id="48541-102">テーブル モデルの文字列ストレージと照合順序</span><span class="sxs-lookup"><span data-stu-id="48541-102">String Storage and Collation in Tabular Models</span></span>
  <span data-ttu-id="48541-103">文字列 (テキスト値) は高度に圧縮された形式でテーブル モデルに格納されます。この圧縮により、文字列の全体または一部を取得するときに予期しない結果を取得することがあります。</span><span class="sxs-lookup"><span data-stu-id="48541-103">Strings (text values) are stored in a highly compressed format in tabular models; because of this compression, you can get unexpected results when you retrieve entire or partial strings.</span></span> <span data-ttu-id="48541-104">文字列のロケールと照合順序は最も近い親プロジェクトから階層的に継承されるため、文字列の言語が明示的に定義されていない場合、親のロケールと照合順序は、文字列の格納方法、および文字列が一意であるか親の照合順序の定義に従って同様の文字列と結合されるかに影響することがあります。</span><span class="sxs-lookup"><span data-stu-id="48541-104">Also, because string locale and collations are inherited hierarchically from the closest parent object, if the string language is not explicitly defined, the locale and collation of the parent can affect how each string is stored and whether the string is unique or conflated with similar strings as defined by the parent collation.</span></span>  
  
 <span data-ttu-id="48541-105">このトピックでは、文字列を圧縮および格納するメカニズムについて説明し、照合順序と言語がテーブル モデルのテキスト式の結果に与える影響の例を示します。</span><span class="sxs-lookup"><span data-stu-id="48541-105">This topic describes the mechanism by which strings are compressed and stored, and provides examples of how collation and language affect the results of text formulas in tabular models.</span></span>  
  
## <a name="storage"></a><span data-ttu-id="48541-106">ストレージ</span><span class="sxs-lookup"><span data-stu-id="48541-106">Storage</span></span>  
 <span data-ttu-id="48541-107">テーブル モデルでは、すべてのデータがより効率よくメモリに収まるように高度に圧縮されます。</span><span class="sxs-lookup"><span data-stu-id="48541-107">In tabular models all data is highly compressed to better fit in memory.</span></span> <span data-ttu-id="48541-108">その結果、構文的に等価と見なされるすべての文字列が 1 回だけ格納されます。</span><span class="sxs-lookup"><span data-stu-id="48541-108">As a consequence, all strings that can be considered lexically equivalent are stored only once.</span></span> <span data-ttu-id="48541-109">文字列の最初のインスタンスが正規表現として使用され、等価な各文字列は最初の出現と同じ圧縮値にインデックス付けされます。</span><span class="sxs-lookup"><span data-stu-id="48541-109">The first instance of the string is used as the canonical representation and thereafter each equivalent string is indexed to the same compressed value as the first occurrence.</span></span>  
  
 <span data-ttu-id="48541-110">重要な問題は、構文的に等価な文字列を構成するものは何かということです。</span><span class="sxs-lookup"><span data-stu-id="48541-110">The key question is: what constitutes a lexically equivalent string?</span></span> <span data-ttu-id="48541-111">2 つの文字列は、同じ単語と見なされる場合に構文的に等価と見なされます。</span><span class="sxs-lookup"><span data-stu-id="48541-111">Two strings are considered lexically equivalent if they can be considered as the same word.</span></span> <span data-ttu-id="48541-112">たとえば、英語では、 **violin** という単語を辞書で検索すると、辞書の編集方針に応じて **Violin** または **violin**というエントリが見つかりますが、一般にはどちらの単語も等価と見なされ、大文字と小文字の違いは無視されます。</span><span class="sxs-lookup"><span data-stu-id="48541-112">For example, in English when you search for the word **violin** in a dictionary, you might find the entry **Violin** or **violin**, depending on the editorial policy of the dictionary, but generally you consider both words equivalent, and disregard the difference in capitalization.</span></span> <span data-ttu-id="48541-113">テーブル モデルでは、2 つの文字列が構文的に等価であるかどうかを決定する要因は、編集方針やユーザー設定ではなく、列に割り当てられたロケールと照合順序です。</span><span class="sxs-lookup"><span data-stu-id="48541-113">In a tabular model, the factor that determines whether two strings are lexically equivalent is not editorial policy or even user preference, but the locale and collation order assigned to the column.</span></span>  
  
 <span data-ttu-id="48541-114">したがって、大文字と小文字を同じものとして扱うか異なるものとして扱うかは、照合順序とロケールによって決まります。</span><span class="sxs-lookup"><span data-stu-id="48541-114">Therefore, the decision of whether uppercase and lowercase letters should be handled as the same or different depends on the collation and locale.</span></span> <span data-ttu-id="48541-115">ロケール内の単語について、特定の列内に最初に見つかったため単語および文字列の正規表現として使用される単語が非圧縮形式で格納されます。</span><span class="sxs-lookup"><span data-stu-id="48541-115">For any particular word within that locale, the first occurrence of the word that is found within a particular column therefore serves as the canonical representation of that word and that string is stored in uncompressed format.</span></span>  <span data-ttu-id="48541-116">他のすべての文字列は最初の出現に照らしてテストされ、等価テストで一致した場合は最初の出現の圧縮値に割り当てられます。</span><span class="sxs-lookup"><span data-stu-id="48541-116">All other strings are tested against the first occurrence, and if they match the equivalence test, they are assigned to the compressed value of the first occurrence.</span></span> <span data-ttu-id="48541-117">後で圧縮値が取得されるときに、それらの圧縮値は文字列の最初の出現の非圧縮値を使用して表現されます。</span><span class="sxs-lookup"><span data-stu-id="48541-117">Later, when the compressed values are retrieved they are represented using the uncompressed value of the first occurrence of the string.</span></span>  
  
 <span data-ttu-id="48541-118">このしくみを明確にするのには例が役立ちます。</span><span class="sxs-lookup"><span data-stu-id="48541-118">An example will help to clarify how this works.</span></span> <span data-ttu-id="48541-119">次の「分類 - 英語」列は、植物と木の情報を含むテーブルから抽出しました。</span><span class="sxs-lookup"><span data-stu-id="48541-119">The following column "Classification - English" was extracted from a table that contains information about plants and trees.</span></span> <span data-ttu-id="48541-120">各植物 (ここでは植物の名前を示しません) について、分類列に植物の一般カテゴリが示されます。</span><span class="sxs-lookup"><span data-stu-id="48541-120">For each plant (the names of the plants are not shown here) the classification column shows the general category of plant.</span></span>  
  
|<span data-ttu-id="48541-121">分類 - 英語</span><span class="sxs-lookup"><span data-stu-id="48541-121">Classification - English</span></span>|  
|-------------------------------|  
|<span data-ttu-id="48541-122">trEE</span><span class="sxs-lookup"><span data-stu-id="48541-122">trEE</span></span>|  
|<span data-ttu-id="48541-123">PlAnT</span><span class="sxs-lookup"><span data-stu-id="48541-123">PlAnT</span></span>|  
|<span data-ttu-id="48541-124">trEE</span><span class="sxs-lookup"><span data-stu-id="48541-124">TREE</span></span>|  
|<span data-ttu-id="48541-125">PlAnT</span><span class="sxs-lookup"><span data-stu-id="48541-125">PLANT</span></span>|  
|<span data-ttu-id="48541-126">Plant (植物)</span><span class="sxs-lookup"><span data-stu-id="48541-126">Plant</span></span>|  
|<span data-ttu-id="48541-127">ツリー</span><span class="sxs-lookup"><span data-stu-id="48541-127">Tree</span></span>|  
|<span data-ttu-id="48541-128">PlAnT</span><span class="sxs-lookup"><span data-stu-id="48541-128">plant</span></span>|  
|<span data-ttu-id="48541-129">trEE</span><span class="sxs-lookup"><span data-stu-id="48541-129">tReE</span></span>|  
|<span data-ttu-id="48541-130">tree</span><span class="sxs-lookup"><span data-stu-id="48541-130">tree</span></span>|  
|<span data-ttu-id="48541-131">PlAnT</span><span class="sxs-lookup"><span data-stu-id="48541-131">pLaNt</span></span>|  
|<span data-ttu-id="48541-132">trEE</span><span class="sxs-lookup"><span data-stu-id="48541-132">tREE</span></span>|  
  
 <span data-ttu-id="48541-133">データは多くの異なるソースから取得される可能性が高いため、大文字と小文字の違いやアクセントの使用には一貫性がなく、リレーショナル データベースにはこれらの違いがそのまま格納されています。</span><span class="sxs-lookup"><span data-stu-id="48541-133">Perhaps the data came from many different sources, and so the casing and use of accents was inconsistent, and the relational database stored those differences as is.</span></span> <span data-ttu-id="48541-134">ただし、一般に値は **Plant** または **Tree**であり、大文字と小文字のみ異なります。</span><span class="sxs-lookup"><span data-stu-id="48541-134">But in general the values are either **Plant** or **Tree**, just with different casing.</span></span>  
  
 <span data-ttu-id="48541-135">これらの値が、英語 (米国) の既定の照合順序と並べ替え順序を使用する表形式モデルに読み込まれる場合、大文字と小文字は区別されません。そのため、列全体に対して格納される値は2つだけです。</span><span class="sxs-lookup"><span data-stu-id="48541-135">When these values are loaded into a tabular model that uses the default collation and sorting order for English (United States), case is not important, so only two values would be stored for the entire column:</span></span>  
  
|<span data-ttu-id="48541-136">分類 - 英語</span><span class="sxs-lookup"><span data-stu-id="48541-136">Classification - English</span></span>|  
|-------------------------------|  
|<span data-ttu-id="48541-137">trEE</span><span class="sxs-lookup"><span data-stu-id="48541-137">trEE</span></span>|  
|<span data-ttu-id="48541-138">PlAnT</span><span class="sxs-lookup"><span data-stu-id="48541-138">PlAnT</span></span>|  
  
 <span data-ttu-id="48541-139">モデルで [**分類-英語**] という列を使用する場合、プラント分類を表示すると、元の値は表示されず、大文字と小文字は使用されますが、最初のインスタンスのみが表示されます。</span><span class="sxs-lookup"><span data-stu-id="48541-139">If you use the column, **Classification - English**, in your model, wherever you display plant classification you will see not the original values, with their various uses of upper and lower case, but only the first instance.</span></span> <span data-ttu-id="48541-140">その理由は、この照合順序とロケールでは **tree** の大文字と小文字のすべてのバリエーションが等価と見なされるため、1 つの文字列のみ保持され、システムで検出されたその文字列の最初のインスタンスが保存されるためです。</span><span class="sxs-lookup"><span data-stu-id="48541-140">The reason is that all the uppercase and lowercase variants of **tree** are considered equivalent in this collation and locale; therefore, only one string was preserved and the first instance of that string that is encountered by the system is the one that is saved.</span></span>  
  
> [!WARNING]  
>  <span data-ttu-id="48541-141">適切と思われる文字列に応じて格納する最初の文字列を定義することもできますが、この処理は非常に困難な可能性があります。</span><span class="sxs-lookup"><span data-stu-id="48541-141">You might decide that you want to define which string will be the first to store, according to what you consider correct, but this could be very hard to so.</span></span> <span data-ttu-id="48541-142">すべての値が同じと見なされる場合に、エンジンによって最初に処理される行をあらかじめ決定する簡単な方法はありません。</span><span class="sxs-lookup"><span data-stu-id="48541-142">There is no simple way to determine in advance which row should be processed first by the engine, given that all values are considered to be the same.</span></span> <span data-ttu-id="48541-143">代わりに、標準値を設定する必要がある場合は、モデルを読み込む前にすべての文字列をクレンジングする必要があります。</span><span class="sxs-lookup"><span data-stu-id="48541-143">Instead, if you need to set the standard value, you should cleanse all your strings before loading the model.</span></span>  
  
## <a name="locale-and-collation-order"></a><span data-ttu-id="48541-144">ロケールと照合順序</span><span class="sxs-lookup"><span data-stu-id="48541-144">Locale and Collation Order</span></span>  
 <span data-ttu-id="48541-145">文字列 (テキスト値) を比較する場合、一般に等価性は文字列が解釈される方法のカルチャによって定義されます。</span><span class="sxs-lookup"><span data-stu-id="48541-145">When comparing strings (text values), what defines equivalence is normally the cultural aspect of how such strings are interpreted.</span></span> <span data-ttu-id="48541-146">一部のカルチャでは、文字のアクセントや大文字と小文字の違いによって文字列の意味がまったく異なる場合があるため、通常、特定の言語や地域に対して等価性を判断するときにはこのような違いが考慮されます。</span><span class="sxs-lookup"><span data-stu-id="48541-146">In some cultures an accent or the capitalization of a character can completely change the meaning of the string; therefore, typically such differences are considered when determining equivalency for any particular language or region.</span></span>  
  
 <span data-ttu-id="48541-147">通常、コンピューターを使用する場合、コンピューターは独自のカルチャによる要請や言語の動作と一致するように既に構成されており、テキスト値の並べ替えや比較などの文字列操作は期待どおりに動作します。</span><span class="sxs-lookup"><span data-stu-id="48541-147">Usually, when you use your computer it is already configured to match your own cultural expectations and linguistic behavior, and string operations such as sorting and comparing text values behaves as you would expect.</span></span> <span data-ttu-id="48541-148">言語固有の動作を制御する設定は、Windows の **地域と言語** の設定で定義します。</span><span class="sxs-lookup"><span data-stu-id="48541-148">The settings that control language-specific behavior are defined through the **Locale and Regional** settings in Windows.</span></span> <span data-ttu-id="48541-149">アプリケーションはこれらの設定を読み取り、この設定に従って動作を変更します。</span><span class="sxs-lookup"><span data-stu-id="48541-149">Applications read those settings and change their behavior accordingly.</span></span> <span data-ttu-id="48541-150">場合によっては、アプリケーションに、アプリケーションのカルチャ動作または文字列の比較方法を変更できる機能があります。</span><span class="sxs-lookup"><span data-stu-id="48541-150">In some cases, an application might have a feature that allows you to change the cultural behavior of the application or the way in which strings are compared.</span></span>  
  
 <span data-ttu-id="48541-151">テーブル モデル データベースの作成時に、データベースは既定でこれらのカルチャおよび言語設定を言語識別子と照合順序の形式で継承します。</span><span class="sxs-lookup"><span data-stu-id="48541-151">When you are creating a tabular model database, by default the database inherits these cultural and linguistic settings in the form of a language identifier and collation.</span></span>  
  
-   <span data-ttu-id="48541-152">言語識別子では、文字列に使用する文字セットがカルチャに従って定義されます。</span><span class="sxs-lookup"><span data-stu-id="48541-152">The language identifier defines the character set you want to use for your strings according to your culture.</span></span>  
  
-   <span data-ttu-id="48541-153">照合順序では、文字の順序とその等価性が定義されます。</span><span class="sxs-lookup"><span data-stu-id="48541-153">The collation defines the ordering of the characters and their equivalence.</span></span>  
  
 <span data-ttu-id="48541-154">言語識別子は言語を識別するだけでなく、言語が使用されている国または地域も識別することに注意してください。</span><span class="sxs-lookup"><span data-stu-id="48541-154">It is important to note that a language identifier not only identifies a language but, also the country or region where the language is used.</span></span> <span data-ttu-id="48541-155">各言語識別子には、既定の照合順序も指定されています。</span><span class="sxs-lookup"><span data-stu-id="48541-155">Each language identifier also has a default collation specification.</span></span> <span data-ttu-id="48541-156">言語識別子の詳細については、「 [Microsoft によって割り当てられているロケール ID](https://msdn.microsoft.com/goglobal/bb964664.aspx)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="48541-156">For more information about language identifiers, see [Locale IDs Assigned by Microsoft](https://msdn.microsoft.com/goglobal/bb964664.aspx).</span></span> <span data-ttu-id="48541-157">LCID Dec 列を使用して、値を手動で挿入するときに適切な ID を取得できます。</span><span class="sxs-lookup"><span data-stu-id="48541-157">You can use the LCID Dec column to get the correct ID when manually inserting a value.</span></span> <span data-ttu-id="48541-158">SQL での照合順序の概念の詳細については、「[COLLATE &#40;Transact-SQL&#41;](/sql/t-sql/statements/collations)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="48541-158">For more information about the SQL concept of collations, see [COLLATE &#40;Transact-SQL&#41;](/sql/t-sql/statements/collations).</span></span> <span data-ttu-id="48541-159">Windows の照合順序名の照合順序指定子および比較スタイルの詳細については、「[Windows 照合順序名 &#40;Transact-SQL&#41;](/sql/t-sql/statements/windows-collation-name-transact-sql)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="48541-159">For information about the collation designators and the comparison styles for Windows collation names, see [Windows Collation Name &#40;Transact-SQL&#41;](/sql/t-sql/statements/windows-collation-name-transact-sql).</span></span> <span data-ttu-id="48541-160">「[SQL Server 照合順序名 &#40;Transact-SQL&#41;](/sql/t-sql/statements/sql-server-collation-name-transact-sql)」のトピックでは、Windows 照合順序名を SQL で使用される名前にマップします。</span><span class="sxs-lookup"><span data-stu-id="48541-160">The topic, [SQL Server Collation Name &#40;Transact-SQL&#41;](/sql/t-sql/statements/sql-server-collation-name-transact-sql), maps the Windows collation names to the names used for SQL.</span></span>  
  
 <span data-ttu-id="48541-161">テーブル モデル データベースの作成後に、モデル内のすべての新規オブジェクトが言語および照合順序の属性をデータベースの属性から継承します。</span><span class="sxs-lookup"><span data-stu-id="48541-161">Once your tabular model database has been created, all new objects in the model will inherit the language and collation attributes from the database attributes.</span></span> <span data-ttu-id="48541-162">これは、すべてのオブジェクトに適用されます。</span><span class="sxs-lookup"><span data-stu-id="48541-162">This is true for all objects.</span></span> <span data-ttu-id="48541-163">継承パスはオブジェクトから開始し、継承する言語および照合順序の属性の親を参照し、何も見つからない場合は一番上まで進んでデータベース レベルの言語および照合順序の属性を探します。</span><span class="sxs-lookup"><span data-stu-id="48541-163">The inheritance path begins at the object, looks at the parent for any language and collation attributes to inherit, and if none are found, continues to the top and finds the language and collation attributes at the database level.</span></span> <span data-ttu-id="48541-164">つまり、オブジェクトの言語および照合順序の属性を指定しない場合、オブジェクトは既定でその最も近い親から属性を継承します。</span><span class="sxs-lookup"><span data-stu-id="48541-164">In other words, if you do not specify the language and collation attributes for an object, by default, the object inherits the attributes of its closest parent.</span></span>  
  
 <span data-ttu-id="48541-165">列の場合、言語および照合順序の属性は次のルールに従って作成時に継承されます。</span><span class="sxs-lookup"><span data-stu-id="48541-165">For columns, the language and collation attributes are inherited at creation, according to the following rules:</span></span>  
  
1.  <span data-ttu-id="48541-166">親ディメンション オブジェクトで言語および照合順序の属性が検索されます。</span><span class="sxs-lookup"><span data-stu-id="48541-166">The parent dimension object is searched for language and collation attributes.</span></span> <span data-ttu-id="48541-167">両方の値が存在する場合は、それらが列の属性にコピーされます。一方のみ存在する場合、他方は既存の属性から継承され、両方が割り当てられます。両方とも存在しない場合は次の手順に進みます。</span><span class="sxs-lookup"><span data-stu-id="48541-167">If both values exist, they are copied to the column attributes; if only one exists, the other is inferred from the existing one and both are assigned; if none exist, move to next step.</span></span>  
  
2.  <span data-ttu-id="48541-168">手順 1. でディメンションについて説明したのと同じプロセスを使用してデータベース オブジェクトが検索されます。属性が見つからない場合は、次の手順に進みます。</span><span class="sxs-lookup"><span data-stu-id="48541-168">The database object is searched using the same process described in Step 1 for dimensions; if no attributes are found, move to the next step.</span></span>  
  
3.  <span data-ttu-id="48541-169">手順 1. でディメンションについて説明したのと同じプロセスを使用してサーバー オブジェクトが検索されます。属性が見つからない場合、列では Windows 言語識別子が使用され、その値の照合順序属性が推測されます。</span><span class="sxs-lookup"><span data-stu-id="48541-169">The server object is searched using the same process described in Step 1 for dimensions; if no attributes are found, the column uses the Windows language identifier and infers the collation attribute from that value.</span></span>  
  
 <span data-ttu-id="48541-170">通常、ソース データベースでの言語識別子と照合順序はテーブル モデルの列に値が格納される方法にほとんど影響しないかまったく影響しないことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="48541-170">It is important to note that typically the language identifier and collation order in the source database has little to no effect on how values are stored in the tabular model column.</span></span> <span data-ttu-id="48541-171">例外は、ソース データベースが要求された値を変換またはフィルター選択する場合です。</span><span class="sxs-lookup"><span data-stu-id="48541-171">The exception is if the source database transforms or filters the requested values.</span></span>  
  
  
