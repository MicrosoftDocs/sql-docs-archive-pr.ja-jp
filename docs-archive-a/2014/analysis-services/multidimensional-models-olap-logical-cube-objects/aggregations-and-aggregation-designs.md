---
title: 集計と集計のデザイン |Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: analysis-services
ms.topic: reference
helpviewer_keywords:
- aggregations [Analysis Services], about aggregations
- storage [Analysis Services], aggregations
- Storage Design Wizard
- data summary [Analysis Services]
- data storage [Analysis Services]
- storing data [Analysis Services], aggregations
- aggregations [Analysis Services]
ms.assetid: 35bd8589-39fa-4e0b-b28f-5a07d70da0a2
author: minewiskan
ms.author: owend
ms.openlocfilehash: c56e80482ef71e8041f8518ae9901691a1809990
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87715833"
---
# <a name="aggregations-and-aggregation-designs"></a><span data-ttu-id="60d9b-102">集計と集計デザイン</span><span class="sxs-lookup"><span data-stu-id="60d9b-102">Aggregations and Aggregation Designs</span></span>
  <span data-ttu-id="60d9b-103"><xref:Microsoft.AnalysisServices.AggregationDesign> オブジェクトは、複数のパーティションで共有できる集計定義のセットを定義します。</span><span class="sxs-lookup"><span data-stu-id="60d9b-103">An <xref:Microsoft.AnalysisServices.AggregationDesign> object defines a set of aggregation definitions that can be shared across multiple partitions.</span></span>  
  
 <span data-ttu-id="60d9b-104"><xref:Microsoft.AnalysisServices.Aggregation> オブジェクトは、メジャー グループ データの概要を、ディメンションの特定の粒度で表します。</span><span class="sxs-lookup"><span data-stu-id="60d9b-104">An <xref:Microsoft.AnalysisServices.Aggregation> object represents the summarization of measure group data at certain granularity of the dimensions.</span></span>  
  
 <span data-ttu-id="60d9b-105">簡単な <xref:Microsoft.AnalysisServices.Aggregation> オブジェクトは、基本情報およびディメンションで構成されます。</span><span class="sxs-lookup"><span data-stu-id="60d9b-105">A simple <xref:Microsoft.AnalysisServices.Aggregation> object is composed of: basic information and dimensions.</span></span> <span data-ttu-id="60d9b-106">基本情報には、集計の名前、ID、注釈、および説明が含まれます。</span><span class="sxs-lookup"><span data-stu-id="60d9b-106">Basic information includes the name of the aggregation, the ID, annotations, and a description.</span></span> <span data-ttu-id="60d9b-107">ディメンションは、ディメンションの粒度属性の一覧を含む <xref:Microsoft.AnalysisServices.AggregationDimension> オブジェクトのコレクションです。</span><span class="sxs-lookup"><span data-stu-id="60d9b-107">The dimensions are a collection of <xref:Microsoft.AnalysisServices.AggregationDimension> objects that contain the list of granularity attributes for the dimension.</span></span>  
  
 <span data-ttu-id="60d9b-108">集計とは、事前に計算されたリーフ セル データを要約したものです。</span><span class="sxs-lookup"><span data-stu-id="60d9b-108">Aggregations are precalculated summaries of data from leaf cells.</span></span> <span data-ttu-id="60d9b-109">集計により、質問の回答があらかじめ用意されているので、クエリの応答時間を短縮できます。</span><span class="sxs-lookup"><span data-stu-id="60d9b-109">Aggregations improve query response time by preparing the answers before the questions are asked.</span></span> <span data-ttu-id="60d9b-110">たとえば、何千行も蓄積されているデータ ウェアハウスのファクト テーブルから特定の製品ラインの週間売上合計を要求するクエリがあるとします。これを計算するために、問い合わせ時にファクト テーブルのすべての行をスキャンして合計していると、応答時間が長くなる場合があります。</span><span class="sxs-lookup"><span data-stu-id="60d9b-110">For example, when a data warehouse fact table contains hundreds of thousands of rows, a query requesting the weekly sales totals for a particular product line can take a long time to answer if all the rows in the fact table have to be scanned and summed at query time to compute the answer.</span></span> <span data-ttu-id="60d9b-111">ただし、このクエリの回答となる集計データがあらかじめ計算されていれば、即座に応答ができます。</span><span class="sxs-lookup"><span data-stu-id="60d9b-111">However, the response can be almost immediate if the summarization data to answer this query has been precalculated.</span></span> <span data-ttu-id="60d9b-112">処理中に要約データを事前計算しておくことは、高速な応答時間を実現するための、基本的な OLAP 技術です。</span><span class="sxs-lookup"><span data-stu-id="60d9b-112">This precalculation of summary data occurs during processing and is the foundation for the rapid response times of OLAP technology.</span></span>  
  
 <span data-ttu-id="60d9b-113">キューブとは、要約データを多次元構造で編成するための OLAP 技術です。</span><span class="sxs-lookup"><span data-stu-id="60d9b-113">Cubes are the way that OLAP technology organizes summary data into multidimensional structures.</span></span> <span data-ttu-id="60d9b-114">ディメンションとその属性階層構造には、キューブに照会できる内容が反映されています。</span><span class="sxs-lookup"><span data-stu-id="60d9b-114">Dimensions and their hierarchies of attributes reflect the queries that can be asked of the cube.</span></span> <span data-ttu-id="60d9b-115">集計は、各ディメンションによって指定された座標位置にあるセルに、多次元構造で格納されます。</span><span class="sxs-lookup"><span data-stu-id="60d9b-115">Aggregations are stored in the multidimensional structure in cells at coordinates specified by the dimensions.</span></span> <span data-ttu-id="60d9b-116">たとえば、"北西地域 (Northwest) における 1998 年の製品 X の売上は?" という質問には、</span><span class="sxs-lookup"><span data-stu-id="60d9b-116">For example, the question "What were the sales of product X in 1998 for the Northwest region?"</span></span> <span data-ttu-id="60d9b-117">3 つのディメンション (製品、時間、および地理) と 1 つのメジャー (Sales) が関係します。</span><span class="sxs-lookup"><span data-stu-id="60d9b-117">involves three dimensions (Product, Time, and Geography) and one measure (Sales).</span></span> <span data-ttu-id="60d9b-118">この質問では、キューブ内の指定された座標 (製品 X, 1998, Northwest) にあるセルの値が回答 (1 つの数値) になります。</span><span class="sxs-lookup"><span data-stu-id="60d9b-118">The value of the cell in the cube at the specified coordinates (product X, 1998, Northwest) is the answer, a single numeric value.</span></span>  
  
 <span data-ttu-id="60d9b-119">回答が複数の値になる質問もあります。</span><span class="sxs-lookup"><span data-stu-id="60d9b-119">Other questions may return multiple values.</span></span> <span data-ttu-id="60d9b-120">たとえば、"1998 年のハードウェア製品の四半期別の地域別売上は?" のような質問です。</span><span class="sxs-lookup"><span data-stu-id="60d9b-120">For example, "How much were the sales of hardware products by quarter by region for 1998?"</span></span> <span data-ttu-id="60d9b-121">この場合、指定された条件を満たす座標位置にある各セルが返されます。</span><span class="sxs-lookup"><span data-stu-id="60d9b-121">Such queries return sets of cells from the coordinates that satisfy the specified conditions.</span></span> <span data-ttu-id="60d9b-122">返されるセルの数は、製品ディメンションの Hardware レベルに含まれる項目数、1998 年の 4 つの四半期、および地理ディメンションの地域数によって決まります。</span><span class="sxs-lookup"><span data-stu-id="60d9b-122">The number of cells returned by the query depends on the number of items in the Hardware level of the Product dimension, the four quarters in 1998, and the number of regions in the Geography dimension.</span></span> <span data-ttu-id="60d9b-123">ここで、すべての要約データが事前計算され集計として格納されていれば、このクエリの応答時間は、指定されたセルの抽出に必要な時間だけになります。</span><span class="sxs-lookup"><span data-stu-id="60d9b-123">If all summary data has been precalculated into aggregations, the response time of the query will depend only on the time that is required to extract the specified cells.</span></span> <span data-ttu-id="60d9b-124">つまり、データの計算やファクト テーブルからのデータの読み取りは必要ありません。</span><span class="sxs-lookup"><span data-stu-id="60d9b-124">No calculation or reading of data from the fact table is required.</span></span>  
  
 <span data-ttu-id="60d9b-125">キューブに含まれるすべての集計を事前計算しておくと、すべてのクエリの応答時間が最も高速になりますが、[!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] では特定の集計値を他の事前計算された集計から簡単に計算することができます。</span><span class="sxs-lookup"><span data-stu-id="60d9b-125">Although precalculation of all possible aggregations in a cube might provide the fastest possible response time for all queries, [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] can easily calculate some aggregrated values from other precalculated aggregations.</span></span> <span data-ttu-id="60d9b-126">これに加えて、可能な集計をすべて計算するには、大量の処理時間とストレージが必要になります。</span><span class="sxs-lookup"><span data-stu-id="60d9b-126">Additionally, calculating all possible aggregations requires significant processing time and storage.</span></span> <span data-ttu-id="60d9b-127">そのため、必要なストレージと事前計算される集計の割合の間にトレードオフが発生します。</span><span class="sxs-lookup"><span data-stu-id="60d9b-127">Therefore, there is a tradeoff between storage requirements and the percentage of possible aggregations that are precalculated.</span></span> <span data-ttu-id="60d9b-128">集計を事前計算しない (0%) 場合、キューブに必要な処理時間とストレージ領域は最小限に抑えられます。ただし、各クエリへの応答に必要なデータをリーフ セルから取得してから、各クエリに応答するためにクエリ時に集計しなければならないので、クエリ応答時間は遅くなる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="60d9b-128">If no aggregations are precalculated (0%), the amount of required processing time and storage space for a cube is minimized, but query response time may be slow because the data required to answer each query must be retrieved from the leaf cells and then aggregated at query time to answer each query.</span></span> <span data-ttu-id="60d9b-129">たとえば、前述の質問 ("北西地域における 1998 年の製品 X の売上は?") の場合、回答となる 1 つの数値を返すために、場合によっては何千行ものデータ行を読み取り、それぞれの行から Sales メジャーを求めるための列の値を抽出し、合計を算出しなければなりません。</span><span class="sxs-lookup"><span data-stu-id="60d9b-129">For example, returning a single number that answers the question asked earlier ("What were the sales of product X in 1998 for the Northwest region") might require reading thousands of rows of data, extracting the value of the column used to provide the Sales measure from each row, and then calculating the sum.</span></span> <span data-ttu-id="60d9b-130">さらに、データの取得に必要な時間は、データに対して選択したストレージモード (MOLAP、HOLAP、または ROLAP) によって大きく異なります。</span><span class="sxs-lookup"><span data-stu-id="60d9b-130">Moreover, the length of time required to retrieve that data will very depending on the storage mode chosen for the data-MOLAP, HOLAP, or ROLAP.</span></span>  
  
## <a name="designing-aggregations"></a><span data-ttu-id="60d9b-131">集計のデザイン</span><span class="sxs-lookup"><span data-stu-id="60d9b-131">Designing Aggregations</span></span>  
 [!INCLUDE[msCoName](../../includes/msconame-md.md)] <span data-ttu-id="60d9b-132">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] には、事前計算する集計を選択するための高度なアルゴリズムが組み込まれています。対象にならなかった集計は、事前計算された値に基づいてすばやく計算されます。</span><span class="sxs-lookup"><span data-stu-id="60d9b-132">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] incorporates a sophisticated algorithm to select aggregations for precalculation so that other aggregations can be quickly computed from the precalculated values.</span></span> <span data-ttu-id="60d9b-133">たとえば、時間階層の Month レベルの集計が事前計算されている場合、Quarter レベルの算出に必要なのは 3 つの数値を集計することだけで、これは要求時に即座に計算できます。</span><span class="sxs-lookup"><span data-stu-id="60d9b-133">For example, if the aggregations are precalculated for the Month level of a Time hierarchy, the calculation for a Quarter level requires only the summarization of three numbers, which can be quickly computed on demand.</span></span> <span data-ttu-id="60d9b-134">この方法では、クエリ応答時間への影響を最小限に抑えながら、処理時間を節約し、必要なストレージを削減できます。</span><span class="sxs-lookup"><span data-stu-id="60d9b-134">This technique saves processing time and reduces storage requirements, with minimal effect on query response time.</span></span>  
  
 <span data-ttu-id="60d9b-135">集計のデザイン ウィザードには、このアルゴリズムに対するストレージと集計の割合の制約を指定するためのオプションが用意されています。これらのオプションを使用して、クエリ応答時間と必要なストレージの間のトレードオフを最適化することができます。</span><span class="sxs-lookup"><span data-stu-id="60d9b-135">The Aggregation Design Wizard provides options for you to specify storage and percentage constraints on the algorithm to achieve a satisfactory tradeoff between query response time and storage requirements.</span></span> <span data-ttu-id="60d9b-136">ただし、集計のデザイン ウィザードのアルゴリズムでは、すべてのクエリが等しく発生することが前提となっています。</span><span class="sxs-lookup"><span data-stu-id="60d9b-136">However, the Aggregation Design Wizard's algorithm assumes that all possible queries are equally likely.</span></span> <span data-ttu-id="60d9b-137">また、使用法に基づく最適化ウィザードでは、クライアント アプリケーションによって送信されたクエリを分析して、メジャー グループの集計デザインを調整できます。</span><span class="sxs-lookup"><span data-stu-id="60d9b-137">The Usage-Based Optimization Wizard lets you adjust the aggregation design for a measure group by analyzing the queries that have been submitted by client applications.</span></span> <span data-ttu-id="60d9b-138">このウィザードを使用することで、キューブに必要なストレージにはほとんど影響を与えずに、使用頻度の低いクエリよりも使用頻度の高いクエリへの応答の方が高速になるように、キューブの集計をチューニングできます。</span><span class="sxs-lookup"><span data-stu-id="60d9b-138">By using the wizard to tune a cube's aggregation you can increase responsiveness to frequent queries and decrease responsiveness to infrequent queries without significantly affecting the storage needed for the cube.</span></span>  
  
 <span data-ttu-id="60d9b-139">このウィザードを使用することで集計はデザインされますが、集計デザインの対象であるパーティションが処理されるまで、実際の計算は行われません。</span><span class="sxs-lookup"><span data-stu-id="60d9b-139">Aggregations are designed by using the wizards but are not actually calculated until the partition for which the aggregations are designed is processed.</span></span> <span data-ttu-id="60d9b-140">集計の作成後、キューブの構造が変更されたり、キューブの変換元テーブル内でデータの追加または変更が発生した場合、通常はそのキューブの集計を確認し、キューブの処理を再度行う必要があります。</span><span class="sxs-lookup"><span data-stu-id="60d9b-140">After the aggregation has been created, if the structure of a cube ever changes, or if data is added to or changed in a cube's source tables, it is usually necessary to review the cube's aggregations and process the cube again.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="60d9b-141">参照</span><span class="sxs-lookup"><span data-stu-id="60d9b-141">See Also</span></span>  
 [<span data-ttu-id="60d9b-142">パーティションのストレージ モードおよび処理</span><span class="sxs-lookup"><span data-stu-id="60d9b-142">Partition Storage Modes and Processing</span></span>](partitions-partition-storage-modes-and-processing.md)  
  
  
