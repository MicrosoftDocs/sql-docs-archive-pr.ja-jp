---
title: Kerberos の制約付き委任の Analysis Services を構成する |Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: analysis-services
ms.topic: conceptual
ms.assetid: 6d751477-6bf1-48b4-8833-5a631bbe7650
author: minewiskan
ms.author: owend
ms.openlocfilehash: 03b852acb4868cd384ef34948c6aff70541638a0
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87714905"
---
# <a name="configure-analysis-services-for-kerberos-constrained-delegation"></a><span data-ttu-id="9114b-102">Kerberos の制約付き委任のための Analysis Services の構成</span><span class="sxs-lookup"><span data-stu-id="9114b-102">Configure Analysis Services for Kerberos constrained delegation</span></span>
  <span data-ttu-id="9114b-103">Kerberos 認証用に Analysis Services を構成する際は、通常、データを照会するときに Analysis Services でユーザー ID の権限を借用すること、Analysis Services でユーザー ID を下位レベル サービスに委任すること、またはその両方を実現することが重要になります。</span><span class="sxs-lookup"><span data-stu-id="9114b-103">When configuring Analysis Services for Kerberos authentication, you are most likely interested in achieving one or both of the following outcomes: having Analysis Services impersonate a user identity when querying data; or having Analysis Services delegate a user identity to a down-level service.</span></span> <span data-ttu-id="9114b-104">これらのシナリオで求められる構成要件はそれぞれ異なります。</span><span class="sxs-lookup"><span data-stu-id="9114b-104">Each scenario calls for slightly different configuration requirements.</span></span> <span data-ttu-id="9114b-105">どちらのシナリオでも、構成が正しく行われたことを確認するための検証が必要になります。</span><span class="sxs-lookup"><span data-stu-id="9114b-105">Both scenarios require verification to ensure configuration was done properly.</span></span>  
  
> [!TIP]  
>  <span data-ttu-id="9114b-106">**[!INCLUDE[msCoName](../../includes/msconame-md.md)] Kerberos Configuration Manager for [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]** は、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]と Kerberos に関する接続性の問題のトラブルシューティングに役立つ診断ツールです。</span><span class="sxs-lookup"><span data-stu-id="9114b-106">**[!INCLUDE[msCoName](../../includes/msconame-md.md)] Kerberos Configuration Manager for [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]** is a diagnostic tool that helps troubleshoot Kerberos related connectivity issues with [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="9114b-107">Kerberos 認証の詳細については、「 [Microsoft® Kerberos Configuration Manager for SQL Server®](https://www.microsoft.com/download/details.aspx?id=39046)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="9114b-107">For more information, see [Microsoft Kerberos Configuration Manager for SQL Server](https://www.microsoft.com/download/details.aspx?id=39046).</span></span>  
  
 <span data-ttu-id="9114b-108">このトピックは、次のセクションで構成されています。</span><span class="sxs-lookup"><span data-stu-id="9114b-108">This topic contains the following sections:</span></span>  
  
-   [<span data-ttu-id="9114b-109">Analysis Services によるユーザー ID の権限の借用</span><span class="sxs-lookup"><span data-stu-id="9114b-109">Allow Analysis Services to impersonate a user identity</span></span>](#bkmk_impersonate)  
  
-   [<span data-ttu-id="9114b-110">信頼された委任のための Analysis Services の構成</span><span class="sxs-lookup"><span data-stu-id="9114b-110">Configure Analysis Services for trusted delegation</span></span>](#bkmk_delegate)  
  
-   [<span data-ttu-id="9114b-111">権限が借用された ID または委任された ID のテスト</span><span class="sxs-lookup"><span data-stu-id="9114b-111">Test for impersonated or delegated identity</span></span>](#bkmk_test)  
  
> [!NOTE]  
>  <span data-ttu-id="9114b-112">Analysis Services への接続がシングル ホップである場合や、SharePoint Secure Store Service または Reporting Services によって提供された保存された資格情報をソリューションで使用する場合、委任は必要ありません。</span><span class="sxs-lookup"><span data-stu-id="9114b-112">Delegation is not required if the connection to Analysis Services is a single hop, or your solution uses stored credentials provided by SharePoint Secure Store Service or Reporting Services.</span></span> <span data-ttu-id="9114b-113">すべての接続が Excel から Analysis Services データベースに対する直接接続である場合、または保存された資格情報に基づいている場合、Kerberos (または NTLM) を使用するのに制約付き委任を構成する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="9114b-113">If all connections are direct connections from Excel to an Analysis Services database, or based on stored credentials, you can use Kerberos (or NTLM) without having to configure constrained delegation.</span></span>  
>   
>  <span data-ttu-id="9114b-114">ユーザー id が複数のコンピューター接続 ("ダブルホップ" と呼ばれます) を通過する必要がある場合は、Kerberos の制約付き委任が必要です。</span><span class="sxs-lookup"><span data-stu-id="9114b-114">Kerberos constrained delegation is required if the user identity has to flow over multiple computer connections (known as "double-hop").</span></span> <span data-ttu-id="9114b-115">Analysis Services データ アクセスがユーザー ID に基づき、接続要求が委任サービスから発信される場合は、次のセクションのチェック リストを使用して、Analysis Services が元の呼び出し元の権限を借用できることを確認します。</span><span class="sxs-lookup"><span data-stu-id="9114b-115">When Analysis Services data access is contingent upon user identity, and the connection request is from a delegating service, use the checklist in the next section to ensure that Analysis Services is able to impersonate the original caller.</span></span> <span data-ttu-id="9114b-116">Analysis Services の認証フローの詳細については、「 [Microsoft BI 認証と ID 委任](https://go.microsoft.com/fwlink/?LinkID=286576)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="9114b-116">For more information about Analysis Services authentication flows, see [Microsoft BI Authentication and Identity Delegation](https://go.microsoft.com/fwlink/?LinkID=286576).</span></span>  
>   
>  <span data-ttu-id="9114b-117">セキュリティ上、Microsoft は常に制約なし委任よりも制約付き委任をお勧めします。</span><span class="sxs-lookup"><span data-stu-id="9114b-117">As a security best practice, Microsoft always recommends constrained delegation over unconstrained delegation.</span></span> <span data-ttu-id="9114b-118">制約なし委任では、サービス ID が *あらゆる* ダウンストリーム コンピューター、サービスまたはアプリケーションで別のユーザーを偽装できるようになるため、大きなセキュリティ リスクとなります (一方、制約付き委任ではこれらのサービスが明示的に定義されます)。</span><span class="sxs-lookup"><span data-stu-id="9114b-118">Unconstrained delegation is a major security risk because it allows the service identity to impersonate another user on *any* downstream computer, service, or application (as opposed to just those services explicitly defined via constrained delegation).</span></span>  
  
##  <a name="allow-analysis-services-to-impersonate-a-user-identity"></a><a name="bkmk_impersonate"></a><span data-ttu-id="9114b-119">Analysis Services がユーザー id の権限を借用することを許可する</span><span class="sxs-lookup"><span data-stu-id="9114b-119">Allow Analysis Services to impersonate a user identity</span></span>  
 <span data-ttu-id="9114b-120">Reporting Services、IIS、SharePoint などの上位レベル サービスに Analysis Services 上のユーザー ID の権限を借用することを許可するには、これらのサービスに対して Kerberos の制約付き委任を構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="9114b-120">To allow up-level services such as Reporting Services, IIS, or SharePoint to impersonate a user identity on Analysis Services, you must configure Kerberos constrained delegation for those services.</span></span> <span data-ttu-id="9114b-121">このシナリオでは、Analysis Services は、委任サービスで提供された ID を使用して現在のユーザーの権限を借用し、そのユーザー ID のロールのメンバーシップに基づく結果を返します。</span><span class="sxs-lookup"><span data-stu-id="9114b-121">In this scenario, Analysis Services impersonates the current user using the identity provided by the delegating service, returning results based on role membership of that user identity.</span></span>  
  
|<span data-ttu-id="9114b-122">タスク</span><span class="sxs-lookup"><span data-stu-id="9114b-122">Task</span></span>|<span data-ttu-id="9114b-123">説明</span><span class="sxs-lookup"><span data-stu-id="9114b-123">Description</span></span>|  
|----------|-----------------|  
|<span data-ttu-id="9114b-124">手順 1: アカウントが委任に適していることを確認する</span><span class="sxs-lookup"><span data-stu-id="9114b-124">Step 1: Verify that accounts are suitable for delegation</span></span>|<span data-ttu-id="9114b-125">サービスの実行に使用されるアカウントの適切なプロパティが Active Directory にあることを確認します。</span><span class="sxs-lookup"><span data-stu-id="9114b-125">Ensure that the accounts used to run the services have the correct properties in Active Directory.</span></span> <span data-ttu-id="9114b-126">Active Directory のサービス アカウントは、機微なアカウントとしてマークされていてはならず、委任シナリオから明確に除外されている必要があります。</span><span class="sxs-lookup"><span data-stu-id="9114b-126">Service accounts in Active Directory must not be marked as sensitive accounts, or specifically excluded from delegation scenarios.</span></span> <span data-ttu-id="9114b-127">詳細については、「 [ユーザー アカウントとは](https://go.microsoft.com/fwlink/?LinkId=235818)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="9114b-127">For more information, see [Understanding User Accounts](https://go.microsoft.com/fwlink/?LinkId=235818).</span></span><br /><br /> <span data-ttu-id="9114b-128">重要一般に、すべてのアカウントとサーバーは、同じ Active Directory ドメインまたは同じフォレスト内の信頼されたドメインに属している必要があります。 \*\* \* \* \* \* \*\*</span><span class="sxs-lookup"><span data-stu-id="9114b-128">**\*\* Important \*\*** Generally, all accounts and servers must belong to the same Active Directory domain or to trusted domains in the same forest.</span></span> <span data-ttu-id="9114b-129">ただし、Windows Server 2012 はドメインの境界を越えた委任をサポートしているので、ドメインの機能レベルが Windows Server 2012 である場合、ドメインの境界を越えた Kerberos の制約付き委任を構成できます。</span><span class="sxs-lookup"><span data-stu-id="9114b-129">However, because Windows Server 2012 supports delegation across domain boundaries, you can configure Kerberos constrained delegation across a domain boundary if the domain functional level is Windows Server 2012.</span></span> <span data-ttu-id="9114b-130">また、Analysis Services を HTTP アクセス用に構成し、クライアント接続で IIS の認証方法を使用することもできます。</span><span class="sxs-lookup"><span data-stu-id="9114b-130">Another alternative is to configure Analysis Services for HTTP access and use IIS authentication methods on the client connection.</span></span> <span data-ttu-id="9114b-131">詳細については、「 [インターネット インフォメーション サービス &#40;IIS&#41; 8.0 上の Analysis Services への HTTP アクセスの構成](configure-http-access-to-analysis-services-on-iis-8-0.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="9114b-131">For more information, see [Configure HTTP Access to Analysis Services on Internet Information Services &#40;IIS&#41; 8.0](configure-http-access-to-analysis-services-on-iis-8-0.md).</span></span>|  
|<span data-ttu-id="9114b-132">手順 2: SPN を登録する</span><span class="sxs-lookup"><span data-stu-id="9114b-132">Step 2: Register the SPN</span></span>|<span data-ttu-id="9114b-133">制約付き委任をセットアップする前に、Analysis Services インスタンス用に SPN (Service Principle Name) を登録する必要があります。</span><span class="sxs-lookup"><span data-stu-id="9114b-133">Before setting up constrained delegation, you must register a Service Principle Name (SPN) for the Analysis Services instance.</span></span> <span data-ttu-id="9114b-134">中間層サービスの Kerberos の制約付き委任を構成するときに Analysis Services SPN が必要となります。</span><span class="sxs-lookup"><span data-stu-id="9114b-134">You will need the Analysis Services SPN when configuring Kerberos constrained delegation for middle tier services.</span></span> <span data-ttu-id="9114b-135">手順については、「 [SPN registration for an Analysis Services instance](spn-registration-for-an-analysis-services-instance.md) 」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="9114b-135">See [SPN registration for an Analysis Services instance](spn-registration-for-an-analysis-services-instance.md) for instructions.</span></span><br /><br /> <span data-ttu-id="9114b-136">SPN (Service Principle Name) は、Kerberos 認証用に構成されたドメイン内のサービスの一意の ID を指定します。</span><span class="sxs-lookup"><span data-stu-id="9114b-136">A Service Principle Name (SPN) specifies the unique identity of a service in a domain configured for Kerberos authentication.</span></span> <span data-ttu-id="9114b-137">通常、統合セキュリティを使用するクライアント接続は、SSPI 認証の一部として SPN を要求します。</span><span class="sxs-lookup"><span data-stu-id="9114b-137">Client connections using integrated security often request an SPN as part of SSPI authentication.</span></span> <span data-ttu-id="9114b-138">この要求は、Active Directory ドメイン コントローラー (DC) に転送されます。その際、クライアントによって示された SPN に対応する SPN が Active Directory 内に登録されている場合は、KDC によりチケットが提供されます。</span><span class="sxs-lookup"><span data-stu-id="9114b-138">The request is forwarded to an Active Directory Domain Controller (DC), with the KDC granting a ticket if the SPN presented by the client has a matching SPN registration in Active Directory.</span></span>|  
|<span data-ttu-id="9114b-139">手順 3: 制約付き委任を構成する</span><span class="sxs-lookup"><span data-stu-id="9114b-139">Step 3: Configure constrained delegation</span></span>|<span data-ttu-id="9114b-140">まず、使用するアカウントを検証し、そのアカウントの SPN を登録します。次に、上位レベル サービス (IIS、Reporting Services、SharePoint Web サービスなど) を制約付き委任用に構成し、委任が許可される特定のサービスとして Analysis Services SPN を指定します。</span><span class="sxs-lookup"><span data-stu-id="9114b-140">After validating the accounts you want to use and registering SPNs for those accounts, your next step is to configure up-level services, such as IIS, Reporting Services, or SharePoint web services for constrained delegation, specifying the Analysis Services SPN as the specific service for which delegation is allowed.</span></span><br /><br /> <span data-ttu-id="9114b-141">SharePoint で実行されるサービス (たとえば、Excel Services、SharePoint モードの Reporting Services) は、通常、Analysis Services の多次元データまたはテーブル データを使用するブックやレポートをホストします。</span><span class="sxs-lookup"><span data-stu-id="9114b-141">Services that run in SharePoint, such as Excel Services or Reporting Services in SharePoint mode, often host workbooks and reports that consume Analysis Services multidimensional or tabular data.</span></span> <span data-ttu-id="9114b-142">これらのサービスに対して制約付き委任を構成することは一般的な構成タスクであり、Excel Services からのデータの更新をサポートするために必要です。</span><span class="sxs-lookup"><span data-stu-id="9114b-142">Configuring constrained delegation for these services is a common configuration task, and necessary for supporting data refresh from Excel Services.</span></span> <span data-ttu-id="9114b-143">SharePoint サービスに加え、Analysis Services データに対するダウンストリーム データ接続要求を表す可能性のあるその他のサービスの手順については、次のリンクをご覧ください。</span><span class="sxs-lookup"><span data-stu-id="9114b-143">The following links provide instructions for SharePoint services, as well as other services likely to present a downstream data connection request for Analysis Services data:</span></span><br /><br /> <span data-ttu-id="9114b-144">[Excel services の id 委任 (Sharepoint server 2010)](https://go.microsoft.com/fwlink/?LinkId=299826) 、または[Kerberos 認証用に sharepoint Server 2010 の excel services を構成する方法](https://support.microsoft.com/kb/2466519)</span><span class="sxs-lookup"><span data-stu-id="9114b-144">[Identity delegation for Excel Services (SharePoint Server 2010)](https://go.microsoft.com/fwlink/?LinkId=299826) or [How to configure Excel Services in SharePoint Server 2010 for Kerberos authentication](https://support.microsoft.com/kb/2466519)</span></span><br /><br /> [<span data-ttu-id="9114b-145">PerformancePoint Services の ID 委任 (SharePoint Server 2010)</span><span class="sxs-lookup"><span data-stu-id="9114b-145">Identity delegation for PerformancePoint Services (SharePoint Server 2010)</span></span>](https://go.microsoft.com/fwlink/?LinkId=299827)<br /><br /> [<span data-ttu-id="9114b-146">SQL Server Reporting Services の場合の ID 委任 (SharePoint Server 2010)</span><span class="sxs-lookup"><span data-stu-id="9114b-146">Identity delegation for SQL Server Reporting Services (SharePoint Server 2010)</span></span>](https://go.microsoft.com/fwlink/?LinkId=299828)<br /><br /> <span data-ttu-id="9114b-147">IIS 7.0 の詳細については、「 [Windows 認証を設定する (IIS 7.0)](https://technet.microsoft.com/library/cc754628\(v=ws.10\).aspx) 」または「 [Kerberos 認証を使用するように SQL Server 2008 Analysis Services および SQL Server 2005 Analysis Services を構成する方法](https://support.microsoft.com/kb/917409)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9114b-147">For IIS 7.0 see [Configure Windows Authentication (IIS 7.0)](https://technet.microsoft.com/library/cc754628\(v=ws.10\).aspx) or [How to configure SQL Server 2008 Analysis Services and SQL Server 2005 Analysis Services to use Kerberos authentication](https://support.microsoft.com/kb/917409).</span></span>|  
|<span data-ttu-id="9114b-148">手順 4: 接続をテストする</span><span class="sxs-lookup"><span data-stu-id="9114b-148">Step 4: Test connections</span></span>|<span data-ttu-id="9114b-149">テスト中、異なる ID でリモート コンピューターから接続し、ビジネス ユーザーと同じアプリケーションを使用して Analysis Services をクエリします。</span><span class="sxs-lookup"><span data-stu-id="9114b-149">When testing, connect from remote computers, under different identities, and query Analysis Services using the same applications as business users.</span></span> <span data-ttu-id="9114b-150">SQL Server Profiler を使用すると接続を監視できます。</span><span class="sxs-lookup"><span data-stu-id="9114b-150">You can use SQL Server Profiler to monitor the connection.</span></span> <span data-ttu-id="9114b-151">要求にあるユーザー ID を確認する必要があります。</span><span class="sxs-lookup"><span data-stu-id="9114b-151">You should see the user identity on the request.</span></span> <span data-ttu-id="9114b-152">詳細については、このセクションの「 [権限が借用された ID または委任された ID のテスト](#bkmk_test) 」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="9114b-152">For more information, see [Test for impersonated or delegated identity](#bkmk_test) in this section.</span></span>|  
  
##  <a name="configure-analysis-services-for-trusted-delegation"></a><a name="bkmk_delegate"></a><span data-ttu-id="9114b-153">信頼された委任の Analysis Services を構成する</span><span class="sxs-lookup"><span data-stu-id="9114b-153">Configure Analysis Services for trusted delegation</span></span>  
 <span data-ttu-id="9114b-154">Kerberos の制約付き委任用に Analysis Services を構成すると、サービスは、下位レベル サービス (リレーショナル データベース エンジンなど) のクライアント ID の権限を借用して、クライアントが直接接続されているかのようにデータを照会できます。</span><span class="sxs-lookup"><span data-stu-id="9114b-154">Configuring Analysis Services for Kerberos constrained delegation allows the service to impersonate a client identity on a down-level service, such as the relational database engine, so that data can be queried as if the client was connected directly.</span></span>  
  
 <span data-ttu-id="9114b-155">Analysis Services の委任シナリオは、`DirectQuery` 用に構成されたテーブル モデルに限られます。</span><span class="sxs-lookup"><span data-stu-id="9114b-155">Delegation scenarios for Analysis Services are limited to tabular models configured for `DirectQuery` mode.</span></span> <span data-ttu-id="9114b-156">これは、委任された資格情報を Analysis Services が別のサービスに渡すことができる唯一のシナリオです。</span><span class="sxs-lookup"><span data-stu-id="9114b-156">This is the only scenario in which Analysis Services can pass delegated credentials to another service.</span></span> <span data-ttu-id="9114b-157">前のセクションで説明された SharePoint のシナリオなど、他のすべてのシナリオでは、Analysis Services は委任チェーンの受信側です。</span><span class="sxs-lookup"><span data-stu-id="9114b-157">In all other scenarios, such as SharePoint scenarios mentioned in the previous section, Analysis Services is on the receiving end of the delegation chain.</span></span> <span data-ttu-id="9114b-158">DirectQuery の詳細については、「[DirectQuery モード (SSAS テーブル)](../tabular-models/directquery-mode-ssas-tabular.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9114b-158">For more information about DirectQuery, see [DirectQuery Mode &#40;SSAS Tabular&#41;](../tabular-models/directquery-mode-ssas-tabular.md).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="9114b-159">共通する誤りは、ROLAP ストレージ、処理操作、またはリモート パーティションへのアクセスによって制約付き委任が要求されてしまうことです。</span><span class="sxs-lookup"><span data-stu-id="9114b-159">A common misconception is that ROLAP storage, processing operations, or access to remote partitions somehow introduce requirements for constrained delegation.</span></span> <span data-ttu-id="9114b-160">この場合は当てはまりません。</span><span class="sxs-lookup"><span data-stu-id="9114b-160">This is not the case.</span></span> <span data-ttu-id="9114b-161">これらすべての操作は、代わりにサービス アカウント (処理アカウントとも呼ばれます) によって直接実行されます。</span><span class="sxs-lookup"><span data-stu-id="9114b-161">All of these operations are executed directly by the service account (also referred to as the processing account), on its own behalf.</span></span> <span data-ttu-id="9114b-162">このような操作の権限が直接サービス アカウントに付与されているため (例えば、リレーショナル データベースに db_datareader 権限を付与することにより、サービスがデータを処理できるようにします)、Analysis Services におけるこれらの操作に委任は必要ありません。</span><span class="sxs-lookup"><span data-stu-id="9114b-162">Delegation is not required for these operations in Analysis Services, given that permissions for such operations are granted directly to the service account (for example, granting db_datareader permissions on the relational database so that the service can process data).</span></span> <span data-ttu-id="9114b-163">サーバー操作と権限の詳細については、「[サービス アカウントの構成 (Analysis Services)](configure-service-accounts-analysis-services.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9114b-163">For more information about server operations and permissions, see [Configure Service Accounts &#40;Analysis Services&#41;](configure-service-accounts-analysis-services.md).</span></span>  
  
 <span data-ttu-id="9114b-164">このセクションでは、信頼された委任用に Analysis Services を設定する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="9114b-164">This section explains how to set up Analysis Services for trusted delegation.</span></span> <span data-ttu-id="9114b-165">このタスクを完了すると、Analysis Services で委任された資格情報を SQL Server に渡すことができます。これは、テーブル ソリューションで使用される DirectQuery モードをサポートします。</span><span class="sxs-lookup"><span data-stu-id="9114b-165">After you complete this task, Analysis Services will be able to pass delegated credentials to SQL Server, in support of DirectQuery mode used in Tabular solutions.</span></span>  
  
 <span data-ttu-id="9114b-166">開始する前に次の操作を実行してください。</span><span class="sxs-lookup"><span data-stu-id="9114b-166">Before you start:</span></span>  
  
-   <span data-ttu-id="9114b-167">Analysis Services が開始されていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="9114b-167">Verify that Analysis Services is started.</span></span>  
  
-   <span data-ttu-id="9114b-168">Analysis Services に対して登録されている SPN が有効であることを確認します。</span><span class="sxs-lookup"><span data-stu-id="9114b-168">Verify the SPN registered for Analysis Services is valid.</span></span> <span data-ttu-id="9114b-169">手順については、「 [SPN registration for an Analysis Services instance](spn-registration-for-an-analysis-services-instance.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="9114b-169">For instructions, see [SPN registration for an Analysis Services instance](spn-registration-for-an-analysis-services-instance.md)</span></span>  
  
 <span data-ttu-id="9114b-170">両方の前提条件が満たされたら、次の手順を実行します。</span><span class="sxs-lookup"><span data-stu-id="9114b-170">When both prerequisites are satisfied, continue with the following steps.</span></span> <span data-ttu-id="9114b-171">制約付き委任を設定するには、ドメイン管理者である必要があります。</span><span class="sxs-lookup"><span data-stu-id="9114b-171">Note that you must be a domain administrator to set up constrained delegation.</span></span>  
  
1.  <span data-ttu-id="9114b-172">[Active Directory ユーザーとコンピューター] で、Analysis Services サービスが実行されているサービス アカウントを見つけます。</span><span class="sxs-lookup"><span data-stu-id="9114b-172">In Active Directory Users and Computers, find the service account under which Analysis Services runs.</span></span> <span data-ttu-id="9114b-173">サービス アカウントを右クリックし、 **[プロパティ]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="9114b-173">Right-click the service account and choose **Properties**.</span></span>  
  
     <span data-ttu-id="9114b-174">わかりやすくするために、以降のスクリーン ショットでは、OlapSvc と SQLSvc を使用して Analysis Services と SQL Server をそれぞれ表しています。</span><span class="sxs-lookup"><span data-stu-id="9114b-174">For illustrative purposes, the following screenshots use OlapSvc and SQLSvc to represent Analysis Services and SQL Server, respectively.</span></span>  
  
     <span data-ttu-id="9114b-175">OlapSvc は、SQLSvc への制約付き委任用に構成されるアカウントです。</span><span class="sxs-lookup"><span data-stu-id="9114b-175">OlapSvc is the account that will be configured for constrained delegation to SQLSvc.</span></span> <span data-ttu-id="9114b-176">このタスクを完了すると、データを要求するときに元の呼び出し元の権限を借用して、サービス チケットの委任された資格情報を SQLSvc に渡す権限が OlapSvc に与えられます。</span><span class="sxs-lookup"><span data-stu-id="9114b-176">When you complete this task, OlapSvc will have permission to pass delegated credentials on a service ticket to SQLSvc, impersonating the original caller when requesting data.</span></span>  
  
2.  <span data-ttu-id="9114b-177">[委任] タブで、 **[指定されたサービスへの委任でのみこのユーザーを信頼する]** を選択し、 **[Kerberos のみを使う]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="9114b-177">On the Delegation tab, select **Trust this user for delegation to specified services only**, followed by **Use Kerberos only**.</span></span> <span data-ttu-id="9114b-178">Analysis Services による資格情報の委任を許可するサービスを指定するために、 **[追加]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="9114b-178">Click **Add** to specify which service Analysis Services is permitted to delegate credentials.</span></span>  
  
     <span data-ttu-id="9114b-179">[委任] タブは、ユーザー アカウント (OlapSvc) がサービス (Analysis Services) に割り当てられ、このサービスの SPN が登録されている場合にのみ表示されます。</span><span class="sxs-lookup"><span data-stu-id="9114b-179">Delegation tab appears only when the user account (OlapSvc) is assigned to a service (Analysis Services), and the service has an SPN registered for it.</span></span> <span data-ttu-id="9114b-180">SPN を登録するには、このサービスが実行されている必要があります。</span><span class="sxs-lookup"><span data-stu-id="9114b-180">SPN registration requires that the service is running.</span></span>  
  
     <span data-ttu-id="9114b-181">![SSAS_Kerberos_1_AccountProperties](../media/ssas-kerberos-1-accountproperties.gif "SSAS_Kerberos_1_AccountProperties")</span><span class="sxs-lookup"><span data-stu-id="9114b-181">![SSAS_Kerberos_1_AccountProperties](../media/ssas-kerberos-1-accountproperties.gif "SSAS_Kerberos_1_AccountProperties")</span></span>  
  
3.  <span data-ttu-id="9114b-182">[サービスの追加] ページで、 **[ユーザーまたはコンピューター]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="9114b-182">On the Add Services page, click **Users or Computers**.</span></span>  
  
     <span data-ttu-id="9114b-183">![SSAS_Kerberos_2_](../media/ssas-kerberos-2.gif "SSAS_Kerberos_2_")</span><span class="sxs-lookup"><span data-stu-id="9114b-183">![SSAS_Kerberos_2_](../media/ssas-kerberos-2.gif "SSAS_Kerberos_2_")</span></span>  
  
4.  <span data-ttu-id="9114b-184">[ユーザーまたはコンピューターの選択] ページで、Analysis Services のテーブル モデル データベースにデータを提供する SQL Server インスタンスを実行するために使用するアカウントを入力します。</span><span class="sxs-lookup"><span data-stu-id="9114b-184">On the Select Users or Computer page, enter the account used to run the SQL Server instance providing data to Analysis Services tabular model databases.</span></span> <span data-ttu-id="9114b-185">**[OK]** をクリックして、サービス アカウントを受け入れます。</span><span class="sxs-lookup"><span data-stu-id="9114b-185">Click **OK** to accept the service account.</span></span>  
  
     <span data-ttu-id="9114b-186">目的のアカウントを選択できない場合は、SQL Server が実行されていて、そのアカウント用に SPN が登録されていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="9114b-186">If you cannot select the account you want, verify that SQL Server is running and has an SPN registered for that account.</span></span> <span data-ttu-id="9114b-187">データベース エンジンの SPN の詳細については、「 [Register a Service Principal Name for Kerberos Connections](../../database-engine/configure-windows/register-a-service-principal-name-for-kerberos-connections.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="9114b-187">For more information about SPNs for the database engine, see [Register a Service Principal Name for Kerberos Connections](../../database-engine/configure-windows/register-a-service-principal-name-for-kerberos-connections.md).</span></span>  
  
     <span data-ttu-id="9114b-188">![SSAS_Kerberos_3_SelectUsers](../media/ssas-kerberos-3-selectusers.gif "SSAS_Kerberos_3_SelectUsers")</span><span class="sxs-lookup"><span data-stu-id="9114b-188">![SSAS_Kerberos_3_SelectUsers](../media/ssas-kerberos-3-selectusers.gif "SSAS_Kerberos_3_SelectUsers")</span></span>  
  
5.  <span data-ttu-id="9114b-189">SQL Server インスタンスが [サービスの追加] に表示されます。</span><span class="sxs-lookup"><span data-stu-id="9114b-189">The SQL Server instance should now appear in Add Services.</span></span> <span data-ttu-id="9114b-190">このアカウントを使用している他のサービスも一覧に表示されます。</span><span class="sxs-lookup"><span data-stu-id="9114b-190">Any service also using that account will also appear in the list.</span></span> <span data-ttu-id="9114b-191">使用する SQL Server インスタンスを選択します。</span><span class="sxs-lookup"><span data-stu-id="9114b-191">Choose the SQL Server instance you want to use.</span></span> <span data-ttu-id="9114b-192">**[OK]** をクリックして、インスタンスを受け入れます。</span><span class="sxs-lookup"><span data-stu-id="9114b-192">Click **OK** to accept the instance.</span></span>  
  
     <span data-ttu-id="9114b-193">![SSAS_Kerberos_4_](../media/ssas-kerberos-4.gif "SSAS_Kerberos_4_")</span><span class="sxs-lookup"><span data-stu-id="9114b-193">![SSAS_Kerberos_4_](../media/ssas-kerberos-4.gif "SSAS_Kerberos_4_")</span></span>  
  
6.  <span data-ttu-id="9114b-194">次のスクリーン ショットに示すような Analysis Services サービス アカウントのプロパティ ページが表示されます。</span><span class="sxs-lookup"><span data-stu-id="9114b-194">The properties page of the Analysis Services service account should now look similar to the following screenshot.</span></span> <span data-ttu-id="9114b-195">**[OK]** をクリックして変更を保存します。</span><span class="sxs-lookup"><span data-stu-id="9114b-195">Click **OK** to save your changes.</span></span>  
  
     <span data-ttu-id="9114b-196">![SSAS_Kerberos_5_Finished](../media/ssas-kerberos-5-finished.gif "SSAS_Kerberos_5_Finished")</span><span class="sxs-lookup"><span data-stu-id="9114b-196">![SSAS_Kerberos_5_Finished](../media/ssas-kerberos-5-finished.gif "SSAS_Kerberos_5_Finished")</span></span>  
  
7.  <span data-ttu-id="9114b-197">異なる ID を使用してリモート クライアント コンピューターから接続して委任が成功するかどうかをテストし、テーブル モデルに対してクエリを実行します。</span><span class="sxs-lookup"><span data-stu-id="9114b-197">Test for successful delegation by connecting from a remote client computer, under a different identity, and query the tabular model.</span></span> <span data-ttu-id="9114b-198">要求のユーザー ID は、SQL Server Profiler で確認できます。</span><span class="sxs-lookup"><span data-stu-id="9114b-198">You should see the user identity on the request in SQL Server Profiler.</span></span>  
  
##  <a name="test-for-impersonated-or-delegated-identity"></a><a name="bkmk_test"></a><span data-ttu-id="9114b-199">権限の借用または委任された id のテスト</span><span class="sxs-lookup"><span data-stu-id="9114b-199">Test for impersonated or delegated identity</span></span>  
 <span data-ttu-id="9114b-200">データを照会しているユーザーの ID を監視するには、SQL Server Profiler を使用します。</span><span class="sxs-lookup"><span data-stu-id="9114b-200">Use SQL Server Profiler to monitor the identity of the user who is querying data.</span></span>  
  
1.  <span data-ttu-id="9114b-201">Analysis Services インスタンスで **SQL Server Profiler** を開始し、新しいトレースを開始します。</span><span class="sxs-lookup"><span data-stu-id="9114b-201">Start **SQL Server Profiler** on the Analysis Services instance and then start a new trace.</span></span>  
  
2.  <span data-ttu-id="9114b-202">[イベントの選択] で、[Security Audit] セクションの [`Audit Login`] および [`Audit Logout`] のチェック ボックスがオンになっていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="9114b-202">In Events Selection, verify that `Audit Login` and `Audit Logout` are checked in the Security Audit section.</span></span>  
  
3.  <span data-ttu-id="9114b-203">リモート クライアント コンピューターから、アプリケーション サービス (SharePoint、Reporting Services など) を介して Analysis Services に接続します。</span><span class="sxs-lookup"><span data-stu-id="9114b-203">Connect to Analysis Services via an application service (such as SharePoint or Reporting Services) from a remote client computer.</span></span> <span data-ttu-id="9114b-204">Audit Login イベントに、Analysis Services に接続しているユーザーの ID が表示されます。</span><span class="sxs-lookup"><span data-stu-id="9114b-204">The Audit Login event will show the identity of the user connecting to Analysis Services.</span></span>  
  
 <span data-ttu-id="9114b-205">徹底的なテストを行うには、ネットワーク上の Kerberos 要求と応答を取得できるネットワーク監視ツールを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="9114b-205">Thorough testing will require the use of network monitoring tools that can capture Kerberos requests and responses on the network.</span></span> <span data-ttu-id="9114b-206">このタスクには、Kerberos 用にフィルター処理されたネットワーク モニター ユーティリティ (netmon.exe) を使用できます。</span><span class="sxs-lookup"><span data-stu-id="9114b-206">The Network Monitor utility (netmon.exe), filtered for Kerberos, can be used for this task.</span></span> <span data-ttu-id="9114b-207">Kerberos 認証をテストするための Netmon 3.4 などのツールの使用方法については、「 [Kerberos 認証を構成する: コア構成 (SharePoint Server 2010)](https://technet.microsoft.com/library/gg502602\(v=office.14\).aspx)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9114b-207">For more information about using Netmon 3.4 and other tools for testing Kerberos authentication, see [Configuring Kerberos authentication: Core configuration (SharePoint Server 2010)](https://technet.microsoft.com/library/gg502602\(v=office.14\).aspx).</span></span>  
  
 <span data-ttu-id="9114b-208">また、Active Directory オブジェクトの [プロパティ] ダイアログ ボックスにある [委任] タブの各オプションの詳細な説明については、「 [Active Directory 内で最も紛らわしいダイアログ ボックス](https://www.itprotoday.com/active-directory/most-confusing-dialog-box-active-directory) 」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="9114b-208">Additionally, see [The Most Confusing Dialog Box in Active Directory](https://www.itprotoday.com/active-directory/most-confusing-dialog-box-active-directory) for a thorough description of each option in the Delegation tab of the Active Directory object's property dialog box.</span></span> <span data-ttu-id="9114b-209">この記事ではまた、LDP を使ってテストし、テスト結果を解釈する方法を説明します。</span><span class="sxs-lookup"><span data-stu-id="9114b-209">This article also explains how to use LDP to test and interpret test results.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="9114b-210">参照</span><span class="sxs-lookup"><span data-stu-id="9114b-210">See Also</span></span>  
 <span data-ttu-id="9114b-211">[Microsoft BI 認証と Id 委任](https://go.microsoft.com/fwlink/?LinkID=286576) </span><span class="sxs-lookup"><span data-stu-id="9114b-211">[Microsoft BI Authentication and Identity Delegation](https://go.microsoft.com/fwlink/?LinkID=286576) </span></span>  
 <span data-ttu-id="9114b-212">[Kerberos を使用した相互認証](https://go.microsoft.com/fwlink/?LinkId=299283) </span><span class="sxs-lookup"><span data-stu-id="9114b-212">[Mutual Authentication Using Kerberos](https://go.microsoft.com/fwlink/?LinkId=299283) </span></span>  
 <span data-ttu-id="9114b-213">[Analysis Services への接続](connect-to-analysis-services.md) </span><span class="sxs-lookup"><span data-stu-id="9114b-213">[Connect to Analysis Services](connect-to-analysis-services.md) </span></span>  
 <span data-ttu-id="9114b-214">[Analysis Services インスタンスの SPN の登録](spn-registration-for-an-analysis-services-instance.md) </span><span class="sxs-lookup"><span data-stu-id="9114b-214">[SPN registration for an Analysis Services instance](spn-registration-for-an-analysis-services-instance.md) </span></span>  
 [<span data-ttu-id="9114b-215">接続文字列プロパティ &#40;Analysis Services&#41;</span><span class="sxs-lookup"><span data-stu-id="9114b-215">Connection String Properties &#40;Analysis Services&#41;</span></span>](connection-string-properties-analysis-services.md)  
  
  
