---
title: 予測クエリ (データマイニング) |Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: analysis-services
ms.topic: conceptual
ms.assetid: e5e6686c-1360-480e-8c0d-8a56204fbed9
author: minewiskan
ms.author: owend
ms.openlocfilehash: 543055aaed5d8991ed2c913a6ae46575c774e216
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87718968"
---
# <a name="prediction-queries-data-mining"></a><span data-ttu-id="6e993-102">Prediction Queries (Data Mining)</span><span class="sxs-lookup"><span data-stu-id="6e993-102">Prediction Queries (Data Mining)</span></span>
  <span data-ttu-id="6e993-103">一般的なデータ マイニング プロジェクトの目標は、マイニング モデルを使用して予測を行うことです。</span><span class="sxs-lookup"><span data-stu-id="6e993-103">The goal of a typical data mining project is to use the mining model to make predictions.</span></span> <span data-ttu-id="6e993-104">たとえば、あるサーバーの集まりのダウンタイムを予測したり、顧客区分が広告キャンペーンに反応するかどうかを示すスコアを生成したりする場合があります。</span><span class="sxs-lookup"><span data-stu-id="6e993-104">For example, you might want to predict the amount of expected downtime for a certain cluster of servers, or generate a score that indicates whether segments of customers are likely to respond to an advertising campaign.</span></span> <span data-ttu-id="6e993-105">これらすべてを行うには、予測クエリを作成します。</span><span class="sxs-lookup"><span data-stu-id="6e993-105">To do all these things, you would create a prediction query.</span></span>  
  
 <span data-ttu-id="6e993-106">クエリに対する入力の種類に応じて、さまざまな機能の予測クエリが SQL Server でサポートされています。</span><span class="sxs-lookup"><span data-stu-id="6e993-106">Functionally, there are different types of prediction queries supported in SQL Server, depending on the type of inputs to the query:</span></span>  
  
|<span data-ttu-id="6e993-107">クエリの型</span><span class="sxs-lookup"><span data-stu-id="6e993-107">Query Type</span></span>|<span data-ttu-id="6e993-108">[クエリ オプション]</span><span class="sxs-lookup"><span data-stu-id="6e993-108">Query Options</span></span>|  
|----------------|-------------------|  
|<span data-ttu-id="6e993-109">単一予測クエリ</span><span class="sxs-lookup"><span data-stu-id="6e993-109">Singleton prediction queries</span></span>|<span data-ttu-id="6e993-110">1 つまたは複数の新しいケースについて結果を予測する場合に、単一クエリを使用します。</span><span class="sxs-lookup"><span data-stu-id="6e993-110">Use a singleton query when you want to predict outcomes for a single new case, or multiple new cases.</span></span> <span data-ttu-id="6e993-111">入力値をクエリに直接指定し、クエリは単一セッションとして実行されます。</span><span class="sxs-lookup"><span data-stu-id="6e993-111">You provide the input values directly in the query, and the query is executed as a single session.</span></span>|  
|<span data-ttu-id="6e993-112">バッチ予測</span><span class="sxs-lookup"><span data-stu-id="6e993-112">Batch predictions</span></span>|<span data-ttu-id="6e993-113">外部データをモデルに供給して、予測のベースとして使用するときは、バッチ予測を使用します。</span><span class="sxs-lookup"><span data-stu-id="6e993-113">Use batch predictions when you have external data that you want to feed into the model, to use as the basis for predictions.</span></span> <span data-ttu-id="6e993-114">データ全体について予測するには、外部ソースのデータをモデルの列にマップしてから、出力する予測データの種類を指定します。</span><span class="sxs-lookup"><span data-stu-id="6e993-114">To make predictions for an entire set of data, you map the data in the external source to the columns in the model, and then specify the type of predictive data you want to output.</span></span><br /><br /> <span data-ttu-id="6e993-115">データセット全体のクエリが単一セッションで実行され、複数のクエリを繰り返すよりも効率が高くなります。</span><span class="sxs-lookup"><span data-stu-id="6e993-115">The query for the entire dataset is executed in a single session, making this option much more efficient than sending multiple repeated queries.</span></span>|  
|<span data-ttu-id="6e993-116">時系列予測</span><span class="sxs-lookup"><span data-stu-id="6e993-116">Time Series predictions</span></span>|<span data-ttu-id="6e993-117">いくつかの期間に対して値を予測するときは、時系列クエリを使用します。</span><span class="sxs-lookup"><span data-stu-id="6e993-117">Use a time series query when you want to predict a value over some number of future steps.</span></span> <span data-ttu-id="6e993-118">SQL Server データ マイニングでは、時系列クエリに次の機能も用意されています。</span><span class="sxs-lookup"><span data-stu-id="6e993-118">SQL Server Data Mining also provides the following functionality in time series queries:</span></span><br /><br /> <span data-ttu-id="6e993-119">新しいデータをクエリの一部として追加して、既存のモデルを拡張し、複合系列に基づいて予測を行うことができます。</span><span class="sxs-lookup"><span data-stu-id="6e993-119">You can extend an existing model by adding new data as part of the query, and make predictions based on the composite series.</span></span><br /><br /> <span data-ttu-id="6e993-120">REPLACE_MODEL_CASES オプションを使用して既存のモデルを新しいデータ系列に適用できます。</span><span class="sxs-lookup"><span data-stu-id="6e993-120">You can apply an existing model to a new data series by using the REPLACE_MODEL_CASES option.</span></span><br /><br /> <span data-ttu-id="6e993-121">クロス予測を実行することができます。</span><span class="sxs-lookup"><span data-stu-id="6e993-121">You can perform cross-prediction.</span></span>|  
  
 <span data-ttu-id="6e993-122">以下の各セクションで、予測クエリの一般的構文、さまざまな種類の予測クエリ、および予測クエリの結果の操作方法について説明していきます。</span><span class="sxs-lookup"><span data-stu-id="6e993-122">The following sections describe the general syntax of prediction queries, the different types of prediction queries, and how to work with the results of prediction queries.</span></span>  
  
 [<span data-ttu-id="6e993-123">予測クエリの基本デザイン</span><span class="sxs-lookup"><span data-stu-id="6e993-123">Basic Prediction Query Design</span></span>](#bkmk_PredQuery)  
  
-   [<span data-ttu-id="6e993-124">予測関数の追加</span><span class="sxs-lookup"><span data-stu-id="6e993-124">Adding Prediction Functions</span></span>](#bkmk_PredFunc)  
  
-   [<span data-ttu-id="6e993-125">単一クエリ</span><span class="sxs-lookup"><span data-stu-id="6e993-125">Singleton Queries</span></span>](#bkmk_SingletonQuery)  
  
-   [<span data-ttu-id="6e993-126">バッチ予測クエリ</span><span class="sxs-lookup"><span data-stu-id="6e993-126">Batch Prediction Queries</span></span>](#bkmk_BatchQuery)  
  
 [<span data-ttu-id="6e993-127">クエリ結果の操作</span><span class="sxs-lookup"><span data-stu-id="6e993-127">Working with the Results of Queries</span></span>](#bkmk_WorkResults)  
  
##  <a name="basic-prediction-query-design"></a><a name="bkmk_PredQuery"></a> <span data-ttu-id="6e993-128">予測クエリの基本デザイン</span><span class="sxs-lookup"><span data-stu-id="6e993-128">Basic Prediction Query Design</span></span>  
 <span data-ttu-id="6e993-129">予測を作成するときには、モデルに新しいデータを渡して、その新しいデータに基づいて予測を生成するように要求するのが一般的です。</span><span class="sxs-lookup"><span data-stu-id="6e993-129">When you create a prediction, you typically provide some piece of new data and ask the model to generate a prediction based on the new data.</span></span>  
  
-   <span data-ttu-id="6e993-130">バッチ予測クエリでは、 *予測結合*を使用してモデルを外部ソースのデータにマップします。</span><span class="sxs-lookup"><span data-stu-id="6e993-130">In a batch prediction query, you map the model to an external source of data by using a *prediction join*.</span></span>  
  
-   <span data-ttu-id="6e993-131">単一予測クエリでは、入力として使用する 1 つ以上の値を入力します。</span><span class="sxs-lookup"><span data-stu-id="6e993-131">In a singleton prediction query, you type one or more values to use as inputs.</span></span> <span data-ttu-id="6e993-132">単一予測クエリを使用して複数の予測を作成することができます。</span><span class="sxs-lookup"><span data-stu-id="6e993-132">You can create multiple predictions using a singleton prediction query.</span></span> <span data-ttu-id="6e993-133">ただし、多数の予測を作成する必要がある場合は、バッチ クエリを使用するとパフォーマンスが向上します。</span><span class="sxs-lookup"><span data-stu-id="6e993-133">However, if you need to create many predictions, performance is better when you use a batch query.</span></span>  
  
 <span data-ttu-id="6e993-134">単一クエリとバッチ予測クエリの両方で、PREDICTION JOIN 構文を使用して新規データを定義します。</span><span class="sxs-lookup"><span data-stu-id="6e993-134">Both singleton and batch prediction queries use the PREDICTION JOIN syntax to define the new data.</span></span> <span data-ttu-id="6e993-135">違いは、予測結合の入力側の指定方法です。</span><span class="sxs-lookup"><span data-stu-id="6e993-135">The difference is in how the input side of the prediction join is specified.</span></span>  
  
-   <span data-ttu-id="6e993-136">バッチ予測クエリでは、データは OPENQUERY 構文を使用して指定する外部データ ソースから提供されます。</span><span class="sxs-lookup"><span data-stu-id="6e993-136">In a batch prediction query, the data comes from an external data source that is specified by using the OPENQUERY syntax.</span></span>  
  
-   <span data-ttu-id="6e993-137">単一予測クエリでは、データはクエリの一部としてインラインで提供されます。</span><span class="sxs-lookup"><span data-stu-id="6e993-137">In a singleton prediction query, the data is supplied inline as part of the query.</span></span>  
  
 <span data-ttu-id="6e993-138">時系列モデルの場合、入力データは常に必要となるわけではありません。モデルに既に含まれるデータのみを使用して予測することができます。</span><span class="sxs-lookup"><span data-stu-id="6e993-138">For time series models, input data is not always required; it is possible to make predictions using just the data already in the model.</span></span> <span data-ttu-id="6e993-139">ただし、新しい入力データを指定した場合は、新しいデータ更新を使用してモデルを更新して拡張するか、モデルで使用されていた元の系列データを置換するかを決定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="6e993-139">However, if you do specify new input data, you must decide whether you will use the new data to update and extend the model, or to replace the original series of data that was used in the model.</span></span>  <span data-ttu-id="6e993-140">これらのオプションの詳細については、「 [Time Series Model Query Examples](time-series-model-query-examples.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="6e993-140">For more information about these options, see [Time Series Model Query Examples](time-series-model-query-examples.md).</span></span>  
  
###  <a name="adding-prediction-functions"></a><a name="bkmk_PredFunc"></a><span data-ttu-id="6e993-141">予測関数の追加</span><span class="sxs-lookup"><span data-stu-id="6e993-141">Adding Prediction Functions</span></span>  
 <span data-ttu-id="6e993-142">予測クエリをカスタマイズすると、値を予測するだけでなく、その予測に関連するさまざまな種類の情報を取得することができます。</span><span class="sxs-lookup"><span data-stu-id="6e993-142">In addition to predicting a value, you can customize a prediction query to return various kinds of information that are related to the prediction.</span></span> <span data-ttu-id="6e993-143">たとえば、予測によりある顧客に推奨する製品の一覧を作成する場合、各予測が当たる確率を取得するのも良いでしょう。各予測をランク付けし、上位の推奨品だけをその顧客に勧めます。</span><span class="sxs-lookup"><span data-stu-id="6e993-143">For example, if the prediction creates a list of products to recommend to a customer, you might also want to return the probability for each prediction, so that you can rank them and present only the top recommendations to the user.</span></span>  
  
 <span data-ttu-id="6e993-144">これを行うには、クエリに *予測関数* を追加します。</span><span class="sxs-lookup"><span data-stu-id="6e993-144">To do this, you add *prediction functions* to the query.</span></span> <span data-ttu-id="6e993-145">サポートされる関数は、モデルやクエリの種類ごとに決まっています。</span><span class="sxs-lookup"><span data-stu-id="6e993-145">Each model or query type supports specific functions.</span></span> <span data-ttu-id="6e993-146">たとえばクラスター モデルでは、モデルによって作成されたクラスターに関する追加情報を提供する特殊な予測関数がサポートされています。一方、タイム シリーズ モデルには、時間経過に伴って生じる違いを計算する関数があります。</span><span class="sxs-lookup"><span data-stu-id="6e993-146">For example, clustering models support special prediction functions that provide extra detail about the clusters created by the model, whereas time series models have functions that calculate differences over time.</span></span> <span data-ttu-id="6e993-147">ほぼすべての種類のモデルで使用できる汎用の予測関数もあります。</span><span class="sxs-lookup"><span data-stu-id="6e993-147">There are also general prediction functions that work with almost all model types.</span></span> <span data-ttu-id="6e993-148">さまざまな種類のクエリでサポートされる予測関数の一覧については、DMX リファレンスの「[一般的な予測関数 &#40;DMX&#41;](/sql/dmx/general-prediction-functions-dmx)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="6e993-148">For a list of the prediction functions supported in different types of queries, see this topic the DMX reference:  [General Prediction Functions &#40;DMX&#41;](/sql/dmx/general-prediction-functions-dmx).</span></span>  
  
###  <a name="creating-singleton-prediction-queries"></a><a name="bkmk_SingletonQuery"></a> <span data-ttu-id="6e993-149">単一予測クエリの作成</span><span class="sxs-lookup"><span data-stu-id="6e993-149">Creating Singleton Prediction Queries</span></span>  
 <span data-ttu-id="6e993-150">単一予測クエリは、予測をリアルタイムですぐに作成する場合に便利です。</span><span class="sxs-lookup"><span data-stu-id="6e993-150">A singleton prediction query is useful when you want to create quick predictions in real time.</span></span> <span data-ttu-id="6e993-151">一般的な使用手順としては、Web サイトのフォームを使用して顧客から情報を取得し、そのデータを入力として単一予測クエリに提出します。</span><span class="sxs-lookup"><span data-stu-id="6e993-151">A common scenario might be that you have obtained information from a customer, perhaps by using a form on a Web site, and you want to submit that data as the input to a singleton prediction query.</span></span> <span data-ttu-id="6e993-152">たとえば、顧客が一覧から製品を選択すると、その選択内容を、お勧め製品を予測するクエリの入力として使用できます。</span><span class="sxs-lookup"><span data-stu-id="6e993-152">For example, when a customer chooses a product from a list, you could use that selection as the input to a query that predicts the best products to recommend.</span></span>  
  
 <span data-ttu-id="6e993-153">単一予測クエリには、入力を格納する独立したテーブルは必要ありません。</span><span class="sxs-lookup"><span data-stu-id="6e993-153">Singleton prediction queries do not require a separate table that contains input.</span></span> <span data-ttu-id="6e993-154">代わりに、入力として 1 行以上の値をモデルに提供し、1 件以上の予測をリアルタイムに取得します。</span><span class="sxs-lookup"><span data-stu-id="6e993-154">Instead, you provide one or multiple rows of values as input to the model, and the prediction or predictions are returned in real time.</span></span>  
  
> [!WARNING]  
>  <span data-ttu-id="6e993-155">名前にかかわらず、単一予測クエリは単一の予測を行うだけではありません。入力の各セットに対して複数の予測を生成できます。</span><span class="sxs-lookup"><span data-stu-id="6e993-155">Despite the name, singleton prediction queries do not just make single predictions-you can generate multiple predictions for each set of inputs.</span></span> <span data-ttu-id="6e993-156">入力ケースごとに SELECT ステートメントを作成し、それらを UNION 演算子で組み合わせて、複数の入力ケースを指定します。</span><span class="sxs-lookup"><span data-stu-id="6e993-156">You provide multiple input cases by creating a SELECT statement for each input case and combining them with the UNION operator.</span></span>  
  
 <span data-ttu-id="6e993-157">単一予測クエリを作成するときには、新しいデータを PREDICTION JOIN の形式でモデルに渡す必要があります。</span><span class="sxs-lookup"><span data-stu-id="6e993-157">When you create a singleton prediction query, you must provide the new data to the model in the form of a PREDICTION JOIN.</span></span> <span data-ttu-id="6e993-158">したがって、実際のテーブルにマップするわけではなくても、新しいデータをマイニング モデルの既存の列に必ず一致させる必要があります。</span><span class="sxs-lookup"><span data-stu-id="6e993-158">This means that even though you are not mapping to an actual table, you must make sure that the new data matches the existing columns in the mining model.</span></span> <span data-ttu-id="6e993-159">新しいデータ列と新しいデータが完全に一致する場合は、 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] によってそれらの列が自動的にマップされます。</span><span class="sxs-lookup"><span data-stu-id="6e993-159">If the new data columns and the new data match exactly, [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] will map the columns for you.</span></span> <span data-ttu-id="6e993-160">これを *NATURAL PREDICTION JOIN*と呼びます。</span><span class="sxs-lookup"><span data-stu-id="6e993-160">This is called a *NATURAL PREDICTION JOIN*.</span></span> <span data-ttu-id="6e993-161">一方、列が一致しない場合 (モデルに含まれているのと同じ種類および量のデータが新しいデータに含まれていない場合) は、モデルのどの列を新しいデータにマップするのかを指定するか、不足値を指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="6e993-161">However, if the columns do not match, or if the new data does not contain the same kind and amount of data that is in the model, you must specify which columns in the model map to the new data, or specify the missing values.</span></span>  
  
###  <a name="batch-prediction-queries"></a><a name="bkmk_BatchQuery"></a> <span data-ttu-id="6e993-162">バッチ予測クエリ</span><span class="sxs-lookup"><span data-stu-id="6e993-162">Batch Prediction Queries</span></span>  
 <span data-ttu-id="6e993-163">バッチ予測クエリが役立つのは、予測の作成に使用できる外部データがある場合です。</span><span class="sxs-lookup"><span data-stu-id="6e993-163">A batch prediction query is useful when you have external data that you want to use in making predictions.</span></span> <span data-ttu-id="6e993-164">たとえば、オンラインでの操作と購入履歴に基づいて顧客を分類するモデルを構築したとします。</span><span class="sxs-lookup"><span data-stu-id="6e993-164">For example, you might have built a model that categorizes customers by their online activity and purchasing history.</span></span> <span data-ttu-id="6e993-165">このモデルを、新しく獲得した見込み客の一覧に適用すると、売上予測の作成、または提案されたキャンペーンの目標設定を行うことができます。</span><span class="sxs-lookup"><span data-stu-id="6e993-165">You could apply that model to a list of newly acquired leads, to create projections for sales, or to identify targets for proposed campaigns.</span></span>  
  
 <span data-ttu-id="6e993-166">予測結合を実行するときは、モデルの列を新しいデータ ソースの列にマップする必要があります。</span><span class="sxs-lookup"><span data-stu-id="6e993-166">When you perform a prediction join, you must map the columns the model to the columns in the new data source.</span></span> <span data-ttu-id="6e993-167">このため、入力用に選択するデータ ソースは、モデルのデータと類似したデータである必要があります。</span><span class="sxs-lookup"><span data-stu-id="6e993-167">Therefore, the data source that you choose for an input must data that is somewhat similar to the data in the model.</span></span> <span data-ttu-id="6e993-168">新しい情報は、厳密に一致する必要はなく、完全でなくてもかまいません。</span><span class="sxs-lookup"><span data-stu-id="6e993-168">The new information does not have to match exactly, and can be incomplete.</span></span> <span data-ttu-id="6e993-169">たとえば、モデルが所得と年齢に関する情報を使用してトレーニングされ、予測に使用する顧客リストには年齢情報があり、所得に関する情報はないとします。</span><span class="sxs-lookup"><span data-stu-id="6e993-169">For example, suppose the model was trained using information about income and age, but the customer list you are using for predictions has age but nothing about income.</span></span> <span data-ttu-id="6e993-170">この状況でも、新しいデータをモデルにマップし、各顧客の予測を作成できます。</span><span class="sxs-lookup"><span data-stu-id="6e993-170">In this scenario, you could still map the new data to the model and create a prediction for each customer.</span></span> <span data-ttu-id="6e993-171">ただし、所得がモデルの重要な予測子である場合、完全な情報がないことは予測の品質に影響します。</span><span class="sxs-lookup"><span data-stu-id="6e993-171">However, if income was an important predictor for the model, the lack of complete information would affect the quality of predictions.</span></span>  
  
 <span data-ttu-id="6e993-172">最良の結果を得るためには、新しいデータとモデルの間で一致する列をできるだけ多く結合する必要があります。</span><span class="sxs-lookup"><span data-stu-id="6e993-172">To get the best results, you should join as many of the matching columns as possible between the new data and the model.</span></span> <span data-ttu-id="6e993-173">ただし、一致する列がなくてもクエリは成功します。</span><span class="sxs-lookup"><span data-stu-id="6e993-173">However, the query will succeed even if there are no matches.</span></span> <span data-ttu-id="6e993-174">結合されている列がない場合は、マージナル予測が返されます。これは、PREDICTION JOIN 句を含まない `SELECT <predictable-column> FROM <model>` ステートメントと同じです。</span><span class="sxs-lookup"><span data-stu-id="6e993-174">If no columns are joined, the query will return the marginal prediction, which is equivalent to the statement `SELECT <predictable-column> FROM <model>` without a PREDICTION JOIN clause.</span></span>  
  
 <span data-ttu-id="6e993-175">関連するすべての列のマップが終了したらクエリを実行します。 [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] によって、モデル内のパターンに基づいて新しいデータの各行の予測が行われます。</span><span class="sxs-lookup"><span data-stu-id="6e993-175">After you have successfully mapped all relevant columns, you run the query, and [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] makes predictions for each row in the new data based on patterns in the model.</span></span> <span data-ttu-id="6e993-176">外部データを含むデータ ソース ビューの新しいテーブルに結果を保存することができます。あるいは、 [!INCLUDE[ssBIDevStudioFull](../../includes/ssbidevstudiofull-md.md)] または [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]を使用している場合は、データをコピーして貼り付けることができます。</span><span class="sxs-lookup"><span data-stu-id="6e993-176">You can save the results back to a new table in the data source view that contains the external data, or you can copy and paste the data is you are using [!INCLUDE[ssBIDevStudioFull](../../includes/ssbidevstudiofull-md.md)] or [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)].</span></span>  
  
> [!WARNING]  
>  <span data-ttu-id="6e993-177">[!INCLUDE[ssBIDevStudioFull](../../includes/ssbidevstudiofull-md.md)]のデザイナーを使用する場合は、先に外部データ ソースをデータ ソース ビューとして定義しておく必要があります。</span><span class="sxs-lookup"><span data-stu-id="6e993-177">If you use the designer in [!INCLUDE[ssBIDevStudioFull](../../includes/ssbidevstudiofull-md.md)], the external data source must first be defined as a data source view.</span></span>  
  
 <span data-ttu-id="6e993-178">DMX を使用して予測結合を作成する場合は、OPENQUERY、OPENROWSET、または SHAPE の各コマンドを使用して外部データ ソースを指定できます。</span><span class="sxs-lookup"><span data-stu-id="6e993-178">If you use DMX to create a prediction join, you can specify the external data source by using the OPENQUERY, OPENROWSET, or SHAPE commands.</span></span> <span data-ttu-id="6e993-179">DMX テンプレートの既定のデータ アクセス メソッドは OPENQUERY です。</span><span class="sxs-lookup"><span data-stu-id="6e993-179">The default data access method in the DMX templates is OPENQUERY.</span></span> <span data-ttu-id="6e993-180">これらのメソッドの詳細については、「[&#60;source data query&#62;](/sql/dmx/source-data-query)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="6e993-180">For information about these methods, see [&#60;source data query&#62;](/sql/dmx/source-data-query).</span></span>  
  
###  <a name="predictions-in-time-series-mining-models"></a><a name="bkmk_TSQuery"></a> <span data-ttu-id="6e993-181">時系列マイニング モデルの予測</span><span class="sxs-lookup"><span data-stu-id="6e993-181">Predictions in Time Series Mining Models</span></span>  
 <span data-ttu-id="6e993-182">時系列モデルは他の種類のモデルとは異なります。モデルをそのまま使用して予測を作成することも、モデルに新しいデータを渡し、モデルを更新して、最新の傾向に基づいて予測を作成することもできます。</span><span class="sxs-lookup"><span data-stu-id="6e993-182">Time series models are different from other models types; you can either use the model as it is to create predictions, or you can provide new data to the model to update the model and create predictions based on recent trends.</span></span> <span data-ttu-id="6e993-183">新しいデータを追加する場合は、新しいデータの使用方法を指定できます。</span><span class="sxs-lookup"><span data-stu-id="6e993-183">If you add new data, you can specify the way the new data should be used.</span></span>  
  
-   <span data-ttu-id="6e993-184">*モデル ケースの拡張* では、時系列モデルの既存のデータ系列に新しいデータを追加します。</span><span class="sxs-lookup"><span data-stu-id="6e993-184">*Extending the model cases* means that you add the new data onto the existing series of data in the time series model.</span></span> <span data-ttu-id="6e993-185">その後、新しい組み合わせの系列に基づいて予測が行われます。</span><span class="sxs-lookup"><span data-stu-id="6e993-185">Henceforth, predictions are based on the new, combined series.</span></span> <span data-ttu-id="6e993-186">このオプションは、既存のモデルに追加するデータ ポイントが少ないときに適しています。</span><span class="sxs-lookup"><span data-stu-id="6e993-186">This option is good when you want to simply add a few data points to an existing model.</span></span>  
  
     <span data-ttu-id="6e993-187">たとえば、前年の売上データでトレーニングされた既存の時系列モデルがあったとします。</span><span class="sxs-lookup"><span data-stu-id="6e993-187">For example, suppose that you have an existing time series model that has been trained on the sales data from the previous year.</span></span> <span data-ttu-id="6e993-188">新しい売上データを数か月にわたって収集した後、現在の年の売上予測を更新します。</span><span class="sxs-lookup"><span data-stu-id="6e993-188">After you have collected several months of new sales data, you decide to update your sales forecasts for the current year.</span></span> <span data-ttu-id="6e993-189">この場合は、予測結合を作成して、新しいデータを追加してモデルを更新し、新しい予測が行われるようにモデルを拡張します。</span><span class="sxs-lookup"><span data-stu-id="6e993-189">You can create a prediction join that updates the model by adding new data and extends the model to make new predictions.</span></span>  
  
-   <span data-ttu-id="6e993-190">*モデル ケースの置換* では、トレーニング済みのモデルは保持されますが、基になるケースが新しいケース データのセットで置換されます。</span><span class="sxs-lookup"><span data-stu-id="6e993-190">*Replacing the model cases* means that you keep the trained model, but replace the underlying cases with a new set of case data.</span></span> <span data-ttu-id="6e993-191">モデルの傾向を維持して、別のデータ系列に適用するときは、このオプションが便利です。</span><span class="sxs-lookup"><span data-stu-id="6e993-191">This option is useful when you want to keep the trend in the model, but apply it to a different set of data.</span></span>  
  
     <span data-ttu-id="6e993-192">たとえば、元のモデルが、売上高が非常に高いデータ セットでトレーニングされたとします。新しい系列 (売上高が低い店舗のデータ) で元のデータを置換すると、傾向は保持されますが、置換系列の値に基づいた予測が開始されます。</span><span class="sxs-lookup"><span data-stu-id="6e993-192">For example, your original model might have been trained on a set of data with very high sales volumes; when you replace the underlying data with a new series (perhaps from a store with lower sales volume), you preserve the trend, but the predictions begin from the values in the replacement series.</span></span>  
  
 <span data-ttu-id="6e993-193">どちらの方法を使用する場合も、予測の開始位置は常に元の系列の末尾になります。</span><span class="sxs-lookup"><span data-stu-id="6e993-193">Regardless of which approach you use, the starting point for predictions is always the end of the original series.</span></span>  
  
 <span data-ttu-id="6e993-194">時系列モデルで予測結合を作成する方法の詳細については、「[タイム シリーズ モデルのクエリ例](time-series-model-query-examples.md)」または「[PredictTimeSeries &#40;DMX&#41;](/sql/dmx/predicttimeseries-dmx)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="6e993-194">For more information about how to create prediction joins on time series models, see [Time Series Model Query Examples](time-series-model-query-examples.md) or [PredictTimeSeries &#40;DMX&#41;](/sql/dmx/predicttimeseries-dmx).</span></span>  
  
##  <a name="working-with-the-results-of-a-prediction-query"></a><a name="bkmk_WorkResults"></a> <span data-ttu-id="6e993-195">予測クエリの結果の操作</span><span class="sxs-lookup"><span data-stu-id="6e993-195">Working with the Results of a Prediction Query</span></span>  
 <span data-ttu-id="6e993-196">データ マイニング予測クエリの結果を保存するオプションは、クエリの作成方法に応じて異なります。</span><span class="sxs-lookup"><span data-stu-id="6e993-196">Your options for saving the results of a data mining prediction query are different depending on how you create the query.</span></span>  
  
-   <span data-ttu-id="6e993-197">[!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] または [!INCLUDE[ssBIDevStudioFull](../../includes/ssbidevstudiofull-md.md)]で予測クエリ ビルダーを使用してクエリを作成する場合は、予測クエリの結果を既存の [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] データ ソースに保存できます。</span><span class="sxs-lookup"><span data-stu-id="6e993-197">When you build a query using Prediction Query Builder in either [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] or [!INCLUDE[ssBIDevStudioFull](../../includes/ssbidevstudiofull-md.md)], you can save the results of a prediction query to an existing [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] data source.</span></span> <span data-ttu-id="6e993-198">詳しくは、「 [予測クエリの結果の表示および保存](view-and-save-the-results-of-a-prediction-query.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="6e993-198">For more information, see [View and Save the Results of a Prediction Query](view-and-save-the-results-of-a-prediction-query.md).</span></span>  
  
-   <span data-ttu-id="6e993-199">[!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]の [クエリ] ペインで DMX を使用して予測クエリを作成する場合は、クエリの出力オプションを使用して結果をファイルに保存するか、[クエリ結果] ペインにテキストとして、またはグリッドに保存できます。</span><span class="sxs-lookup"><span data-stu-id="6e993-199">When you create prediction queries using DMX in the Query pane of [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], you can use the query output options to save the results to a file, or to the Query Results pane as text or in a grid.</span></span> <span data-ttu-id="6e993-200">詳細については、「[クエリおよびテキスト エディター &#40;SQL Server Management Studio&#41;](../../relational-databases/scripting/query-and-text-editors-sql-server-management-studio.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="6e993-200">For more information, see [Query and Text Editors &#40;SQL Server Management Studio&#41;](../../relational-databases/scripting/query-and-text-editors-sql-server-management-studio.md).</span></span>  
  
-   <span data-ttu-id="6e993-201">Integration Services コンポーネントを使用して予測クエリを実行する場合、タスクでは、使用可能な ADO.NET 接続マネージャーまたは OLEDB 接続マネージャーを使用して結果をデータベースに書き込む機能が提供されます。</span><span class="sxs-lookup"><span data-stu-id="6e993-201">When you run a prediction query using the Integration Services components, the tasks provides the ability to write the results to a database by using an available ADO.NET connection manager or OLEDB connection manager.</span></span> <span data-ttu-id="6e993-202">詳細については、「 [Data Mining Query Task](../../integration-services/control-flow/data-mining-query-task.md)」をご参照ください。</span><span class="sxs-lookup"><span data-stu-id="6e993-202">For more information, see [Data Mining Query Task](../../integration-services/control-flow/data-mining-query-task.md).</span></span>  
  
 <span data-ttu-id="6e993-203">予測クエリの結果は、関連する値の単一行を常に返すリレーショナル データベースに対するクエリの結果とは異なることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="6e993-203">It is important to understand that the results of a prediction query are not like the results of a query on a relational database, which always returns a single row of related values.</span></span> <span data-ttu-id="6e993-204">クエリに追加した DMX 予測関数からそれぞれ独自の行セットが返されます。</span><span class="sxs-lookup"><span data-stu-id="6e993-204">Each DMX prediction function that you add to a query returns its own rowset.</span></span> <span data-ttu-id="6e993-205">このため、単一のケースについて予測を行った結果、予測値と共に、入れ子になったテーブルの複数列が返され、余分な詳細が含まれていることもあります。</span><span class="sxs-lookup"><span data-stu-id="6e993-205">Therefore, when you make a prediction on a single case, the result might be a predicted value together with several columns of nested tables containing additional detail.</span></span>  
  
 <span data-ttu-id="6e993-206">1 つのクエリで複数の関数を組み合わせて使用した場合、返される結果は常に階層的な行セットとして結合されます。</span><span class="sxs-lookup"><span data-stu-id="6e993-206">If you combine multiple functions in one query, the return results are combined as a hierarchical rowset.</span></span> <span data-ttu-id="6e993-207">たとえば、次の DMX ステートメントのようなクエリを使用して、タイム シリーズ モデルを使用して売上高と販売数量の将来の値を予測するとします。</span><span class="sxs-lookup"><span data-stu-id="6e993-207">For example, say you use a time series model to predict future values for sales amount and sales quantity, using a query such as this DMX statement:</span></span>  
  
```  
SELECT  
  PredictTimeSeries([Forecasting].[Amount]) as [PredictedAmount]  
, PredictTimeSeries([Forecasting].[Quantity]) as [PredictedQty]  
FROM  
  [Forecasting]  
  
```  
  
 <span data-ttu-id="6e993-208">このクエリの結果には 2 つの列 (予測値を格納する入れ子になったテーブルを各行に含む予測系列ごとに 1 つの列) があります。</span><span class="sxs-lookup"><span data-stu-id="6e993-208">The results of this query are two columns, one for each predicted series, where each row contains a nested table with the predicted values:</span></span>  
  
 <span data-ttu-id="6e993-209">**PredictedAmount**</span><span class="sxs-lookup"><span data-stu-id="6e993-209">**PredictedAmount**</span></span>  
  
|<span data-ttu-id="6e993-210">$TIME</span><span class="sxs-lookup"><span data-stu-id="6e993-210">$TIME</span></span>|<span data-ttu-id="6e993-211">Amount (金額)</span><span class="sxs-lookup"><span data-stu-id="6e993-211">Amount</span></span>|  
|-----------|------------|  
|<span data-ttu-id="6e993-212">201101</span><span class="sxs-lookup"><span data-stu-id="6e993-212">201101</span></span>|<span data-ttu-id="6e993-213">172067.11</span><span class="sxs-lookup"><span data-stu-id="6e993-213">172067.11</span></span>|  
  
|<span data-ttu-id="6e993-214">$TIME</span><span class="sxs-lookup"><span data-stu-id="6e993-214">$TIME</span></span>|<span data-ttu-id="6e993-215">Amount (金額)</span><span class="sxs-lookup"><span data-stu-id="6e993-215">Amount</span></span>|  
|-----------|------------|  
|<span data-ttu-id="6e993-216">201102</span><span class="sxs-lookup"><span data-stu-id="6e993-216">201102</span></span>|<span data-ttu-id="6e993-217">363390.68</span><span class="sxs-lookup"><span data-stu-id="6e993-217">363390.68</span></span>|  
  
 <span data-ttu-id="6e993-218">**PredictedQty**</span><span class="sxs-lookup"><span data-stu-id="6e993-218">**PredictedQty**</span></span>  
  
|<span data-ttu-id="6e993-219">$TIME</span><span class="sxs-lookup"><span data-stu-id="6e993-219">$TIME</span></span>|<span data-ttu-id="6e993-220">Quantity</span><span class="sxs-lookup"><span data-stu-id="6e993-220">Quantity</span></span>|  
|-----------|--------------|  
|<span data-ttu-id="6e993-221">201101</span><span class="sxs-lookup"><span data-stu-id="6e993-221">201101</span></span>|<span data-ttu-id="6e993-222">77</span><span class="sxs-lookup"><span data-stu-id="6e993-222">77</span></span>|  
  
|<span data-ttu-id="6e993-223">$TIME</span><span class="sxs-lookup"><span data-stu-id="6e993-223">$TIME</span></span>|<span data-ttu-id="6e993-224">Quantity</span><span class="sxs-lookup"><span data-stu-id="6e993-224">Quantity</span></span>|  
|-----------|--------------|  
|<span data-ttu-id="6e993-225">201102</span><span class="sxs-lookup"><span data-stu-id="6e993-225">201102</span></span>|<span data-ttu-id="6e993-226">260</span><span class="sxs-lookup"><span data-stu-id="6e993-226">260</span></span>|  
  
 <span data-ttu-id="6e993-227">階層的な行セットを処理できないプロバイダーを使用している場合は、予測クエリ内で FLATTEN キーワードを使用して結果をフラット化することができます。</span><span class="sxs-lookup"><span data-stu-id="6e993-227">If your provider cannot handle hierarchical rowsets, you can flatten the results by using the FLATTEN keyword in the prediction query.</span></span> <span data-ttu-id="6e993-228">フラットな行セットの例などの詳細については、「[SELECT &#40;DMX&#41;](/sql/dmx/select-dmx)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="6e993-228">For more information, including examples of flattened rowsets, see [SELECT &#40;DMX&#41;](/sql/dmx/select-dmx).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="6e993-229">参照</span><span class="sxs-lookup"><span data-stu-id="6e993-229">See Also</span></span>  
 <span data-ttu-id="6e993-230">[データマイニング &#40;コンテンツクエリ&#41;](content-queries-data-mining.md) </span><span class="sxs-lookup"><span data-stu-id="6e993-230">[Content Queries &#40;Data Mining&#41;](content-queries-data-mining.md) </span></span>  
 [<span data-ttu-id="6e993-231">データ定義クエリ &#40;データ マイニング&#41;</span><span class="sxs-lookup"><span data-stu-id="6e993-231">Data Definition Queries &#40;Data Mining&#41;</span></span>](data-definition-queries-data-mining.md)  
  
  
