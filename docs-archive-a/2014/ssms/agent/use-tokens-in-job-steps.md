---
title: ジョブ ステップでのトークンの使用 | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ssms
ms.topic: conceptual
helpviewer_keywords:
- job steps [SQL Server Agent]
- security [SQL Server Agent], enabling alert job step tokens
- SQL Server Agent jobs, job steps
- tokens [SQL Server]
- escape macros [SQL Server Agent]
ms.assetid: 105bbb66-0ade-4b46-b8e4-f849e5fc4d43
author: stevestein
ms.author: sstein
ms.openlocfilehash: 9d90b6660dd4b65e4e1d9b832b39ffaa275c83bc
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87742730"
---
# <a name="use-tokens-in-job-steps"></a><span data-ttu-id="fdccf-102">ジョブ ステップでのトークンの使用</span><span class="sxs-lookup"><span data-stu-id="fdccf-102">Use Tokens in Job Steps</span></span>
  [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="fdccf-103">エージェントを使用すると、 [!INCLUDE[tsql](../../includes/tsql-md.md)] ジョブ ステップ スクリプトでトークンを使用できます。</span><span class="sxs-lookup"><span data-stu-id="fdccf-103">Agent allows you to use tokens in [!INCLUDE[tsql](../../includes/tsql-md.md)] job step scripts.</span></span> <span data-ttu-id="fdccf-104">ジョブ ステップを記述するときにトークンを使用すると、ソフトウェア プログラムを記述するときの変数と同じような柔軟性が得られます。</span><span class="sxs-lookup"><span data-stu-id="fdccf-104">Using tokens when you write your job steps gives you the same flexibility that variables provide when you write software programs.</span></span> <span data-ttu-id="fdccf-105">ジョブ ステップ スクリプトにトークンを挿入した後、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] サブシステムでジョブ ステップが実行される前に、 [!INCLUDE[tsql](../../includes/tsql-md.md)] エージェントにより実行時にトークンが置き換えられます。</span><span class="sxs-lookup"><span data-stu-id="fdccf-105">After you insert a token in a job step script, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent replaces the token at run time, before the job step is executed by the [!INCLUDE[tsql](../../includes/tsql-md.md)] subsystem.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="fdccf-106">[!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] Service Pack 1 以降では、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] エージェントのジョブ ステップ トークンの構文が変更されています。</span><span class="sxs-lookup"><span data-stu-id="fdccf-106">Starting with [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] Service Pack 1, the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent job step token syntax changed.</span></span> <span data-ttu-id="fdccf-107">その結果、エスケープ マクロには、ジョブ ステップで使用するすべてのトークンを含める必要があります。すべてのトークンが含まれていないと、ジョブ ステップは失敗します。</span><span class="sxs-lookup"><span data-stu-id="fdccf-107">As a result, an escape macro must now accompany all tokens used in job steps, or else those job steps will fail.</span></span> <span data-ttu-id="fdccf-108">エスケープ マクロの使用およびトークンを使用する [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] エージェントのジョブ ステップの更新については、「トークンの使用について」、「[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] エージェントのトークンとマクロ」、および「マクロを使用するジョブ ステップの更新」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="fdccf-108">Using escape macros and updating your [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent job steps that use tokens are described in the following sections, "Understanding Using Tokens," "[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent Tokens and Macros," and "Updating Job Steps to Use Macros."</span></span> <span data-ttu-id="fdccf-109">さらに、 [!INCLUDE[ssVersion2000](../../includes/ssversion2000-md.md)] エージェントのジョブ ステップ トークンの呼び出しに角かっこを使用していた [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] の構文 (たとえば、"`[DATE]`") も変更されました。</span><span class="sxs-lookup"><span data-stu-id="fdccf-109">In addition, the [!INCLUDE[ssVersion2000](../../includes/ssversion2000-md.md)] syntax, which used square brackets to call out [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent job step tokens (for example, "`[DATE]`") has also changed.</span></span> <span data-ttu-id="fdccf-110">つまり、トークン名はかっこで囲み、トークン構文の先頭にはドル記号 (`$`) を付けることが必要になりました。</span><span class="sxs-lookup"><span data-stu-id="fdccf-110">You must now enclose token names in parentheses and place a dollar sign (`$`) at the beginning of the token syntax.</span></span> <span data-ttu-id="fdccf-111">例:</span><span class="sxs-lookup"><span data-stu-id="fdccf-111">For example:</span></span>  
>   
>  <span data-ttu-id="fdccf-112">`$(ESCAPE_` *マクロ名* `(DATE))`</span><span class="sxs-lookup"><span data-stu-id="fdccf-112">`$(ESCAPE_` *macro name* `(DATE))`</span></span>  
  
## <a name="understanding-using-tokens"></a><span data-ttu-id="fdccf-113">トークンの使用について</span><span class="sxs-lookup"><span data-stu-id="fdccf-113">Understanding Using Tokens</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="fdccf-114">Windows イベント ログに対して書き込みのアクセス許可を持っている Windows ユーザーであればだれでも、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] エージェントの警告または WMI 警告によってアクティブ化されるジョブ ステップにアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="fdccf-114">Any Windows user with write permissions on the Windows Event Log can access job steps that are activated by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent alerts or WMI alerts.</span></span> <span data-ttu-id="fdccf-115">このセキュリティ上のリスクを避けるために、警告によってアクティブになるジョブで使用できる [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] エージェント トークンは、既定で無効になっています。</span><span class="sxs-lookup"><span data-stu-id="fdccf-115">To avoid this security risk, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent tokens that can be used in jobs activated by alerts are disabled by default.</span></span> <span data-ttu-id="fdccf-116">これらのトークンは次のとおりです。- **DBN**、 **-SVR**、 **-ERR**、**重大度**、 **a-MSG**、および**WMI ( *`property`* )**。</span><span class="sxs-lookup"><span data-stu-id="fdccf-116">These tokens are: **A-DBN**, **A-SVR**, **A-ERR**, **A-SEV**, **A-MSG**., and **WMI(*`property`*)**.</span></span> <span data-ttu-id="fdccf-117">このリリースでは、トークンの使用はすべての警告に拡張されていることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="fdccf-117">Note that in this release, use of tokens is extended to all alerting.</span></span>  
>   
>  <span data-ttu-id="fdccf-118">これらのトークンを使用する必要がある場合は、まず、Administrators グループなどの信頼されている Windows セキュリティ グループのメンバーのみが、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] が存在するコンピューターのイベント ログに対して書き込みのアクセス許可を持っていることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="fdccf-118">If you need to use these tokens, first ensure that only members of trusted Windows security groups, such as the Administrators group, have write permissions on the Event Log of the computer where [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] resides.</span></span> <span data-ttu-id="fdccf-119">確認したら、[オブジェクト エクスプローラー] で **[SQL Server エージェント]** を右クリックし、 **[プロパティ]** をクリックします。次に、 **[警告システム]** ページで、 **[警告に応答するすべてのジョブのトークンを置き換える]** チェック ボックスをオンにして、これらのトークンを有効にします。</span><span class="sxs-lookup"><span data-stu-id="fdccf-119">Then, right-click **SQL Server Agent** in Object Explorer, select **Properties**, and on the **Alert System** page, select **Replace tokens for all job responses to alerts** to enable these tokens.</span></span>  
  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="fdccf-120">エージェントのトークンの置換は簡単で効率的です。 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] エージェントにより、トークンのリテラル文字列値にそのまま置き換えられます。</span><span class="sxs-lookup"><span data-stu-id="fdccf-120">Agent token replacement is simple and efficient: [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent replaces an exact literal string value for the token.</span></span> <span data-ttu-id="fdccf-121">すべてのトークンには大文字と小文字の区別があります。</span><span class="sxs-lookup"><span data-stu-id="fdccf-121">All tokens are case-sensitive.</span></span> <span data-ttu-id="fdccf-122">ジョブ ステップでは、この点を考慮し、使用するトークンを正しく引用したり、置換後の文字列を正しいデータ型に変換したりする必要があります。</span><span class="sxs-lookup"><span data-stu-id="fdccf-122">Your job steps must take this into account and correctly quote the tokens you use or convert the replacement string to the correct data type.</span></span>  
  
 <span data-ttu-id="fdccf-123">たとえば、ジョブ ステップでデータベースの名前を表示するときに、次のステートメントを使用する場合があります。</span><span class="sxs-lookup"><span data-stu-id="fdccf-123">For example, you might use the following statement to print the name of the database in a job step:</span></span>  
  
 `PRINT N'Current database name is $(ESCAPE_SQUOTE(A-DBN))' ;`  
  
 <span data-ttu-id="fdccf-124">この例では、 **ESCAPE_SQUOTE** マクロは **A-DBN** トークンと共に挿入されます。</span><span class="sxs-lookup"><span data-stu-id="fdccf-124">In this example, the **ESCAPE_SQUOTE** macro is inserted with the **A-DBN** token.</span></span> <span data-ttu-id="fdccf-125">実行時に、 **A-DBN** トークンは適切なデータベース名に置き換えられます。</span><span class="sxs-lookup"><span data-stu-id="fdccf-125">At run time, the **A-DBN** token will be replaced with the appropriate database name.</span></span> <span data-ttu-id="fdccf-126">エスケープ マクロにより、トークンの置換後の文字列に誤って渡される可能性がある単一引用符がエスケープされます。</span><span class="sxs-lookup"><span data-stu-id="fdccf-126">The escape macro escapes any single quotation marks that may be inadvertently passed in the token replacement string.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="fdccf-127">エージェントにより、最後の文字列にある 1 つの単一引用符が 2 つの連続する単一引用符に置き換えられます。</span><span class="sxs-lookup"><span data-stu-id="fdccf-127">Agent will replace one single quotation mark with two single quotation marks in the final string.</span></span>  
  
 <span data-ttu-id="fdccf-128">たとえば、トークンを置き換えるために渡される文字列が `AdventureWorks2012'SELECT @@VERSION --`の場合、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] エージェントのジョブ ステップで実行されるコマンドは次のようになります。</span><span class="sxs-lookup"><span data-stu-id="fdccf-128">For example, if the string passed to replace the token is `AdventureWorks2012'SELECT @@VERSION --`, the command executed by the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent job step will be:</span></span>  
  
 `PRINT N'Current database name is AdventureWorks2012''SELECT @@VERSION --' ;`  
  
 <span data-ttu-id="fdccf-129">この場合、挿入されたステートメント `SELECT @@VERSION`は実行されません。</span><span class="sxs-lookup"><span data-stu-id="fdccf-129">In this case, the inserted statement, `SELECT @@VERSION`, does not execute.</span></span> <span data-ttu-id="fdccf-130">代わりに、追加の単一引用符によって、サーバーは挿入されたステートメントを文字列として解析します。</span><span class="sxs-lookup"><span data-stu-id="fdccf-130">Instead, the extra single quotation mark causes the server to parse the inserted statement as a string.</span></span> <span data-ttu-id="fdccf-131">トークンの置換後の文字列に単一引用符が含まれていない場合は、エスケープされる文字はなく、トークンを含むジョブ ステップが意図したとおりに実行されます。</span><span class="sxs-lookup"><span data-stu-id="fdccf-131">If the token replacement string does not contain a single quotation mark, no characters are escaped and the job step containing the token executes as intended.</span></span>  
  
 <span data-ttu-id="fdccf-132">ジョブ ステップでのトークンの使用をデバッグするには、 `PRINT N'$(ESCAPE_SQUOTE(SQLDIR))'` のような PRINT ステートメントを使用して、ジョブ ステップの出力をファイルまたはテーブルに保存します。</span><span class="sxs-lookup"><span data-stu-id="fdccf-132">To debug token usage in your job steps, use print statements such as `PRINT N'$(ESCAPE_SQUOTE(SQLDIR))'` and save job step output to a file or table.</span></span> <span data-ttu-id="fdccf-133">**[ジョブ ステップのプロパティ]** ダイアログ ボックスの **[詳細設定]** ページを使用して、ジョブ ステップの出力ファイルまたはテーブルを指定します。</span><span class="sxs-lookup"><span data-stu-id="fdccf-133">Use the **Advanced** page of the **Job Step Properties** dialog box to specify a job step output file or table.</span></span>  
  
## <a name="sql-server-agent-tokens-and-macros"></a><span data-ttu-id="fdccf-134">SQL Server エージェントのトークンとマクロ</span><span class="sxs-lookup"><span data-stu-id="fdccf-134">SQL Server Agent Tokens and Macros</span></span>  
 <span data-ttu-id="fdccf-135">次の表では、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] エージェントでサポートされているトークンとマクロについて説明します。</span><span class="sxs-lookup"><span data-stu-id="fdccf-135">The following tables list and describe the tokens and macros that [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent supports.</span></span>  
  
### <a name="sql-server-agent-tokens"></a><span data-ttu-id="fdccf-136">SQL Server エージェントのトークン</span><span class="sxs-lookup"><span data-stu-id="fdccf-136">SQL Server Agent Tokens</span></span>  
  
|<span data-ttu-id="fdccf-137">トークン</span><span class="sxs-lookup"><span data-stu-id="fdccf-137">Token</span></span>|<span data-ttu-id="fdccf-138">説明</span><span class="sxs-lookup"><span data-stu-id="fdccf-138">Description</span></span>|  
|-----------|-----------------|  
|<span data-ttu-id="fdccf-139">**(A-DBN)**</span><span class="sxs-lookup"><span data-stu-id="fdccf-139">**(A-DBN)**</span></span>|<span data-ttu-id="fdccf-140">データベース名。</span><span class="sxs-lookup"><span data-stu-id="fdccf-140">Database name.</span></span> <span data-ttu-id="fdccf-141">ジョブが警告によって実行される場合、ジョブ ステップのこのトークンは自動的にデータベース名の値に置き換えられます。</span><span class="sxs-lookup"><span data-stu-id="fdccf-141">If the job is run by an alert, the database name value automatically replaces this token in the job step.</span></span>|  
|<span data-ttu-id="fdccf-142">**(A-SVR)**</span><span class="sxs-lookup"><span data-stu-id="fdccf-142">**(A-SVR)**</span></span>|<span data-ttu-id="fdccf-143">サーバー名。</span><span class="sxs-lookup"><span data-stu-id="fdccf-143">Server name.</span></span> <span data-ttu-id="fdccf-144">ジョブが警告によって実行される場合、ジョブ ステップのこのトークンは自動的にサーバー名の値に置き換えられます。</span><span class="sxs-lookup"><span data-stu-id="fdccf-144">If the job is run by an alert, the server name value automatically replaces this token in the job step.</span></span>|  
|<span data-ttu-id="fdccf-145">**(A-ERR)**</span><span class="sxs-lookup"><span data-stu-id="fdccf-145">**(A-ERR)**</span></span>|<span data-ttu-id="fdccf-146">エラー番号。</span><span class="sxs-lookup"><span data-stu-id="fdccf-146">Error number.</span></span> <span data-ttu-id="fdccf-147">ジョブが警告によって実行される場合、ジョブ ステップのこのトークンは自動的にエラー番号の値に置き換えられます。</span><span class="sxs-lookup"><span data-stu-id="fdccf-147">If the job is run by an alert, the error number value automatically replaces this token in the job step.</span></span>|  
|<span data-ttu-id="fdccf-148">**(A-SEV)**</span><span class="sxs-lookup"><span data-stu-id="fdccf-148">**(A-SEV)**</span></span>|<span data-ttu-id="fdccf-149">エラーの重大度。</span><span class="sxs-lookup"><span data-stu-id="fdccf-149">Error severity.</span></span> <span data-ttu-id="fdccf-150">ジョブが警告によって実行される場合、ジョブ ステップのこのトークンは自動的にエラー重大度の値に置き換えられます。</span><span class="sxs-lookup"><span data-stu-id="fdccf-150">If the job is run by an alert, the error severity value automatically replaces this token in the job step.</span></span>|  
|<span data-ttu-id="fdccf-151">**(A-MSG)**</span><span class="sxs-lookup"><span data-stu-id="fdccf-151">**(A-MSG)**</span></span>|<span data-ttu-id="fdccf-152">メッセージ テキスト。</span><span class="sxs-lookup"><span data-stu-id="fdccf-152">Message text.</span></span> <span data-ttu-id="fdccf-153">ジョブが警告によって実行される場合、ジョブ ステップのこのトークンは自動的にメッセージ テキストの値に置き換えられます。</span><span class="sxs-lookup"><span data-stu-id="fdccf-153">If the job is run by an alert, the message text value automatically replaces this token in the job step.</span></span>|  
|<span data-ttu-id="fdccf-154">**予定**</span><span class="sxs-lookup"><span data-stu-id="fdccf-154">**(DATE)**</span></span>|<span data-ttu-id="fdccf-155">YYYYMMDD 形式で表す現在の日付。</span><span class="sxs-lookup"><span data-stu-id="fdccf-155">Current date (in YYYYMMDD format).</span></span>|  
|<span data-ttu-id="fdccf-156">**命令**</span><span class="sxs-lookup"><span data-stu-id="fdccf-156">**(INST)**</span></span>|<span data-ttu-id="fdccf-157">インスタンス名。</span><span class="sxs-lookup"><span data-stu-id="fdccf-157">Instance name.</span></span> <span data-ttu-id="fdccf-158">既定のインスタンスの場合、このトークンは既定のインスタンス名、MSSQLSERVER になります。</span><span class="sxs-lookup"><span data-stu-id="fdccf-158">For a default instance, this token will have the default instance name: MSSQLSERVER.</span></span>|  
|<span data-ttu-id="fdccf-159">**JOBID**</span><span class="sxs-lookup"><span data-stu-id="fdccf-159">**(JOBID)**</span></span>|<span data-ttu-id="fdccf-160">ジョブ ID。</span><span class="sxs-lookup"><span data-stu-id="fdccf-160">Job ID.</span></span>|  
|<span data-ttu-id="fdccf-161">**(MACH)**</span><span class="sxs-lookup"><span data-stu-id="fdccf-161">**(MACH)**</span></span>|<span data-ttu-id="fdccf-162">コンピューター名。</span><span class="sxs-lookup"><span data-stu-id="fdccf-162">Computer name.</span></span>|  
|<span data-ttu-id="fdccf-163">**(MSSA)**</span><span class="sxs-lookup"><span data-stu-id="fdccf-163">**(MSSA)**</span></span>|<span data-ttu-id="fdccf-164">マスター SQLServerAgent サービス名。</span><span class="sxs-lookup"><span data-stu-id="fdccf-164">Master SQLServerAgent service name.</span></span>|  
|<span data-ttu-id="fdccf-165">**(OSCMD)**</span><span class="sxs-lookup"><span data-stu-id="fdccf-165">**(OSCMD)**</span></span>|<span data-ttu-id="fdccf-166">**CmdExec** ジョブ ステップの実行に使用されるプログラムのプレフィックス。</span><span class="sxs-lookup"><span data-stu-id="fdccf-166">Prefix for the program used to run **CmdExec** job steps.</span></span>|  
|<span data-ttu-id="fdccf-167">**(SQLDIR)**</span><span class="sxs-lookup"><span data-stu-id="fdccf-167">**(SQLDIR)**</span></span>|<span data-ttu-id="fdccf-168">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] がインストールされているディレクトリ。</span><span class="sxs-lookup"><span data-stu-id="fdccf-168">The directory in which [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is installed.</span></span> <span data-ttu-id="fdccf-169">特に指定しない限り、この値は C:\Program Files\Microsoft SQL Server\MSSQL です。</span><span class="sxs-lookup"><span data-stu-id="fdccf-169">By default, this value is C:\Program Files\Microsoft SQL Server\MSSQL.</span></span>|  
|<span data-ttu-id="fdccf-170">**(SQLLOGDIR)**</span><span class="sxs-lookup"><span data-stu-id="fdccf-170">**(SQLLOGDIR)**</span></span>|<span data-ttu-id="fdccf-171">SQL Server のエラー ログ フォルダー パスを表す置換トークン。たとえば、$ (ESCAPE_SQUOTE (SQLLOGDIR))。</span><span class="sxs-lookup"><span data-stu-id="fdccf-171">Replacement token for the SQL Server error log folder path - for example, $(ESCAPE_SQUOTE(SQLLOGDIR)).</span></span>|  
|<span data-ttu-id="fdccf-172">**(STEPCT)**</span><span class="sxs-lookup"><span data-stu-id="fdccf-172">**(STEPCT)**</span></span>|<span data-ttu-id="fdccf-173">対象となるステップが実行された回数。ただし、再試行は除きます。</span><span class="sxs-lookup"><span data-stu-id="fdccf-173">A count of the number of times this step has executed (excluding retries).</span></span> <span data-ttu-id="fdccf-174">ステップ コマンドでこの値を使用して、マルチステップ ループを強制終了させることができます。</span><span class="sxs-lookup"><span data-stu-id="fdccf-174">Can be used by the step command to force termination of a multistep loop.</span></span>|  
|<span data-ttu-id="fdccf-175">**(STEPID)**</span><span class="sxs-lookup"><span data-stu-id="fdccf-175">**(STEPID)**</span></span>|<span data-ttu-id="fdccf-176">ステップ ID。</span><span class="sxs-lookup"><span data-stu-id="fdccf-176">Step ID.</span></span>|  
|<span data-ttu-id="fdccf-177">**(SRVR)**</span><span class="sxs-lookup"><span data-stu-id="fdccf-177">**(SRVR)**</span></span>|<span data-ttu-id="fdccf-178">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]を実行しているコンピューターの名前。</span><span class="sxs-lookup"><span data-stu-id="fdccf-178">Name of the computer running [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="fdccf-179">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] インスタンスが名前付きインスタンスである場合は、これにインスタンス名が含まれます。</span><span class="sxs-lookup"><span data-stu-id="fdccf-179">If the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance is a named instance, this includes the instance name.</span></span>|  
|<span data-ttu-id="fdccf-180">**ごと**</span><span class="sxs-lookup"><span data-stu-id="fdccf-180">**(TIME)**</span></span>|<span data-ttu-id="fdccf-181">HHMMSS 形式で表す現在の時刻。</span><span class="sxs-lookup"><span data-stu-id="fdccf-181">Current time (in HHMMSS format).</span></span>|  
|<span data-ttu-id="fdccf-182">**(STRTTM)**</span><span class="sxs-lookup"><span data-stu-id="fdccf-182">**(STRTTM)**</span></span>|<span data-ttu-id="fdccf-183">HHMMSS 形式で表すジョブの実行開始時刻。</span><span class="sxs-lookup"><span data-stu-id="fdccf-183">The time (in HHMMSS format) that the job began executing.</span></span>|  
|<span data-ttu-id="fdccf-184">**(STRTDT)**</span><span class="sxs-lookup"><span data-stu-id="fdccf-184">**(STRTDT)**</span></span>|<span data-ttu-id="fdccf-185">YYYYMMDD 形式で表すジョブの実行開始日。</span><span class="sxs-lookup"><span data-stu-id="fdccf-185">The date (in YYYYMMDD format) that the job began executing.</span></span>|  
|<span data-ttu-id="fdccf-186">**(WMI(** *property* **))**</span><span class="sxs-lookup"><span data-stu-id="fdccf-186">**(WMI(** *property* **))**</span></span>|<span data-ttu-id="fdccf-187">WMI 警告に応答して実行されるジョブの場合、 *プロパティ*で指定したプロパティの値。</span><span class="sxs-lookup"><span data-stu-id="fdccf-187">For jobs that run in response to WMI alerts, the value of the property specified by *property*.</span></span> <span data-ttu-id="fdccf-188">たとえば、 `$(WMI(DatabaseName))` では、警告が実行される原因となった WMI イベントの **DatabaseName** プロパティの値が得られます。</span><span class="sxs-lookup"><span data-stu-id="fdccf-188">For example, `$(WMI(DatabaseName))` provides the value of the **DatabaseName** property for the WMI event that caused the alert to run.</span></span>|  
  
### <a name="sql-server-agent-escape-macros"></a><span data-ttu-id="fdccf-189">SQL Server エージェントのエスケープ マクロ</span><span class="sxs-lookup"><span data-stu-id="fdccf-189">SQL Server Agent Escape Macros</span></span>  
  
|<span data-ttu-id="fdccf-190">エスケープ マクロ</span><span class="sxs-lookup"><span data-stu-id="fdccf-190">Escape Macros</span></span>|<span data-ttu-id="fdccf-191">説明</span><span class="sxs-lookup"><span data-stu-id="fdccf-191">Description</span></span>|  
|-------------------|-----------------|  
|<span data-ttu-id="fdccf-192">**$(ESCAPE_SQUOTE(** *token_name* **))**</span><span class="sxs-lookup"><span data-stu-id="fdccf-192">**$(ESCAPE_SQUOTE(** *token_name* **))**</span></span>|<span data-ttu-id="fdccf-193">トークンの置換後の文字列にある単一引用符 (') をエスケープします。</span><span class="sxs-lookup"><span data-stu-id="fdccf-193">Escapes single quotation marks (') in the token replacement string.</span></span> <span data-ttu-id="fdccf-194">1 つの単一引用符を 2 つの連続する単一引用符に置き換えます。</span><span class="sxs-lookup"><span data-stu-id="fdccf-194">Replaces one single quotation mark with two single quotation marks.</span></span>|  
|<span data-ttu-id="fdccf-195">**$(ESCAPE_DQUOTE(** *token_name* **))**</span><span class="sxs-lookup"><span data-stu-id="fdccf-195">**$(ESCAPE_DQUOTE(** *token_name* **))**</span></span>|<span data-ttu-id="fdccf-196">トークンの置換後の文字列にある二重引用符 (") をエスケープします。</span><span class="sxs-lookup"><span data-stu-id="fdccf-196">Escapes double quotation marks (") in the token replacement string.</span></span> <span data-ttu-id="fdccf-197">1 つの二重引用符を 2 つの連続する二重引用符に置き換えます。</span><span class="sxs-lookup"><span data-stu-id="fdccf-197">Replaces one double quotation mark with two double quotation marks.</span></span>|  
|<span data-ttu-id="fdccf-198">**$(ESCAPE_RBRACKET(** *token_name* **))**</span><span class="sxs-lookup"><span data-stu-id="fdccf-198">**$(ESCAPE_RBRACKET(** *token_name* **))**</span></span>|<span data-ttu-id="fdccf-199">トークンの置換後の文字列にある右角かっこ (]) をエスケープします。</span><span class="sxs-lookup"><span data-stu-id="fdccf-199">Escapes right brackets (]) in the token replacement string.</span></span> <span data-ttu-id="fdccf-200">1 つの右角かっこを 2 つの連続する右角かっこに置き換えます。</span><span class="sxs-lookup"><span data-stu-id="fdccf-200">Replaces one right bracket with two right brackets.</span></span>|  
|<span data-ttu-id="fdccf-201">**$(ESCAPE_NONE(** *token_name* **))**</span><span class="sxs-lookup"><span data-stu-id="fdccf-201">**$(ESCAPE_NONE(** *token_name* **))**</span></span>|<span data-ttu-id="fdccf-202">文字列内の文字をエスケープせずにトークンを置き換えます。</span><span class="sxs-lookup"><span data-stu-id="fdccf-202">Replaces token without escaping any characters in the string.</span></span> <span data-ttu-id="fdccf-203">このマクロは、トークンの置換後の文字列を信頼されたユーザーのみが必要としている環境で、旧バージョンとの互換性をサポートするために用意されています。</span><span class="sxs-lookup"><span data-stu-id="fdccf-203">This macro is provided to support backward compatibility in environments where token replacement strings are only expected from trusted users.</span></span> <span data-ttu-id="fdccf-204">詳細については、このトピックの「マクロを使用するジョブ ステップの更新」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="fdccf-204">For more information, see "Updating Job Steps to Use Macros," later in this topic.</span></span>|  
  
## <a name="updating-job-steps-to-use-macros"></a><span data-ttu-id="fdccf-205">マクロを使用するジョブ ステップの更新</span><span class="sxs-lookup"><span data-stu-id="fdccf-205">Updating Job Steps to Use Macros</span></span>  
 <span data-ttu-id="fdccf-206">[!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] Service Pack 1 以降では、エスケープ マクロを伴わないトークンを含むジョブ ステップは失敗し、エラー メッセージが返されます。このエラー メッセージは、ジョブを実行する前にマクロで更新する必要のあるトークンがジョブ ステップに 1 つ以上含まれていることを示します。</span><span class="sxs-lookup"><span data-stu-id="fdccf-206">Beginning with [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] Service Pack 1, job steps that contain tokens without escape macros will fail and return an error message indicating the job step contains one or more tokens that must be updated with a macro before the job can run.</span></span>  
  
 <span data-ttu-id="fdccf-207">[!INCLUDE[msCoName](../../includes/msconame-md.md)] サポート技術情報の資料 915845「 [SQL Server 2005 Service Pack 1 をインストールした後に、トークンを使用するジョブ ステップがジョブに含まれる場合、SQL Server エージェント ジョブが失敗します。](https://support.microsoft.com/kb/915845)」に記載されているスクリプトを使用すると、 **ESCAPE_NONE** マクロを含むトークンを使用するすべてのジョブ ステップを更新できます。</span><span class="sxs-lookup"><span data-stu-id="fdccf-207">A script is provided with [!INCLUDE[msCoName](../../includes/msconame-md.md)] Knowledge Base article 915845: [SQL Server Agent Job Steps That Use Tokens Fail in SQL Server 2005 Service Pack 1](https://support.microsoft.com/kb/915845).You can use this script to update all of your job steps that use tokens with the **ESCAPE_NONE** macro.</span></span> <span data-ttu-id="fdccf-208">このスクリプトを使用した後、トークンを使用するジョブ ステップをできるだけ早く確認し、 **ESCAPE_NONE** マクロを、ジョブ ステップのコンテキストに適したエスケープ マクロに置き換えることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="fdccf-208">After using this script, we recommend that you review your job steps that use tokens as soon as possible, and replace the **ESCAPE_NONE** macro with an escape macro that is appropriate for the job step context.</span></span>  
  
 <span data-ttu-id="fdccf-209">次の表では、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] エージェントでトークンの置換がどのように処理されるのかを説明します。</span><span class="sxs-lookup"><span data-stu-id="fdccf-209">The following table describes how token replacement is handled by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent.</span></span> <span data-ttu-id="fdccf-210">警告トークンの置換の有効と無効を切り替えるには、オブジェクト エクスプローラーで **[SQL Server エージェント]** を右クリックし、 **[プロパティ]** を選択します。次に、 **[警告システム]** ページの **[警告に応答するすべてのジョブのトークンを置き換える]** チェック ボックスをオンまたはオフにします。</span><span class="sxs-lookup"><span data-stu-id="fdccf-210">To turn alert token replacement on or off, right-click **SQL Server Agent** in Object Explorer, select **Properties**, and on the **Alert System** page, select or clear the **Replace tokens for all job responses to alerts** check box.</span></span>  
  
|<span data-ttu-id="fdccf-211">トークンの構文</span><span class="sxs-lookup"><span data-stu-id="fdccf-211">Token syntax</span></span>|<span data-ttu-id="fdccf-212">警告トークンの置換が有効な場合</span><span class="sxs-lookup"><span data-stu-id="fdccf-212">Alert token replacement on</span></span>|<span data-ttu-id="fdccf-213">警告トークンの置換が無効な場合</span><span class="sxs-lookup"><span data-stu-id="fdccf-213">Alert token replacement off</span></span>|  
|------------------|--------------------------------|---------------------------------|  
|<span data-ttu-id="fdccf-214">ESCAPE マクロを使用する</span><span class="sxs-lookup"><span data-stu-id="fdccf-214">ESCAPE macro used</span></span>|<span data-ttu-id="fdccf-215">ジョブ内のすべてのトークンが正常に置き換えられます。</span><span class="sxs-lookup"><span data-stu-id="fdccf-215">All tokens in jobs are successfully replaced.</span></span>|<span data-ttu-id="fdccf-216">警告によってアクティブ化されるトークンは置き換えられません。</span><span class="sxs-lookup"><span data-stu-id="fdccf-216">Tokens activated by alerts are not replaced.</span></span> <span data-ttu-id="fdccf-217">これらのトークン**は、-DBN**、 **-SVR**、- **ERR**、**重大度**、 **-MSG**、および**WMI ( *`property`* )** です。</span><span class="sxs-lookup"><span data-stu-id="fdccf-217">These tokens are **A-DBN**, **A-SVR**, **A-ERR**, **A-SEV**, **A-MSG**, and **WMI(*`property`*)**.</span></span> <span data-ttu-id="fdccf-218">他の静的なトークンは正常に置き換えられます。</span><span class="sxs-lookup"><span data-stu-id="fdccf-218">Other static tokens are replaced successfully.</span></span>|  
|<span data-ttu-id="fdccf-219">ESCAPE マクロを使用しない</span><span class="sxs-lookup"><span data-stu-id="fdccf-219">No ESCAPE macro used</span></span>|<span data-ttu-id="fdccf-220">トークンを含んでいるすべてのジョブが失敗します。</span><span class="sxs-lookup"><span data-stu-id="fdccf-220">Any jobs containing tokens fail.</span></span>|<span data-ttu-id="fdccf-221">トークンを含んでいるすべてのジョブが失敗します。</span><span class="sxs-lookup"><span data-stu-id="fdccf-221">Any jobs containing tokens fail.</span></span>|  
  
## <a name="token-syntax-update-examples"></a><span data-ttu-id="fdccf-222">トークンの構文の更新例</span><span class="sxs-lookup"><span data-stu-id="fdccf-222">Token Syntax Update Examples</span></span>  
  
### <a name="a-using-tokens-in-non-nested-strings"></a><span data-ttu-id="fdccf-223">A.</span><span class="sxs-lookup"><span data-stu-id="fdccf-223">A.</span></span> <span data-ttu-id="fdccf-224">入れ子になっていない文字列でトークンを使用する</span><span class="sxs-lookup"><span data-stu-id="fdccf-224">Using tokens in non-nested strings</span></span>  
 <span data-ttu-id="fdccf-225">次の例では、適切なエスケープ マクロを使用して入れ子になっていない単純なスクリプトを更新する方法を示します。</span><span class="sxs-lookup"><span data-stu-id="fdccf-225">The following example shows how to update a simple non-nested script with the appropriate escape macro.</span></span> <span data-ttu-id="fdccf-226">更新スクリプトを実行する前に、次のジョブ ステップ スクリプトで、ジョブ ステップ トークンを使用して適切なデータベース名を表示します。</span><span class="sxs-lookup"><span data-stu-id="fdccf-226">Before running the update script, the following job step script uses a job step token to print the appropriate database name:</span></span>  
  
 `PRINT N'Current database name is $(A-DBN)' ;`  
  
 <span data-ttu-id="fdccf-227">更新スクリプトを実行すると、 `ESCAPE_NONE` マクロが `A-DBN` トークンの前に挿入されます。</span><span class="sxs-lookup"><span data-stu-id="fdccf-227">After running the update script, an `ESCAPE_NONE` macro is inserted before the `A-DBN` token.</span></span> <span data-ttu-id="fdccf-228">表示する文字列を区切るために単一引用符が使用されているため、次のように、 `ESCAPE_SQUOTE` マクロを挿入してジョブ ステップを更新する必要があります。</span><span class="sxs-lookup"><span data-stu-id="fdccf-228">Because single quotation marks are used to delimit the print string, you must update the job step by inserting the `ESCAPE_SQUOTE` macro as follows:</span></span>  
  
 `PRINT N'Current database name is $(ESCAPE_SQUOTE(A-DBN))' ;`  
  
### <a name="b-using-tokens-in-nested-strings"></a><span data-ttu-id="fdccf-229">B.</span><span class="sxs-lookup"><span data-stu-id="fdccf-229">B.</span></span> <span data-ttu-id="fdccf-230">入れ子になっている文字列でトークンを使用する</span><span class="sxs-lookup"><span data-stu-id="fdccf-230">Using tokens in nested strings</span></span>  
 <span data-ttu-id="fdccf-231">トークンが入れ子になっている文字列やステートメントで使用されているジョブ ステップ スクリプトでは、入れ子になっているステートメントを複数のステートメントに書き直してから、適切なエスケープ マクロを挿入する必要があります。</span><span class="sxs-lookup"><span data-stu-id="fdccf-231">In job step scripts where tokens are used in nested strings or statements, the nested statements should be rewritten as multiple statements before inserting the appropriate escape macros.</span></span>  
  
 <span data-ttu-id="fdccf-232">たとえば、次のジョブ ステップを考えてみましょう。 `A-MSG` トークンを使用するこのジョブ ステップは、エスケープ マクロで更新されていません。</span><span class="sxs-lookup"><span data-stu-id="fdccf-232">For example, consider the following job step, which uses the `A-MSG` token and has not been updated with an escape macro:</span></span>  
  
 `PRINT N'Print ''$(A-MSG)''' ;`  
  
 <span data-ttu-id="fdccf-233">更新スクリプトを実行すると、 `ESCAPE_NONE` マクロがトークンと共に挿入されます。</span><span class="sxs-lookup"><span data-stu-id="fdccf-233">After running the update script, an `ESCAPE_NONE` macro is inserted with the token.</span></span> <span data-ttu-id="fdccf-234">ただし、この場合、次のように入れ子を使用しないスクリプトに書き直して `ESCAPE_SQUOTE` マクロを挿入し、トークンの置換後の文字列に渡される可能性がある区切り文字を正しくエスケープすることが必要な場合があります。</span><span class="sxs-lookup"><span data-stu-id="fdccf-234">However, in this case, you would have to rewrite the script without using nesting as follows and insert the `ESCAPE_SQUOTE` macro to properly escape delimiters that may be passed in the token replacement string:</span></span>  
  
 `DECLARE @msgString nvarchar(max)`  
  
 `SET @msgString = '$(ESCAPE_SQUOTE(A-MSG))'`  
  
 `SET @msgString = QUOTENAME(@msgString,'''')`  
  
 `PRINT N'Print ' + @msgString ;`  
  
 <span data-ttu-id="fdccf-235">また、この例では、QUOTENAME 関数によって引用符が設定されることにも注意してください。</span><span class="sxs-lookup"><span data-stu-id="fdccf-235">Note also in this example that the QUOTENAME function sets the quote character.</span></span>  
  
### <a name="c-using-tokens-with-the-escape_none-macro"></a><span data-ttu-id="fdccf-236">C.</span><span class="sxs-lookup"><span data-stu-id="fdccf-236">C.</span></span> <span data-ttu-id="fdccf-237">ESCAPE_NONE マクロと共にトークンを使用する</span><span class="sxs-lookup"><span data-stu-id="fdccf-237">Using tokens with the ESCAPE_NONE macro</span></span>  
 <span data-ttu-id="fdccf-238">次の例は、あるスクリプトの一部です。ここでは、 `job_id` テーブルから `sysjobs` を取得し、スクリプト内で既にバイナリ データ型として宣言された `JOBID` 変数を設定するために `@JobID` トークンを使用しています。</span><span class="sxs-lookup"><span data-stu-id="fdccf-238">The following example is part of a script that retrieves the `job_id` from the `sysjobs` table and uses the `JOBID` token to populate the `@JobID` variable, which was declared earlier in the script as a binary data type.</span></span> <span data-ttu-id="fdccf-239">バイナリ データ型には区切り文字が不要なので、 `ESCAPE_NONE` マクロは `JOBID` トークンと共に使用されることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="fdccf-239">Note that because no delimiters are required for binary data types, the `ESCAPE_NONE` macro is used with the `JOBID` token.</span></span> <span data-ttu-id="fdccf-240">更新スクリプトの実行後、このジョブ ステップを更新する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="fdccf-240">You would not need to update this job step after running the update script.</span></span>  
  
 `SELECT * FROM msdb.dbo.sysjobs`  
  
 `WHERE @JobID = CONVERT(uniqueidentifier, $(ESCAPE_NONE(JOBID))) ;`  
  
## <a name="see-also"></a><span data-ttu-id="fdccf-241">参照</span><span class="sxs-lookup"><span data-stu-id="fdccf-241">See Also</span></span>  
 <span data-ttu-id="fdccf-242">[ジョブの実装](implement-jobs.md) </span><span class="sxs-lookup"><span data-stu-id="fdccf-242">[Implement Jobs](implement-jobs.md) </span></span>  
 [<span data-ttu-id="fdccf-243">ジョブ ステップの管理</span><span class="sxs-lookup"><span data-stu-id="fdccf-243">Manage Job Steps</span></span>](manage-job-steps.md)  
  
  
