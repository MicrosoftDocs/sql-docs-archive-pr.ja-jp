---
title: 'Azure へのマネージバックアップの SQL Server: 相互運用性と共存 |Microsoft Docs'
description: この記事では、SQL Server 2014 のいくつかの機能との相互運用性と共存 Microsoft Azure の SQL Server 管理されたバックアップについて説明します。
ms.custom: ''
ms.date: 03/07/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
ms.assetid: 78fb78ed-653f-45fe-a02a-a66519bfee1b
author: mashamsft
ms.author: mathoma
ms.openlocfilehash: 2e2839fc4755fe47504e42e5058a5da117888900
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87716573"
---
# <a name="sql-server-managed-backup-to-azure-interoperability-and-coexistence"></a><span data-ttu-id="29bf5-103">Azure への SQL Server マネージド バックアップ:相互運用性と共存</span><span class="sxs-lookup"><span data-stu-id="29bf5-103">SQL Server Managed Backup to Azure: Interoperability and Coexistence</span></span>
  <span data-ttu-id="29bf5-104">このトピックでは、[!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] のいくつかの機能との [!INCLUDE[ssCurrent](../includes/sscurrent-md.md)]の相互運用性および共存について説明します。</span><span class="sxs-lookup"><span data-stu-id="29bf5-104">This topic describes [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] interoperability and coexistence with several features in [!INCLUDE[ssCurrent](../includes/sscurrent-md.md)].</span></span> <span data-ttu-id="29bf5-105">これらの機能には、AlwaysOn 可用性グループ、データベース ミラーリング、バックアップ メンテナンス プラン、ログ配布、アドホック バックアップ、データベースのデタッチ、およびデータベースの削除が含まれます。</span><span class="sxs-lookup"><span data-stu-id="29bf5-105">These features include the following: AlwaysOn Availability Groups, Database Mirroring, Backup Maintenance Plans, Log Shipping, Ad hoc backups, Detach Database, and Drop Database.</span></span>  
  
### <a name="alwayson-availability-groups"></a><span data-ttu-id="29bf5-106">AlwaysOn 可用性グループ</span><span class="sxs-lookup"><span data-stu-id="29bf5-106">AlwaysOn Availability Groups</span></span>  
 <span data-ttu-id="29bf5-107">でサポートされている Azure のみのソリューションとして構成されている AlwaysOn 可用性グループ [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] 。</span><span class="sxs-lookup"><span data-stu-id="29bf5-107">AlwaysOn Availability Groups that are configured as an Azure-only solution supported for [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)].</span></span> <span data-ttu-id="29bf5-108">内部設置型のみまたはハイブリッドの AlwaysOn 可用性グループの構成はサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="29bf5-108">On-premises only, or Hybrid AlwaysOn Availability Group configurations are not supported.</span></span> <span data-ttu-id="29bf5-109">詳細およびその他の考慮事項については、「[可用性グループの Azure への SQL Server マネージバックアップの設定](../../2014/database-engine/setting-up-sql-server-managed-backup-to-windows-azure-for-availability-groups.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="29bf5-109">For more information and other considerations, see [Setting up SQL Server Managed Backup to Azure for Availability Groups](../../2014/database-engine/setting-up-sql-server-managed-backup-to-windows-azure-for-availability-groups.md)</span></span>  
  
### <a name="database-mirroring"></a><span data-ttu-id="29bf5-110">データベース ミラーリング</span><span class="sxs-lookup"><span data-stu-id="29bf5-110">Database Mirroring</span></span>  
 [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]<span data-ttu-id="29bf5-111">は、プリンシパル データベースでのみサポートされます。</span><span class="sxs-lookup"><span data-stu-id="29bf5-111">is supported only on the principal database.</span></span> <span data-ttu-id="29bf5-112">プリンシパルとミラーの両方が [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]を使用するように構成されている場合、ミラーリングされたデータベースはスキップされ、バックアップされません。</span><span class="sxs-lookup"><span data-stu-id="29bf5-112">If both the principal and the mirror are configured to use [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)], the mirrored database is skipped and will not be backed up.</span></span> <span data-ttu-id="29bf5-113">ただしフェールオーバーが発生した場合、[!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]は、ミラーが役割の交代を完了してオンラインになった後に、バックアップ プロセスを開始します。</span><span class="sxs-lookup"><span data-stu-id="29bf5-113">However, in the event of a failover, [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] will start the backup process after the mirror has completed role switching and is online.</span></span> <span data-ttu-id="29bf5-114">この場合、バックアップは新しいコンテナーに格納されます。</span><span class="sxs-lookup"><span data-stu-id="29bf5-114">The backups will be stored in a new container in this case.</span></span> <span data-ttu-id="29bf5-115">ミラーが [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]を使用するように構成されていない場合は、フェールオーバー時にはバックアップがまったく作成されません。</span><span class="sxs-lookup"><span data-stu-id="29bf5-115">If the mirror is not configured to use [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)], in the event of a failover, no backups are taken.</span></span> <span data-ttu-id="29bf5-116">フェールオーバー時にもバックアップが継続されるように、プリンシパルとミラーの両方に対して [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]を構成することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="29bf5-116">We recommend that you configure [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] on both the principal and the mirror so backups continue in the event of a failover.</span></span>  
  
> [!TIP]  
>  <span data-ttu-id="29bf5-117">ミラー化されたデータベースを [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]の既定の設定でインスタンス上に作成する場合、ミラー化されたデータベースに適用されないように [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] インスタンスの既定値を無効にして、プリンシパルとミラーを構成した後でインスタンスの既定値を有効にする方が望ましいことがあります。</span><span class="sxs-lookup"><span data-stu-id="29bf5-117">If you are creating a mirrored database on an instance with [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] default settings, it may be preferable to disable [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] instance defaults, so they are not applied to the mirrored database, and then re-enable the instance defaults after configuring the Principal and the Mirror.</span></span>  
  
### <a name="maintenance-plan"></a><span data-ttu-id="29bf5-118">メンテナンスプラン</span><span class="sxs-lookup"><span data-stu-id="29bf5-118">Maintenance Plan</span></span>  
 <span data-ttu-id="29bf5-119">[!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]が有効になっている場合、データベースのバックアップ作成にメンテナンス プランを使用することはできません。</span><span class="sxs-lookup"><span data-stu-id="29bf5-119">Using Maintenance Plans for creating backups for a database when [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] is enabled is not supported.</span></span> <span data-ttu-id="29bf5-120">メンテナンス プランを使用すると、ログ チェーンが中断されます。また、[!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]では、復元中にデータベースの保障された復旧をサポートできなくなる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="29bf5-120">Maintenance plans will cause broken log chain and [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] may not be able to support a guaranteed recoverability of the database during restore.</span></span> <span data-ttu-id="29bf5-121">これは、[!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]がインスタンス レベルで有効になっている場合にも適用されます。</span><span class="sxs-lookup"><span data-stu-id="29bf5-121">This also applies when [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] is enabled at the instance level.</span></span>  
  
> [!TIP]  
>  <span data-ttu-id="29bf5-122">コピーのみのバックアップを指定したメンテナンス プランは、同じデータベースまたはインスタンスで [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]を構成することによってサポートされます。</span><span class="sxs-lookup"><span data-stu-id="29bf5-122">Maintenance Plans with Copy Only backups is supported with [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] configured for the same database or instance.</span></span>  
  
### <a name="log-shipping"></a><span data-ttu-id="29bf5-123">ログ配布</span><span class="sxs-lookup"><span data-stu-id="29bf5-123">Log Shipping</span></span>  
 <span data-ttu-id="29bf5-124">同じデータベースに対してログ配布と [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]を同時に構成することはできません。</span><span class="sxs-lookup"><span data-stu-id="29bf5-124">You cannot configure Log Shipping and [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] for the same database at the same time.</span></span> <span data-ttu-id="29bf5-125">同時に構成すると、いずれかの機能を使用したデータベースの復元に影響します。</span><span class="sxs-lookup"><span data-stu-id="29bf5-125">Doing so will affect the recoverability of the database using either functionality.</span></span>  
  
### <a name="ad-hoc-backups-using-transact-sql-and-sql-server-management-studio"></a><span data-ttu-id="29bf5-126">Transact-SQL と SQL Server Management Studio を使用したアドホック バックアップ</span><span class="sxs-lookup"><span data-stu-id="29bf5-126">Ad Hoc Backups Using Transact-SQL and SQL Server Management Studio</span></span>  
 <span data-ttu-id="29bf5-127">Transact-SQL または SQL Server Management Studio を使用して [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]の外部で作成したアドホック バックアップ (1 回限りのバックアップ) は、バックアップの種類と使用される記憶域メディアに応じて、[!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] プロセスに影響する場合があります。</span><span class="sxs-lookup"><span data-stu-id="29bf5-127">Ad hoc or one time backups created outside [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] using Transact-SQL or SQL Server Management Studio may affect the [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] process depending on the type of backup and the storage media used.</span></span> <span data-ttu-id="29bf5-128">を使用しているものとは別の Azure ストレージアカウント、 [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] または Azure Blob ストレージサービス以外の他の宛先にログバックアップを実行すると、ログチェーンが中断されます。</span><span class="sxs-lookup"><span data-stu-id="29bf5-128">Log backups to a different Azure storage account than what [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] is using, or any other destination than the Azure Blob storage service, will cause a log chain break.</span></span> <span data-ttu-id="29bf5-129">を有効にしたデータベースでバックアップを開始するには、 [smart_admin sp_backup_on_demand &#40;transact-sql&#41;](/sql/relational-databases/system-stored-procedures/managed-backup-sp-backup-on-demand-transact-sql)ストアドプロシージャを使用することをお勧めします。 [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]</span><span class="sxs-lookup"><span data-stu-id="29bf5-129">We recommend that you use the [smart_admin.sp_backup_on_demand &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/managed-backup-sp-backup-on-demand-transact-sql) stored procedure to initiate a backup on databases that have [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] enabled.</span></span> <span data-ttu-id="29bf5-130">このストアド プロシージャを使用して、データベースの完全バックアップまたはログ バックアップのどちらかを開始できます。</span><span class="sxs-lookup"><span data-stu-id="29bf5-130">You can initiate either a full database or log backup using this stored procedure.</span></span>  
  
### <a name="drop-database-and-detach-database"></a><span data-ttu-id="29bf5-131">データベースの削除とデータベースのデタッチ</span><span class="sxs-lookup"><span data-stu-id="29bf5-131">Drop Database and Detach Database</span></span>  
 <span data-ttu-id="29bf5-132">[!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]が有効になっているデータベースをデタッチまたは削除すると、さらにバックアップすることはできなくなりますが、以前のバックアップは、保有期間が経過するまでストレージ内に保持され、保有期間が経過した時点で削除されます。</span><span class="sxs-lookup"><span data-stu-id="29bf5-132">If a database that has [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] enabled is detached or dropped, although no additional backups are possible, the previous backups remain in the storage until the retention period has elapsed, at which point the backups will be purged.</span></span>  
  
### <a name="changes-to-recovery-model"></a><span data-ttu-id="29bf5-133">復旧モデルの変更</span><span class="sxs-lookup"><span data-stu-id="29bf5-133">Changes to Recovery Model</span></span>  
  
-   <span data-ttu-id="29bf5-134">データベースの復旧モデルを**単純**から**完全**または**一括ログ**に変更する場合は、 [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] データベース用にを構成することもできます。</span><span class="sxs-lookup"><span data-stu-id="29bf5-134">If you change the recovery model of a database from **Simple** to **Full** or **Bulk-Logged**, you have the option of configuring [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] for the database.</span></span> <span data-ttu-id="29bf5-135">これは、[!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]の観点から、新しいデータベースと見なされます。</span><span class="sxs-lookup"><span data-stu-id="29bf5-135">This will be considered like a new database from [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] perspective.</span></span>  
  
-   <span data-ttu-id="29bf5-136">データベースの復旧モデルを**完全**または**一括ログ**から**単純**に変更した場合、それが有効になっていると [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] 、バックアップ操作はスケジュールされなくなります。</span><span class="sxs-lookup"><span data-stu-id="29bf5-136">If you change the recovery model of a database from **Full** or **Bulk-Logged** to **Simple**, that has [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] enabled, backup operations will no longer be scheduled.</span></span> <span data-ttu-id="29bf5-137">保有期間設定はアクティブのままであるため、保有期間が経過するまでバックアップ ファイルはストレージ アカウントに残ります。</span><span class="sxs-lookup"><span data-stu-id="29bf5-137">The retention period setting will still be active and backup files will remain in the storage account until the retention period has elapsed.</span></span> <span data-ttu-id="29bf5-138">バックアップを保持する必要がある場合は、別のストレージ アカウントまたは内部設置型の場所にファイルをダウンロードすることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="29bf5-138">If you want to retain the backups, we recommend that you download the files either to a different storage account or to an on-premises location.</span></span> <span data-ttu-id="29bf5-139">構成設定は保持され、復旧モデルが**完全**または**一括ログ**に再び設定された場合に再利用できます。</span><span class="sxs-lookup"><span data-stu-id="29bf5-139">The configuration settings are retained and can be reused if the recovery model is set back to **Full** or **Bulk-Logged** again.</span></span>  
  
### <a name="log-backups-using-other-backup-tools-or-custom-scripts"></a><span data-ttu-id="29bf5-140">他のバックアップ ツールまたはカスタム スクリプトを使用したログ バックアップ</span><span class="sxs-lookup"><span data-stu-id="29bf5-140">Log Backups Using Other Backup Tools or Custom Scripts</span></span>  
 <span data-ttu-id="29bf5-141">2 つのバックアップが同じデータベースでログ バックアップを実行するように構成されていると、バックアップ ログ チェーンが中断されます。</span><span class="sxs-lookup"><span data-stu-id="29bf5-141">Any two backups that are configured to perform log backups on the same database will cause break in the backup log chain.</span></span> <span data-ttu-id="29bf5-142">チェーンの中断が検出されると、[!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]は完全バックアップをスケジュールしてバックアップ チェーンの中断を修復しようとしますが、これは中断が定期的に発生し、競合する 2 つのツールによってログ バックアップが実行されるという状態が続くことを意味します。</span><span class="sxs-lookup"><span data-stu-id="29bf5-142">Although [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] will attempt to remedy the break in the backup chain by scheduling full backups when a break in chain is detected, this means keeping up continuously with periodic breaks and log backups performed by two competing tools.</span></span> <span data-ttu-id="29bf5-143">また、一方のツールがバックアップの完全なセットを順序どおりに保持することは期待できないため、データベースの回復性に影響する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="29bf5-143">This can also potentially affect the recoverability of the database since no one tool can be expected to have a full set of backup in sequence.</span></span> <span data-ttu-id="29bf5-144">これは、ログ バックアップを実行する 2 つの機能またはツールに当てはまりますが、次に示す具体的な例を強調する際に役立ちます。</span><span class="sxs-lookup"><span data-stu-id="29bf5-144">Although this applies to any two features or tools performing log backups,, it is useful to call out specific examples as described below.</span></span> <span data-ttu-id="29bf5-145">また、これは、このトピックの以前のセクションで説明したメンテナンス プランまたはログ配布の構成に関する問題の根拠でもあります。</span><span class="sxs-lookup"><span data-stu-id="29bf5-145">This is also the basis for the issues with configuring maintenance plans or log shipping as described in earlier sections of this topic.</span></span>  
  
 <span data-ttu-id="29bf5-146">**Data Protection Manager (DPM) ベースのバックアップ:** Microsoft Data Protection Manager では、完全バックアップと増分バックアップを実行できます。</span><span class="sxs-lookup"><span data-stu-id="29bf5-146">**Data Protection Manager (DPM) based backups:** Microsoft Data Protection Manager allows you to do full and incremental backups.</span></span> <span data-ttu-id="29bf5-147">増分バックアップは、トランザクション ログ バックアップの作成後にログの切り捨てを実行するログ バックアップです。</span><span class="sxs-lookup"><span data-stu-id="29bf5-147">The incremental backups are log backups that do perform a log truncation after creating a T-log backup.</span></span> <span data-ttu-id="29bf5-148">そのため、同じデータベースで DPM と [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]の両方を構成することはできません。</span><span class="sxs-lookup"><span data-stu-id="29bf5-148">So configuring both DPM and [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] for the same database is not supported.</span></span>  
  
 <span data-ttu-id="29bf5-149">**サードパーティ製のツールまたはスクリプト:** ログの切り捨てが発生するログバックアップを実行するサードパーティのツールまたはスクリプトは、と互換性が [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] なく、サポートもされていません。</span><span class="sxs-lookup"><span data-stu-id="29bf5-149">**Third Party Tools or Scripts:** Any third party tool or scripts that perform log backups causing log truncation is incompatible with [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)], and is not supported.</span></span>  
  
 <span data-ttu-id="29bf5-150">データベースインスタンスに対してを有効にした場合に、アドホックバックアップを作成するには、 [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] 前のセクションで説明したように、 [Sp_backup_on_demand &#40;transact-sql&#41;](/sql/relational-databases/system-stored-procedures/managed-backup-sp-backup-on-demand-transact-sql)ストアドプロシージャを smart_admin 使用することができます。</span><span class="sxs-lookup"><span data-stu-id="29bf5-150">If you have [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] enabled for a database instance, and you want to take an ad hoc backup you can either use the [smart_admin.sp_backup_on_demand &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/managed-backup-sp-backup-on-demand-transact-sql) stored procedure as described in the earlier section.</span></span> <span data-ttu-id="29bf5-151">[!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]以外に、スケジュールや定期的なバックアップも必要な場合は、[バックアップのみコピーする] を使用できます。</span><span class="sxs-lookup"><span data-stu-id="29bf5-151">If you also have a need to schedule or un backups periodically outside of [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)], you can use the Copy Only Backup.</span></span>  <span data-ttu-id="29bf5-152">詳細については、「[コピーのみのバックアップ &#40;SQL Server&#41;](../relational-databases/backup-restore/copy-only-backups-sql-server.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="29bf5-152">For more information, see [Copy-Only Backups &#40;SQL Server&#41;](../relational-databases/backup-restore/copy-only-backups-sql-server.md).</span></span>  
  
  
