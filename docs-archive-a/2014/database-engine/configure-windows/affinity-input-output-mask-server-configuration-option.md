---
title: affinity Input-Output mask サーバー構成オプション | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: configuration
ms.topic: conceptual
helpviewer_keywords:
- affinity I/O mask option
- processor affinity [SQL Server]
- binding processors [SQL Server]
- CPU affinity mask option
ms.assetid: 9950a8c9-9fe0-4003-95df-6f0d1becb0e7
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 3d0606e2a3f5480b27e27a4a585562f4b289b640
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87631240"
---
# <a name="affinity-input-output-mask-server-configuration-option"></a><span data-ttu-id="61f47-102">affinity Input-Output mask サーバー構成オプション</span><span class="sxs-lookup"><span data-stu-id="61f47-102">affinity Input-Output mask Server Configuration Option</span></span>
  <span data-ttu-id="61f47-103">[!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows 2000 と Windows Server 2003 では、マルチタスク処理を実行するために、プロセス スレッドを異なるプロセッサ間で移動させることがあります。</span><span class="sxs-lookup"><span data-stu-id="61f47-103">To carry out multitasking, [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows 2000 and Windows Server 2003 sometimes move process threads among different processors.</span></span> <span data-ttu-id="61f47-104">オペレーティング システムにとっては効率的であっても、このアクティビティで各プロセッサのキャッシュに繰り返しデータが再読み込みされるため、システムの負荷が高くなり、[!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] のパフォーマンスが低下する場合があります。</span><span class="sxs-lookup"><span data-stu-id="61f47-104">Although efficient from an operating system point of view, this activity can reduce [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] performance under heavy system loads, as each processor cache is repeatedly reloaded with data.</span></span> <span data-ttu-id="61f47-105">このような状況では、特定のスレッドにプロセッサを割り当てることで、プロセッサの再読み込みを回避してパフォーマンスを向上できます。このようなスレッドとプロセッサ間の関連付けを "プロセッサ関係 (processor affinity)" と言います。</span><span class="sxs-lookup"><span data-stu-id="61f47-105">Assigning processors to specific threads can improve performance under these conditions by eliminating processor reloads; such an association between a thread and a processor is called processor affinity.</span></span>  
  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="61f47-106">では、 **affinity mask** (別名 **CPU affinity mask**) と **affinity I/O mask**の 2 つの affinity mask オプションにより、プロセッサ関係をサポートします。</span><span class="sxs-lookup"><span data-stu-id="61f47-106">supports processor affinity by means of two affinity mask options: **affinity mask** (also known as **CPU affinity mask**) and **affinity I/O mask**.</span></span> <span data-ttu-id="61f47-107">**affinity mask** オプションの詳細については、「 [affinity mask サーバー構成オプション](affinity-mask-server-configuration-option.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="61f47-107">For more information on the **affinity mask** option, see [affinity mask Server Configuration Option](affinity-mask-server-configuration-option.md).</span></span> <span data-ttu-id="61f47-108">プロセッサが 33 から 64 個のサーバーに対して CPU および I/O affinity をサポートするには、 [affinity64 mask サーバー構成オプション](affinity64-mask-server-configuration-option.md) および [affinity64 I/O mask サーバー構成オプション](affinity64-input-output-mask-server-configuration-option.md) がそれぞれ必要になります。</span><span class="sxs-lookup"><span data-stu-id="61f47-108">CPU and I/O affinity support for servers with 33 to 64 processors requires the additional use of the [affinity64 mask Server Configuration Option](affinity64-mask-server-configuration-option.md) and [affinity64 Input-Output mask Server Configuration Option](affinity64-input-output-mask-server-configuration-option.md) respectively.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="61f47-109">33 から 64 個までのプロセッサを搭載しているサーバーでの関係 (affinity) は、64 ビット オペレーティング システムでのみサポートされます。</span><span class="sxs-lookup"><span data-stu-id="61f47-109">Affinity support for servers with 33 to 64 processors is only available on 64-bit operating systems.</span></span>  
  
 <span data-ttu-id="61f47-110">**affinity I/O mask** オプションでは、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] のディスク I/O が、指定した CPU のサブセットに関連付けられます。</span><span class="sxs-lookup"><span data-stu-id="61f47-110">The **affinity I/O mask** option binds [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] disk I/O to a specified subset of CPUs.</span></span> <span data-ttu-id="61f47-111">ハイエンドな [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] オンライン トランザクション処理 (OLTP) 環境では、この拡張機能により、I/O を発行する [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] スレッドのパフォーマンスを向上できます。</span><span class="sxs-lookup"><span data-stu-id="61f47-111">In high-end [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] online transactional processing (OLTP) environments, this extension can enhance the performance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] threads issuing I/Os.</span></span> <span data-ttu-id="61f47-112">この拡張機能では、個別のディスクやディスク コントローラーのハードウェア関係 (hardware affinity) はサポートされません。</span><span class="sxs-lookup"><span data-stu-id="61f47-112">This enhancement does not support hardware affinity for individual disks or disk controllers.</span></span>  
  
 <span data-ttu-id="61f47-113">マルチプロセッサ コンピューターでは、 **affinity I/O mask** の値により、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] のディスク I/O 操作を処理できる CPU が指定されます。</span><span class="sxs-lookup"><span data-stu-id="61f47-113">The value for **affinity I/O mask** specifies which CPUs in a multiprocessor computer are eligible to process [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] disk I/O operations.</span></span> <span data-ttu-id="61f47-114">このマスクはビットマップで、右端のビットによって最も順番の小さい CPU(0) が指定され、そのビットの左隣のビットによって次に順番の小さい CPU(1) が指定され、それ以降も同様に CPU が指定されます。</span><span class="sxs-lookup"><span data-stu-id="61f47-114">The mask is a bitmap in which the rightmost bit specifies the lowest-order CPU(0), the bit to its immediate left specifies the next-lowest-order CPU(1), and so on.</span></span> <span data-ttu-id="61f47-115">33 個以上のプロセッサを構成するには、 **affinity I/O mask** と **affinity64 I/O mask**の両方を設定します。</span><span class="sxs-lookup"><span data-stu-id="61f47-115">To configure more than 32 processors, set both the **affinity I/O mask** and the **affinity64 I/O mask**.</span></span>  
  
 <span data-ttu-id="61f47-116">**affinity I/O mask** の値は、以下のとおりです。</span><span class="sxs-lookup"><span data-stu-id="61f47-116">The values for **affinity I/O mask** are as follows:</span></span>  
  
-   <span data-ttu-id="61f47-117">1 バイトの **affinity I/O mask** は、マルチプロセッサ コンピューターの最大 8 個の CPU に対応します。</span><span class="sxs-lookup"><span data-stu-id="61f47-117">A 1-byte **affinity I/O mask** covers up to 8 CPUs in a multiprocessor computer.</span></span>  
  
-   <span data-ttu-id="61f47-118">2 バイトの **affinity I/O mask** は、マルチプロセッサ コンピューターの最大 16 個の CPU に対応します。</span><span class="sxs-lookup"><span data-stu-id="61f47-118">A 2-byte **affinity I/O mask** covers up to 16 CPUs in a multiprocessor computer.</span></span>  
  
-   <span data-ttu-id="61f47-119">3 バイトの **affinity I/O mask** は、マルチプロセッサ コンピューターの最大 24 個の CPU に対応します。</span><span class="sxs-lookup"><span data-stu-id="61f47-119">A 3-byte **affinity I/O mask** covers up to 24 CPUs in a multiprocessor computer.</span></span>  
  
-   <span data-ttu-id="61f47-120">4 バイトの **affinity I/O mask** は、マルチプロセッサ コンピューターの最大 32 個の CPU に対応します。</span><span class="sxs-lookup"><span data-stu-id="61f47-120">A 4-byte **affinity I/O mask** covers up to 32 CPUs in a multiprocessor computer.</span></span>  
  
-   <span data-ttu-id="61f47-121">33 個以上の CPU に対応するには、最初の 32 個の CPU に 4 バイトの **affinity I/O mask** を構成し、残りの CPU に 4 バイトの **affinity64 I/O mask** を構成します。</span><span class="sxs-lookup"><span data-stu-id="61f47-121">To cover more than 32 CPUs, configure a four-byte **affinity I/O mask** for the first 32 CPUs and up to a four-byte **affinity64 I/O mask** for the remaining CPUs.</span></span>  
  
 <span data-ttu-id="61f47-122">affinity I/O パターンで 1 が設定されているビットは、対応する CPU で [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] のディスク I/O 操作を実行できることを示します。また、0 が設定されているビットは、対応する CPU に [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] のディスク I/O 操作のスケジュールを設定できないことを示します。</span><span class="sxs-lookup"><span data-stu-id="61f47-122">A 1 bit in the affinity I/O pattern specifies that the corresponding CPU is eligible to perform [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] disk I/O operations; a 0 bit specifies that no [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] disk I/O operations should be scheduled for the corresponding CPU.</span></span> <span data-ttu-id="61f47-123">すべてのビットがゼロに設定されているか、 **affinity I/O mask** が指定されていない場合、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] のディスク I/O は、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] のスレッドを処理できるすべての CPU にスケジュール設定されます。</span><span class="sxs-lookup"><span data-stu-id="61f47-123">When all bits are set to zero, or **affinity I/O mask** is not specified, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] disk I/O is scheduled to any of the CPUs eligible to process [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] threads.</span></span>  
  
 <span data-ttu-id="61f47-124">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] **affinity I/O mask** オプションの設定は特殊な操作なので、必要な場合にのみ使用してください。</span><span class="sxs-lookup"><span data-stu-id="61f47-124">Because setting the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] **affinity I/O mask** option is a specialized operation, it should be used only when necessary.</span></span> <span data-ttu-id="61f47-125">通常は、Windows 2000 または Windows 2003 の既定の関係 (affinity) で、最適なパフォーマンスが得られます。</span><span class="sxs-lookup"><span data-stu-id="61f47-125">In most cases, the Windows 2000 or Windows Server 2003 default affinity provides the best performance.</span></span>  
  
 <span data-ttu-id="61f47-126">**affinity I/O mask** オプションを指定する場合は、 **affinity mask** 構成オプションと共に使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="61f47-126">When specifying the **affinity I/O mask** option, you must use it with the **affinity mask** configuration option.</span></span> <span data-ttu-id="61f47-127">**affinity I/O mask** スイッチと **affinity mask** オプションの両方で同じ CPU を有効にしないようにしてください。</span><span class="sxs-lookup"><span data-stu-id="61f47-127">Do not enable the same CPU in both the **affinity I/O mask** switch and the **affinity mask** option.</span></span> <span data-ttu-id="61f47-128">各 CPU に対応するビットは、次の 3 つの状態のうちのいずれかに設定します。</span><span class="sxs-lookup"><span data-stu-id="61f47-128">The bits corresponding to each CPU should be in one of the following three states:</span></span>  
  
-   <span data-ttu-id="61f47-129">**affinity I/O mask** オプションと **affinity mask** オプションの両方で 0。</span><span class="sxs-lookup"><span data-stu-id="61f47-129">0 in both the **affinity I/O mask** option and the **affinity mask** option.</span></span>  
  
-   <span data-ttu-id="61f47-130">**affinity I/O mask** オプションで 0、 **affinity mask** オプションで 1。</span><span class="sxs-lookup"><span data-stu-id="61f47-130">1 in the **affinity I/O mask** option and 0 in the **affinity mask** option.</span></span>  
  
-   <span data-ttu-id="61f47-131">**affinity I/O mask** オプションで 0、 **affinity mask** オプションで 1。</span><span class="sxs-lookup"><span data-stu-id="61f47-131">0 in the **affinity I/O mask** option and 1 in the **affinity mask** option.</span></span>  
  
 <span data-ttu-id="61f47-132">**affinity I/O mask** オプションは拡張オプションです。</span><span class="sxs-lookup"><span data-stu-id="61f47-132">The **affinity I/O mask** option is an advanced option.</span></span> <span data-ttu-id="61f47-133">システムストアドプロシージャを使用して設定を変更する場合は `sp_configure` 、 **show advanced options**が1に設定されている場合にのみ、 **affinity i/o mask**を変更できます。</span><span class="sxs-lookup"><span data-stu-id="61f47-133">If you are using the `sp_configure` system stored procedure to change the setting, you can change **affinity I/O mask** only when **show advanced options** is set to 1.</span></span> <span data-ttu-id="61f47-134">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] では、**affinity I/O mask[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] オプションを再構成した場合、** のインスタンスを再起動する必要があります。</span><span class="sxs-lookup"><span data-stu-id="61f47-134">In [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], reconfiguring the **affinity I/O mask** option requires a restart of the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance.</span></span>  
  
> [!CAUTION]  
>  <span data-ttu-id="61f47-135">Windows オペレーティング システムでの CPU 関係の構成と、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]での関係マスクの構成は、同時に行わないようにしてください。</span><span class="sxs-lookup"><span data-stu-id="61f47-135">Do not configure CPU affinity in the Windows operating system and also configure the affinity mask in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="61f47-136">この 2 つの設定は、同じ効果をねらったものであり、これらの構成間に一貫性がない場合は、予期しない結果を招く可能性があります。</span><span class="sxs-lookup"><span data-stu-id="61f47-136">These settings are attempting to achieve the same result, and if the configurations are inconsistent, you may have unpredictable results.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="61f47-137">CPU 関係を構成する場合は、[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] の `sp_configure` オプションを使用する方法が最適です。</span><span class="sxs-lookup"><span data-stu-id="61f47-137">CPU affinity is best configured using the `sp_configure` option in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="61f47-138">参照</span><span class="sxs-lookup"><span data-stu-id="61f47-138">See Also</span></span>  
 <span data-ttu-id="61f47-139">[リソースの利用状況の監視 &#40;System Monitor&#41;](../../relational-databases/performance-monitor/monitor-resource-usage-system-monitor.md) </span><span class="sxs-lookup"><span data-stu-id="61f47-139">[Monitor Resource Usage &#40;System Monitor&#41;](../../relational-databases/performance-monitor/monitor-resource-usage-system-monitor.md) </span></span>  
 <span data-ttu-id="61f47-140">[RECONFIGURE &#40;Transact-SQL&#41;](/sql/t-sql/language-elements/reconfigure-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="61f47-140">[RECONFIGURE &#40;Transact-SQL&#41;](/sql/t-sql/language-elements/reconfigure-transact-sql) </span></span>  
 <span data-ttu-id="61f47-141">[サーバー構成オプション &#40;SQL Server&#41;](server-configuration-options-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="61f47-141">[Server Configuration Options &#40;SQL Server&#41;](server-configuration-options-sql-server.md) </span></span>  
 [<span data-ttu-id="61f47-142">sp_configure &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="61f47-142">sp_configure &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-stored-procedures/sp-configure-transact-sql)  
  
  
