---
title: データベース管理者用の診断接続 | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: configuration
ms.topic: conceptual
helpviewer_keywords:
- server management [SQL Server], connections
- administrator connections [SQL Server]
- ports [SQL Server], DAC
- DAC
- network connections [SQL Server], dedicated administrator
- diagnostic connections [SQL Server]
- connections [SQL Server], dedicated administrator
- ports [SQL Server]
- dedicated administrator connections [SQL Server]
ms.assetid: 993e0820-17f2-4c43-880c-d38290bf7abc
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 0d452ca155a5187136c910e81e8bd073e34cad56
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87641864"
---
# <a name="diagnostic-connection-for-database-administrators"></a><span data-ttu-id="c7570-102">データベース管理者用の診断接続</span><span class="sxs-lookup"><span data-stu-id="c7570-102">Diagnostic Connection for Database Administrators</span></span>
  [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="c7570-103">では、サーバーへの標準の接続が確立できないときに、管理者向けの特殊な診断接続が用意されています。</span><span class="sxs-lookup"><span data-stu-id="c7570-103">provides a special diagnostic connection for administrators when standard connections to the server are not possible.</span></span> <span data-ttu-id="c7570-104">診断接続を使用することにより、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] が標準の接続要求に応答していない場合でも、管理者は [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] にアクセスして診断クエリを実行し、問題のトラブルシューティングを行うことができるようになります。</span><span class="sxs-lookup"><span data-stu-id="c7570-104">This diagnostic connection allows an administrator to access [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] to execute diagnostic queries and troubleshoot problems even when [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is not responding to standard connection requests.</span></span>  
  
 <span data-ttu-id="c7570-105">この DAC (専用管理者接続) では、暗号化やその他の [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]のセキュリティ機能がサポートされます。</span><span class="sxs-lookup"><span data-stu-id="c7570-105">This dedicated administrator connection (DAC) supports encryption and other security features of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="c7570-106">DAC で実行できるのは、ユーザー コンテキストを別の管理者ユーザーに変更する操作のみです。</span><span class="sxs-lookup"><span data-stu-id="c7570-106">The DAC only allows changing the user context to another admin user.</span></span>  
  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="c7570-107">は DAC の正常な接続を試みますが、極端な状況においては失敗する場合もあります。</span><span class="sxs-lookup"><span data-stu-id="c7570-107">makes every attempt to make DAC connect successfully, but under extreme situations it may not be successful.</span></span>  
  
||  
|-|  
|<span data-ttu-id="c7570-108">**に適用さ**れます: [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] (を [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] 通じて[現在のバージョン](https://go.microsoft.com/fwlink/p/?LinkId=299658))、 [!INCLUDE[sqldbesa](../../includes/sqldbesa-md.md)] です。</span><span class="sxs-lookup"><span data-stu-id="c7570-108">**Applies to**: [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ([!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] through [current version](https://go.microsoft.com/fwlink/p/?LinkId=299658)), [!INCLUDE[sqldbesa](../../includes/sqldbesa-md.md)].</span></span>|  
  
## <a name="connecting-with-dac"></a><span data-ttu-id="c7570-109">DAC による接続</span><span class="sxs-lookup"><span data-stu-id="c7570-109">Connecting with DAC</span></span>  
 <span data-ttu-id="c7570-110">また、既定では、サーバーで実行されているクライアントからしか接続できません。</span><span class="sxs-lookup"><span data-stu-id="c7570-110">By default, the connection is only allowed from a client running on the server.</span></span> <span data-ttu-id="c7570-111">[remote admin connections オプション](remote-admin-connections-server-configuration-option.md)を指定した sp_configure ストアド プロシージャを使用して構成しない限り、ネットワーク接続は許可されません。</span><span class="sxs-lookup"><span data-stu-id="c7570-111">Network connections are not permitted unless they are configured by using the sp_configure stored procedure with the [remote admin connections option](remote-admin-connections-server-configuration-option.md).</span></span>  
  
 <span data-ttu-id="c7570-112">DAC を使用して接続できるのは、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] sysadmin ロールのメンバーのみです。</span><span class="sxs-lookup"><span data-stu-id="c7570-112">Only members of the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] sysadmin role can connect using the DAC.</span></span>  
  
 <span data-ttu-id="c7570-113">DAC は、 **sqlcmd** コマンド プロンプト ユーティリティで特殊な管理者スイッチ (**-A**) を指定することによって使用できます。</span><span class="sxs-lookup"><span data-stu-id="c7570-113">The DAC is available and supported through the **sqlcmd** command-prompt utility using a special administrator switch (**-A**).</span></span> <span data-ttu-id="c7570-114">**sqlcmd** を使用する方法については、「[sqlcmd でのスクリプト変数の使用](../../relational-databases/scripting/sqlcmd-use-with-scripting-variables.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c7570-114">For more information about using **sqlcmd**, see [Use sqlcmd with Scripting Variables](../../relational-databases/scripting/sqlcmd-use-with-scripting-variables.md).</span></span> <span data-ttu-id="c7570-115">また、 `admin:` **Sadmin:** _<instance_name>_ の形式で、インスタンス名にプレフィックスを接続することもできます。</span><span class="sxs-lookup"><span data-stu-id="c7570-115">You can also connect prefixing `admin:`to the instance name in the format **sqlcmd -Sadmin:**_<instance_name>._</span></span> <span data-ttu-id="c7570-116">また、に接続して、クエリエディターから DAC を開始することもでき [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] `admin:` \<*instance_name*> ます。</span><span class="sxs-lookup"><span data-stu-id="c7570-116">You can also initiate a DAC from a [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] Query Editor by connecting to `admin:`\<*instance_name*>.</span></span>  
  
## <a name="restrictions"></a><span data-ttu-id="c7570-117">制限</span><span class="sxs-lookup"><span data-stu-id="c7570-117">Restrictions</span></span>  
 <span data-ttu-id="c7570-118">DAC の唯一の目的は、ごくまれな状況でサーバーの問題を診断することであるので、この接続には次のようないくつかの制限があります。</span><span class="sxs-lookup"><span data-stu-id="c7570-118">Because the DAC exists solely for diagnosing server problems in rare circumstances, there are some restrictions on the connection:</span></span>  
  
-   <span data-ttu-id="c7570-119">接続に使用できるリソースを確保するために、DAC は 1 つの [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]のインスタンスにつき 1 つしか許可されません。</span><span class="sxs-lookup"><span data-stu-id="c7570-119">To guarantee that there are resources available for the connection, only one DAC is allowed per instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="c7570-120">DAC 接続が既にアクティブな場合は、DAC を使用して接続する新たな要求は、エラー 17810 で拒否されます。</span><span class="sxs-lookup"><span data-stu-id="c7570-120">If a DAC connection is already active, any new request to connect through the DAC is denied with error 17810.</span></span>  
  
-   <span data-ttu-id="c7570-121">リソースに限りがあるので、 [!INCLUDE[ssExpress](../../includes/ssexpress-md.md)] はトレース フラグ 7806 を使用して開始されない限り、DAC ポートでリッスンしません。</span><span class="sxs-lookup"><span data-stu-id="c7570-121">To conserve resources, [!INCLUDE[ssExpress](../../includes/ssexpress-md.md)] does not listen on the DAC port unless started with a trace flag 7806.</span></span>  
  
-   <span data-ttu-id="c7570-122">DAC では、まずログインに関連付けられた既定のデータベースへの接続が試行されます。</span><span class="sxs-lookup"><span data-stu-id="c7570-122">The DAC initially attempts to connect to the default database associated with the login.</span></span> <span data-ttu-id="c7570-123">既定のデータベースに正常に接続されたら、master データベースに接続できます。</span><span class="sxs-lookup"><span data-stu-id="c7570-123">After it is successfully connected, you can connect to the master database.</span></span> <span data-ttu-id="c7570-124">既定のデータベースがオフライン状態であるか、または別の原因で使用できない場合、接続の際にエラー 4060 が返されます。</span><span class="sxs-lookup"><span data-stu-id="c7570-124">If the default database is offline or otherwise not available, the connection will return error 4060.</span></span> <span data-ttu-id="c7570-125">ただし、master データベースへ接続するために、次のコマンドを使用する代わりに既定のデータベースをオーバーライドすると成功します。</span><span class="sxs-lookup"><span data-stu-id="c7570-125">However, it will succeed if you override the default database to connect to the master database instead using the following command:</span></span>  
  
     <span data-ttu-id="c7570-126">**sqlcmd-A-d マスター**</span><span class="sxs-lookup"><span data-stu-id="c7570-126">**sqlcmd -A -d master**</span></span>  
  
     <span data-ttu-id="c7570-127">DAC を使用するときは、master データベースに接続することをお勧めします。これは、 [!INCLUDE[ssDE](../../includes/ssde-md.md)] のインスタンスが起動すると master を使用できることが保証されているためです。</span><span class="sxs-lookup"><span data-stu-id="c7570-127">We recommend that you connect to the master database with the DAC because master is guaranteed to be available if the instance of the [!INCLUDE[ssDE](../../includes/ssde-md.md)] is started.</span></span>  
  
-   [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="c7570-128">では、DAC で複数のクエリやコマンドを並列実行することは禁止されています。</span><span class="sxs-lookup"><span data-stu-id="c7570-128">prohibits running parallel queries or commands with the DAC.</span></span> <span data-ttu-id="c7570-129">たとえば、DAC で次のいずれかのステートメントを実行すると、エラー 3637 が生成されます。</span><span class="sxs-lookup"><span data-stu-id="c7570-129">For example, error 3637 is generated if you execute either of the following statements with the DAC:</span></span>  
  
    -   <span data-ttu-id="c7570-130">RESTORE</span><span class="sxs-lookup"><span data-stu-id="c7570-130">RESTORE</span></span>  
  
    -   <span data-ttu-id="c7570-131">BACKUP</span><span class="sxs-lookup"><span data-stu-id="c7570-131">BACKUP</span></span>  
  
-   <span data-ttu-id="c7570-132">DAC では、使用できるリソースが制限されます。</span><span class="sxs-lookup"><span data-stu-id="c7570-132">Only limited resources are guaranteed to be available with the DAC.</span></span> <span data-ttu-id="c7570-133">リソースを集中的に消費するクエリ (</span><span class="sxs-lookup"><span data-stu-id="c7570-133">Do not use the DAC to run resource-intensive queries (for example.</span></span> <span data-ttu-id="c7570-134">大きなテーブルでの複雑な結合など) や、ブロックされる可能性があるクエリの実行には DAC を使用しないでください。</span><span class="sxs-lookup"><span data-stu-id="c7570-134">a complex join on large table) or queries that may block.</span></span> <span data-ttu-id="c7570-135">これは、DAC によって既存のサーバーの問題が悪化するのを防ぐためです。</span><span class="sxs-lookup"><span data-stu-id="c7570-135">This helps prevent the DAC from compounding any existing server problems.</span></span> <span data-ttu-id="c7570-136">ブロックする可能性があるクエリを実行しなければならない場合、ブロッキングが発生する状況を回避するには、可能な限りそのクエリをスナップショット ベースの分離レベルで実行します。この分離レベルで実行できない場合は、トランザクションの分離レベルを READ UNCOMMITTED に設定するか、LOCK_TIMEOUT の値を 2,000 ミリ秒などの短い値に設定します。または、両方の設定を行います。</span><span class="sxs-lookup"><span data-stu-id="c7570-136">To avoid potential blocking scenarios, if you have to run queries that may block, run the query under snapshot-based isolation levels if possible; otherwise, set the transaction isolation level to READ UNCOMMITTED and set the LOCK_TIMEOUT value to a short value such as 2000 milliseconds, or both.</span></span> <span data-ttu-id="c7570-137">これにより、DAC セッションがブロックされるのを防ぐことができます。</span><span class="sxs-lookup"><span data-stu-id="c7570-137">This will prevent the DAC session from getting blocked.</span></span> <span data-ttu-id="c7570-138">ただし、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] の状態によっては、ラッチで DAC セッションがブロックされることがあります。</span><span class="sxs-lookup"><span data-stu-id="c7570-138">However, depending on the state that the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is in, the DAC session might get blocked on a latch.</span></span> <span data-ttu-id="c7570-139">Ctrl&lt;/localizedText&gt; キーを押しながら &lt;localizedText&gt;C&lt;/localizedText&gt; キーを押すことによって、DAC セッションを終了できることもありますが、必ず終了されるわけではありません。</span><span class="sxs-lookup"><span data-stu-id="c7570-139">You might be able to terminate the DAC session using CNTRL-C but it is not guaranteed.</span></span> <span data-ttu-id="c7570-140">このような場合は、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]の再起動が唯一の選択肢になります。</span><span class="sxs-lookup"><span data-stu-id="c7570-140">In that case, your only option may be to restart [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>  
  
-   <span data-ttu-id="c7570-141">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] では、DAC による接続とトラブルシューティングを確実に行うために、限定されたリソースを確保して DAC で実行されるコマンドを処理します。</span><span class="sxs-lookup"><span data-stu-id="c7570-141">To guarantee connectivity and troubleshooting with the DAC, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] reserves limited resources to process commands run on the DAC.</span></span> <span data-ttu-id="c7570-142">通常、次に示す単純な診断関数とトラブルシューティング関数を実行する場合には、この限定されたリソースだけで十分です。</span><span class="sxs-lookup"><span data-stu-id="c7570-142">These resources are typically only enough for simple diagnostic and troubleshooting functions, such as those listed below.</span></span>  
  
 <span data-ttu-id="c7570-143">理論上は、DAC で並列に実行する必要のない [!INCLUDE[tsql](../../includes/tsql-md.md)] ステートメントはすべて実行できますが、次の診断コマンドとトラブルシューティング コマンド以外は使用しないことを強くお勧めします。</span><span class="sxs-lookup"><span data-stu-id="c7570-143">Although you can theoretically run any [!INCLUDE[tsql](../../includes/tsql-md.md)] statement that does not have to execute in parallel on the DAC, we strongly recommend that you restrict usage to the following diagnostic and troubleshooting commands:</span></span>  
  
-   <span data-ttu-id="c7570-144">ロックの状態を確認するための sys.dm_tran_locks、キャッシュの使用状況を確認するための sys.dm_os_memory_cache_counters、アクティブなセッションや要求を確認するための sys.dm_exec_requests と sys.dm_exec_sessions など、基本的な診断を行うためのクエリの動的管理ビュー。</span><span class="sxs-lookup"><span data-stu-id="c7570-144">Querying dynamic management views for basic diagnostics such as sys.dm_tran_locks for the locking status, sys.dm_os_memory_cache_counters to check the health of caches, and sys.dm_exec_requests and sys.dm_exec_sessions for active sessions and requests.</span></span> <span data-ttu-id="c7570-145">リソースを集中的に消費する動的管理ビュー (たとえば、sys.dm_tran_version_store ではバージョン ストアの完全なスキャンが実行され、集中的に I/O が行われる可能性があります) や複雑な結合を使用する動的管理ビューは使用しないようにしてください。</span><span class="sxs-lookup"><span data-stu-id="c7570-145">Avoid dynamic management views that are resource intensive (for example, sys.dm_tran_version_store scans the full version store and can cause extensive I/O) or that use complex joins.</span></span> <span data-ttu-id="c7570-146">パフォーマンスへの影響に関する詳細については、特定の [動的管理ビュー](../../relational-databases/views/views.md)のリファレンスを参照してください。</span><span class="sxs-lookup"><span data-stu-id="c7570-146">For information about performance implications, see the documentation for the specific [dynamic management view](../../relational-databases/views/views.md).</span></span>  
  
-   <span data-ttu-id="c7570-147">カタログ ビューのクエリ。</span><span class="sxs-lookup"><span data-stu-id="c7570-147">Querying catalog views.</span></span>  
  
-   <span data-ttu-id="c7570-148">DBCC FREEPROCCACHE、DBCC FREESYSTEMCACHE、DBCC DROPCLEANBUFFERS、DBCC SQLPERF などの基本的な DBCC コマンド。`,`</span><span class="sxs-lookup"><span data-stu-id="c7570-148">Basic DBCC commands such as DBCC FREEPROCCACHE, DBCC FREESYSTEMCACHE, DBCC DROPCLEANBUFFERS`,` and DBCC SQLPERF.</span></span> <span data-ttu-id="c7570-149">**Dbcc** CHECKDB、dbcc DBREINDEX、dbcc SHRINKDATABASE などのリソースを集中的に消費するコマンドは実行しないでください。</span><span class="sxs-lookup"><span data-stu-id="c7570-149">Do not run resource-intensive commands such as **DBCC** CHECKDB, DBCC DBREINDEX, or DBCC SHRINKDATABASE.</span></span>  
  
-   [!INCLUDE[tsql](../../includes/tsql-md.md)] <span data-ttu-id="c7570-150">KILL *\<spid>* コマンド。</span><span class="sxs-lookup"><span data-stu-id="c7570-150">KILL*\<spid>* command.</span></span> <span data-ttu-id="c7570-151">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]の状態によっては、KILL コマンドは必ずしも成功しません。この場合、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]を再起動するしか方法がありません。</span><span class="sxs-lookup"><span data-stu-id="c7570-151">Depending on the state of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], the KILL command might not always succeed; then the only option may be to restart [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="c7570-152">次に一般的なガイドラインをいくつか示します。</span><span class="sxs-lookup"><span data-stu-id="c7570-152">The following are some general guidelines:</span></span>  
  
    -   <span data-ttu-id="c7570-153">`SELECT * FROM sys.dm_exec_sessions WHERE session_id = <spid>`というクエリを実行し、SPID が実際に強制終了されたかどうかを確認します。</span><span class="sxs-lookup"><span data-stu-id="c7570-153">Verify that the SPID was actually killed by querying `SELECT * FROM sys.dm_exec_sessions WHERE session_id = <spid>`.</span></span> <span data-ttu-id="c7570-154">行が返されなかった場合は、セッションが強制終了されたことを示します。</span><span class="sxs-lookup"><span data-stu-id="c7570-154">If it returns no rows, it means the session was killed.</span></span>  
  
    -   <span data-ttu-id="c7570-155">セッションが依然として確立されている場合は、クエリ `SELECT * FROM sys.dm_os_tasks WHERE session_id = <spid>`を実行して、このセッションに割り当てられたタスクがあるかどうかを確認します。</span><span class="sxs-lookup"><span data-stu-id="c7570-155">If the session is still there, verify whether there are tasks assigned to this session by running the query `SELECT * FROM sys.dm_os_tasks WHERE session_id = <spid>`.</span></span> <span data-ttu-id="c7570-156">タスクが存在する場合は、セッションが現在強制終了中である可能性が高くなります。</span><span class="sxs-lookup"><span data-stu-id="c7570-156">If you see the task there, most likely your session is currently being killed.</span></span> <span data-ttu-id="c7570-157">この処理には非常に長い時間がかかるため、成功しない場合があることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="c7570-157">Note that this may take considerable amount of time and may not succeed at all.</span></span>  
  
    -   <span data-ttu-id="c7570-158">このセッションに関連付けられている sys.dm_os_tasks にタスクが存在しないが、KILL コマンドの実行後に sys.dm_exec_sessions に依然としてセッションが存在する場合は、使用できるワーカーがないことを示します。</span><span class="sxs-lookup"><span data-stu-id="c7570-158">If there are no tasks in the sys.dm_os_tasks associated with this session, but the session remains in sys.dm_exec_sessions after executing the KILL command, it means that you do not have a worker available.</span></span> <span data-ttu-id="c7570-159">現在実行中のタスク ( `sessions_id <> NULL`を指定して sys.dm_os_tasks ビューに一覧されるタスク) のいずれかを選択し、そのタスクに関連付けられているセッションを強制終了して、ワーカーを解放します。</span><span class="sxs-lookup"><span data-stu-id="c7570-159">Select one of the currently running tasks (a task listed in the sys.dm_os_tasks view with a `sessions_id <> NULL`), and kill the session associated with it to free up the worker.</span></span> <span data-ttu-id="c7570-160">1 つのセッションを強制終了するだけでは不十分で、複数のセッションを強制終了する必要が生じる場合があります。</span><span class="sxs-lookup"><span data-stu-id="c7570-160">Note that it may not be enough to kill a single session: you may have to kill multiple ones.</span></span>  
  
## <a name="dac-port"></a><span data-ttu-id="c7570-161">DAC ポート</span><span class="sxs-lookup"><span data-stu-id="c7570-161">DAC Port</span></span>  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="c7570-162">では、TCP ポート 1434 (使用可能な場合) または [!INCLUDE[ssDE](../../includes/ssde-md.md)] の起動時に動的に割り当てられる TCP ポートで DAC をリッスンします。</span><span class="sxs-lookup"><span data-stu-id="c7570-162">listens for the DAC on TCP port 1434 if available or a TCP port dynamically assigned upon [!INCLUDE[ssDE](../../includes/ssde-md.md)] startup.</span></span> <span data-ttu-id="c7570-163">エラー ログには、DAC がリッスンしているポート番号が含まれています。</span><span class="sxs-lookup"><span data-stu-id="c7570-163">The error log contains the port number the DAC is listening on.</span></span> <span data-ttu-id="c7570-164">既定では、DAC リスナーはローカル ポートでの接続のみを受け入れます。</span><span class="sxs-lookup"><span data-stu-id="c7570-164">By default the DAC listener accepts connection on only the local port.</span></span> <span data-ttu-id="c7570-165">リモート管理接続をアクティブにするサンプル コードについては、「 [remote admin connections サーバー構成オプション](remote-admin-connections-server-configuration-option.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c7570-165">For a code sample that activates remote administration connections, see [remote admin connections Server Configuration Option](remote-admin-connections-server-configuration-option.md).</span></span>  
  
 <span data-ttu-id="c7570-166">リモート管理接続を構成すると、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] を再起動しなくても DAC リスナーが有効になり、クライアントからリモートで DAC に接続できるようになります。</span><span class="sxs-lookup"><span data-stu-id="c7570-166">After the remote administration connection is configured, the DAC listener is enabled without requiring a restart of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] and a client can now connect to the DAC remotely.</span></span> <span data-ttu-id="c7570-167">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] が応答しない場合でも、DAC リスナーを有効にしてリモート接続を受け入れることができます。これを行うには、まず DAC をローカルに使用して [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] に接続してから、sp_configure ストアド プロシージャを実行してリモート接続からの接続を受け入れます。</span><span class="sxs-lookup"><span data-stu-id="c7570-167">You can enable the DAC listener to accept connections remotely even if [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is unresponsive by first connecting to [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] using the DAC locally, and then executing the sp_configure stored procedure to accept connection from remote connections.</span></span>  
  
 <span data-ttu-id="c7570-168">クラスター構成では、DAC は既定でオフになります。</span><span class="sxs-lookup"><span data-stu-id="c7570-168">On cluster configurations, the DAC will be off by default.</span></span> <span data-ttu-id="c7570-169">ユーザーは、sp_configure の remote admin connection オプションを実行すると、DAC リスナーを有効にしてリモート接続にアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="c7570-169">Users can execute the remote admin connection option of sp_configure to enable the DAC listener to access a remote connection.</span></span> <span data-ttu-id="c7570-170">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] が応答せず、DAC リスナーが有効になっていない場合は、DAC で接続するために [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] を再起動する必要が生じる場合があります。</span><span class="sxs-lookup"><span data-stu-id="c7570-170">If [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is unresponsive and the DAC listener is not enabled, you might have to restart [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] to connect with the DAC.</span></span> <span data-ttu-id="c7570-171">この理由から、クラスター システムでは remote admin connections 構成オプションを有効にすることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="c7570-171">Therefore, we recommend that you enable the remote admin connections configuration option on clustered systems.</span></span>  
  
 <span data-ttu-id="c7570-172">DAC ポートは、起動中に [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] によって動的に割り当てられます。</span><span class="sxs-lookup"><span data-stu-id="c7570-172">The DAC port is assigned dynamically by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] during startup.</span></span> <span data-ttu-id="c7570-173">既定のインスタンスに接続する場合、DAC では SQL Server Browser サービスへの SSRP ( [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Resolution Protocol) 要求が使用されません。</span><span class="sxs-lookup"><span data-stu-id="c7570-173">When connecting to the default instance, the DAC avoids using a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Resolution Protocol (SSRP) request to the SQL Server Browser Service when connecting.</span></span> <span data-ttu-id="c7570-174">まず、TCP ポート 1434 経由で接続が試行されます。</span><span class="sxs-lookup"><span data-stu-id="c7570-174">It first connects over TCP port 1434.</span></span> <span data-ttu-id="c7570-175">接続が失敗した場合、ポートを取得するために SSRP 呼び出しが実行されます。</span><span class="sxs-lookup"><span data-stu-id="c7570-175">If that fails, it makes an SSRP call to get the port.</span></span> <span data-ttu-id="c7570-176">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Browser が SSRP 要求をリッスンしていない場合は、接続要求によってエラーが返されます。</span><span class="sxs-lookup"><span data-stu-id="c7570-176">If [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Browser is not listening for SSRP requests, the connection request returns an error.</span></span> <span data-ttu-id="c7570-177">DAC がリッスンしているポート番号を確認するには、エラー ログを参照します。</span><span class="sxs-lookup"><span data-stu-id="c7570-177">Refer to the error log to find the port number DAC is listening on.</span></span> <span data-ttu-id="c7570-178">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] がリモート管理接続を受け入れるように構成されている場合、次のように DAC を明示的なポート番号で開始する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c7570-178">If [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is configured to accept remote administration connections, the DAC must be initiated with an explicit port number:</span></span>  
  
 <span data-ttu-id="c7570-179">**sqlcmd-Stcp:** _ \<server> 、 \<port> _</span><span class="sxs-lookup"><span data-stu-id="c7570-179">**sqlcmd-Stcp:** _\<server>,\<port>_</span></span>  
  
 <span data-ttu-id="c7570-180">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] のエラー ログには DAC のポート番号が一覧されます。既定のポート番号は 1434 です。</span><span class="sxs-lookup"><span data-stu-id="c7570-180">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] error log lists the port number for the DAC, which is 1434 by default.</span></span> <span data-ttu-id="c7570-181">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] がローカルの DAC 接続のみを受け入れるように構成されている場合は、次のコマンドを実行し、ループバック アダプターを使用して接続します。</span><span class="sxs-lookup"><span data-stu-id="c7570-181">If [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is configured to accept local DAC connections only, connect using the loopback adapter using the following command:</span></span>  
  
 <span data-ttu-id="c7570-182">**sqlcmd-s 127.0.0.1**、`1434`</span><span class="sxs-lookup"><span data-stu-id="c7570-182">**sqlcmd-S127.0.0.1**,`1434`</span></span>  
  
## <a name="example"></a><span data-ttu-id="c7570-183">例</span><span class="sxs-lookup"><span data-stu-id="c7570-183">Example</span></span>  
 <span data-ttu-id="c7570-184">この例では、管理者がサーバー `URAN123` が応答していないことに気付き、その問題を診断します。</span><span class="sxs-lookup"><span data-stu-id="c7570-184">In this example, an administrator notices that server `URAN123` is not responding and wants to diagnose the problem.</span></span> <span data-ttu-id="c7570-185">これを行うには、次のように、ユーザーが `sqlcmd` コマンド プロンプト ユーティリティをアクティブにし、DAC であることを示す `URAN123` を指定して、サーバー `-A` に接続します。</span><span class="sxs-lookup"><span data-stu-id="c7570-185">To do this, the user activates the `sqlcmd` command prompt utility and connects to server `URAN123` using `-A` to indicate the DAC.</span></span>  
  
 `sqlcmd -S URAN123 -U sa -P <xxx> -A`  
  
 <span data-ttu-id="c7570-186">これで、管理者はクエリを実行して問題を診断し、場合によっては応答していないセッションを終了させることができます。</span><span class="sxs-lookup"><span data-stu-id="c7570-186">The administrator can now execute queries to diagnose the problem and possibly terminate the unresponsive sessions.</span></span>  
  
## <a name="related-tasks"></a><span data-ttu-id="c7570-187">Related Tasks</span><span class="sxs-lookup"><span data-stu-id="c7570-187">Related Tasks</span></span>  
  
## <a name="related-content"></a><span data-ttu-id="c7570-188">関連コンテンツ</span><span class="sxs-lookup"><span data-stu-id="c7570-188">Related Content</span></span>  
 [<span data-ttu-id="c7570-189">sqlcmd でのスクリプト変数の使用</span><span class="sxs-lookup"><span data-stu-id="c7570-189">Use sqlcmd with Scripting Variables</span></span>](../../relational-databases/scripting/sqlcmd-use-with-scripting-variables.md)  
  
 [<span data-ttu-id="c7570-190">sqlcmd Utility</span><span class="sxs-lookup"><span data-stu-id="c7570-190">sqlcmd Utility</span></span>](../../tools/sqlcmd-utility.md)  
  
 [<span data-ttu-id="c7570-191">SELECT &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="c7570-191">SELECT &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/queries/select-transact-sql)  
  
 [<span data-ttu-id="c7570-192">sp_who &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="c7570-192">sp_who &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-stored-procedures/sp-who-transact-sql)  
  
 [<span data-ttu-id="c7570-193">sp_lock &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="c7570-193">sp_lock &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-stored-procedures/sp-lock-transact-sql)  
  
 [<span data-ttu-id="c7570-194">KILL &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="c7570-194">KILL &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/language-elements/kill-transact-sql)  
  
 [<span data-ttu-id="c7570-195">DBCC CHECKALLOC &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="c7570-195">DBCC CHECKALLOC &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/database-console-commands/dbcc-checkalloc-transact-sql)  
  
 [<span data-ttu-id="c7570-196">DBCC CHECKDB &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="c7570-196">DBCC CHECKDB &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/database-console-commands/dbcc-checkdb-transact-sql)  
  
 [<span data-ttu-id="c7570-197">DBCC OPENTRAN &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="c7570-197">DBCC OPENTRAN &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/database-console-commands/dbcc-opentran-transact-sql)  
  
 [<span data-ttu-id="c7570-198">DBCC INPUTBUFFER &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="c7570-198">DBCC INPUTBUFFER &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/database-console-commands/dbcc-inputbuffer-transact-sql)  
  
 [<span data-ttu-id="c7570-199">サーバー構成オプション &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="c7570-199">Server Configuration Options &#40;SQL Server&#41;</span></span>](server-configuration-options-sql-server.md)  
  
 [<span data-ttu-id="c7570-200">トランザクション関連の動的管理ビューおよび関数 &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="c7570-200">Transaction Related Dynamic Management Views and Functions &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-dynamic-management-views/transaction-related-dynamic-management-views-and-functions-transact-sql)  
  
 [<span data-ttu-id="c7570-201">トレース フラグ &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="c7570-201">Trace Flags &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/database-console-commands/dbcc-traceon-trace-flags-transact-sql)  
  
  
