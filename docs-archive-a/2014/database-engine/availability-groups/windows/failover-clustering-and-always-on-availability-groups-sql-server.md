---
title: フェールオーバークラスタリングと AlwaysOn 可用性グループ (SQL Server) |Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- clustering [SQL Server]
- Availability Groups [SQL Server], WSFC clusters
- Failover Cluster Instances [SQL Server], see failover clustering [SQL Server]
- quorum [SQL Server]
- failover clustering [SQL Server], AlwaysOn Availability Groups
- Availability Groups [SQL Server], Failover Cluster Instances
ms.assetid: 613bfbf1-9958-477b-a6be-c6d4f18785c3
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 64ee815c2b852849d9506ca6c3fc114d3d0e4935
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87640240"
---
# <a name="failover-clustering-and-alwayson-availability-groups-sql-server"></a><span data-ttu-id="9c5d8-102">フェールオーバー クラスタリングと AlwaysOn 可用性グループ (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="9c5d8-102">Failover Clustering and AlwaysOn Availability Groups (SQL Server)</span></span>
  [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] <span data-ttu-id="9c5d8-103">で導入された [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] (High Availability and Disaster Recovery) ソリューションには、Windows Server フェールオーバー クラスタリング (WSFC) が必要です。 </span><span class="sxs-lookup"><span data-stu-id="9c5d8-103">, the high availability and disaster recovery solution introduced in [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)], requires Windows Server Failover Clustering (WSFC).</span></span> <span data-ttu-id="9c5d8-104">[!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] フェールオーバー クラスタリングには依存しませんが、 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] は、フェールオーバー クラスタリング インスタンス (FCI) を使用して、可用性グループの可用性レプリカをホストすることもできます。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-104">Also, though [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] is not dependent upon [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Failover Clustering, you can use a failover clustering instance (FCI) to host an availability replica for an availability group.</span></span> <span data-ttu-id="9c5d8-105">実際に [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] 環境を設計する際は、それぞれのクラスタリング テクノロジの役割を知り、注意点を把握しておくことが大切です。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-105">It is important to know the role of each clustering technology, and to know what considerations are necessary as you design your [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] environment.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="9c5d8-106">[!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] の概念については、「[AlwaysOn 可用性グループの概要 &#40;SQL Server&#41;](overview-of-always-on-availability-groups-sql-server.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-106">For information about [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] concepts, see [Overview of AlwaysOn Availability Groups &#40;SQL Server&#41;](overview-of-always-on-availability-groups-sql-server.md).</span></span>  
  

  
##  <a name="windows-server-failover-clustering-and-availability-groups"></a><a name="WSFC"></a> <span data-ttu-id="9c5d8-107">Windows Server フェールオーバー クラスタリングと可用性グループ</span><span class="sxs-lookup"><span data-stu-id="9c5d8-107">Windows Server Failover Clustering and Availability Groups</span></span>  
 <span data-ttu-id="9c5d8-108">[!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] を配置するには、Windows Server フェールオーバー クラスタリング (WSFC) クラスターが必要です。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-108">Deploying [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] requires a Windows Server Failover Clustering (WSFC) cluster.</span></span> <span data-ttu-id="9c5d8-109">[!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]を有効にするには、 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] のインスタンスが WSFC ノード上に存在し、WSFC クラスターとノードがオンライン状態である必要があります。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-109">To be enabled for [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], an instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] must reside on a WSFC node, and the WSFC cluster and node must be online.</span></span> <span data-ttu-id="9c5d8-110">さらに、特定の可用性グループの各可用性レプリカが、同じ WSFC クラスターの異なるノード上に存在する必要があります。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-110">Furthermore, each availability replica of a given availability group must reside on a different node of the same WSFC cluster.</span></span> <span data-ttu-id="9c5d8-111">唯一の例外は、別の WSFC クラスターに移行するときに、可用性グループは一時的に 2 つのクラスターにまたがることができるという点です。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-111">The only exception is that while being migrated to another WSFC cluster, an availability group can temporarily straddle two clusters.</span></span>  
  
 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] <span data-ttu-id="9c5d8-112">では、特定の可用性グループに属している可用性レプリカの現在のロールを監視、管理したり、フェールオーバー イベントが可用性レプリカに及ぼす影響を判断したりするために、 Windows Server フェールオーバー クラスタリング (WSFC) クラスターが使用されます。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-112">relies on the Windows Failover Clustering (WSFC) cluster to monitor and manage the current roles of the availability replicas that belong to a given availability group and to determine how a failover event affects the availability replicas.</span></span> <span data-ttu-id="9c5d8-113">WSFC リソース グループは、作成されたすべての可用性グループに対して作成されます。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-113">A WSFC resource group is created for every availability group that you create.</span></span> <span data-ttu-id="9c5d8-114">WSFC クラスターは、このリソース グループを監視して、プライマリ レプリカの正常性を評価します。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-114">The WSFC cluster monitors this resource group to evaluate the health of the primary replica.</span></span>  
  
 <span data-ttu-id="9c5d8-115">[!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] のクォーラムは、クラスター ノードが可用性レプリカをホストしているかどうかに関係なく、WSFC クラスター内のすべてのノードに基づきます。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-115">The quorum for [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] is based on all nodes in the WSFC cluster regardless of whether a given cluster node hosts any availability replicas.</span></span> <span data-ttu-id="9c5d8-116">データベース ミラーリングとは異なり、 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]には監視ロールはありません。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-116">In contrast to database mirroring, there is no witness role in [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span></span>  
  
 <span data-ttu-id="9c5d8-117">WSFC クラスターの全体的な正常性は、クラスター内のノードのクォーラムの投票によって決定されます。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-117">The overall health of a WSFC cluster is determined by the votes of quorum of nodes in the cluster.</span></span> <span data-ttu-id="9c5d8-118">災害や永続的なハードウェア障害または通信障害が原因で WSFC クラスターがオフラインになった場合は、管理操作を手動で行う必要があります。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-118">If the WSFC cluster goes offline because of an unplanned disaster, or due to a persistent hardware or communications failure, manual administrative intervention is required.</span></span> <span data-ttu-id="9c5d8-119">Windows Server または WSFC クラスターの管理者は、クォーラムを強制し、稼動しているクラスター ノードをフォールト トレラントではない構成でオンラインに戻す必要があります。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-119">A Windows Server or WSFC cluster administrator will need to force a quorum and then bring the surviving cluster nodes back online in a non-fault-tolerant configuration.</span></span>  
  
> [!IMPORTANT]  
>  [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] <span data-ttu-id="9c5d8-120">レジストリ キーは WSFC クラスターのサブキーです。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-120">registry keys are subkeys of the WSFC cluster.</span></span> <span data-ttu-id="9c5d8-121">WSFC クラスターを削除してから再作成した場合は、元の WSFC クラスター上の可用性レプリカをホストしていた [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] の各インスタンスについて、 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 機能を無効にしてから再度有効にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-121">If you delete and re-create a WSFC cluster, you must disable and re-enable the [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] feature on each instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] that hosted an availability replica on the original WSFC cluster.</span></span>  
  
 <span data-ttu-id="9c5d8-122">Windows Server フェールオーバー クラスタリング (WSFC) ノードでの [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] の実行および WSFC クォーラムについては、「[Windows Server フェールオーバー クラスタリング &#40;WSFC&#41;  と SQL Server](../../../sql-server/failover-clusters/windows/windows-server-failover-clustering-wsfc-with-sql-server.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-122">For information about running [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] on Windows Server Failover Clustering (WSFC) nodes and about WSFC quorum, see [Windows Server Failover Clustering &#40;WSFC&#41; with SQL Server](../../../sql-server/failover-clusters/windows/windows-server-failover-clustering-wsfc-with-sql-server.md).</span></span>  
  
### <a name="cross-cluster-migration-of-alwayson-availability-groups-for-os-upgrade"></a><span data-ttu-id="9c5d8-123">OS アップグレードのための AlwaysOn 可用性グループのクラスター間での移行</span><span class="sxs-lookup"><span data-stu-id="9c5d8-123">Cross-Cluster Migration of AlwaysOn Availability Groups for OS Upgrade</span></span>  
 <span data-ttu-id="9c5d8-124">[!INCLUDE[ssSQL11SP1](../../../includes/sssql11sp1-md.md)]から、 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] では、新しい Windows Server フェールオーバー クラスタリング (WSFC) クラスターに配置するために行う可用性グループのクラスター間での移行が新たにサポートされています。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-124">Beginning with [!INCLUDE[ssSQL11SP1](../../../includes/sssql11sp1-md.md)], [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] supports cross-cluster migration of availability groups for deployments to a new Windows Server Failover Clustering (WSFC) cluster.</span></span> <span data-ttu-id="9c5d8-125">クラスター間の移行では、ダウンタイムを最小限に抑えながら、1 つの可用性グループを (または複数の可用性グループを一括して) 新しい移行先 WSFC クラスターに移行します。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-125">A cross-cluster migration moves one availability group or a batch of availability groups to the new, destination WSFC cluster with minimal downtime.</span></span> <span data-ttu-id="9c5d8-126">クラスター間の移行プロセスを使用すると、 [!INCLUDE[win8srv](../../../includes/win8srv-md.md)] クラスターへのアップグレード時にサービス レベル契約 (SLA) を維持できます。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-126">The cross-cluster migration process enables you to maintain your service level agreements (SLAs) when upgrading to a [!INCLUDE[win8srv](../../../includes/win8srv-md.md)] cluster.</span></span> <span data-ttu-id="9c5d8-127">移行先の WSFC クラスターに [!INCLUDE[ssSQL11SP1](../../../includes/sssql11sp1-md.md)] (またはそれ以降のバージョン) をインストールし、AlwaysOn 用に有効にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-127">[!INCLUDE[ssSQL11SP1](../../../includes/sssql11sp1-md.md)] (or a later version) must be installed and enabled for AlwaysOn on the destination WSFC cluster.</span></span> <span data-ttu-id="9c5d8-128">クラスター間での移行を成功させるには、移行先 WSFC クラスターを綿密に計画し、準備することが必要です。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-128">The success of a cross-cluster migration depends on thorough planning and preparation of the destination WSFC cluster.</span></span>  
  
 <span data-ttu-id="9c5d8-129">詳細については、「[OS アップグレードのための AlwaysOn 可用性グループのクラスター間での移行](https://msdn.microsoft.com/library/jj873730.aspx)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-129">For more information, see [Cross-Cluster Migration of AlwaysOn Availability Groups for OS Upgrade](https://msdn.microsoft.com/library/jj873730.aspx).</span></span>  
  
##  <a name="ssnoversion-failover-cluster-instances-fcis-and-availability-groups"></a><a name="SQLServerFC"></a> <span data-ttu-id="9c5d8-130">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] フェールオーバー クラスター インスタンス (FCI) と可用性グループ</span><span class="sxs-lookup"><span data-stu-id="9c5d8-130">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Failover Cluster Instances (FCIs) and Availability Groups</span></span>  
 <span data-ttu-id="9c5d8-131">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] フェールオーバー クラスタリングを WSFC クラスターと共に実装することにより、サーバー インスタンス レベルで第 2 のフェールオーバー レイヤーをセットアップできます。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-131">You can set up a second layer of failover at the server-instance level by implementing [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] failover clustering together with the WSFC cluster.</span></span> <span data-ttu-id="9c5d8-132">可用性レプリカは、 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] のスタンドアロン インスタンスまたは FCI インスタンスでホストできます。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-132">An availability replica can be hosted by either a standalone instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] or an FCI instance.</span></span> <span data-ttu-id="9c5d8-133">特定の可用性グループのレプリカをホストできる FCI パートナーは 1 つに限られます。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-133">Only one FCI partner can host a replica for a given availability group.</span></span> <span data-ttu-id="9c5d8-134">可用性レプリカが FCI で実行されている場合、可用性グループの有効な所有者の一覧には、アクティブな FCI ノードだけが含まれます。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-134">When an availability replica is running on an FCI, the possible owners list for the availability group will contain only the active FCI node.</span></span>  
  
 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] <span data-ttu-id="9c5d8-135">は、共有ストレージの形態には依存しません。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-135">does not depend on any form of shared storage.</span></span> <span data-ttu-id="9c5d8-136">ただし、 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] フェールオーバー クラスター インスタンス (FCI) を使用して 1 つまたは複数の可用性レプリカをホストする場合、各 FCI では標準の SQL Server フェールオーバー クラスター インスタンスのインストールと同様、共有ストレージが必要になります。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-136">However, if you use a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] failover cluster instance (FCI) to host one or more availability replicas, each of those FCIs will require shared storage as per standard SQL Server failover cluster instance installation.</span></span>  
  
 <span data-ttu-id="9c5d8-137">追加の前提条件の詳細については、「[AlwaysOn 可用性グループの前提条件、制限事項、および推奨事項 &#40;SQL Server&#41;](prereqs-restrictions-recommendations-always-on-availability.md)」の「SQL Server のフェールオーバー クラスター インスタンス (FCI) を使用して可用性レプリカをホストするための前提条件と制限」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-137">For more information about additional prerequisites, see the "Prerequisites and Restrictions for Using a SQL Server Failover Cluster Instance (FCI) to Host an Availability Replica" section of [Prerequisites, Restrictions, and Recommendations for AlwaysOn Availability Groups &#40;SQL Server&#41;](prereqs-restrictions-recommendations-always-on-availability.md).</span></span>  
  
### <a name="comparison-of-failover-cluster-instances-and-availability-groups"></a><span data-ttu-id="9c5d8-138">フェールオーバー クラスター インスタンスと可用性グループの比較</span><span class="sxs-lookup"><span data-stu-id="9c5d8-138">Comparison of Failover Cluster Instances and Availability Groups</span></span>  
 <span data-ttu-id="9c5d8-139">FCI のノードの数に関係なく、FCI 全体は可用性グループ内の 1 つのレプリカをホストします。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-139">Regardless of the number of nodes in the FCI, an entire FCI hosts a single replica within an availability group.</span></span> <span data-ttu-id="9c5d8-140">次の表に、FCI 内のノードと可用性グループ内のレプリカの概念の違いについて説明します。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-140">The following table describes the distinctions in concepts between nodes in an FCI and replicas within an availability group.</span></span>  
  
||<span data-ttu-id="9c5d8-141">FCI 内のノード</span><span class="sxs-lookup"><span data-stu-id="9c5d8-141">Nodes within an FCI</span></span>|<span data-ttu-id="9c5d8-142">可用性グループ内のレプリカ</span><span class="sxs-lookup"><span data-stu-id="9c5d8-142">Replicas within an availability group</span></span>|  
|-|-------------------------|-------------------------------------------|  
|<span data-ttu-id="9c5d8-143">**WSFC クラスターを使用する**</span><span class="sxs-lookup"><span data-stu-id="9c5d8-143">**Uses WSFC cluster**</span></span>|<span data-ttu-id="9c5d8-144">はい</span><span class="sxs-lookup"><span data-stu-id="9c5d8-144">Yes</span></span>|<span data-ttu-id="9c5d8-145">はい</span><span class="sxs-lookup"><span data-stu-id="9c5d8-145">Yes</span></span>|  
|<span data-ttu-id="9c5d8-146">**保護レベル**</span><span class="sxs-lookup"><span data-stu-id="9c5d8-146">**Protection level**</span></span>|<span data-ttu-id="9c5d8-147">インスタンス</span><span class="sxs-lookup"><span data-stu-id="9c5d8-147">Instance</span></span>|<span data-ttu-id="9c5d8-148">データベース</span><span class="sxs-lookup"><span data-stu-id="9c5d8-148">Database</span></span>|  
|<span data-ttu-id="9c5d8-149">**ストレージの種類**</span><span class="sxs-lookup"><span data-stu-id="9c5d8-149">**Storage type**</span></span>|<span data-ttu-id="9c5d8-150">共有</span><span class="sxs-lookup"><span data-stu-id="9c5d8-150">Shared</span></span>|<span data-ttu-id="9c5d8-151">非共有</span><span class="sxs-lookup"><span data-stu-id="9c5d8-151">Non-shared</span></span><br /><br /> <span data-ttu-id="9c5d8-152">可用性グループ内のレプリカがストレージを共有しない一方、FCI によってホストされるレプリカは、FCI によって必要とされたときに共有ストレージ ソリューションを使用することに注意してください。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-152">Note that while the replicas in an availability group do not share storage, a replica that is hosted by an FCI uses a shared storage solution as required by that FCI.</span></span> <span data-ttu-id="9c5d8-153">ストレージ ソリューションは、可用性グループのレプリカ間ではなく、FCI 内のノードでのみ共有されます。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-153">The storage solution is shared only by nodes within the FCI and not between replicas of the availability group.</span></span>|  
|<span data-ttu-id="9c5d8-154">**ストレージ ソリューション**</span><span class="sxs-lookup"><span data-stu-id="9c5d8-154">**Storage solutions**</span></span>|<span data-ttu-id="9c5d8-155">直接接続、SAN、マウント ポイント、SMB</span><span class="sxs-lookup"><span data-stu-id="9c5d8-155">Direct attached, SAN, mount points, SMB</span></span>|<span data-ttu-id="9c5d8-156">ノードの種類によって異なる</span><span class="sxs-lookup"><span data-stu-id="9c5d8-156">Depends on node type</span></span>|  
|<span data-ttu-id="9c5d8-157">**読み取り可能なセカンダリ**</span><span class="sxs-lookup"><span data-stu-id="9c5d8-157">**Readable secondaries**</span></span>|<span data-ttu-id="9c5d8-158">いいえ\*</span><span class="sxs-lookup"><span data-stu-id="9c5d8-158">No\*</span></span>|<span data-ttu-id="9c5d8-159">はい</span><span class="sxs-lookup"><span data-stu-id="9c5d8-159">Yes</span></span>|  
|<span data-ttu-id="9c5d8-160">**該当するフェールオーバー ポリシー設定**</span><span class="sxs-lookup"><span data-stu-id="9c5d8-160">**Applicable failover policy settings**</span></span>|<span data-ttu-id="9c5d8-161">WSFC クォーラム</span><span class="sxs-lookup"><span data-stu-id="9c5d8-161">WSFC quorum</span></span><br /><br /> <span data-ttu-id="9c5d8-162">FCI 固有</span><span class="sxs-lookup"><span data-stu-id="9c5d8-162">FCI-specific</span></span><br /><br /> <span data-ttu-id="9c5d8-163">可用性グループ設定\*\*</span><span class="sxs-lookup"><span data-stu-id="9c5d8-163">Availability group settings\*\*</span></span>|<span data-ttu-id="9c5d8-164">WSFC クォーラム</span><span class="sxs-lookup"><span data-stu-id="9c5d8-164">WSFC quorum</span></span><br /><br /> <span data-ttu-id="9c5d8-165">可用性グループの設定</span><span class="sxs-lookup"><span data-stu-id="9c5d8-165">Availability group settings</span></span>|  
|<span data-ttu-id="9c5d8-166">**フェールオーバー リソース**</span><span class="sxs-lookup"><span data-stu-id="9c5d8-166">**Failed-over resources**</span></span>|<span data-ttu-id="9c5d8-167">サーバー、インスタンス、およびデータベース</span><span class="sxs-lookup"><span data-stu-id="9c5d8-167">Server, instance, and database</span></span>|<span data-ttu-id="9c5d8-168">データベースのみ</span><span class="sxs-lookup"><span data-stu-id="9c5d8-168">Database only</span></span>|  
  
 <span data-ttu-id="9c5d8-169">\*可用性グループ内の同期セカンダリ レプリカは、常に対応する [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] インスタンス上で実行されていますが、FCI 内のセカンダリ ノードは、実際には対応する [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] インスタンスを起動していないため、読み取り不可能です。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-169">\*Whereas synchronous secondary replicas in an availability group are always running on their respective [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instances, secondary nodes in an FCI actually have not started their respective [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instances and are therefore not readable.</span></span> <span data-ttu-id="9c5d8-170">FCI 内のセカンダリ ノードは、FCI フェールオーバー中にリソース グループの所有権が転送されたときにのみ、 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] インスタンスを起動します。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-170">In an FCI, a secondary node starts its [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance only when the resource group ownership is transferred to it during an FCI failover.</span></span> <span data-ttu-id="9c5d8-171">ただし、アクティブな FCI ノードにおいて、FCI によってホストされるデータベースが可用性グループに属している場合にローカルな可用性グループが読み取り可能なセカンダリ レプリカとして実行されていると、データベースは読み取り可能です。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-171">However, on the active FCI node, when an FCI-hosted database belongs to an availability group, if the local availability replica is running as a readable secondary replica, the database is readable.</span></span>  
  
 <span data-ttu-id="9c5d8-172">\*\*可用性グループのフェールオーバー ポリシー設定は、スタンドアロン インスタンスと FCI インスタンスのどちらでホストされているかに関係なく、すべてのレプリカに適用されます。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-172">\*\*Failover policy settings for the availability group apply to all replicas, whether it is hosted in a standalone instance or an FCI instance.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="9c5d8-173">フェールオーバークラスタリング内の**ノード数**、およびの各エディションの**AlwaysOn 可用性グループ**について [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] は、「 [SQL Server 2012 の各エディションがサポートする機能](https://go.microsoft.com/fwlink/?linkid=232473)」 (を参照してください https://go.microsoft.com/fwlink/?linkid=232473) 。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-173">For more information about **Number of nodes** within Failover Clustering and **AlwaysOn Availability Groups** for different editions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], see [Features Supported by the Editions of SQL Server 2012](https://go.microsoft.com/fwlink/?linkid=232473) (https://go.microsoft.com/fwlink/?linkid=232473).</span></span>  
  
### <a name="considerations-for-hosting-an-availability-replica-on-an-fci"></a><span data-ttu-id="9c5d8-174">FCI で可用性レプリカをホストする場合の考慮事項</span><span class="sxs-lookup"><span data-stu-id="9c5d8-174">Considerations for hosting an Availability Replica on an FCI</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="9c5d8-175">SQL Server フェールオーバー クラスター インスタンス (FCI) で可用性レプリカをホストすることを計画している場合は、Windows Server 2008 ホスト ノードが AlwaysOn の前提条件およびフェールオーバー クラスター インスタンス (FCI) の制限を満たしていることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-175">If you plan to host an availability replica on a SQL Server Failover Cluster Instance (FCI), ensure that the Windows Server 2008 host nodes meet the AlwaysOn prerequisites and restrictions for Failover Cluster Instances (FCIs).</span></span> <span data-ttu-id="9c5d8-176">詳細については、「[AlwaysOn 可用性グループの前提条件、制限事項、および推奨事項 &#40;SQL Server&#41;](prereqs-restrictions-recommendations-always-on-availability.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-176">For more information, see [Prerequisites, Restrictions, and Recommendations for AlwaysOn Availability Groups &#40;SQL Server&#41;](prereqs-restrictions-recommendations-always-on-availability.md).</span></span>  
  
 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="9c5d8-177">フェールオーバー クラスター インスタンス (FCI) は可用性グループによる自動フェールオーバーをサポートしないため、FCI によってホストされる可用性レプリカは手動フェールオーバー用にのみ構成できます。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-177">Failover Cluster Instances (FCIs) do not support automatic failover by availability groups, so any availability replica that is hosted by an FCI can only be configured for manual failover.</span></span>  
  
 <span data-ttu-id="9c5d8-178">場合により、すべてのノードで使用できない共有ディスクを含めるように Windows Server フェールオーバー クラスタリング (WSFC) クラスターを構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-178">You might need to configure a Windows Server Failover Clustering (WSFC) cluster to include shared disks that are not available on all nodes.</span></span> <span data-ttu-id="9c5d8-179">たとえば、3 つのノードを持つ 2 つのデータ センター間の WSFC クラスターを検討します。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-179">For example, consider a WSFC cluster across two data centers with three nodes.</span></span> <span data-ttu-id="9c5d8-180">ノードのうちの 2 つは、プライマリ データ センター内の SQL Server フェールオーバー クラスタリング インスタンス (FCI) をホストし、同じ共有ディスクにアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-180">Two of the nodes host a SQL Server failover clustering instance (FCI) in the primary data center and have access to the same shared disks.</span></span> <span data-ttu-id="9c5d8-181">3 つ目のノードは、別のデータ センター内の SQL Server のスタンドアロン インスタンスをホストし、プライマリ データ センターの共有ディスクにはアクセスできません。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-181">The third node hosts a stand-alone instance of SQL Server in a different data center and does not have access to the shared disks from the primary data center.</span></span> <span data-ttu-id="9c5d8-182">この WSFC クラスター構成では、FCI でプライマリ レプリカがホストされ、スタンドアロン インスタンスでセカンダリ レプリカがホストされる場合に可用性グループの配置がサポートされます。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-182">This WSFC cluster configuration supports the deployment of an availability group if the FCI hosts the primary replica and the stand-alone instance hosts the secondary replica.</span></span>  
  
 <span data-ttu-id="9c5d8-183">特定の可用性グループの可用性レプリカをホストするために FCI を選択する場合は、FCI フェールオーバーによって 1 つの WSFC ノードで同じ可用性グループの 2 つの可用性レプリカをホストする操作が試行されないように注意してください。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-183">When choosing an FCI to host an availability replica for a given availability group, ensure that an FCI failover could not potentially cause a single WSFC node to attempt to host two availability replicas for the same availability group.</span></span>  
  
 <span data-ttu-id="9c5d8-184">この構成によってどのような問題が起きるかを次のサンプル シナリオに示します。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-184">The following example scenario illustrates how this configuration could lead to problems:</span></span>  
  
 <span data-ttu-id="9c5d8-185">Marcel は、 `NODE01` と `NODE02`の 2 つのノードから成る WSFC クラスターを構成しています。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-185">Marcel configures two a WSFC cluster with two nodes, `NODE01` and `NODE02`.</span></span> <span data-ttu-id="9c5d8-186">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] フェールオーバー クラスター インスタンス `fciInstance1`は、 `NODE01` と `NODE02` の両方にインストールされています。 `NODE01` の現在の所有者は `fciInstance1`です。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-186">He installs a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] failover cluster instance, `fciInstance1`, on both `NODE01` and `NODE02` where `NODE01` is the current owner for `fciInstance1`.</span></span>  
 <span data-ttu-id="9c5d8-187">Marcel は、 `NODE02`に、別の [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]インスタンス `Instance3`をインストールすることにしました。Instance3 はスタンドアロン インスタンスです。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-187">On `NODE02`, Marcel installs another instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], `Instance3`, which is a stand-alone instance.</span></span>  
 <span data-ttu-id="9c5d8-188">Marcel は、 `NODE01`で、fciInstance1 に対する [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]を有効にしました。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-188">On `NODE01`, Marcel enables fciInstance1 for [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span></span> <span data-ttu-id="9c5d8-189">`NODE02`では、 `Instance3` に対する [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]を有効にしました。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-189">On `NODE02`, he enables `Instance3` for [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span></span> <span data-ttu-id="9c5d8-190">さらに、可用性グループをセットアップしました。この可用性グループは、 `fciInstance1` がプライマリ レプリカをホストするためだけでなく、 `Instance3` がセカンダリ レプリカをホストするためにも使用されます。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-190">Then he sets up an availability group for which `fciInstance1` hosts the primary replica, and `Instance3` hosts the secondary replica.</span></span>  
 <span data-ttu-id="9c5d8-191">あるとき、 `fciInstance1` 上の `NODE01`が利用できなくなり、WSFC クラスターによって、 `fciInstance1` が `NODE02`にフェールオーバーされたとします。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-191">At some point `fciInstance1` becomes unavailable on `NODE01`, and the WSFC cluster causes a failover of `fciInstance1` to `NODE02`.</span></span> <span data-ttu-id="9c5d8-192">フェールオーバー後の `fciInstance1` は、 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]上でプライマリ ロールとして動作する `NODE02`対応のインスタンスです。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-192">After the failover, `fciInstance1` is a [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]-enabled instance running under the primary role on `NODE02`.</span></span> <span data-ttu-id="9c5d8-193">しかし、この時点で `Instance3` は、 `fciInstance1`と同じ WSFC ノードに存在します。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-193">However, `Instance3` now resides on the same WSFC node as `fciInstance1`.</span></span> <span data-ttu-id="9c5d8-194">これは [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] の制約に違反します。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-194">This violates the [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] constraint.</span></span>  
 <span data-ttu-id="9c5d8-195">このシナリオで起きる問題を回避するには、スタンドアロン インスタンス ( `Instance3`) が、 `NODE01` や `NODE02`と同じ WSFC クラスター内の別のノードに存在している必要があります。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-195">To correct the problem that this scenario presents, the stand-alone instance, `Instance3`, must reside on another node in the same WSFC cluster as `NODE01` and `NODE02`.</span></span>  
  
 <span data-ttu-id="9c5d8-196">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] フェールオーバー クラスタリングの詳細については、「[AlwaysOn フェールオーバー クラスター インスタンス &#40;SQL Server&#41;](../../../sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-196">For more information about [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] failover clustering, see [AlwaysOn Failover Cluster Instances &#40;SQL Server&#41;](../../../sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server.md).</span></span>  
  
##  <a name="restrictions-on-using-the-wsfc-failover-cluster-manager-with-availability-groups"></a><a name="FCMrestrictions"></a><span data-ttu-id="9c5d8-197">WSFC フェールオーバークラスターマネージャーを可用性グループと共に使用する場合の制限事項</span><span class="sxs-lookup"><span data-stu-id="9c5d8-197">Restrictions on Using The WSFC Failover Cluster Manager with Availability Groups</span></span>  
 <span data-ttu-id="9c5d8-198">フェールオーバー クラスター マネージャーを使用して可用性グループを操作しないでください。次に例を示します。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-198">Do not use the Failover Cluster Manager to manipulate availability groups, for example:</span></span>  
  
-   <span data-ttu-id="9c5d8-199">可用性グループのクラスター化されたサービス (リソース グループ) のリソースの追加や削除を行わないでください。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-199">Do not add or remove resources in the clustered service (resource group) for the availability group.</span></span>  
  
-   <span data-ttu-id="9c5d8-200">可用性グループのプロパティ (たとえば、有効な所有者、優先所有者) を変更しないでください。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-200">Do not change any availability group properties, such as the possible owners and preferred owners.</span></span> <span data-ttu-id="9c5d8-201">これらのプロパティは、可用性グループによって自動的に設定されます。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-201">These properties are set automatically by the availability group.</span></span>  
  
-   <span data-ttu-id="9c5d8-202">フェールオーバー クラスター マネージャーを使用して可用性グループを他のノードに移動したり可用性グループをフェールオーバーしたりしないでください。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-202">Do not use the Failover Cluster Manager to move availability groups to different nodes or to fail over availability groups.</span></span> <span data-ttu-id="9c5d8-203">フェールオーバー クラスターは可用性レプリカの同期状態を認識しないため、そのような操作を行うとダウンタイムが長くなることがあります。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-203">The Failover Cluster Manager is not aware of the synchronization status of the availability replicas, and doing so can lead to extended downtime.</span></span> <span data-ttu-id="9c5d8-204">[!INCLUDE[tsql](../../../includes/tsql-md.md)] または [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)]を使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="9c5d8-204">You must use [!INCLUDE[tsql](../../../includes/tsql-md.md)] or [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)].</span></span>  
  
##  <a name="related-content"></a><a name="RelatedContent"></a> <span data-ttu-id="9c5d8-205">関連コンテンツ</span><span class="sxs-lookup"><span data-stu-id="9c5d8-205">Related Content</span></span>  
  
-   <span data-ttu-id="9c5d8-206">**ブログ:**</span><span class="sxs-lookup"><span data-stu-id="9c5d8-206">**Blogs:**</span></span>  
  
     [<span data-ttu-id="9c5d8-207">制限付きセキュリティを使用した SQL Server 用 Windows フェールオーバー クラスタリング (可用性グループまたは FCI) の構成</span><span class="sxs-lookup"><span data-stu-id="9c5d8-207">Configure Windows Failover Clustering for SQL Server (Availability Group or FCI) with Limited Security</span></span>](https://blogs.msdn.com/b/sqlalwayson/archive/2012/06/05/configure-windows-failover-clustering-for-sql-server-availability-group-or-fci-with-limited-security.aspx)  
  
     [<span data-ttu-id="9c5d8-208">SQL Server AlwaysOn チームのブログ:SQL Server AlwaysOn チームのオフィシャル ブログ</span><span class="sxs-lookup"><span data-stu-id="9c5d8-208">SQL Server AlwaysOn Team Blogs: The official SQL Server AlwaysOn Team Blog</span></span>](https://blogs.msdn.com/b/sqlalwayson/)  
  
     [<span data-ttu-id="9c5d8-209">CSS SQL Server エンジニアのブログ</span><span class="sxs-lookup"><span data-stu-id="9c5d8-209">CSS SQL Server Engineers Blogs</span></span>](https://blogs.msdn.com/b/psssql/)  
  
-   <span data-ttu-id="9c5d8-210">**ホワイト ペーパー:**</span><span class="sxs-lookup"><span data-stu-id="9c5d8-210">**Whitepapers:**</span></span>  
  
     [<span data-ttu-id="9c5d8-211">AlwaysOn アーキテクチャ ガイド: フェールオーバー クラスター インスタンスと可用性グループの使用による高可用性および災害復旧ソリューションの構築</span><span class="sxs-lookup"><span data-stu-id="9c5d8-211">AlwaysOn Architecture Guide: Building a High Availability and Disaster Recovery Solution by Using Failover Cluster Instances and Availability Groups</span></span>](https://msdn.microsoft.com/library/jj215886.aspx)  
  
     [<span data-ttu-id="9c5d8-212">高可用性と災害復旧のための Microsoft SQL Server AlwaysOn ソリューション ガイド</span><span class="sxs-lookup"><span data-stu-id="9c5d8-212">Microsoft SQL Server AlwaysOn Solutions Guide for High Availability and Disaster Recovery</span></span>](https://go.microsoft.com/fwlink/?LinkId=227600)  
  
     [<span data-ttu-id="9c5d8-213">SQL Server 2012 に関する Microsoft ホワイト ペーパー</span><span class="sxs-lookup"><span data-stu-id="9c5d8-213">Microsoft White Papers for SQL Server 2012</span></span>](https://msdn.microsoft.com/library/hh403491.aspx)  
  
     [<span data-ttu-id="9c5d8-214">SQL Server ユーザー諮問チームのホワイト ペーパー</span><span class="sxs-lookup"><span data-stu-id="9c5d8-214">SQL Server Customer Advisory Team Whitepapers</span></span>](http://sqlcat.com/)  
  
## <a name="see-also"></a><span data-ttu-id="9c5d8-215">参照</span><span class="sxs-lookup"><span data-stu-id="9c5d8-215">See Also</span></span>  
 <span data-ttu-id="9c5d8-216">[AlwaysOn 可用性グループ &#40;SQL Server の概要](overview-of-always-on-availability-groups-sql-server.md)AlwaysOn 可用性グループ &#40;SQL Server を[有効または無効にする](enable-and-disable-always-on-availability-groups-sql-server.md)&#41;[transact-sql&#41;&#40;可用性グループを監視](monitor-availability-groups-transact-sql.md)する</span><span class="sxs-lookup"><span data-stu-id="9c5d8-216">[Overview of AlwaysOn Availability Groups &#40;SQL Server&#41;](overview-of-always-on-availability-groups-sql-server.md) [Enable and Disable AlwaysOn Availability Groups &#40;SQL Server&#41;](enable-and-disable-always-on-availability-groups-sql-server.md) [Monitor Availability Groups &#40;Transact-SQL&#41;](monitor-availability-groups-transact-sql.md)</span></span>  
 [<span data-ttu-id="9c5d8-217">AlwaysOn フェールオーバークラスターインスタンス &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="9c5d8-217">AlwaysOn Failover Cluster Instances &#40;SQL Server&#41;</span></span>](../../../sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server.md) 
  
  
