---
title: フェールオーバーとフェールオーバーモード (AlwaysOn 可用性グループ) |Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- Availability Groups [SQL Server], availability replicas
- Availability Groups [SQL Server], failover
- Availability Groups [SQL Server], failover modes
- failover [SQL Server], AlwaysOn Availability Groups
ms.assetid: 378d2d63-50b9-420b-bafb-d375543fda17
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: eb904cd0f0649c43553b5d6c8b031c5f284901f4
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87640248"
---
# <a name="failover-and-failover-modes-alwayson-availability-groups"></a><span data-ttu-id="a6a21-102">フェールオーバーとフェールオーバー モード (AlwaysOn 可用性グループ)</span><span class="sxs-lookup"><span data-stu-id="a6a21-102">Failover and Failover Modes (AlwaysOn Availability Groups)</span></span>
  <span data-ttu-id="a6a21-103">一般的に、可用性グループのコンテキスト内で、可用性レプリカのプライマリ ロールとセカンダリ ロールが *フェールオーバー*と呼ばれるプロセスで交換されることがあります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-103">Within the context of an availability group, the primary role and secondary role of availability replicas are typically interchangeable in a process known as *failover*.</span></span> <span data-ttu-id="a6a21-104">フェールオーバーには、自動フェールオーバー (データ損失なし)、計画的な手動フェールオーバー (データ損失なし)、および " *強制フェールオーバー*" と通常呼ばれる強制手動フェールオーバー (データ損失の可能性あり) の 3 つの形式があります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-104">Three forms of failover exist: automatic failover (without data loss), planned manual failover (without data loss), and forced manual failover (with possible data loss), typically called *forced failover*.</span></span> <span data-ttu-id="a6a21-105">自動フェールオーバーと計画的な手動フェールオーバーでは、すべてのデータが保持されます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-105">Automatic and planned manual failover preserve all your data.</span></span> <span data-ttu-id="a6a21-106">可用性グループは、可用性レプリカのレベルでフェールオーバーします。</span><span class="sxs-lookup"><span data-stu-id="a6a21-106">An availability group fails over at the availability-replica level.</span></span> <span data-ttu-id="a6a21-107">つまり、可用性グループはセカンダリ レプリカのいずれか (現在の " *フェールオーバー ターゲット*") にフェールオーバーされます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-107">That is, an availability group fails over to one of its secondary replicas (the current *failover target*).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="a6a21-108">データベース レベルの問題 (データ ファイルの損失、データベースの削除、トランザクション ログの破損による障害が疑われる場合など) が発生しても、可用性グループのフェールオーバーは行われません。</span><span class="sxs-lookup"><span data-stu-id="a6a21-108">Issues at the database level, such as a database becoming suspect due to the loss of a data file, deletion of a database, or corruption of a transaction log, do not cause an availability group to failover.</span></span>  
  
 <span data-ttu-id="a6a21-109">フェールオーバーによってフェールオーバー ターゲットがプライマリ ロールを引き継ぎ、そのデータベースを復旧し、新しいプライマリ データベースとしてオンラインにします。</span><span class="sxs-lookup"><span data-stu-id="a6a21-109">During the failover, the failover target takes over the primary role, recovers its databases, and brings them online as the new primary databases.</span></span> <span data-ttu-id="a6a21-110">元のプライマリ レプリカは使用可能になるとセカンダリ ロールに切り替わり、そのデータベースがセカンダリ データベースになります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-110">The former primary replica, when available, switches to the secondary role, and its databases become secondary databases.</span></span> <span data-ttu-id="a6a21-111">場合によっては、複数のエラーに対する対応として、または管理目的のために、これらのロールを何度も交代できます (または、別のフェールオーバー ターゲットに切り替えることができます)。</span><span class="sxs-lookup"><span data-stu-id="a6a21-111">Potentially, these roles can switch back and forth (or to a different failover target) in response to multiple failures or for administrative purposes.</span></span>  
  
 <span data-ttu-id="a6a21-112">特定の可用性レプリカがサポートするフェールオーバーの形式は、" *フェールオーバー モード* " プロパティで指定されます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-112">The form(s) of failover that a given availability replica supports is specified by the *failover mode* property.</span></span> <span data-ttu-id="a6a21-113">可用性レプリカの有効なフェールオーバー モードは、次のようにそのレプリカの [可用性モード](availability-modes-always-on-availability-groups.md) によって異なります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-113">For a given availability replica, the possible failover modes depends on the [availability mode](availability-modes-always-on-availability-groups.md) of the replica, as follows:</span></span>  
  
-   <span data-ttu-id="a6a21-114">**同期コミット レプリカ:** 自動と手動の 2 つの設定をサポートします。</span><span class="sxs-lookup"><span data-stu-id="a6a21-114">**Synchronous-commit replicas** support two settings-automatic or manual.</span></span> <span data-ttu-id="a6a21-115">"自動" 設定では、自動フェールオーバーと手動フェールオーバーの両方をサポートしています。</span><span class="sxs-lookup"><span data-stu-id="a6a21-115">The "automatic" setting supports both automatic failover and manual failover.</span></span> <span data-ttu-id="a6a21-116">データの損失を回避するために、自動フェールオーバーおよび計画的なフェールオーバーでは、フェールオーバー ターゲットが正常な同期状態を持つセカンダリ レプリカを同期コミットします (これは、フェールオーバー ターゲット上のすべてのセカンダリ データベースが対応するプライマリ データベースと同期されることを表します)。</span><span class="sxs-lookup"><span data-stu-id="a6a21-116">To prevent data loss, automatic failover and planned failover require that the failover target be a synchronous-commit secondary replica with a healthy synchronization state (this indicates that every secondary database on the failover target is synchronized with its corresponding primary database).</span></span> <span data-ttu-id="a6a21-117">セカンダリ レプリカがどちらの条件も満たさない場合は、強制フェールオーバーのみがサポートされます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-117">Whenever a secondary replica does not meet both of these conditions, it supports only forced failover.</span></span> <span data-ttu-id="a6a21-118">ロールが RESOLVING 状態であるレプリカでも強制フェールオーバーがサポートされていることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="a6a21-118">Note that forced failover is also supported a replicas whose role is in the RESOLVING state.</span></span>  
  
-   <span data-ttu-id="a6a21-119">**非同期コミット レプリカ:** 手動フェールオーバー モードのみをサポートします。</span><span class="sxs-lookup"><span data-stu-id="a6a21-119">**Asynchronous-commit replicas** support only the manual failover mode.</span></span> <span data-ttu-id="a6a21-120">また、同期されないため、強制フェールオーバーのみをサポートします。</span><span class="sxs-lookup"><span data-stu-id="a6a21-120">Moreover, because they are never synchronized, they support only forced failover.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="a6a21-121">フェールオーバー後、プライマリ データベースにアクセスする必要があるクライアント アプリケーションは、新しいプライマリ レプリカに接続する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-121">After a failover, client applications that need to access the primary databases must connect to the new primary replica.</span></span> <span data-ttu-id="a6a21-122">また、新しいセカンダリ レプリカが読み取り専用アクセスを許可するように構成されている場合は、読み取り専用クライアント アプリケーションから接続できます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-122">Also, if the new secondary replica is configured to allow read-only access, read-only client applications can connect to it.</span></span> <span data-ttu-id="a6a21-123">可用性グループ リスナーの詳細については、「[可用性グループ リスナー、クライアント接続、およびアプリケーションのフェールオーバー &#40;SQL Server&#41;](../../listeners-client-connectivity-application-failover.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="a6a21-123">For information about how clients connect to an availability group, see [Availability Group Listeners, Client Connectivity, and Application Failover &#40;SQL Server&#41;](../../listeners-client-connectivity-application-failover.md).</span></span>  
  
  
##  <a name="terms-and-definitions"></a><a name="TermsAndDefinitions"></a> <span data-ttu-id="a6a21-124">用語と定義</span><span class="sxs-lookup"><span data-stu-id="a6a21-124">Terms and Definitions</span></span>  
 <span data-ttu-id="a6a21-125">自動フェールオーバー</span><span class="sxs-lookup"><span data-stu-id="a6a21-125">Automatic failover</span></span>  
 <span data-ttu-id="a6a21-126">プライマリ レプリカの喪失によって自動的に発生するフェールオーバー。</span><span class="sxs-lookup"><span data-stu-id="a6a21-126">A failover that occurs automatically on the loss of the primary replica.</span></span> <span data-ttu-id="a6a21-127">自動フェールオーバーは、現在のプライマリ レプリカと 1 つのセカンダリ レプリカのフェールオーバー モードがどちらも AUTOMATIC に設定され、セカンダリ レプリカが現在同期されている場合のみサポートされます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-127">Automatic failover is supported only when the current primary and one secondary replica are both configured with failover mode set to AUTOMATIC and the secondary replica currently synchronized.</span></span>  <span data-ttu-id="a6a21-128">プライマリ レプリカまたはセカンダリ レプリカのフェールオーバー モードが MANUAL に設定されている場合、自動フェールオーバーは実行されません。</span><span class="sxs-lookup"><span data-stu-id="a6a21-128">If the failover mode of either the primary or secondary replica is MANUAL, automatic failover cannot occur.</span></span>  
  
 <span data-ttu-id="a6a21-129">計画的な手動フェールオーバー (データ損失なし)</span><span class="sxs-lookup"><span data-stu-id="a6a21-129">Planned manual failover (without data loss)</span></span>  
 <span data-ttu-id="a6a21-130">計画的な手動フェールオーバーまたは " *手動フェールオーバー*" は、一般的に管理目的でデータベース管理者によって開始されるフェールオーバーです。</span><span class="sxs-lookup"><span data-stu-id="a6a21-130">Planned manual failover, or *manual failover*, is a failover that is initiated by a database administrator, typically, for administrative purposes.</span></span> <span data-ttu-id="a6a21-131">計画的な手動フェールオーバーは、プライマリ レプリカおよびセカンダリ レプリカに同期コミット モードが構成され、セカンダリ レプリカが現在プライマリ レプリカと同期されている (SYNCHRONIZED 状態になっている) 場合にのみサポートされます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-131">A planned manual failover is supported only if both the primary replica and secondary replica are configured for synchronous-commit mode and the secondary replica is currently synchronized (in the SYNCHRONIZED state).</span></span> <span data-ttu-id="a6a21-132">対象のセカンダリ レプリカが同期されているときは、セカンダリ データベースでフェールオーバーの準備が整っているため、プライマリ レプリカがクラッシュした場合でも手動フェールオーバー (データ損失なし) を実行できます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-132">When the target secondary replica is synchronized, manual failover (without data loss) is possible even if the primary replica has crashed because the secondary databases are ready for failover.</span></span> <span data-ttu-id="a6a21-133">データベース管理者は手動フェールオーバーを手動で開始します。</span><span class="sxs-lookup"><span data-stu-id="a6a21-133">A database administrator manually initiates a manual failover.</span></span>  
  
 <span data-ttu-id="a6a21-134">強制フェールオーバー (データ損失の可能性あり)</span><span class="sxs-lookup"><span data-stu-id="a6a21-134">Forced failover (with possible data loss)</span></span>  
 <span data-ttu-id="a6a21-135">プライマリ レプリカに同期されている (SYNCHRONIZED 状態の) セカンダリ レプリカがない場合、またはプライマリ レプリカが実行されていないためにセカンダリ レプリカでフェールオーバーの準備が整っていない場合に、データベース管理者が開始できるフェールオーバー。</span><span class="sxs-lookup"><span data-stu-id="a6a21-135">A failover that can be initiated by a database administrator when no secondary replica is SYNCHRONIZED with the primary replica or the primary replica is not running and no secondary replica is failover ready.</span></span> <span data-ttu-id="a6a21-136">強制フェールオーバーはデータを損失する可能性があるため、ディザスター リカバリーにのみ使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="a6a21-136">Forced failover risks possible data loss and is recommended strictly for disaster recovery.</span></span> <span data-ttu-id="a6a21-137">強制フェールオーバーは、手動のみで開始できるため、強制手動フェールオーバーとも呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-137">Forced failover is also known as forced manual failover because it can only be initiated manually.</span></span> <span data-ttu-id="a6a21-138">これは、非同期コミット可用性モードでサポートされているフェールオーバーの唯一の形式です。</span><span class="sxs-lookup"><span data-stu-id="a6a21-138">This is the only form of failover supported by in asynchronous-commit availability mode.</span></span>  
  
 [!INCLUDE[ssFosAutoC](../../../includes/ssfosautoc-md.md)]  
 <span data-ttu-id="a6a21-139">指定された可用性グループ内で、自動フェールオーバーが指定された同期コミット モード (存在する場合) が構成されている、(現在のプライマリ レプリカを含む) 可用性レプリカのペア。</span><span class="sxs-lookup"><span data-stu-id="a6a21-139">Within a given availability group, a pair of availability replicas (including the current primary replica) that are configured for synchronous-commit mode with automatic failover, if any.</span></span> <span data-ttu-id="a6a21-140">[!INCLUDE[ssFosAuto](../../../includes/ssfosauto-md.md)]は、セカンダリ レプリカがプライマリ レプリカとの間で現在 SYNCHRONIZED 状態にある場合のみ有効です。</span><span class="sxs-lookup"><span data-stu-id="a6a21-140">An[!INCLUDE[ssFosAuto](../../../includes/ssfosauto-md.md)]takes effect only if the secondary replica is currently SYNCHRONIZED with the primary replica.</span></span>  
  
 [!INCLUDE[ssFosSyncC](../../../includes/ssfossyncc-md.md)]  
 <span data-ttu-id="a6a21-141">指定された可用性グループ内で、同期コミット モード (存在する場合) が構成されている、(現在のプライマリ レプリカを含む) 2 つまたは 3 つの可用性レプリカのセット。</span><span class="sxs-lookup"><span data-stu-id="a6a21-141">Within a given availability group, a set of two or three availability replicas (including the current primary replica) that are configured for synchronous-commit mode, if any.</span></span> <span data-ttu-id="a6a21-142">[!INCLUDE[ssFosSync](../../../includes/ssfossync-md.md)]は、セカンダリ レプリカに手動フェールオーバー モードが構成され、1 つ以上のセカンダリ レプリカとプライマリ レプリカが現在 SYNCHRONIZED 状態にある場合のみ有効です。</span><span class="sxs-lookup"><span data-stu-id="a6a21-142">A [!INCLUDE[ssFosSync](../../../includes/ssfossync-md.md)]takes effect only if the secondary replicas are configured for manual failover mode and at least one secondary replica is currently SYNCHRONIZED with the primary replica.</span></span>  
  
 [!INCLUDE[ssFosEntireC](../../../includes/ssfosentirec-md.md)]  
 <span data-ttu-id="a6a21-143">指定された可用性グループ内で、可用性モードおよびフェールオーバー モードに関係なく、現在の操作状態が ONLINE であるすべての可用性レプリカのセット。</span><span class="sxs-lookup"><span data-stu-id="a6a21-143">Within a given availability group, the set of all availability replicas whose operational state is currently ONLINE, regardless of availability mode and of failover mode.</span></span> <span data-ttu-id="a6a21-144">[!INCLUDE[ssFosEntire](../../../includes/ssfosentire-md.md)]は、現在プライマリ レプリカと SYNCHRONIZED 状態になっているセカンダリ レプリカがない場合に有効です。</span><span class="sxs-lookup"><span data-stu-id="a6a21-144">The [!INCLUDE[ssFosEntire](../../../includes/ssfosentire-md.md)]becomes relevant when no secondary replica is currently SYNCHRONIZED with the primary replica.</span></span>  
  
##  <a name="overview-of-failover"></a><a name="Overview"></a> <span data-ttu-id="a6a21-145">フェールオーバーの概要</span><span class="sxs-lookup"><span data-stu-id="a6a21-145">Overview of Failover</span></span>  
 <span data-ttu-id="a6a21-146">次の表に、各種の可用性モードおよびフェールオーバー モードでサポートされるフェールオーバーの形式をまとめます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-146">The following table summarizes which forms of failover are supported under different availability and failover modes.</span></span> <span data-ttu-id="a6a21-147">それぞれの組み合わせについて、プライマリ レプリカのモードと 1 つまたは複数のセカンダリ レプリカのモードとが交差する部分から、有効な可用性モードおよびフェールオーバー モードを判定できます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-147">For each pairing, the effective availability mode and failover mode is determined by the intersection of the modes of the primary replica plus the modes of one or more secondary replicas.</span></span>  
  
||<span data-ttu-id="a6a21-148">非同期コミット モード</span><span class="sxs-lookup"><span data-stu-id="a6a21-148">Asynchronous-commit mode</span></span>|<span data-ttu-id="a6a21-149">手動フェールオーバー モードを指定した同期コミット モード</span><span class="sxs-lookup"><span data-stu-id="a6a21-149">Synchronous-commit mode with manual-failover mode</span></span>|<span data-ttu-id="a6a21-150">自動フェールオーバーを指定した同期コミット モード</span><span class="sxs-lookup"><span data-stu-id="a6a21-150">Synchronous-commit mode with automatic-failover mode</span></span>|  
|-|-------------------------------|---------------------------------------------------------|------------------------------------------------------------|  
|<span data-ttu-id="a6a21-151">自動フェールオーバー</span><span class="sxs-lookup"><span data-stu-id="a6a21-151">Automatic failover</span></span>|<span data-ttu-id="a6a21-152">いいえ</span><span class="sxs-lookup"><span data-stu-id="a6a21-152">No</span></span>|<span data-ttu-id="a6a21-153">いいえ</span><span class="sxs-lookup"><span data-stu-id="a6a21-153">No</span></span>|<span data-ttu-id="a6a21-154">はい</span><span class="sxs-lookup"><span data-stu-id="a6a21-154">Yes</span></span>|  
|<span data-ttu-id="a6a21-155">計画的な手動フェールオーバー</span><span class="sxs-lookup"><span data-stu-id="a6a21-155">Planned manual failover</span></span>|<span data-ttu-id="a6a21-156">いいえ</span><span class="sxs-lookup"><span data-stu-id="a6a21-156">No</span></span>|<span data-ttu-id="a6a21-157">はい</span><span class="sxs-lookup"><span data-stu-id="a6a21-157">Yes</span></span>|<span data-ttu-id="a6a21-158">はい</span><span class="sxs-lookup"><span data-stu-id="a6a21-158">Yes</span></span>|  
|<span data-ttu-id="a6a21-159">強制フェールオーバー</span><span class="sxs-lookup"><span data-stu-id="a6a21-159">Forced failover</span></span>|<span data-ttu-id="a6a21-160">はい</span><span class="sxs-lookup"><span data-stu-id="a6a21-160">Yes</span></span>|<span data-ttu-id="a6a21-161">はい</span><span class="sxs-lookup"><span data-stu-id="a6a21-161">Yes</span></span>|<span data-ttu-id="a6a21-162">うん**<sup>\*</sup>**</span><span class="sxs-lookup"><span data-stu-id="a6a21-162">Yes**<sup>\*</sup>**</span></span>|  
  
 <span data-ttu-id="a6a21-163">**<sup>\*</sup>** 同期されたセカンダリレプリカで強制フェールオーバーコマンドを実行すると、セカンダリレプリカは手動フェールオーバーの場合と同じように動作します。</span><span class="sxs-lookup"><span data-stu-id="a6a21-163">**<sup>\*</sup>**  If you issue a forced failover command on a synchronized secondary replica, the secondary replica behaves the same as for a manual failover.</span></span>  
  
 <span data-ttu-id="a6a21-164">フェールオーバー中にデータベースが使用できなくなる時間の長さは、フェールオーバーの種類および原因によって異なります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-164">The amount of time that the database is unavailable during a failover depends on the type of failover and its cause.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="a6a21-165">フェールオーバー後もクライアント接続をサポートするには、これまでのすべてのプライマリ データベースで定義されたログインおよびジョブを新しいプライマリ データベースに手動で再作成する必要があります (ただし、包含データベースは例外)。</span><span class="sxs-lookup"><span data-stu-id="a6a21-165">To support client connections after failover, except for contained databases, logins and jobs defined on any of the former primary databases must be manually recreated on the new primary database.</span></span> <span data-ttu-id="a6a21-166">詳細については、「 [可用性グループのデータベースのためのログインとジョブの管理 &#40;SQL Server&#41;](../../logins-and-jobs-for-availability-group-databases.md)と呼ばれるプロセスで交換されることがあります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-166">For more information, see [Management of Logins and Jobs for the Databases of an Availability Group &#40;SQL Server&#41;](../../logins-and-jobs-for-availability-group-databases.md).</span></span>  
  
### <a name="failover-sets"></a><span data-ttu-id="a6a21-167">フェールオーバー セット</span><span class="sxs-lookup"><span data-stu-id="a6a21-167">Failover Sets</span></span>  
 <span data-ttu-id="a6a21-168">特定の可用性グループで可能なフェールオーバーの形式は、フェールオーバー セットの観点から理解できます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-168">The forms of failover that are possible for a given availability group can be understood in terms of failover sets.</span></span> <span data-ttu-id="a6a21-169">フェールオーバー セットは、次のようにフェールオーバーの特定の形式をサポートするプライマリ レプリカとセカンダリ レプリカで構成されています。</span><span class="sxs-lookup"><span data-stu-id="a6a21-169">A failover set consists of the primary replica and secondary replicas that support a given form of failover, as follows:</span></span>  
  
-   <span data-ttu-id="a6a21-170">**[!INCLUDE[ssFosAutoC](../../../includes/ssfosautoc-md.md)] (省略可能):** 指定された可用性グループ内で、自動フェールオーバーが指定された同期コミット モード (存在する場合) が構成されている、(現在のプライマリ レプリカを含む) 可用性レプリカのペア。</span><span class="sxs-lookup"><span data-stu-id="a6a21-170">**[!INCLUDE[ssFosAutoC](../../../includes/ssfosautoc-md.md)] (optional):**  Within a given availability group, a pair of availability replicas (including the current primary replica) that are configured for synchronous-commit mode with automatic failover, if any.</span></span> <span data-ttu-id="a6a21-171">自動フェールオーバー セットは、セカンダリ レプリカがプライマリ レプリカとの間で現在 SYNCHRONIZED 状態にある場合のみ有効です。</span><span class="sxs-lookup"><span data-stu-id="a6a21-171">An automatic failover set takes effect only if the secondary replica is currently SYNCHRONIZED with the primary replica.</span></span>  
  
-   <span data-ttu-id="a6a21-172">**[!INCLUDE[ssFosSyncC](../../../includes/ssfossyncc-md.md)] (省略可能):** 指定された可用性グループ内で、同期コミット モード (存在する場合) が構成されている、(現在のプライマリ レプリカを含む) 2 つまたは 3 つの可用性レプリカのセット。</span><span class="sxs-lookup"><span data-stu-id="a6a21-172">**[!INCLUDE[ssFosSyncC](../../../includes/ssfossyncc-md.md)] (optional):**  Within a given availability group, a set of two or three availability replicas (including the current primary replica) that are configured for synchronous-commit mode, if any.</span></span> <span data-ttu-id="a6a21-173">同期コミット フェールオーバー セットは、セカンダリ レプリカに手動フェールオーバー モードが構成され、1 つ以上のセカンダリ レプリカとプライマリ レプリカが現在 SYNCHRONIZED 状態にある場合のみ有効です。</span><span class="sxs-lookup"><span data-stu-id="a6a21-173">A synchronous-commit failover set takes effect only if the secondary replicas are configured for manual failover mode and at least one secondary replica is currently SYNCHRONIZED with the primary replica.</span></span>  
  
-   <span data-ttu-id="a6a21-174">**[!INCLUDE[ssFosEntireC](../../../includes/ssfosentirec-md.md)] :** 指定された可用性グループ内で、可用性モードおよびフェールオーバー モードに関係なく、現在の操作状態が ONLINE であるすべての可用性レプリカのセット。</span><span class="sxs-lookup"><span data-stu-id="a6a21-174">**[!INCLUDE[ssFosEntireC](../../../includes/ssfosentirec-md.md)] :**  Within a given availability group, the set of all availability replicas whose operational state is currently ONLINE, regardless of availability mode and of failover mode.</span></span> <span data-ttu-id="a6a21-175">全フェールオーバー セットは、現在プライマリ レプリカと SYNCHRONIZED 状態になっているセカンダリ レプリカがない場合に有効です。</span><span class="sxs-lookup"><span data-stu-id="a6a21-175">The entire failover set becomes relevant when no secondary replica is currently SYNCHRONIZED with the primary replica.</span></span>  
  
 <span data-ttu-id="a6a21-176">可用性レプリカに、自動フェールオーバーが指定された同期コミット モードを構成した場合、可用性レプリカは [!INCLUDE[ssFosAuto](../../../includes/ssfosauto-md.md)]の一部になります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-176">When you configure an availability replica as synchronous commit with automatic failover, the availability replica becomes part of the [!INCLUDE[ssFosAuto](../../../includes/ssfosauto-md.md)].</span></span> <span data-ttu-id="a6a21-177">ただし、セットが有効になるかどうかは、現在のプライマリに依存します。</span><span class="sxs-lookup"><span data-stu-id="a6a21-177">However whether the set takes effect depends the current primary.</span></span> <span data-ttu-id="a6a21-178">指定された時刻に実際に可能なフェールオーバーの形式は、現在有効なフェールオーバー セットによって決まります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-178">The forms of failover that are actually possible at a given time depends on what failover sets are currently in effect.</span></span>  
  
 <span data-ttu-id="a6a21-179">たとえば、次に示す 4 つの可用性レプリカを持つ可用性グループについて考えてみましょう。</span><span class="sxs-lookup"><span data-stu-id="a6a21-179">For example, consider an availability group that has four availability replicas, as follows:</span></span>  
  
|<span data-ttu-id="a6a21-180">[レプリカ]</span><span class="sxs-lookup"><span data-stu-id="a6a21-180">Replica</span></span>|<span data-ttu-id="a6a21-181">可用性モードとフェールオーバー モードの設定</span><span class="sxs-lookup"><span data-stu-id="a6a21-181">Availability Mode and Failover Mode Settings</span></span>|  
|-------------|--------------------------------------------------|  
|<span data-ttu-id="a6a21-182">A</span><span class="sxs-lookup"><span data-stu-id="a6a21-182">A</span></span>|<span data-ttu-id="a6a21-183">同期コミット モードで自動フェールオーバーを指定</span><span class="sxs-lookup"><span data-stu-id="a6a21-183">Synchronous commit with automatic failover</span></span>|  
|<span data-ttu-id="a6a21-184">B</span><span class="sxs-lookup"><span data-stu-id="a6a21-184">B</span></span>|<span data-ttu-id="a6a21-185">同期コミット モードで自動フェールオーバーを指定</span><span class="sxs-lookup"><span data-stu-id="a6a21-185">Synchronous commit with automatic failover</span></span>|  
|<span data-ttu-id="a6a21-186">C</span><span class="sxs-lookup"><span data-stu-id="a6a21-186">C</span></span>|<span data-ttu-id="a6a21-187">同期コミット モードで計画的な手動フェールオーバーのみを指定</span><span class="sxs-lookup"><span data-stu-id="a6a21-187">Synchronous commit with planned manual failover only</span></span>|  
|<span data-ttu-id="a6a21-188">D</span><span class="sxs-lookup"><span data-stu-id="a6a21-188">D</span></span>|<span data-ttu-id="a6a21-189">非同期コミット モード (強制フェールオーバーのみを指定)</span><span class="sxs-lookup"><span data-stu-id="a6a21-189">Asynchronous commit (with only forced failover)</span></span>|  
  
 <span data-ttu-id="a6a21-190">各セカンダリ レプリカのフェールオーバーの動作は、現在どの可用性レプリカがプライマリ レプリカであるかによって異なります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-190">The failover behavior for each secondary replica depends on which availability replica is currently the primary replica.</span></span> <span data-ttu-id="a6a21-191">基本的には、特定のセカンダリ レプリカにおけるフェールオーバーの動作は、現在のプライマリ レプリカに想定される最悪のケースに対応します。</span><span class="sxs-lookup"><span data-stu-id="a6a21-191">Basically, for a given secondary replica, the failover behavior is the worst case given the current primary replica.</span></span> <span data-ttu-id="a6a21-192">次の図は、セカンダリ レプリカのフェールオーバー動作が現在のプライマリ レプリカに応じてどのように変化するか、また、非同期コミット モード (強制フェールオーバーのみ使用) と同期コミット モード (自動フェールオーバーを使用する場合と使用しない場合があります) のどちらで構成されているかを示します。</span><span class="sxs-lookup"><span data-stu-id="a6a21-192">The following figure illustrates how the failover behavior of secondary replicas varies depending on the current primary replica, and whether it is configured for asynchronous-commit mode (with only forced failover) or synchronous-commit mode (with or without automatic failover).</span></span>  
  
 <span data-ttu-id="a6a21-193">![プライマリ レプリカ構成がフェールオーバーに与える影響](../../media/aoag-failoversetexample.gif "プライマリ レプリカ構成がフェールオーバーに与える影響")</span><span class="sxs-lookup"><span data-stu-id="a6a21-193">![How primary replica configuration affects failover](../../media/aoag-failoversetexample.gif "How primary replica configuration affects failover")</span></span>  
  
##  <a name="automatic-failover"></a><a name="AutomaticFailover"></a> <span data-ttu-id="a6a21-194">Automatic Failover</span><span class="sxs-lookup"><span data-stu-id="a6a21-194">Automatic Failover</span></span>  
 <span data-ttu-id="a6a21-195">自動フェールオーバーでは、プライマリ レプリカが使用できなくなった後で、対応するセカンダリ レプリカが自動的にプライマリ ロールに移行します。</span><span class="sxs-lookup"><span data-stu-id="a6a21-195">An automatic failover causes a qualified secondary replica to automatically transition to the primary role after the primary replica becomes unavailable.</span></span> <span data-ttu-id="a6a21-196">セカンダリ レプリカをホストするノードに対して、プライマリ レプリカをホストする WSFC ノードがローカルである場合、自動フェールオーバーが最適です。</span><span class="sxs-lookup"><span data-stu-id="a6a21-196">Automatic failover is best suited when the WSFC node that hosts the primary replica is local to the node that hosts the secondary replica.</span></span> <span data-ttu-id="a6a21-197">これには、データ同期はコンピューター間のメッセージ待機時間が短いときに最も効果的であること、およびクライアント接続をローカルに保持できるという理由があります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-197">This is because data synchronization works best with low message latency between computers and because client connections can remain local.</span></span>  
  
  
###  <a name="conditions-required-for-an-automatic-failover"></a><a name="RequiredConditions"></a> <span data-ttu-id="a6a21-198">自動フェールオーバーに必要な条件</span><span class="sxs-lookup"><span data-stu-id="a6a21-198">Conditions Required for an Automatic Failover</span></span>  
 <span data-ttu-id="a6a21-199">自動フェールオーバーは、以下の条件が満たされた場合のみ発生します。</span><span class="sxs-lookup"><span data-stu-id="a6a21-199">Automatic failover occurs only under the following conditions:</span></span>  
  
-   <span data-ttu-id="a6a21-200">自動フェールオーバー セットが存在する。</span><span class="sxs-lookup"><span data-stu-id="a6a21-200">An automatic failover set exists.</span></span> <span data-ttu-id="a6a21-201">このセットはプライマリ レプリカとセカンダリ レプリカ (" *自動フェールオーバー ターゲット*") で構成され、プライマリ レプリカとセカンダリ レプリカは両方とも同期コミット モードで構成され、どちらも AUTOMATIC フェールオーバーに設定されています。</span><span class="sxs-lookup"><span data-stu-id="a6a21-201">This set consists of a primary replica and a secondary replica (the *automatic failover target*) that are both configured for synchronous-commit mode and set to AUTOMATIC failover.</span></span> <span data-ttu-id="a6a21-202">HYPERLINK "file:///C:\\\Users\\\marshow\\\AppData\\\Local\\\Temp\\\DxEditor\\\DduePreview\\\Default\\\6fe88e12-4df1-4025-ba24-7579635ccecf\\\HTM\\\html\\\29e0ac5d-eb58-4801-82b9-e278f08db920" プライマリ レプリカに MANUAL フェールオーバーが設定されている場合、セカンダリ レプリカが AUTOMATIC フェールオーバーに設定されていても、自動フェールオーバーは行われません。</span><span class="sxs-lookup"><span data-stu-id="a6a21-202">HYPERLINK "file:///C:\\\Users\\\marshow\\\AppData\\\Local\\\Temp\\\DxEditor\\\DduePreview\\\Default\\\6fe88e12-4df1-4025-ba24-7579635ccecf\\\HTM\\\html\\\29e0ac5d-eb58-4801-82b9-e278f08db920"  If the primary replica is set MANUAL failover, automatic failover cannot occur, even if a secondary replica is set to AUTOMATIC failover.</span></span>  
  
     <span data-ttu-id="a6a21-203">詳細については、「[可用性モード &#40;AlwaysOn 可用性グループ&#41;](availability-modes-always-on-availability-groups.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a6a21-203">For more information, see [Availability Modes &#40;AlwaysOn Availability Groups&#41;](availability-modes-always-on-availability-groups.md).</span></span>  
  
-   <span data-ttu-id="a6a21-204">自動フェールオーバー ターゲットの同期状態が正常である (これは、フェールオーバー ターゲットのすべてのセカンダリ データベースが、対応するプライマリ データベースと同期されていることを意味します)。</span><span class="sxs-lookup"><span data-stu-id="a6a21-204">The automatic failover target has a healthy synchronization state (this indicates that every secondary database on the failover target is synchronized with its corresponding primary database).</span></span>  
  
    > [!TIP]  
    >  <span data-ttu-id="a6a21-205">AlwaysOn 可用性グループでは、自動フェールオーバー セットの両方のレプリカの状態を監視します。</span><span class="sxs-lookup"><span data-stu-id="a6a21-205">AlwaysOn Availability Groups monitors the health of both replicas in an automatic failover set.</span></span> <span data-ttu-id="a6a21-206">いずれかのレプリカが失敗した場合、可用性グループの正常性状態が CRITICAL に設定されます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-206">If either replica fails, the availability group's health state is set to CRITICAL.</span></span> <span data-ttu-id="a6a21-207">セカンダリ レプリカが失敗した場合、自動フェールオーバー ターゲットは使用できないため、自動フェールオーバーは実行されません。</span><span class="sxs-lookup"><span data-stu-id="a6a21-207">If the secondary replica fails, automatic failover is not possible because the automatic failover target is unavailable.</span></span> <span data-ttu-id="a6a21-208">プライマリ レプリカが失敗した場合、可用性グループはセカンダリ レプリカにフェールオーバーします。</span><span class="sxs-lookup"><span data-stu-id="a6a21-208">If the primary replica fails, the availability group will fail over to the secondary replica.</span></span> <span data-ttu-id="a6a21-209">元のプライマリ レプリカがオンラインになるまで、自動フェールオーバー ターゲットは存在しません。</span><span class="sxs-lookup"><span data-stu-id="a6a21-209">Until the former primary replica comes online, no automatic failover target exists.</span></span> <span data-ttu-id="a6a21-210">どちらの場合でも、可用性を確保し、連続して失敗する可能性が低くなるように、別のセカンダリ レプリカを自動フェールオーバー ターゲットとして構成することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="a6a21-210">In either case, to ensure availability in the unlikely case of a sequential failure, we recommend that you configure a different secondary replica as the automatic failover target.</span></span>  
    >   
    >  <span data-ttu-id="a6a21-211">詳細については、「[AlwaysOn ポリシーを使用した可用性グループの正常性の確認 &#40;SQL Server&#41;](use-always-on-policies-to-view-the-health-of-an-availability-group-sql-server.md)」と「[可用性レプリカのフェールオーバー モードの変更 &#40;SQL Server&#41;](change-the-failover-mode-of-an-availability-replica-sql-server.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a6a21-211">For more information, see [Use AlwaysOn Policies to View the Health of an Availability Group &#40;SQL Server&#41;](use-always-on-policies-to-view-the-health-of-an-availability-group-sql-server.md) and [Change the Failover Mode of an Availability Replica &#40;SQL Server&#41;](change-the-failover-mode-of-an-availability-replica-sql-server.md).</span></span>  
  
-   <span data-ttu-id="a6a21-212">Windows Server フェールオーバー クラスタリング (WSFC) クラスターにクォーラムがある。</span><span class="sxs-lookup"><span data-stu-id="a6a21-212">The Windows Server Failover Clustering (WSFC) cluster has quorum.</span></span> <span data-ttu-id="a6a21-213">詳細については、「[WSFC クォーラム モードと投票の構成 &#40;SQL Server&#41;](../../../sql-server/failover-clusters/windows/wsfc-quorum-modes-and-voting-configuration-sql-server.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a6a21-213">For more information, see [WSFC Quorum Modes and Voting Configuration &#40;SQL Server&#41;](../../../sql-server/failover-clusters/windows/wsfc-quorum-modes-and-voting-configuration-sql-server.md).</span></span>  
  
-   <span data-ttu-id="a6a21-214">プライマリ レプリカが使用できなくなり、柔軟なフェールオーバー ポリシーにより定義されたフェールオーバー条件レベルが満たされている。</span><span class="sxs-lookup"><span data-stu-id="a6a21-214">The primary replica has become unavailable, and the failover-condition levels defined by your the flexible failover policy have been met.</span></span> <span data-ttu-id="a6a21-215">フェールオーバー条件レベルの詳細については、「 [可用性グループの自動フェールオーバーのための柔軟なフェールオーバー ポリシー &#40;SQL Server&#41;](flexible-automatic-failover-policy-availability-group.md)と呼ばれるプロセスで交換されることがあります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-215">For information about failover-condition levels, see [Flexible Failover Policy for Automatic Failover of an Availability Group &#40;SQL Server&#41;](flexible-automatic-failover-policy-availability-group.md).</span></span>  
  
###  <a name="how-automatic-failover-works"></a><a name="HowAutoFoWorks"></a> <span data-ttu-id="a6a21-216">自動フェールオーバーの動作</span><span class="sxs-lookup"><span data-stu-id="a6a21-216">How Automatic Failover Works</span></span>  
 <span data-ttu-id="a6a21-217">自動フェールオーバーにより、次の一連の操作が開始されます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-217">An automatic failover initiates the following sequence of actions:</span></span>  
  
1.  <span data-ttu-id="a6a21-218">現在のプライマリ レプリカをホストするサーバー インスタンスがまだ実行中の場合は、プライマリ データベースの状態が DISCONNECTED に変更され、すべてのクライアントが切断されます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-218">If the server instance that is hosting the current primary replica is still running, it changes the state of the primary databases to DISCONNECTED and disconnects all clients.</span></span>  
  
2.  <span data-ttu-id="a6a21-219">対象のセカンダリ レプリカの復旧キューで待機中のログ レコードがある場合、セカンダリ レプリカはそのログ レコードを適用してセカンダリ データベースのロールフォワードを終了します。</span><span class="sxs-lookup"><span data-stu-id="a6a21-219">If any log records are waiting in recovery queues on the target secondary replica, the secondary replica applies the remaining log records to finish rolling forward the secondary databases.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="a6a21-220">特定のデータベースにログを適用するために必要な時間は、システムの処理速度、直近の作業負荷、および復旧キュー内のログの量によって異なります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-220">The amount of time required to apply the log to a given database depends on the speed of the system, the recent work load, and the amount of log in the recovery queue.</span></span>  
  
3.  <span data-ttu-id="a6a21-221">元のセカンダリ レプリカはプライマリ ロールに移行します。</span><span class="sxs-lookup"><span data-stu-id="a6a21-221">The former secondary replica transitions to the primary role.</span></span> <span data-ttu-id="a6a21-222">そのデータベースがプライマリ データベースになります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-222">Its databases become the primary databases.</span></span> <span data-ttu-id="a6a21-223">新しいプライマリ レプリカによって、コミットされていないすべてのトランザクションが迅速にロールバックされます (復旧の元に戻すフェーズ)。</span><span class="sxs-lookup"><span data-stu-id="a6a21-223">The new primary replica rolls back any uncommitted transactions (the undo phase of recovery) as quickly as possible.</span></span> <span data-ttu-id="a6a21-224">これらのコミットされていないトランザクションがロックによって分離されるため、クライアントがデータベースを使用している間にバック グラウンドでロールバックを行うことができます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-224">Locks isolate these uncommitted transactions, allowing roll back to occur in the background while clients use the database.</span></span> <span data-ttu-id="a6a21-225">このプロセスでは、コミット済みのトランザクションはロールバックされません。</span><span class="sxs-lookup"><span data-stu-id="a6a21-225">This process does not roll back any committed transactions.</span></span>  
  
     <span data-ttu-id="a6a21-226">特定のセカンダリ データベースが接続されるまでの短い間、NOT_SYNCHRONIZED としてマークされます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-226">Until a given secondary database is connected, it is briefly marked as NOT_SYNCHRONIZED.</span></span> <span data-ttu-id="a6a21-227">ロールバックの復旧が開始される前、セカンダリ データベースは、新しいプライマリ データベースに接続し、即座に SYNCHRONIZED 状態に移行できます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-227">Before the rollback recovery starts, secondary databases can connect to the new primary databases and quickly transition to the SYNCHRONIZED state.</span></span> <span data-ttu-id="a6a21-228">一番問題のないケースは、フェールオーバー後もセカンダリ ロールを維持する 3 番目の同期コミット レプリカです。</span><span class="sxs-lookup"><span data-stu-id="a6a21-228">The best case is usually for a third synchronous-commit replica that remains in the secondary role after the failover.</span></span>  
  
4.  <span data-ttu-id="a6a21-229">元のプライマリ レプリカをホストしているサーバー インスタンスが後で再起動されると、別の可用性レプリカが新たにプライマリ ロールを所有していることが認識されます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-229">Later, when the server instance that is hosting the former primary replica restarts, it recognizes that another availability replica now owns the primary role.</span></span> <span data-ttu-id="a6a21-230">元のプライマリ レプリカはセカンダリ ロールに移行し、そのデータベースがセカンダリ データベースになります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-230">The former primary replica transitions to the secondary role, and its databases become secondary databases.</span></span> <span data-ttu-id="a6a21-231">新しいセカンダリ レプリカは現在のプライマリ レプリカに接続し、可能な限り早期にそのデータベースを現在のプライマリ データベースに同期します。</span><span class="sxs-lookup"><span data-stu-id="a6a21-231">The new secondary replica connects to the current primary replica and catches its database up to the current primary databases as quickly as possible.</span></span> <span data-ttu-id="a6a21-232">新しいセカンダリ レプリカのデータベースの再同期が完了すると、その時点から、反対方向のフェールオーバーを実行できるようになります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-232">As soon as the new secondary replica has resynchronized its databases, failover is again possible, in the reverse direction.</span></span>  
  
###  <a name="to-configure-automatic-failover"></a><a name="EnableAutoFo"></a> <span data-ttu-id="a6a21-233">自動フェールオーバーを設定するには</span><span class="sxs-lookup"><span data-stu-id="a6a21-233">To Configure Automatic Failover</span></span>  
 <span data-ttu-id="a6a21-234">任意の時点で、可用性レプリカが自動フェールオーバーをサポートするように構成できます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-234">An availability replica can be configured to support automatic failover at any point.</span></span>  
  
 <span data-ttu-id="a6a21-235">**自動フェールオーバーを設定するには**</span><span class="sxs-lookup"><span data-stu-id="a6a21-235">**To configure automatic failover**</span></span>  
  
1.  <span data-ttu-id="a6a21-236">セカンダリ レプリカが、同期コミット可用性モードを使用するように構成されていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="a6a21-236">Ensure that the secondary replica is configured to use the synchronous-commit availability mode.</span></span> <span data-ttu-id="a6a21-237">詳細については、「 [可用性レプリカの可用性モードの変更 &#40;SQL Server&#41;](change-the-availability-mode-of-an-availability-replica-sql-server.md)と呼ばれるプロセスで交換されることがあります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-237">For more information, see [Change the Availability Mode of an Availability Replica &#40;SQL Server&#41;](change-the-availability-mode-of-an-availability-replica-sql-server.md).</span></span>  
  
2.  <span data-ttu-id="a6a21-238">フェールオーバー モードを自動に設定します。</span><span class="sxs-lookup"><span data-stu-id="a6a21-238">Set the failover mode to automatic.</span></span> <span data-ttu-id="a6a21-239">詳細については、「 [可用性レプリカのフェールオーバー モードの変更 &#40;SQL Server&#41;](change-the-failover-mode-of-an-availability-replica-sql-server.md)と呼ばれるプロセスで交換されることがあります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-239">For more information, see [Change the Failover Mode of an Availability Replica &#40;SQL Server&#41;](change-the-failover-mode-of-an-availability-replica-sql-server.md).</span></span>  
  
3.  <span data-ttu-id="a6a21-240">必要に応じて、可用性グループの柔軟なフェールオーバー ポリシーを変更して、自動フェールオーバーを発生させる障害の種類を指定します。</span><span class="sxs-lookup"><span data-stu-id="a6a21-240">Optionally, change the flexible failover policy of the availability group to specify the sorts of failures that can cause an automatic failover to occur.</span></span> <span data-ttu-id="a6a21-241">詳細については、「[自動フェールオーバーの条件を制御する柔軟なフェールオーバー ポリシーの構成 &#40;AlwaysOn 可用性グループ&#41;](configure-flexible-automatic-failover-policy.md)HYPERLINK"file:///C:\\\Users\\\marshow\\\AppData\\\Local\\\Temp\\\DxEditor\\\DduePreview\\\Default\\\6a8d98a9-6e6a-40d1-9809-efa9013d7452\\\HTM\\\html\\\1ed564b4-9835-4245-ae35-9ba67419a4ce"」および「[フェールオーバー クラスター インスタンスのフェールオーバー ポリシー](../../../sql-server/failover-clusters/windows/failover-policy-for-failover-cluster-instances.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a6a21-241">For more information, see [Configure the Flexible Failover Policy to Control Conditions for Automatic Failover &#40;AlwaysOn Availability Groups&#41;](configure-flexible-automatic-failover-policy.md) HYPERLINK "file:///C:\\\Users\\\marshow\\\AppData\\\Local\\\Temp\\\DxEditor\\\DduePreview\\\Default\\\6a8d98a9-6e6a-40d1-9809-efa9013d7452\\\HTM\\\html\\\1ed564b4-9835-4245-ae35-9ba67419a4ce"  and [Failover Policy for Failover Cluster Instances](../../../sql-server/failover-clusters/windows/failover-policy-for-failover-cluster-instances.md).</span></span>  
  
##  <a name="planned-manual-failover-without-data-loss"></a><a name="ManualFailover"></a> <span data-ttu-id="a6a21-242">計画的な手動フェールオーバー (データ損失なし)</span><span class="sxs-lookup"><span data-stu-id="a6a21-242">Planned Manual Failover (Without Data Loss)</span></span>  
 <span data-ttu-id="a6a21-243">対象のセカンダリ レプリカがホストされているサーバー インスタンスでデータベース管理者が手動フェールオーバー コマンドを発行すると、同期済みのセカンダリ レプリカがプライマリ ロールに移行します。</span><span class="sxs-lookup"><span data-stu-id="a6a21-243">A manual failover causes a synchronized secondary replica to transition to the primary role after a database administrator issues a manual-failover command on the server instance that hosts the target secondary replica.</span></span> <span data-ttu-id="a6a21-244">手動フェールオーバーをサポートするには、セカンダリ レプリカと現在のプライマリ レプリカの両方に同期コミット モード (存在する場合) が構成されている必要があります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-244">To support manual failover, the secondary replica and the current primary replica must both be configured for synchronous-commit mode, if any.</span></span> <span data-ttu-id="a6a21-245">可用性レプリカのすべてのセカンダリ データベースが可用性グループに参加し、その対応するプライマリ データベースに同期されている必要があります (つまり、セカンダリ レプリカを同期する必要があります)。</span><span class="sxs-lookup"><span data-stu-id="a6a21-245">Every secondary database on the availability replica must be joined to the availability group and synchronized with its corresponding primary database (that is, the secondary replica must be synchronized).</span></span> <span data-ttu-id="a6a21-246">これにより、元のプライマリ データベースでコミットされていたトランザクションもすべて新しいプライマリ データベースに確実にコミットされます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-246">This guarantees that every transaction that was committed on a former primary database has also been committed on the new primary database.</span></span> <span data-ttu-id="a6a21-247">したがって、新しいプライマリ データベースは、古いプライマリ データベースと同じです。</span><span class="sxs-lookup"><span data-stu-id="a6a21-247">Therefore, the new primary databases are identical to the old primary databases.</span></span>  
  
 <span data-ttu-id="a6a21-248">次の図に、計画的なフェールオーバーの段階を示します。</span><span class="sxs-lookup"><span data-stu-id="a6a21-248">The following figure illustrates the stages of a planned failover:</span></span>  
  
1.  <span data-ttu-id="a6a21-249">フェールオーバーの前、プライマリ レプリカは `Node01`のサーバー インスタンスによってホストされています。</span><span class="sxs-lookup"><span data-stu-id="a6a21-249">Before the failover, the primary replica is hosted by the server instance on `Node01`.</span></span>  
  
2.  <span data-ttu-id="a6a21-250">データベース管理者によって計画的なフェールオーバーが開始されます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-250">A database administrator initiates a planned failover.</span></span> <span data-ttu-id="a6a21-251">フェールオーバー ターゲットは、 `Node02`のサーバー インスタンスによってホストされている可用性レプリカです。</span><span class="sxs-lookup"><span data-stu-id="a6a21-251">The failover target is the availability replica hosted by the server instance on `Node02`.</span></span>  
  
3.  <span data-ttu-id="a6a21-252">( `Node02`上の) フェールオーバー ターゲットが新しいプライマリ レプリカになります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-252">The failover target (on `Node02`) becomes the new primary replica.</span></span> <span data-ttu-id="a6a21-253">これは計画的なフェールオーバーであるため、フェールオーバー中に元のプライマリ レプリカはセカンダリ ロールに切り替わり、そのデータベースをセカンダリ データベースとして即座にオンラインにします。</span><span class="sxs-lookup"><span data-stu-id="a6a21-253">Because this is a planned failover, the former primary replica switches to the secondary role during the failover and brings its databases online as secondary databases immediately.</span></span>  
  
 <span data-ttu-id="a6a21-254">![計画的な手動フェールオーバーの図](../../media/aoag-plannedmanualfailover.gif "計画的な手動フェールオーバーの図")</span><span class="sxs-lookup"><span data-stu-id="a6a21-254">![Illustation of a planned manual failover](../../media/aoag-plannedmanualfailover.gif "Illustation of a planned manual failover")</span></span>  
  
  
###  <a name="conditions-required-for-a-manual-failover"></a><a name="ManualFailoverConditions"></a> <span data-ttu-id="a6a21-255">手動フェールオーバーに必要な条件</span><span class="sxs-lookup"><span data-stu-id="a6a21-255">Conditions Required for a Manual Failover</span></span>  
 <span data-ttu-id="a6a21-256">手動フェールオーバーをサポートするには、現在のプライマリ レプリカに同期コミット モードが設定され、セカンダリ レプリカが次の条件を満たす必要があります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-256">To support a manual failover, the current primary replica must be set to synchronous-commit mode and a secondary replica must be:</span></span>  
  
-   <span data-ttu-id="a6a21-257">同期コミット モードが構成されている。</span><span class="sxs-lookup"><span data-stu-id="a6a21-257">Configured for synchronous-commit mode.</span></span>  
  
-   <span data-ttu-id="a6a21-258">現在、プライマリ レプリカと同期されている。</span><span class="sxs-lookup"><span data-stu-id="a6a21-258">Currently synchronized with the primary replica.</span></span>  
  
 <span data-ttu-id="a6a21-259">可用性グループのフェールオーバーを手動で実行するには、新しいプライマリ レプリカになるセカンダリ レプリカに接続する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-259">To manually fail over an availability group, you must be connected to the secondary replica that is to become the new primary replica.</span></span>  
  
###  <a name="how-a-planned-manual-failover-works"></a><a name="ManualFailoverHowWorks"></a> <span data-ttu-id="a6a21-260">計画的な手動フェールオーバーの動作</span><span class="sxs-lookup"><span data-stu-id="a6a21-260">How a Planned Manual Failover Works</span></span>  
 <span data-ttu-id="a6a21-261">計画的な手動フェールオーバーは、対象のセカンダリ レプリカで開始する必要があります。計画的な手動フェールオーバーによって次の処理シーケンスが開始されます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-261">A planned manual failover, which must be initiated on the target secondary replica, initiates the following sequence of actions:</span></span>  
  
1.  <span data-ttu-id="a6a21-262">新しいユーザー トランザクションが元のプライマリ データベースで発生しないようにするために、WSFC クラスターがプライマリ レプリカをオフラインにする要求をプライマリ レプリカに送信します。</span><span class="sxs-lookup"><span data-stu-id="a6a21-262">To ensure that no new user transactions occur on the original primary databases, the WSFC cluster sends a request to the primary replica to go offline.</span></span>  
  
2.  <span data-ttu-id="a6a21-263">セカンダリ データベースの復旧キューで待機中のログがある場合は、セカンダリ レプリカで、そのセカンダリ データベースのロールフォワードが終了されます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-263">If any log is waiting in the recovery queue of any secondary database, the secondary replica finishes rolling forward that secondary database.</span></span> <span data-ttu-id="a6a21-264">必要な時間は、システムの処理速度、最近の作業負荷、および復旧キューのログの量によって異なります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-264">The amount of time required depends on the speed of the system, the recent workload, and the amount of log in the recovery queue.</span></span> <span data-ttu-id="a6a21-265">復旧キューの現在のサイズを調べるには、 **Recovery Queue** パフォーマンス カウンターを使用します。</span><span class="sxs-lookup"><span data-stu-id="a6a21-265">To learn the current size of the recovery queue, use the **Recovery Queue** performance counter.</span></span> <span data-ttu-id="a6a21-266">詳細については、「 [SQL Server、Database Replica](../../../relational-databases/performance-monitor/sql-server-database-replica.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a6a21-266">For more information, see [SQL Server, Database Replica](../../../relational-databases/performance-monitor/sql-server-database-replica.md).</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="a6a21-267">復旧キューのサイズを制限することでフェールオーバーの時間を調節できます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-267">The failover time can be regulated by limiting the size of the recovery queue.</span></span> <span data-ttu-id="a6a21-268">ただし、セカンダリ レプリカの遅れを取り戻すためにプライマリ レプリカの処理速度が低下する場合があります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-268">However, this can cause the primary replica to slow down to allow the secondary replica to keep up.</span></span>  
  
3.  <span data-ttu-id="a6a21-269">セカンダリ レプリカは新しいプライマリ レプリカになり、元のプライマリ レプリカは新しいセカンダリ レプリカになります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-269">The secondary replica becomes the new primary replica, and the former primary replica becomes the new secondary replica.</span></span>  
  
4.  <span data-ttu-id="a6a21-270">新しいプライマリ レプリカでは、コミットされていないトランザクションがすべてロールバックされ、そのデータベースがプライマリ データベースとしてオンラインになります。すべてのセカンダリ データベースは、新しいプライマリ データベースに接続されて再同期されるまでの短い間、NOT SYNCHRONIZED としてマークされます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-270">The new primary replica rolls back any uncommitted transactions and brings its databases online as the primary databases.All secondary databases are briefly marked as NOT SYNCHRONIZED until they connect and resynchronize to the new primary databases.</span></span> <span data-ttu-id="a6a21-271">このプロセスでは、コミット済みのトランザクションはロールバックされません。</span><span class="sxs-lookup"><span data-stu-id="a6a21-271">This process does not roll back any committed transactions.</span></span>  
  
5.  <span data-ttu-id="a6a21-272">元のプライマリ レプリカはオンラインになるとセカンダリ ロールを引き継ぎ、元のプライマリ データベースがセカンダリ データベースになります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-272">When the former primary replica comes back online, it takes on the secondary role, and the former primary database becomes the secondary database.</span></span> <span data-ttu-id="a6a21-273">新しいセカンダリ レプリカによって、新しいセカンダリ データベースが対応するプライマリ データベースと迅速に再同期されます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-273">The new secondary replica quickly resynchronizes the new secondary databases with the corresponding primary databases.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="a6a21-274">新しいセカンダリ レプリカのデータベースの再同期が完了すると、その時点から、反対方向のフェールオーバーを実行できるようになります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-274">As soon as the new secondary replica has resynchronized the databases, failover is again possible, but in the reverse direction.</span></span>  
  
 <span data-ttu-id="a6a21-275">フェールオーバー後は、クライアントから現在のプライマリ データベースに再接続する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-275">After failover, clients must reconnect to the current primary database.</span></span> <span data-ttu-id="a6a21-276">詳細については、「 [可用性グループ リスナー、クライアント接続、およびアプリケーションのフェールオーバー &#40;SQL Server&#41;](../../listeners-client-connectivity-application-failover.md)での 1 つ以上の可用性グループの構成と管理において重要です。</span><span class="sxs-lookup"><span data-stu-id="a6a21-276">For more information, see [Availability Group Listeners, Client Connectivity, and Application Failover &#40;SQL Server&#41;](../../listeners-client-connectivity-application-failover.md).</span></span>  
  
###  <a name="maintaining-availability-during-upgrades"></a><a name="ManualFailoverDuringUpgrades"></a> <span data-ttu-id="a6a21-277">アップグレード中の可用性の維持</span><span class="sxs-lookup"><span data-stu-id="a6a21-277">Maintaining Availability During Upgrades</span></span>  
 <span data-ttu-id="a6a21-278">可用性グループのデータベース管理者は、手動フェールオーバーを使用することにより、ハードウェアまたはソフトウェアのアップグレード時にデータベースの可用性を維持できます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-278">The database administrator for your availability groups can use manual failovers to maintain database availability when you upgrade hardware or software.</span></span> <span data-ttu-id="a6a21-279">ソフトウェア アップグレードのために可用性グループを使用するには、対象のセカンダリ レプリカがホストされているサーバー インスタンスまたはコンピューター ノードでアップグレードが受信済みである必要があります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-279">To use an availability group for software upgrades, the server instance and/or computer node that hosts the target secondary replica must have already received the upgrades.</span></span> <span data-ttu-id="a6a21-280">詳細については、「 [Upgrade and Update of Availability Group Servers with Minimal Downtime and Data Loss](upgrading-always-on-availability-group-replica-instances.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a6a21-280">For more information, see [Upgrade and Update of Availability Group Servers with Minimal Downtime and Data Loss](upgrading-always-on-availability-group-replica-instances.md).</span></span>  
  
##  <a name="forced-failover-with-possible-data-loss"></a><a name="ForcedFailover"></a> <span data-ttu-id="a6a21-281">強制フェールオーバー (データ損失の可能性あり)</span><span class="sxs-lookup"><span data-stu-id="a6a21-281">Forced Failover (with Possible Data Loss)</span></span>  
 <span data-ttu-id="a6a21-282">可用性グループの強制フェールオーバー (データ損失の可能性あり) は、セカンダリ レプリカをウォーム スタンバイ サーバーとして使用できるディザスター リカバリー方法です。フェールオーバーを強制するとデータを損失する可能性があるので、強制フェールオーバーは注意深く慎重に使用してください。</span><span class="sxs-lookup"><span data-stu-id="a6a21-282">Forcing failover of an availability group (with possible data loss) is a disaster recovery method that allows you to use a secondary replica as a warm standby server.Because forcing failover risks possible data loss, it should be used cautiously and sparingly.</span></span> <span data-ttu-id="a6a21-283">可用性データベースにサービスをすぐに復元する必要があり、データの損失を許容できる場合に限り、フェールオーバーを強制することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="a6a21-283">We recommend forcing failover only if you must restore service to your availability databases immediately and are willing to risk losing data.</span></span> <span data-ttu-id="a6a21-284">強制フェールオーバーを実行するための前提条件と推奨事項の詳細、および強制フェールオーバーを使用して重大なエラーから復旧するサンプル シナリオについては、このトピックの「 [可用性グループの強制手動フェールオーバーの実行 &#40;SQL Server&#41;](perform-a-forced-manual-failover-of-an-availability-group-sql-server.md)と呼ばれるプロセスで交換されることがあります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-284">For more information about the prerequisites and recommendations for forcing failover and for an example scenario that uses a forced failover to recover from a catastrophic failure, see [Perform a Forced Manual Failover of an Availability Group &#40;SQL Server&#41;](perform-a-forced-manual-failover-of-an-availability-group-sql-server.md).</span></span>  
  
> [!WARNING]  
>  <span data-ttu-id="a6a21-285">強制フェールオーバーでは、WSFC クラスターにクォーラムが必要です。</span><span class="sxs-lookup"><span data-stu-id="a6a21-285">Forcing failover requires that the WSFC cluster have quorum.</span></span> <span data-ttu-id="a6a21-286">クォーラム構成とクォーラムの強制の詳細については、「 [Windows Server フェールオーバー クラスタリング &#40;WSFC&#41; と SQL Server](../../../sql-server/failover-clusters/windows/windows-server-failover-clustering-wsfc-with-sql-server.md)と呼ばれるプロセスで交換されることがあります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-286">For information about configuring quorum and forcing quorum, see [Windows Server Failover Clustering &#40;WSFC&#41; with SQL Server](../../../sql-server/failover-clusters/windows/windows-server-failover-clustering-wsfc-with-sql-server.md).</span></span>  
  
  
###  <a name="how-forced-failover-works"></a><a name="ForcedFailoverHowWorks"></a> <span data-ttu-id="a6a21-287">強制フェールオーバーの動作</span><span class="sxs-lookup"><span data-stu-id="a6a21-287">How Forced Failover Works</span></span>  
 <span data-ttu-id="a6a21-288">フェールオーバーを強制すると、ロールが SECONDARY 状態または RESOLVING 状態であるターゲット レプリカにプライマリ ロールが移行されます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-288">Forcing failover initiates a transition of the primary role to a target replica whose role is in the SECONDARY or RESOLVING state.</span></span> <span data-ttu-id="a6a21-289">フェールオーバー ターゲットは、新しいプライマリ レプリカになり、クライアントは直ちにデータベースのコピーを利用できるようになります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-289">The failover target becomes the new primary replica and immediately serves its copies of the databases to clients.</span></span> <span data-ttu-id="a6a21-290">元のプライマリ レプリカは使用可能になるとセカンダリ ロールに移行し、そのデータベースはセカンダリ データベースになります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-290">When the former primary replica becomes available, it will transition to the secondary role and its databases will become secondary databases.</span></span>  
  
 <span data-ttu-id="a6a21-291">すべてのセカンダリ データベース (元のプライマリ データベースが使用可能になった場合は、そのプライマリ データベースを含む) が SUSPENDED 状態になります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-291">All secondary databases (including the former primary databases, when they become available) are SUSPENDED.</span></span> <span data-ttu-id="a6a21-292">中断状態のセカンダリ データベースの以前のデータ同期状態に応じて、そのプライマリ データベースの損失したコミット データを復旧することが適切な場合があります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-292">Depending on the previous data synchronization state of a suspended secondary database, it might be suitable for salvaging missing committed data for that primary database.</span></span> <span data-ttu-id="a6a21-293">読み取り専用アクセス用に構成されたセカンダリ レプリカで、セカンダリ データベースのクエリを実行して、損失したデータを手動で検出できます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-293">On a secondary replica that is configured for read-only access, you can query the secondary databases to manually discover missing data.</span></span> <span data-ttu-id="a6a21-294">次に、新しいプライマリ データベースで [!INCLUDE[tsql](../../../includes/tsql-md.md)] ステートメントを発行して、必要な変更を加えることができます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-294">Then you can issue [!INCLUDE[tsql](../../../includes/tsql-md.md)] statements on the new primary databases to make any necessary changes.</span></span>  
  
###  <a name="risks-of-forcing-failover"></a><a name="ForcedFailoverRisks"></a> <span data-ttu-id="a6a21-295">強制フェールオーバーのリスク</span><span class="sxs-lookup"><span data-stu-id="a6a21-295">Risks of Forcing Failover</span></span>  
 <span data-ttu-id="a6a21-296">フェールオーバーの強制によってデータが失われる可能性があることを理解しておく必要があります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-296">It is essential to understand that forcing failover can cause data loss.</span></span> <span data-ttu-id="a6a21-297">ターゲット レプリカがプライマリ レプリカと通信できなくなり、そのためにデータベースが必ずしも同期されなくなることが原因で、データが失われる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-297">Data loss is possible because the target replica cannot communicate with the primary replica and, therefore, cannot guarantee that the databases are synchronized.</span></span> <span data-ttu-id="a6a21-298">フェールオーバーを強制すると、新しい復旧分岐が始まります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-298">Forcing failover starts a new recovery fork.</span></span> <span data-ttu-id="a6a21-299">元のプライマリ データベースとセカンダリ データベースは別の復旧分岐に存在するので、それぞれのデータベースにはもう一方のデータベースには含まれていないデータが含まれることになります。つまり、それぞれの元のプライマリ データベースにはその送信キューから前のセカンダリ データベースに送信されなかったすべての変更 (未送信ログ) が含まれ、前のセカンダリ データベースには、フェールオーバーの強制後に行われたすべての変更が含まれます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-299">Because the original primary databases and secondary databases are on different recovery forks, each of them now contains data that the other database does not contain: each original primary database contains whatever changes were not yet sent from its send queue to the former secondary database (the unsent log); the former secondary databases contain whatever changes occur after failover was forced.</span></span>  
  
 <span data-ttu-id="a6a21-300">プライマリ レプリカで障害が発生したためにフェールオーバーが強制された場合、データが損失するかどうかは、障害発生前にセカンダリ レプリカに送信されなかったトランザクション ログがあるかどうかによって異なります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-300">If failover is forced because the primary replica has failed, potential data loss is depends on whether any transaction logs had not been sent to the secondary replica before the failure.</span></span> <span data-ttu-id="a6a21-301">非同期コミット モードの場合、蓄積された未送信ログがある場合は常にデータ損失の可能性があります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-301">Under the asynchronous-commit mode, accumulated unsent log is always a possibility.</span></span> <span data-ttu-id="a6a21-302">同期コミット モードの場合、データが損失するのは、セカンダリ データベースが同期された状態になるまでの間だけです。</span><span class="sxs-lookup"><span data-stu-id="a6a21-302">Under synchronous-commit mode, this is possible only until the secondary databases becomes synchronized.</span></span>  
  
 <span data-ttu-id="a6a21-303">次の表に、フェールオーバーを強制するレプリカ上の特定のデータベースでのデータ損失の可能性をまとめます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-303">The following table summarizes the possibility of data loss for a particular database on the replica to which you force failover.</span></span>  
  
|<span data-ttu-id="a6a21-304">セカンダリ レプリカの可用性モード</span><span class="sxs-lookup"><span data-stu-id="a6a21-304">Availability mode of Secondary Replica</span></span>|<span data-ttu-id="a6a21-305">データベースが同期しているか</span><span class="sxs-lookup"><span data-stu-id="a6a21-305">Is database synchronized?</span></span>|<span data-ttu-id="a6a21-306">データが失われる可能性があるか</span><span class="sxs-lookup"><span data-stu-id="a6a21-306">Is data loss possible?</span></span>|  
|--------------------------------------------|-------------------------------|----------------------------|  
|<span data-ttu-id="a6a21-307">同期コミット</span><span class="sxs-lookup"><span data-stu-id="a6a21-307">Synchronous-commit</span></span>|<span data-ttu-id="a6a21-308">はい</span><span class="sxs-lookup"><span data-stu-id="a6a21-308">Yes</span></span>|<span data-ttu-id="a6a21-309">いいえ</span><span class="sxs-lookup"><span data-stu-id="a6a21-309">No</span></span>|  
|<span data-ttu-id="a6a21-310">同期コミット</span><span class="sxs-lookup"><span data-stu-id="a6a21-310">Synchronous-commit</span></span>|<span data-ttu-id="a6a21-311">いいえ</span><span class="sxs-lookup"><span data-stu-id="a6a21-311">No</span></span>|<span data-ttu-id="a6a21-312">はい</span><span class="sxs-lookup"><span data-stu-id="a6a21-312">Yes</span></span>|  
|<span data-ttu-id="a6a21-313">非同期コミット</span><span class="sxs-lookup"><span data-stu-id="a6a21-313">Asynchronous-commit</span></span>|<span data-ttu-id="a6a21-314">いいえ</span><span class="sxs-lookup"><span data-stu-id="a6a21-314">No</span></span>|<span data-ttu-id="a6a21-315">はい</span><span class="sxs-lookup"><span data-stu-id="a6a21-315">Yes</span></span>|  
||||  
  
 <span data-ttu-id="a6a21-316">セカンダリ データベースは 2 つの復旧分岐のみを追跡するため、複数の強制フェールオーバーを実行した場合、前の強制フェールオーバーでデータの同期を開始しなかったセカンダリ データベースは再開できない場合があります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-316">Secondary databases track only two recovery forks, so if you perform multiple forced failovers, any secondary database that did start data synchronization with the previous force failover might not be able to resume.</span></span> <span data-ttu-id="a6a21-317">この場合は、再開できないセカンダリ データベースを可用性グループから削除して、適切な時点まで復元した後で再度可用性グループに参加させる必要があります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-317">If this occurs, any secondary databases that cannot be resumed will need to be removed from the availability group, restored to the correct point in time, and rejoined to the availability group.</span></span> <span data-ttu-id="a6a21-318">復元は複数の復旧分岐に対しては機能しないため、複数の強制フェールオーバーを実行した後に必ずログ バックアップを実行してください。</span><span class="sxs-lookup"><span data-stu-id="a6a21-318">A restore will not work across multiple recovery forks, therefore, be sure to perform a log backup after performing more than one forced failover.</span></span>  
  
###  <a name="why-forced-failover-is-required-after-forcing-quorum"></a><a name="WhyFFoPostForcedQuorum"></a> <span data-ttu-id="a6a21-319">クォーラムの強制後に強制フェールオーバーが必要な理由</span><span class="sxs-lookup"><span data-stu-id="a6a21-319">Why Forced Failover is Required After Forcing Quorum</span></span>  
 <span data-ttu-id="a6a21-320">WSFC クラスターでクォーラムが強制された後 ("*強制クォーラム*")、各可用性グループで強制フェールオーバー (データ損失の可能性あり) を実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-320">After quorum is forced on the WSFC cluster (*forced quorum*) you need to perform a forced failover (with possible data loss) on each availability group.</span></span> <span data-ttu-id="a6a21-321">強制フェールオーバーが必要なのは、WSFC クラスター値の実際の状態が失われている可能性があるためです。</span><span class="sxs-lookup"><span data-stu-id="a6a21-321">The forced failover is required because the real state of the WSFC cluster values might have been lost.</span></span> <span data-ttu-id="a6a21-322">再構成された WSFC クラスターで非同期のセカンダリ レプリカが同期されたように見える可能性があるため、強制クォーラムの後に通常のフェールオーバーが実行されるのを防ぐ必要があります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-322">Preventing normal failovers after a forced quorum is required because of the possibility than an unsynchronized secondary replica would appear to be synchronized on the reconfigured WSFC cluster.</span></span>  
  
 <span data-ttu-id="a6a21-323">たとえば、3 つのノードで可用性グループをホストする WSFC クラスターについて考えてみます。ノード A はプライマリ レプリカをホストし、ノード B とノード C はそれぞれセカンダリ レプリカをホストします。</span><span class="sxs-lookup"><span data-stu-id="a6a21-323">For example, consider a WSFC cluster that hosts an availability group on three nodes:  Node A hosts the primary replica and Node B and Node C each hosts a secondary replica.</span></span> <span data-ttu-id="a6a21-324">ノード C は、ローカル セカンダリ レプリカが SYNCHRONIZED 状態の間に WSFC クラスターから切断されます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-324">Node C gets disconnected from the WSFC cluster while the local secondary replica is SYNCHRONIZED.</span></span>  <span data-ttu-id="a6a21-325">ただし、ノード A とノード B では正常なクォーラムが保持され、可用性グループはオンラインのままになります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-325">But Node A and Node B retain a healthy quorum and the availability group remains online.</span></span> <span data-ttu-id="a6a21-326">ノード A では、プライマリ レプリカが引き続き更新を受け入れ、ノード B では、セカンダリ レプリカが引き続きプライマリ レプリカと同期されます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-326">On Node A, the primary replica continues to accept updates, and on Node B, the secondary replica continues to synchronize with the primary replica.</span></span> <span data-ttu-id="a6a21-327">ノード C のセカンダリ レプリカは同期されなくなり、プライマリ レプリカからしだいに遅れが生じます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-327">The secondary replica on Node C becomes unsynchronized and falls increasingly behind the primary replica.</span></span> <span data-ttu-id="a6a21-328">ただし、ノード C は切断されているため、レプリカは誤って SYNCHRONIZED 状態のままになります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-328">However, because Node C is disconnected, the replica remains, incorrectly, in the SYNCHRONIZED state.</span></span>  
  
 <span data-ttu-id="a6a21-329">ノード A でクォーラムが失われた後に強制された場合は、WSFC クラスター上の可用性グループの同期の状態は正しい状態になる必要があります。つまり、ノード C のセカンダリ レプリカは UNSYNCHRONIZED 状態として示される必要があります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-329">If quorum is lost and is then forced on Node A, the synchronization state of the availability group on the WSFC cluster should be correct-with the secondary replica on Node C shown as UNSYNCHRONIZED.</span></span> <span data-ttu-id="a6a21-330">ただし、ノード C でクォーラムが強制された場合、可用性グループの同期は正しくなくなります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-330">However, if quorum is forced on Node C, the synchronization of the availability group will be incorrect.</span></span> <span data-ttu-id="a6a21-331">クラスターの同期の状態は、ノード C が切断された時点まで戻ります。つまり、ノード C のセカンダリ レプリカは*誤って* SYNCHRONIZED 状態として示されます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-331">The synchronization state on the cluster will have reverted back to when Node C was disconnected-with the secondary replica on Node C *incorrectly* shown as SYNCHRONIZED.</span></span> <span data-ttu-id="a6a21-332">計画的な手動フェールオーバーはデータの安全性を保証するため、クォーラムの強制後に可用性グループをオンラインに戻すために使用することはできません。</span><span class="sxs-lookup"><span data-stu-id="a6a21-332">Since planned manual failovers guarantee the safety of the data, they are disallowed for bring an availability group back online after quorum is forced.</span></span>  
  
###  <a name="tracking-potential-data-loss"></a><a name="TrackPotentialDataLoss"></a> <span data-ttu-id="a6a21-333">データ損失の可能性の追跡</span><span class="sxs-lookup"><span data-stu-id="a6a21-333">Tracking Potential Data Loss</span></span>  
 <span data-ttu-id="a6a21-334">WSFC クラスターに正常なクォーラムがある場合、データベースのデータが損失する現在の可能性を推測することができます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-334">When the WSFC cluster has a healthy quorum, you can estimate the current potential for data loss on databases.</span></span> <span data-ttu-id="a6a21-335">特定のセカンダリ レプリカの場合、データ損失の現在の可能性は、ローカル セカンダリ データベースが対応するプライマリ データベースにどの程度遅れているかによって決まります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-335">For a given secondary replica, the current potential for data loss depends on how far the local secondary databases are lagging behind the corresponding primary databases.</span></span> <span data-ttu-id="a6a21-336">遅延の程度は時間の経過と共に変化するため、非同期のセカンダリ データベースについてデータ損失の可能性を定期的に追跡することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="a6a21-336">Because the amount of lag varies over time, we recommend that you periodically track potential data loss for your unsynchronized secondary databases.</span></span> <span data-ttu-id="a6a21-337">遅延を追跡するには、次のように、各プライマリ データベースとそのセカンダリ データベースの最後にコミットした LSN および最終コミット時間を比較する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-337">Tracking lag involves comparing the Last Commit LSN and Last Commit Time for each primary database and its secondary databases, as follows:</span></span>  
  
1.  <span data-ttu-id="a6a21-338">プライマリ レプリカに接続します。</span><span class="sxs-lookup"><span data-stu-id="a6a21-338">Connect to the primary replica.</span></span>  
  
2.  <span data-ttu-id="a6a21-339">`last_commit_lsn` `last_commit_time` [Sys. dm_hadr_database_replica_states](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-database-replica-states-transact-sql)動的管理ビューの (最後にコミットされたトランザクションの LSN) 列と (最後のコミット時の) 列に対してクエリを実行します。</span><span class="sxs-lookup"><span data-stu-id="a6a21-339">Query the `last_commit_lsn` (LSN of the last committed transaction) and `last_commit_time` (time of the last commit) columns of the [sys.dm_hadr_database_replica_states](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-database-replica-states-transact-sql) dynamic management view.</span></span>  
  
3.  <span data-ttu-id="a6a21-340">各プライマリ データベースとその各セカンダリ データベースに返された値を比較します。</span><span class="sxs-lookup"><span data-stu-id="a6a21-340">Compare the values returned for each primary database and each of its secondary databases.</span></span> <span data-ttu-id="a6a21-341">最後にコミットした LSN の差異は、遅延の程度を示します。</span><span class="sxs-lookup"><span data-stu-id="a6a21-341">The difference between their Last Commit LSNs indicate the amount of lag.</span></span>  
  
4.  <span data-ttu-id="a6a21-342">1 つのデータベースまたは一連のデータベースでの遅延の程度が一定期間、指定した遅延の最大値を超えた場合に、警告を表示させることができます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-342">You can trigger an alert when the amount of lag on a database or set of databases exceeds your desired maximum lag for a given period of time.</span></span> <span data-ttu-id="a6a21-343">たとえば、クエリは、各プライマリ データベースで 1 分ごとに実行されるジョブによって実行できます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-343">For example, the query can be run by a job that executes every minute on each primary database.</span></span> <span data-ttu-id="a6a21-344">プライマリ データベースとそのセカンダリ データベースの `last_commit_time` の差異が、最後にジョブが実行された後に目標復旧ポイント (RPO) (たとえば、5 分) を超えた場合、ジョブは警告を生成できます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-344">If the difference between the `last_commit_time` of a primary database and any of its secondary databases has exceeded the recovery point objective (RPO) (for example, 5 minutes) since the last time the job executed, the job can raise an alert.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="a6a21-345">WSFC クラスターにクォーラムが存在しない場合またはクォーラムが強制されている場合は、`last_commit_lsn` と `last_commit_time` は NULL になります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-345">When the WSFC cluster lacks quorum or quorum has been forced, `last_commit_lsn` and `last_commit_time` are NULL.</span></span> <span data-ttu-id="a6a21-346">クォーラム強制後のデータ損失を回避する方法の詳細については、「 [可用性グループの強制手動フェールオーバーの実行 &#40;SQL Server&#41;](perform-a-forced-manual-failover-of-an-availability-group-sql-server.md)と呼ばれるプロセスで交換されることがあります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-346">For information about how you might be able to avoid data loss after you forced quorum, see "Potential Ways to Avoid Data Loss After Quorum is Forced" in [Perform a Forced Manual Failover of an Availability Group &#40;SQL Server&#41;](perform-a-forced-manual-failover-of-an-availability-group-sql-server.md).</span></span>  
  
###  <a name="managing-the-potential-data-loss"></a><a name="ForcedFailoverManagingDataLoss"></a> <span data-ttu-id="a6a21-347">データ損失の可能性への対処</span><span class="sxs-lookup"><span data-stu-id="a6a21-347">Managing the Potential Data Loss</span></span>  
 <span data-ttu-id="a6a21-348">フェールオーバーの強制後は、すべてのセカンダリ データベースが中断されます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-348">After failover is forced, all secondary databases are suspended.</span></span> <span data-ttu-id="a6a21-349">これには、元のプライマリ データベースも含まれます (元のプライマリ レプリカは、オンラインに戻った後でセカンダリ レプリカになります)。</span><span class="sxs-lookup"><span data-stu-id="a6a21-349">This includes the former primary databases, after the former primary replica comes back online and discovers that it is now a secondary replica.</span></span> <span data-ttu-id="a6a21-350">各セカンダリ レプリカで、中断されたデータベースをそれぞれ手動で再開する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-350">You must manually resume each suspended database individually on each secondary replica.</span></span>  
  
 <span data-ttu-id="a6a21-351">前のプライマリ レプリカが使用可能になると、そのデータベースは破損していないと想定されるので、データ損失の可能性に対処できます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-351">Once the former primary replica is available, assuming that its databases are undamaged, you can attempt to manage the potential data loss.</span></span> <span data-ttu-id="a6a21-352">データ損失の可能性に対処するために使用できる方法は、元のプライマリ レプリカが新しいプライマリ レプリカに接続されたかどうかによって異なります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-352">The available approach for managing potential data loss depends on whether the original primary replica has connected to the new primary replica.</span></span> <span data-ttu-id="a6a21-353">元のプライマリ レプリカが新しいプライマリ インスタンスにアクセスできる場合、自動的かつ透過的に再接続されます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-353">Assuming that the original primary replica can access the new primary instance, reconnecting occurs automatically and transparently.</span></span>  
  
#### <a name="the-original-primary-replica-has-reconnected"></a><span data-ttu-id="a6a21-354">元のプライマリ レプリカが再接続された場合</span><span class="sxs-lookup"><span data-stu-id="a6a21-354">The Original Primary Replica Has Reconnected</span></span>  
 <span data-ttu-id="a6a21-355">通常、障害発生後は、元のプライマリ レプリカは再起動するとすぐに、パートナーに再接続します。</span><span class="sxs-lookup"><span data-stu-id="a6a21-355">Typically, after a failure, when the original primary replica restarts it quickly reconnects to its partner.</span></span> <span data-ttu-id="a6a21-356">再接続時に、元のプライマリ レプリカがセカンダリ レプリカになります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-356">On reconnecting, the original primary replica becomes the secondary replica.</span></span> <span data-ttu-id="a6a21-357">そのデータベースはセカンダリ データベースになり、SUSPENDED 状態になります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-357">Its databases becomes the secondary databases and enter the SUSPENDED state.</span></span> <span data-ttu-id="a6a21-358">新しいセカンダリ データベースは、データベースを再開しない限り、ロールバックされません。</span><span class="sxs-lookup"><span data-stu-id="a6a21-358">The new secondary databases will not be not rolled back unless you resume them.</span></span>  
  
 <span data-ttu-id="a6a21-359">ただし、中断されたデータベースにはアクセスできないため、データベースを調査しても、指定されたデータベースを再開したときに失われるデータを評価することはできません。</span><span class="sxs-lookup"><span data-stu-id="a6a21-359">However, the suspended databases are inaccessible, so you cannot inspect them to evaluate what data would be lost if you were to resume a given database.</span></span> <span data-ttu-id="a6a21-360">そのため、セカンダリ データベースを再開するか削除するかは、次に示すようにデータの損失を許容できるかどうかによって決まります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-360">Therefore, the decision on whether to resume or remove a secondary database depends on whether you are willing to accept any data loss, as follows:</span></span>  
  
-   <span data-ttu-id="a6a21-361">データの損失を許容できない場合は、データベースを可用性グループから削除して、データベースを復旧する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-361">If losing any data would be unacceptable, you should remove the databases from the availability group to salvage them.</span></span>  
  
     <span data-ttu-id="a6a21-362">データベース管理者は元のプライマリ データベースを復旧し、失われる可能性のあるデータの復旧を試みることができるようになります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-362">The database administrator can now recover the former primary databases and attempt to recover the data that would have been lost.</span></span> <span data-ttu-id="a6a21-363">ただし、元のプライマリ データベースがオンラインになったときに、そのデータベースは現在のプライマリ データベースとは一致しません。そのため、データベース間の不一致が拡大するのを防ぎ、クライアントのフェールオーバーの問題を回避するために、データベース管理者は削除されたデータベースまたは現在のプライマリ データベースにクライアントがアクセスできないようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-363">However, when a former primary database comes online, it is divergent from the current primary database, so the database administrator needs to make either the removed database or the current primary database inaccessible to clients to avoid further divergence of the databases and to prevent client-failover issues.</span></span>  
  
-   <span data-ttu-id="a6a21-364">ビジネス目標を考慮してもデータの損失を許容できる場合は、セカンダリ データベースを再開できます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-364">If losing data would be acceptable to your business goals, you can resume the secondary databases.</span></span>  
  
     <span data-ttu-id="a6a21-365">新しいセカンダリ データベースを再開すると、データベース同期の最初のステップとしてこのデータベースがロールバックされます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-365">Resuming a new secondary database causes it to be rolled back as the first step in synchronizing the database.</span></span> <span data-ttu-id="a6a21-366">障害発生時にログ レコードが送信キューで待機していた場合、対応するトランザクションはコミットされていた場合でも失われます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-366">If any log records were waiting in the send queue at the time of failure, the corresponding transactions are lost, even if they were committed.</span></span>  
  
#### <a name="the-original-primary-replica-has-not-reconnected"></a><span data-ttu-id="a6a21-367">元のプライマリ レプリカが再接続されなかった場合</span><span class="sxs-lookup"><span data-stu-id="a6a21-367">The Original Primary Replica Has Not Reconnected</span></span>  
 <span data-ttu-id="a6a21-368">元のプライマリ レプリカが新しいプライマリ レプリカにネットワーク経由で再接続するのを一時的に防ぐことができる場合、元のプライマリ データベースを調査して、データベースが再開されたらどのデータが失われるのかを評価できます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-368">If you can temporarily prevent the original primary replica from reconnecting over the network to the new primary replica, you can inspect the original primary databases to evaluate what data would be lost if they were resumed.</span></span>  
  
-   <span data-ttu-id="a6a21-369">データ損失が許容される場合</span><span class="sxs-lookup"><span data-stu-id="a6a21-369">If the potential data loss is acceptable</span></span>  
  
     <span data-ttu-id="a6a21-370">元のプライマリ レプリカから新しいプライマリ レプリカへの再接続を許可します。</span><span class="sxs-lookup"><span data-stu-id="a6a21-370">Allow the original primary replica to reconnect to the new primary replica.</span></span> <span data-ttu-id="a6a21-371">再接続によって新しいセカンダリ データベースが中断されます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-371">Reconnecting causes the new secondary databases to be suspended.</span></span> <span data-ttu-id="a6a21-372">データベースのデータの同期を開始するには、単にそれを再開します。</span><span class="sxs-lookup"><span data-stu-id="a6a21-372">To start data synchronization on a database, simply resume it.</span></span> <span data-ttu-id="a6a21-373">新しいセカンダリ レプリカがそのデータベースの元の復旧分岐を削除し、以前のセカンダリ レプリカに送信されなかったか以前のセカンダリ レプリカによって受信されなかったすべてのトランザクションが失われます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-373">The new secondary replica drops the original recovery fork for that database, losing any transactions that were never sent to or received by the former secondary replica.</span></span>  
  
-   <span data-ttu-id="a6a21-374">データ損失が許容されない場合</span><span class="sxs-lookup"><span data-stu-id="a6a21-374">If the data loss is unacceptable</span></span>  
  
     <span data-ttu-id="a6a21-375">中断されたデータベースを再開したら失われる重要なデータが元のプライマリ データベースに含まれている場合、そのデータベースを可用性グループから削除することにより元のプライマリ データベース上のデータを保持できます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-375">If the original primary database contains critical data that would be lost if you resumed the suspended database, you can preserve the data on the original primary database by removing it from the availability group.</span></span> <span data-ttu-id="a6a21-376">これにより、データベースが RESTORING 状態になります。</span><span class="sxs-lookup"><span data-stu-id="a6a21-376">This causes the database to enter the RESTORING state.</span></span> <span data-ttu-id="a6a21-377">この時点で、削除されたデータベースのログの末尾をバックアップしておくことをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="a6a21-377">At this point, we recommend that you attempt to back up the tail of the removed database's log.</span></span> <span data-ttu-id="a6a21-378">その後、復旧するデータを元のプライマリ データベースからエクスポートして、そのデータを現在のプライマリ データベースにインポートすることにより、現在のプライマリ データベース (前のセカンダリ データベース) を更新できます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-378">Then, you can update the current primary (the former secondary database) by exporting the data you want to salvage from the original primary database and importing it into the current primary database.</span></span> <span data-ttu-id="a6a21-379">更新されたプライマリ データベースの完全バックアップを、できるだけ早く実行することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="a6a21-379">We recommend taking a full database backup of the updated primary database as quickly as possible.</span></span>  
  
     <span data-ttu-id="a6a21-380">その後で、RESTORE WITH NORECOVERY を使用してこのバックアップ (および 1 つ以上の後続ログ バックアップ) を復元することにより、新しいセカンダリ レプリカをホストするサーバー インスタンスで、中断されたセカンダリ データベースを削除して新しいセカンダリ データベースを作成することができます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-380">Then, on the server instance that hosts the new secondary replica, you can delete the suspended secondary database and create a new secondary database by restoring this backup (and least one subsequent log backup) using RESTORE WITH NORECOVERY.</span></span> <span data-ttu-id="a6a21-381">対応するセカンダリ データベースを再開するまで、現在のプライマリ データベースの追加のログ バックアップを遅らせることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="a6a21-381">We recommend delaying additional log backups of the current primary databases until the corresponding secondary databases are resumed.</span></span>  
  
> [!WARNING]  
>  <span data-ttu-id="a6a21-382">プライマリ データベースでは、いずれかのセカンダリ データベースが中断している間は、トランザクション ログの切り捨てが遅延されます。</span><span class="sxs-lookup"><span data-stu-id="a6a21-382">Transaction log truncation is delayed on a primary database while any of its secondary databases is suspended.</span></span> <span data-ttu-id="a6a21-383">また、同期コミット セカンダリ レプリカの同期状態は、いずれかのローカル データベースが中断している間は、HEALTHY に移行できません。</span><span class="sxs-lookup"><span data-stu-id="a6a21-383">Also the synchronization health of a synchronous-commit secondary replica cannot transition to HEALTHY as long as any local database remains suspended.</span></span>  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="a6a21-384">関連タスク</span><span class="sxs-lookup"><span data-stu-id="a6a21-384">Related Tasks</span></span>  
 <span data-ttu-id="a6a21-385">**フェールオーバーの動作を設定するには**</span><span class="sxs-lookup"><span data-stu-id="a6a21-385">**To configure failover behavior**</span></span>  
  
-   [<span data-ttu-id="a6a21-386">可用性レプリカの可用性モードの変更 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="a6a21-386">Change the Availability Mode of an Availability Replica &#40;SQL Server&#41;</span></span>](change-the-availability-mode-of-an-availability-replica-sql-server.md)  
  
-   [<span data-ttu-id="a6a21-387">可用性レプリカのフェールオーバー モードの変更 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="a6a21-387">Change the Failover Mode of an Availability Replica &#40;SQL Server&#41;</span></span>](change-the-failover-mode-of-an-availability-replica-sql-server.md)  
  
-   [<span data-ttu-id="a6a21-388">自動フェールオーバー &#40;AlwaysOn 可用性グループの条件を制御する柔軟なフェールオーバーポリシーを構成&#41;</span><span class="sxs-lookup"><span data-stu-id="a6a21-388">Configure the Flexible Failover Policy to Control Conditions for Automatic Failover &#40;AlwaysOn Availability Groups&#41;</span></span>](configure-flexible-automatic-failover-policy.md)  
  
 <span data-ttu-id="a6a21-389">**手動フェールオーバーを実行するには**</span><span class="sxs-lookup"><span data-stu-id="a6a21-389">**To perform a manual fail over**</span></span>  
  
-   [<span data-ttu-id="a6a21-390">可用性グループの計画的な手動フェールオーバーの実行 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="a6a21-390">Perform a Planned Manual Failover of an Availability Group &#40;SQL Server&#41;</span></span>](perform-a-planned-manual-failover-of-an-availability-group-sql-server.md)  
  
-   [<span data-ttu-id="a6a21-391">可用性グループの強制手動フェールオーバーの実行 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="a6a21-391">Perform a Forced Manual Failover of an Availability Group &#40;SQL Server&#41;</span></span>](perform-a-forced-manual-failover-of-an-availability-group-sql-server.md)  
  
-   [<span data-ttu-id="a6a21-392">可用性グループのフェールオーバー ウィザードの使用 &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="a6a21-392">Use the Fail Over Availability Group Wizard &#40;SQL Server Management Studio&#41;</span></span>](use-the-fail-over-availability-group-wizard-sql-server-management-studio.md)  
  
-   [<span data-ttu-id="a6a21-393">可用性グループのデータベースのためのログインとジョブの管理 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="a6a21-393">Management of Logins and Jobs for the Databases of an Availability Group &#40;SQL Server&#41;</span></span>](../../logins-and-jobs-for-availability-group-databases.md)  
  
 <span data-ttu-id="a6a21-394">**WSFC クォーラムの構成を設定するには**</span><span class="sxs-lookup"><span data-stu-id="a6a21-394">**To configure WSFC Quorum Configuration**</span></span>  
  
-   [<span data-ttu-id="a6a21-395">クラスター クォーラムの NodeWeight の設定の構成</span><span class="sxs-lookup"><span data-stu-id="a6a21-395">Configure Cluster Quorum NodeWeight Settings</span></span>](../../../sql-server/failover-clusters/windows/configure-cluster-quorum-nodeweight-settings.md)  
  
-   [<span data-ttu-id="a6a21-396">クラスター クォーラムの NodeWeight 設定を表示</span><span class="sxs-lookup"><span data-stu-id="a6a21-396">View Cluster Quorum NodeWeight Settings</span></span>](../../../sql-server/failover-clusters/windows/view-cluster-quorum-nodeweight-settings.md)  
  
-   [<span data-ttu-id="a6a21-397">クォーラムを使用せずに WSFC クラスターを強制的に起動する</span><span class="sxs-lookup"><span data-stu-id="a6a21-397">Force a WSFC Cluster to Start Without a Quorum</span></span>](../../../sql-server/failover-clusters/windows/force-a-wsfc-cluster-to-start-without-a-quorum.md)  
  
##  <a name="related-content"></a><a name="RelatedContent"></a> <span data-ttu-id="a6a21-398">関連コンテンツ</span><span class="sxs-lookup"><span data-stu-id="a6a21-398">Related Content</span></span>  
  
-   [<span data-ttu-id="a6a21-399">高可用性と災害復旧のための Microsoft SQL Server AlwaysOn ソリューション ガイド</span><span class="sxs-lookup"><span data-stu-id="a6a21-399">Microsoft SQL Server AlwaysOn Solutions Guide for High Availability and Disaster Recovery</span></span>](https://go.microsoft.com/fwlink/?LinkId=227600)  
  
-   [<span data-ttu-id="a6a21-400">SQL Server AlwaysOn チームのブログ: AlwaysOn チームの公式 SQL Server のブログ</span><span class="sxs-lookup"><span data-stu-id="a6a21-400">SQL Server AlwaysOn Team Blog: The official SQL Server AlwaysOn Team Blog</span></span>](https://blogs.msdn.com/b/sqlalwayson/)  
  
## <a name="see-also"></a><span data-ttu-id="a6a21-401">参照</span><span class="sxs-lookup"><span data-stu-id="a6a21-401">See Also</span></span>  
 <span data-ttu-id="a6a21-402">[AlwaysOn 可用性グループ &#40;SQL Server の概要&#41;](overview-of-always-on-availability-groups-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="a6a21-402">[Overview of AlwaysOn Availability Groups &#40;SQL Server&#41;](overview-of-always-on-availability-groups-sql-server.md) </span></span>  
 <span data-ttu-id="a6a21-403">[可用性モード &#40;AlwaysOn 可用性グループ&#41;](availability-modes-always-on-availability-groups.md) </span><span class="sxs-lookup"><span data-stu-id="a6a21-403">[Availability Modes &#40;AlwaysOn Availability Groups&#41;](availability-modes-always-on-availability-groups.md) </span></span>  
 <span data-ttu-id="a6a21-404">[Windows Server フェールオーバー クラスタリング &#40;WSFC&#41; と SQL Server](../../../sql-server/failover-clusters/windows/windows-server-failover-clustering-wsfc-with-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="a6a21-404">[Windows Server Failover Clustering &#40;WSFC&#41; with SQL Server](../../../sql-server/failover-clusters/windows/windows-server-failover-clustering-wsfc-with-sql-server.md) </span></span>  
 <span data-ttu-id="a6a21-405">[データベースミラーリングまたは AlwaysOn 可用性グループ &#40;SQL Server では、複数データベースにまたがるトランザクションはサポートされていません&#41;](transactions-always-on-availability-and-database-mirroring.md) </span><span class="sxs-lookup"><span data-stu-id="a6a21-405">[Cross-Database Transactions Not Supported For Database Mirroring or AlwaysOn Availability Groups &#40;SQL Server&#41;](transactions-always-on-availability-and-database-mirroring.md) </span></span>  
 <span data-ttu-id="a6a21-406">[フェールオーバー クラスター インスタンスのフェールオーバー ポリシー](../../../sql-server/failover-clusters/windows/failover-policy-for-failover-cluster-instances.md) </span><span class="sxs-lookup"><span data-stu-id="a6a21-406">[Failover Policy for Failover Cluster Instances](../../../sql-server/failover-clusters/windows/failover-policy-for-failover-cluster-instances.md) </span></span>  
 [<span data-ttu-id="a6a21-407">可用性グループの自動フェールオーバーのための柔軟なフェールオーバー ポリシー &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="a6a21-407">Flexible Failover Policy for Automatic Failover of an Availability Group &#40;SQL Server&#41;</span></span>](flexible-automatic-failover-policy-availability-group.md)  
  
  
