---
title: 可用性グループリスナー、クライアント接続、およびアプリケーションのフェールオーバー (SQL Server) |Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- Availability Groups [SQL Server], listeners
- read-only routing
- read-intent connections [AlwaysOn Availability Groups]
- Availability Groups [SQL Server], configuring
- Availability Groups [SQL Server], read-only routing
- Availability Groups [SQL Server], client connectivity
ms.assetid: 76fb3eca-6b08-4610-8d79-64019dd56c44
author: rothja
ms.author: jroth
ms.openlocfilehash: f66046625ca0078904e9555d1cf586873b9f697f
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87714554"
---
# <a name="availability-group-listeners-client-connectivity-and-application-failover-sql-server"></a><span data-ttu-id="3a072-102">可用性グループ リスナー、クライアント接続、およびアプリケーションのフェールオーバー (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="3a072-102">Availability Group Listeners, Client Connectivity, and Application Failover (SQL Server)</span></span>
  <span data-ttu-id="3a072-103">このトピックでは、 [!INCLUDE[ssHADR](../includes/sshadr-md.md)] クライアント接続とアプリケーションのフェールオーバー機能に関する考慮事項について説明します。</span><span class="sxs-lookup"><span data-stu-id="3a072-103">This topic contains information about considerations for [!INCLUDE[ssHADR](../includes/sshadr-md.md)] client connectivity and application-failover functionality.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="3a072-104">通常のリスナー構成では、 [!INCLUDE[tsql](../includes/tsql-md.md)] ステートメントまたは PowerShell コマンドレットを使用して最初の可用性グループ リスナーを簡単に作成できます。</span><span class="sxs-lookup"><span data-stu-id="3a072-104">For the majority of the common listener configurations, you can create the first availability group listener simply by using [!INCLUDE[tsql](../includes/tsql-md.md)] statements or PowerShell cmdlets.</span></span> <span data-ttu-id="3a072-105">詳細については、このトピックの「 [関連タスク](#RelatedTasks)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="3a072-105">For more information, see [Related Tasks](#RelatedTasks), later in this topic.</span></span>  
  
 
  
##  <a name="availability-group-listeners"></a><a name="AGlisteners"></a><span data-ttu-id="3a072-106">可用性グループリスナー</span><span class="sxs-lookup"><span data-stu-id="3a072-106">Availability Group Listeners</span></span>  
 <span data-ttu-id="3a072-107">可用性グループ リスナーを作成することによって、特定の可用性グループのデータベースへのクライアント接続が可能になります。</span><span class="sxs-lookup"><span data-stu-id="3a072-107">You can provide client connectivity to the database of a given availability group by creating an availability group listener.</span></span> <span data-ttu-id="3a072-108">可用性グループ リスナーは、AlwaysOn 可用性グループのプライマリ レプリカまたはセカンダリ レプリカ内のデータベースにアクセスするためにクライアントが接続できる仮想ネットワーク名 (VNN) です。</span><span class="sxs-lookup"><span data-stu-id="3a072-108">An availability group listener is a virtual network name (VNN) to which clients can connect in order to access a database in a primary or secondary replica of an AlwaysOn availability group.</span></span> <span data-ttu-id="3a072-109">可用性グループ リスナーによって、クライアントは、接続先の SQL Server の物理インスタンス名が不明な場合でも、可用性レプリカに接続できます。</span><span class="sxs-lookup"><span data-stu-id="3a072-109">An availability group listener enables a client to connect to an availability replica without knowing the name of the physical instance of SQL Server to which the client is connecting.</span></span>  <span data-ttu-id="3a072-110">現在のプライマリ レプリカの現在の場所に接続するために、クライアント接続文字列を変更する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="3a072-110">The client connection string does not need to be modified to connect to the current location of the current primary replica.</span></span>  
  
 <span data-ttu-id="3a072-111">可用性グループ リスナーには、ドメイン ネーム システム (DNS) のリスナー名、リスナー ポート指定、および 1 つ以上の IP アドレスが含まれます。</span><span class="sxs-lookup"><span data-stu-id="3a072-111">An availability group listener consists of a Domain Name System (DNS) listener name, listener port designation, and one or more IP addresses.</span></span> <span data-ttu-id="3a072-112">可用性グループ リスナーでは、TCP プロトコルのみがサポートされています。</span><span class="sxs-lookup"><span data-stu-id="3a072-112">Only the TCP protocol is supported by availability group listener.</span></span>  <span data-ttu-id="3a072-113">リスナーの DNS 名も、ドメインおよび NetBIOS 内で固有であることが必要です。</span><span class="sxs-lookup"><span data-stu-id="3a072-113">The DNS name of the listener must also be unique in the domain and in NetBIOS.</span></span>  <span data-ttu-id="3a072-114">作成された新しい可用性グループ リスナーは、関連付けられた仮装ネットワーク名 (VNN)、仮想 IP (VIP)、可用性グループの依存関係と共に、クラスター内のリソースになります。</span><span class="sxs-lookup"><span data-stu-id="3a072-114">When you create a new availability group listener it becomes a resource in a cluster with an associated virtual network name (VNN), virtual IP (VIP), and availability group dependency.</span></span> <span data-ttu-id="3a072-115">クライアントは、DNS を使用して VNN を複数の IP アドレスに解決した後、接続要求が成功するかタイムアウトするまで、それぞれのアドレスに接続を試みます。</span><span class="sxs-lookup"><span data-stu-id="3a072-115">A client uses DNS to resolve the VNN into multiple IP addresses and then tries to connect to each address, until a connection request succeeds or until the connection requests time out.</span></span>  
  
 <span data-ttu-id="3a072-116">1 つ以上の[読み取り可能なセカンダリ レプリカ](availability-groups/windows/active-secondaries-readable-secondary-replicas-always-on-availability-groups.md)に対して読み取り専用のルーティングが構成されている場合、プライマリ レプリカに対する読み取りを目的としたクライアント接続は読み取り可能なセカンダリ レプリカにリダイレクトされます。</span><span class="sxs-lookup"><span data-stu-id="3a072-116">If read-only routing is configured for one or more[readable secondary replicas](availability-groups/windows/active-secondaries-readable-secondary-replicas-always-on-availability-groups.md), read-intent client connections to the primary replica are redirected to a readable secondary replica.</span></span> <span data-ttu-id="3a072-117">さらに、SQL Server の 1 つのインスタンスでプライマリ レプリカがオフラインになり、SQL Server の他のインスタンスで新しいプライマリ レプリカがオンラインになると、可用性グループ リスナーによって、クライアントは新しいプライマリ レプリカに接続できます。</span><span class="sxs-lookup"><span data-stu-id="3a072-117">Also, if the primary replica goes offline on one instance of SQL Server, and a new primary replica comes online on another instance of SQL Server, the availability group listener enables clients to connect to the new primary replica.</span></span>  
  
 <span data-ttu-id="3a072-118">可用性グループ リスナーに関する必須情報については、「 [可用性グループ リスナーの作成または構成 &#40;SQL Server&#41;](availability-groups/windows/create-or-configure-an-availability-group-listener-sql-server.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="3a072-118">For essential information about availability group listeners, see [Create or Configure an Availability Group Listener &#40;SQL Server&#41;](availability-groups/windows/create-or-configure-an-availability-group-listener-sql-server.md).</span></span>  
  
 
  
###  <a name="availability-group-listener-configuration"></a><a name="AGlConfig"></a> <span data-ttu-id="3a072-119">可用性グループ リスナーの構成</span><span class="sxs-lookup"><span data-stu-id="3a072-119">Availability Group Listener Configuration</span></span>  
 <span data-ttu-id="3a072-120">可用性グループ リスナーは、以下のものによって定義されます。</span><span class="sxs-lookup"><span data-stu-id="3a072-120">An availability group listener is defined by the following:</span></span>  
  
 <span data-ttu-id="3a072-121">一意の DNS 名</span><span class="sxs-lookup"><span data-stu-id="3a072-121">A unique DNS name</span></span>  
 <span data-ttu-id="3a072-122">これは仮想ネットワーク名 (VNN) とも呼ばれています。</span><span class="sxs-lookup"><span data-stu-id="3a072-122">This is also known as a Virtual Network Name (VNN).</span></span> <span data-ttu-id="3a072-123">DNS ホスト名に対する Active Directory の名前付け規則が適用されます。</span><span class="sxs-lookup"><span data-stu-id="3a072-123">Active Directory naming rules for DNS host names apply.</span></span> <span data-ttu-id="3a072-124">詳細については、サポート技術情報の「 [Active Directory でのコンピューター、ドメイン、サイト、および OU の名前付け規則](https://support.microsoft.com/kb/909264) 」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="3a072-124">For more information, see the [Naming conventions in Active Directory for computers, domains, sites, and OUs](https://support.microsoft.com/kb/909264) KB article.</span></span>  
  
 <span data-ttu-id="3a072-125">1 つ以上の仮想 IP アドレス (VIP)</span><span class="sxs-lookup"><span data-stu-id="3a072-125">One or more Virtual IP addresses (VIPs)</span></span>  
 <span data-ttu-id="3a072-126">VIP は、可用性グループがフェールオーバーする 1 つ以上のサブネットに対して構成されます。</span><span class="sxs-lookup"><span data-stu-id="3a072-126">VIPs are configured for one or more subnets to which the availability group can failover.</span></span>  
  
 <span data-ttu-id="3a072-127">IP アドレスの構成</span><span class="sxs-lookup"><span data-stu-id="3a072-127">IP address configuration</span></span>  
 <span data-ttu-id="3a072-128">特定の可用性グループ リスナーの IP アドレスには、動的ホスト構成プロトコル (DHCP) または 1 つ以上の静的 IP アドレスを使用します。</span><span class="sxs-lookup"><span data-stu-id="3a072-128">For a given availability group listener, the IP address uses either Dynamic Host Configuration Protocol (DHCP) or one or more static IP addresses.</span></span>  
  
-   <span data-ttu-id="3a072-129">動的ホスト構成プロトコル (DHCP)</span><span class="sxs-lookup"><span data-stu-id="3a072-129">Dynamic Host Configuration Protocol (DHCP)</span></span>  
  
     <span data-ttu-id="3a072-130">可用性グループが 1 つのサブネット上にある場合、DHCP を使用するようにすべての可用性グループ リスナーの IP アドレスを構成できます。</span><span class="sxs-lookup"><span data-stu-id="3a072-130">If an availability group resides on a single subnet, you can configure all the availability group listener IP addresses to use DHCP.</span></span> <span data-ttu-id="3a072-131">実稼動前の環境では、DHCP を使用すると、別のサブネット上のリモート サイトに対するディザスター リカバリーを必要としない可用性グループを簡単にセットアップできます。</span><span class="sxs-lookup"><span data-stu-id="3a072-131">For pre-production environments, DHCP offers an easy setup for an availability group that does not require disaster recovery to a remote site on a separate subnet.</span></span> <span data-ttu-id="3a072-132">ただし、実稼働環境では DHCP と可用性グループ リスナーを組み合わせて使用しないでください。</span><span class="sxs-lookup"><span data-stu-id="3a072-132">However, you should not use DHCP in conjunction with an availability group listener in a production environment.</span></span> <span data-ttu-id="3a072-133">これは、ダウンタイムが発生した場合に DHCP の IP リース期限が切れると、リスナーの DNS 名に関連付けられている新しい DHCP IP アドレスの再登録に余分な時間がかかるためです。</span><span class="sxs-lookup"><span data-stu-id="3a072-133">This is because, in the event of down time, if the DHCP IP lease expires, extra time is required to re-register the new DHCP IP address associated with the listener DNS name.</span></span> <span data-ttu-id="3a072-134">余分な時間がかかると、クライアント接続に失敗します。</span><span class="sxs-lookup"><span data-stu-id="3a072-134">The extra time will cause client-connection failure.</span></span>  
  
-   <span data-ttu-id="3a072-135">静的 IP アドレス</span><span class="sxs-lookup"><span data-stu-id="3a072-135">Static IP addresses</span></span>  
  
     <span data-ttu-id="3a072-136">実稼働環境では、可用性グループ リスナーで静的 IP アドレスを使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="3a072-136">In production environments, we recommend that availability group listeners use static IP addresses.</span></span> <span data-ttu-id="3a072-137">また、可用性グループがマルチサブネット ドメインのサブネットにまたがっている場合、可用性グループ リスナーで静的 IP アドレスを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3a072-137">Furthermore, where availability groups extend across subnets in a multi-subnet domain, an availability group listener must use static IP addresses.</span></span>  
  
 <span data-ttu-id="3a072-138">ハイブリッド ネットワーク構成とサブネットにまたがる DHCP は、可用性グループ リスナーではサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="3a072-138">Hybrid network configurations and DHCP across subnets are not supported for availability group listeners.</span></span> <span data-ttu-id="3a072-139">これは、フェールオーバーが発生すると動的 IP アドレスの期限が切れたり、解放されたりする場合があり、全体的な可用性が低下するおそれがあるためです。</span><span class="sxs-lookup"><span data-stu-id="3a072-139">This is because when a failover happens, a dynamic IP might expire or be released, which jeopardizes overall high availability.</span></span>  
  
###  <a name="selecting-an-availability-group-listener-port"></a><a name="SelectListenerPort"></a> <span data-ttu-id="3a072-140">可用性グループ リスナー ポートの選択</span><span class="sxs-lookup"><span data-stu-id="3a072-140">Selecting an Availability Group Listener Port</span></span>  
 <span data-ttu-id="3a072-141">可用性グループ リスナーを構成する場合は、ポートを指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3a072-141">When configuring an availability group listener, you must designate a port.</span></span>  <span data-ttu-id="3a072-142">既定のポートを 1433 に構成すると、クライアント接続文字列をシンプルにできます。</span><span class="sxs-lookup"><span data-stu-id="3a072-142">You can configure the default port to 1433 in order to allow for simplicity of the client connection strings.</span></span> <span data-ttu-id="3a072-143">1433 を使用する場合は、接続文字列でポート番号を指定する必要がありません。</span><span class="sxs-lookup"><span data-stu-id="3a072-143">If using 1433, you do not need to designate a port number in a connection string.</span></span>   <span data-ttu-id="3a072-144">また、各可用性グループ リスナーに個別の仮想ネットワーク名があるため、1 つの WSFC で構成された各可用性グループ リスナーが同じ既定のポート 1433 を参照するように構成できます。</span><span class="sxs-lookup"><span data-stu-id="3a072-144">Also, since each availability group listener will have a separate virtual network name, each availability group listener configured on a single WSFC can be configured to reference the same default port of 1433.</span></span>  
  
 <span data-ttu-id="3a072-145">標準ではないリスナー ポートを指定することもできます。ただし、その場合、可用性グループ リスナーに接続するたびに、接続文字列で接続先ポートを明示的に指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3a072-145">You can also designate a non-standard listener port; however this means that you will also need to explicitly specify a target port in your connection string whenever connecting to the availability group listener.</span></span>  <span data-ttu-id="3a072-146">また、標準以外のポートに対して、ファイアウォールのアクセス許可を有効にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="3a072-146">You will also need to open permission on the firewall for the non-standard port.</span></span>  
  
 <span data-ttu-id="3a072-147">可用性グループ リスナー VNN で既定のポート 1433 を使用する場合、クラスター ノード上の他のサービスがそのポートを使用していないことを確認する必要があります。確認しない場合、ポートの競合が発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="3a072-147">If you use the default port of 1433 for availability group listener VNNs, you will still need to ensure that no other services on the cluster node are using this port; otherwise this would cause a port conflict.</span></span>  
  
 <span data-ttu-id="3a072-148">SQL Server のインスタンスの 1 つが、インスタンス リスナーを通じて TCP ポート 1433 を既にリッスンしていて、コンピューター上の他のサービス (SQL Server の別のインスタンスを含む) がポート 1433 をリッスンしていない場合は、可用性グループ リスナーでポートの競合は発生しません。</span><span class="sxs-lookup"><span data-stu-id="3a072-148">If one of the instances of SQL Server is already listening on TCP port 1433 via the instance listener and there are no other services (including additional instances of SQL Server) on the computer listening on port 1433, this will not cause a port conflict with the availability group listener.</span></span>  <span data-ttu-id="3a072-149">これは、可用性グループ リスナーが同じサービス プロセス内で同じ TCP ポートを共有できるためです。</span><span class="sxs-lookup"><span data-stu-id="3a072-149">This is because the availability group listener can share the same TCP port inside the same service process.</span></span>  <span data-ttu-id="3a072-150">ただし、同じポートをリッスンするように、SQL Server の複数のインスタンス (サイド バイ サイド) を構成しないでください。</span><span class="sxs-lookup"><span data-stu-id="3a072-150">However multiple instances of SQL Server (side-by-side)should not be configured to listen on the same port.</span></span>  
  
##  <a name="using-a-listener-to-connect-to-the-primary-replica"></a><a name="ConnectToPrimary"></a><span data-ttu-id="3a072-151">リスナーを使用したプライマリレプリカへの接続</span><span class="sxs-lookup"><span data-stu-id="3a072-151">Using a Listener to Connect to the Primary Replica</span></span>  
 <span data-ttu-id="3a072-152">可用性グループ リスナーを使用して読み取り/書き込みアクセスでプライマリ レプリカに接続するには、可用性グループ リスナーの DNS 名を接続文字列で指定します。</span><span class="sxs-lookup"><span data-stu-id="3a072-152">To use an availability group listener to connect to the primary replica for read-write access, the connection string specifies the availability group listener DNS name.</span></span>  <span data-ttu-id="3a072-153">可用性グループ プライマリ レプリカが新しいレプリカに変更された場合、可用性グループ リスナーのネットワーク名を使用している既存の接続は解除されます。</span><span class="sxs-lookup"><span data-stu-id="3a072-153">If an availability group primary replica changes to a new replica, existing connections that use an availability group listener's network name are disconnected.</span></span>  <span data-ttu-id="3a072-154">その後、可用性グループ リスナーへの新しい接続によって、新しいプライマリ レプリカにダイレクトされます。</span><span class="sxs-lookup"><span data-stu-id="3a072-154">New connections to the availability group listener are then directed to the new primary replica.</span></span> <span data-ttu-id="3a072-155">ADO.NET プロバイダー (System.Data.SqlClient) の基本的な接続文字列の例を次に示します。</span><span class="sxs-lookup"><span data-stu-id="3a072-155">An example of a basic connection string for the ADO.NET provider (System.Data.SqlClient) is as follows:</span></span>  
  
```  
Server=tcp: AGListener,1433;Database=MyDB;IntegratedSecurity=SSPI  
```  
  
 <span data-ttu-id="3a072-156">可用性グループ リスナーのサーバー名を使用する代わりに、プライマリ レプリカまたはセカンダリ レプリカの SQL Server 名のインスタンスを直接参照することもできます。ただし、その場合、新しい接続が現在のプライマリ レプリカに自動的にダイレクトされるという利点がなくなります。</span><span class="sxs-lookup"><span data-stu-id="3a072-156">You can still choose to directly reference the instance of SQL Server name of the primary or secondary replicas instead of using the availability group listener server name, however if you choose to do so you will lose the benefit of new connections being directed automatically to the current primary replica.</span></span>  <span data-ttu-id="3a072-157">また、読み取り専用ルーティングの利点もなくなります。</span><span class="sxs-lookup"><span data-stu-id="3a072-157">You will also lose the benefit of read-only routing.</span></span>  
  
##  <a name="using-a-listener-to-connect-to-a-read-only-secondary-replica-read-only-routing"></a><a name="ConnectToSecondary"></a> <span data-ttu-id="3a072-158">リスナーを使用した読み取り専用セカンダリ レプリカ (読み取り専用ルーティング) への接続</span><span class="sxs-lookup"><span data-stu-id="3a072-158">Using a Listener to Connect to a Read-Only Secondary Replica (Read-Only Routing)</span></span>  
 <span data-ttu-id="3a072-159">*読み取り専用ルーティング[!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]は、可用性グループ リスナーへの着信接続を、読み取り専用ワークロードを許可するように構成されたセカンダリ レプリカへルーティングする、* の機能です。</span><span class="sxs-lookup"><span data-stu-id="3a072-159">*Read-only routing* refers to the ability of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] to route incoming connections to an availability group listener to a secondary replica that is configured to allow read-only workloads.</span></span> <span data-ttu-id="3a072-160">次の条件が満たされる場合、可用性グループ リスナー名を参照する着信接続を、読み取り専用レプリカに自動的にルーティングできます。</span><span class="sxs-lookup"><span data-stu-id="3a072-160">An incoming connection referencing an availability group listener name can automatically be routed to a read-only replica if the following are true:</span></span>  
  
-   <span data-ttu-id="3a072-161">少なくとも 1 つのセカンダリ レプリカが読み取り専用アクセスに設定され、各読み取り専用セカンダリ レプリカとプライマリ レプリカが読み取り専用ルーティングをサポートするように構成されている。</span><span class="sxs-lookup"><span data-stu-id="3a072-161">At least one secondary replica is set to read-only access, and each read-only secondary replica and the primary replica are configured to support read-only routing.</span></span> <span data-ttu-id="3a072-162">詳細については、このセクションの後の「 [読み取り専用ルーティングの可用性レプリカを構成するには](#ConfigureARsForROR)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="3a072-162">For more information, see [To Configure Availability Replicas for Read-Only Routing](#ConfigureARsForROR), later in this section.</span></span>  
  
-   <span data-ttu-id="3a072-163">接続文字列は可用性グループ リスナーを参照し、着信接続のアプリケーションの目的が読み取り専用に設定されている (たとえば、ODBC または OLEDB の接続文字列、接続属性、またはプロパティで **Application Intent=ReadOnly** キーワードを使用している)。</span><span class="sxs-lookup"><span data-stu-id="3a072-163">The connection string references an availability group listener, and the application intent of the incoming connection is set to read-only (for example, by using the **Application Intent=ReadOnly** keyword in the ODBC or OLEDB connection strings or connection attributes or properties).</span></span> <span data-ttu-id="3a072-164">詳細については、このセクションの後の「 [読み取り専用アプリケーションの目的および読み取り専用ルーティング](#ReadOnlyAppIntent)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="3a072-164">For more information, see [Read-Only Application Intent and Read-Only Routing](#ReadOnlyAppIntent), later in this section.</span></span>  
  
###  <a name="to-configure-availability-replicas-for-read-only-routing"></a><a name="ConfigureARsForROR"></a> <span data-ttu-id="3a072-165">読み取り専用ルーティングの可用性レプリカを構成するには</span><span class="sxs-lookup"><span data-stu-id="3a072-165">To Configure Availability Replicas for Read-Only Routing</span></span>  
 <span data-ttu-id="3a072-166">データベース管理者は、可用性レプリカを次のように構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3a072-166">A database administrator must configure the availability replicas as follows:</span></span>  
  
1.  <span data-ttu-id="3a072-167">読み取り可能なセカンダリ レプリカとして構成する可用性レプリカごとに、データベース管理者はセカンダリ ロールにのみ影響する次の設定を構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3a072-167">For each availability replica that you want to configure as a readable secondary replica, a database administrator must configure the following settings, which take effect only under the secondary role:</span></span>  
  
    -   <span data-ttu-id="3a072-168">接続アクセスを「すべて」または「読み取り専用」に設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3a072-168">Connection access must be set to "all" or "read only".</span></span>  
  
    -   <span data-ttu-id="3a072-169">読み取り専用ルーティングの URL を指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3a072-169">The read-only routing URL must be specified.</span></span>  
  
2.  <span data-ttu-id="3a072-170">これらのレプリカごとに、プライマリ ロールに対して読み取り専用ルーティング リストを指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3a072-170">For each of these replicas, a read-only routing list must be specified for the primary role.</span></span> <span data-ttu-id="3a072-171">1 つ以上のサーバー名をルーティング ターゲットとして指定します。</span><span class="sxs-lookup"><span data-stu-id="3a072-171">Specify one or more server names as routing targets.</span></span>  
  
####  <a name="related-tasks"></a><a name="RelatedTasksROR"></a> <span data-ttu-id="3a072-172">関連タスク</span><span class="sxs-lookup"><span data-stu-id="3a072-172">Related Tasks</span></span>  
  
-   [<span data-ttu-id="3a072-173">可用性レプリカでの読み取り専用アクセスの構成 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="3a072-173">Configure Read-Only Access on an Availability Replica &#40;SQL Server&#41;</span></span>](availability-groups/windows/configure-read-only-access-on-an-availability-replica-sql-server.md)  
  
-   [<span data-ttu-id="3a072-174">可用性グループの読み取り専用ルーティングの構成 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="3a072-174">Configure Read-Only Routing for an Availability Group &#40;SQL Server&#41;</span></span>](availability-groups/windows/configure-read-only-routing-for-an-availability-group-sql-server.md)  
  
###  <a name="read-only-application-intent-and-read-only-routing"></a><a name="ReadOnlyAppIntent"></a><span data-ttu-id="3a072-175">読み取り専用アプリケーションの目的および読み取り専用ルーティング</span><span class="sxs-lookup"><span data-stu-id="3a072-175">Read-Only Application Intent and Read-Only Routing</span></span>  
 <span data-ttu-id="3a072-176">アプリケーションの目的の接続文字列プロパティは、読み取り/書き込み用または読み取り専用のどちらかの可用性グループ データベースにダイレクトされる、クライアント アプリケーションの要求を表します。</span><span class="sxs-lookup"><span data-stu-id="3a072-176">The application intent connection string property expresses the client application's request to be directed either to a read-write or read-only version of an availability group database.</span></span> <span data-ttu-id="3a072-177">読み取り専用ルーティングを使用するには、可用性グループ リスナーに接続するときに、クライアントが接続文字列内で読み取り専用のアプリケーションの目的を使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3a072-177">To use read-only routing, a client must use an application intent of read-only in the connection string when connecting to the availability group listener.</span></span> <span data-ttu-id="3a072-178">読み取り専用のアプリケーションの目的がないと、可用性グループ リスナーへの接続は、プライマリ レプリカ上のデータベースに送られます。</span><span class="sxs-lookup"><span data-stu-id="3a072-178">Without the read-only application intent, connections to the availability group listener are directed to the database on the primary replica.</span></span>  
  
 <span data-ttu-id="3a072-179">アプリケーションの目的の属性は、ログイン中にクライアントのセッションに格納されます。その後、SQL Server のインスタンスがこの目的を処理し、可用性グループの構成およびセカンダリ レプリカ内のターゲット データベースの現在の読み取り/書き込み状態に基づいて、実行する操作を決定します。</span><span class="sxs-lookup"><span data-stu-id="3a072-179">The application intent attribute is stored in the client's session during login and the instance of SQL Server will then process this intent and determine what to do according to the configuration of the availability group and the current read-write state of the target database in the secondary replica.</span></span>  
  
 <span data-ttu-id="3a072-180">読み取り専用のアプリケーションの目的を指定する ADO.NET プロバイダー (System.Data.SqlClient) の接続文字列の例を次に示します。</span><span class="sxs-lookup"><span data-stu-id="3a072-180">An example of a connection string for the ADO.NET provider (System.Data.SqlClient) that designates read-only application intent is as follows:</span></span>  
  
```  
Server=tcp:AGListener,1433;Database=AdventureWorks;IntegratedSecurity=SSPI;ApplicationIntent=ReadOnly  
```  
  
 <span data-ttu-id="3a072-181">この接続文字列の例では、クライアントはポート 1433 で `AGListener` という名前の可用性グループ リスナーへの接続を試みます (可用性グループ リスナーが 1433 でリッスンしている場合、このポートの指定を省略できます)。</span><span class="sxs-lookup"><span data-stu-id="3a072-181">In this connection string example, the client is attempting to connect to an availability group listener named `AGListener` on port 1433 (you may also omit the port if the availability group listener is listening on 1433).</span></span>  <span data-ttu-id="3a072-182">接続文字列には、プロパティがに設定されてい `ApplicationIntent` `ReadOnly` ます。これにより、読み取りを目的とした*接続文字列*が作成されます。</span><span class="sxs-lookup"><span data-stu-id="3a072-182">The connection string has the `ApplicationIntent` property set to `ReadOnly`, making this a *read-intent connection string*.</span></span>  <span data-ttu-id="3a072-183">この設定がない場合、サーバーは接続の読み取り専用へのルーティングを試行しません。</span><span class="sxs-lookup"><span data-stu-id="3a072-183">Without this setting, the server would not have attempted a read-only routing of the connection.</span></span>  
  
 <span data-ttu-id="3a072-184">可用性グループのプライマリ データベースは、読み取り専用の受信ルーティング要求を処理し、プライマリ レプリカに参加していて読み取り専用ルーティング用に構成されているオンラインの読み取り専用レプリカを特定します。</span><span class="sxs-lookup"><span data-stu-id="3a072-184">The primary database of the availability group processes the incoming read-only routing request and attempts to locate an online, read-only replica that is joined to the primary replica and is configured for read-only routing.</span></span>  <span data-ttu-id="3a072-185">クライアントは、プライマリ レプリカ サーバーから接続情報を受け取り、特定された読み取り専用レプリカに接続します。</span><span class="sxs-lookup"><span data-stu-id="3a072-185">The client receives back connection information from the primary replica server and connects to the identified read-only replica.</span></span>  
  
 <span data-ttu-id="3a072-186">アプリケーションの目的は、クライアント ドライバーから下位の SQLServer インスタンスに送信できます。</span><span class="sxs-lookup"><span data-stu-id="3a072-186">Note that the application intent can be sent from a client driver to a down-level instance of SQL Server.</span></span>  <span data-ttu-id="3a072-187">この場合、読み取り専用のアプリケーションの目的は無視され、接続は通常どおり続行されます。</span><span class="sxs-lookup"><span data-stu-id="3a072-187">In this case, application intent of read-only is ignored and the connection proceeds as normal.</span></span>  
  
 <span data-ttu-id="3a072-188">読み取り専用ルーティングをバイパスする場合、または、可用性グループ リスナー名を使用せずに SQL Server のプライマリ レプリカ インスタンスに直接接続する場合は、"アプリケーションの目的" 接続プロパティを `ReadOnly` に設定しません (指定しない場合、既定では、ログイン中は `ReadWrite`)。</span><span class="sxs-lookup"><span data-stu-id="3a072-188">You can bypass read-only routing by not setting the application intent connection property to `ReadOnly` (when not designated, the default is `ReadWrite` during login) or by connecting directly to the primary replica instance of SQL Server instead of using the availability group listener name.</span></span>  <span data-ttu-id="3a072-189">読み取り専用レプリカに直接接続する場合は、読み取り専用ルーティングも実行されません。</span><span class="sxs-lookup"><span data-stu-id="3a072-189">Read-only routing will also not occur if you connect directly to a read-only replica.</span></span>  
  
####  <a name="related-tasks"></a><a name="RelatedTasksApps"></a> <span data-ttu-id="3a072-190">関連タスク</span><span class="sxs-lookup"><span data-stu-id="3a072-190">Related Tasks</span></span>  
  
-   [<span data-ttu-id="3a072-191">SQL Server Native Client の HADR サポート</span><span class="sxs-lookup"><span data-stu-id="3a072-191">SQL Server Native Client Support for High Availability, Disaster Recovery</span></span>](../relational-databases/native-client/features/sql-server-native-client-support-for-high-availability-disaster-recovery.md)  
  
-   [<span data-ttu-id="3a072-192">SQL Server Native Client での接続文字列キーワードの使用</span><span class="sxs-lookup"><span data-stu-id="3a072-192">Using Connection String Keywords with SQL Server Native Client</span></span>](../relational-databases/native-client/applications/using-connection-string-keywords-with-sql-server-native-client.md)  
  
##  <a name="bypassing-availability-group-listeners"></a><a name="BypassAGl"></a><span data-ttu-id="3a072-193">可用性グループリスナーのバイパス</span><span class="sxs-lookup"><span data-stu-id="3a072-193">Bypassing Availability Group Listeners</span></span>  
 <span data-ttu-id="3a072-194">可用性グループ リスナーでフェールオーバー リダイレクトと読み取り専用ルーティングが有効にされている場合、クライアント接続でこれらを使用する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="3a072-194">While availability group listeners enable support for failover redirection and read-only routing, client connections are not required to use them.</span></span> <span data-ttu-id="3a072-195">また、クライアント接続は、可用性グループ リスナーに接続する代わりに、SQLServer のインスタンスを直接参照できます。</span><span class="sxs-lookup"><span data-stu-id="3a072-195">A client connection can also directly reference the instance of SQL Server instead of connecting to the availability group listener.</span></span>  
  
 <span data-ttu-id="3a072-196">SQL Server のインスタンスにとって、接続のログインで、可用性グループ リスナーまたは他のインスタンス エンドポイントのどちらを使用するかは関係ありません。</span><span class="sxs-lookup"><span data-stu-id="3a072-196">To the instance of SQL Server it is irrelevant whether a connection logs in using the availability group listener or using another instance endpoint.</span></span>  <span data-ttu-id="3a072-197">SQL Server のインスタンスは、接続先データベースの状態を確認し、可用性グループの構成およびインスタンス上のデータベースの現在の状態に基づいて、接続を許可または禁止します。</span><span class="sxs-lookup"><span data-stu-id="3a072-197">The instance of SQL Server will verify the state of the targeted database and either allow or disallow connectivity based on the configuration of the availability group and the current state of the database on the instance.</span></span>  <span data-ttu-id="3a072-198">たとえば、クライアント アプリケーションが SQL Server ポートのインスタンスに直接接続し、可用性グループでホストされているターゲット データベースに接続する場合、ターゲット データベースがプライマリ状態でオンラインであれば接続は成功します。</span><span class="sxs-lookup"><span data-stu-id="3a072-198">For example, if a client application connects directly to a instance of SQL Server port and connects to a target database hosted in an availability group, and the target database is in primary state and online, then connectivity will succeed.</span></span>  <span data-ttu-id="3a072-199">ターゲット データベースがオフラインまたは移行状態の場合は、データベースへの接続が失敗します。</span><span class="sxs-lookup"><span data-stu-id="3a072-199">If the target database is offline or in a transitional state, connectivity to the database will fail.</span></span>  
  
 <span data-ttu-id="3a072-200">データベース ミラーリングを [!INCLUDE[ssHADR](../includes/sshadr-md.md)]に移行している間、セカンダリ レプリカが 1 つしか存在せず、これにユーザーが接続できない場合は、アプリケーションでデータベース ミラーリング接続文字列を指定できます。</span><span class="sxs-lookup"><span data-stu-id="3a072-200">Alternatively, while migrating from database mirroring to [!INCLUDE[ssHADR](../includes/sshadr-md.md)], applications can specify the database mirroring connection string as long as only one secondary replica exists and it disallows user connections.</span></span> <span data-ttu-id="3a072-201">詳細については、このセクションの後の「 [データベース ミラーリング接続文字列と可用性グループの使用](#DbmConnectionString)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="3a072-201">For more information, see [Using Database-Mirroring Connection Strings with Availability Groups](#DbmConnectionString), later in this section.</span></span>  
  
###  <a name="using-database-mirroring-connection-strings-with-availability-groups"></a><a name="DbmConnectionString"></a><span data-ttu-id="3a072-202">可用性グループでのデータベースミラーリング接続文字列の使用</span><span class="sxs-lookup"><span data-stu-id="3a072-202">Using Database-Mirroring Connection Strings with Availability Groups</span></span>  
 <span data-ttu-id="3a072-203">可用性グループに 1 つしかセカンダリ レプリカが存在せず、さらに、その可用性グループが、セカンダリ レプリカへの読み取りアクセスを許可する設定になっていない場合、クライアントは、データベース ミラーリングの接続文字列を使用してプライマリ レプリカに接続できます。</span><span class="sxs-lookup"><span data-stu-id="3a072-203">If an availability group possesses only one secondary replica and is not configured to allow read-access to the secondary replica, clients can connect to the primary replica by using a database mirroring connection string.</span></span> <span data-ttu-id="3a072-204">可用性グループに存在する可用性レプリカが 2 つだけ (プライマリ レプリカおよび 1 つのセカンダリ レプリカ) であれば、既存のアプリケーションをデータベース ミラーリングから可用性グループに移行する際にこの方法を用いることができます。</span><span class="sxs-lookup"><span data-stu-id="3a072-204">This approach can be useful while migrating an existing application from database mirroring to an availability group, as long as you limit the availability group to two availability replicas (a primary replica and one secondary replica).</span></span> <span data-ttu-id="3a072-205">セカンダリ レプリカをさらに追加する場合は、可用性グループの可用性グループ リスナーを作成し、その可用性グループ リスナー DNS 名を使用するようにアプリケーションを更新する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3a072-205">If you add additional secondary replicas, you will need to create an availability group listener for the availability group and update your applications to use the availability group listener DNS name.</span></span>  
  
 <span data-ttu-id="3a072-206">データベース ミラーリングの接続文字列を使用する際、クライアントは、 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Native Client または .NET Framework Data Provider for [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]を使用できます。</span><span class="sxs-lookup"><span data-stu-id="3a072-206">When using database mirroring connection strings, the client can use either [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Native Client or .NET Framework Data Provider for [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="3a072-207">クライアントが指定する接続文字列には、最低限、1 つのサーバー インスタンスの名前 ( *イニシャル パートナー名*) が指定されている必要があります。接続先の可用性レプリカを初期状態でホストするサーバー インスタンスは、この名前によって識別されます。</span><span class="sxs-lookup"><span data-stu-id="3a072-207">The connection string provided by a client must minimally supply the name of one server instance, the *initial partner name*, to identify the server instance that initially hosts the availability replica to which you intend to connect.</span></span> <span data-ttu-id="3a072-208">接続文字列には、必要に応じて、別のサーバー インスタンスの名前を指定することもできます。これを *フェールオーバー パートナー名*といい、初期状態でセカンダリ レプリカをホストするサーバー インスタンスは、フェールオーバー パートナー名として識別されます。</span><span class="sxs-lookup"><span data-stu-id="3a072-208">Optionally, the connection string can also supply the name of another server instance, the *failover partner name*, to identify the server instance that initially hosts the secondary replica as the failover partner name.</span></span>  
  
 <span data-ttu-id="3a072-209">データベース ミラーリングの接続文字列の詳細については、「 [データベース ミラーリング セッションへのクライアントの接続 &#40;SQL Server&#41;](database-mirroring/connect-clients-to-a-database-mirroring-session-sql-server.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="3a072-209">For more information about database mirroring connection strings, see [Connect Clients to a Database Mirroring Session &#40;SQL Server&#41;](database-mirroring/connect-clients-to-a-database-mirroring-session-sql-server.md).</span></span>  
  
##  <a name="behavior-of-client-connections-on-failover"></a><a name="CCBehaviorOnFailover"></a><span data-ttu-id="3a072-210">フェールオーバー時のクライアント接続の動作</span><span class="sxs-lookup"><span data-stu-id="3a072-210">Behavior of Client Connections on Failover</span></span>  
 <span data-ttu-id="3a072-211">可用性グループのフェールオーバーが発生すると、可用性グループへの既存の永続的な接続は終了します。このため、クライアントが、同じプライマリ データベースまたは読み取り専用セカンダリ データベースとの連携を保つには、新しい接続を確立する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3a072-211">When an availability group failover occurs, existing persistent connections to the availability group are terminated and the client must establish a new connection in order to continue working with the same primary database or read-only secondary database.</span></span>  <span data-ttu-id="3a072-212">フェールオーバーがサーバー側で発生している間は、可用性グループへの接続が失敗することがあります。この場合、プライマリが完全にオンラインになるまで、クライアント アプリケーションは接続を再試行します。</span><span class="sxs-lookup"><span data-stu-id="3a072-212">While a failover is occurring on the server side, connectivity to the availability group may fail, forcing the client application to retry connecting until the primary is brought fully back online.</span></span>  
  
 <span data-ttu-id="3a072-213">クライアント アプリケーションの接続の試行中、接続のタイムアウト期間が経過する前に可用性グループがオンラインに戻ると、クライアント ドライバーによる内部での再試行のいずれかが正常に接続できる場合があります。このとき、アプリケーションでエラーは発生しません。</span><span class="sxs-lookup"><span data-stu-id="3a072-213">If the availability group comes back online during a client application's connection attempt but before the connect timeout period, the client driver may successfully connect during one of its internal retry attempts and no error will be surfaced to the application in this case.</span></span>  
  
##  <a name="supporting-availability-group-multi-subnet-failovers"></a><a name="SupportAgMultiSubnetFailover"></a> <span data-ttu-id="3a072-214">可用性グループ マルチサブネット フェールオーバーのサポート</span><span class="sxs-lookup"><span data-stu-id="3a072-214">Supporting Availability Group Multi-Subnet Failovers</span></span>  
 <span data-ttu-id="3a072-215">接続文字列で MultiSubnetFailover 接続オプションをサポートするクライアント ライブラリを使用している場合、MultiSubnetFailover を "True" または "Yes" に設定して (使用しているプロバイダーの構文によって異なります)、別のサブネットへの可用性グループのフェールオーバーを最適化できます。</span><span class="sxs-lookup"><span data-stu-id="3a072-215">If you are using client libraries that support the MultiSubnetFailover connection option in the connection string, you can optimize availability group failover to a different subnet by setting MultiSubnetFailover to "True" or "Yes", depending on the syntax of the provider you are using.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="3a072-216">可用性グループ リスナーおよび SQL Server フェールオーバー クラスター インスタンス名への単一サブネット接続およびマルチサブネット接続の両方に対して、この設定を推奨します。</span><span class="sxs-lookup"><span data-stu-id="3a072-216">We recommend this setting for both single and multi-subnet connections to availability groups listeners and to SQL Server Failover Cluster Instance names.</span></span>  <span data-ttu-id="3a072-217">このオプションを有効にすると、単一サブネットのシナリオでも、さらに最適化されます。</span><span class="sxs-lookup"><span data-stu-id="3a072-217">Enabling this option adds additional optimizations, even for single-subnet scenarios.</span></span>  
  
 <span data-ttu-id="3a072-218">`MultiSubnetFailover` 接続オプションは TCP ネットワーク プロトコルのみで機能します。また、可用性グループ リスナーに接続する場合、および [!INCLUDE[ssCurrent](../includes/sscurrent-md.md)] に接続している仮想ネットワーク名を使用する場合にのみサポートされます。</span><span class="sxs-lookup"><span data-stu-id="3a072-218">The `MultiSubnetFailover` connection option only works with the TCP network protocol and is only supported when connecting to an availability group listener and for any virtual network name connecting to [!INCLUDE[ssCurrent](../includes/sscurrent-md.md)].</span></span>  
  
 <span data-ttu-id="3a072-219">マルチサブネット フェールオーバーを有効にする ADO.NET プロバイダー (System.Data.SqlClient) の接続文字列の例を次に示します。</span><span class="sxs-lookup"><span data-stu-id="3a072-219">An example of a for the ADO.NET provider (System.Data.SqlClient) connection string that enables multi-subnet failover is as follows:</span></span>  
  
```  
Server=tcp:AGListener,1433;Database=AdventureWorks;IntegratedSecurity=SSPI; MultiSubnetFailover=True  
```  
  
 <span data-ttu-id="3a072-220">`MultiSubnetFailover` 接続オプションは、可用性グループが単一のサブネットのみにある場合でも、`True` に設定することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="3a072-220">The `MultiSubnetFailover` connection option should be set to `True` even if the availability group only spans a single subnet.</span></span>  <span data-ttu-id="3a072-221">これにより、今後、クライアント接続文字列を変更することなく、複数のサブネットをサポートするように新しいクライアントをあらかじめ構成することができ、単一サブネットのフェールオーバーのパフォーマンスも最適化できます。</span><span class="sxs-lookup"><span data-stu-id="3a072-221">This allows you to preconfigure new clients to support future spanning of subnets without any need for future client connection string changes and also optimizes failover performance for single subnet failovers.</span></span>  <span data-ttu-id="3a072-222">`MultiSubnetFailover` 接続オプションは必須ではありませんが、サブネットのフェールオーバーが速くなるという利点があります。</span><span class="sxs-lookup"><span data-stu-id="3a072-222">While the `MultiSubnetFailover` connection option is not required, it does provide the benefit of a faster subnet failover.</span></span>  <span data-ttu-id="3a072-223">これは、クライアント ドライバーが、可用性グループに関連付けられている各 IP アドレスの TCP ソケットを同時に開こうとするためです。</span><span class="sxs-lookup"><span data-stu-id="3a072-223">This is because the client driver will attempt to open up a TCP socket for each IP address in parallel associated with the availability group.</span></span>  <span data-ttu-id="3a072-224">クライアント ドライバーは、最初の IP が正常に応答するのを待ち、応答した場合は、その IP を接続に使用します。</span><span class="sxs-lookup"><span data-stu-id="3a072-224">The client driver will wait for the first IP to respond with success and once it does, will then use it for the connection.</span></span>  
  
##  <a name="availability-group-listeners-and-ssl-certificates"></a><a name="SSLcertificates"></a> <span data-ttu-id="3a072-225">可用性グループ リスナーと SSL 証明書</span><span class="sxs-lookup"><span data-stu-id="3a072-225">Availability Group Listeners and SSL Certificates</span></span>  
 <span data-ttu-id="3a072-226">可用性グループ リスナーへの接続時に、参加している SQL Server のインスタンスがセッションの暗号化と共に SSL 証明書を使用していることがあります。この場合、強制的に暗号化するために、接続クライアント ドライバーが SSL 証明書のサブジェクト代替名をサポートする必要があります。</span><span class="sxs-lookup"><span data-stu-id="3a072-226">When connecting to an availability group listener, if the participating instances of SQL Server use SSL certificates in conjunction with session encryption, the connecting client driver will need to support the Subject Alternate Name in the SSL certificate in order to force encryption.</span></span>  <span data-ttu-id="3a072-227">SQL Server ドライバーでの証明書のサブジェクト代替名のサポートは、ADO.NET (SqlClient)、Microsoft JDBC、および SQL Native Client (SNAC) に対して計画されています。</span><span class="sxs-lookup"><span data-stu-id="3a072-227">SQL Server driver support for certificate Subject Alternative Name is planned for ADO.NET (SqlClient), Microsoft JDBC and SQL Native Client (SNAC).</span></span>  
  
 <span data-ttu-id="3a072-228">X.509 証明書は、すべての可用性グループ リスナー セットのリストを証明書のサブジェクト代替名に設定して、フェールオーバー クラスターに参加している各サーバー ノードに対して構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3a072-228">A X.509 certificate must be configured for each participating server node in the failover cluster with a list of all availability group listeners set in the Subject Alternate Name of the certificate.</span></span>  
  
 <span data-ttu-id="3a072-229">たとえば、WSFC に `AG1_listener.Adventure-Works.com`、 `AG2_listener.Adventure-Works.com`、 `AG3_listener.Adventure-Works.com`という 3 つの可用性グループ リスナーがある場合、証明書のサブジェクト代替名を次のように設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3a072-229">For example, if the WSFC has three availability group listeners with the names `AG1_listener.Adventure-Works.com`, `AG2_listener.Adventure-Works.com`, and `AG3_listener.Adventure-Works.com`, the Subject Alternative Name for the certificate should be set as follows:</span></span>  
  
```  
CN = ServerFQDN  
SAN = ServerFQDN,AG1_listener.Adventure-Works.com, AG2_listener.Adventure-Works.com, AG3_listener.Adventure-Works.com  
```  
  
##  <a name="availability-group-listeners-and-server-principal-names-spns"></a><a name="SPNs"></a><span data-ttu-id="3a072-230">可用性グループリスナーとサーバープリンシパル名 (Spn)</span><span class="sxs-lookup"><span data-stu-id="3a072-230">Availability Group Listeners and Server Principal Names (SPNs)</span></span>  
 <span data-ttu-id="3a072-231">可用性グループ リスナーへのクライアント接続で Kerberos を有効にするには、各可用性グループ リスナー名のドメイン管理者が、Active Directory 内にサーバー プリンシパル名 (SPN) を構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3a072-231">A Server Principal Name (SPN) must be configured in Active Directory by a domain administrator for each availability group listener name in order to enable Kerberos for the client connection to the availability group listener.</span></span> <span data-ttu-id="3a072-232">SPN が登録されている場合、可用性レプリカをホストするサーバー インスタンスのサービス アカウントを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3a072-232">When registering the SPN, you must use the service account of the server instance that hosts the availability replica .</span></span>  <span data-ttu-id="3a072-233">SPN がすべてのレプリカで機能するためには、可用性グループをホストする WSFC クラスター内のすべてのインスタンスで同じサービス アカウントを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3a072-233">For the SPN to work across all replicas, the same service account must be used for all instances in the WSFC cluster that hosts the availability group.</span></span>  
  
 <span data-ttu-id="3a072-234">SPN は、Windows コマンド ライン ツールの `setspn` を使用して構成します。</span><span class="sxs-lookup"><span data-stu-id="3a072-234">Use the `setspn` Windows command line tool to configure the SPN.</span></span>  <span data-ttu-id="3a072-235">たとえば、 `AG1listener.Adventure-Works.com` というドメイン アカウントで実行されるように構成された、一連の SQL Server インスタンスでホストされている `corp/svclogin2`という名前の可用性グループの SPN を構成する場合は、次のようになります。</span><span class="sxs-lookup"><span data-stu-id="3a072-235">For example to configure an SPN for an availability group named `AG1listener.Adventure-Works.com` hosted on a set of instances of SQL Server all configured to run under the domain account `corp/svclogin2`:</span></span>  
  
```cmd
setspn -A MSSQLSvc/AG1listener.Adventure-Works.com:1433 corp/svclogin2  
```  
  
 <span data-ttu-id="3a072-236">SQL Server の SPN の手動登録の詳細については、「 [Kerberos 接続用のサービス プリンシパル名の登録](configure-windows/register-a-service-principal-name-for-kerberos-connections.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="3a072-236">For more information about manual registration of a SPN for SQL Server, see [Register a Service Principal Name for Kerberos Connections](configure-windows/register-a-service-principal-name-for-kerberos-connections.md).</span></span>  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="3a072-237">関連タスク</span><span class="sxs-lookup"><span data-stu-id="3a072-237">Related Tasks</span></span>  
  
-   [<span data-ttu-id="3a072-238">AlwaysOn クライアント接続 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="3a072-238">AlwaysOn Client Connectivity &#40;SQL Server&#41;</span></span>](availability-groups/windows/always-on-client-connectivity-sql-server.md)
  
-   [<span data-ttu-id="3a072-239">可用性グループ リスナーの作成または構成 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="3a072-239">Create or Configure an Availability Group Listener &#40;SQL Server&#41;</span></span>](availability-groups/windows/create-or-configure-an-availability-group-listener-sql-server.md)  
  
-   [<span data-ttu-id="3a072-240">可用性グループ リスナーのプロパティの表示 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="3a072-240">View Availability Group Listener Properties &#40;SQL Server&#41;</span></span>](availability-groups/windows/view-availability-group-listener-properties-sql-server.md)  
  
-   [<span data-ttu-id="3a072-241">可用性グループ リスナーの削除 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="3a072-241">Remove an Availability Group Listener &#40;SQL Server&#41;</span></span>](availability-groups/windows/remove-an-availability-group-listener-sql-server.md)  
  
-   [<span data-ttu-id="3a072-242">可用性レプリカでの読み取り専用アクセスの構成 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="3a072-242">Configure Read-Only Access on an Availability Replica &#40;SQL Server&#41;</span></span>](availability-groups/windows/configure-read-only-access-on-an-availability-replica-sql-server.md)  
  
-   [<span data-ttu-id="3a072-243">可用性グループの読み取り専用ルーティングの構成 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="3a072-243">Configure Read-Only Routing for an Availability Group &#40;SQL Server&#41;</span></span>](availability-groups/windows/configure-read-only-routing-for-an-availability-group-sql-server.md)  
  
##  <a name="related-content"></a><a name="RelatedContent"></a> <span data-ttu-id="3a072-244">関連コンテンツ</span><span class="sxs-lookup"><span data-stu-id="3a072-244">Related Content</span></span>  
  
-   [<span data-ttu-id="3a072-245">高可用性と災害復旧のための Microsoft SQL Server AlwaysOn ソリューション ガイド</span><span class="sxs-lookup"><span data-stu-id="3a072-245">Microsoft SQL Server AlwaysOn Solutions Guide for High Availability and Disaster Recovery</span></span>](https://go.microsoft.com/fwlink/?LinkId=227600)  
  
-   <span data-ttu-id="3a072-246">[可用性グループ リスナーの概要](https://blogs.msdn.com/b/sqlalwayson/archive/2012/01/16/introduction-to-the-availability-group-listener.aspx) (SQL Server AlwaysOn チームのブログ)</span><span class="sxs-lookup"><span data-stu-id="3a072-246">[Introduction to the Availability Group Listener](https://blogs.msdn.com/b/sqlalwayson/archive/2012/01/16/introduction-to-the-availability-group-listener.aspx) (a SQL Server AlwaysOn team blog)</span></span>  
  
-   [<span data-ttu-id="3a072-247">SQL Server AlwaysOn チームのブログ: AlwaysOn チームの公式 SQL Server のブログ</span><span class="sxs-lookup"><span data-stu-id="3a072-247">SQL Server AlwaysOn Team Blog: The official SQL Server AlwaysOn Team Blog</span></span>](https://blogs.msdn.com/b/sqlalwayson/)  
  
## <a name="see-also"></a><span data-ttu-id="3a072-248">参照</span><span class="sxs-lookup"><span data-stu-id="3a072-248">See Also</span></span>  
 <span data-ttu-id="3a072-249">[AlwaysOn 可用性グループ &#40;SQL Server の概要&#41;](availability-groups/windows/overview-of-always-on-availability-groups-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="3a072-249">[Overview of AlwaysOn Availability Groups &#40;SQL Server&#41;](availability-groups/windows/overview-of-always-on-availability-groups-sql-server.md) </span></span>  
 [<span data-ttu-id="3a072-250">AlwaysOn クライアント接続 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="3a072-250">AlwaysOn Client Connectivity &#40;SQL Server&#41;</span></span>](availability-groups/windows/always-on-client-connectivity-sql-server.md)  
 <span data-ttu-id="3a072-251">[可用性レプリカに対するクライアント接続アクセスについて &#40;SQL Server&#41;](availability-groups/windows/about-client-connection-access-to-availability-replicas-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="3a072-251">[About Client Connection Access to Availability Replicas &#40;SQL Server&#41;](availability-groups/windows/about-client-connection-access-to-availability-replicas-sql-server.md) </span></span>  
 <span data-ttu-id="3a072-252">[アクティブなセカンダリ: 読み取り可能なセカンダリレプリカ &#40;AlwaysOn 可用性グループ&#41;](availability-groups/windows/active-secondaries-readable-secondary-replicas-always-on-availability-groups.md) </span><span class="sxs-lookup"><span data-stu-id="3a072-252">[Active Secondaries: Readable Secondary Replicas &#40;AlwaysOn Availability Groups&#41;](availability-groups/windows/active-secondaries-readable-secondary-replicas-always-on-availability-groups.md) </span></span>  
 [<span data-ttu-id="3a072-253">データベース ミラーリング セッションへのクライアントの接続 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="3a072-253">Connect Clients to a Database Mirroring Session &#40;SQL Server&#41;</span></span>](database-mirroring/connect-clients-to-a-database-mirroring-session-sql-server.md)
