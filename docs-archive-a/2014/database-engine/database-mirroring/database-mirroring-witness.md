---
title: データベース ミラーリング監視サーバー | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- witness [SQL Server], about witness
- witness [SQL Server]
- database mirroring [SQL Server], witness
ms.assetid: 05606de8-90c3-451a-938d-1ed34211dad7
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 6ac02e2a5dbe86af72c15c07e14de70b12892b48
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87632667"
---
# <a name="database-mirroring-witness"></a><span data-ttu-id="bec12-102">データベース ミラーリング監視サーバー</span><span class="sxs-lookup"><span data-stu-id="bec12-102">Database Mirroring Witness</span></span>
  <span data-ttu-id="bec12-103">自動フェールオーバーをサポートするには、データベース ミラーリング セッションが高い安全性モードで構成されている必要があります。また、このセッションに *監視サーバー*と呼ばれる 3 番目のサーバー インスタンスを配置する必要もあります。</span><span class="sxs-lookup"><span data-stu-id="bec12-103">To support automatic failover, a database mirroring session must be configured in high-safety mode and also possess a third server instance, known as the *witness*.</span></span> <span data-ttu-id="bec12-104">ミラーリング監視サーバーは、必要に応じて配置できる [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] のインスタンスです。ミラーリング監視サーバーを使用することにより、高い安全性モードのセッションのミラー サーバーが、自動フェールオーバーを開始するかどうかを決定できるようになります。</span><span class="sxs-lookup"><span data-stu-id="bec12-104">The witness is an optional instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] that enables the mirror server in a high-safety mode session to recognize whether to initiate an automatic failover.</span></span> <span data-ttu-id="bec12-105">2 つのパートナーとは異なり、ミラーリング監視サーバーではデータベースの操作は行いません。</span><span class="sxs-lookup"><span data-stu-id="bec12-105">Unlike the two partners, the witness does not serve the database.</span></span> <span data-ttu-id="bec12-106">ミラーリング監視サーバーの唯一の役割は、自動フェールオーバーをサポートすることです。</span><span class="sxs-lookup"><span data-stu-id="bec12-106">Supporting automatic failover is the only role of the witness.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="bec12-107">高パフォーマンス モードでは、ミラーリング監視サーバーによって可用性が低下する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="bec12-107">In high-performance mode, the witness can adversely affect availability.</span></span> <span data-ttu-id="bec12-108">データベース ミラーリング セッションでミラーリング監視サーバーを構成すると、プリンシパル サーバーは他のサーバー インスタンスの少なくとも 1 つに接続している必要があります。つまり、ミラー サーバーおよびミラーリング監視サーバーの両方またはいずれか一方と接続している必要があります。</span><span class="sxs-lookup"><span data-stu-id="bec12-108">If a witness is configured for a database mirroring session, the principal server must be connected at least to one of the other server instances, the mirror server or the witness, or both of them.</span></span> <span data-ttu-id="bec12-109">どちらにも接続していないとデータベースが使用できなくなり、サービスの強制はできません (データが失われる損失の可能性あります)。</span><span class="sxs-lookup"><span data-stu-id="bec12-109">Otherwise, the database becomes unavailable and forcing service (with possible data loss) is impossible.</span></span> <span data-ttu-id="bec12-110">したがって、高パフォーマンス モードでは、ミラーリング監視サーバーを常に無効に設定しておくことを強くお勧めします。</span><span class="sxs-lookup"><span data-stu-id="bec12-110">Therefore, for high-performance mode, we strongly recommend that you always keep the witness set to OFF.</span></span> <span data-ttu-id="bec12-111">高パフォーマンス モードに対するミラーリング監視サーバーの影響については、「 [データベース ミラーリングの動作モード](database-mirroring-operating-modes.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="bec12-111">For information about the impact of a witness on high-performance mode, see [Database Mirroring Operating Modes](database-mirroring-operating-modes.md).</span></span>  
  
 <span data-ttu-id="bec12-112">次の図は、ミラーリング監視サーバーを使用した高い安全性モード セッションを示しています。</span><span class="sxs-lookup"><span data-stu-id="bec12-112">The following illustration shows a high-safety mode session with a witness.</span></span>  
  
 <span data-ttu-id="bec12-113">![ミラーリング監視を使用したミラーリング セッション](../media/dbm-3-way-session-intro.gif "ミラーリング監視を使用したミラーリング セッション")</span><span class="sxs-lookup"><span data-stu-id="bec12-113">![Mirroring session with a witness](../media/dbm-3-way-session-intro.gif "Mirroring session with a witness")</span></span>  
  
 <span data-ttu-id="bec12-114">**このトピックの内容**</span><span class="sxs-lookup"><span data-stu-id="bec12-114">**In This Topic:**</span></span>  
  
-   [<span data-ttu-id="bec12-115">複数のセッションでのミラーリング監視サーバーの使用</span><span class="sxs-lookup"><span data-stu-id="bec12-115">Using a Witness in Multiple Sessions</span></span>](#InMultipleSessions)  
  
-   [<span data-ttu-id="bec12-116">ソフトウェアとハードウェアの推奨事項</span><span class="sxs-lookup"><span data-stu-id="bec12-116">Software and Hardware Recommendations</span></span>](#SwHwRecommendations)  
  
-   [<span data-ttu-id="bec12-117">自動フェールオーバーでのミラーリング監視サーバーの役割</span><span class="sxs-lookup"><span data-stu-id="bec12-117">Role of the Witness in Automatic Failover</span></span>](#InAutoFo)  
  
-   [<span data-ttu-id="bec12-118">ミラーリング監視サーバーを追加または削除するには</span><span class="sxs-lookup"><span data-stu-id="bec12-118">To Add or Remove a Witness</span></span>](#AddRemoveWitness)  
  
##  <a name="using-a-witness-in-multiple-sessions"></a><a name="InMultipleSessions"></a> <span data-ttu-id="bec12-119">複数のセッションでのミラーリング監視サーバーの使用</span><span class="sxs-lookup"><span data-stu-id="bec12-119">Using a Witness in Multiple Sessions</span></span>  
 <span data-ttu-id="bec12-120">特定のサーバー インスタンスは、それぞれ異なるデータベースに対応している同時実行データベース ミラーリング セッションで、ミラーリング監視サーバーとして機能することができます。</span><span class="sxs-lookup"><span data-stu-id="bec12-120">A specific server instance can act as a witness in concurrent database mirroring sessions, each for a different database.</span></span> <span data-ttu-id="bec12-121">セッションが異なれば、異なるパートナーを含めることができます。</span><span class="sxs-lookup"><span data-stu-id="bec12-121">Different sessions can be with different partners.</span></span> <span data-ttu-id="bec12-122">次の図は、ミラーリング監視サーバーが異なるパートナーを含む 2 つのデータベース ミラーリング セッションに参加しているサーバー インスタンスを示しています。</span><span class="sxs-lookup"><span data-stu-id="bec12-122">The following illustration shows a server instance that is a witness in two database mirroring sessions with different partners.</span></span>  
  
 <span data-ttu-id="bec12-123">![2 つのデータベース ミラーリングを監視するサーバー インスタンス](../media/dbm-witness-in-2-sessions.gif "2 つのデータベース ミラーリングを監視するサーバー インスタンス")</span><span class="sxs-lookup"><span data-stu-id="bec12-123">![Server instance that is a witness for 2 databases](../media/dbm-witness-in-2-sessions.gif "Server instance that is a witness for 2 databases")</span></span>  
  
 <span data-ttu-id="bec12-124">同じサーバー インスタンスを一部のセッションではミラーリング監視サーバーとして、他のセッションではパートナーとして、同時に使用することも可能です。</span><span class="sxs-lookup"><span data-stu-id="bec12-124">A single-server instance can also function at the same time as a witness in some sessions and a partner in other sessions.</span></span> <span data-ttu-id="bec12-125">ただし実際には、ミラーリング監視サーバーまたはパートナーのどちらかとしてサーバー インスタンスを使用するのが普通です。</span><span class="sxs-lookup"><span data-stu-id="bec12-125">However, in practice, a server instance typically functions as either a witness or a partner.</span></span> <span data-ttu-id="bec12-126">これは、パートナーには実稼働データベースを十分にサポートできるハードウェアを搭載した高度なコンピューターが必要であるのに対し、ミラーリング監視サーバーには [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]をサポートするものであればどのような Windows システムでも使用できるためです。</span><span class="sxs-lookup"><span data-stu-id="bec12-126">This is because the partners require sophisticated computers that have enough hardware to support a production database, whereas the witness can run on any available Windows system that supports [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span></span>  
  
##  <a name="software-and-hardware-recommendations"></a><a name="SwHwRecommendations"></a> <span data-ttu-id="bec12-127">ソフトウェアとハードウェアの推奨事項</span><span class="sxs-lookup"><span data-stu-id="bec12-127">Software and Hardware Recommendations</span></span>  
 <span data-ttu-id="bec12-128">ミラーリング監視サーバーは、パートナーとは別のコンピューターに常駐させることを強くお勧めします。</span><span class="sxs-lookup"><span data-stu-id="bec12-128">We strongly recommend that the witness reside on a separate computer from the partners.</span></span> <span data-ttu-id="bec12-129">データベース ミラーリング パートナーは [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Standard Edition および [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Enterprise Edition でのみサポートされます。</span><span class="sxs-lookup"><span data-stu-id="bec12-129">Database mirroring partners are supported only by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Standard edition and by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Enterprise edition.</span></span> <span data-ttu-id="bec12-130">一方、ミラーリング監視サーバーは、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Workgroup および [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Express でもサポートされます。</span><span class="sxs-lookup"><span data-stu-id="bec12-130">Witnesses, in contrast, are also supported by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Workgroup and by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Express.</span></span> <span data-ttu-id="bec12-131">以前のバージョンの [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]からアップグレードしている間を除き、ミラーリング セッション内のすべてのサーバー インスタンスでは、同じバージョンの [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]を実行している必要があります。</span><span class="sxs-lookup"><span data-stu-id="bec12-131">Except during an upgrade from an earlier version of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], the server instances in a mirroring session must all be running the same version of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="bec12-132">たとえば、 [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] ミラーリング監視サーバーは、 [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] ミラーリング構成からアップグレードする場合にサポートされますが、既存または新規の [!INCLUDE[ssKilimanjaro](../../includes/sskilimanjaro-md.md)] 以降のミラーリング構成には追加できません。</span><span class="sxs-lookup"><span data-stu-id="bec12-132">For example, a [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] witness is supported when you are upgrading from a [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] mirroring configuration but cannot be added to an existing or new [!INCLUDE[ssKilimanjaro](../../includes/sskilimanjaro-md.md)] or later mirroring configuration.</span></span>  
  
 <span data-ttu-id="bec12-133">ミラーリング監視サーバーは、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]のこれらのエディションのいずれかをサポートする任意の信頼性の高いコンピューター システムで実行できます。</span><span class="sxs-lookup"><span data-stu-id="bec12-133">A witness can run on any reliable computer system that supports any of these editions of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="bec12-134">ただし、実行中の [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] の Standard バージョンに必要な最小構成のサーバー インスタンスをミラーリング監視サーバーとして使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="bec12-134">However, we recommend that every server instance that is used as a witness correspond to the minimum configuration that is required for the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Standard version that you are running.</span></span> <span data-ttu-id="bec12-135">これらの要件の詳細については、「 [SQL Server 2014 をインストールするためのハードウェアおよびソフトウェアの要件](../../sql-server/install/hardware-and-software-requirements-for-installing-sql-server.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="bec12-135">For more information about these requirements, see [Hardware and Software Requirements for Installing SQL Server 2014](../../sql-server/install/hardware-and-software-requirements-for-installing-sql-server.md).</span></span>  
  
##  <a name="role-of-the-witness-in-automatic-failover"></a><a name="InAutoFo"></a> <span data-ttu-id="bec12-136">自動フェールオーバーでのミラーリング監視サーバーの役割</span><span class="sxs-lookup"><span data-stu-id="bec12-136">Role of the Witness in Automatic Failover</span></span>  
 <span data-ttu-id="bec12-137">データベース ミラーリング セッションの間は、すべてのサーバー インスタンスが接続の状態を監視します。</span><span class="sxs-lookup"><span data-stu-id="bec12-137">Throughout a database mirroring session, all the server instances monitor their connection status.</span></span> <span data-ttu-id="bec12-138">パートナー間の相互接続が失われると、各パートナーはミラーリング監視サーバーを使用して、少なくとも 1 つのパートナーが現在データベースとして機能していることを確認します。</span><span class="sxs-lookup"><span data-stu-id="bec12-138">If the partners become disconnected from each other, they rely on the witness to make sure that only one of them is currently serving the database.</span></span> <span data-ttu-id="bec12-139">同期ミラー サーバーからプリンシパル サーバーへの接続が失われても、ミラーリング監視サーバーとの接続が失われていなければ、ミラー サーバーはミラーリング監視サーバーにアクセスして、ミラーリング監視サーバーとプリンシパル サーバーとの接続が失われたかどうかを判断します。</span><span class="sxs-lookup"><span data-stu-id="bec12-139">If a synchronized mirror server loses its connection to the principal server but remains connected to the witness, the mirror server contacts the witness to determine whether the witness has lost its connection to the principal server:</span></span>  
  
-   <span data-ttu-id="bec12-140">プリンシパル サーバーとミラーリング監視サーバーとの接続が失われていなければ、自動フェールオーバーは行われません。</span><span class="sxs-lookup"><span data-stu-id="bec12-140">If the principal server is still connected to the witness, automatic failover does not occur.</span></span> <span data-ttu-id="bec12-141">プリンシパル サーバーは引き続きデータベースとして機能し、パートナーから再接続されるときに、その間蓄積したログ レコードをミラー サーバーに送信します。</span><span class="sxs-lookup"><span data-stu-id="bec12-141">Instead, the principal server continues to server the database while accumulating log records to send the mirror server when the partners reconnect.</span></span>  
  
-   <span data-ttu-id="bec12-142">プリンシパル サーバーからミラーリング監視サーバーへの接続も失われている場合、ミラー サーバーはプリンシパル データベースが使用できないことを認識します。</span><span class="sxs-lookup"><span data-stu-id="bec12-142">If the witness is also disconnected from the principal server, the mirror server knows that principal database has become unavailable.</span></span> <span data-ttu-id="bec12-143">この場合、ミラー サーバーはすぐに自動フェールオーバーを開始します。</span><span class="sxs-lookup"><span data-stu-id="bec12-143">In this case, the mirror server immediately initiates an automatic failover.</span></span>  
  
-   <span data-ttu-id="bec12-144">ミラー サーバーからミラーリング監視サーバーおよびプリンシパル サーバーへの接続がどちらも失われた場合、プリンシパル サーバーがどのような状態であっても、自動フェールオーバーは行えません。</span><span class="sxs-lookup"><span data-stu-id="bec12-144">If the mirror server is disconnected from the witness and also from the principal server, automatic failover is not possible, regardless of the state of the principal server.</span></span>  
  
 <span data-ttu-id="bec12-145">この少なくとも 2 つのサーバー インスタンスが接続されていなければならない要件を、 *クォーラム*と呼びます。</span><span class="sxs-lookup"><span data-stu-id="bec12-145">The requirement that at least two of the server instances be connected is known as *quorum*.</span></span> <span data-ttu-id="bec12-146">クォーラムでは、複数のパートナーが同時にデータベースとして機能することはないことが保証されます。</span><span class="sxs-lookup"><span data-stu-id="bec12-146">Quorum makes sure that the database can only be served by one partner at a time.</span></span> <span data-ttu-id="bec12-147">クォーラムのしくみとセッションへの影響については、「[クォーラム: データベースの可用性にミラーリング監視サーバーが与える影響 (データベース ミラーリング)](quorum-how-a-witness-affects-database-availability-database-mirroring.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="bec12-147">For information about how quorum works and its impact on a session, see [Quorum: How a Witness Affects Database Availability &#40;Database Mirroring&#41;](quorum-how-a-witness-affects-database-availability-database-mirroring.md).</span></span>  
  
##  <a name="to-add-or-remove-a-witness"></a><a name="AddRemoveWitness"></a> <span data-ttu-id="bec12-148">ミラーリング監視サーバーを追加または削除するには</span><span class="sxs-lookup"><span data-stu-id="bec12-148">To Add or Remove a Witness</span></span>  
 <span data-ttu-id="bec12-149">**ミラーリング監視サーバーを追加するには**</span><span class="sxs-lookup"><span data-stu-id="bec12-149">**To add a witness**</span></span>  
  
-   [<span data-ttu-id="bec12-150">データベース ミラーリング監視サーバーを追加または置き換える方法 &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="bec12-150">Add or Replace a Database Mirroring Witness &#40;SQL Server Management Studio&#41;</span></span>](../database-mirroring/add-or-replace-a-database-mirroring-witness-sql-server-management-studio.md)  
  
-   [<span data-ttu-id="bec12-151">Windows 認証を使用してデータベースのミラーリング監視を追加する &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="bec12-151">Add a Database Mirroring Witness Using Windows Authentication &#40;Transact-SQL&#41;</span></span>](add-a-database-mirroring-witness-using-windows-authentication-transact-sql.md)  
  
 <span data-ttu-id="bec12-152">**ミラーリング監視サーバーを削除するには**</span><span class="sxs-lookup"><span data-stu-id="bec12-152">**To remove the witness**</span></span>  
  
-   [<span data-ttu-id="bec12-153">データベース ミラーリング セッションからのミラーリング監視サーバーの削除 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="bec12-153">Remove the Witness from a Database Mirroring Session &#40;SQL Server&#41;</span></span>](remove-the-witness-from-a-database-mirroring-session-sql-server.md)  
  
## <a name="see-also"></a><span data-ttu-id="bec12-154">参照</span><span class="sxs-lookup"><span data-stu-id="bec12-154">See Also</span></span>  
 <span data-ttu-id="bec12-155">[データベース ミラーリング セッション中の役割の交代 &#40;SQL Server&#41;](role-switching-during-a-database-mirroring-session-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="bec12-155">[Role Switching During a Database Mirroring Session &#40;SQL Server&#41;](role-switching-during-a-database-mirroring-session-sql-server.md) </span></span>  
 <span data-ttu-id="bec12-156">[データベース ミラーリングの動作モード](database-mirroring-operating-modes.md) </span><span class="sxs-lookup"><span data-stu-id="bec12-156">[Database Mirroring Operating Modes](database-mirroring-operating-modes.md) </span></span>  
 <span data-ttu-id="bec12-157">[クォーラム: データベースの可用性にミラーリング監視サーバーが与える影響 &#40;データベース ミラーリング&#41;](quorum-how-a-witness-affects-database-availability-database-mirroring.md) </span><span class="sxs-lookup"><span data-stu-id="bec12-157">[Quorum: How a Witness Affects Database Availability &#40;Database Mirroring&#41;](quorum-how-a-witness-affects-database-availability-database-mirroring.md) </span></span>  
 <span data-ttu-id="bec12-158">[データベース ミラーリング中に発生する可能性のあるエラー](possible-failures-during-database-mirroring.md) </span><span class="sxs-lookup"><span data-stu-id="bec12-158">[Possible Failures During Database Mirroring](possible-failures-during-database-mirroring.md) </span></span>  
 [<span data-ttu-id="bec12-159">ミラーリング状態 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="bec12-159">Mirroring States &#40;SQL Server&#41;</span></span>](mirroring-states-sql-server.md)  
  
  
