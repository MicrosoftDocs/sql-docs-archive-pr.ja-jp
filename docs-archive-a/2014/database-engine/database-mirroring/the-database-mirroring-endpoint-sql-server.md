---
title: データベース ミラーリング エンドポイント (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 04/27/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- database mirroring [SQL Server], deployment
- database mirroring [SQL Server], endpoint
- endpoints [SQL Server], AlwaysOn Availability Groups
- endpoints [SQL Server], database mirroring
- Availability Groups [SQL Server], endpoint
ms.assetid: 39332dc5-678e-4650-9217-6aa3cdc41635
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 5d9728ad642d978378305a21de4b6a9db068c397
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87645828"
---
# <a name="the-database-mirroring-endpoint-sql-server"></a><span data-ttu-id="c8777-102">データベース ミラーリング エンドポイント (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="c8777-102">The Database Mirroring Endpoint (SQL Server)</span></span>
  <span data-ttu-id="c8777-103">サーバー インスタンスが [!INCLUDE[ssHADR](../../includes/sshadr-md.md)] またはデータベース ミラーリングに参加するには、専用の *データベース ミラーリング エンドポイント*が必要です。</span><span class="sxs-lookup"><span data-stu-id="c8777-103">To participate in [!INCLUDE[ssHADR](../../includes/sshadr-md.md)] or database mirroring a server instance requires its own, dedicated *database mirroring endpoint*.</span></span> <span data-ttu-id="c8777-104">このエンドポイントの用途は特殊で、他のサーバー インスタンスからの接続を受信するためにのみ使用されます。</span><span class="sxs-lookup"><span data-stu-id="c8777-104">This endpoint is a special-purpose endpoint that is used exclusively to receive connections from other server instances.</span></span> <span data-ttu-id="c8777-105">特定のサーバー インスタンスでは、他のサーバー インスタンスに対するすべての [!INCLUDE[ssHADR](../../includes/sshadr-md.md)] またはデータベース ミラーリング接続では、単一のデータベース ミラーリング エンドポイントが使用されます。</span><span class="sxs-lookup"><span data-stu-id="c8777-105">On a given server instance, every [!INCLUDE[ssHADR](../../includes/sshadr-md.md)] or database mirroring connection to any other server instance uses a single database mirroring endpoint.</span></span>  
  
 <span data-ttu-id="c8777-106">データベース ミラーリング エンドポイントでは、伝送制御プロトコル (TCP) を使用して、データベース ミラーリング セッションに参加するサーバー インスタンス間、または可用性レプリカをホストするサーバー インスタンス間でメッセージを送受信します。</span><span class="sxs-lookup"><span data-stu-id="c8777-106">Database mirroring endpoints use Transmission Control Protocol (TCP) to send and receive messages between the server instances participating database mirroring sessions or hosting availability replicas.</span></span> <span data-ttu-id="c8777-107">データベース ミラーリング エンドポイントでは、一意な TCP ポート番号でリッスンします。</span><span class="sxs-lookup"><span data-stu-id="c8777-107">The database mirroring endpoint listens on a unique TCP port number.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="c8777-108">プリンシパル サーバーまたはプライマリ レプリカとのクライアント接続では、データベース ミラーリング エンドポイントは使用されません。</span><span class="sxs-lookup"><span data-stu-id="c8777-108">Client connections to a principal server or primary replica do not use the database mirroring endpoint.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="c8777-109">データベース ミラーリング機能は、将来のバージョンの Microsoft SQL Server では削除される予定です。</span><span class="sxs-lookup"><span data-stu-id="c8777-109">The database mirroring feature will be removed in a future version of Microsoft SQL Server.</span></span> <span data-ttu-id="c8777-110">新しい開発作業ではこの機能の使用を避け、現在データベース ミラーリングを使用しているアプリケーションでは、代わりに [!INCLUDE[ssHADR](../../includes/sshadr-md.md)] を使用するようにアプリケーションを修正することを計画してください。</span><span class="sxs-lookup"><span data-stu-id="c8777-110">Avoid using this feature in new development work, and plan to modify applications that currently use database mirroring to use [!INCLUDE[ssHADR](../../includes/sshadr-md.md)] instead.</span></span>  
  
  
##  <a name="server-network-address"></a><a name="ServerNetworkAddress"></a> <span data-ttu-id="c8777-111">サーバー ネットワーク アドレス</span><span class="sxs-lookup"><span data-stu-id="c8777-111">Server Network Address</span></span>  
 <span data-ttu-id="c8777-112">サーバー インスタンスのネットワーク アドレス (サーバー インスタンスの *サーバー ネットワーク アドレス* または *エンドポイント URL*) には、そのサーバー インスタンスのホスト コンピューターのシステム名とドメイン名以外に、そのサーバー インスタンスのエンドポイントのポート番号も含まれています。</span><span class="sxs-lookup"><span data-stu-id="c8777-112">The network address of a server instance (its *server network address* or *Endpoint URL*) contains the port number of its endpoint, as well as the system and domain name of its host computer.</span></span> <span data-ttu-id="c8777-113">このポート番号は、特定のサーバー インスタンスを一意に識別します。</span><span class="sxs-lookup"><span data-stu-id="c8777-113">The port number uniquely identifies a specific server instance.</span></span>  
  
 <span data-ttu-id="c8777-114">次の図に、同じサーバー上の 2 つのサーバー インスタンスを一意に識別するしくみを示します。</span><span class="sxs-lookup"><span data-stu-id="c8777-114">The following figure illustrates how two server instances on the same server are uniquely identified.</span></span> <span data-ttu-id="c8777-115">どちらのサーバー インスタンスのサーバー ネットワーク アドレスにも、同じシステム名 `MYSYSTEM`とドメイン名 `Adventure-Works.MyDomain.com`が含まれています。</span><span class="sxs-lookup"><span data-stu-id="c8777-115">The server network addresses of both server instances contain the same system name, `MYSYSTEM`, and domain name, `Adventure-Works.MyDomain.com`.</span></span> <span data-ttu-id="c8777-116">システム側でサーバー インスタンスまでルーティングできるように、サーバー ネットワーク アドレスには、特定のサーバー インスタンスのミラーリング エンドポイントに関連付けられたポート番号が含まれています。</span><span class="sxs-lookup"><span data-stu-id="c8777-116">To enable the system to route connections to a server instance, a server network address includes the port number associated with the mirroring endpoint of a particular server instance.</span></span>  
  
 <span data-ttu-id="c8777-117">![既定のインスタンスのサーバー ネットワーク アドレス](../media/dbm-2-instances-ports-1-system.gif "既定のインスタンスのサーバー ネットワーク アドレス")</span><span class="sxs-lookup"><span data-stu-id="c8777-117">![Server network addresses of a default instance](../media/dbm-2-instances-ports-1-system.gif "Server network addresses of a default instance")</span></span>  
  
 <span data-ttu-id="c8777-118">既定では、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] のインスタンスにはデータベース ミラーリング エンドポイントは含まれていません。</span><span class="sxs-lookup"><span data-stu-id="c8777-118">By default, an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] does not contain a database mirroring endpoint.</span></span> <span data-ttu-id="c8777-119">データベース ミラーリング エンドポイントは、データベース ミラーリング セッションの設定時に手動で作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c8777-119">These must be created manually as part of setting up a database mirroring session.</span></span> <span data-ttu-id="c8777-120">データベース ミラーリングにかかわる各サーバー インスタンスには、システム管理者が、別個のエンドポイントを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c8777-120">The system administrator must create a separate endpoint in each server instance that is to participate in database mirroring.</span></span> <span data-ttu-id="c8777-121">特定のコンピューターで複数のサーバー インスタンスがデータベース ミラーリング ポイントを必要とする場合は、エンドポイントごとに異なるポート番号を指定します。</span><span class="sxs-lookup"><span data-stu-id="c8777-121">Note that if more than one server instance on a given computer requires a database mirroring endpoint, specify a different port number for each endpoint.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="c8777-122">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] を実行しているコンピューターでファイアウォールを使用している場合は、エンドポイントで指定されているポートを送信と受信の両方の接続で使用できるようにファイアウォールを構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c8777-122">If the computer running [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] has a firewall, the firewall configuration must allow both incoming and outgoing connections for the port specified in the endpoint.</span></span>  
  
 <span data-ttu-id="c8777-123">データベース ミラーリングと [!INCLUDE[ssHADR](../../includes/sshadr-md.md)]では、認証と暗号化はエンドポイントで構成されます。</span><span class="sxs-lookup"><span data-stu-id="c8777-123">For database mirroring and [!INCLUDE[ssHADR](../../includes/sshadr-md.md)], authentication and encryption are configured on the endpoint.</span></span> <span data-ttu-id="c8777-124">詳細については、「[データベースミラーリングのトランスポートセキュリティ」および「AlwaysOn 可用性グループ &#40;SQL Server&#41;](transport-security-database-mirroring-always-on-availability.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c8777-124">For more information, see [Transport Security for Database Mirroring and AlwaysOn Availability Groups &#40;SQL Server&#41;](transport-security-database-mirroring-always-on-availability.md).</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="c8777-125">使用中のデータベース ミラーリング エンドポイントは再構成しないでください。</span><span class="sxs-lookup"><span data-stu-id="c8777-125">Do not reconfigure an in-use database mirroring endpoint.</span></span> <span data-ttu-id="c8777-126">サーバー インスタンスは、互いのエンドポイントを使用して、他のシステムの状態を調べます。</span><span class="sxs-lookup"><span data-stu-id="c8777-126">The server instances use each other's endpoints to learn the state of the other systems.</span></span> <span data-ttu-id="c8777-127">エンドポイントを再構成すると、そのエンドポイントは再起動されます。これにより、他のサーバー インスタンスではエラーが発生したように見えることがあります。</span><span class="sxs-lookup"><span data-stu-id="c8777-127">If the endpoint is reconfigured, it might restart, which can appear to be an error to the other server instances.</span></span> <span data-ttu-id="c8777-128">これは、自動フェールオーバー モードでは特に重要です。この場合、パートナーでエンドポイントを再構成すると、フェールオーバーが発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="c8777-128">This is particularly important for automatic failover mode, in which reconfiguring the endpoint on a partner could cause a failover to occur.</span></span>  
  
  
##  <a name="determining-the-authentication-type-for-a-database-mirroring-endpoint"></a><a name="EndpointAuthenticationTypes"></a> <span data-ttu-id="c8777-129">データベース ミラーリング エンドポイント用の Windows 認証の種類の決定</span><span class="sxs-lookup"><span data-stu-id="c8777-129">Determining the Authentication Type for a Database Mirroring Endpoint</span></span>  
 <span data-ttu-id="c8777-130">データベース ミラーリング エンドポイントに使用できる認証の種類は、サーバー インスタンスの [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] サービス アカウントによって次のように決定されることを理解しておく必要があります。</span><span class="sxs-lookup"><span data-stu-id="c8777-130">It is important to understand that the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] service accounts of your server instances determine what type of authentication you can use for your database mirroring endpoints, as follows:</span></span>  
  
-   <span data-ttu-id="c8777-131">サーバー インスタンスがドメイン サービス アカウントで実行中の場合は、データベース ミラーリング エンドポイントで Windows 認証を使用できます。</span><span class="sxs-lookup"><span data-stu-id="c8777-131">If every server instance is running under a domain service account, you can use Windows Authentication for your database mirroring endpoints.</span></span> <span data-ttu-id="c8777-132">同じドメイン ユーザー アカウントですべてのサーバー インスタンスを実行した場合は、自動的に両方の **マスター** データベースに正しいユーザー ログインが存在します。</span><span class="sxs-lookup"><span data-stu-id="c8777-132">If all the server instances run as the same domain user account, the correct user logins exist automatically in both **master** databases.</span></span> <span data-ttu-id="c8777-133">可用性データベースのセキュリティ構成が単純化されるので、こちらの方法をお勧めします。</span><span class="sxs-lookup"><span data-stu-id="c8777-133">This simplifies the security configuration for the availability databases and is recommended.</span></span>  
  
     <span data-ttu-id="c8777-134">可用性グループの可用性レプリカをホストするサーバー インスタンスが異なるアカウントで実行される場合は、他のサーバー インスタンスの **マスター** 内にログイン アカウントを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c8777-134">If any server instances that are hosting the availability replicas for an availability group run as different accounts, the login each account must be created in **master** on the other server instance.</span></span> <span data-ttu-id="c8777-135">その後、そのログインに対して、そのサーバー インスタンスのデータベース ミラーリング エンドポイントに接続するための CONNECT 権限を与える必要があります。</span><span class="sxs-lookup"><span data-stu-id="c8777-135">Then, that login must be granted CONNECT permissions to connect to the database mirroring endpoint of that server instance.</span></span> <span data-ttu-id="c8777-136">詳細について[は、データベースミラーリングのログインアカウントを設定するか、&#41;SQL Server &#40;AlwaysOn 可用性グループ](set-up-login-accounts-database-mirroring-always-on-availability.md)してください。</span><span class="sxs-lookup"><span data-stu-id="c8777-136">For more information, [Set Up Login Accounts for Database Mirroring or AlwaysOn Availability Groups &#40;SQL Server&#41;](set-up-login-accounts-database-mirroring-always-on-availability.md).</span></span>  
  
     <span data-ttu-id="c8777-137">サーバー インスタンスで Windows 認証を使用する場合は、 [!INCLUDE[tsql](../../includes/tsql-md.md)]、PowerShell、または新しい可用性グループ ウィザードを使用して、データベース ミラーリング エンドポイントを作成できます。</span><span class="sxs-lookup"><span data-stu-id="c8777-137">If your server instances use Windows Authentication, you can create database mirroring endpoints by using [!INCLUDE[tsql](../../includes/tsql-md.md)], PowerShell, or the New Availability Group Wizard.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="c8777-138">可用性レプリカをホストするサーバー インスタンスにデータベース ミラーリング エンドポイントがない場合、新しい可用性グループ ウィザードは、Windows 認証を使用するデータベース ミラーリング エンドを自動的に作成できます。</span><span class="sxs-lookup"><span data-stu-id="c8777-138">If a server instance that is to host an availability replica lacks a database mirroring endpoint, the New Availability Group Wizard can automatically create a database mirroring endpoint that uses Windows Authentication.</span></span> <span data-ttu-id="c8777-139">詳細については、「[新しい可用性グループ ウィザードの使用 &#40;SQL Server Management Studio&#41;](../availability-groups/windows/use-the-availability-group-wizard-sql-server-management-studio.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c8777-139">For more information, see [Use the Availability Group Wizard &#40;SQL Server Management Studio&#41;](../availability-groups/windows/use-the-availability-group-wizard-sql-server-management-studio.md).</span></span>  
  
-   <span data-ttu-id="c8777-140">サービス インスタンスがビルトイン アカウント (Local System、Local Service、Network Service など) で実行されている場合、または、非ドメイン アカウントで実行されている場合は、エンドポイント認証に証明書を使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c8777-140">If any server instance is running under a built-in account, such as Local System, Local Service, or Network Service, or a nondomain account, you must use certificates for endpoint authentication.</span></span> <span data-ttu-id="c8777-141">データベース ミラーリング エンドポイントに証明書を使用する場合、各サーバー インスタンスの発信接続と着信接続の両方に証明書を使用するための構成をシステム管理者が行う必要があります。</span><span class="sxs-lookup"><span data-stu-id="c8777-141">If you are using certificates for your database mirroring endpoints, your system administrator must configure each server instance to use certificates on both outbound and inbound connections.</span></span>  
  
     <span data-ttu-id="c8777-142">証明書を使用してデータベース ミラーリング セキュリティを自動的に構成する方法は用意されていません。</span><span class="sxs-lookup"><span data-stu-id="c8777-142">There is no automated method for configuring database mirroring security using certificates.</span></span> <span data-ttu-id="c8777-143">CREATE ENDPOINT [!INCLUDE[tsql](../../includes/tsql-md.md)] ステートメントまたは `New-SqlHadrEndpoint` PowerShell コマンドレットのいずれかを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c8777-143">You will need to use either CREATE ENDPOINT [!INCLUDE[tsql](../../includes/tsql-md.md)] statement or the `New-SqlHadrEndpoint` PowerShell cmdlet.</span></span> <span data-ttu-id="c8777-144">詳細については、「[CREATE ENDPOINT &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-endpoint-transact-sql)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c8777-144">For more information, see [CREATE ENDPOINT &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-endpoint-transact-sql).</span></span> <span data-ttu-id="c8777-145">サーバーインスタンスで証明書の認証を有効にする方法については、「[データベースミラーリングエンドポイントでの証明書の使用 &#40;transact-sql&#41;](use-certificates-for-a-database-mirroring-endpoint-transact-sql.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c8777-145">For information about enabling certificate authentication on a server instance, see [Use Certificates for a Database Mirroring Endpoint &#40;Transact-SQL&#41;](use-certificates-for-a-database-mirroring-endpoint-transact-sql.md).</span></span>  
  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="c8777-146">関連タスク</span><span class="sxs-lookup"><span data-stu-id="c8777-146">Related Tasks</span></span>  

### <a name="to-configure-a-database-mirroring-endpoint"></a><span data-ttu-id="c8777-147">データベース ミラーリング エンドポイントを構成するには</span><span class="sxs-lookup"><span data-stu-id="c8777-147">To Configure a Database Mirroring Endpoint</span></span>
  
-   [<span data-ttu-id="c8777-148">Windows 認証でのデータベース ミラーリング エンドポイントの作成 &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="c8777-148">Create a Database Mirroring Endpoint for Windows Authentication &#40;Transact-SQL&#41;</span></span>](create-a-database-mirroring-endpoint-for-windows-authentication-transact-sql.md)  
  
-   [<span data-ttu-id="c8777-149">データベース ミラーリング エンドポイントでの証明書の使用 &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="c8777-149">Use Certificates for a Database Mirroring Endpoint &#40;Transact-SQL&#41;</span></span>](use-certificates-for-a-database-mirroring-endpoint-transact-sql.md)  
  
    -   [<span data-ttu-id="c8777-150">データベース ミラーリング エンドポイントで発信接続に証明書を使用できるようにする &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="c8777-150">Allow a Database Mirroring Endpoint to Use Certificates for Outbound Connections &#40;Transact-SQL&#41;</span></span>](database-mirroring-use-certificates-for-outbound-connections.md)  
  
    -   [<span data-ttu-id="c8777-151">データベース ミラーリング エンドポイントで着信接続に証明書を使用できるようにする &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="c8777-151">Allow a Database Mirroring Endpoint to Use Certificates for Inbound Connections &#40;Transact-SQL&#41;</span></span>](database-mirroring-use-certificates-for-inbound-connections.md)  
  
-   [<span data-ttu-id="c8777-152">サーバー ネットワーク アドレスの指定 &#40;データベース ミラーリング&#41;</span><span class="sxs-lookup"><span data-stu-id="c8777-152">Specify a Server Network Address &#40;Database Mirroring&#41;</span></span>](specify-a-server-network-address-database-mirroring.md)  
  
-   [<span data-ttu-id="c8777-153">可用性レプリカを追加または変更する場合のエンドポイント URL の指定 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="c8777-153">Specify the Endpoint URL When Adding or Modifying an Availability Replica &#40;SQL Server&#41;</span></span>](../availability-groups/windows/specify-endpoint-url-adding-or-modifying-availability-replica.md)  
  
-   [<span data-ttu-id="c8777-154">可用性グループ ウィザードの使用 &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="c8777-154">Use the Availability Group Wizard &#40;SQL Server Management Studio&#41;</span></span>](../../ssms/sql-server-management-studio-ssms.md)  
  
 <span data-ttu-id="c8777-155">**データベース ミラーリング エンドポイントに関する情報を表示するには**</span><span class="sxs-lookup"><span data-stu-id="c8777-155">**To View Information About the Database Mirroring Endpoint**</span></span>  
  
-   [<span data-ttu-id="c8777-156">sys.database_mirroring_endpoints &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="c8777-156">sys.database_mirroring_endpoints &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-catalog-views/sys-database-mirroring-endpoints-transact-sql)  
  
  
## <a name="see-also"></a><span data-ttu-id="c8777-157">参照</span><span class="sxs-lookup"><span data-stu-id="c8777-157">See Also</span></span>  
 <span data-ttu-id="c8777-158">[データベースミラーリングと AlwaysOn 可用性グループ &#40;SQL Server のトランスポートセキュリティ&#41;](transport-security-database-mirroring-always-on-availability.md) </span><span class="sxs-lookup"><span data-stu-id="c8777-158">[Transport Security for Database Mirroring and AlwaysOn Availability Groups &#40;SQL Server&#41;](transport-security-database-mirroring-always-on-availability.md) </span></span>  
 <span data-ttu-id="c8777-159">[データベース ミラーリング構成のトラブルシューティング &#40;SQL Server&#41;](troubleshoot-database-mirroring-configuration-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="c8777-159">[Troubleshoot Database Mirroring Configuration &#40;SQL Server&#41;](troubleshoot-database-mirroring-configuration-sql-server.md) </span></span>  
 <span data-ttu-id="c8777-160">[dm_hadr_availability_replica_states &#40;Transact-sql&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-availability-replica-states-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="c8777-160">[sys.dm_hadr_availability_replica_states &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-availability-replica-states-transact-sql) </span></span>  
 [<span data-ttu-id="c8777-161">sys.dm_db_mirroring_connections &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="c8777-161">sys.dm_db_mirroring_connections &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-dynamic-management-views/database-mirroring-sys-dm-db-mirroring-connections)  
