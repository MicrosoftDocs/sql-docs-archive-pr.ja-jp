---
title: データベース ミラーリングとログ配布 (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- database mirroring [SQL Server], interoperability
- log shipping [SQL Server], database mirroring
ms.assetid: 53e98134-e274-4dfd-8b72-0cc0fd5c800e
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: fe11f4244eff98923a6f4ee291caca9c094237f4
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87634027"
---
# <a name="database-mirroring-and-log-shipping-sql-server"></a><span data-ttu-id="effb2-102">データベース ミラーリングとログ配布 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="effb2-102">Database Mirroring and Log Shipping (SQL Server)</span></span>
  <span data-ttu-id="effb2-103">特定のデータベースをミラーリングまたはログ配布することができます。また、ミラーリングとログ配布を同時に行うこともできます。</span><span class="sxs-lookup"><span data-stu-id="effb2-103">A given database can be mirrored or log shipped; it can also be simultaneously mirrored and log shipped.</span></span> <span data-ttu-id="effb2-104">使用する方法を選択するには、次の点を検討します。</span><span class="sxs-lookup"><span data-stu-id="effb2-104">To choose what approach to use, consider the following:</span></span>  
  
-   <span data-ttu-id="effb2-105">必要な配布先サーバーは何台か。</span><span class="sxs-lookup"><span data-stu-id="effb2-105">How many destination servers do you require?</span></span>  
  
     <span data-ttu-id="effb2-106">配布先データベースが 1 つしか必要でない場合は、データベース ミラーリングをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="effb2-106">If you require only a single destination database, database mirroring is the recommended solution.</span></span>  
  
     <span data-ttu-id="effb2-107">配布先データベースが複数必要である場合、ログ配布を単独で使用するか、またはデータベース ミラーリングと併用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="effb2-107">If you require more than one destination database, you need to use log shipping, either alone or with database mirroring.</span></span> <span data-ttu-id="effb2-108">2 つの操作を組み合わせることで、データベース ミラーリングの利点を得られるだけでなく、ログ配布により複数配布先のサポートが可能になります。</span><span class="sxs-lookup"><span data-stu-id="effb2-108">Combining these approaches gives you the benefits of database mirroring along with the support for multiple destinations provided by log shipping.</span></span>  
  
-   <span data-ttu-id="effb2-109">配布先データベースでのログ復元を (論理エラーに対する保護などの目的で) 遅延させる必要があるか。その場合は、ログ配布を単独またはデータベース ミラーリングと合わせて使用します。</span><span class="sxs-lookup"><span data-stu-id="effb2-109">If you need to delay restoring log on the destination database (typically, to protect against logical errors), use log shipping, alone or with database mirroring.</span></span>  
  
 <span data-ttu-id="effb2-110">ここでは、ログ配布とデータベース ミラーリングを組み合わせる場合の考慮事項について説明します。</span><span class="sxs-lookup"><span data-stu-id="effb2-110">This topic discusses considerations for combining log shipping and database mirroring.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="effb2-111">それぞれのテクノロジの概要については、「[データベース ミラーリング &#40;SQL Server&#41;](database-mirroring-sql-server.md)」と「[ログ配布について &#40;SQL Server&#41;](../log-shipping/about-log-shipping-sql-server.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="effb2-111">For introductions to these technologies, see [Database Mirroring &#40;SQL Server&#41;](database-mirroring-sql-server.md) and [About Log Shipping &#40;SQL Server&#41;](../log-shipping/about-log-shipping-sql-server.md).</span></span>  
  
## <a name="combining-log-shipping-and-database-mirroring"></a><span data-ttu-id="effb2-112">ログ配布とデータベース ミラーリングの組み合わせ</span><span class="sxs-lookup"><span data-stu-id="effb2-112">Combining Log Shipping and Database Mirroring</span></span>  
 <span data-ttu-id="effb2-113">ログ配布のバックアップ共有が損なわれていない場合、ミラーリング セッションのプリンシパル データベースをログ配布構成のプライマリ データベースとして使用することも (またはその逆を行うことも) できます。</span><span class="sxs-lookup"><span data-stu-id="effb2-113">The principal database in a mirroring session can also act as the primary database in a log shipping configuration, or vice versa, as the log shipping backup share is intact.</span></span> <span data-ttu-id="effb2-114">データベース ミラーリングのセッションは、同期 (トランザクションの安全性の設定が FULL) と非同期 (トランザクションの安全性の設定が OFF) のいずれの操作モードでも実行できます。</span><span class="sxs-lookup"><span data-stu-id="effb2-114">The database mirroring session run in any operating mode, whether synchronous (with transaction safety set to FULL) or asynchronous (with transaction safety set to OFF).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="effb2-115">データベース ミラーリングを使用するには、常に完全復旧モデルが必要になります。</span><span class="sxs-lookup"><span data-stu-id="effb2-115">To use database mirroring on a database, the full recovery model is always required.</span></span>  
  
 <span data-ttu-id="effb2-116">通常は、ログ配布とデータベース ミラーリングを組み合わせる場合、ログ配布の前にミラーリング セッションを確立します。ただしこの順序は必須ではありません。</span><span class="sxs-lookup"><span data-stu-id="effb2-116">Typically, when combining log shipping and database mirroring, the mirroring session is established before log shipping, although this is not required.</span></span> <span data-ttu-id="effb2-117">次に、現在のプリンシパル データベースを、ログ配布のプライマリとして、1 つ以上のリモート セカンダリ データベースと共に構成します ( *プリンシパル/プライマリ データベース*)。</span><span class="sxs-lookup"><span data-stu-id="effb2-117">Then the current principal database is configured as the log shipping primary (the *principal/primary database*), along with one or more remote secondary databases.</span></span> <span data-ttu-id="effb2-118">また、ミラー データベースもログ配布のプライマリ ( *ミラー/プライマリ データベース*) として構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="effb2-118">Also, the mirror database must be configured as a log shipping primary (the *mirror/primary database*).</span></span> <span data-ttu-id="effb2-119">ログ配布のセカンダリ データベースは、プリンシパル/プライマリ サーバーおよびミラー/プライマリ サーバーのいずれとも異なるサーバー インスタンスに配置するようにします。</span><span class="sxs-lookup"><span data-stu-id="effb2-119">The log shipping secondary databases should be on different server instances than either the principal/primary server or mirror/primary server.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="effb2-120">ログ配布で使用するサーバーすべてについて、大文字と小文字の区別に関する設定を揃えてください。</span><span class="sxs-lookup"><span data-stu-id="effb2-120">The case sensitivity settings of the servers involved in log shipping should match.</span></span>  
  
 <span data-ttu-id="effb2-121">ログ配布セッションでは、プライマリ データベースのバックアップ ジョブによりログ バックアップがバックアップ フォルダーに作成されます。</span><span class="sxs-lookup"><span data-stu-id="effb2-121">During a log shipping session, backup jobs on the primary database create log backups in a backup folder.</span></span> <span data-ttu-id="effb2-122">このフォルダーから、セカンダリ サーバーのコピー ジョブによりバックアップのコピーが行われます。</span><span class="sxs-lookup"><span data-stu-id="effb2-122">From there, the backups are copied by the copy jobs of the secondary servers.</span></span> <span data-ttu-id="effb2-123">バックアップ ジョブおよびコピー ジョブが成功するには、ジョブからログ配布のバックアップ フォルダーに対するアクセスが必要です。</span><span class="sxs-lookup"><span data-stu-id="effb2-123">For the backup jobs and copy jobs to succeed, they must have access to the log shipping backup folder.</span></span> <span data-ttu-id="effb2-124">プライマリ サーバーの可用性を最大にするため、バックアップ フォルダーは独立したホスト コンピューターの共有のバックアップ場所に作成することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="effb2-124">To maximize availability of the primary server, we recommend that you establish the backup folder in a shared backup location on a separate host computer.</span></span> <span data-ttu-id="effb2-125">この共有のバックアップ場所 ( *バックアップ共有*といいます) は、ミラー/プライマリ サーバーを含めたすべてのログ配布サーバーからアクセスできるようにします。</span><span class="sxs-lookup"><span data-stu-id="effb2-125">Ensure that all the log shipping servers, including the mirror/primary server, can access the shared backup location (known as a *backup share*).</span></span>  
  
 <span data-ttu-id="effb2-126">データベース ミラーリングのフェールオーバー後もログ配布を続行するには、プリンシパル データベースをプライマリにしたときと同一の構成で、ミラー サーバーをプライマリ サーバーとして構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="effb2-126">To allow log shipping to continue after database mirroring fails over, you must also configure the mirror server as a primary server, using the same configuration you use for the primary on the principal database.</span></span> <span data-ttu-id="effb2-127">ミラー データベースの復元中は、バックアップ ジョブを行ってミラー データベースにログをバックアップすることができません。</span><span class="sxs-lookup"><span data-stu-id="effb2-127">The mirror database is in the restoring state, which prevents the backup jobs from backing up the log on the mirror database.</span></span> <span data-ttu-id="effb2-128">したがって、セカンダリ サーバーへのログ バックアップのコピーを進行中のプリンシパル/プライマリ データベースがミラー/プライマリ データベースによって妨害されることはありません。</span><span class="sxs-lookup"><span data-stu-id="effb2-128">This ensures that the mirror/primary database does not interfere with the principal/primary database whose log backups are currently being copied by secondary servers.</span></span> <span data-ttu-id="effb2-129">誤った警告が報告されるのを防ぐため、ミラー/プライマリ データベースでのバックアップ ジョブの実行後、**log_shipping_monitor_history_detail** テーブルにメッセージ ログが書き込まれ、成功のステータスがエージェント ジョブから返されます。</span><span class="sxs-lookup"><span data-stu-id="effb2-129">To prevent spurious alerts, after the backup job executes on the mirror/primary database, the backup job logs a message to the l**og_shipping_monitor_history_detail** table, and the agent job returns a status of success.</span></span>  
  
 <span data-ttu-id="effb2-130">ログ配布セッション中はミラー/プライマリ データベースがアクティブでなくなります。</span><span class="sxs-lookup"><span data-stu-id="effb2-130">The mirror/primary database is inactive in the log shipping session.</span></span> <span data-ttu-id="effb2-131">ただし、ミラーリングがフェールオーバーした場合は以前のミラー データベースがプリンシパル データベースとしてオンラインになります。</span><span class="sxs-lookup"><span data-stu-id="effb2-131">However, if mirroring fails over, the former mirror database comes online as the principal database.</span></span> <span data-ttu-id="effb2-132">同時に、そのデータベースはログ配布プライマリ データベースとしてアクティブになります。</span><span class="sxs-lookup"><span data-stu-id="effb2-132">At that point, that database also becomes active as the log shipping primary database.</span></span> <span data-ttu-id="effb2-133">そのデータベースにログを配布できなかったログ配布のバックアップ ジョブにより、ログ配布が開始されます。</span><span class="sxs-lookup"><span data-stu-id="effb2-133">The log shipping backup jobs that were previously unable to ship log on that database, begin shipping log.</span></span> <span data-ttu-id="effb2-134">逆に、フェールオーバーが発生すると、以前のプリンシパル/プライマリ データベースが新しいミラー/プライマリ データベースになって復元状態になります。そのデータベースに対するバックアップ ジョブはログのバックアップを停止します。</span><span class="sxs-lookup"><span data-stu-id="effb2-134">Conversely, a failover causes the former principal/primary database to become the new mirror/primary database and enter the restoring state, and backup jobs on that database cease to backup log.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="effb2-135">自動フェールオーバーの場合は、以前のプリンシパル/プライマリ データベースがミラーリング セッションに再度参加したときに、ミラーの役割への交代が発生します。</span><span class="sxs-lookup"><span data-stu-id="effb2-135">In the event of an automatic failover, the switch to the mirror role occurs when the former principal/primary database rejoins the mirroring session.</span></span>  
  
 <span data-ttu-id="effb2-136">自動フェールオーバーを伴う高い安全性モードを実行するには、 *ミラーリング監視サーバー インスタンス*と呼ばれる追加のサーバー インスタンスを使用してミラーリング セッションを構成します。</span><span class="sxs-lookup"><span data-stu-id="effb2-136">To run in high-safety mode with automatic failover the mirroring session is configured with an additional server instance known as the *witness*.</span></span> <span data-ttu-id="effb2-137">データベースを同期した後で何かの理由によりプリンシパル データベースに障害が発生した場合、およびミラー サーバーとミラーリング監視サーバーが相互通信を続行できる場合は、自動フェールオーバーが発生します。</span><span class="sxs-lookup"><span data-stu-id="effb2-137">If the principal database is lost for any reason after the database is synchronized and if the mirror server and witness can still communicate with each other, automatic failover occurs.</span></span> <span data-ttu-id="effb2-138">自動フェールオーバーが発生すると、プリンシパルの役割がミラー サーバーに引き継がれ、ミラーのデータベースがプリンシパル データベースとしてオンラインになります。</span><span class="sxs-lookup"><span data-stu-id="effb2-138">An automatic failover causes mirror server to assume the principal role and bring its database online as the principal database.</span></span> <span data-ttu-id="effb2-139">新しいプリンシパル/プライマリ サーバーからログ配布のバックアップ場所にアクセスできる場合、バックアップ ジョブはその場所へのログ バックアップの配布を開始します。</span><span class="sxs-lookup"><span data-stu-id="effb2-139">If the log shipping backup location is accessible to the new principal/primary server, its backup jobs begin to ship log backups to that location.</span></span> <span data-ttu-id="effb2-140">データベース ミラーリングを同期モードにすると、ログ チェーンがミラーリングのフェールオーバーの影響を受けず、有効なログのみが復元されます。</span><span class="sxs-lookup"><span data-stu-id="effb2-140">The database mirroring synchronous mode guarantees that the log chain is unaffected by a mirroring failover and that only valid log is restored.</span></span> <span data-ttu-id="effb2-141">セカンダリ サーバーは、別のサーバー インスタンスがプライマリ サーバーになったことを認識することなくログ バックアップのコピーを継続します。</span><span class="sxs-lookup"><span data-stu-id="effb2-141">The secondary servers continue to copy log backups without knowing that a different server instance has become the primary server.</span></span>  
  
 <span data-ttu-id="effb2-142">ローカル ログ配布モニターを使用している場合、このシナリオのために特別に考慮が必要な事項はありません。</span><span class="sxs-lookup"><span data-stu-id="effb2-142">When using a local log shipping monitor, no special considerations are necessary to accommodate this scenario.</span></span> <span data-ttu-id="effb2-143">このシナリオでリモート監視インスタンスを使用する際の詳細については、このトピックの「リモート監視インスタンスでのデータベース ミラーリングの影響」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="effb2-143">For information about using a remote monitoring instance with this scenario, see, "The Impact of Database Mirroring on a Remote Monitoring Instance," later in this topic.</span></span>  
  
## <a name="failing-over-from-the-principal-to-the-mirror-database"></a><span data-ttu-id="effb2-144">プリンシパルからミラー データベースへのフェールオーバー</span><span class="sxs-lookup"><span data-stu-id="effb2-144">Failing over from the Principal to the Mirror database</span></span>  
 <span data-ttu-id="effb2-145">次の図に、自動フェールオーバーを伴う高い安全性モードでミラーリングを実行する際の、ログ配布とデータベース ミラーリングの連係動作を示します。</span><span class="sxs-lookup"><span data-stu-id="effb2-145">The following figure shows how log shipping and database mirroring work together when mirroring is running in high-safety mode with automatic failover.</span></span> <span data-ttu-id="effb2-146">**Server_A** はミラーリング用のプリンシパル サーバーであり、ログ配布用のプライマリ サーバーでもあります。</span><span class="sxs-lookup"><span data-stu-id="effb2-146">Initially, **Server_A** is both the principal server for mirroring and the primary server for log shipping.</span></span> <span data-ttu-id="effb2-147">**Server_B** はミラー サーバーであり、プライマリ サーバーとして構成されています。現在はアクティブになっていません。</span><span class="sxs-lookup"><span data-stu-id="effb2-147">**Server_B** is the mirror server and is also configured as a primary server, which is currently inactive.</span></span> <span data-ttu-id="effb2-148">**Server_C** および **Server_D** はログ配布のセカンダリ サーバーです。</span><span class="sxs-lookup"><span data-stu-id="effb2-148">**Server_C** and **Server_D** are log shipping secondary servers.</span></span> <span data-ttu-id="effb2-149">ログ配布セッションの可用性を最大にするため、バックアップの場所は独立したホスト コンピューターの共有ディレクトリに作成します。</span><span class="sxs-lookup"><span data-stu-id="effb2-149">To maximize availability of the log shipping session, the backup location is on a share directory on a separate host computer.</span></span>  
  
 <span data-ttu-id="effb2-150">![ログ配布とデータベース ミラーリング](../media/logshipping-and-dbm-automatic-failover.gif "ログ配布とデータベース ミラーリング")</span><span class="sxs-lookup"><span data-stu-id="effb2-150">![Log shipping and database mirroring](../media/logshipping-and-dbm-automatic-failover.gif "Log shipping and database mirroring")</span></span>  
  
 <span data-ttu-id="effb2-151">ミラーリング フェールオーバー後も、セカンダリ サーバーで定義されているプライマリ サーバーの名前は変わりません。</span><span class="sxs-lookup"><span data-stu-id="effb2-151">After a mirroring failover, the primary server name defined on the secondary server is unchanged.</span></span> <span data-ttu-id="effb2-152">.</span><span class="sxs-lookup"><span data-stu-id="effb2-152">.</span></span>  
  
## <a name="the-impact-of-database-mirroring-on-a-remote-monitoring-instance"></a><span data-ttu-id="effb2-153">リモート監視インスタンスでのデータベース ミラーリングの影響</span><span class="sxs-lookup"><span data-stu-id="effb2-153">The Impact of Database Mirroring on a Remote Monitoring Instance</span></span>  
 <span data-ttu-id="effb2-154">ログ配布をリモート監視インスタンスと共に使用しているときは、ログ配布セッションとデータベース ミラーリングを組み合わせることでモニター テーブルの情報に影響が及びます。</span><span class="sxs-lookup"><span data-stu-id="effb2-154">When log shipping uses with a remote monitoring instance, combining the log shipping session and database mirroring affects the information in the monitor tables.</span></span> <span data-ttu-id="effb2-155">プライマリに関する情報は、プリンシパル/プライマリで構成されたモニターと各セカンダリで構成されたモニターの組み合わせです。</span><span class="sxs-lookup"><span data-stu-id="effb2-155">The information about the primary is a combination of the one configured at the principal/primary and the monitor configured on each secondary.</span></span>  
  
 <span data-ttu-id="effb2-156">できる限り監視をシームレスにするため、リモート モニターを使用する場合は、セカンダリでプライマリを構成するときに元のプライマリの名前を指定することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="effb2-156">To keep monitoring as seamless as possible, when you use a remote monitor, we recommend that you specify the original primary name when configuring the primary at the secondary.</span></span> <span data-ttu-id="effb2-157">こうすることで、Microsoft [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] エージェントからのログ配布構成の変更も容易になります。</span><span class="sxs-lookup"><span data-stu-id="effb2-157">This approach also facilitates changing the log shipping configuration from Microsoft [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent.</span></span> <span data-ttu-id="effb2-158">監視の詳細については、「[ログ配布の監視 &#40;Transact-SQL&#41;](../log-shipping/monitor-log-shipping-transact-sql.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="effb2-158">For more information about monitoring, see [Monitor Log Shipping &#40;Transact-SQL&#41;](../log-shipping/monitor-log-shipping-transact-sql.md).</span></span>  
  
## <a name="setting-up-mirroring-and-log-shipping-together"></a><span data-ttu-id="effb2-159">ミラーリングとログ配布を合わせた設定</span><span class="sxs-lookup"><span data-stu-id="effb2-159">Setting Up Mirroring and Log Shipping Together</span></span>  
 <span data-ttu-id="effb2-160">データベース ミラーリングとログ配布を合わせて設定するには、次の手順を実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="effb2-160">To set up database mirroring and log shipping together, the following steps are required:</span></span>  
  
1.  <span data-ttu-id="effb2-161">NORECOVERY が設定されたプリンシパル/プライマリ データベースのバックアップを別のサーバー インスタンスに復元します。このバックアップは、後でデータベース ミラーリングのプリンシパル/プライマリ データベースに対するミラー データベースとして使用します。</span><span class="sxs-lookup"><span data-stu-id="effb2-161">Restore backups of the principal/primary database with NORECOVERY onto another server instance to be later used as database mirroring mirror database for the principal/primary database.</span></span> <span data-ttu-id="effb2-162">詳細については、「 [ミラーリングのためのミラー データベースの準備 &#40;SQL Server&#41;](prepare-a-mirror-database-for-mirroring-sql-server.md)を使用します。</span><span class="sxs-lookup"><span data-stu-id="effb2-162">For more information, see [Prepare a Mirror Database for Mirroring &#40;SQL Server&#41;](prepare-a-mirror-database-for-mirroring-sql-server.md).</span></span>  
  
2.  <span data-ttu-id="effb2-163">データベース ミラーリングをセットアップする。</span><span class="sxs-lookup"><span data-stu-id="effb2-163">Set up database mirroring.</span></span> <span data-ttu-id="effb2-164">詳細については、「[Windows 認証を使用してデータベース ミラーリング セッションを確立する &#40;SQL Server Management Studio&#41;](establish-database-mirroring-session-windows-authentication.md)」または「[データベース ミラーリングの設定 &#40;SQL Server&#41;](setting-up-database-mirroring-sql-server.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="effb2-164">For more information, see [Establish a Database Mirroring Session Using Windows Authentication &#40;SQL Server Management Studio&#41;](establish-database-mirroring-session-windows-authentication.md) or [Setting Up Database Mirroring &#40;SQL Server&#41;](setting-up-database-mirroring-sql-server.md).</span></span>  
  
3.  <span data-ttu-id="effb2-165">プリンシパル/プライマリ データベースのバックアップを別のサーバー インスタンスに復元します。このバックアップは、後でログ配布のプライマリ データベースに対するセカンダリ データベースとして使用します。</span><span class="sxs-lookup"><span data-stu-id="effb2-165">Restore backups of the principal/primary database to other server instances to be later used as log shipping secondary databases for the primary database.</span></span>  
  
4.  <span data-ttu-id="effb2-166">1 つ以上のセカンダリ データベースのプライマリ データベースであるプリンシパル データベースにログ配布を設定します。</span><span class="sxs-lookup"><span data-stu-id="effb2-166">Set up log shipping on the principal database as the primary database for one or more secondary databases.</span></span>  
  
     <span data-ttu-id="effb2-167">バックアップ ディレクトリ (バックアップ共有) として使用する共有を 1 つ設定します。</span><span class="sxs-lookup"><span data-stu-id="effb2-167">You should set up a single share as the backup directory (a backup share).</span></span> <span data-ttu-id="effb2-168">これにより、プリンシパル サーバーとミラー サーバーの間で役割を交代した後も、引き続き前と同一のディレクトリにバックアップ ジョブによる書き込みが行われます。</span><span class="sxs-lookup"><span data-stu-id="effb2-168">This ensures that after role switching between the principal and mirror servers, backup jobs continue to write to the same directory as before.</span></span> <span data-ttu-id="effb2-169">ベスト プラクティスは、この共有の場所をミラーリングとログ配布に関与しているデータベースをホストするサーバーとは異なる物理サーバー上にすることです。</span><span class="sxs-lookup"><span data-stu-id="effb2-169">A best practice is to ensure that this share is located on a different physical server from the servers hosting the databases involved in mirroring and log shipping.</span></span>  
  
     <span data-ttu-id="effb2-170">詳細については、「 [ログ配布の構成 &#40;SQL Server&#41;](../log-shipping/configure-log-shipping-sql-server.md)で導入されました。</span><span class="sxs-lookup"><span data-stu-id="effb2-170">For more information, see [Configure Log Shipping &#40;SQL Server&#41;](../log-shipping/configure-log-shipping-sql-server.md).</span></span>  
  
5.  <span data-ttu-id="effb2-171">プリンシパルからミラーへ手動でフェールオーバーします。</span><span class="sxs-lookup"><span data-stu-id="effb2-171">Manually failover from the principal to the mirror.</span></span>  
  
     <span data-ttu-id="effb2-172">手動フェールオーバーを実行するには、次の手順を実行します。</span><span class="sxs-lookup"><span data-stu-id="effb2-172">To perform a manual failover:</span></span>  
  
    -   [<span data-ttu-id="effb2-173">データベース ミラーリング セッションを手動でフェールオーバーする方法 &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="effb2-173">Manually Fail Over a Database Mirroring Session &#40;SQL Server Management Studio&#41;</span></span>](manually-fail-over-a-database-mirroring-session-sql-server-management-studio.md)  
  
    -   [<span data-ttu-id="effb2-174">データベース ミラーリング セッションを手動でフェールオーバーする方法 &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="effb2-174">Manually Fail Over a Database Mirroring Session &#40;Transact-SQL&#41;</span></span>](manually-fail-over-a-database-mirroring-session-transact-sql.md)  
  
6.  <span data-ttu-id="effb2-175">プライマリ データベースである新しいプリンシパル (以前のミラー) にログ配布を設定します。</span><span class="sxs-lookup"><span data-stu-id="effb2-175">Set up log shipping on the new principal (previously mirror) as the primary database.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="effb2-176">セカンダリからは設定を実行しないでください。</span><span class="sxs-lookup"><span data-stu-id="effb2-176">Do not perform any setup from a secondary.</span></span>  
  
     <span data-ttu-id="effb2-177">手順 4. で使用したものと同一のバックアップ共有を使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="effb2-177">You must use the same backup share that you used in step 4.</span></span>  
  
     <span data-ttu-id="effb2-178">**の** [トランザクション ログの配布] [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] インターフェイスで、ログ配布構成ごとにサポートされるプライマリ データベースは 1 つのみです。</span><span class="sxs-lookup"><span data-stu-id="effb2-178">The **Transaction Log Shipping** interface in [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] supports only one primary database per log shipping configuration.</span></span> <span data-ttu-id="effb2-179">このため、新しいプリンシパルをプライマリとして設定するにはストアド プロシージャを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="effb2-179">Therefore, you must use stored procedures to set up the new principal as primary.</span></span>  
  
7.  <span data-ttu-id="effb2-180">元のプリンシパルにフェールバックするには、別の手動フェールオーバーを実行します。</span><span class="sxs-lookup"><span data-stu-id="effb2-180">Perform another manual failover to fail back to the original principal.</span></span>  
  
  
