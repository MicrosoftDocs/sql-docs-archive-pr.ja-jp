---
title: データベース ミラーリングと SQL Server フェールオーバー クラスター インスタンス | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- failover clustering [SQL Server], database mirroring
- database mirroring [SQL Server], failover
- high-availability mode [SQL Server]
ms.assetid: f1dd6a79-698b-4e31-b923-6bfc3ea0b617
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 378f834b4482f44f6a84abf419f027b353c7771a
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87736757"
---
# <a name="database-mirroring-and-sql-server-failover-cluster-instances"></a><span data-ttu-id="9efd5-102">データベース ミラーリングと SQL Server フェールオーバー クラスター インスタンス</span><span class="sxs-lookup"><span data-stu-id="9efd5-102">Database Mirroring and SQL Server Failover Cluster Instances</span></span>
  <span data-ttu-id="9efd5-103">フェールオーバー クラスターは、リソース グループと呼ばれる [!INCLUDE[msCoName](../../includes/msconame-md.md)] Cluster Service (MSCS) クラスター グループに含まれる、クラスターのノードに参加している物理ディスクのうち、1 つ以上を組み合わせたものです。</span><span class="sxs-lookup"><span data-stu-id="9efd5-103">A failover cluster is a combination of one or more physical disks in a [!INCLUDE[msCoName](../../includes/msconame-md.md)] Cluster Service (MSCS) cluster group, known as a resource group, that are participating nodes of the cluster.</span></span> <span data-ttu-id="9efd5-104">リソース グループは、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]のインスタンスをホストするフェールオーバー クラスター インスタンスとして構成されます。</span><span class="sxs-lookup"><span data-stu-id="9efd5-104">The resource group is configured as a failover clustered instance that hosts an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="9efd5-105">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] フェールオーバー クラスター インスタンスはネットワーク上では 1 台のコンピューターのように認識されますが、あるノードが利用できなくなった場合に、別のノードへフェールオーバーする機能を備えています。</span><span class="sxs-lookup"><span data-stu-id="9efd5-105">A [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] failover clustered instance appears on the network as if it were a single computer, but has functionality that provides failover from one node to another if one node becomes unavailable.</span></span> <span data-ttu-id="9efd5-106">詳細については、「[Always On フェールオーバー クラスター インスタンス (SQL Server)](../../sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9efd5-106">For more information, see [AlwaysOn Failover Cluster Instances (SQL Server)](../../sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server.md).</span></span>  
  
 <span data-ttu-id="9efd5-107">フェールオーバー クラスターにより、[!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] インスタンス全体の高可用性が確保されます。一方、データベース ミラーリングは、単一データベースの高可用性を確保します。</span><span class="sxs-lookup"><span data-stu-id="9efd5-107">Failover clusters provide high-availability support for an entire [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance, in contrast to database mirroring, which provides high-availability support for a single database.</span></span> <span data-ttu-id="9efd5-108">データベース ミラーリングは、フェールオーバー クラスター間のほか、フェールオーバー クラスターと非クラスター化ホスト間でも機能します。</span><span class="sxs-lookup"><span data-stu-id="9efd5-108">Database mirroring works between failover clusters and, also, between a failover cluster and a nonclustered host.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="9efd5-109">データベース ミラーリングの概要については、「 [データベース ミラーリング &#40;SQL Server&#41;](database-mirroring-sql-server.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9efd5-109">For an introduction to database mirroring, see [Database Mirroring &#40;SQL Server&#41;](database-mirroring-sql-server.md).</span></span>  
  
## <a name="mirroring-and-clustering"></a><span data-ttu-id="9efd5-110">ミラーリングおよびクラスタリング</span><span class="sxs-lookup"><span data-stu-id="9efd5-110">Mirroring and Clustering</span></span>  
 <span data-ttu-id="9efd5-111">通常、ミラーリングとクラスタリングを併せて使用する場合は、プリンシパル サーバーもミラー サーバーもクラスター上に配置し、プリンシパル サーバーとミラー サーバーをそれぞれ異なるクラスターのフェールオーバー クラスター インスタンス上で実行します。</span><span class="sxs-lookup"><span data-stu-id="9efd5-111">Typically, when mirroring is used with clustering, the principal server and mirror server both reside on clusters, with the principal server running on the failover clustered instance of one cluster and the mirror server running on the failover clustered instance of a different cluster.</span></span> <span data-ttu-id="9efd5-112">ただし、パートナーの一方をクラスター内のフェールオーバー クラスター インスタンスに配置し、もう一方を別の非クラスター化コンピューターに配置するというミラーリング セッションを確立することもできます。</span><span class="sxs-lookup"><span data-stu-id="9efd5-112">You can establish a mirroring session in which one partner resides on the failover clustered instance of a cluster and the other partner resides on a separate, unclustered computer, however.</span></span>  
  
 <span data-ttu-id="9efd5-113">クラスターのフェールオーバーによりプリンシパル サーバーが一時的に利用できなくなった場合、データベースへのクライアント接続は切断されます。</span><span class="sxs-lookup"><span data-stu-id="9efd5-113">If a cluster failover makes a principal server temporarily unavailable, client connections are disconnected from the database.</span></span> <span data-ttu-id="9efd5-114">クラスター フェールオーバーが完了すると、クライアントは、 [動作モード](database-mirroring-operating-modes.md)に応じて同じクラスター、別のクラスター、または非クラスター化コンピューター上のプリンシパル サーバーに再接続できるようになります。</span><span class="sxs-lookup"><span data-stu-id="9efd5-114">After the cluster failover completes, clients can reconnect to the principal server on the same cluster, or on a different cluster or an unclustered computer, depending on the [operating mode](database-mirroring-operating-modes.md).</span></span> <span data-ttu-id="9efd5-115">そのため、クラスター化環境でデータベース ミラーリングをどのように構成するかを決める場合は、ミラーリングで使用する動作モードが大きな意味を持ちます。</span><span class="sxs-lookup"><span data-stu-id="9efd5-115">Therefore, when deciding how to configure database mirroring in a clustered environment, the operating mode you use for mirroring is significant.</span></span>  
  
### <a name="high-safety-mode-session-with-automatic-failover"></a><span data-ttu-id="9efd5-116">自動フェールオーバーを伴う高い安全性モードのセッション</span><span class="sxs-lookup"><span data-stu-id="9efd5-116">High-Safety mode Session with Automatic Failover</span></span>  
 <span data-ttu-id="9efd5-117">自動フェールオーバーを伴う高い安全性モードのデータベースをミラー化する場合は、パートナーに 2 クラスター構成を使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="9efd5-117">If you intend to mirror a database in high-safety mode with automatic failover, a two-cluster configuration is recommended for the partners.</span></span> <span data-ttu-id="9efd5-118">この構成であれば、最高の可用性が得られます。</span><span class="sxs-lookup"><span data-stu-id="9efd5-118">This configuration provides maximum availability.</span></span> <span data-ttu-id="9efd5-119">ミラーリング監視サーバーは、別のクラスターに配置するか、非クラスター化コンピューターに配置できます。</span><span class="sxs-lookup"><span data-stu-id="9efd5-119">The witness can reside either on a third cluster or on an unclustered computer.</span></span>  
  
 <span data-ttu-id="9efd5-120">現在のプリンシパル サーバーを実行しているノードで障害が発生した場合は、クラスターの別のノードへのフェールオーバーが進められている間に、データベースの自動フェールオーバーが数秒のうちに開始されます。</span><span class="sxs-lookup"><span data-stu-id="9efd5-120">If the node running the current principal server fails, automatic failover of the database begins within a few seconds, while the cluster is still failing over to another node.</span></span> <span data-ttu-id="9efd5-121">データベース ミラーリング セッションは、もう一方のクラスターにあるミラー サーバー、または非クラスター化コンピューターにフェールオーバーされ、これまでミラー サーバーであったサーバーがプリンシパル サーバーになります。</span><span class="sxs-lookup"><span data-stu-id="9efd5-121">The database mirroring session fails over to the mirror server on the other cluster or unclustered computer, and the former mirror server becomes the principal server.</span></span> <span data-ttu-id="9efd5-122">新しいプリンシパル サーバーは、可能な限り短時間でそのサーバーにあるデータベースのコピーをロールフォワードし、プリンシパル データベースとしてこれをオンラインにします。</span><span class="sxs-lookup"><span data-stu-id="9efd5-122">The new principal server rolls forward its copy of the database as quickly as possible and brings it online as the principal database.</span></span> <span data-ttu-id="9efd5-123">クラスターのフェールオーバーが完了すると (通常、数分で完了します)、それまでプリンシパル サーバーであったフェールオーバー クラスター インスタンスがミラー サーバーになります。</span><span class="sxs-lookup"><span data-stu-id="9efd5-123">After the cluster failover completes, which typically takes several minutes, the failover clustered instance that was formerly the principal server becomes the mirror server.</span></span>  
  
 <span data-ttu-id="9efd5-124">次の図は、ミラーリング監視サーバー (自動フェールオーバーをサポート) を配置した高い安全性モードで運用されているミラーリング セッションにおけるクラスター間の自動フェールオーバーを表しています。</span><span class="sxs-lookup"><span data-stu-id="9efd5-124">The following illustration shows an automatic failover between clusters in a mirroring session running in high-safety mode with a witness (which supports automatic failover).</span></span>  
  
 <span data-ttu-id="9efd5-125">![クラスターでのフェールオーバー](../media/dbm-and-failover-clustering.gif "クラスターでのフェールオーバー")</span><span class="sxs-lookup"><span data-stu-id="9efd5-125">![A failover on a cluster](../media/dbm-and-failover-clustering.gif "A failover on a cluster")</span></span>  
  
 <span data-ttu-id="9efd5-126">ミラーリング セッションを構成する 3 つのサーバー インスタンスが、それぞれ異なる次のクラスターに配置されています: **Cluster_A**、**Cluster_B**、**Cluster_C**。</span><span class="sxs-lookup"><span data-stu-id="9efd5-126">The three server instances in the mirroring session reside on three distinct clusters: **Cluster_A**, **Cluster_B**, and **Cluster_C**.</span></span> <span data-ttu-id="9efd5-127">各クラスターでは、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] の既定のインスタンスが [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] フェールオーバー クラスター インスタンスとして実行されています。</span><span class="sxs-lookup"><span data-stu-id="9efd5-127">On each cluster, a default instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is running as a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] failover clustered instance.</span></span> <span data-ttu-id="9efd5-128">ミラーリング セッションが開始されると、 **Cluster_A** のフェールオーバー クラスター インスタンスはプリンシパル サーバー、 **Cluster_B** のフェールオーバー クラスター インスタンスはミラー サーバー、 **Cluster_C** のフェールオーバー クラスター インスタンスはミラーリング監視サーバーとして機能します。</span><span class="sxs-lookup"><span data-stu-id="9efd5-128">When the mirroring session starts, the failover clustered instance on **Cluster_A** is the principal server, the failover clustered instance on **Cluster_B** is the mirror server, and the failover clustered instance on **Cluster_C** is the witness in the mirroring session.</span></span> <span data-ttu-id="9efd5-129">ここで、 **Cluster_A** でのアクティブなノードで障害が発生し、プリンシパル サーバーが利用できなくなったとします。</span><span class="sxs-lookup"><span data-stu-id="9efd5-129">Eventually, the active node on **Cluster_A** fails, which causes the principal server to become unavailable.</span></span>  
  
 <span data-ttu-id="9efd5-130">クラスターがフェールオーバーを行う前に、ミラーリング監視サーバーを併用することにより、プリンシパル サーバーが使用できなくなったことがミラー サーバーによって検出されます。</span><span class="sxs-lookup"><span data-stu-id="9efd5-130">Before the cluster has time to fail over, the loss of the principal server is detected by the mirror server, with the help of the witness.</span></span> <span data-ttu-id="9efd5-131">ミラー サーバーは、可能な限り短時間でこのサーバーにあるデータベースをロールフォワードし、プリンシパル データベースとしてこれをオンラインにします。</span><span class="sxs-lookup"><span data-stu-id="9efd5-131">The mirror server rolls forward its database and brings it online as the new principal database as quickly as possible.</span></span> <span data-ttu-id="9efd5-132">**Cluster_A** のフェールオーバーが完了すると、これまでのプリンシパル サーバーは現在はミラー サーバーになり、このサーバーのデータベースが **Cluster_B**の現在のプリンシパル データベースと同期されます。</span><span class="sxs-lookup"><span data-stu-id="9efd5-132">When **Cluster_A** finishes failing over, the former principal server is now the mirror server, and it synchronizes its database with the current principal database on **Cluster_B**.</span></span>  
  
### <a name="high-safety-mode-session-without-automatic-failover"></a><span data-ttu-id="9efd5-133">自動フェールオーバーを伴わない高い安全性モードのセッション</span><span class="sxs-lookup"><span data-stu-id="9efd5-133">High-Safety Mode Session Without Automatic Failover</span></span>  
 <span data-ttu-id="9efd5-134">自動フェールオーバーを伴わない高い安全性モードのデータベースをミラー化する場合は、現在のプリンシパル サーバーを実行しているノードで障害が発生すると、クラスター内の別のノードがプリンシパル サーバーとして機能するようになります。</span><span class="sxs-lookup"><span data-stu-id="9efd5-134">If you are mirroring a database in high-safety mode without automatic failover, another node in the cluster will act as the principal server if the node running the current principal server fails.</span></span> <span data-ttu-id="9efd5-135">クラスターが利用できない間は、データベースも利用できないことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="9efd5-135">Note that while the cluster is unavailable, the database is unavailable.</span></span>  
  
### <a name="high-performance-mode-session"></a><span data-ttu-id="9efd5-136">高パフォーマンス モードのセッション</span><span class="sxs-lookup"><span data-stu-id="9efd5-136">High-Performance Mode Session</span></span>  
 <span data-ttu-id="9efd5-137">高パフォーマンス モードのデータベースをミラー化する場合は、プリンシパル サーバーをクラスター上のフェールオーバー クラスター インスタンスに、ミラー サーバーをリモートの非クラスター化サーバーに配置することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="9efd5-137">If you intend to mirror a database in high-performance mode, consider placing the principal server on the failover clustered instance of a cluster and placing the mirror server on an unclustered server in a remote location.</span></span> <span data-ttu-id="9efd5-138">クラスターが別のノードにフェールオーバーした場合、ミラーリング セッションではフェールオーバー クラスター インスタンスが引き続きプリンシパル サーバーとして機能します。</span><span class="sxs-lookup"><span data-stu-id="9efd5-138">If the cluster fails over to a different node, the failover clustered instance will continue as the principal server in the mirroring session.</span></span> <span data-ttu-id="9efd5-139">クラスター全体に問題がある場合、ミラー サーバーにサービスを強制できます。</span><span class="sxs-lookup"><span data-stu-id="9efd5-139">If the entire cluster has problems, you can force service onto the mirror server.</span></span>  
  
 <span data-ttu-id="9efd5-140">**新しい SQL Server フェールオーバー クラスターをセットアップするには**</span><span class="sxs-lookup"><span data-stu-id="9efd5-140">**To set up a new SQL Server failover cluster**</span></span>  
  
-   [<span data-ttu-id="9efd5-141">新しい SQL Server フェールオーバー クラスターの作成 &#40;セットアップ&#41;</span><span class="sxs-lookup"><span data-stu-id="9efd5-141">Create a New SQL Server Failover Cluster &#40;Setup&#41;</span></span>](../../sql-server/failover-clusters/install/create-a-new-sql-server-failover-cluster-setup.md)  
  
 <span data-ttu-id="9efd5-142">**データベース ミラーリングをセットアップするには**</span><span class="sxs-lookup"><span data-stu-id="9efd5-142">**To set up database mirroring**</span></span>  
  
-   [<span data-ttu-id="9efd5-143">データベース ミラーリングの設定 &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="9efd5-143">Setting Up Database Mirroring &#40;SQL Server&#41;</span></span>](setting-up-database-mirroring-sql-server.md)  
  
-   [<span data-ttu-id="9efd5-144">Windows 認証を使用してデータベース ミラーリング セッションを確立する &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="9efd5-144">Establish a Database Mirroring Session Using Windows Authentication &#40;SQL Server Management Studio&#41;</span></span>](establish-database-mirroring-session-windows-authentication.md)  
  
## <a name="see-also"></a><span data-ttu-id="9efd5-145">参照</span><span class="sxs-lookup"><span data-stu-id="9efd5-145">See Also</span></span>  
 <span data-ttu-id="9efd5-146">[データベース ミラーリング &#40;SQL Server&#41;](database-mirroring-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="9efd5-146">[Database Mirroring &#40;SQL Server&#41;](database-mirroring-sql-server.md) </span></span>  
 <span data-ttu-id="9efd5-147">[データベース ミラーリングの動作モード](database-mirroring-operating-modes.md) </span><span class="sxs-lookup"><span data-stu-id="9efd5-147">[Database Mirroring Operating Modes](database-mirroring-operating-modes.md) </span></span>  
 [<span data-ttu-id="9efd5-148">AlwaysOn フェールオーバー クラスター インスタンス (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="9efd5-148">AlwaysOn Failover Cluster Instances (SQL Server)</span></span>](../../sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server.md) 
  
  
